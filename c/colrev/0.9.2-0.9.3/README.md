# Comparing `tmp/colrev-0.9.2.tar.gz` & `tmp/colrev-0.9.3.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "colrev-0.9.2.tar", max compression
+gzip compressed data, was "colrev-0.9.3.tar", max compression
```

## Comparing `colrev-0.9.2.tar` & `colrev-0.9.3.tar`

### file list

```diff
@@ -1,375 +1,379 @@
--rw-r--r--   0        0        0    10435 2023-07-24 05:33:42.615498 colrev-0.9.2/CHANGELOG.md
--rw-r--r--   0        0        0     4405 2023-07-24 05:33:42.615498 colrev-0.9.2/CONTRIBUTING.md
--rw-r--r--   0        0        0     1070 2023-07-24 05:33:42.615498 colrev-0.9.2/LICENSE
--rw-r--r--   0        0        0    12200 2023-07-24 05:33:42.615498 colrev-0.9.2/README.md
--rw-r--r--   0        0        0      314 2023-07-24 05:33:42.615498 colrev-0.9.2/colrev/__init__.py
--rw-r--r--   0        0        0      128 2023-07-24 05:33:42.615498 colrev-0.9.2/colrev/__version__.py
--rw-r--r--   0        0        0    31399 2023-07-24 05:33:42.615498 colrev-0.9.2/colrev/advisor.py
--rw-r--r--   0        0        0    32084 2023-07-24 05:33:42.615498 colrev-0.9.2/colrev/checker.py
--rw-r--r--   0        0        0    43795 2023-07-24 05:33:42.615498 colrev-0.9.2/colrev/dataset.py
--rw-r--r--   0        0        0      105 2023-07-24 05:33:42.615498 colrev-0.9.2/colrev/env/__init__.py
--rw-r--r--   0        0        0    15226 2023-07-24 05:33:42.615498 colrev-0.9.2/colrev/env/environment_manager.py
--rw-r--r--   0        0        0     2151 2023-07-24 05:33:42.615498 colrev-0.9.2/colrev/env/grobid_service.py
--rw-r--r--   0        0        0     3657 2023-07-24 05:33:42.615498 colrev-0.9.2/colrev/env/language_service.py
--rw-r--r--   0        0        0    54392 2023-07-24 05:33:42.615498 colrev-0.9.2/colrev/env/local_index.py
--rw-r--r--   0        0        0    38756 2023-07-24 05:33:42.615498 colrev-0.9.2/colrev/env/package_manager.py
--rw-r--r--   0        0        0     2270 2023-07-24 05:33:42.615498 colrev-0.9.2/colrev/env/resources.py
--rw-r--r--   0        0        0     3933 2023-07-24 05:33:42.615498 colrev-0.9.2/colrev/env/screenshot_service.py
--rw-r--r--   0        0        0    34818 2023-07-24 05:33:42.615498 colrev-0.9.2/colrev/env/tei_parser.py
--rw-r--r--   0        0        0     6161 2023-07-24 05:33:42.615498 colrev-0.9.2/colrev/env/utils.py
--rw-r--r--   0        0        0     2518 2023-07-24 05:33:42.615498 colrev-0.9.2/colrev/env/zotero_translation_service.py
--rw-r--r--   0        0        0    18399 2023-07-24 05:33:42.615498 colrev-0.9.2/colrev/exceptions.py
--rw-r--r--   0        0        0      151 2023-07-24 05:33:42.615498 colrev-0.9.2/colrev/exit_codes.py
--rw-r--r--   0        0        0       86 2023-07-24 05:33:42.615498 colrev-0.9.2/colrev/hooks/__init__.py
--rwxr-xr-x   0        0        0      352 2023-07-24 05:33:42.615498 colrev-0.9.2/colrev/hooks/check.py
--rwxr-xr-x   0        0        0      372 2023-07-24 05:33:42.615498 colrev-0.9.2/colrev/hooks/format.py
--rwxr-xr-x   0        0        0      468 2023-07-24 05:33:42.615498 colrev-0.9.2/colrev/hooks/report.py
--rwxr-xr-x   0        0        0      360 2023-07-24 05:33:42.615498 colrev-0.9.2/colrev/hooks/share.py
--rwxr-xr-x   0        0        0     1233 2023-07-24 05:33:42.615498 colrev-0.9.2/colrev/hooks/update.py
--rw-r--r--   0        0        0     1842 2023-07-24 05:33:42.615498 colrev-0.9.2/colrev/linter/colrev_lint.py
--rw-r--r--   0        0        0      310 2023-07-24 05:33:42.615498 colrev-0.9.2/colrev/linter/readme.md
--rw-r--r--   0        0        0     3082 2023-07-24 05:33:42.615498 colrev-0.9.2/colrev/logger.py
--rw-r--r--   0        0        0     8951 2023-07-24 05:33:42.615498 colrev-0.9.2/colrev/operation.py
--rw-r--r--   0        0        0       92 2023-07-24 05:33:42.615498 colrev-0.9.2/colrev/ops/__init__.py
--rw-r--r--   0        0        0    42838 2023-07-24 05:33:42.615498 colrev-0.9.2/colrev/ops/assets/favicon.ico
--rw-r--r--   0        0        0    52916 2023-07-24 05:33:42.615498 colrev-0.9.2/colrev/ops/assets/faviconWhiteBg.ico
--rw-r--r--   0        0        0     2222 2023-07-24 05:33:42.615498 colrev-0.9.2/colrev/ops/assets/style.css
--rw-r--r--   0        0        0      119 2023-07-24 05:33:42.615498 colrev-0.9.2/colrev/ops/built_in/__init__.py
--rw-r--r--   0        0        0      135 2023-07-24 05:33:42.615498 colrev-0.9.2/colrev/ops/built_in/data/__init__.py
--rw-r--r--   0        0        0      432 2023-07-24 05:33:42.615498 colrev-0.9.2/colrev/ops/built_in/data/bibliography_export.md
--rw-r--r--   0        0        0     9191 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/data/bibliography_export.py
--rw-r--r--   0        0        0     1084 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/data/colrev_curation.md
--rw-r--r--   0        0        0    14961 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/data/colrev_curation.py
--rw-r--r--   0        0        0      155 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/data/github_pages.md
--rw-r--r--   0        0        0    13410 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/data/github_pages.py
--rw-r--r--   0        0        0      155 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/data/obsidian.md
--rw-r--r--   0        0        0     9428 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/data/obsidian.py
--rw-r--r--   0        0        0     1142 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/data/paper_md.md
--rw-r--r--   0        0        0    31983 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/data/paper_md.py
--rw-r--r--   0        0        0      155 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/data/prisma.md
--rw-r--r--   0        0        0     9200 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/data/prisma.py
--rw-r--r--   0        0        0      155 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/data/structured.md
--rw-r--r--   0        0        0    11223 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/data/structured.py
--rw-r--r--   0        0        0      126 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/dedupe/__init__.py
--rw-r--r--   0        0        0      159 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/dedupe/active_learning_dedup_io.md
--rw-r--r--   0        0        0    42748 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/dedupe/active_learning_dedup_io.py
--rw-r--r--   0        0        0      159 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/dedupe/curation_dedupe.md
--rw-r--r--   0        0        0    25476 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/dedupe/curation_dedupe.py
--rw-r--r--   0        0        0      159 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/dedupe/curation_missing_dedupe.md
--rw-r--r--   0        0        0    14391 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/dedupe/curation_missing_dedupe.py
--rw-r--r--   0        0        0      159 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/dedupe/simple_dedupe.md
--rw-r--r--   0        0        0    14251 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/dedupe/simple_dedupe.py
--rw-r--r--   0        0        0     1961 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/dedupe/utils.py
--rw-r--r--   0        0        0      127 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/pdf_get/__init__.py
--rw-r--r--   0        0        0      159 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/pdf_get/local_index_pdf_get.md
--rw-r--r--   0        0        0     2483 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/pdf_get/local_index_pdf_get.py
--rw-r--r--   0        0        0      432 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/pdf_get/unpaywall.md
--rw-r--r--   0        0        0     5280 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/pdf_get/unpaywall.py
--rw-r--r--   0        0        0      159 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/pdf_get/website_screenshot.md
--rw-r--r--   0        0        0     1785 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/pdf_get/website_screenshot.py
--rw-r--r--   0        0        0      131 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/pdf_get_man/__init__.py
--rw-r--r--   0        0        0      165 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/pdf_get_man/pdf_get_man_cli.md
--rw-r--r--   0        0        0    12016 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/pdf_get_man/pdf_get_man_cli.py
--rw-r--r--   0        0        0      128 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/pdf_prep/__init__.py
--rw-r--r--   0        0        0      161 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/pdf_prep/check_ocr.md
--rw-r--r--   0        0        0     4403 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/pdf_prep/check_ocr.py
--rw-r--r--   0        0        0      161 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/pdf_prep/completeness_validation.md
--rw-r--r--   0        0        0     6864 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/pdf_prep/completeness_validation.py
--rw-r--r--   0        0        0      161 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/pdf_prep/cover_page.md
--rw-r--r--   0        0        0     7848 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/pdf_prep/cover_page.py
--rw-r--r--   0        0        0      161 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/pdf_prep/last_page.md
--rw-r--r--   0        0        0     4888 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/pdf_prep/last_page.py
--rw-r--r--   0        0        0      161 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/pdf_prep/metadata_validation.md
--rw-r--r--   0        0        0     6435 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/pdf_prep/metadata_validation.py
--rw-r--r--   0        0        0      161 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/pdf_prep/tei_prep.md
--rw-r--r--   0        0        0     2194 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/pdf_prep/tei_prep.py
--rw-r--r--   0        0        0      132 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/pdf_prep_man/__init__.py
--rw-r--r--   0        0        0      167 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/pdf_prep_man/pdf_prep_man_cli.md
--rw-r--r--   0        0        0    10062 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/pdf_prep_man/pdf_prep_man_cli.py
--rw-r--r--   0        0        0      124 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/prep/__init__.py
--rw-r--r--   0        0        0     1393 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/prep/add_journal_ranking.md
--rw-r--r--   0        0        0     1983 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/prep/add_journal_ranking.py
--rw-r--r--   0        0        0      155 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/prep/bibtex_crossref_resolution.md
--rw-r--r--   0        0        0     2740 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/prep/bibtex_crossref_resolution.py
--rw-r--r--   0        0        0      155 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/prep/citeas_prep.md
--rw-r--r--   0        0        0     4601 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/prep/citeas_prep.py
--rw-r--r--   0        0        0      155 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/prep/crossref_metadata_prep.md
--rw-r--r--   0        0        0     2483 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/prep/crossref_metadata_prep.py
--rw-r--r--   0        0        0      155 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/prep/curation_prep.md
--rw-r--r--   0        0        0     2161 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/prep/curation_prep.py
--rw-r--r--   0        0        0      155 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/prep/dblp_metadata_prep.md
--rw-r--r--   0        0        0     2353 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/prep/dblp_metadata_prep.py
--rw-r--r--   0        0        0      155 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/prep/doi_from_urls_prep.md
--rw-r--r--   0        0        0     4110 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/prep/doi_from_urls_prep.py
--rw-r--r--   0        0        0      155 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/prep/doi_metadata_prep.md
--rw-r--r--   0        0        0     1961 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/prep/doi_metadata_prep.py
--rw-r--r--   0        0        0      155 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/prep/europe_pmc_prep.md
--rw-r--r--   0        0        0     1701 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/prep/europe_pmc_prep.py
--rw-r--r--   0        0        0      155 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/prep/exclude_collections.md
--rw-r--r--   0        0        0     1513 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/prep/exclude_collections.py
--rw-r--r--   0        0        0      155 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/prep/exclude_complementary_materials.md
--rw-r--r--   0        0        0     2671 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/prep/exclude_complementary_materials.py
--rw-r--r--   0        0        0      155 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/prep/exclude_languages.md
--rw-r--r--   0        0        0     6553 2023-07-24 05:33:42.619498 colrev-0.9.2/colrev/ops/built_in/prep/exclude_languages.py
--rw-r--r--   0        0        0      155 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/prep/exclude_non_latin_alphabets.md
--rw-r--r--   0        0        0     2384 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/prep/exclude_non_latin_alphabets.py
--rw-r--r--   0        0        0      155 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/prep/general_polish.md
--rw-r--r--   0        0        0     2076 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/prep/general_polish.py
--rw-r--r--   0        0        0      155 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/prep/local_index_prep.md
--rw-r--r--   0        0        0     2428 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/prep/local_index_prep.py
--rw-r--r--   0        0        0      145 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/prep/open_alex_metadata_prep.md
--rw-r--r--   0        0        0     2310 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/prep/open_alex_metadata_prep.py
--rw-r--r--   0        0        0      155 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/prep/open_library_prep.md
--rw-r--r--   0        0        0     2058 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/prep/open_library_prep.py
--rw-r--r--   0        0        0      155 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/prep/pubmed_metadata_prep.md
--rw-r--r--   0        0        0     2318 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/prep/pubmed_metadata_prep.py
--rw-r--r--   0        0        0      155 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/prep/remove_broken_ids.md
--rw-r--r--   0        0        0     2121 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/prep/remove_broken_ids.py
--rw-r--r--   0        0        0      155 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/prep/remove_error500_urls.md
--rw-r--r--   0        0        0     2308 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/prep/remove_error500_urls.py
--rw-r--r--   0        0        0      155 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/prep/semantic_scholar_prep.md
--rw-r--r--   0        0        0     6991 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/prep/semantic_scholar_prep.py
--rw-r--r--   0        0        0      155 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/prep/source_specific_prep.md
--rw-r--r--   0        0        0     2974 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/prep/source_specific_prep.py
--rw-r--r--   0        0        0      155 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/prep/update_masterdata_status.md
--rw-r--r--   0        0        0     1410 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/prep/update_masterdata_status.py
--rw-r--r--   0        0        0     1106 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/prep/utils.py
--rw-r--r--   0        0        0      155 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/prep/year_vol_iss_prep.md
--rw-r--r--   0        0        0     7724 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/prep/year_vol_iss_prep.py
--rw-r--r--   0        0        0      128 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/prep_man/__init__.py
--rw-r--r--   0        0        0      161 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/prep_man/curation_jupyter_prep_man.md
--rw-r--r--   0        0        0     1882 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/prep_man/curation_jupyter_prep_man.py
--rw-r--r--   0        0        0     1368 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/prep_man/prep_man_export.md
--rw-r--r--   0        0        0    15009 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/prep_man/prep_man_export.py
--rw-r--r--   0        0        0      129 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/prescreen/__init__.py
--rw-r--r--   0        0        0      165 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/prescreen/conditional_prescreen.md
--rw-r--r--   0        0        0     2033 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/prescreen/conditional_prescreen.py
--rw-r--r--   0        0        0      165 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/prescreen/prescreen_cli.md
--rw-r--r--   0        0        0     5047 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/prescreen/prescreen_cli.py
--rw-r--r--   0        0        0      165 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/prescreen/prescreen_table.md
--rw-r--r--   0        0        0     9643 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/prescreen/prescreen_table.py
--rw-r--r--   0        0        0     1263 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/prescreen/scope_prescreen.md
--rw-r--r--   0        0        0    10746 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/prescreen/scope_prescreen.py
--rw-r--r--   0        0        0      132 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/review_types/__init__.py
--rw-r--r--   0        0        0      509 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/review_types/conceptual_review.md
--rw-r--r--   0        0        0     1258 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/review_types/conceptual_review.py
--rw-r--r--   0        0        0      507 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/review_types/critical_review.md
--rw-r--r--   0        0        0     1311 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/review_types/critical_review.py
--rw-r--r--   0        0        0     1141 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/review_types/curated_masterdata.md
--rw-r--r--   0        0        0     4667 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/review_types/curated_masterdata.py
--rw-r--r--   0        0        0      510 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/review_types/descriptive_review.md
--rw-r--r--   0        0        0     1325 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/review_types/descriptive_review.py
--rw-r--r--   0        0        0      509 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/review_types/literature_review.md
--rw-r--r--   0        0        0     1274 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/review_types/literature_review.py
--rw-r--r--   0        0        0      704 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/review_types/meta_analysis.md
--rw-r--r--   0        0        0     1807 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/review_types/meta_analysis.py
--rw-r--r--   0        0        0      508 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/review_types/narrative_review.md
--rw-r--r--   0        0        0     1253 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/review_types/narrative_review.py
--rw-r--r--   0        0        0      521 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/review_types/qualitative_systematic_review.md
--rw-r--r--   0        0        0     1886 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/review_types/qualitative_systematic_review.py
--rw-r--r--   0        0        0      633 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/review_types/scientometric.md
--rw-r--r--   0        0        0     1340 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/review_types/scientometric.py
--rw-r--r--   0        0        0      506 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/review_types/scoping_review.md
--rw-r--r--   0        0        0     1445 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/review_types/scoping_review.py
--rw-r--r--   0        0        0      510 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/review_types/theoretical_review.md
--rw-r--r--   0        0        0     1404 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/review_types/theoretical_review.py
--rw-r--r--   0        0        0      126 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/screen/__init__.py
--rw-r--r--   0        0        0      159 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/screen/screen_cli.md
--rw-r--r--   0        0        0     9714 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/screen/screen_cli.py
--rw-r--r--   0        0        0      159 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/screen/screen_table.md
--rw-r--r--   0        0        0     8839 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/screen/screen_table.py
--rw-r--r--   0        0        0     2642 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/screen/utils.py
--rw-r--r--   0        0        0      133 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/search_sources/__init__.py
--rw-r--r--   0        0        0      496 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/search_sources/abi_inform_proquest.md
--rw-r--r--   0        0        0     5208 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/search_sources/abi_inform_proquest.py
--rw-r--r--   0        0        0      447 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/search_sources/acm_digital_library.md
--rw-r--r--   0        0        0     4421 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/search_sources/acm_digital_library.py
--rw-r--r--   0        0        0      915 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/search_sources/aisel.md
--rw-r--r--   0        0        0    18514 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/search_sources/aisel.py
--rw-r--r--   0        0        0      383 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/search_sources/colrev_project.md
--rw-r--r--   0        0        0     9505 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/search_sources/colrev_project.py
--rw-r--r--   0        0        0      936 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/search_sources/crossref.md
--rw-r--r--   0        0        0    37312 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/search_sources/crossref.py
--rw-r--r--   0        0        0      597 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/search_sources/dblp.md
--rw-r--r--   0        0        0    26917 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/search_sources/dblp.py
--rw-r--r--   0        0        0     6348 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/search_sources/doi_org.py
--rw-r--r--   0        0        0      519 2023-07-24 05:33:42.623499 colrev-0.9.2/colrev/ops/built_in/search_sources/ebsco_host.md
--rw-r--r--   0        0        0     3539 2023-07-24 05:33:42.627499 colrev-0.9.2/colrev/ops/built_in/search_sources/ebsco_host.py
--rw-r--r--   0        0        0     1771 2023-07-24 05:33:42.627499 colrev-0.9.2/colrev/ops/built_in/search_sources/eric.md
--rw-r--r--   0        0        0    10593 2023-07-24 05:33:42.627499 colrev-0.9.2/colrev/ops/built_in/search_sources/eric.py
--rw-r--r--   0        0        0      595 2023-07-24 05:33:42.627499 colrev-0.9.2/colrev/ops/built_in/search_sources/europe_pmc.md
--rw-r--r--   0        0        0    21014 2023-07-24 05:33:42.627499 colrev-0.9.2/colrev/ops/built_in/search_sources/europe_pmc.py
--rw-r--r--   0        0        0      562 2023-07-24 05:33:42.627499 colrev-0.9.2/colrev/ops/built_in/search_sources/google_scholar.md
--rw-r--r--   0        0        0     5159 2023-07-24 05:33:42.627499 colrev-0.9.2/colrev/ops/built_in/search_sources/google_scholar.py
--rw-r--r--   0        0        0     1814 2023-07-24 05:33:42.627499 colrev-0.9.2/colrev/ops/built_in/search_sources/ieee.md
--rw-r--r--   0        0        0    11716 2023-07-24 05:33:42.627499 colrev-0.9.2/colrev/ops/built_in/search_sources/ieee.py
--rw-r--r--   0        0        0    13215 2023-07-24 05:33:42.627499 colrev-0.9.2/colrev/ops/built_in/search_sources/ieee_api.py
--rw-r--r--   0        0        0      427 2023-07-24 05:33:42.627499 colrev-0.9.2/colrev/ops/built_in/search_sources/jstor.md
--rw-r--r--   0        0        0     4511 2023-07-24 05:33:42.627499 colrev-0.9.2/colrev/ops/built_in/search_sources/jstor.py
--rw-r--r--   0        0        0      377 2023-07-24 05:33:42.627499 colrev-0.9.2/colrev/ops/built_in/search_sources/local_index.md
--rw-r--r--   0        0        0    34582 2023-07-24 05:33:42.627499 colrev-0.9.2/colrev/ops/built_in/search_sources/local_index.py
--rw-r--r--   0        0        0      593 2023-07-24 05:33:42.627499 colrev-0.9.2/colrev/ops/built_in/search_sources/open_alex.md
--rw-r--r--   0        0        0    11269 2023-07-24 05:33:42.627499 colrev-0.9.2/colrev/ops/built_in/search_sources/open_alex.py
--rw-r--r--   0        0        0      439 2023-07-24 05:33:42.627499 colrev-0.9.2/colrev/ops/built_in/search_sources/open_citations_forward_search.md
--rw-r--r--   0        0        0     9349 2023-07-24 05:33:42.627499 colrev-0.9.2/colrev/ops/built_in/search_sources/open_citations_forward_search.py
--rw-r--r--   0        0        0      401 2023-07-24 05:33:42.627499 colrev-0.9.2/colrev/ops/built_in/search_sources/open_library.md
--rw-r--r--   0        0        0    11634 2023-07-24 05:33:42.627499 colrev-0.9.2/colrev/ops/built_in/search_sources/open_library.py
--rw-r--r--   0        0        0     1047 2023-07-24 05:33:42.627499 colrev-0.9.2/colrev/ops/built_in/search_sources/pdf_backward_search.md
--rw-r--r--   0        0        0    16019 2023-07-24 05:33:42.627499 colrev-0.9.2/colrev/ops/built_in/search_sources/pdf_backward_search.py
--rw-r--r--   0        0        0      406 2023-07-24 05:33:42.627499 colrev-0.9.2/colrev/ops/built_in/search_sources/pdfs_dir.md
--rw-r--r--   0        0        0    33076 2023-07-24 05:33:42.627499 colrev-0.9.2/colrev/ops/built_in/search_sources/pdfs_dir.py
--rw-r--r--   0        0        0      449 2023-07-24 05:33:42.627499 colrev-0.9.2/colrev/ops/built_in/search_sources/psycinfo.md
--rw-r--r--   0        0        0     5667 2023-07-24 05:33:42.627499 colrev-0.9.2/colrev/ops/built_in/search_sources/psycinfo.py
--rw-r--r--   0        0        0      580 2023-07-24 05:33:42.627499 colrev-0.9.2/colrev/ops/built_in/search_sources/pubmed.md
--rw-r--r--   0        0        0    26892 2023-07-24 05:33:42.627499 colrev-0.9.2/colrev/ops/built_in/search_sources/pubmed.py
--rw-r--r--   0        0        0      428 2023-07-24 05:33:42.627499 colrev-0.9.2/colrev/ops/built_in/search_sources/scopus.md
--rw-r--r--   0        0        0     5944 2023-07-24 05:33:42.627499 colrev-0.9.2/colrev/ops/built_in/search_sources/scopus.py
--rw-r--r--   0        0        0      445 2023-07-24 05:33:42.627499 colrev-0.9.2/colrev/ops/built_in/search_sources/springer_link.md
--rw-r--r--   0        0        0     7160 2023-07-24 05:33:42.627499 colrev-0.9.2/colrev/ops/built_in/search_sources/springer_link.py
--rw-r--r--   0        0        0      572 2023-07-24 05:33:42.627499 colrev-0.9.2/colrev/ops/built_in/search_sources/synergy_datasets.md
--rw-r--r--   0        0        0     7051 2023-07-24 05:33:42.627499 colrev-0.9.2/colrev/ops/built_in/search_sources/synergy_datasets.py
--rw-r--r--   0        0        0      452 2023-07-24 05:33:42.627499 colrev-0.9.2/colrev/ops/built_in/search_sources/taylor_and_francis.md
--rw-r--r--   0        0        0     3610 2023-07-24 05:33:42.627499 colrev-0.9.2/colrev/ops/built_in/search_sources/taylor_and_francis.py
--rw-r--r--   0        0        0      473 2023-07-24 05:33:42.627499 colrev-0.9.2/colrev/ops/built_in/search_sources/trid.md
--rw-r--r--   0        0        0     4875 2023-07-24 05:33:42.627499 colrev-0.9.2/colrev/ops/built_in/search_sources/trid.py
--rw-r--r--   0        0        0      416 2023-07-24 05:33:42.627499 colrev-0.9.2/colrev/ops/built_in/search_sources/unknown_source.md
--rw-r--r--   0        0        0    16667 2023-07-24 05:33:42.627499 colrev-0.9.2/colrev/ops/built_in/search_sources/unknown_source.py
--rw-r--r--   0        0        0     5869 2023-07-24 05:33:42.627499 colrev-0.9.2/colrev/ops/built_in/search_sources/utils.py
--rw-r--r--   0        0        0      340 2023-07-24 05:33:42.627499 colrev-0.9.2/colrev/ops/built_in/search_sources/video_dir.md
--rw-r--r--   0        0        0     6483 2023-07-24 05:33:42.627499 colrev-0.9.2/colrev/ops/built_in/search_sources/video_dir.py
--rw-r--r--   0        0        0      453 2023-07-24 05:33:42.627499 colrev-0.9.2/colrev/ops/built_in/search_sources/web_of_science.md
--rw-r--r--   0        0        0     4965 2023-07-24 05:33:42.627499 colrev-0.9.2/colrev/ops/built_in/search_sources/web_of_science.py
--rw-r--r--   0        0        0     6390 2023-07-24 05:33:42.627499 colrev-0.9.2/colrev/ops/built_in/search_sources/website.py
--rw-r--r--   0        0        0      553 2023-07-24 05:33:42.627499 colrev-0.9.2/colrev/ops/built_in/search_sources/wiley.md
--rw-r--r--   0        0        0     4227 2023-07-24 05:33:42.627499 colrev-0.9.2/colrev/ops/built_in/search_sources/wiley.py
--rw-r--r--   0        0        0     1434 2023-07-24 05:33:42.627499 colrev-0.9.2/colrev/ops/clone.py
--rw-r--r--   0        0        0     9485 2023-07-24 05:33:42.627499 colrev-0.9.2/colrev/ops/commit.py
--rw-r--r--   0        0        0     7210 2023-07-24 05:33:42.627499 colrev-0.9.2/colrev/ops/correct.py
--rw-r--r--   0        0        0     1181 2023-07-24 05:33:42.627499 colrev-0.9.2/colrev/ops/dashboard.py
--rw-r--r--   0        0        0    15081 2023-07-24 05:33:42.627499 colrev-0.9.2/colrev/ops/data.py
--rw-r--r--   0        0        0    36901 2023-07-24 05:33:42.627499 colrev-0.9.2/colrev/ops/dedupe.py
--rw-r--r--   0        0        0     4753 2023-07-24 05:33:42.627499 colrev-0.9.2/colrev/ops/distribute.py
--rw-r--r--   0        0        0    16771 2023-07-24 05:33:42.627499 colrev-0.9.2/colrev/ops/init.py
--rw-r--r--   0        0        0    25462 2023-07-24 05:33:42.631499 colrev-0.9.2/colrev/ops/load.py
--rw-r--r--   0        0        0     6635 2023-07-24 05:33:42.631499 colrev-0.9.2/colrev/ops/load_utils_bib.py
--rw-r--r--   0        0        0     1983 2023-07-24 05:33:42.631499 colrev-0.9.2/colrev/ops/load_utils_md.py
--rw-r--r--   0        0        0     6380 2023-07-24 05:33:42.631499 colrev-0.9.2/colrev/ops/load_utils_ris.py
--rw-r--r--   0        0        0     7195 2023-07-24 05:33:42.631499 colrev-0.9.2/colrev/ops/load_utils_table.py
--rw-r--r--   0        0        0     9434 2023-07-24 05:33:42.631499 colrev-0.9.2/colrev/ops/merge.py
--rw-r--r--   0        0        0     2887 2023-07-24 05:33:42.631499 colrev-0.9.2/colrev/ops/pages/home.py
--rw-r--r--   0        0        0     8944 2023-07-24 05:33:42.631499 colrev-0.9.2/colrev/ops/pages/synthesizedrecords.py
--rw-r--r--   0        0        0    26024 2023-07-24 05:33:42.631499 colrev-0.9.2/colrev/ops/pdf_get.py
--rw-r--r--   0        0        0     7998 2023-07-24 05:33:42.631499 colrev-0.9.2/colrev/ops/pdf_get_man.py
--rw-r--r--   0        0        0    17845 2023-07-24 05:33:42.631499 colrev-0.9.2/colrev/ops/pdf_prep.py
--rw-r--r--   0        0        0    13490 2023-07-24 05:33:42.631499 colrev-0.9.2/colrev/ops/pdf_prep_man.py
--rw-r--r--   0        0        0    45364 2023-07-24 05:33:42.631499 colrev-0.9.2/colrev/ops/prep.py
--rw-r--r--   0        0        0    11284 2023-07-24 05:33:42.631499 colrev-0.9.2/colrev/ops/prep_man.py
--rw-r--r--   0        0        0    14957 2023-07-24 05:33:42.631499 colrev-0.9.2/colrev/ops/prescreen.py
--rw-r--r--   0        0        0     1733 2023-07-24 05:33:42.631499 colrev-0.9.2/colrev/ops/pull.py
--rw-r--r--   0        0        0     5753 2023-07-24 05:33:42.631499 colrev-0.9.2/colrev/ops/push.py
--rw-r--r--   0        0        0     2272 2023-07-24 05:33:42.631499 colrev-0.9.2/colrev/ops/remove.py
--rw-r--r--   0        0        0    16253 2023-07-24 05:33:42.631499 colrev-0.9.2/colrev/ops/repare.py
--rw-r--r--   0        0        0     1088 2023-07-24 05:33:42.631499 colrev-0.9.2/colrev/ops/review_types.py
--rw-r--r--   0        0        0    18921 2023-07-24 05:33:42.631499 colrev-0.9.2/colrev/ops/screen.py
--rw-r--r--   0        0        0     8516 2023-07-24 05:33:42.631499 colrev-0.9.2/colrev/ops/search.py
--rw-r--r--   0        0        0    16327 2023-07-24 05:33:42.631499 colrev-0.9.2/colrev/ops/search_feed.py
--rw-r--r--   0        0        0     1612 2023-07-24 05:33:42.631499 colrev-0.9.2/colrev/ops/search_sources.py
--rwxr-xr-x   0        0        0    22234 2023-07-24 05:33:42.631499 colrev-0.9.2/colrev/ops/status.py
--rw-r--r--   0        0        0    10891 2023-07-24 05:33:42.631499 colrev-0.9.2/colrev/ops/sync.py
--rw-r--r--   0        0        0     4224 2023-07-24 05:33:42.631499 colrev-0.9.2/colrev/ops/trace.py
--rw-r--r--   0        0        0    17244 2023-07-24 05:33:42.631499 colrev-0.9.2/colrev/ops/upgrade.py
--rw-r--r--   0        0        0    21920 2023-07-24 05:33:42.631499 colrev-0.9.2/colrev/ops/validate.py
--rw-r--r--   0        0        0        0 2023-07-24 05:33:42.631499 colrev-0.9.2/colrev/py.typed
--rw-r--r--   0        0        0      112 2023-07-24 05:33:42.631499 colrev-0.9.2/colrev/qm/__init__.py
--rw-r--r--   0        0        0       91 2023-07-24 05:33:42.631499 colrev-0.9.2/colrev/qm/checkers/__init__.py
--rw-r--r--   0        0        0     1152 2023-07-24 05:33:42.631499 colrev-0.9.2/colrev/qm/checkers/container_title_abbreviated.py
--rw-r--r--   0        0        0     1105 2023-07-24 05:33:42.631499 colrev-0.9.2/colrev/qm/checkers/doi_not_matching_pattern.py
--rw-r--r--   0        0        0     1207 2023-07-24 05:33:42.631499 colrev-0.9.2/colrev/qm/checkers/erroneous_symbol_in_field.py
--rw-r--r--   0        0        0     1532 2023-07-24 05:33:42.631499 colrev-0.9.2/colrev/qm/checkers/erroneous_term_in_field.py
--rw-r--r--   0        0        0     1364 2023-07-24 05:33:42.631499 colrev-0.9.2/colrev/qm/checkers/erroneous_title_field.py
--rw-r--r--   0        0        0     1130 2023-07-24 05:33:42.631499 colrev-0.9.2/colrev/qm/checkers/html_chars.py
--rw-r--r--   0        0        0     1761 2023-07-24 05:33:42.631499 colrev-0.9.2/colrev/qm/checkers/identical_values_between_title_and_container.py
--rw-r--r--   0        0        0     1543 2023-07-24 05:33:42.631499 colrev-0.9.2/colrev/qm/checkers/incomplete_field.py
--rw-r--r--   0        0        0     1596 2023-07-24 05:33:42.631499 colrev-0.9.2/colrev/qm/checkers/inconsistent_content.py
--rw-r--r--   0        0        0     3083 2023-07-24 05:33:42.631499 colrev-0.9.2/colrev/qm/checkers/inconsistent_with_doi_metadata.py
--rw-r--r--   0        0        0     1957 2023-07-24 05:33:42.631499 colrev-0.9.2/colrev/qm/checkers/inconsistent_with_entrytype.py
--rw-r--r--   0        0        0     2363 2023-07-24 05:33:42.631499 colrev-0.9.2/colrev/qm/checkers/inconsistent_with_url_metadata.py
--rw-r--r--   0        0        0     1189 2023-07-24 05:33:42.631499 colrev-0.9.2/colrev/qm/checkers/isbn_not_matching_pattern.py
--rw-r--r--   0        0        0     1279 2023-07-24 05:33:42.631499 colrev-0.9.2/colrev/qm/checkers/language_format_error.py
--rw-r--r--   0        0        0     1130 2023-07-24 05:33:42.631499 colrev-0.9.2/colrev/qm/checkers/language_unknown.py
--rw-r--r--   0        0        0    11894 2023-07-24 05:33:42.631499 colrev-0.9.2/colrev/qm/checkers/missing_field.py
--rw-r--r--   0        0        0     1703 2023-07-24 05:33:42.631499 colrev-0.9.2/colrev/qm/checkers/mostly_all_caps.py
--rw-r--r--   0        0        0     1211 2023-07-24 05:33:42.631499 colrev-0.9.2/colrev/qm/checkers/name_abbreviated.py
--rw-r--r--   0        0        0     2392 2023-07-24 05:33:42.631499 colrev-0.9.2/colrev/qm/checkers/name_format_separators.py
--rw-r--r--   0        0        0     1379 2023-07-24 05:33:42.631499 colrev-0.9.2/colrev/qm/checkers/name_format_titles.py
--rw-r--r--   0        0        0     1243 2023-07-24 05:33:42.631499 colrev-0.9.2/colrev/qm/checkers/page_range.py
--rw-r--r--   0        0        0     1754 2023-07-24 05:33:42.631499 colrev-0.9.2/colrev/qm/checkers/record_not_in_toc.py
--rw-r--r--   0        0        0     1231 2023-07-24 05:33:42.631499 colrev-0.9.2/colrev/qm/checkers/thesis_with_multiple_authors.py
--rw-r--r--   0        0        0     1018 2023-07-24 05:33:42.635499 colrev-0.9.2/colrev/qm/checkers/year_format.py
--rw-r--r--   0        0        0     7096 2023-07-24 05:33:42.635499 colrev-0.9.2/colrev/qm/colrev_id.py
--rw-r--r--   0        0        0     1493 2023-07-24 05:33:42.635499 colrev-0.9.2/colrev/qm/colrev_pdf_id.py
--rw-r--r--   0        0        0     1722 2023-07-24 05:33:42.635499 colrev-0.9.2/colrev/qm/quality_model.py
--rw-r--r--   0        0        0     2967 2023-07-24 05:33:42.635499 colrev-0.9.2/colrev/qm/readme.md
--rw-r--r--   0        0        0      104 2023-07-24 05:33:42.635499 colrev-0.9.2/colrev/readme.md
--rw-r--r--   0        0        0    91568 2023-07-24 05:33:42.635499 colrev-0.9.2/colrev/record.py
--rw-r--r--   0        0        0    26329 2023-07-24 05:33:42.635499 colrev-0.9.2/colrev/review_manager.py
--rw-r--r--   0        0        0    11725 2023-07-24 05:33:42.635499 colrev-0.9.2/colrev/service.py
--rw-r--r--   0        0        0    19349 2023-07-24 05:33:42.635499 colrev-0.9.2/colrev/settings.py
--rw-r--r--   0        0        0     1820 2023-07-24 05:33:42.635499 colrev-0.9.2/colrev/template/custom_scripts/custom_data_script.py
--rw-r--r--   0        0        0     1095 2023-07-24 05:33:42.635499 colrev-0.9.2/colrev/template/custom_scripts/custom_pdf_get_script.py
--rw-r--r--   0        0        0     1365 2023-07-24 05:33:42.635499 colrev-0.9.2/colrev/template/custom_scripts/custom_pdf_prep_script.py
--rw-r--r--   0        0        0     1314 2023-07-24 05:33:42.635499 colrev-0.9.2/colrev/template/custom_scripts/custom_prep_script.py
--rw-r--r--   0        0        0     1829 2023-07-24 05:33:42.635499 colrev-0.9.2/colrev/template/custom_scripts/custom_prescreen_script.py
--rw-r--r--   0        0        0     2345 2023-07-24 05:33:42.635499 colrev-0.9.2/colrev/template/custom_scripts/custom_screen_script.py
--rw-r--r--   0        0        0     3239 2023-07-24 05:33:42.635499 colrev-0.9.2/colrev/template/custom_scripts/custom_search_source_script.py
--rw-r--r--   0        0        0    15707 2023-07-24 05:33:42.635499 colrev-0.9.2/colrev/template/example/30_example_records.bib
--rw-r--r--   0        0        0      143 2023-07-24 05:33:42.635499 colrev-0.9.2/colrev/template/github_pages/README.md
--rw-r--r--   0        0        0      155 2023-07-24 05:33:42.635499 colrev-0.9.2/colrev/template/github_pages/_config.yml
--rw-r--r--   0        0        0       73 2023-07-24 05:33:42.635499 colrev-0.9.2/colrev/template/github_pages/about.md
--rw-r--r--   0        0        0     4953 2023-07-24 05:33:42.635499 colrev-0.9.2/colrev/template/github_pages/index.html
--rw-r--r--   0        0        0      185 2023-07-24 05:33:42.635499 colrev-0.9.2/colrev/template/github_pages/pre-commit-config.yaml
--rw-r--r--   0        0        0    18650 2023-07-24 05:33:42.635499 colrev-0.9.2/colrev/template/init/LICENSE-CC-BY-4.0.txt
--rw-r--r--   0        0        0     1770 2023-07-24 05:33:42.635499 colrev-0.9.2/colrev/template/init/colrev_update.yml
--rw-r--r--   0        0        0     1555 2023-07-24 05:33:42.635499 colrev-0.9.2/colrev/template/init/colrev_update_curation.yml
--rw-r--r--   0        0        0       54 2023-07-24 05:33:42.635499 colrev-0.9.2/colrev/template/init/gitattributes
--rw-r--r--   0        0        0       85 2023-07-24 05:33:42.635499 colrev-0.9.2/colrev/template/init/markdownlint.yaml
--rw-r--r--   0        0        0      936 2023-07-24 05:33:42.635499 colrev-0.9.2/colrev/template/init/pre-commit-config.yaml
--rw-r--r--   0        0        0      480 2023-07-24 05:33:42.635499 colrev-0.9.2/colrev/template/init/pre-commit.yml
--rw-r--r--   0        0        0      276 2023-07-24 05:33:42.635499 colrev-0.9.2/colrev/template/init/readme.md
--rw-r--r--   0        0        0     5023 2023-07-24 05:33:42.635499 colrev-0.9.2/colrev/template/init/settings.json
--rw-r--r--   0        0        0      930 2023-07-24 05:33:42.635499 colrev-0.9.2/colrev/template/ops/commit_report_details.txt
--rw-r--r--   0        0        0      271 2023-07-24 05:33:42.635499 colrev-0.9.2/colrev/template/ops/commit_report_header.txt
--rw-r--r--   0        0        0      352 2023-07-24 05:33:42.635499 colrev-0.9.2/colrev/template/ops/complementary_material_keywords.txt
--rw-r--r--   0        0        0       25 2023-07-24 05:33:42.635499 colrev-0.9.2/colrev/template/ops/complementary_material_prefixes.txt
--rw-r--r--   0        0        0      318 2023-07-24 05:33:42.635499 colrev-0.9.2/colrev/template/ops/complementary_material_strings.txt
--rw-r--r--   0        0        0   190600 2023-07-24 05:33:42.635499 colrev-0.9.2/colrev/template/ops/journal_rankings.csv
--rw-r--r--   0        0        0      494 2023-07-24 05:33:42.635499 colrev-0.9.2/colrev/template/ops/masterdata_curations.csv
--rw-r--r--   0        0        0      462 2023-07-24 05:33:42.635499 colrev-0.9.2/colrev/template/ops/pdf_get_man_mail.txt
--rw-r--r--   0        0        0     2729 2023-07-24 05:33:42.635499 colrev-0.9.2/colrev/template/ops/prep_man_curation.ipynb
--rw-r--r--   0        0        0     3830 2023-07-24 05:33:42.635499 colrev-0.9.2/colrev/template/ops/status.txt
--rw-r--r--   0        0        0    48591 2023-07-24 05:33:42.635499 colrev-0.9.2/colrev/template/package_endpoints.json
--rw-r--r--   0        0        0    12566 2023-07-24 05:33:42.635499 colrev-0.9.2/colrev/template/package_status.json
--rw-r--r--   0        0        0      227 2023-07-24 05:33:42.635499 colrev-0.9.2/colrev/template/packages.json
--rw-r--r--   0        0        0    25233 2023-07-24 05:33:42.635499 colrev-0.9.2/colrev/template/paper_md/APA-7.docx
--rw-r--r--   0        0        0      381 2023-07-24 05:33:42.635499 colrev-0.9.2/colrev/template/paper_md/non_sample_references.bib
--rw-r--r--   0        0        0      673 2023-07-24 05:33:42.635499 colrev-0.9.2/colrev/template/paper_md/paper.md
--rw-r--r--   0        0        0     4935 2023-07-24 05:33:42.635499 colrev-0.9.2/colrev/template/prisma/PRISMA.csv
--rw-r--r--   0        0        0     5108 2023-07-24 05:33:42.639500 colrev-0.9.2/colrev/template/prisma/PRISMA_original.csv
--rw-r--r--   0        0        0      872 2023-07-24 05:33:42.639500 colrev-0.9.2/colrev/template/prisma/prisma-refs.bib
--rw-r--r--   0        0        0      262 2023-07-24 05:33:42.639500 colrev-0.9.2/colrev/template/prisma/prisma_text.md
--rw-r--r--   0        0        0     1506 2023-07-24 05:33:42.639500 colrev-0.9.2/colrev/template/review_type/curated_masterdata/curations_github_colrev_update.yml
--rw-r--r--   0        0        0      460 2023-07-24 05:33:42.639500 colrev-0.9.2/colrev/template/review_type/curated_masterdata/readme.md
--rw-r--r--   0        0        0      586 2023-07-24 05:33:42.639500 colrev-0.9.2/colrev/template/review_type/meta_analysis/paper.md
--rw-r--r--   0        0        0      104 2023-07-24 05:33:42.639500 colrev-0.9.2/colrev/ui_cli/__init__.py
--rw-r--r--   0        0        0     7665 2023-07-24 05:33:42.639500 colrev-0.9.2/colrev/ui_cli/add_packages.py
--rw-r--r--   0        0        0    81725 2023-07-24 05:33:42.639500 colrev-0.9.2/colrev/ui_cli/cli.py
--rw-r--r--   0        0        0      146 2023-07-24 05:33:42.639500 colrev-0.9.2/colrev/ui_cli/cli_colors.py
--rw-r--r--   0        0        0     3729 2023-07-24 05:33:42.639500 colrev-0.9.2/colrev/ui_cli/cli_load.py
--rw-r--r--   0        0        0     9349 2023-07-24 05:33:42.639500 colrev-0.9.2/colrev/ui_cli/cli_status_printer.py
--rw-r--r--   0        0        0     7346 2023-07-24 05:33:42.639500 colrev-0.9.2/colrev/ui_cli/cli_validation.py
--rw-r--r--   0        0        0     2757 2023-07-24 05:33:42.639500 colrev-0.9.2/colrev/ui_cli/dedupe_errors.py
--rw-r--r--   0        0        0     2089 2023-07-24 05:33:42.639500 colrev-0.9.2/colrev/ui_cli/search_backward_selective.py
--rw-r--r--   0        0        0      975 2023-07-24 05:33:42.639500 colrev-0.9.2/colrev/ui_cli/setup_custom_scripts.py
--rw-r--r--   0        0        0     2853 2023-07-24 05:33:42.639500 colrev-0.9.2/colrev/ui_cli/show_printer.py
--rw-r--r--   0        0        0     3050 2023-07-24 05:33:42.675502 colrev-0.9.2/pyproject.toml
--rw-r--r--   0        0        0    15193 1970-01-01 00:00:00.000000 colrev-0.9.2/PKG-INFO
+-rw-r--r--   0        0        0    10559 2023-10-01 19:11:21.811874 colrev-0.9.3/CHANGELOG.md
+-rw-r--r--   0        0        0     4405 2023-10-01 19:11:21.811874 colrev-0.9.3/CONTRIBUTING.md
+-rw-r--r--   0        0        0     1070 2023-10-01 19:11:21.811874 colrev-0.9.3/LICENSE
+-rw-r--r--   0        0        0    12200 2023-10-01 19:11:21.811874 colrev-0.9.3/README.md
+-rw-r--r--   0        0        0    17710 2023-10-01 19:11:21.811874 colrev-0.9.3/colrev/.colrev_endpoints.json
+-rw-r--r--   0        0        0      314 2023-10-01 19:11:21.811874 colrev-0.9.3/colrev/__init__.py
+-rw-r--r--   0        0        0      128 2023-10-01 19:11:21.811874 colrev-0.9.3/colrev/__version__.py
+-rw-r--r--   0        0        0    31642 2023-10-01 19:11:21.811874 colrev-0.9.3/colrev/advisor.py
+-rw-r--r--   0        0        0    31768 2023-10-01 19:11:21.811874 colrev-0.9.3/colrev/checker.py
+-rw-r--r--   0        0        0    43849 2023-10-01 19:11:21.811874 colrev-0.9.3/colrev/dataset.py
+-rw-r--r--   0        0        0      105 2023-10-01 19:11:21.811874 colrev-0.9.3/colrev/env/__init__.py
+-rw-r--r--   0        0        0    15226 2023-10-01 19:11:21.811874 colrev-0.9.3/colrev/env/environment_manager.py
+-rw-r--r--   0        0        0     2151 2023-10-01 19:11:21.811874 colrev-0.9.3/colrev/env/grobid_service.py
+-rw-r--r--   0        0        0     3657 2023-10-01 19:11:21.811874 colrev-0.9.3/colrev/env/language_service.py
+-rw-r--r--   0        0        0    54628 2023-10-01 19:11:21.811874 colrev-0.9.3/colrev/env/local_index.py
+-rw-r--r--   0        0        0    42790 2023-10-01 19:11:21.811874 colrev-0.9.3/colrev/env/package_manager.py
+-rw-r--r--   0        0        0     2270 2023-10-01 19:11:21.811874 colrev-0.9.3/colrev/env/resources.py
+-rw-r--r--   0        0        0     3933 2023-10-01 19:11:21.811874 colrev-0.9.3/colrev/env/screenshot_service.py
+-rw-r--r--   0        0        0    34818 2023-10-01 19:11:21.811874 colrev-0.9.3/colrev/env/tei_parser.py
+-rw-r--r--   0        0        0     6161 2023-10-01 19:11:21.811874 colrev-0.9.3/colrev/env/utils.py
+-rw-r--r--   0        0        0     2518 2023-10-01 19:11:21.811874 colrev-0.9.3/colrev/env/zotero_translation_service.py
+-rw-r--r--   0        0        0    18823 2023-10-01 19:11:21.815874 colrev-0.9.3/colrev/exceptions.py
+-rw-r--r--   0        0        0      151 2023-10-01 19:11:21.815874 colrev-0.9.3/colrev/exit_codes.py
+-rw-r--r--   0        0        0       86 2023-10-01 19:11:21.815874 colrev-0.9.3/colrev/hooks/__init__.py
+-rwxr-xr-x   0        0        0      352 2023-10-01 19:11:21.815874 colrev-0.9.3/colrev/hooks/check.py
+-rwxr-xr-x   0        0        0      372 2023-10-01 19:11:21.815874 colrev-0.9.3/colrev/hooks/format.py
+-rwxr-xr-x   0        0        0      468 2023-10-01 19:11:21.815874 colrev-0.9.3/colrev/hooks/report.py
+-rwxr-xr-x   0        0        0      360 2023-10-01 19:11:21.815874 colrev-0.9.3/colrev/hooks/share.py
+-rwxr-xr-x   0        0        0     1233 2023-10-01 19:11:21.815874 colrev-0.9.3/colrev/hooks/update.py
+-rw-r--r--   0        0        0     1842 2023-10-01 19:11:21.815874 colrev-0.9.3/colrev/linter/colrev_lint.py
+-rw-r--r--   0        0        0      310 2023-10-01 19:11:21.815874 colrev-0.9.3/colrev/linter/readme.md
+-rw-r--r--   0        0        0     3082 2023-10-01 19:11:21.815874 colrev-0.9.3/colrev/logger.py
+-rw-r--r--   0        0        0     8951 2023-10-01 19:11:21.815874 colrev-0.9.3/colrev/operation.py
+-rw-r--r--   0        0        0       92 2023-10-01 19:11:21.815874 colrev-0.9.3/colrev/ops/__init__.py
+-rw-r--r--   0        0        0    42838 2023-10-01 19:11:21.815874 colrev-0.9.3/colrev/ops/assets/favicon.ico
+-rw-r--r--   0        0        0    52916 2023-10-01 19:11:21.815874 colrev-0.9.3/colrev/ops/assets/faviconWhiteBg.ico
+-rw-r--r--   0        0        0     2222 2023-10-01 19:11:21.815874 colrev-0.9.3/colrev/ops/assets/style.css
+-rw-r--r--   0        0        0      119 2023-10-01 19:11:21.815874 colrev-0.9.3/colrev/ops/built_in/__init__.py
+-rw-r--r--   0        0        0      135 2023-10-01 19:11:21.815874 colrev-0.9.3/colrev/ops/built_in/data/__init__.py
+-rw-r--r--   0        0        0      594 2023-10-01 19:11:21.815874 colrev-0.9.3/colrev/ops/built_in/data/bibliography_export.md
+-rw-r--r--   0        0        0     9597 2023-10-01 19:11:21.815874 colrev-0.9.3/colrev/ops/built_in/data/bibliography_export.py
+-rw-r--r--   0        0        0     1084 2023-10-01 19:11:21.815874 colrev-0.9.3/colrev/ops/built_in/data/colrev_curation.md
+-rw-r--r--   0        0        0    15086 2023-10-01 19:11:21.815874 colrev-0.9.3/colrev/ops/built_in/data/colrev_curation.py
+-rw-r--r--   0        0        0      155 2023-10-01 19:11:21.815874 colrev-0.9.3/colrev/ops/built_in/data/github_pages.md
+-rw-r--r--   0        0        0    13528 2023-10-01 19:11:21.815874 colrev-0.9.3/colrev/ops/built_in/data/github_pages.py
+-rw-r--r--   0        0        0      155 2023-10-01 19:11:21.815874 colrev-0.9.3/colrev/ops/built_in/data/obsidian.md
+-rw-r--r--   0        0        0     9555 2023-10-01 19:11:21.815874 colrev-0.9.3/colrev/ops/built_in/data/obsidian.py
+-rw-r--r--   0        0        0     1142 2023-10-01 19:11:21.815874 colrev-0.9.3/colrev/ops/built_in/data/paper_md.md
+-rw-r--r--   0        0        0    32108 2023-10-01 19:11:21.815874 colrev-0.9.3/colrev/ops/built_in/data/paper_md.py
+-rw-r--r--   0        0        0      155 2023-10-01 19:11:21.815874 colrev-0.9.3/colrev/ops/built_in/data/prisma.md
+-rw-r--r--   0        0        0     9307 2023-10-01 19:11:21.815874 colrev-0.9.3/colrev/ops/built_in/data/prisma.py
+-rw-r--r--   0        0        0      155 2023-10-01 19:11:21.815874 colrev-0.9.3/colrev/ops/built_in/data/structured.md
+-rw-r--r--   0        0        0    11282 2023-10-01 19:11:21.815874 colrev-0.9.3/colrev/ops/built_in/data/structured.py
+-rw-r--r--   0        0        0      126 2023-10-01 19:11:21.815874 colrev-0.9.3/colrev/ops/built_in/dedupe/__init__.py
+-rw-r--r--   0        0        0      159 2023-10-01 19:11:21.815874 colrev-0.9.3/colrev/ops/built_in/dedupe/active_learning_dedup_io.md
+-rw-r--r--   0        0        0    42748 2023-10-01 19:11:21.815874 colrev-0.9.3/colrev/ops/built_in/dedupe/active_learning_dedup_io.py
+-rw-r--r--   0        0        0      159 2023-10-01 19:11:21.815874 colrev-0.9.3/colrev/ops/built_in/dedupe/curation_dedupe.md
+-rw-r--r--   0        0        0    25476 2023-10-01 19:11:21.815874 colrev-0.9.3/colrev/ops/built_in/dedupe/curation_dedupe.py
+-rw-r--r--   0        0        0      159 2023-10-01 19:11:21.815874 colrev-0.9.3/colrev/ops/built_in/dedupe/curation_missing_dedupe.md
+-rw-r--r--   0        0        0    14391 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/dedupe/curation_missing_dedupe.py
+-rw-r--r--   0        0        0      159 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/dedupe/simple_dedupe.md
+-rw-r--r--   0        0        0    14251 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/dedupe/simple_dedupe.py
+-rw-r--r--   0        0        0     1961 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/dedupe/utils.py
+-rw-r--r--   0        0        0      127 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/pdf_get/__init__.py
+-rw-r--r--   0        0        0      159 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/pdf_get/local_index_pdf_get.md
+-rw-r--r--   0        0        0     2483 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/pdf_get/local_index_pdf_get.py
+-rw-r--r--   0        0        0      432 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/pdf_get/unpaywall.md
+-rw-r--r--   0        0        0     5280 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/pdf_get/unpaywall.py
+-rw-r--r--   0        0        0      159 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/pdf_get/website_screenshot.md
+-rw-r--r--   0        0        0     1785 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/pdf_get/website_screenshot.py
+-rw-r--r--   0        0        0      131 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/pdf_get_man/__init__.py
+-rw-r--r--   0        0        0      165 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/pdf_get_man/pdf_get_man_cli.md
+-rw-r--r--   0        0        0    12016 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/pdf_get_man/pdf_get_man_cli.py
+-rw-r--r--   0        0        0      128 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/pdf_prep/__init__.py
+-rw-r--r--   0        0        0      161 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/pdf_prep/check_ocr.md
+-rw-r--r--   0        0        0     4403 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/pdf_prep/check_ocr.py
+-rw-r--r--   0        0        0      161 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/pdf_prep/completeness_validation.md
+-rw-r--r--   0        0        0     6864 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/pdf_prep/completeness_validation.py
+-rw-r--r--   0        0        0      161 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/pdf_prep/cover_page.md
+-rw-r--r--   0        0        0     7848 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/pdf_prep/cover_page.py
+-rw-r--r--   0        0        0      161 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/pdf_prep/last_page.md
+-rw-r--r--   0        0        0     4888 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/pdf_prep/last_page.py
+-rw-r--r--   0        0        0      161 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/pdf_prep/metadata_validation.md
+-rw-r--r--   0        0        0     6435 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/pdf_prep/metadata_validation.py
+-rw-r--r--   0        0        0      161 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/pdf_prep/tei_prep.md
+-rw-r--r--   0        0        0     2194 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/pdf_prep/tei_prep.py
+-rw-r--r--   0        0        0      132 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/pdf_prep_man/__init__.py
+-rw-r--r--   0        0        0      167 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/pdf_prep_man/pdf_prep_man_cli.md
+-rw-r--r--   0        0        0    10202 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/pdf_prep_man/pdf_prep_man_cli.py
+-rw-r--r--   0        0        0      124 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/prep/__init__.py
+-rw-r--r--   0        0        0     1393 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/prep/add_journal_ranking.md
+-rw-r--r--   0        0        0     1983 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/prep/add_journal_ranking.py
+-rw-r--r--   0        0        0      155 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/prep/bibtex_crossref_resolution.md
+-rw-r--r--   0        0        0     2740 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/prep/bibtex_crossref_resolution.py
+-rw-r--r--   0        0        0      155 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/prep/citeas_prep.md
+-rw-r--r--   0        0        0     4601 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/prep/citeas_prep.py
+-rw-r--r--   0        0        0      155 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/prep/crossref_metadata_prep.md
+-rw-r--r--   0        0        0     2483 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/prep/crossref_metadata_prep.py
+-rw-r--r--   0        0        0      155 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/prep/curation_prep.md
+-rw-r--r--   0        0        0     2161 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/prep/curation_prep.py
+-rw-r--r--   0        0        0      155 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/prep/dblp_metadata_prep.md
+-rw-r--r--   0        0        0     2353 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/prep/dblp_metadata_prep.py
+-rw-r--r--   0        0        0      155 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/prep/doi_from_urls_prep.md
+-rw-r--r--   0        0        0     4110 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/prep/doi_from_urls_prep.py
+-rw-r--r--   0        0        0      155 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/prep/doi_metadata_prep.md
+-rw-r--r--   0        0        0     1961 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/prep/doi_metadata_prep.py
+-rw-r--r--   0        0        0      155 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/prep/europe_pmc_prep.md
+-rw-r--r--   0        0        0     1701 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/prep/europe_pmc_prep.py
+-rw-r--r--   0        0        0      155 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/prep/exclude_collections.md
+-rw-r--r--   0        0        0     1513 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/prep/exclude_collections.py
+-rw-r--r--   0        0        0      155 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/prep/exclude_complementary_materials.md
+-rw-r--r--   0        0        0     2671 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/prep/exclude_complementary_materials.py
+-rw-r--r--   0        0        0      155 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/prep/exclude_languages.md
+-rw-r--r--   0        0        0     6553 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/prep/exclude_languages.py
+-rw-r--r--   0        0        0      155 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/prep/exclude_non_latin_alphabets.md
+-rw-r--r--   0        0        0     2384 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/prep/exclude_non_latin_alphabets.py
+-rw-r--r--   0        0        0      155 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/prep/general_polish.md
+-rw-r--r--   0        0        0     2076 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/prep/general_polish.py
+-rw-r--r--   0        0        0      155 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/prep/local_index_prep.md
+-rw-r--r--   0        0        0     2515 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/prep/local_index_prep.py
+-rw-r--r--   0        0        0      145 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/prep/open_alex_metadata_prep.md
+-rw-r--r--   0        0        0     2310 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/prep/open_alex_metadata_prep.py
+-rw-r--r--   0        0        0      155 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/prep/open_library_prep.md
+-rw-r--r--   0        0        0     2058 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/prep/open_library_prep.py
+-rw-r--r--   0        0        0      155 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/prep/pubmed_metadata_prep.md
+-rw-r--r--   0        0        0     2318 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/prep/pubmed_metadata_prep.py
+-rw-r--r--   0        0        0      155 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/prep/remove_broken_ids.md
+-rw-r--r--   0        0        0     2121 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/prep/remove_broken_ids.py
+-rw-r--r--   0        0        0      155 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/prep/remove_error500_urls.md
+-rw-r--r--   0        0        0     2308 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/prep/remove_error500_urls.py
+-rw-r--r--   0        0        0      155 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/prep/semantic_scholar_prep.md
+-rw-r--r--   0        0        0     7024 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/prep/semantic_scholar_prep.py
+-rw-r--r--   0        0        0      155 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/prep/source_specific_prep.md
+-rw-r--r--   0        0        0     2942 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/prep/source_specific_prep.py
+-rw-r--r--   0        0        0      155 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/prep/update_masterdata_status.md
+-rw-r--r--   0        0        0     1410 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/prep/update_masterdata_status.py
+-rw-r--r--   0        0        0     1106 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/prep/utils.py
+-rw-r--r--   0        0        0      155 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/prep/year_vol_iss_prep.md
+-rw-r--r--   0        0        0     7724 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/prep/year_vol_iss_prep.py
+-rw-r--r--   0        0        0      128 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/prep_man/__init__.py
+-rw-r--r--   0        0        0      161 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/prep_man/curation_jupyter_prep_man.md
+-rw-r--r--   0        0        0     1882 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/prep_man/curation_jupyter_prep_man.py
+-rw-r--r--   0        0        0     1368 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/prep_man/prep_man_export.md
+-rw-r--r--   0        0        0    15111 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/prep_man/prep_man_export.py
+-rw-r--r--   0        0        0      129 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/prescreen/__init__.py
+-rw-r--r--   0        0        0      165 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/prescreen/conditional_prescreen.md
+-rw-r--r--   0        0        0     2033 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/prescreen/conditional_prescreen.py
+-rw-r--r--   0        0        0      165 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/prescreen/prescreen_cli.md
+-rw-r--r--   0        0        0     5047 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/prescreen/prescreen_cli.py
+-rw-r--r--   0        0        0      165 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/prescreen/prescreen_table.md
+-rw-r--r--   0        0        0     9643 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/prescreen/prescreen_table.py
+-rw-r--r--   0        0        0     1263 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/prescreen/scope_prescreen.md
+-rw-r--r--   0        0        0    10971 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/prescreen/scope_prescreen.py
+-rw-r--r--   0        0        0      132 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/review_types/__init__.py
+-rw-r--r--   0        0        0      472 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/review_types/blank.md
+-rw-r--r--   0        0        0     1754 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/review_types/blank.py
+-rw-r--r--   0        0        0      509 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/review_types/conceptual_review.md
+-rw-r--r--   0        0        0     1258 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/review_types/conceptual_review.py
+-rw-r--r--   0        0        0      507 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/review_types/critical_review.md
+-rw-r--r--   0        0        0     1311 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/review_types/critical_review.py
+-rw-r--r--   0        0        0     1141 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/review_types/curated_masterdata.md
+-rw-r--r--   0        0        0     4667 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/review_types/curated_masterdata.py
+-rw-r--r--   0        0        0      510 2023-10-01 19:11:21.819875 colrev-0.9.3/colrev/ops/built_in/review_types/descriptive_review.md
+-rw-r--r--   0        0        0     1325 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/review_types/descriptive_review.py
+-rw-r--r--   0        0        0      509 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/review_types/literature_review.md
+-rw-r--r--   0        0        0     1274 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/review_types/literature_review.py
+-rw-r--r--   0        0        0      704 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/review_types/meta_analysis.md
+-rw-r--r--   0        0        0     1807 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/review_types/meta_analysis.py
+-rw-r--r--   0        0        0      508 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/review_types/narrative_review.md
+-rw-r--r--   0        0        0     1253 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/review_types/narrative_review.py
+-rw-r--r--   0        0        0      521 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/review_types/qualitative_systematic_review.md
+-rw-r--r--   0        0        0     1886 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/review_types/qualitative_systematic_review.py
+-rw-r--r--   0        0        0      633 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/review_types/scientometric.md
+-rw-r--r--   0        0        0     1340 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/review_types/scientometric.py
+-rw-r--r--   0        0        0      506 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/review_types/scoping_review.md
+-rw-r--r--   0        0        0     1445 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/review_types/scoping_review.py
+-rw-r--r--   0        0        0      510 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/review_types/theoretical_review.md
+-rw-r--r--   0        0        0     1404 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/review_types/theoretical_review.py
+-rw-r--r--   0        0        0      126 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/screen/__init__.py
+-rw-r--r--   0        0        0      159 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/screen/screen_cli.md
+-rw-r--r--   0        0        0     9714 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/screen/screen_cli.py
+-rw-r--r--   0        0        0      159 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/screen/screen_table.md
+-rw-r--r--   0        0        0     8839 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/screen/screen_table.py
+-rw-r--r--   0        0        0     2642 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/screen/utils.py
+-rw-r--r--   0        0        0      133 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/search_sources/__init__.py
+-rw-r--r--   0        0        0      496 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/search_sources/abi_inform_proquest.md
+-rw-r--r--   0        0        0     4957 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/search_sources/abi_inform_proquest.py
+-rw-r--r--   0        0        0      447 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/search_sources/acm_digital_library.md
+-rw-r--r--   0        0        0     3385 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/search_sources/acm_digital_library.py
+-rw-r--r--   0        0        0      915 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/search_sources/aisel.md
+-rw-r--r--   0        0        0    18831 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/search_sources/aisel.py
+-rw-r--r--   0        0        0      386 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/search_sources/colrev_project.md
+-rw-r--r--   0        0        0     9491 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/search_sources/colrev_project.py
+-rw-r--r--   0        0        0     1109 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/search_sources/crossref.md
+-rw-r--r--   0        0        0    42656 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/search_sources/crossref.py
+-rw-r--r--   0        0        0      600 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/search_sources/dblp.md
+-rw-r--r--   0        0        0    27330 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/search_sources/dblp.py
+-rw-r--r--   0        0        0     6348 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/search_sources/doi_org.py
+-rw-r--r--   0        0        0      664 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/search_sources/ebsco_host.md
+-rw-r--r--   0        0        0     3411 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/search_sources/ebsco_host.py
+-rw-r--r--   0        0        0     1787 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/search_sources/eric.md
+-rw-r--r--   0        0        0    10626 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/search_sources/eric.py
+-rw-r--r--   0        0        0      598 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/search_sources/europe_pmc.md
+-rw-r--r--   0        0        0    20881 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/search_sources/europe_pmc.py
+-rw-r--r--   0        0        0      562 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/search_sources/google_scholar.md
+-rw-r--r--   0        0        0     4123 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/search_sources/google_scholar.py
+-rw-r--r--   0        0        0     1826 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/search_sources/ieee.md
+-rw-r--r--   0        0        0    11252 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/search_sources/ieee.py
+-rw-r--r--   0        0        0    13215 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/search_sources/ieee_api.py
+-rw-r--r--   0        0        0      427 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/search_sources/jstor.md
+-rw-r--r--   0        0        0     3441 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/search_sources/jstor.py
+-rw-r--r--   0        0        0      380 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/search_sources/local_index.md
+-rw-r--r--   0        0        0    34712 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/search_sources/local_index.py
+-rw-r--r--   0        0        0      596 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/search_sources/open_alex.md
+-rw-r--r--   0        0        0    11993 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/search_sources/open_alex.py
+-rw-r--r--   0        0        0      439 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/search_sources/open_citations_forward_search.md
+-rw-r--r--   0        0        0     9094 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/search_sources/open_citations_forward_search.py
+-rw-r--r--   0        0        0      401 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/search_sources/open_library.md
+-rw-r--r--   0        0        0    11380 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/search_sources/open_library.py
+-rw-r--r--   0        0        0     1053 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/search_sources/pdf_backward_search.md
+-rw-r--r--   0        0        0    16059 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/search_sources/pdf_backward_search.py
+-rw-r--r--   0        0        0      406 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/search_sources/pdfs_dir.md
+-rw-r--r--   0        0        0    32836 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/search_sources/pdfs_dir.py
+-rw-r--r--   0        0        0      449 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/search_sources/psycinfo.md
+-rw-r--r--   0        0        0     4675 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/search_sources/psycinfo.py
+-rw-r--r--   0        0        0      666 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/search_sources/pubmed.md
+-rw-r--r--   0        0        0    28148 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/search_sources/pubmed.py
+-rw-r--r--   0        0        0      428 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/search_sources/scopus.md
+-rw-r--r--   0        0        0     5331 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/search_sources/scopus.py
+-rw-r--r--   0        0        0      445 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/search_sources/springer_link.md
+-rw-r--r--   0        0        0     5923 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/search_sources/springer_link.py
+-rw-r--r--   0        0        0      921 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/search_sources/synergy_datasets.md
+-rw-r--r--   0        0        0    12915 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/search_sources/synergy_datasets.py
+-rw-r--r--   0        0        0      452 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/search_sources/taylor_and_francis.md
+-rw-r--r--   0        0        0     3549 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/search_sources/taylor_and_francis.py
+-rw-r--r--   0        0        0      473 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/search_sources/trid.md
+-rw-r--r--   0        0        0     3767 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/search_sources/trid.py
+-rw-r--r--   0        0        0      463 2023-10-01 19:11:21.823875 colrev-0.9.3/colrev/ops/built_in/search_sources/unknown_source.md
+-rw-r--r--   0        0        0    18183 2023-10-01 19:11:21.827875 colrev-0.9.3/colrev/ops/built_in/search_sources/unknown_source.py
+-rw-r--r--   0        0        0     6013 2023-10-01 19:11:21.827875 colrev-0.9.3/colrev/ops/built_in/search_sources/utils.py
+-rw-r--r--   0        0        0      340 2023-10-01 19:11:21.827875 colrev-0.9.3/colrev/ops/built_in/search_sources/video_dir.md
+-rw-r--r--   0        0        0     5795 2023-10-01 19:11:21.827875 colrev-0.9.3/colrev/ops/built_in/search_sources/video_dir.py
+-rw-r--r--   0        0        0      453 2023-10-01 19:11:21.827875 colrev-0.9.3/colrev/ops/built_in/search_sources/web_of_science.md
+-rw-r--r--   0        0        0     3971 2023-10-01 19:11:21.827875 colrev-0.9.3/colrev/ops/built_in/search_sources/web_of_science.py
+-rw-r--r--   0        0        0     6393 2023-10-01 19:11:21.827875 colrev-0.9.3/colrev/ops/built_in/search_sources/website.py
+-rw-r--r--   0        0        0      553 2023-10-01 19:11:21.827875 colrev-0.9.3/colrev/ops/built_in/search_sources/wiley.md
+-rw-r--r--   0        0        0     3259 2023-10-01 19:11:21.827875 colrev-0.9.3/colrev/ops/built_in/search_sources/wiley.py
+-rw-r--r--   0        0        0     1434 2023-10-01 19:11:21.827875 colrev-0.9.3/colrev/ops/clone.py
+-rw-r--r--   0        0        0     9485 2023-10-01 19:11:21.827875 colrev-0.9.3/colrev/ops/commit.py
+-rw-r--r--   0        0        0     7426 2023-10-01 19:11:21.827875 colrev-0.9.3/colrev/ops/correct.py
+-rw-r--r--   0        0        0     1181 2023-10-01 19:11:21.827875 colrev-0.9.3/colrev/ops/dashboard.py
+-rw-r--r--   0        0        0    14849 2023-10-01 19:11:21.827875 colrev-0.9.3/colrev/ops/data.py
+-rw-r--r--   0        0        0    36998 2023-10-01 19:11:21.827875 colrev-0.9.3/colrev/ops/dedupe.py
+-rw-r--r--   0        0        0     4753 2023-10-01 19:11:21.827875 colrev-0.9.3/colrev/ops/distribute.py
+-rw-r--r--   0        0        0    16771 2023-10-01 19:11:21.827875 colrev-0.9.3/colrev/ops/init.py
+-rw-r--r--   0        0        0    22105 2023-10-01 19:11:21.827875 colrev-0.9.3/colrev/ops/load.py
+-rw-r--r--   0        0        0     7729 2023-10-01 19:11:21.827875 colrev-0.9.3/colrev/ops/load_utils_bib.py
+-rw-r--r--   0        0        0     3377 2023-10-01 19:11:21.827875 colrev-0.9.3/colrev/ops/load_utils_enl.py
+-rw-r--r--   0        0        0     4797 2023-10-01 19:11:21.827875 colrev-0.9.3/colrev/ops/load_utils_formatter.py
+-rw-r--r--   0        0        0     2199 2023-10-01 19:11:21.827875 colrev-0.9.3/colrev/ops/load_utils_md.py
+-rw-r--r--   0        0        0     3446 2023-10-01 19:11:21.827875 colrev-0.9.3/colrev/ops/load_utils_nbib.py
+-rw-r--r--   0        0        0     7140 2023-10-01 19:11:21.827875 colrev-0.9.3/colrev/ops/load_utils_ris.py
+-rw-r--r--   0        0        0     7962 2023-10-01 19:11:21.827875 colrev-0.9.3/colrev/ops/load_utils_table.py
+-rw-r--r--   0        0        0     9434 2023-10-01 19:11:21.827875 colrev-0.9.3/colrev/ops/merge.py
+-rw-r--r--   0        0        0     2887 2023-10-01 19:11:21.827875 colrev-0.9.3/colrev/ops/pages/home.py
+-rw-r--r--   0        0        0     8944 2023-10-01 19:11:21.827875 colrev-0.9.3/colrev/ops/pages/synthesizedrecords.py
+-rw-r--r--   0        0        0    26024 2023-10-01 19:11:21.827875 colrev-0.9.3/colrev/ops/pdf_get.py
+-rw-r--r--   0        0        0     7998 2023-10-01 19:11:21.827875 colrev-0.9.3/colrev/ops/pdf_get_man.py
+-rw-r--r--   0        0        0    17845 2023-10-01 19:11:21.827875 colrev-0.9.3/colrev/ops/pdf_prep.py
+-rw-r--r--   0        0        0    13490 2023-10-01 19:11:21.827875 colrev-0.9.3/colrev/ops/pdf_prep_man.py
+-rw-r--r--   0        0        0    50881 2023-10-01 19:11:21.827875 colrev-0.9.3/colrev/ops/prep.py
+-rw-r--r--   0        0        0    11284 2023-10-01 19:11:21.827875 colrev-0.9.3/colrev/ops/prep_man.py
+-rw-r--r--   0        0        0    14957 2023-10-01 19:11:21.827875 colrev-0.9.3/colrev/ops/prescreen.py
+-rw-r--r--   0        0        0     1733 2023-10-01 19:11:21.827875 colrev-0.9.3/colrev/ops/pull.py
+-rw-r--r--   0        0        0     5753 2023-10-01 19:11:21.827875 colrev-0.9.3/colrev/ops/push.py
+-rw-r--r--   0        0        0     2272 2023-10-01 19:11:21.827875 colrev-0.9.3/colrev/ops/remove.py
+-rw-r--r--   0        0        0    17799 2023-10-01 19:11:21.827875 colrev-0.9.3/colrev/ops/repare.py
+-rw-r--r--   0        0        0     1088 2023-10-01 19:11:21.827875 colrev-0.9.3/colrev/ops/review_types.py
+-rw-r--r--   0        0        0    18921 2023-10-01 19:11:21.827875 colrev-0.9.3/colrev/ops/screen.py
+-rw-r--r--   0        0        0     8116 2023-10-01 19:11:21.827875 colrev-0.9.3/colrev/ops/search.py
+-rw-r--r--   0        0        0    16371 2023-10-01 19:11:21.827875 colrev-0.9.3/colrev/ops/search_feed.py
+-rw-r--r--   0        0        0     1612 2023-10-01 19:11:21.827875 colrev-0.9.3/colrev/ops/search_sources.py
+-rwxr-xr-x   0        0        0    22234 2023-10-01 19:11:21.827875 colrev-0.9.3/colrev/ops/status.py
+-rw-r--r--   0        0        0    10926 2023-10-01 19:11:21.827875 colrev-0.9.3/colrev/ops/sync.py
+-rw-r--r--   0        0        0     4299 2023-10-01 19:11:21.827875 colrev-0.9.3/colrev/ops/trace.py
+-rw-r--r--   0        0        0    20389 2023-10-01 19:11:21.827875 colrev-0.9.3/colrev/ops/upgrade.py
+-rw-r--r--   0        0        0    21920 2023-10-01 19:11:21.827875 colrev-0.9.3/colrev/ops/validate.py
+-rw-r--r--   0        0        0        0 2023-10-01 19:11:21.827875 colrev-0.9.3/colrev/py.typed
+-rw-r--r--   0        0        0      112 2023-10-01 19:11:21.827875 colrev-0.9.3/colrev/qm/__init__.py
+-rw-r--r--   0        0        0       91 2023-10-01 19:11:21.827875 colrev-0.9.3/colrev/qm/checkers/__init__.py
+-rw-r--r--   0        0        0     1152 2023-10-01 19:11:21.827875 colrev-0.9.3/colrev/qm/checkers/container_title_abbreviated.py
+-rw-r--r--   0        0        0     1105 2023-10-01 19:11:21.827875 colrev-0.9.3/colrev/qm/checkers/doi_not_matching_pattern.py
+-rw-r--r--   0        0        0     1207 2023-10-01 19:11:21.827875 colrev-0.9.3/colrev/qm/checkers/erroneous_symbol_in_field.py
+-rw-r--r--   0        0        0     1532 2023-10-01 19:11:21.827875 colrev-0.9.3/colrev/qm/checkers/erroneous_term_in_field.py
+-rw-r--r--   0        0        0     1364 2023-10-01 19:11:21.827875 colrev-0.9.3/colrev/qm/checkers/erroneous_title_field.py
+-rw-r--r--   0        0        0     1124 2023-10-01 19:11:21.831875 colrev-0.9.3/colrev/qm/checkers/html_tags.py
+-rw-r--r--   0        0        0     1761 2023-10-01 19:11:21.831875 colrev-0.9.3/colrev/qm/checkers/identical_values_between_title_and_container.py
+-rw-r--r--   0        0        0     1555 2023-10-01 19:11:21.831875 colrev-0.9.3/colrev/qm/checkers/incomplete_field.py
+-rw-r--r--   0        0        0     1596 2023-10-01 19:11:21.831875 colrev-0.9.3/colrev/qm/checkers/inconsistent_content.py
+-rw-r--r--   0        0        0     2962 2023-10-01 19:11:21.831875 colrev-0.9.3/colrev/qm/checkers/inconsistent_with_doi_metadata.py
+-rw-r--r--   0        0        0     2011 2023-10-01 19:11:21.831875 colrev-0.9.3/colrev/qm/checkers/inconsistent_with_entrytype.py
+-rw-r--r--   0        0        0     2363 2023-10-01 19:11:21.831875 colrev-0.9.3/colrev/qm/checkers/inconsistent_with_url_metadata.py
+-rw-r--r--   0        0        0     1189 2023-10-01 19:11:21.831875 colrev-0.9.3/colrev/qm/checkers/isbn_not_matching_pattern.py
+-rw-r--r--   0        0        0     1279 2023-10-01 19:11:21.831875 colrev-0.9.3/colrev/qm/checkers/language_format_error.py
+-rw-r--r--   0        0        0     1130 2023-10-01 19:11:21.831875 colrev-0.9.3/colrev/qm/checkers/language_unknown.py
+-rw-r--r--   0        0        0    11894 2023-10-01 19:11:21.831875 colrev-0.9.3/colrev/qm/checkers/missing_field.py
+-rw-r--r--   0        0        0     1776 2023-10-01 19:11:21.831875 colrev-0.9.3/colrev/qm/checkers/mostly_all_caps.py
+-rw-r--r--   0        0        0     1211 2023-10-01 19:11:21.831875 colrev-0.9.3/colrev/qm/checkers/name_abbreviated.py
+-rw-r--r--   0        0        0     2392 2023-10-01 19:11:21.831875 colrev-0.9.3/colrev/qm/checkers/name_format_separators.py
+-rw-r--r--   0        0        0     1396 2023-10-01 19:11:21.831875 colrev-0.9.3/colrev/qm/checkers/name_format_titles.py
+-rw-r--r--   0        0        0     1375 2023-10-01 19:11:21.831875 colrev-0.9.3/colrev/qm/checkers/name_particles.py
+-rw-r--r--   0        0        0     1243 2023-10-01 19:11:21.831875 colrev-0.9.3/colrev/qm/checkers/page_range.py
+-rw-r--r--   0        0        0     1754 2023-10-01 19:11:21.831875 colrev-0.9.3/colrev/qm/checkers/record_not_in_toc.py
+-rw-r--r--   0        0        0     1289 2023-10-01 19:11:21.831875 colrev-0.9.3/colrev/qm/checkers/thesis_with_multiple_authors.py
+-rw-r--r--   0        0        0     1018 2023-10-01 19:11:21.831875 colrev-0.9.3/colrev/qm/checkers/year_format.py
+-rw-r--r--   0        0        0     7096 2023-10-01 19:11:21.831875 colrev-0.9.3/colrev/qm/colrev_id.py
+-rw-r--r--   0        0        0     1493 2023-10-01 19:11:21.831875 colrev-0.9.3/colrev/qm/colrev_pdf_id.py
+-rw-r--r--   0        0        0     1722 2023-10-01 19:11:21.831875 colrev-0.9.3/colrev/qm/quality_model.py
+-rw-r--r--   0        0        0      104 2023-10-01 19:11:21.831875 colrev-0.9.3/colrev/readme.md
+-rw-r--r--   0        0        0    92076 2023-10-01 19:11:21.831875 colrev-0.9.3/colrev/record.py
+-rw-r--r--   0        0        0    26153 2023-10-01 19:11:21.831875 colrev-0.9.3/colrev/review_manager.py
+-rw-r--r--   0        0        0    19754 2023-10-01 19:11:21.831875 colrev-0.9.3/colrev/settings.py
+-rw-r--r--   0        0        0     1642 2023-10-01 19:11:21.831875 colrev-0.9.3/colrev/template/custom_scripts/custom_data_script.py
+-rw-r--r--   0        0        0     1095 2023-10-01 19:11:21.831875 colrev-0.9.3/colrev/template/custom_scripts/custom_pdf_get_script.py
+-rw-r--r--   0        0        0     1365 2023-10-01 19:11:21.831875 colrev-0.9.3/colrev/template/custom_scripts/custom_pdf_prep_script.py
+-rw-r--r--   0        0        0     1314 2023-10-01 19:11:21.831875 colrev-0.9.3/colrev/template/custom_scripts/custom_prep_script.py
+-rw-r--r--   0        0        0     1829 2023-10-01 19:11:21.831875 colrev-0.9.3/colrev/template/custom_scripts/custom_prescreen_script.py
+-rw-r--r--   0        0        0     2345 2023-10-01 19:11:21.831875 colrev-0.9.3/colrev/template/custom_scripts/custom_screen_script.py
+-rw-r--r--   0        0        0     3239 2023-10-01 19:11:21.831875 colrev-0.9.3/colrev/template/custom_scripts/custom_search_source_script.py
+-rw-r--r--   0        0        0    15707 2023-10-01 19:11:21.831875 colrev-0.9.3/colrev/template/example/30_example_records.bib
+-rw-r--r--   0        0        0      143 2023-10-01 19:11:21.831875 colrev-0.9.3/colrev/template/github_pages/README.md
+-rw-r--r--   0        0        0      155 2023-10-01 19:11:21.831875 colrev-0.9.3/colrev/template/github_pages/_config.yml
+-rw-r--r--   0        0        0       73 2023-10-01 19:11:21.831875 colrev-0.9.3/colrev/template/github_pages/about.md
+-rw-r--r--   0        0        0     4953 2023-10-01 19:11:21.831875 colrev-0.9.3/colrev/template/github_pages/index.html
+-rw-r--r--   0        0        0      185 2023-10-01 19:11:21.831875 colrev-0.9.3/colrev/template/github_pages/pre-commit-config.yaml
+-rw-r--r--   0        0        0    18650 2023-10-01 19:11:21.831875 colrev-0.9.3/colrev/template/init/LICENSE-CC-BY-4.0.txt
+-rw-r--r--   0        0        0     1770 2023-10-01 19:11:21.831875 colrev-0.9.3/colrev/template/init/colrev_update.yml
+-rw-r--r--   0        0        0     1555 2023-10-01 19:11:21.831875 colrev-0.9.3/colrev/template/init/colrev_update_curation.yml
+-rw-r--r--   0        0        0       54 2023-10-01 19:11:21.831875 colrev-0.9.3/colrev/template/init/gitattributes
+-rw-r--r--   0        0        0       85 2023-10-01 19:11:21.831875 colrev-0.9.3/colrev/template/init/markdownlint.yaml
+-rw-r--r--   0        0        0      936 2023-10-01 19:11:21.831875 colrev-0.9.3/colrev/template/init/pre-commit-config.yaml
+-rw-r--r--   0        0        0      480 2023-10-01 19:11:21.831875 colrev-0.9.3/colrev/template/init/pre-commit.yml
+-rw-r--r--   0        0        0      276 2023-10-01 19:11:21.831875 colrev-0.9.3/colrev/template/init/readme.md
+-rw-r--r--   0        0        0     5023 2023-10-01 19:11:21.831875 colrev-0.9.3/colrev/template/init/settings.json
+-rw-r--r--   0        0        0      930 2023-10-01 19:11:21.831875 colrev-0.9.3/colrev/template/ops/commit_report_details.txt
+-rw-r--r--   0        0        0      271 2023-10-01 19:11:21.831875 colrev-0.9.3/colrev/template/ops/commit_report_header.txt
+-rw-r--r--   0        0        0      352 2023-10-01 19:11:21.831875 colrev-0.9.3/colrev/template/ops/complementary_material_keywords.txt
+-rw-r--r--   0        0        0       25 2023-10-01 19:11:21.831875 colrev-0.9.3/colrev/template/ops/complementary_material_prefixes.txt
+-rw-r--r--   0        0        0      318 2023-10-01 19:11:21.831875 colrev-0.9.3/colrev/template/ops/complementary_material_strings.txt
+-rw-r--r--   0        0        0   190600 2023-10-01 19:11:21.831875 colrev-0.9.3/colrev/template/ops/journal_rankings.csv
+-rw-r--r--   0        0        0      494 2023-10-01 19:11:21.831875 colrev-0.9.3/colrev/template/ops/masterdata_curations.csv
+-rw-r--r--   0        0        0      462 2023-10-01 19:11:21.831875 colrev-0.9.3/colrev/template/ops/pdf_get_man_mail.txt
+-rw-r--r--   0        0        0     2729 2023-10-01 19:11:21.831875 colrev-0.9.3/colrev/template/ops/prep_man_curation.ipynb
+-rw-r--r--   0        0        0     3830 2023-10-01 19:11:21.831875 colrev-0.9.3/colrev/template/ops/status.txt
+-rw-r--r--   0        0        0    49122 2023-10-01 19:11:21.831875 colrev-0.9.3/colrev/template/package_endpoints.json
+-rw-r--r--   0        0        0    12683 2023-10-01 19:11:21.831875 colrev-0.9.3/colrev/template/package_status.json
+-rw-r--r--   0        0        0      227 2023-10-01 19:11:21.831875 colrev-0.9.3/colrev/template/packages.json
+-rw-r--r--   0        0        0    25233 2023-10-01 19:11:21.831875 colrev-0.9.3/colrev/template/paper_md/APA-7.docx
+-rw-r--r--   0        0        0      381 2023-10-01 19:11:21.831875 colrev-0.9.3/colrev/template/paper_md/non_sample_references.bib
+-rw-r--r--   0        0        0      673 2023-10-01 19:11:21.835875 colrev-0.9.3/colrev/template/paper_md/paper.md
+-rw-r--r--   0        0        0     4935 2023-10-01 19:11:21.835875 colrev-0.9.3/colrev/template/prisma/PRISMA.csv
+-rw-r--r--   0        0        0     5108 2023-10-01 19:11:21.835875 colrev-0.9.3/colrev/template/prisma/PRISMA_original.csv
+-rw-r--r--   0        0        0      872 2023-10-01 19:11:21.835875 colrev-0.9.3/colrev/template/prisma/prisma-refs.bib
+-rw-r--r--   0        0        0      262 2023-10-01 19:11:21.835875 colrev-0.9.3/colrev/template/prisma/prisma_text.md
+-rw-r--r--   0        0        0     1506 2023-10-01 19:11:21.835875 colrev-0.9.3/colrev/template/review_type/curated_masterdata/curations_github_colrev_update.yml
+-rw-r--r--   0        0        0      460 2023-10-01 19:11:21.835875 colrev-0.9.3/colrev/template/review_type/curated_masterdata/readme.md
+-rw-r--r--   0        0        0      586 2023-10-01 19:11:21.835875 colrev-0.9.3/colrev/template/review_type/meta_analysis/paper.md
+-rw-r--r--   0        0        0      104 2023-10-01 19:11:21.835875 colrev-0.9.3/colrev/ui_cli/__init__.py
+-rw-r--r--   0        0        0    86150 2023-10-01 19:11:21.835875 colrev-0.9.3/colrev/ui_cli/cli.py
+-rw-r--r--   0        0        0      146 2023-10-01 19:11:21.835875 colrev-0.9.3/colrev/ui_cli/cli_colors.py
+-rw-r--r--   0        0        0     2536 2023-10-01 19:11:21.835875 colrev-0.9.3/colrev/ui_cli/cli_load.py
+-rw-r--r--   0        0        0     9351 2023-10-01 19:11:21.835875 colrev-0.9.3/colrev/ui_cli/cli_status_printer.py
+-rw-r--r--   0        0        0     7346 2023-10-01 19:11:21.835875 colrev-0.9.3/colrev/ui_cli/cli_validation.py
+-rw-r--r--   0        0        0     2757 2023-10-01 19:11:21.835875 colrev-0.9.3/colrev/ui_cli/dedupe_errors.py
+-rw-r--r--   0        0        0     2089 2023-10-01 19:11:21.835875 colrev-0.9.3/colrev/ui_cli/search_backward_selective.py
+-rw-r--r--   0        0        0      975 2023-10-01 19:11:21.835875 colrev-0.9.3/colrev/ui_cli/setup_custom_scripts.py
+-rw-r--r--   0        0        0     2853 2023-10-01 19:11:21.835875 colrev-0.9.3/colrev/ui_cli/show_printer.py
+-rw-r--r--   0        0        0     3154 2023-10-01 19:11:21.867875 colrev-0.9.3/pyproject.toml
+-rw-r--r--   0        0        0    15151 1970-01-01 00:00:00.000000 colrev-0.9.3/PKG-INFO
```

### Comparing `colrev-0.9.2/CHANGELOG.md` & `colrev-0.9.3/CHANGELOG.md`

 * *Files 2% similar despite different names*

```diff
@@ -11,14 +11,20 @@
 
 ### Changed
 
 ### Removed
 
 ### Fixed
 
+## 0.9.3 - 2023-10-01
+
+### Changed
+
+- Introduced namespaced fields (e.g., `colrev.pubmed.pubmedid` instead of `pubmedid`).
+
 ## 0.9.2 - 2023-07-24
 
 ### Changed
 
 - Updated colrev-asreview dependency (PyPI instead of GitHub)
 
 ## 0.9.1 - 2023-07-23
```

### Comparing `colrev-0.9.2/CONTRIBUTING.md` & `colrev-0.9.3/CONTRIBUTING.md`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/LICENSE` & `colrev-0.9.3/LICENSE`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/README.md` & `colrev-0.9.3/README.md`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/advisor.py` & `colrev-0.9.3/colrev/advisor.py`

 * *Files 0% similar despite different names*

```diff
@@ -745,14 +745,19 @@
             "collaboration_instructions": self.__get_collaboration_instructions(
                 status_stats=status_stats
             ),
         }
         # self.review_manager.logger.debug(
         #     f"instructions: {self.review_manager.p_printer.pformat(instructions)}"
         # )
+        if self.review_manager.shell_mode:
+            for category in instructions.values():
+                for item in category:
+                    if "cmd" in item:
+                        item["cmd"] = item["cmd"].replace("colrev ", "")
         return instructions
 
     def get_sharing_instructions(self) -> dict:
         """Get instructions related to sharing the project"""
 
         collaboration_instructions = self.__get_collaboration_instructions()
```

### Comparing `colrev-0.9.2/colrev/checker.py` & `colrev-0.9.3/colrev/checker.py`

 * *Files 4% similar despite different names*

```diff
@@ -262,94 +262,104 @@
         # E.g., setting a record from rev_synthesized to rev_included should be ok.
         # if len(set(status_data["invalid_state_transitions"])) > 0:
         #     raise colrev_exceptions.StatusTransitionError(
         #         "invalid state transitions: \n    "
         #         + "\n    ".join(status_data["invalid_state_transitions"])
         #     )
 
+    def __check_individual_record_screen(
+        self,
+        *,
+        record_id: str,
+        status: colrev.record.RecordState,
+        screen_crit: str,
+        field_errors: typing.List[str],
+        pattern: str,
+        pattern_inclusion: str,
+        criteria: typing.List[str],
+    ) -> None:
+        # No screening criteria allowed before screen
+        if (
+            status
+            not in colrev.record.RecordState.get_post_x_states(
+                state=colrev.record.RecordState.rev_included
+            )
+            and status != colrev.record.RecordState.md_needs_manual_preparation
+        ):
+            if "NA" != screen_crit:
+                raise colrev_exceptions.FieldValueError(
+                    f"{record_id}: screen_crit != NA ({screen_crit})"
+                )
+            return
+
+        # All screening criteria must match pattern
+        if not re.match(pattern, screen_crit):
+            # Note: this should also catch cases of missing
+            # screening criteria
+            field_errors.append(
+                "Screening criteria field not matching "
+                f"pattern: {screen_crit} ({record_id}; criteria: {criteria})"
+            )
+            return
+
+        # Included papers must match inclusion pattern
+        if status in [
+            colrev.record.RecordState.rev_included,
+            colrev.record.RecordState.rev_synthesized,
+        ]:
+            if not re.match(pattern_inclusion, screen_crit):
+                field_errors.append(
+                    "Included record with screening_criterion satisfied: "
+                    f"{record_id}, {status}, {screen_crit}"
+                )
+            return
+
+        # Excluded papers must match exclusion pattern
+        if status == colrev.record.RecordState.rev_excluded:
+            if ["NA"] == criteria:
+                if screen_crit == "NA":
+                    return
+                field_errors.append(f"screen_crit field not NA: {screen_crit}")
+
+            if "=out" not in screen_crit:
+                self.review_manager.logger.error("criteria: %s", criteria)
+                field_errors.append(
+                    "Excluded record with no screening_criterion violated: "
+                    f"{record_id}, {status}, {screen_crit}"
+                )
+
     def __check_records_screen(self, *, status_data: dict) -> None:
         """Check consistency of screening criteria and status"""
 
-        # pylint: disable=too-many-branches
+        if not status_data["screening_criteria_list"]:
+            return
+
+        field_errors: typing.List[str] = []
+
+        screening_criteria = self.review_manager.settings.screen.criteria
+        if not screening_criteria:
+            criteria = ["NA"]
+            pattern = "^NA$"
+            pattern_inclusion = "^NA$"
+        else:
+            pattern = "=(in|out);".join(screening_criteria.keys()) + "=(in|out)"
+            pattern_inclusion = "=in;".join(screening_criteria.keys()) + "=in"
+            criteria = list(screening_criteria.keys())
+
+        for [record_id, status, screen_crit] in status_data["screening_criteria_list"]:
+            self.__check_individual_record_screen(
+                record_id=record_id,
+                status=status,
+                screen_crit=screen_crit,
+                field_errors=field_errors,
+                pattern=pattern,
+                pattern_inclusion=pattern_inclusion,
+                criteria=criteria,
+            )
 
-        # Check screen
-        # Note: consistency of inclusion_2=yes -> inclusion_1=yes
-        # is implicitly ensured through status
-        # (screen2-included/excluded implies prescreen included!)
-
-        field_errors = []
-
-        if status_data["screening_criteria_list"]:
-            screening_criteria = self.review_manager.settings.screen.criteria
-            if not screening_criteria:
-                criteria = ["NA"]
-                pattern = "^NA$"
-                pattern_inclusion = "^NA$"
-            else:
-                pattern = "=(in|out);".join(screening_criteria.keys()) + "=(in|out)"
-                pattern_inclusion = "=in;".join(screening_criteria.keys()) + "=in"
-
-            for [record_id, status, screen_crit] in status_data[
-                "screening_criteria_list"
-            ]:
-                if (
-                    status
-                    not in colrev.record.RecordState.get_post_x_states(
-                        state=colrev.record.RecordState.rev_included
-                    )
-                    and status != colrev.record.RecordState.md_needs_manual_preparation
-                ):
-                    if "NA" != screen_crit:
-                        raise colrev_exceptions.FieldValueError(
-                            f"{record_id}: screen_crit != NA ({screen_crit})"
-                        )
-                    continue
-
-                # print([record_id, status, screen_crit])
-                if not re.match(pattern, screen_crit):
-                    # Note: this should also catch cases of missing
-                    # screening criteria
-                    field_errors.append(
-                        "Screening criteria field not matching "
-                        f"pattern: {screen_crit} ({record_id}; criteria: {criteria})"
-                    )
-
-                elif str(colrev.record.RecordState.rev_excluded) == status:
-                    if ["NA"] == criteria:
-                        if screen_crit == "NA":
-                            continue
-                        field_errors.append(f"screen_crit field not NA: {screen_crit}")
-
-                    if "=out" not in screen_crit:
-                        self.review_manager.logger.error("criteria: %s", criteria)
-                        field_errors.append(
-                            "Excluded record with no screening_criterion violated: "
-                            f"{record_id}, {status}, {screen_crit}"
-                        )
-
-                # Note: we don't have to consider the cases of
-                # status=retrieved/prescreen_included/prescreen_excluded
-                # because they would not have screening_criteria.
-                elif status in [
-                    str(colrev.record.RecordState.rev_included),
-                    str(colrev.record.RecordState.rev_synthesized),
-                ]:
-                    if not re.match(pattern_inclusion, screen_crit):
-                        field_errors.append(
-                            "Included record with screening_criterion satisfied: "
-                            f"{record_id}, {status}, {screen_crit}"
-                        )
-                else:
-                    if status == colrev.record.RecordState.rev_excluded:
-                        continue
-                    if not re.match(pattern_inclusion, screen_crit):
-                        field_errors.append(
-                            "Record with screening_criterion but before "
-                            f"screen: {record_id}, {status}"
-                        )
         if field_errors:
             raise colrev_exceptions.FieldValueError(
                 "\n    " + "\n    ".join(field_errors)
             )
 
     def __check_change_in_propagated_id_in_file(
         self,
```

### Comparing `colrev-0.9.2/colrev/dataset.py` & `colrev-0.9.3/colrev/dataset.py`

 * *Files 1% similar despite different names*

```diff
@@ -39,27 +39,28 @@
 
 class Dataset:
     """The CoLRev dataset (records and their history in git)"""
 
     RECORDS_FILE_RELATIVE = Path("data/records.bib")
     GIT_IGNORE_FILE_RELATIVE = Path(".gitignore")
     DEFAULT_GIT_IGNORE_ITEMS = [
-        "*.bib.sav",
-        "venv",
+        ".history",
+        ".colrev",
         ".corrections",
-        "data/pdfs",
         ".report.log",
         "__pycache__",
+        "*.bib.sav",
+        "venv",
         "output",
+        "data/pdfs",
         "data/pdf_get_man/missing_pdf_files.csv",
         "data/.tei/",
         "data/prep_man/records_prep_man.bib",
         "data/prep/",
         "data/dedupe/",
-        ".history",
     ]
     DEPRECATED_GIT_IGNORE_ITEMS = [
         "missing_pdf_files.csv",
         "manual_cleansing_statistics.csv",
         ".references_learned_settings",
         "pdfs",
         ".tei",
@@ -535,17 +536,17 @@
                 "colrev_data_provenance",
                 "colrev_pdf_id",
                 "screening_criteria",
                 "file",  # Note : do not change this order (parsers rely on it)
                 "prescreen_exclusion",
                 "doi",
                 "grobid-version",
-                "dblp_key",
-                "sem_scholar_id",
-                "wos_accession_number",
+                "colrev.dblp.dblp_key",
+                "colrev.semantic_scholar.id",
+                "colrev.web_of_science.unique-id",
                 "author",
                 "booktitle",
                 "journal",
                 "title",
                 "year",
                 "volume",
                 "number",
```

### Comparing `colrev-0.9.2/colrev/env/environment_manager.py` & `colrev-0.9.3/colrev/env/environment_manager.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/env/grobid_service.py` & `colrev-0.9.3/colrev/env/grobid_service.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/env/language_service.py` & `colrev-0.9.3/colrev/env/language_service.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/env/local_index.py` & `colrev-0.9.3/colrev/env/local_index.py`

 * *Files 0% similar despite different names*

```diff
@@ -36,15 +36,15 @@
 
 # pylint: disable=too-many-lines
 
 
 class LocalIndex:
     """The LocalIndex implements indexing and retrieval of records across projects"""
 
-    global_keys = ["doi", "dblp_key", "colrev_pdf_id", "url", "colrev_id"]
+    global_keys = ["doi", "colrev.dblp.dblp_key", "colrev_pdf_id", "url", "colrev_id"]
     max_len_sha256 = 2**256
     request_timeout = 90
 
     local_environment_path = Path.home().joinpath("colrev")
     SQLITE_PATH = str(local_environment_path / Path("sqlite_index.db"))
 
     teiind_path = local_environment_path / Path(".tei_index/")
@@ -75,15 +75,18 @@
     }
 
     SELECT_KEY_QUERIES = {
         (RECORD_INDEX, "id"): "SELECT * FROM record_index WHERE id=?",
         (TOC_INDEX, "toc_key"): "SELECT * FROM toc_index WHERE toc_key=?",
         (RECORD_INDEX, "colrev_id"): "SELECT * FROM record_index WHERE colrev_id=?",
         (RECORD_INDEX, "doi"): "SELECT * FROM record_index where doi=?",
-        (RECORD_INDEX, "dblp_key"): "SELECT * FROM record_index WHERE dblp_key=?",
+        (
+            RECORD_INDEX,
+            "colrev.dblp.dblp_key",
+        ): "SELECT * FROM record_index WHERE dblp_key=?",
         (
             RECORD_INDEX,
             "colrev_pdf_id",
         ): "SELECT * FROM record_index WHERE colrev_pdf_id=?",
         (RECORD_INDEX, "url"): "SELECT * FROM record_index WHERE url=?",
     }
 
@@ -98,15 +101,15 @@
         "title",
         "abstract",
         "file",
         "tei",
         "fulltext",
         "url",
         "doi",
-        "dblp_key",
+        "dblp_key",  # Note : no dots in key names
         "colrev_pdf_id",
         "bibtex",
         "layered_fields"
         # "curation_ID"
     ]
 
     # Note: we need the local_curated_metadata field for is_duplicate()
@@ -559,26 +562,27 @@
         """Run a search for records"""
 
         records_to_return = []
         try:
             self.thread_lock.acquire(timeout=60)
             cur = self.__get_sqlite_cursor()
             selected_row = None
+            print(f"{self.SELECT_ALL_QUERIES[self.RECORD_INDEX] } {query}")
             cur.execute(f"{self.SELECT_ALL_QUERIES[self.RECORD_INDEX] } {query}")
             for row in cur.fetchall():
                 selected_row = row
 
                 retrieved_record = self.__get_record_from_row(row=selected_row)
 
                 retrieved_record = self.__prepare_record_for_return(
                     record_dict=retrieved_record, include_file=False
                 )
                 records_to_return.append(colrev.record.Record(data=retrieved_record))
-        except sqlite3.OperationalError:
-            pass
+        except sqlite3.OperationalError as exc:
+            print(exc)
         finally:
             self.thread_lock.release()
 
         return records_to_return
 
     def __outlets_duplicated(self) -> bool:
         print("Validate curated metadata")
@@ -1019,14 +1023,15 @@
             year = record_dict.get("year", "NA")
 
             return year
 
         except (
             colrev_exceptions.NotEnoughDataToIdentifyException,
             colrev_exceptions.NotTOCIdentifiableException,
+            colrev_exceptions.RecordNotInIndexException,
         ) as exc:
             raise colrev_exceptions.TOCNotAvailableException() from exc
 
     def __toc_exists(self, *, toc_item: str) -> bool:
         try:
             self.thread_lock.acquire(timeout=60)
             cur = self.__get_sqlite_cursor()
```

### Comparing `colrev-0.9.2/colrev/env/package_manager.py` & `colrev-0.9.3/colrev/env/package_manager.py`

 * *Files 4% similar despite different names*

```diff
@@ -124,26 +124,19 @@
     heuristic_status: SearchSourceHeuristicStatus = zope.interface.Attribute(
         """The status of the SearchSource heuristic"""
     )
     short_name = zope.interface.Attribute("""Short name of the SearchSource""")
     link = zope.interface.Attribute("""Link to the SearchSource website""")
 
     # pylint: disable=no-self-argument
-    def validate_source(
-        search_operation: colrev.ops.search.Search, source: colrev.settings.SearchSource
-    ) -> None:  # type: ignore
-        """Validate the SearchSource (parameters etc.)"""
-        # May raise an InvalidQueryException
-
-    # pylint: disable=no-self-argument
     def heuristic(filename: Path, data: str):  # type: ignore
         """Heuristic to identify the SearchSource"""
 
     # pylint: disable=no-self-argument
-    def add_endpoint(search_operation: colrev.ops.search.Search, query: str):  # type: ignore
+    def add_endpoint(operation: colrev.operation.Operation, params: str):  # type: ignore
         """Add the SearchSource as an endpoint based on a query (passed to colrev search -a)"""
 
     # pylint: disable=no-self-argument
     def run_search(search_operation: colrev.ops.search.Search, rerun: bool) -> None:  # type: ignore
         """Run a search of the SearchSource"""
 
     # pylint: disable=no-self-argument
@@ -314,18 +307,14 @@
     GeneralInterface, zope.interface.Interface
 ):  # pylint: disable=inherit-non-class
     """The PackageEndpoint interface for data operations"""
 
     settings_class = zope.interface.Attribute("""Class for the package settings""")
 
     # pylint: disable=no-self-argument
-    # pylint: disable=no-method-argument
-    def get_default_setup() -> dict:  # type: ignore
-        """Get the default setup for the data package endpoint"""
-        return {}  # pragma: no cover
 
     def update_data(  # type: ignore
         data_operation: colrev.ops.data.Data,
         records: dict,
         synthesized_record_status_matrix: dict,
         silent_mode: bool,
     ) -> None:
@@ -889,15 +878,15 @@
                 code_link += ".md"
                 if hasattr(endpoint, "link"):
                     link = endpoint.link
                 else:
                     link = code_link
                 # Note: link format for the sphinx docs
                 endpoint_item["short_description"] = (
-                    endpoint_item["short_description"] + f" (`instructions <{link}>`_)"
+                    endpoint_item["short_description"] + f" (`instructions <{link}>`__)"
                 )
 
             endpoint_list += [
                 x
                 for x in package_endpoints["endpoints"][endpoint_type]
                 if x["package_endpoint_identifier"].split(".")[0] == selected_package
             ]
@@ -936,15 +925,16 @@
 
         package_endpoints_json: typing.Dict[str, list] = {
             x.name: [] for x in self.package_type_overview
         }
         for package in packages:
             print(f'Loading package endpoints from {package["module"]}')
             module_spec = importlib.util.find_spec(package["module"])
-            endpoints_path = Path(module_spec.origin).parents[1] / Path(  # type:ignore
+
+            endpoints_path = Path(module_spec.origin).parent / Path(  # type:ignore
                 ".colrev_endpoints.json"
             )
             if not endpoints_path.is_file():  # pragma: no cover
                 print(f"File does not exist: {endpoints_path}")
                 continue
 
             try:
@@ -973,7 +963,103 @@
 
         json_object = json.dumps(package_status, indent=4)
         with open(
             Path("colrev/template/package_status.json"), "w", encoding="utf-8"
         ) as file:
             file.write(json_object)
             file.write("\n")  # to avoid pre-commit/eof-fix changes
+
+    def add_endpoint_for_operation(
+        self,
+        *,
+        operation: colrev.operation.Operation,
+        package_identifier: str,
+        params: str,
+        prompt_on_same_source: bool = True,
+    ) -> None:
+        """Add a package_endpoint"""
+
+        settings = operation.review_manager.settings
+        package_type_dict = {
+            colrev.operation.OperationsType.search: {
+                "package_type": colrev.env.package_manager.PackageEndpointType.search_source,
+                "endpoint_location": settings.sources,
+            },
+            colrev.operation.OperationsType.prep: {
+                "package_type": colrev.env.package_manager.PackageEndpointType.prep,
+                "endpoint_location": settings.prep.prep_rounds[
+                    0
+                ].prep_package_endpoints,
+            },
+            colrev.operation.OperationsType.prep_man: {
+                "package_type": colrev.env.package_manager.PackageEndpointType.prep_man,
+                "endpoint_location": settings.prep.prep_man_package_endpoints,
+            },
+            colrev.operation.OperationsType.dedupe: {
+                "package_type": colrev.env.package_manager.PackageEndpointType.dedupe,
+                "endpoint_location": settings.dedupe.dedupe_package_endpoints,
+            },
+            colrev.operation.OperationsType.prescreen: {
+                "package_type": colrev.env.package_manager.PackageEndpointType.prescreen,
+                "endpoint_location": settings.prescreen.prescreen_package_endpoints,
+            },
+            colrev.operation.OperationsType.pdf_get: {
+                "package_type": colrev.env.package_manager.PackageEndpointType.pdf_get,
+                "endpoint_location": settings.pdf_get.pdf_get_package_endpoints,
+            },
+            colrev.operation.OperationsType.pdf_get_man: {
+                "package_type": colrev.env.package_manager.PackageEndpointType.pdf_get_man,
+                "endpoint_location": settings.pdf_get.pdf_get_man_package_endpoints,
+            },
+            colrev.operation.OperationsType.pdf_prep: {
+                "package_type": colrev.env.package_manager.PackageEndpointType.pdf_prep,
+                "endpoint_location": settings.pdf_prep.pdf_prep_package_endpoints,
+            },
+            colrev.operation.OperationsType.pdf_prep_man: {
+                "package_type": colrev.env.package_manager.PackageEndpointType.pdf_prep_man,
+                "endpoint_location": settings.pdf_prep.pdf_prep_man_package_endpoints,
+            },
+            colrev.operation.OperationsType.screen: {
+                "package_type": colrev.env.package_manager.PackageEndpointType.screen,
+                "endpoint_location": settings.screen.screen_package_endpoints,
+            },
+            colrev.operation.OperationsType.data: {
+                "package_type": colrev.env.package_manager.PackageEndpointType.data,
+                "endpoint_location": settings.data.data_package_endpoints,
+            },
+        }
+
+        package_type = package_type_dict[operation.type]["package_type"]
+        endpoints = package_type_dict[operation.type]["endpoint_location"]
+
+        registered_endpoints = [
+            e["endpoint"] if isinstance(e, dict) else e.endpoint for e in endpoints  # type: ignore
+        ]
+        if package_identifier in registered_endpoints and prompt_on_same_source:
+            operation.review_manager.logger.warning(
+                f"Package {package_identifier} already in {endpoints}"
+            )
+            if "y" != input("Continue [y/n]?"):
+                return
+
+        operation.review_manager.logger.info(
+            f"{colors.GREEN}Add {operation.type} package:{colors.END} {package_identifier}"
+        )
+
+        endpoint_dict = self.load_packages(
+            package_type=package_type,  # type: ignore
+            selected_packages=[{"endpoint": package_identifier}],
+            operation=operation,
+            instantiate_objects=False,
+        )
+
+        e_class = endpoint_dict[package_identifier]
+        if hasattr(endpoint_dict[package_identifier], "add_endpoint"):
+            add_package = e_class.add_endpoint(operation=operation, params=params)  # type: ignore
+        else:
+            add_package = {"endpoint": package_identifier}
+            endpoints.append(add_package)  # type: ignore
+
+        operation.review_manager.save_settings()
+        operation.review_manager.create_commit(
+            msg=f"Add {operation.type} {package_identifier}",
+        )
```

### Comparing `colrev-0.9.2/colrev/env/resources.py` & `colrev-0.9.3/colrev/env/resources.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/env/screenshot_service.py` & `colrev-0.9.3/colrev/env/screenshot_service.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/env/tei_parser.py` & `colrev-0.9.3/colrev/env/tei_parser.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/env/utils.py` & `colrev-0.9.3/colrev/env/utils.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/env/zotero_translation_service.py` & `colrev-0.9.3/colrev/env/zotero_translation_service.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/exceptions.py` & `colrev-0.9.3/colrev/exceptions.py`

 * *Files 0% similar despite different names*

```diff
@@ -183,14 +183,22 @@
     """
 
     def __init__(self, msg: str) -> None:
         self.message = msg
         super().__init__(self.message)
 
 
+class AppendOnlyViolation(Exception):
+    """Invalid changes to a file in append-only mode."""
+
+    def __init__(self, msg: str) -> None:
+        self.message = msg
+        super().__init__(self.message)
+
+
 class ProcessOrderViolation(CoLRevException):
     """The process triggered dooes not have priority"""
 
     def __init__(
         self,
         operations_type: str,
         required_state: str,
@@ -353,14 +361,22 @@
     """The record does not contain the required source_identifier (cannot be added to the feed)."""
 
     def __init__(self, msg: Optional[str] = None) -> None:
         self.message = msg
         super().__init__(self.message)
 
 
+class SearchSourceException(CoLRevException):
+    """Records cannot be retrieved from the SearchSource."""
+
+    def __init__(self, msg: str) -> None:
+        self.message = msg
+        super().__init__(self.message)
+
+
 # Load
 
 
 class ImportException(CoLRevException):
     """An error occured in the import functions."""
 
     def __init__(
```

### Comparing `colrev-0.9.2/colrev/hooks/update.py` & `colrev-0.9.3/colrev/hooks/update.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/linter/colrev_lint.py` & `colrev-0.9.3/colrev/linter/colrev_lint.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/logger.py` & `colrev-0.9.3/colrev/logger.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/operation.py` & `colrev-0.9.3/colrev/operation.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/assets/favicon.ico` & `colrev-0.9.3/colrev/ops/assets/favicon.ico`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/assets/faviconWhiteBg.ico` & `colrev-0.9.3/colrev/ops/assets/faviconWhiteBg.ico`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/assets/style.css` & `colrev-0.9.3/colrev/ops/assets/style.css`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/data/bibliography_export.py` & `colrev-0.9.3/colrev/ops/built_in/data/bibliography_export.py`

 * *Files 7% similar despite different names*

```diff
@@ -5,14 +5,15 @@
 import copy
 import json
 from dataclasses import dataclass
 from enum import Enum
 from pathlib import Path
 from typing import TYPE_CHECKING
 
+import click
 import requests
 import zope.interface
 from dataclasses_jsonschema import JsonSchemaMixin
 
 import colrev.env.package_manager
 import colrev.env.utils
 import colrev.exceptions as colrev_exceptions
@@ -80,23 +81,14 @@
 
         self.settings = self.settings_class.load_settings(data=settings)
         self.endpoint_path = data_operation.review_manager.output_dir
 
         if not data_operation.review_manager.in_ci_environment():
             data_operation.review_manager.get_zotero_translation_service()
 
-    def get_default_setup(self) -> dict:
-        """Get the default setup"""
-        endnote_endpoint_details = {
-            "endpoint": "colrev.bibliography_export",
-            "version": "0.1",
-            "bib_format": "endnote",
-        }
-        return endnote_endpoint_details
-
     def __pybtex_conversion(
         self, *, data_operation: colrev.ops.data.Data, selected_records: dict
     ) -> None:
         data_operation.review_manager.logger.info(
             f"Export {self.settings.bib_format.name}"
         )
 
@@ -184,14 +176,35 @@
             )
 
         except Exception as exc:
             raise colrev_exceptions.ImportException(
                 f"Zotero translators failed ({exc})"
             )
 
+    @classmethod
+    def add_endpoint(cls, operation: colrev.ops.data.Data, params: str) -> None:
+        """Add bibliography as an endpoint"""
+
+        add_source = {
+            "endpoint": "colrev.bibliography_export",
+            "version": "0.1",
+            "bib_format": "endnote",
+        }
+
+        if params:
+            add_source["bib_format"] = params
+        else:
+            choice = click.prompt(
+                "Select a bibliography format",
+                type=click.Choice([b.value for b in BibFormats]),
+            )
+            add_source["bib_format"] = choice
+
+        operation.review_manager.settings.data.data_package_endpoints.append(add_source)
+
     def update_data(
         self,
         data_operation: colrev.ops.data.Data,
         records: dict,
         synthesized_record_status_matrix: dict,  # pylint: disable=unused-argument
         silent_mode: bool,  # pylint: disable=unused-argument
     ) -> None:
```

### Comparing `colrev-0.9.2/colrev/ops/built_in/data/colrev_curation.md` & `colrev-0.9.3/colrev/ops/built_in/data/colrev_curation.md`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/data/colrev_curation.py` & `colrev-0.9.3/colrev/ops/built_in/data/colrev_curation.py`

 * *Files 2% similar despite different names*

```diff
@@ -55,18 +55,20 @@
         if "version" not in settings:
             settings["version"] = "0.1"
 
         self.settings = self.settings_class.load_settings(data=settings)
 
         self.data_operation = data_operation
 
-    def get_default_setup(self) -> dict:
-        """Get the default setup"""
+    # pylint: disable=unused-argument
+    @classmethod
+    def add_endpoint(cls, operation: colrev.ops.data.Data, params: str) -> None:
+        """Add as an endpoint"""
 
-        curation_endpoint_details = {
+        add_source = {
             "endpoint": "colrev.colrev_curation",
             "version": "0.1",
             "curation_url": "TODO",
             "curated_masterdata": True,
             "masterdata_restrictions": {
                 1900: {
                     "ENTRYTYPE": "article",
@@ -74,15 +76,15 @@
                     "volume": True,
                     "number": True,
                 }
             },
             "curated_fields": ["doi", "url"],
         }
 
-        return curation_endpoint_details
+        operation.review_manager.settings.data.data_package_endpoints.append(add_source)
 
     def __get_stats(
         self,
         *,
         records: dict,
         sources: list,
     ) -> dict:
```

### Comparing `colrev-0.9.2/colrev/ops/built_in/data/github_pages.py` & `colrev-0.9.3/colrev/ops/built_in/data/github_pages.py`

 * *Files 1% similar despite different names*

```diff
@@ -58,23 +58,26 @@
             settings["version"] = "0.1.0"
         if "auto_push" not in settings:
             settings["auto_push"] = True
 
         self.settings = self.settings_class.load_settings(data=settings)
         self.review_manager = data_operation.review_manager
 
-    def get_default_setup(self) -> dict:
-        """Get the default setup"""
-        github_pages_endpoint_details = {
+    # pylint: disable=unused-argument
+    @classmethod
+    def add_endpoint(cls, operation: colrev.ops.data.Data, params: str) -> None:
+        """Add as an endpoint"""
+
+        add_source = {
             "endpoint": "colrev.github_pages",
             "version": "0.1",
             "auto_push": True,
         }
 
-        return github_pages_endpoint_details
+        operation.review_manager.settings.data.data_package_endpoints.append(add_source)
 
     def __setup_github_pages_branch(
         self, *, data_operation: colrev.ops.data.Data, git_repo: git.Repo
     ) -> None:
         # if branch does not exist: create and add index.html
         data_operation.review_manager.logger.info("Setup gh-pages branch")
         git_repo.git.checkout("--orphan", self.GH_PAGES_BRANCH_NAME)
```

### Comparing `colrev-0.9.2/colrev/ops/built_in/data/obsidian.py` & `colrev-0.9.3/colrev/ops/built_in/data/obsidian.py`

 * *Files 2% similar despite different names*

```diff
@@ -76,22 +76,26 @@
         self.endpoint_inbox_path = (
             data_operation.review_manager.path / self.OBSIDIAN_INBOX_PATH_RELATIVE
         )
         self.review_manager = data_operation.review_manager
         if hasattr(self.review_manager, "dataset"):
             self.review_manager.dataset.update_gitignore(add=self.GITIGNORE_LIST)
 
-    def get_default_setup(self) -> dict:
-        """Get the default setup"""
-        obsidian_endpoint_details = {
+    # pylint: disable=unused-argument
+    @classmethod
+    def add_endpoint(cls, operation: colrev.ops.data.Data, params: str) -> None:
+        """Add as an endpoint"""
+
+        add_source = {
             "endpoint": "colrev.obsidian",
             "version": "0.1",
             "config": {},
         }
-        return obsidian_endpoint_details
+
+        operation.review_manager.settings.data.data_package_endpoints.append(add_source)
 
     def __get_obsidian_missing(self, *, included: list) -> list:
         in_obsidian = []
         for md_file in self.endpoint_paper_path.glob("*.md"):
             # missing: if todo in file
             if "#todo" not in md_file.read_text():
                 in_obsidian.append(str(md_file.name).replace(".md", ""))
```

### Comparing `colrev-0.9.2/colrev/ops/built_in/data/paper_md.md` & `colrev-0.9.3/colrev/ops/built_in/data/paper_md.md`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/data/paper_md.py` & `colrev-0.9.3/colrev/ops/built_in/data/paper_md.py`

 * *Files 0% similar despite different names*

```diff
@@ -123,24 +123,26 @@
             )
 
         self.paper_relative_path = self.settings.paper_path.relative_to(
             data_operation.review_manager.path
         )
         self.__temp_path.mkdir(exist_ok=True, parents=True)
 
-    def get_default_setup(self) -> dict:
-        """Get the default setup"""
+    # pylint: disable=unused-argument
+    @classmethod
+    def add_endpoint(cls, operation: colrev.ops.data.Data, params: str) -> None:
+        """Add as an endpoint"""
 
-        paper_md_endpoint_details = {
+        add_source = {
             "endpoint": "colrev.paper_md",
             "version": "0.1",
             "word_template": Path("data/APA-7.docx"),
         }
 
-        return paper_md_endpoint_details
+        operation.review_manager.settings.data.data_package_endpoints.append(add_source)
 
     def __retrieve_default_word_template(self) -> Path:
         template_name = self.data_operation.review_manager.data_dir / Path("APA-7.docx")
 
         filedata = colrev.env.utils.get_package_file_content(
             file_path=Path("template/paper_md/APA-7.docx")
         )
```

### Comparing `colrev-0.9.2/colrev/ops/built_in/data/prisma.py` & `colrev-0.9.3/colrev/ops/built_in/data/prisma.py`

 * *Files 5% similar despite different names*

```diff
@@ -68,23 +68,25 @@
 
         if not data_operation.review_manager.in_ci_environment():
             self.prisma_image = "colrev/prisma:latest"
             data_operation.review_manager.environment_manager.build_docker_image(
                 imagename=self.prisma_image
             )
 
-    def get_default_setup(self) -> dict:
-        """Get the default setup"""
+    # pylint: disable=unused-argument
+    @classmethod
+    def add_endpoint(cls, operation: colrev.ops.data.Data, params: str) -> None:
+        """Add as an endpoint"""
 
-        prisma_endpoint_details = {
+        add_source = {
             "endpoint": "colrev.prisma",
             "version": "0.1",
             "diagram_path": ["PRISMA.png"],
         }
-        return prisma_endpoint_details
+        operation.review_manager.settings.data.data_package_endpoints.append(add_source)
 
     def __export_csv(
         self, data_operation: colrev.ops.data.Data, silent_mode: bool
     ) -> None:
         csv_resource_path = Path("template/") / Path("prisma/PRISMA.csv")
         self.csv_path.parent.mkdir(exist_ok=True, parents=True)
 
@@ -104,17 +106,16 @@
             "duplicates", "n"
         ] = status_stats.currently.md_duplicates_removed
         prisma_data.loc["records_screened", "n"] = status_stats.overall.rev_prescreen
         prisma_data.loc[
             "records_excluded", "n"
         ] = status_stats.overall.rev_prescreen_excluded
         if status_stats.currently.exclusion:
-            prisma_data.loc["dbr_excluded", "n"] = ";".join(
-                f"Reason {key}, {val}"
-                for key, val in status_stats.currently.exclusion.items()
+            prisma_data.loc["dbr_excluded", "n"] = "; ".join(
+                f"{key}, {val}" for key, val in status_stats.currently.exclusion.items()
             )
         else:
             prisma_data.loc[
                 "dbr_excluded", "n"
             ] = f"Overall, {status_stats.overall.rev_excluded}"
 
         prisma_data.loc["dbr_assessed", "n"] = status_stats.overall.rev_screen
```

### Comparing `colrev-0.9.2/colrev/ops/built_in/data/structured.py` & `colrev-0.9.3/colrev/ops/built_in/data/structured.py`

 * *Files 1% similar despite different names*

```diff
@@ -87,26 +87,26 @@
 
         self.settings = self.settings_class.load_settings(data=settings)
         self.data_path = (
             data_operation.review_manager.data_dir / self.settings.data_path_relative
         )
         self.review_manager = data_operation.review_manager
 
-    def get_default_setup(self) -> dict:
-        """Get the default setup"""
+    # pylint: disable=unused-argument
+    @classmethod
+    def add_endpoint(cls, operation: colrev.ops.data.Data, params: str) -> None:
+        """Add as an endpoint"""
 
-        # Note : add fields interactively upon update_data()
-
-        structured_endpoint_details = {
+        add_source = {
             "endpoint": "colrev.structured",
             "version": "0.1",
             "fields": [],
             "data_path_relative": "data/data.csv",
         }
-        return structured_endpoint_details
+        operation.review_manager.settings.data.data_package_endpoints.append(add_source)
 
     def validate_structured_data(self) -> None:
         """Validate the extracted data"""
 
         if not self.data_path.is_file():
             return
```

### Comparing `colrev-0.9.2/colrev/ops/built_in/dedupe/active_learning_dedup_io.py` & `colrev-0.9.3/colrev/ops/built_in/dedupe/active_learning_dedup_io.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/dedupe/curation_dedupe.py` & `colrev-0.9.3/colrev/ops/built_in/dedupe/curation_dedupe.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/dedupe/curation_missing_dedupe.py` & `colrev-0.9.3/colrev/ops/built_in/dedupe/curation_missing_dedupe.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/dedupe/simple_dedupe.py` & `colrev-0.9.3/colrev/ops/built_in/dedupe/simple_dedupe.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/dedupe/utils.py` & `colrev-0.9.3/colrev/ops/built_in/dedupe/utils.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/pdf_get/local_index_pdf_get.py` & `colrev-0.9.3/colrev/ops/built_in/pdf_get/local_index_pdf_get.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/pdf_get/unpaywall.py` & `colrev-0.9.3/colrev/ops/built_in/pdf_get/unpaywall.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/pdf_get/website_screenshot.py` & `colrev-0.9.3/colrev/ops/built_in/pdf_get/website_screenshot.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/pdf_get_man/pdf_get_man_cli.py` & `colrev-0.9.3/colrev/ops/built_in/pdf_get_man/pdf_get_man_cli.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/pdf_prep/check_ocr.py` & `colrev-0.9.3/colrev/ops/built_in/pdf_prep/check_ocr.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/pdf_prep/completeness_validation.py` & `colrev-0.9.3/colrev/ops/built_in/pdf_prep/completeness_validation.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/pdf_prep/cover_page.py` & `colrev-0.9.3/colrev/ops/built_in/pdf_prep/cover_page.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/pdf_prep/last_page.py` & `colrev-0.9.3/colrev/ops/built_in/pdf_prep/last_page.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/pdf_prep/metadata_validation.py` & `colrev-0.9.3/colrev/ops/built_in/pdf_prep/metadata_validation.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/pdf_prep/tei_prep.py` & `colrev-0.9.3/colrev/ops/built_in/pdf_prep/tei_prep.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/pdf_prep_man/pdf_prep_man_cli.py` & `colrev-0.9.3/colrev/ops/built_in/pdf_prep_man/pdf_prep_man_cli.py`

 * *Files 4% similar despite different names*

```diff
@@ -135,22 +135,26 @@
             try:
                 pdf_prep_man_operation.extract_pages(
                     filepath=filepath, pages_to_remove=pages_to_exclude
                 )
             except colrev_exceptions.InvalidPDFException:
                 pass
 
+    def __is_inside_wsl(self) -> bool:
+        return "wsl" in platform.uname().release.lower()
+
     def __man_pdf_prep_item(
         self,
         *,
         filepath: Path,
         record: colrev.record.Record,
         pdf_prep_man_operation: colrev.ops.pdf_prep_man.PDFPrepMan,
     ) -> None:
-        self.__open_pdf(filepath=filepath)
+        if not self.__is_inside_wsl():
+            self.__open_pdf(filepath=filepath)
 
         # if PDF > 100 pages, we may check on which page we find the title & print
         intro_paragraph = (
             "Prepared?\n"
             "       (y)es, \n"
             "       (n)o/delete file,\n"
             "       (s)kip, (s10) to skip 10 records, or (q)uit,\n"
```

### Comparing `colrev-0.9.2/colrev/ops/built_in/prep/add_journal_ranking.md` & `colrev-0.9.3/colrev/ops/built_in/prep/add_journal_ranking.md`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/prep/add_journal_ranking.py` & `colrev-0.9.3/colrev/ops/built_in/prep/add_journal_ranking.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/prep/bibtex_crossref_resolution.py` & `colrev-0.9.3/colrev/ops/built_in/prep/bibtex_crossref_resolution.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/prep/citeas_prep.py` & `colrev-0.9.3/colrev/ops/built_in/prep/citeas_prep.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/prep/crossref_metadata_prep.py` & `colrev-0.9.3/colrev/ops/built_in/prep/crossref_metadata_prep.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/prep/curation_prep.py` & `colrev-0.9.3/colrev/ops/built_in/prep/curation_prep.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/prep/dblp_metadata_prep.py` & `colrev-0.9.3/colrev/ops/built_in/prep/dblp_metadata_prep.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/prep/doi_from_urls_prep.py` & `colrev-0.9.3/colrev/ops/built_in/prep/doi_from_urls_prep.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/prep/doi_metadata_prep.py` & `colrev-0.9.3/colrev/ops/built_in/prep/doi_metadata_prep.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/prep/europe_pmc_prep.py` & `colrev-0.9.3/colrev/ops/built_in/prep/europe_pmc_prep.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/prep/exclude_collections.py` & `colrev-0.9.3/colrev/ops/built_in/prep/exclude_collections.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/prep/exclude_complementary_materials.py` & `colrev-0.9.3/colrev/ops/built_in/prep/exclude_complementary_materials.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/prep/exclude_languages.py` & `colrev-0.9.3/colrev/ops/built_in/prep/exclude_languages.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/prep/exclude_non_latin_alphabets.py` & `colrev-0.9.3/colrev/ops/built_in/prep/exclude_non_latin_alphabets.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/prep/general_polish.py` & `colrev-0.9.3/colrev/ops/built_in/prep/general_polish.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/prep/local_index_prep.py` & `colrev-0.9.3/colrev/ops/built_in/prep/local_index_prep.py`

 * *Files 12% similar despite different names*

```diff
@@ -45,15 +45,19 @@
     def prepare(
         self, prep_operation: colrev.ops.prep.Prep, record: colrev.record.PrepRecord
     ) -> colrev.record.Record:
         """Prepare the record metadata based on local-index"""
 
         # don't move to  jour_iss_number_year prep
         # because toc-retrieval relies on adequate toc items!
-        if "volume" in record.data and "number" in record.data:
+        if (
+            "volume" in record.data
+            and "number" in record.data
+            and not record.masterdata_is_curated()
+        ):
             # Note : cannot use local_index as an attribute of PrepProcess
             # because it creates problems with multiprocessing
             fields_to_remove = self.local_index_source.local_index.get_fields_to_remove(
                 record_dict=record.get_data()
             )
             for field_to_remove in fields_to_remove:
                 if field_to_remove in record.data:
```

### Comparing `colrev-0.9.2/colrev/ops/built_in/prep/open_alex_metadata_prep.py` & `colrev-0.9.3/colrev/ops/built_in/prep/open_alex_metadata_prep.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/prep/open_library_prep.py` & `colrev-0.9.3/colrev/ops/built_in/prep/open_library_prep.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/prep/pubmed_metadata_prep.py` & `colrev-0.9.3/colrev/ops/built_in/prep/pubmed_metadata_prep.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/prep/remove_broken_ids.py` & `colrev-0.9.3/colrev/ops/built_in/prep/remove_broken_ids.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/prep/remove_error500_urls.py` & `colrev-0.9.3/colrev/ops/built_in/prep/remove_error500_urls.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/prep/semantic_scholar_prep.py` & `colrev-0.9.3/colrev/ops/built_in/prep/semantic_scholar_prep.py`

 * *Files 2% similar despite different names*

```diff
@@ -73,15 +73,15 @@
         # we therefore use the original ENTRYTYPE
         if "venue" in item:
             if "journal" in record_in.data:
                 retrieved_record.update(journal=item["venue"])
             if "booktitle" in record_in.data:
                 retrieved_record.update(booktitle=item["venue"])
         if "url" in item:
-            retrieved_record.update(sem_scholar_id=item["url"])
+            retrieved_record["colrev.semantic_scholar.id"] = item["url"]
 
         keys_to_drop = []
         for key, value in retrieved_record.items():
             retrieved_record[key] = str(value).replace("\n", " ").lstrip().rstrip()
             if value in ["", "None"] or value is None:
                 keys_to_drop.append(key)
         for key in keys_to_drop:
@@ -142,15 +142,15 @@
                 "https://api.semanticscholar.org/graph/v1/paper/search?query="
             )
             url = search_api_url + record.data.get("title", "").replace(" ", "+")
 
             retrieved_record = self.retrieve_record_from_semantic_scholar(
                 prep_operation=prep_operation, url=url, record_in=record
             )
-            if "sem_scholar_id" not in retrieved_record.data:
+            if "colrev.semantic_scholar.id" not in retrieved_record.data:
                 return record
 
             # Remove fields that are not/rarely available before
             # calculating similarity metrics
             orig_record = record.copy_prep_rec()
             for key in ["volume", "number", "number", "pages"]:
                 if key in orig_record.data:
@@ -166,15 +166,15 @@
                 # prep_operation.review_manager.logger.debug(
                 #     f"scholar similarity: {similarity} "
                 #     f"(>{prep_operation.retrieval_similarity})"
                 # )
 
                 record.merge(
                     merging_record=retrieved_record,
-                    default_source=retrieved_record.data["sem_scholar_id"],
+                    default_source=retrieved_record.data["colrev.semantic_scholar.id"],
                 )
 
             else:
                 # prep_operation.review_manager.logger.debug(
                 #     f"scholar similarity: {similarity} "
                 #     f"(<{prep_operation.retrieval_similarity})"
                 # )
```

### Comparing `colrev-0.9.2/colrev/ops/built_in/prep/source_specific_prep.py` & `colrev-0.9.3/colrev/ops/built_in/prep/source_specific_prep.py`

 * *Files 2% similar despite different names*

```diff
@@ -52,16 +52,15 @@
         # Note : we take the first origin (ie., the source-specific prep should
         # be one of the first in the prep-list)
         origin_source = record.data["colrev_origin"][0].split("/")[0]
 
         sources = [
             s
             for s in prep_operation.review_manager.settings.sources
-            if s.filename.with_suffix(".bib")
-            == Path("data/search") / Path(origin_source)
+            if s.filename == Path("data/search") / Path(origin_source)
         ]
 
         for source in sources:
             if source.endpoint not in self.search_sources.packages:
                 continue
             endpoint = self.search_sources.packages[source.endpoint]
```

### Comparing `colrev-0.9.2/colrev/ops/built_in/prep/update_masterdata_status.py` & `colrev-0.9.3/colrev/ops/built_in/prep/update_masterdata_status.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/prep/utils.py` & `colrev-0.9.3/colrev/ops/built_in/prep/utils.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/prep/year_vol_iss_prep.py` & `colrev-0.9.3/colrev/ops/built_in/prep/year_vol_iss_prep.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/prep_man/curation_jupyter_prep_man.py` & `colrev-0.9.3/colrev/ops/built_in/prep_man/curation_jupyter_prep_man.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/prep_man/prep_man_export.md` & `colrev-0.9.3/colrev/ops/built_in/prep_man/prep_man_export.md`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/prep_man/prep_man_export.py` & `colrev-0.9.3/colrev/ops/built_in/prep_man/prep_man_export.py`

 * *Files 1% similar despite different names*

```diff
@@ -107,15 +107,18 @@
 
         for record in records.values():
             if "file" in record:
                 target_path = self.review_manager.prep_dir / Path(record["file"])
                 target_path.parents[0].mkdir(exist_ok=True, parents=True)
 
                 if self.settings.pdf_handling_mode == "symlink":
-                    target_path.symlink_to(Path(record["file"]).resolve())
+                    try:
+                        target_path.symlink_to(Path(record["file"]).resolve())
+                    except FileExistsError:
+                        pass
 
                 if self.settings.pdf_handling_mode == "copy_first_page":
                     pdf_reader = PdfFileReader(str(record["file"]), strict=False)
                     if len(pdf_reader.pages) >= 1:
                         writer = PdfFileWriter()
                         writer.addPage(pdf_reader.pages[0])
                         with open(target_path, "wb") as outfile:
```

### Comparing `colrev-0.9.2/colrev/ops/built_in/prescreen/conditional_prescreen.py` & `colrev-0.9.3/colrev/ops/built_in/prescreen/conditional_prescreen.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/prescreen/prescreen_cli.py` & `colrev-0.9.3/colrev/ops/built_in/prescreen/prescreen_cli.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/prescreen/prescreen_table.py` & `colrev-0.9.3/colrev/ops/built_in/prescreen/prescreen_table.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/prescreen/scope_prescreen.md` & `colrev-0.9.3/colrev/ops/built_in/prescreen/scope_prescreen.md`

 * *Files 2% similar despite different names*

```diff
@@ -4,15 +4,15 @@
 
 1. The Scope Prescreen runs before a manual prescreen. In this case, papers are either marked as `rev_prescreen_excluded`, or remain `md_processed`. Afterwards, all papers in `md_processed` are prescreened manually based on their topic.
 2. The Scope Prescreen is the only prescreen package activated in the settings. In this case, papers are marked as `rev_prescreen_excluded` or `rev_prescreen_included`. Fully automated prescreening may not be appropriate for all types of reviews.
 
 The Scope Prescreen can be added as follows:
 
 ```
-colrev prescreen --add colrev.scope_prescreen:"TimeScopeFrom=2010"
+colrev prescreen -a colrev.scope_prescreen -p "TimeScopeFrom=2010"
 ```
 
 ## Method: __conditional_presecreen_not_in_ranking()
 
 Prerequesite:
 
 The endpoint colrev.add_journal_ranking in the settings of prep must be installed.
```

### Comparing `colrev-0.9.2/colrev/ops/built_in/prescreen/scope_prescreen.py` & `colrev-0.9.3/colrev/ops/built_in/prescreen/scope_prescreen.py`

 * *Files 3% similar despite different names*

```diff
@@ -227,39 +227,45 @@
                 target_state=colrev.record.RecordState.rev_prescreen_included
             )
             self.review_manager.report_logger.info(
                 f' {record.data["ID"]}'.ljust(50, " ")
                 + "Prescreen included (automatically)"
             )
 
-    def add_endpoint(self, *, params: dict) -> None:
+    @classmethod
+    def add_endpoint(cls, *, operation: colrev.ops.search.Search, params: str) -> None:
         """Add  the scope_prescreen as an endpoint"""
 
+        params_dict = {}
+        for p_el in params.split(";"):
+            key, value = p_el.split("=")
+            params_dict[key] = value
+
         for (
             existing_scope_prescreen
-        ) in self.review_manager.settings.prescreen.prescreen_package_endpoints:
+        ) in operation.review_manager.settings.prescreen.prescreen_package_endpoints:
             if existing_scope_prescreen["endpoint"] != "colrev.scope_prescreen":
                 continue
-            self.review_manager.logger.info(
+            operation.review_manager.logger.info(
                 "Integrating into existing colrev.scope_prescreen"
             )
-            for key, value in params.items():
+            for key, value in params_dict.items():
                 if (
                     key in existing_scope_prescreen
                     and existing_scope_prescreen[key] != value
                 ):
-                    self.review_manager.logger.info(
+                    operation.review_manager.logger.info(
                         f"Replacing {key} ({existing_scope_prescreen[key]} -> {value})"
                     )
                 existing_scope_prescreen[key] = value
             return
 
         # Insert (if not added before)
-        self.review_manager.settings.prescreen.prescreen_package_endpoints.insert(
-            0, {**{"endpoint": "colrev.scope_prescreen"}, **params}
+        operation.review_manager.settings.prescreen.prescreen_package_endpoints.insert(
+            0, {**{"endpoint": "colrev.scope_prescreen"}, **params_dict}
         )
 
     def run_prescreen(
         self,
         prescreen_operation: colrev.ops.prescreen.Prescreen,
         records: dict,
         split: list,  # pylint: disable=unused-argument
```

### Comparing `colrev-0.9.2/colrev/ops/built_in/review_types/conceptual_review.py` & `colrev-0.9.3/colrev/ops/built_in/review_types/conceptual_review.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/review_types/critical_review.py` & `colrev-0.9.3/colrev/ops/built_in/review_types/critical_review.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/review_types/curated_masterdata.md` & `colrev-0.9.3/colrev/ops/built_in/review_types/curated_masterdata.md`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/review_types/curated_masterdata.py` & `colrev-0.9.3/colrev/ops/built_in/review_types/curated_masterdata.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/review_types/descriptive_review.py` & `colrev-0.9.3/colrev/ops/built_in/review_types/descriptive_review.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/review_types/literature_review.py` & `colrev-0.9.3/colrev/ops/built_in/review_types/literature_review.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/review_types/meta_analysis.md` & `colrev-0.9.3/colrev/ops/built_in/review_types/meta_analysis.md`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/review_types/meta_analysis.py` & `colrev-0.9.3/colrev/ops/built_in/review_types/meta_analysis.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/review_types/narrative_review.py` & `colrev-0.9.3/colrev/ops/built_in/review_types/narrative_review.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/review_types/qualitative_systematic_review.md` & `colrev-0.9.3/colrev/ops/built_in/review_types/qualitative_systematic_review.md`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/review_types/qualitative_systematic_review.py` & `colrev-0.9.3/colrev/ops/built_in/review_types/qualitative_systematic_review.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/review_types/scientometric.md` & `colrev-0.9.3/colrev/ops/built_in/review_types/scientometric.md`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/review_types/scientometric.py` & `colrev-0.9.3/colrev/ops/built_in/review_types/scientometric.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/review_types/scoping_review.py` & `colrev-0.9.3/colrev/ops/built_in/review_types/scoping_review.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/review_types/theoretical_review.py` & `colrev-0.9.3/colrev/ops/built_in/review_types/theoretical_review.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/screen/screen_cli.py` & `colrev-0.9.3/colrev/ops/built_in/screen/screen_cli.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/screen/screen_table.py` & `colrev-0.9.3/colrev/ops/built_in/screen/screen_table.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/screen/utils.py` & `colrev-0.9.3/colrev/ops/built_in/screen/utils.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/search_sources/abi_inform_proquest.py` & `colrev-0.9.3/colrev/ops/built_in/search_sources/abi_inform_proquest.py`

 * *Files 5% similar despite different names*

```diff
@@ -39,38 +39,30 @@
     )
 
     def __init__(
         self, *, source_operation: colrev.operation.Operation, settings: dict
     ) -> None:
         self.search_source = from_dict(data_class=self.settings_class, data=settings)
         self.quality_model = source_operation.review_manager.get_qm()
+        self.review_manager = source_operation.review_manager
 
     @classmethod
     def heuristic(cls, filename: Path, data: str) -> dict:
         """Source heuristic for ABI/INFORM (ProQuest)"""
 
         result = {"confidence": 0.0}
 
         if "www.proquest.com" in data:  # nosec
             if data.count("www.proquest.com") >= data.count("\n@"):
                 result["confidence"] = 1.0
 
         return result
 
-    def validate_source(
-        self,
-        search_operation: colrev.ops.search.Search,
-        source: colrev.settings.SearchSource,
-    ) -> None:
-        """Validate the SearchSource (parameters etc.)"""
-
     @classmethod
-    def add_endpoint(
-        cls, search_operation: colrev.ops.search.Search, query: str
-    ) -> colrev.settings.SearchSource:
+    def add_endpoint(cls, operation: colrev.ops.search.Search, params: str) -> None:
         """Add SearchSource as an endpoint (based on query provided to colrev search -a )"""
         raise NotImplementedError
 
     def run_search(
         self, search_operation: colrev.ops.search.Search, rerun: bool
     ) -> None:
         """Run a search of ABI/INFORM"""
@@ -81,53 +73,54 @@
         record: colrev.record.Record,
         save_feed: bool = True,
         timeout: int = 10,
     ) -> colrev.record.Record:
         """Not implemented"""
         return record
 
+    def __remove_duplicates(self, *, records: dict) -> None:
+        to_delete = []
+        for record in records.values():
+            if re.search(r"-\d{1,2}$", record["ID"]):
+                original_record_id = re.sub(r"-\d{1,2}$", "", record["ID"])
+                if original_record_id not in records:
+                    continue
+                original_record = records[original_record_id]
+
+                # Note: between duplicate records,
+                # there are variations in spelling and completeness
+                if (
+                    colrev.record.Record.get_record_similarity(
+                        record_a=colrev.record.Record(data=record),
+                        record_b=colrev.record.Record(data=original_record),
+                    )
+                    < 0.9
+                ):
+                    continue
+
+                if original_record_id not in records:
+                    continue
+                to_delete.append(record["ID"])
+        if to_delete:
+            for rid in to_delete:
+                self.review_manager.logger.info(f" remove duplicate {rid}")
+                del records[rid]
+
+            self.review_manager.dataset.save_records_dict_to_file(
+                records=records, save_path=self.search_source.filename
+            )
+
     def load(self, load_operation: colrev.ops.load.Load) -> dict:
         """Load the records from the SearchSource file"""
 
         if self.search_source.filename.suffix == ".bib":
             records = colrev.ops.load_utils_bib.load_bib_file(
                 load_operation=load_operation, source=self.search_source
             )
-            to_delete = []
-            for record in records.values():
-                if re.search(r"-\d{1,2}$", record["ID"]):
-                    original_record_id = re.sub(r"-\d{1,2}$", "", record["ID"])
-                    if original_record_id not in records:
-                        continue
-                    original_record = records[original_record_id]
-
-                    # Note: between duplicate records,
-                    # there are variations in spelling and completeness
-                    if (
-                        colrev.record.Record.get_record_similarity(
-                            record_a=colrev.record.Record(data=record),
-                            record_b=colrev.record.Record(data=original_record),
-                        )
-                        < 0.9
-                    ):
-                        continue
-
-                    if original_record_id not in records:
-                        continue
-                    to_delete.append(record["ID"])
-            if to_delete:
-                for rid in to_delete:
-                    load_operation.review_manager.logger.info(
-                        f" remove duplicate {rid}"
-                    )
-                    del records[rid]
-
-                load_operation.review_manager.dataset.save_records_dict_to_file(
-                    records=records, save_path=self.search_source.filename
-                )
+            self.__remove_duplicates(records=records)
             return records
 
         raise NotImplementedError
 
     def prepare(
         self, record: colrev.record.Record, source: colrev.settings.SearchSource
     ) -> colrev.record.Record:
```

### Comparing `colrev-0.9.2/colrev/ops/built_in/search_sources/acm_digital_library.py` & `colrev-0.9.3/colrev/ops/built_in/search_sources/web_of_science.py`

 * *Files 16% similar despite different names*

```diff
@@ -1,104 +1,90 @@
 #! /usr/bin/env python
-"""SearchSource: ACM Digital Library"""
+"""SearchSource: Web of Science"""
 from __future__ import annotations
 
 from dataclasses import dataclass
 from pathlib import Path
 
 import zope.interface
 from dacite import from_dict
 from dataclasses_jsonschema import JsonSchemaMixin
 
 import colrev.env.package_manager
-import colrev.exceptions as colrev_exceptions
 import colrev.ops.load_utils_bib
 import colrev.ops.search
 import colrev.record
 
 # pylint: disable=unused-argument
 # pylint: disable=duplicate-code
 
 
 @zope.interface.implementer(
     colrev.env.package_manager.SearchSourcePackageEndpointInterface
 )
 @dataclass
-class ACMDigitalLibrarySearchSource(JsonSchemaMixin):
-    """SearchSource for the ACM digital Library"""
+class WebOfScienceSearchSource(JsonSchemaMixin):
+    """SearchSource for Web of Science"""
 
     settings_class = colrev.env.package_manager.DefaultSourceSettings
-    # Note : the ID contains the doi
-    # "https://dl.acm.org/doi/{{ID}}"
-    source_identifier = "doi"
+    source_identifier = (
+        "https://www.webofscience.com/wos/woscc/full-record/" + "{{unique-id}}"
+    )
     search_type = colrev.settings.SearchType.DB
     api_search_supported = False
     ci_supported: bool = False
     heuristic_status = colrev.env.package_manager.SearchSourceHeuristicStatus.supported
-    short_name = "ACM Digital Library"
+    short_name = "Web of Science"
     link = (
-        "https://github.com/CoLRev-Environment/colrev/blob/main/colrev/"
-        + "ops/built_in/search_sources/acm_digital_library.md"
+        "https://github.com/CoLRev-Environment/colrev/blob/main/"
+        + "colrev/ops/built_in/search_sources/web_of_science.md"
     )
 
     def __init__(
         self, *, source_operation: colrev.operation.Operation, settings: dict
     ) -> None:
         self.search_source = from_dict(data_class=self.settings_class, data=settings)
 
     @classmethod
     def heuristic(cls, filename: Path, data: str) -> dict:
-        """Source heuristic for ACM dDigital Library"""
+        """Source heuristic for Web of Science"""
 
         result = {"confidence": 0.0}
-        # Simple heuristic:
-        if "publisher = {Association for Computing Machinery}," in data:
+
+        if data.count("UT WOS:") > 0.4 * data.count("TI "):
+            result["confidence"] = 0.7
+            return result
+
+        if "Unique-ID = {WOS:" in data:
             result["confidence"] = 0.7
-            print(data)
             return result
-        # We may also check whether the ID=doi=url
+        if "UT_(Unique_WOS_ID) = {WOS:" in data:
+            result["confidence"] = 0.7
+            return result
+        if "@article{ WOS:" in data or "@article{WOS:" in data:
+            if data.count("{WOS:") > data.count("\n@"):
+                result["confidence"] = 1.0
+            elif data.count("{ WOS:") > data.count("\n@"):
+                result["confidence"] = 1.0
+            else:
+                result["confidence"] = 0.7
+
+            return result
+
         return result
 
     @classmethod
-    def add_endpoint(
-        cls, search_operation: colrev.ops.search.Search, query: str
-    ) -> colrev.settings.SearchSource:
+    def add_endpoint(cls, operation: colrev.ops.search.Search, params: str) -> None:
         """Add SearchSource as an endpoint (based on query provided to colrev search -a )"""
         raise NotImplementedError
 
-    def validate_source(
-        self,
-        search_operation: colrev.ops.search.Search,
-        source: colrev.settings.SearchSource,
-    ) -> None:
-        """Validate the SearchSource (parameters etc.)"""
-
-        search_operation.review_manager.logger.debug(
-            f"Validate SearchSource {source.filename}"
-        )
-
-        if "query_file" not in source.search_parameters:
-            raise colrev_exceptions.InvalidQueryException(
-                f"Source missing query_file search_parameter ({source.filename})"
-            )
-
-        if not Path(source.search_parameters["query_file"]).is_file():
-            raise colrev_exceptions.InvalidQueryException(
-                f"File does not exist: query_file {source.search_parameters['query_file']} "
-                f"for ({source.filename})"
-            )
-
-        search_operation.review_manager.logger.debug(
-            f"SearchSource {source.filename} validated"
-        )
-
     def run_search(
         self, search_operation: colrev.ops.search.Search, rerun: bool
     ) -> None:
-        """Run a search of ACM Digital Library"""
+        """Run a search of WebOfScience"""
 
     def get_masterdata(
         self,
         prep_operation: colrev.ops.prep.Prep,
         record: colrev.record.Record,
         save_feed: bool = True,
         timeout: int = 10,
@@ -114,18 +100,20 @@
                 load_operation=load_operation, source=self.search_source
             )
             return records
 
         raise NotImplementedError
 
     def prepare(
-        self, record: colrev.record.Record, source: colrev.settings.SearchSource
+        self, record: colrev.record.PrepRecord, source: colrev.settings.SearchSource
     ) -> colrev.record.Record:
-        """Source-specific preparation for ACM Digital Library"""
-        record.remove_field(key="url")
-        record.remove_field(key="numpages")
-        record.remove_field(key="issue_date")
-        record.remove_field(key="publisher")
-        record.remove_field(key="address")
-        record.remove_field(key="month")
+        """Source-specific preparation for Web of Science"""
+
+        record.format_if_mostly_upper(key="title", case="sentence")
+        record.format_if_mostly_upper(key="journal", case="title")
+        record.format_if_mostly_upper(key="booktitle", case="title")
+        record.format_if_mostly_upper(key="author", case="title")
+
+        record.remove_field(key="colrev.web_of_science.researcherid-numbers")
+        record.remove_field(key="colrev.web_of_science.orcid-numbers")
 
         return record
```

### Comparing `colrev-0.9.2/colrev/ops/built_in/search_sources/aisel.md` & `colrev-0.9.3/colrev/ops/built_in/search_sources/aisel.md`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/search_sources/aisel.py` & `colrev-0.9.3/colrev/ops/built_in/search_sources/aisel.py`

 * *Files 4% similar despite different names*

```diff
@@ -12,14 +12,15 @@
 import requests
 import zope.interface
 from dacite import from_dict
 from dataclasses_jsonschema import JsonSchemaMixin
 
 import colrev.env.package_manager
 import colrev.exceptions as colrev_exceptions
+import colrev.ops.load_utils_enl
 import colrev.ops.search
 import colrev.record
 
 # pylint: disable=unused-argument
 # pylint: disable=duplicate-code
 
 
@@ -29,14 +30,15 @@
 @dataclass
 class AISeLibrarySearchSource(JsonSchemaMixin):
     """SearchSource for the AIS electronic Library (AISeL)"""
 
     settings_class = colrev.env.package_manager.DefaultSourceSettings
     source_identifier = "url"
     search_type = colrev.settings.SearchType.DB
+    endpoint = "colrev.ais_library"
     api_search_supported = True
     ci_supported: bool = True
     heuristic_status = colrev.env.package_manager.SearchSourceHeuristicStatus.supported
     short_name = "AIS eLibrary"
     link = (
         "https://github.com/CoLRev-Environment/colrev/blob/main/"
         + "colrev/ops/built_in/search_sources/aisel.md"
@@ -142,71 +144,56 @@
         if start_date:
             params["start_date"] = start_date
         if end_date:
             params["end_date"] = end_date
         return params
 
     @classmethod
-    def add_endpoint(
-        cls, search_operation: colrev.ops.search.Search, query: str
-    ) -> colrev.settings.SearchSource:
+    def add_endpoint(cls, operation: colrev.ops.search.Search, params: str) -> None:
         """Add SearchSource as an endpoint (based on query provided to colrev search -a )"""
 
-        query = query.lstrip("colrev.ais_library:").rstrip('"').lstrip('"')
+        # if params is None:
+        #     operation.add_interactively(endpoint=cls.endpoint)
+        #     return
 
-        host = urlparse(query).hostname
+        params = params.lstrip("colrev.ais_library:").rstrip('"').lstrip('"')
+
+        host = urlparse(params).hostname
 
         if host and host.endswith("aisel.aisnet.org"):
-            params = cls.__parse_query(query=query)
-            filename = search_operation.get_unique_filename(file_path_string="ais")
+            q_params = cls.__parse_query(query=params)
+            filename = operation.get_unique_filename(file_path_string="ais")
             add_source = colrev.settings.SearchSource(
-                endpoint="colrev.ais_library",
+                endpoint=cls.endpoint,
                 filename=filename,
                 search_type=colrev.settings.SearchType.DB,
-                search_parameters={"query": params},
+                search_parameters={"query": q_params},
                 comment="",
             )
-            return add_source
+            operation.review_manager.settings.sources.append(add_source)
+            return
 
         raise colrev_exceptions.PackageParameterError(
-            f"Cannot add aisel endpoint with query {query}"
+            f"Cannot add aisel endpoint with query {q_params}"
         )
 
-    def validate_source(
-        self,
-        search_operation: colrev.ops.search.Search,
-        source: colrev.settings.SearchSource,
-    ) -> None:
+    def __validate_source(self) -> None:
         """Validate the SearchSource (parameters etc.)"""
 
-        search_operation.review_manager.logger.debug(
-            f"Validate SearchSource {source.filename}"
-        )
+        source = self.search_source
+
+        self.review_manager.logger.debug(f"Validate SearchSource {source.filename}")
 
         if "query" in source.search_parameters:
             if "search_terms" not in source.search_parameters["query"]:
                 raise colrev_exceptions.InvalidQueryException(
                     "query parameter does not contain search_terms"
                 )
 
-        # Note : can simply add files downloaded from AIS
-        # raise colrev_exceptions.InvalidQueryException(
-        #     f"Source missing query_file or query search_parameter ({source.filename})"
-        # )
-
-        if "query_file" in source.search_parameters:
-            if not Path(source.search_parameters["query_file"]).is_file():
-                raise colrev_exceptions.InvalidQueryException(
-                    f"File does not exist: query_file {source.search_parameters['query_file']} "
-                    f"for ({source.filename})"
-                )
-
-        search_operation.review_manager.logger.debug(
-            f"SearchSource {source.filename} validated"
-        )
+        self.review_manager.logger.debug(f"SearchSource {source.filename} validated")
 
     def __get_ais_query_return(self) -> list:
         def query_from_params(params: dict) -> str:
             final = ""
             for i in params["search_terms"]:
                 final = f"{final} {i['operator']} {i['field']}:{i['term']}".strip()
                 final = final.replace("All fields:", "")
@@ -306,37 +293,36 @@
             if "colrev_data_provenance" in prep_record.data:
                 del prep_record.data["colrev_data_provenance"]
 
             added = ais_feed.add_record(record=prep_record)
 
             if added:
                 self.review_manager.logger.info(" retrieve " + prep_record.data["url"])
-                ais_feed.nr_added += 1
             # else:
-            #     changed = search_operation.update_existing_record(
+            #     search_operation.update_existing_record(
             #         records=records,
             #         record_dict=prep_record.data,
             #         prev_record_dict_version=prev_record_dict_version,
             #         source=self.search_source,
             #         update_time_variant_fields=rerun,
             #     )
-            #     if changed:
-            #         ais_feed.nr_changed += 1
 
         ais_feed.print_post_run_search_infos(records=records)
 
         ais_feed.save_feed_file()
         search_operation.review_manager.dataset.save_records_dict(records=records)
         search_operation.review_manager.dataset.add_record_changes()
 
     def run_search(
         self, search_operation: colrev.ops.search.Search, rerun: bool
     ) -> None:
         """Run a search of AISeLibrary"""
 
+        self.__validate_source()
+
         ais_feed = self.search_source.get_feed(
             review_manager=search_operation.review_manager,
             source_identifier=self.source_identifier,
             update_only=(not rerun),
         )
 
         try:
@@ -370,14 +356,28 @@
     ) -> colrev.record.Record:
         """Not implemented"""
         return record
 
     def load(self, load_operation: colrev.ops.load.Load) -> dict:
         """Load the records from the SearchSource file"""
 
+        if self.search_source.filename.suffix in [".txt", ".enl"]:
+            enl_loader = colrev.ops.load_utils_enl.ENLLoader(
+                load_operation=load_operation, source=self.search_source
+            )
+            records = enl_loader.load(source=self.search_source)
+            return records
+
+        # for API-based searches
+        if self.search_source.filename.suffix == ".bib":
+            records = colrev.ops.load_utils_bib.load_bib_file(
+                load_operation=load_operation, source=self.search_source
+            )
+            return records
+
         raise NotImplementedError
 
     def __fix_entrytype(self, *, record: colrev.record.Record) -> None:
         # Note : simple heuristic
         # but at the moment, AISeLibrary only indexes articles and conference papers
         if (
             record.data.get("volume", "UNKNOWN") != "UNKNOWN"
@@ -427,18 +427,33 @@
             ]:
                 if "https://aisel.aisnet.org/ecis" in record.data.get("url", ""):
                     record.update_field(
                         key="booktitle", value="ECIS", source="prep_ais_source"
                     )
 
     def __unify_container_titles(self, *, record: colrev.record.Record) -> None:
-        if record.data.get("journal", "") == "Management Information Systems Quarterly":
+        if "https://aisel.aisnet.org/misq/" in record.data.get("url", ""):
             record.update_field(
                 key="journal", value="MIS Quarterly", source="prep_ais_source"
             )
+            record.remove_field(key="booktitle")
+
+        if "https://aisel.aisnet.org/misqe/" in record.data.get("url", ""):
+            record.update_field(
+                key="journal", value="MIS Quarterly Executive", source="prep_ais_source"
+            )
+            record.remove_field(key="booktitle")
+
+        if "https://aisel.aisnet.org/bise/" in record.data.get("url", ""):
+            record.update_field(
+                key="journal",
+                value="Business & Information Systems Engineering",
+                source="prep_ais_source",
+            )
+            record.remove_field(key="booktitle")
 
         if record.data["ENTRYTYPE"] == "inproceedings":
             for conf_abbreviation, conf_name in self.__conference_abbreviations.items():
                 if conf_abbreviation in record.data.get("booktitle", ""):
                     record.update_field(
                         key="booktitle",
                         value=conf_name,
@@ -449,21 +464,14 @@
             if link_part in record.data.get("url", ""):
                 record.update_field(
                     key="booktitle",
                     value=conf_name,
                     source="prep_ais_source",
                 )
 
-        if "https://aisel.aisnet.org/bise/" in record.data.get("url", ""):
-            record.update_field(
-                key="journal",
-                value="Business & Information Systems Engineering",
-                source="prep_ais_source",
-            )
-
     def __format_fields(self, *, record: colrev.record.Record) -> None:
         if "abstract" in record.data:
             if record.data["abstract"] == "N/A":
                 record.remove_field(key="abstract")
         if "author" in record.data:
             record.update_field(
                 key="author",
```

### Comparing `colrev-0.9.2/colrev/ops/built_in/search_sources/colrev_project.py` & `colrev-0.9.3/colrev/ops/built_in/search_sources/colrev_project.py`

 * *Files 6% similar despite different names*

```diff
@@ -32,14 +32,15 @@
 @dataclass
 class ColrevProjectSearchSource(JsonSchemaMixin):
     """Performs a search in a CoLRev project"""
 
     settings_class = colrev.env.package_manager.DefaultSourceSettings
     source_identifier = "colrev_project_identifier"
     search_type = colrev.settings.SearchType.OTHER
+    endpoint = "colrev.colrev_project"
     api_search_supported = True
     ci_supported: bool = True
     heuristic_status = colrev.env.package_manager.SearchSourceHeuristicStatus.supported
     short_name = "CoLRev project"
     link = (
         "https://github.com/CoLRev-Environment/colrev/blob/main/"
         + "colrev/ops/built_in/search_sources/colrev_project.md"
@@ -47,54 +48,52 @@
 
     def __init__(
         self, *, source_operation: colrev.operation.Operation, settings: dict
     ) -> None:
         self.search_source = from_dict(data_class=self.settings_class, data=settings)
         self.review_manager = source_operation.review_manager
 
-    def validate_source(
-        self,
-        search_operation: colrev.ops.search.Search,
-        source: colrev.settings.SearchSource,
-    ) -> None:
+    def __validate_source(self) -> None:
         """Validate the SearchSource (parameters etc.)"""
+        source = self.search_source
 
-        search_operation.review_manager.logger.debug(
-            f"Validate SearchSource {source.filename}"
-        )
+        self.review_manager.logger.debug(f"Validate SearchSource {source.filename}")
 
         if "scope" not in source.search_parameters:
             raise colrev_exceptions.InvalidQueryException(
                 "scope required in search_parameters"
             )
         if "url" not in source.search_parameters["scope"]:
             raise colrev_exceptions.InvalidQueryException(
                 "url field required in search_parameters"
             )
 
-        search_operation.review_manager.logger.debug(
-            f"SearchSource {source.filename} validated"
-        )
+        self.review_manager.logger.debug(f"SearchSource {source.filename} validated")
 
     @classmethod
-    def add_endpoint(
-        cls, search_operation: colrev.ops.search.Search, query: str
-    ) -> colrev.settings.SearchSource:
+    def add_endpoint(cls, operation: colrev.ops.search.Search, params: str) -> None:
         """Add SearchSource as an endpoint (based on query provided to colrev search -a )"""
-        if query.startswith("url="):
-            filename = search_operation.get_unique_filename(
-                file_path_string=query.split("/")[-1]
+
+        if params is None:
+            operation.add_interactively(endpoint=cls.endpoint)
+            return
+
+        if params.startswith("url="):
+            filename = operation.get_unique_filename(
+                file_path_string=params.split("/")[-1]
             )
-            return colrev.settings.SearchSource(
-                endpoint="colrev.colrev_project",
+            add_source = colrev.settings.SearchSource(
+                endpoint=cls.endpoint,
                 filename=filename,
                 search_type=colrev.settings.SearchType.OTHER,
-                search_parameters={"scope": {"url": query[4:]}},
+                search_parameters={"scope": {"url": params[4:]}},
                 comment="",
             )
+            operation.review_manager.settings.sources.append(add_source)
+            return
 
         raise NotImplementedError
 
     def __load_records_to_import(self, *, project_url: str, project_name: str) -> dict:
         temp_path = tempfile.gettempdir() / Path(project_name)
         temp_path.mkdir()
         Repo.clone_from(project_url, temp_path, depth=1)
@@ -127,14 +126,16 @@
     ) -> None:
         """Run a search of a CoLRev project"""
 
         # pylint: disable=too-many-locals
         # pdf_get_operation =
         # self.review_manager.get_pdf_get_operation(notify_state_transition_operation=False)
 
+        self.__validate_source()
+
         colrev_project_search_feed = self.search_source.get_feed(
             review_manager=search_operation.review_manager,
             source_identifier=self.source_identifier,
             update_only=(not rerun),
         )
         project_url = self.search_source.search_parameters["scope"]["url"]
         project_name = project_url.split("/")[-1].rstrip(".git")
@@ -194,19 +195,18 @@
             ] = f"{project_url}#{record_to_import['ID']}"
             record_to_import = {
                 k: v for k, v in record_to_import.items() if k not in keys_to_drop
             }
 
             try:
                 colrev_project_search_feed.set_id(record_dict=record_to_import)
-                added = colrev_project_search_feed.add_record(
+                colrev_project_search_feed.add_record(
                     record=colrev.record.Record(data=record_to_import),
                 )
-                if added:
-                    colrev_project_search_feed.nr_added += 1
+
             except colrev_exceptions.NotFeedIdentifiableException:
                 print("not identifiable")
                 continue
 
         colrev_project_search_feed.print_post_run_search_infos(records=records)
         colrev_project_search_feed.save_feed_file()
```

### Comparing `colrev-0.9.2/colrev/ops/built_in/search_sources/crossref.py` & `colrev-0.9.3/colrev/ops/built_in/search_sources/crossref.py`

 * *Files 9% similar despite different names*

```diff
@@ -33,24 +33,26 @@
 
 if TYPE_CHECKING:
     import colrev.ops.search
     import colrev.ops.prep
 
 # pylint: disable=unused-argument
 # pylint: disable=duplicate-code
+# pylint: disable=too-many-lines
 
 
 @zope.interface.implementer(
     colrev.env.package_manager.SearchSourcePackageEndpointInterface
 )
 @dataclass
 class CrossrefSearchSource(JsonSchemaMixin):
     """SearchSource for the Crossref API"""
 
     __ISSN_REGEX = r"^\d{4}-?\d{3}[\dxX]$"
+    __YEAR_SCOPE_REGEX = r"^\d{4}-\d{4}$"
 
     # https://github.com/CrossRef/rest-api-doc
     __api_url = "https://api.crossref.org/works?"
 
     settings_class = colrev.env.package_manager.DefaultSourceSettings
     source_identifier = "doi"
     # "https://api.crossref.org/works/{{doi}}"
@@ -181,37 +183,32 @@
 
             retrieved_record_dict = connector_utils.json_to_record(
                 item=crossref_query_return
             )
             retrieved_record = colrev.record.PrepRecord(data=retrieved_record_dict)
             return retrieved_record
 
-        except (
-            requests.exceptions.JSONDecodeError,
-            requests.exceptions.ConnectTimeout,
-        ) as exc:
+        except (requests.exceptions.RequestException,) as exc:
             raise colrev_exceptions.RecordNotFoundInPrepSourceException(
                 msg="Record not found in crossref (based on doi)"
             ) from exc
 
-    def __query_journal(
-        self, *, journal_issn: str, rerun: bool
-    ) -> typing.Iterator[dict]:
+    def __query_journal(self, *, issn: str, rerun: bool) -> typing.Iterator[dict]:
         """Get records of a selected journal from Crossref"""
 
-        assert re.match(self.__ISSN_REGEX, journal_issn)
+        assert re.match(self.__ISSN_REGEX, issn)
 
         journals = Journals(etiquette=self.etiquette)
         if rerun:
             # Note : the "deposited" field is not always provided.
             # only the general query will return all records.
-            crossref_query_return = journals.works(journal_issn).query()
+            crossref_query_return = journals.works(issn).query()
         else:
             crossref_query_return = (
-                journals.works(journal_issn).query().sort("deposited").order("desc")
+                journals.works(issn).query().sort("deposited").order("desc")
             )
 
         yield from crossref_query_return
 
     def __create_query_url(
         self, *, record: colrev.record.Record, jour_vol_iss_list: bool
     ) -> str:
@@ -604,37 +601,38 @@
         #         record=record,
         #         timeout=timeout,
         #         save_feed=save_feed,
         #     )
 
         return record
 
-    def validate_source(
-        self,
-        search_operation: colrev.ops.search.Search,
-        source: colrev.settings.SearchSource,
-    ) -> None:
+    def __validate_source(self) -> None:
         """Validate the SearchSource (parameters etc.)"""
-
-        search_operation.review_manager.logger.debug(
-            f"Validate SearchSource {source.filename}"
-        )
+        source = self.search_source
+        self.review_manager.logger.debug(f"Validate SearchSource {source.filename}")
 
         if source.filename.name != self.__crossref_md_filename.name:
             if not any(x in source.search_parameters for x in ["query", "scope"]):
                 raise colrev_exceptions.InvalidQueryException(
-                    "Crossref search_parameters requires a query or journal_issn field"
+                    "Crossref search_parameters requires a query or issn field"
                 )
 
             if "scope" in source.search_parameters:
-                if "journal_issn" in source.search_parameters["scope"]:
-                    issn_field = source.search_parameters["scope"]["journal_issn"]
-                    if not re.match(self.__ISSN_REGEX, issn_field):
+                if "issn" in source.search_parameters["scope"]:
+                    assert isinstance(source.search_parameters["scope"]["issn"], list)
+                    for issn_field in source.search_parameters["scope"]["issn"]:
+                        if not re.match(self.__ISSN_REGEX, issn_field):
+                            raise colrev_exceptions.InvalidQueryException(
+                                f"Crossref journal issn ({issn_field}) not matching required format"
+                            )
+                elif "years" in source.search_parameters["scope"]:
+                    years_field = source.search_parameters["scope"]["years"]
+                    if not re.match(self.__YEAR_SCOPE_REGEX, years_field):
                         raise colrev_exceptions.InvalidQueryException(
-                            f"Crossref journal issn ({issn_field}) not matching required format"
+                            f"Scope (years) ({years_field}) not matching required format"
                         )
                 else:
                     raise colrev_exceptions.InvalidQueryException(
                         "Query missing valid parameters"
                     )
 
             elif "query" in source.search_parameters:
@@ -653,36 +651,31 @@
                 colrev.settings.SearchType.DB,
                 colrev.settings.SearchType.TOC,
             ]:
                 raise colrev_exceptions.InvalidQueryException(
                     "Crossref search_type should be in [DB,TOC]"
                 )
 
-        search_operation.review_manager.logger.debug(
-            f"SearchSource {source.filename} validated"
-        )
+        self.review_manager.logger.debug(f"SearchSource {source.filename} validated")
 
     def __get_crossref_query_return(self, *, rerun: bool) -> typing.Iterator[dict]:
         params = self.search_source.search_parameters
 
-        if "scope" in params:
-            if "journal_issn" in params["scope"]:
-                for journal_issn in params["scope"]["journal_issn"].split("|"):
-                    yield from self.__query_journal(
-                        journal_issn=journal_issn, rerun=rerun
-                    )
-        else:
-            if "query" in params:
-                crossref_query = {"bibliographic": params["query"]}
-                # potential extension : add the container_title:
-                # crossref_query_return = works.query(
-                #     container_title=
-                #       "Journal of the Association for Information Systems"
-                # )
-                yield from self.__query(**crossref_query)
+        if "query" in params and "mode" not in params:
+            crossref_query = {"bibliographic": params["query"].replace(" ", "+")}
+            # potential extension : add the container_title:
+            # crossref_query_return = works.query(
+            #     container_title=
+            #       "Journal of the Association for Information Systems"
+            # )
+            yield from self.__query(**crossref_query)
+        elif "scope" in params and "issn" in params["scope"]:
+            if "issn" in params["scope"]:
+                for issn in params["scope"]["issn"]:
+                    yield from self.__query_journal(issn=issn, rerun=rerun)
 
     def __restore_url(
         self,
         *,
         record: colrev.record.Record,
         feed: colrev.ops.search_feed.GeneralOriginFeed,
     ) -> None:
@@ -729,109 +722,206 @@
                 prev_record_dict_version = crossref_feed.feed_records[
                     retrieved_record.data["ID"]
                 ]
 
             self.__restore_url(record=retrieved_record, feed=crossref_feed)
             crossref_feed.add_record(record=retrieved_record)
 
-            changed = crossref_feed.update_existing_record(
+            crossref_feed.update_existing_record(
                 records=records,
                 record_dict=retrieved_record.data,
                 prev_record_dict_version=prev_record_dict_version,
                 source=self.search_source,
                 update_time_variant_fields=rerun,
             )
-            if changed:
-                crossref_feed.nr_changed += 1
 
-        if crossref_feed.nr_changed > 0:
-            self.review_manager.logger.info(
-                f"{colors.GREEN}Updated {crossref_feed.nr_changed} "
-                f"records based on Crossref{colors.END}"
-            )
-        else:
-            if records:
-                self.review_manager.logger.info(
-                    f"{colors.GREEN}Records (data/records.bib) up-to-date with Crossref{colors.END}"
-                )
+        crossref_feed.print_post_run_search_infos(records=records)
+        crossref_feed.save_feed_file()
+        search_operation.review_manager.dataset.save_records_dict(records=records)
+        search_operation.review_manager.dataset.add_record_changes()
+
+    def __scope_excluded(self, *, retrieved_record_dict: dict) -> bool:
+        if (
+            "scope" not in self.search_source.search_parameters
+            or "years" not in self.search_source.search_parameters["scope"]
+        ):
+            return False
+        year_from, year_to = self.search_source.search_parameters["scope"][
+            "years"
+        ].split("-")
+        if not retrieved_record_dict.get("year", -1000).isdigit():
+            return True
+        if (
+            int(year_from)
+            <= int(retrieved_record_dict.get("year", -1000))
+            <= int(year_to)
+        ):
+            return False
+        return True
+
+    def __run_keyword_exploration_search(
+        self,
+        search_operation: colrev.ops.search.Search,
+        crossref_feed: colrev.ops.search_feed.GeneralOriginFeed,
+    ) -> None:
+        works = Works(etiquette=self.etiquette)
+
+        def retrieve_exploratory_papers(keyword: str) -> typing.Iterator[dict]:
+            crossref_query_return = works.query(bibliographic=keyword.replace(" ", "+"))
+            yield from crossref_query_return
+
+        records = search_operation.review_manager.dataset.load_records_dict()
+        available_dois = [x["doi"] for x in records.values() if "doi" in x]
+
+        covered_keywords = [
+            x["explored_keyword"] for x in crossref_feed.feed_records.values()
+        ]
+
+        for keyword in self.search_source.search_parameters["query"].split(" OR "):
+            self.review_manager.logger.info(f"Explore '{keyword}'")
+            # Skip keywords that were already explored
+            if keyword in covered_keywords:
+                continue
+            nr_added = 0
+            for item in retrieve_exploratory_papers(keyword=keyword):
+                try:
+                    retrieved_record_dict = connector_utils.json_to_record(item=item)
+
+                    # Skip papers that do not have the keyword in the title
+                    if keyword not in retrieved_record_dict.get(
+                        "title", ""
+                    ).lower().replace("-", " "):
+                        continue
+
+                    # Skip papers that were already retrieved
+                    if retrieved_record_dict["doi"] in available_dois:
+                        continue
+                    retrieved_record_dict["explored_keyword"] = keyword
+                    crossref_feed.set_id(record_dict=retrieved_record_dict)
+                    retrieved_record = colrev.record.Record(data=retrieved_record_dict)
+                    self.__prep_crossref_record(
+                        record=retrieved_record, prep_main_record=False
+                    )
+
+                    self.__restore_url(record=retrieved_record, feed=crossref_feed)
+
+                    added = crossref_feed.add_record(record=retrieved_record)
+
+                    if added:
+                        nr_added += 1
+                        search_operation.review_manager.logger.info(
+                            " retrieve " + retrieved_record.data["doi"]
+                        )
+                    if nr_added >= 10:
+                        break
+
+                except (
+                    colrev_exceptions.RecordNotParsableException,
+                    colrev_exceptions.NotFeedIdentifiableException,
+                    KeyError  # error in crossref package:
+                    # if len(result['message']['items']) == 0:
+                    # KeyError: 'items'
+                ):
+                    pass
+                if nr_added < 10:
+                    self.review_manager.logger.info(
+                        f"Only {nr_added} papers found to resample keyword '{keyword}'"
+                    )
+
+        crossref_feed.print_post_run_search_infos(records=records)
 
         crossref_feed.save_feed_file()
         search_operation.review_manager.dataset.save_records_dict(records=records)
         search_operation.review_manager.dataset.add_record_changes()
 
+        self.review_manager.dataset.format_records_file()
+        self.review_manager.dataset.add_record_changes()
+        self.review_manager.dataset.add_changes(path=self.search_source.filename)
+        self.review_manager.create_commit(msg="Run search")
+
     def __run_parameter_search(
         self,
         *,
         search_operation: colrev.ops.search.Search,
         crossref_feed: colrev.ops.search_feed.GeneralOriginFeed,
         rerun: bool,
     ) -> None:
         if rerun:
             search_operation.review_manager.logger.info(
                 "Performing a search of the full history (may take time)"
             )
 
+        if self.search_source.search_parameters.get("mode", "") == "resample_keywords":
+            self.__run_keyword_exploration_search(
+                search_operation=search_operation, crossref_feed=crossref_feed
+            )
+            return
+
         records = search_operation.review_manager.dataset.load_records_dict()
         for item in self.__get_crossref_query_return(rerun=rerun):
             try:
                 retrieved_record_dict = connector_utils.json_to_record(item=item)
                 crossref_feed.set_id(record_dict=retrieved_record_dict)
                 prev_record_dict_version = {}
                 if retrieved_record_dict["ID"] in crossref_feed.feed_records:
                     prev_record_dict_version = deepcopy(
                         crossref_feed.feed_records[retrieved_record_dict["ID"]]
                     )
 
+                if self.__scope_excluded(retrieved_record_dict=retrieved_record_dict):
+                    continue
                 retrieved_record = colrev.record.Record(data=retrieved_record_dict)
                 self.__prep_crossref_record(
                     record=retrieved_record, prep_main_record=False
                 )
 
                 self.__restore_url(record=retrieved_record, feed=crossref_feed)
 
                 added = crossref_feed.add_record(record=retrieved_record)
 
                 if added:
                     search_operation.review_manager.logger.info(
                         " retrieve " + retrieved_record.data["doi"]
                     )
-                    crossref_feed.nr_added += 1
                 else:
-                    changed = crossref_feed.update_existing_record(
+                    crossref_feed.update_existing_record(
                         records=records,
                         record_dict=retrieved_record.data,
                         prev_record_dict_version=prev_record_dict_version,
                         source=self.search_source,
                         update_time_variant_fields=rerun,
                     )
-                    if changed:
-                        crossref_feed.nr_changed += 1
 
                 # Note : only retrieve/update the latest deposits (unless in rerun mode)
                 if not added and not rerun:
                     # problem: some publishers don't necessarily
                     # deposit papers chronologically
                     break
             except (
                 colrev_exceptions.RecordNotParsableException,
                 colrev_exceptions.NotFeedIdentifiableException,
+                KeyError  # error in crossref package:
+                # if len(result['message']['items']) == 0:
+                # KeyError: 'items'
             ):
                 pass
 
         crossref_feed.print_post_run_search_infos(records=records)
 
         crossref_feed.save_feed_file()
         search_operation.review_manager.dataset.save_records_dict(records=records)
         search_operation.review_manager.dataset.add_record_changes()
 
     def run_search(
         self, search_operation: colrev.ops.search.Search, rerun: bool
     ) -> None:
         """Run a search of Crossref"""
 
+        self.__validate_source()
+
         crossref_feed = self.search_source.get_feed(
             review_manager=search_operation.review_manager,
             source_identifier=self.source_identifier,
             update_only=(not rerun),
         )
 
         try:
@@ -847,18 +937,15 @@
 
             else:
                 self.__run_parameter_search(
                     search_operation=search_operation,
                     crossref_feed=crossref_feed,
                     rerun=rerun,
                 )
-        except (
-            requests.exceptions.Timeout,
-            requests.exceptions.JSONDecodeError,
-        ) as exc:
+        except (requests.exceptions.RequestException,) as exc:
             # watch github issue:
             # https://github.com/fabiobatalha/crossrefapi/issues/46
             if "504 Gateway Time-out" in str(exc):
                 raise colrev_exceptions.ServiceNotAvailableException(
                     self.__availability_exception_message
                 )
             raise colrev_exceptions.ServiceNotAvailableException(
@@ -870,94 +957,121 @@
         """Source heuristic for Crossref"""
 
         result = {"confidence": 0.0}
 
         return result
 
     @classmethod
-    def add_endpoint(
-        cls, search_operation: colrev.ops.search.Search, query: str
-    ) -> colrev.settings.SearchSource:
-        """Add SearchSource as an endpoint (based on query provided to colrev search -a )"""
-
-        if "https://search.crossref.org/?q=" in query:
-            query = (
-                query.replace("https://search.crossref.org/?q=", "")
+    def add_endpoint(cls, operation: colrev.ops.search.Search, params: str) -> None:
+        """Add SearchSource as an endpoint"""
+
+        if params and "https://search.crossref.org/?q=" in params:
+            params = (
+                params.replace("https://search.crossref.org/?q=", "")
                 .replace("&from_ui=yes", "")
                 .lstrip("+")
             )
 
-            filename = search_operation.get_unique_filename(
-                file_path_string=f"crossref_{query}"
+            filename = operation.get_unique_filename(
+                file_path_string=f"crossref_{params}"
             )
             add_source = colrev.settings.SearchSource(
                 endpoint="colrev.crossref",
                 filename=filename,
                 search_type=colrev.settings.SearchType.DB,
-                search_parameters={"query": query},
+                search_parameters={"query": params},
                 comment="",
             )
-            return add_source
+            operation.review_manager.settings.sources.append(add_source)
+            return
+
+        if params is not None:
+            params_dict: typing.Dict[str, typing.Any] = {"scope": {}}
+            for item in params.split(";"):
+                key, value = item.split("=")
+                if key in ["issn", "years"]:
+                    params_dict["scope"][key] = value
+                else:
+                    params_dict[key] = value
+            if not params_dict["scope"]:
+                del params_dict["scope"]
+
+            if "scope" not in params_dict and "query" not in params_dict:
+                raise colrev_exceptions.InvalidQueryException(
+                    "Query parameters must contain query or scope (such as issn)"
+                )
 
-        if query.startswith("issn="):
-            query = query.replace("issn=", "")
-            filename = search_operation.get_unique_filename(
-                file_path_string=f"crossref_issn_{query}"
+            filename = operation.get_unique_filename(
+                file_path_string=f"crossref_{params}"
             )
             add_source = colrev.settings.SearchSource(
                 endpoint="colrev.crossref",
                 filename=filename,
                 search_type=colrev.settings.SearchType.DB,
-                search_parameters={"scope": {"journal_issn": query}},
+                search_parameters=params_dict,
                 comment="",
             )
-            return add_source
+            operation.review_manager.settings.sources.append(add_source)
+            return
+        cls.__add_interactively(operation=operation)
+
+    @classmethod
+    def __add_interactively(cls, *, operation: colrev.ops.search.Search) -> None:
         print("Interactively add Crossref as a SearchSource")
         print()
         print("Documentation:")
         print(
             "https://github.com/CoLRev-Environment/colrev/blob/"
             + "main/colrev/ops/built_in/search_sources/crossref.md"
         )
         print()
         query_type = ""
         while query_type not in ["j", "k"]:
             query_type = input("Create a query based on [k]eywords or [j]ournal?")
         if query_type == "j":
             print("Get ISSN from https://portal.issn.org/issn/search")
+
             issn = ""
-            while not re.match(cls.__ISSN_REGEX, issn):
-                issn = input("Enter the ISSN of the journal:")
-            filename = search_operation.get_unique_filename(
+            while True:
+                issn = input("Enter the ISSN (or journal name to lookup the ISSN):")
+                if re.match(cls.__ISSN_REGEX, issn):
+                    break
+
+                journals = Journals()
+                ret = journals.query(issn)
+                for jour in ret:
+                    print(f"{jour['title']}: {','.join(jour['ISSN'])}")
+
+            filename = operation.get_unique_filename(
                 file_path_string=f"crossref_issn_{issn}"
             )
             add_source = colrev.settings.SearchSource(
                 endpoint="colrev.crossref",
                 filename=filename,
                 search_type=colrev.settings.SearchType.DB,
-                search_parameters={"scope": {"journal_issn": issn}},
+                search_parameters={"scope": {"issn": [issn]}},
                 comment="",
             )
-            return add_source
+            operation.review_manager.settings.sources.append(add_source)
+            return
+
         # if query_type == "k":
         keywords = input("Enter the keywords:")
-        keywords = keywords.replace(" ", "+")
-        query = f"https://search.crossref.org/?q={keywords}"
 
-        filename = search_operation.get_unique_filename(
+        filename = operation.get_unique_filename(
             file_path_string=f"crossref_{keywords}"
         )
         add_source = colrev.settings.SearchSource(
             endpoint="colrev.crossref",
             filename=filename,
             search_type=colrev.settings.SearchType.DB,
             search_parameters={"query": keywords},
             comment="",
         )
-        return add_source
+        operation.review_manager.settings.sources.append(add_source)
 
     def load(self, load_operation: colrev.ops.load.Load) -> dict:
         """Load the records from the SearchSource file"""
 
         if self.search_source.filename.suffix == ".bib":
             records = colrev.ops.load_utils_bib.load_bib_file(
                 load_operation=load_operation, source=self.search_source
```

### Comparing `colrev-0.9.2/colrev/ops/built_in/search_sources/dblp.md` & `colrev-0.9.3/colrev/ops/built_in/search_sources/dblp.md`

 * *Files 1% similar despite different names*

```diff
@@ -11,11 +11,11 @@
 License: [Open Data Commons ODC-BY 1.0 license](https://dblp.org/db/about/copyright.html)
 
 ## Add the search source
 
 Run a search on dblp.org and paste the url in the following command:
 
 ```
-colrev search -a colrev.dblp:"https://dblp.org/search?q=microsourcing"
+colrev search -a colrev.dblp -p "https://dblp.org/search?q=microsourcing"
 ```
 
 ## Links
```

### Comparing `colrev-0.9.2/colrev/ops/built_in/search_sources/dblp.py` & `colrev-0.9.3/colrev/ops/built_in/search_sources/dblp.py`

 * *Files 4% similar despite different names*

```diff
@@ -37,14 +37,15 @@
 
     __api_url = "https://dblp.org/search/publ/api?q="
     __api_url_venues = "https://dblp.org/search/venue/api?q="
     __START_YEAR = 1980
 
     source_identifier = "dblp_key"
     search_type = colrev.settings.SearchType.DB
+    endpoint = "colrev.dblp"
     api_search_supported = True
     ci_supported: bool = True
     heuristic_status = colrev.env.package_manager.SearchSourceHeuristicStatus.supported
     short_name = "DBLP"
     link = (
         "https://github.com/CoLRev-Environment/colrev/blob/main/"
         + "colrev/ops/built_in/search_sources/dblp.md"
@@ -91,15 +92,15 @@
                 for s in source_operation.review_manager.settings.sources
                 if s.filename == self.__dblp_md_filename
             ]
             if dblp_md_source_l:
                 self.search_source = dblp_md_source_l[0]
             else:
                 self.search_source = colrev.settings.SearchSource(
-                    endpoint="colrev.dblp",
+                    endpoint=self.endpoint,
                     filename=self.__dblp_md_filename,
                     search_type=colrev.settings.SearchType.OTHER,
                     search_parameters={},
                     comment="",
                 )
         self.dblp_lock = Lock()
         self.origin_prefix = self.search_source.get_origin_prefix()
@@ -201,14 +202,24 @@
             rpos = item["key"].rfind("/")
             ven_key = item["key"][lpos:rpos]
             item["booktitle"] = self.__get_dblp_venue(
                 session=session,
                 venue_string=ven_key,
                 venue_type="Conference or Workshop",
             )
+        elif item["type"] == "Informal and Other Publications":
+            item["ENTRYTYPE"] = "misc"
+            item["booktitle"] = item["venue"]
+        elif item["type"] == "Parts in Books or Collections":
+            item["ENTRYTYPE"] = "inbook"
+            item["booktitle"] = item["venue"]
+        else:
+            item["ENTRYTYPE"] = "misc"
+            if item["type"] != "Editorship":
+                self.review_manager.logger.warning("DBLP: Unknown type: %s", item)
 
     def __dblp_json_to_dict(
         self,
         *,
         session: requests.Session,
         item: dict,
     ) -> dict:
@@ -326,24 +337,18 @@
             raise colrev_exceptions.ServiceNotAvailableException(
                 "requests timed out "
                 "(possibly because the DBLP service is temporarily not available)"
             ) from exc
 
         return retrieved_records
 
-    def validate_source(
-        self,
-        search_operation: colrev.ops.search.Search,
-        source: colrev.settings.SearchSource,
-    ) -> None:
+    def __validate_source(self) -> None:
         """Validate the SearchSource (parameters etc.)"""
-
-        search_operation.review_manager.logger.debug(
-            f"Validate SearchSource {source.filename}"
-        )
+        source = self.search_source
+        self.review_manager.logger.debug(f"Validate SearchSource {source.filename}")
 
         # maybe : validate/assert that the venue_key is available
         if "scope" in source.search_parameters:
             if "venue_key" not in source.search_parameters["scope"]:
                 raise colrev_exceptions.InvalidQueryException(
                     "venue_key required in search_parameters/scope"
                 )
@@ -356,17 +361,15 @@
         elif source.is_md_source() or source.is_quasi_md_source():
             pass  # No parameters required
         else:
             raise colrev_exceptions.InvalidQueryException(
                 "scope or query required in search_parameters"
             )
 
-        search_operation.review_manager.logger.debug(
-            f"SearchSource {source.filename} validated"
-        )
+        self.review_manager.logger.debug(f"SearchSource {source.filename} validated")
 
     def __run_md_search_update(
         self,
         *,
         search_operation: colrev.ops.search.Search,
         dblp_feed: colrev.ops.search_feed.GeneralOriginFeed,
     ) -> None:
@@ -376,36 +379,36 @@
             feed_record = colrev.record.Record(data=feed_record_dict)
             query = "" + feed_record.data.get("title", "").replace("-", "_")
             for retrieved_record in self.__retrieve_dblp_records(
                 query=query,
             ):
                 if retrieved_record.data["dblp_key"] != feed_record.data["dblp_key"]:
                     continue
+                if retrieved_record.data.get("type", "") == "Editorship":
+                    continue
 
                 try:
                     dblp_feed.set_id(record_dict=retrieved_record.data)
                 except colrev_exceptions.NotFeedIdentifiableException:
                     continue
 
                 prev_record_dict_version = {}
                 if retrieved_record.data["ID"] in dblp_feed.feed_records:
                     prev_record_dict_version = dblp_feed.feed_records[
                         retrieved_record.data["ID"]
                     ]
 
                 dblp_feed.add_record(record=retrieved_record)
-                changed = dblp_feed.update_existing_record(
+                dblp_feed.update_existing_record(
                     records=records,
                     record_dict=retrieved_record.data,
                     prev_record_dict_version=prev_record_dict_version,
                     source=self.search_source,
                     update_time_variant_fields=True,
                 )
-                if changed:
-                    dblp_feed.nr_changed += 1
 
         dblp_feed.print_post_run_search_infos(records=records)
         dblp_feed.save_feed_file()
         search_operation.review_manager.dataset.save_records_dict(records=records)
         search_operation.review_manager.dataset.add_record_changes()
 
     def __run_param_search_year_batch(
@@ -457,26 +460,22 @@
                     record=retrieved_record,
                 )
 
                 if added:
                     self.review_manager.logger.info(
                         " retrieve " + retrieved_record.data["dblp_key"]
                     )
-                    dblp_feed.nr_added += 1
-
                 else:
-                    changed = dblp_feed.update_existing_record(
+                    dblp_feed.update_existing_record(
                         records=records,
                         record_dict=retrieved_record.data,
                         prev_record_dict_version=prev_record_dict_version,
                         source=self.search_source,
                         update_time_variant_fields=rerun,
                     )
-                    if changed:
-                        dblp_feed.nr_changed += 1
 
             if not retrieved:
                 break
 
         dblp_feed.save_feed_file()
         self.review_manager.dataset.save_records_dict(records=records)
         self.review_manager.dataset.add_record_changes()
@@ -524,14 +523,16 @@
             pass
 
     def run_search(
         self, search_operation: colrev.ops.search.Search, rerun: bool
     ) -> None:
         """Run a search of DBLP"""
 
+        self.__validate_source()
+
         search_operation.review_manager.logger.debug(
             f"Retrieve DBLP: {self.search_source.search_parameters}"
         )
 
         dblp_feed = self.search_source.get_feed(
             review_manager=search_operation.review_manager,
             source_identifier=self.source_identifier,
@@ -564,41 +565,44 @@
         if "dblp computer science bibliography" in data:
             if data.count("dblp computer science bibliography") >= data.count("\n@"):
                 result["confidence"] = 1.0
 
         return result
 
     @classmethod
-    def add_endpoint(
-        cls, search_operation: colrev.ops.search.Search, query: str
-    ) -> colrev.settings.SearchSource:
+    def add_endpoint(cls, operation: colrev.ops.search.Search, params: str) -> None:
         """Add SearchSource as an endpoint (based on query provided to colrev search -a )"""
 
+        if params is None:
+            operation.add_interactively(endpoint=cls.endpoint)
+            return
+
         if (
-            "https://dblp.org/search?q=" in query
-            or "https://dblp.org/search/publ?q=" in query
+            "https://dblp.org/search?q=" in params
+            or "https://dblp.org/search/publ?q=" in params
         ):
-            query = query.replace("https://dblp.org/search?q=", cls.__api_url).replace(
-                "https://dblp.org/search/publ?q=", cls.__api_url
-            )
+            params = params.replace(
+                "https://dblp.org/search?q=", cls.__api_url
+            ).replace("https://dblp.org/search/publ?q=", cls.__api_url)
 
-            filename = search_operation.get_unique_filename(
-                file_path_string=f"dblp_{query.replace(cls.__api_url, '')}"
+            filename = operation.get_unique_filename(
+                file_path_string=f"dblp_{params.replace(cls.__api_url, '')}"
             )
             add_source = colrev.settings.SearchSource(
-                endpoint="colrev.dblp",
+                endpoint=cls.endpoint,
                 filename=filename,
                 search_type=colrev.settings.SearchType.DB,
-                search_parameters={"query": query},
+                search_parameters={"query": params},
                 comment="",
             )
-            return add_source
+            operation.review_manager.settings.sources.append(add_source)
+            return
 
         raise colrev_exceptions.PackageParameterError(
-            f"Cannot add backward_search endpoint with query {query}"
+            f"Cannot add backward_search endpoint with query {params}"
         )
 
     def load(self, load_operation: colrev.ops.load.Load) -> dict:
         """Load the records from the SearchSource file"""
 
         if self.search_source.filename.suffix == ".bib":
             records = colrev.ops.load_utils_bib.load_bib_file(
@@ -617,18 +621,18 @@
             # DBLP appends identifiers to non-unique authors
             record.update_field(
                 key="author",
                 value=str(re.sub(r"[0-9]{4}", "", record.data["author"])),
                 source="dblp",
                 keep_source_if_equal=True,
             )
-        record.remove_field(key="bibsource")
+        record.remove_field(key="colrev.dblp.bibsource")
         if any(x in record.data.get("url", "") for x in ["dblp.org", "doi.org"]):
             record.remove_field(key="url")
-        record.remove_field(key="timestamp")
+        record.remove_field(key="colrev.dblp.timestamp")
 
         return record
 
     def get_masterdata(
         self,
         prep_operation: colrev.ops.prep.Prep,
         record: colrev.record.Record,
@@ -648,63 +652,68 @@
 
         try:
             # Note: queries combining title+author/journal do not seem to work any more
             query = "" + record.data.get("title", "").replace("-", "_")
             for retrieved_record in self.__retrieve_dblp_records(
                 query=query,
             ):
-                if "dblp_key" in record.data:
-                    if retrieved_record.data["dblp_key"] != record.data["dblp_key"]:
+                if "colrev.dblp.dblp_key" in record.data:
+                    if (
+                        retrieved_record.data["dblp_key"]
+                        != record.data["colrev.dblp.dblp_key"]
+                    ):
                         continue
 
                 similarity = colrev.record.PrepRecord.get_retrieval_similarity(
                     record_original=record,
                     retrieved_record_original=retrieved_record,
                     same_record_type_required=same_record_type_required,
                 )
-                if similarity > prep_operation.retrieval_similarity:
-                    try:
-                        self.dblp_lock.acquire(timeout=60)
-
-                        # Note : need to reload file
-                        # because the object is not shared between processes
-                        dblp_feed = self.search_source.get_feed(
-                            review_manager=prep_operation.review_manager,
-                            source_identifier=self.source_identifier,
-                            update_only=False,
-                        )
-
-                        dblp_feed.set_id(record_dict=retrieved_record.data)
-                        dblp_feed.add_record(record=retrieved_record)
-
-                        record.merge(
-                            merging_record=retrieved_record,
-                            default_source=retrieved_record.data["colrev_origin"][0],
-                        )
-                        record.set_masterdata_complete(
-                            source=retrieved_record.data["colrev_origin"][0],
-                            masterdata_repository=self.review_manager.settings.is_curated_repo(),
-                        )
-                        record.set_status(
-                            target_state=colrev.record.RecordState.md_prepared
-                        )
-                        if "Withdrawn (according to DBLP)" in record.data.get(
-                            "warning", ""
-                        ):
-                            record.prescreen_exclude(reason="retracted")
-                            record.remove_field(key="warning")
-
-                        dblp_feed.save_feed_file()
-                        self.dblp_lock.release()
-                        return record
-
-                    except (
-                        colrev_exceptions.InvalidMerge,
-                        colrev_exceptions.NotFeedIdentifiableException,
+                if similarity < prep_operation.retrieval_similarity:
+                    continue
+
+                try:
+                    self.dblp_lock.acquire(timeout=60)
+
+                    # Note : need to reload file
+                    # because the object is not shared between processes
+                    dblp_feed = self.search_source.get_feed(
+                        review_manager=prep_operation.review_manager,
+                        source_identifier=self.source_identifier,
+                        update_only=False,
+                    )
+
+                    dblp_feed.set_id(record_dict=retrieved_record.data)
+                    dblp_feed.add_record(record=retrieved_record)
+
+                    record.merge(
+                        merging_record=retrieved_record,
+                        default_source=retrieved_record.data["colrev_origin"][0],
+                    )
+                    record.set_masterdata_complete(
+                        source=retrieved_record.data["colrev_origin"][0],
+                        masterdata_repository=self.review_manager.settings.is_curated_repo(),
+                    )
+                    record.set_status(
+                        target_state=colrev.record.RecordState.md_prepared
+                    )
+                    if "Withdrawn (according to DBLP)" in record.data.get(
+                        "warning", ""
                     ):
-                        self.dblp_lock.release()
-                        continue
+                        record.prescreen_exclude(reason="retracted")
+                        record.remove_field(key="warning")
+
+                    dblp_feed.save_feed_file()
+                    self.dblp_lock.release()
+                    return record
+
+                except (
+                    colrev_exceptions.InvalidMerge,
+                    colrev_exceptions.NotFeedIdentifiableException,
+                ):
+                    self.dblp_lock.release()
+                    continue
 
         except requests.exceptions.RequestException:
             pass
 
         return record
```

### Comparing `colrev-0.9.2/colrev/ops/built_in/search_sources/doi_org.py` & `colrev-0.9.3/colrev/ops/built_in/search_sources/doi_org.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/search_sources/ebsco_host.md` & `colrev-0.9.3/colrev/ops/built_in/search_sources/google_scholar.md`

 * *Files 22% similar despite different names*

```diff
@@ -1,16 +1,16 @@
-# SearchSource: EBSCOHost
+# SearchSource: GoogleScholar
 
 Note: This document is currently under development. It will contain the following elements.
 
 - description
 - coverage (disciplines, types of work)
 - supported (details): run_search (including updates), load,  prep (including get_masterdata)
 
-[EBSCOHost](https://search.ebscohost.com/)
-[EBSCOHost APIs](https://developer.ebsco.com/getting-started/available-apis)
+[GoogleScholar](https://scholar.google.de/)
+[Publish or Perish](https://harzing.com/resources/publish-or-perish) supports the retrieval of data from GoogleScholar.
 
 ## Add the search source
 
-Download search results and store in `data/search/` directory. API-access not yet available.
+Download search results and store in `data/search/` directory. No API-access available.
 
 ## Links
```

### Comparing `colrev-0.9.2/colrev/ops/built_in/search_sources/ebsco_host.py` & `colrev-0.9.3/colrev/ops/built_in/search_sources/ebsco_host.py`

 * *Files 11% similar despite different names*

```diff
@@ -1,20 +1,22 @@
 #! /usr/bin/env python
 """SearchSource: EBSCOHost"""
 from __future__ import annotations
 
+import re
 from dataclasses import dataclass
 from pathlib import Path
 
 import zope.interface
 from dacite import from_dict
 from dataclasses_jsonschema import JsonSchemaMixin
 
 import colrev.env.package_manager
 import colrev.ops.load_utils_bib
+import colrev.ops.load_utils_table
 import colrev.ops.search
 import colrev.record
 
 # pylint: disable=unused-argument
 # pylint: disable=duplicate-code
 
 
@@ -48,34 +50,26 @@
 
     @classmethod
     def heuristic(cls, filename: Path, data: str) -> dict:
         """Source heuristic for EBSCOHost"""
 
         result = {"confidence": 0.0}
 
-        if data.count("\n@") > 1:
-            if data.count("search.ebscohost.com") >= data.count("\n@"):
-                result["confidence"] = 1.0
+        if data.count("@") >= 1:
+            if "URL = {https://search.ebscohost.com/" in data:
+                if re.match(r"@.*{\d{17}\,\n", data):
+                    result["confidence"] = 1.0
 
         return result
 
     @classmethod
-    def add_endpoint(
-        cls, search_operation: colrev.ops.search.Search, query: str
-    ) -> colrev.settings.SearchSource:
+    def add_endpoint(cls, operation: colrev.ops.search.Search, params: str) -> None:
         """Add SearchSource as an endpoint (based on query provided to colrev search -a )"""
         raise NotImplementedError
 
-    def validate_source(
-        self,
-        search_operation: colrev.ops.search.Search,
-        source: colrev.settings.SearchSource,
-    ) -> None:
-        """Validate the SearchSource (parameters etc.)"""
-
     def run_search(
         self, search_operation: colrev.ops.search.Search, rerun: bool
     ) -> None:
         """Run a search of EbscoHost"""
 
     def get_masterdata(
         self,
@@ -86,23 +80,25 @@
     ) -> colrev.record.Record:
         """Not implemented"""
         return record
 
     def load(self, load_operation: colrev.ops.load.Load) -> dict:
         """Load the records from the SearchSource file"""
 
+        if self.search_source.filename.suffix == ".bib":
+            records = colrev.ops.load_utils_bib.load_bib_file(
+                load_operation=load_operation, source=self.search_source
+            )
+            return records
+
         if self.search_source.filename.suffix == ".csv":
             csv_loader = colrev.ops.load_utils_table.CSVLoader(
-                load_operation=load_operation, settings=self.search_source
+                load_operation=load_operation, source=self.search_source
             )
             records = csv_loader.load()
-            load_operation.review_manager.dataset.save_records_dict_to_file(
-                records=records,
-                save_path=self.search_source.get_corresponding_bib_file(),
-            )
             return records
 
         raise NotImplementedError
 
     def prepare(
         self, record: colrev.record.Record, source: colrev.settings.SearchSource
     ) -> colrev.record.Record:
```

### Comparing `colrev-0.9.2/colrev/ops/built_in/search_sources/eric.md` & `colrev-0.9.3/colrev/ops/built_in/search_sources/eric.md`

 * *Files 10% similar despite different names*

```diff
@@ -12,37 +12,37 @@
 ## Add the search source
 
 Download search results and store in `data/search/` directory.
 
 A search on the ERIC API can be performed as follows:
 
 ```
-colrev search -a colrev.eric:"https://api.ies.ed.gov/eric/?search=blockchain"
+colrev search -a colrev.eric: -p "https://api.ies.ed.gov/eric/?search=blockchain"
 ```
 This command searches the core fields title, author, source, subject, and description of the entered search string (here: blockchain). The data is always returned in json format (xml and csv are not yet supported).
 
 A field search can also be used if only a search for a string in a specific field is wanted:
 
 ```
-colrev search -a colrev.eric:"https://api.ies.ed.gov/eric/?search=author: Creamer, Don"
+colrev search -a colrev.eric: -p "https://api.ies.ed.gov/eric/?search=author: Creamer, Don"
 
 ```
 This command returns all records by author Don Creamer.
 
 If several strings are to be searched for in different fields, the AND operator can be used:
 
 ```
-colrev search -a colrev.eric:"https://api.ies.ed.gov/eric/?search=author:Creamer, Don AND title: Alternative"
+colrev search -a colrev.eric: -p "https://api.ies.ed.gov/eric/?search=author:Creamer, Don AND title: Alternative"
 
 ```
 This command returns all records by author Don Creamer that have the string "Alternative" in the title.
 
 In addition, the start parameter the starting record number for the returned results set can be determined and the rows parameter can be used to determine how many records are to be returned (by default start hat the value 0 and rows the value 2000):
 
 ```
-colrev search -a colrev.eric:"https://api.ies.ed.gov/eric/?search=blockchain&start=0&rows=5"
+colrev search -a colrev.eric: -p "https://api.ies.ed.gov/eric/?search=blockchain&start=0&rows=5"
 
 ```
 
 This command returns 5 records with starting record number 0.
 
 ## Links
```

### Comparing `colrev-0.9.2/colrev/ops/built_in/search_sources/eric.py` & `colrev-0.9.3/colrev/ops/built_in/search_sources/eric.py`

 * *Files 4% similar despite different names*

```diff
@@ -11,14 +11,15 @@
 import requests
 import zope.interface
 from dacite import from_dict
 from dataclasses_jsonschema import JsonSchemaMixin
 
 import colrev.env.package_manager
 import colrev.exceptions as colrev_exceptions
+import colrev.ops.load_utils_nbib
 import colrev.ops.search
 import colrev.record
 
 # pylint: disable=unused-argument
 # pylint: disable=duplicate-code
 
 
@@ -28,14 +29,15 @@
 @dataclass
 class ERICSearchSource(JsonSchemaMixin):
     """SearchSource for the ERIC API"""
 
     settings_class = colrev.env.package_manager.DefaultSourceSettings
     source_identifier = "ID"
     search_type = colrev.settings.SearchType.DB
+    endpoint = "colrev.eric"
     api_search_supported = True
     ci_supported: bool = True
     heuristic_status = colrev.env.package_manager.SearchSourceHeuristicStatus.oni
     link = (
         "https://github.com/CoLRev-Environment/colrev/blob/main/"
         + "colrev/ops/built_in/search_sources/eric.md"
     )
@@ -87,43 +89,32 @@
         if settings:
             # ERIC as a search_source
             self.search_source = from_dict(
                 data_class=self.settings_class, data=settings
             )
         else:
             self.search_source = colrev.settings.SearchSource(
-                endpoint="colrev.eric",
+                endpoint=self.endpoint,
                 filename=Path("data/search/eric.bib"),
                 search_type=colrev.settings.SearchType.OTHER,
                 search_parameters={},
                 comment="",
             )
         self.language_service = colrev.env.language_service.LanguageService()
 
-    def validate_source(
-        self,
-        search_operation: colrev.ops.search.Search,
-        source: colrev.settings.SearchSource,
-    ) -> None:
-        """Validate the SearchSource (parameters etc.)"""
-
-        search_operation.review_manager.logger.debug(
-            f"Validate SearchSource {source.filename}"
-        )
-
-        search_operation.review_manager.logger.debug(
-            f"SearchSource {source.filename} validated"
-        )
-
     @classmethod
     def heuristic(cls, filename: Path, data: str) -> dict:
         """Source heuristic for ERIC"""
 
         result = {"confidence": 0.1}
 
+        if "OWN - ERIC" in data:
+            # if data.count("OWN - ERIC") > data.count("\n\n"):
+            result["confidence"] = 1.0
+
         # Note : no features in bib file for identification
 
         return result
 
     @classmethod
     def __search_split(cls, search: str) -> str:
         if " AND " in search:
@@ -140,40 +131,43 @@
         field, value = search.split(":")
         field = field.strip()
         value = value.strip().strip("'")
         field_value = f"{field}%3A%22{urllib.parse.quote(value)}%22"
         return field_value
 
     @classmethod
-    def add_endpoint(
-        cls, search_operation: colrev.ops.search.Search, query: str
-    ) -> typing.Optional[colrev.settings.SearchSource]:
+    def add_endpoint(cls, operation: colrev.ops.search.Search, params: str) -> None:
         """Add SearchSource as an endpoint (based on query provided to colrev search -a)"""
 
-        if "https://api.ies.ed.gov/eric/?" in query:
-            url_parsed = urllib.parse.urlparse(query)
+        if params is None:
+            operation.add_interactively(endpoint=cls.endpoint)
+
+        elif "https://api.ies.ed.gov/eric/?" in params:
+            url_parsed = urllib.parse.urlparse(params)
             new_query = urllib.parse.parse_qs(url_parsed.query)
             search = new_query.get("search", [""])[0]
             start = new_query.get("start", ["0"])[0]
             rows = new_query.get("rows", ["2000"])[0]
             if ":" in search:
                 search = ERICSearchSource.__search_split(search)
-            filename = search_operation.get_unique_filename(
-                file_path_string=f"eric_{search}"
-            )
+            filename = operation.get_unique_filename(file_path_string=f"eric_{search}")
             add_source = colrev.settings.SearchSource(
-                endpoint="colrev.eric",
+                endpoint=cls.endpoint,
                 filename=filename,
                 search_type=colrev.settings.SearchType.DB,
                 search_parameters={"query": search, "start": start, "rows": rows},
                 comment="",
             )
-            return add_source
+            operation.review_manager.settings.sources.append(add_source)
+            return
 
-        return None
+        else:
+            raise colrev_exceptions.PackageParameterError(
+                f"Cannot add ERIC endpoint with query {params}"
+            )
 
     def get_query_return(self) -> typing.Iterator[colrev.record.Record]:
         """Get the records from a query"""
         full_url = self.__build_search_url()
 
         response = requests.get(full_url, timeout=90)
         if response.status_code != 200:
@@ -205,26 +199,22 @@
         records = self.review_manager.dataset.load_records_dict()
         for record in self.get_query_return():
             prev_record_dict_version: dict = {}
             added = eric_feed.add_record(record=record)
 
             if added:
                 self.review_manager.logger.info(" retrieve " + record.data["ID"])
-                eric_feed.nr_added += 1
             else:
-                changed = eric_feed.update_existing_record(
+                eric_feed.update_existing_record(
                     records=records,
                     record_dict=record.data,
                     prev_record_dict_version=prev_record_dict_version,
                     source=self.search_source,
                     update_time_variant_fields=rerun,
                 )
-                if changed:
-                    self.review_manager.logger.info(" update " + record.data["ID"])
-                    eric_feed.nr_changed += 1
 
         eric_feed.print_post_run_search_infos(records=records)
         eric_feed.save_feed_file()
         self.review_manager.dataset.save_records_dict(records=records)
         self.review_manager.dataset.add_record_changes()
 
     def __build_search_url(self) -> str:
@@ -289,14 +279,21 @@
     ) -> colrev.record.Record:
         """Not implemented"""
         return record
 
     def load(self, load_operation: colrev.ops.load.Load) -> dict:
         """Load the records from the SearchSource file"""
 
+        if self.search_source.filename.suffix == ".nbib":
+            nbib_loader = colrev.ops.load_utils_nbib.NBIBLoader(
+                load_operation=load_operation, source=self.search_source
+            )
+            records = nbib_loader.load(source=self.search_source)
+            return records
+
         if self.search_source.filename.suffix == ".bib":
             records = colrev.ops.load_utils_bib.load_bib_file(
                 load_operation=load_operation, source=self.search_source
             )
             return records
 
         raise NotImplementedError
```

### Comparing `colrev-0.9.2/colrev/ops/built_in/search_sources/europe_pmc.md` & `colrev-0.9.3/colrev/ops/built_in/search_sources/europe_pmc.md`

 * *Files 2% similar despite different names*

```diff
@@ -9,11 +9,11 @@
 [Europe PMC](https://europepmc.org/)
 
 License: [may contain copyrighted material, unless stated otherwise](https://europepmc.org/Copyright)
 
 ## Add the search source
 
 ```
-colrev search -a colrev.europe_pmc:"https://europepmc.org/search?query=fitbit%20AND%20gamification%20AND%20RCT%20AND%20diabetes%20mellitus"
+colrev search -a colrev.europe_pmc -p "https://europepmc.org/search?query=fitbit%20AND%20gamification%20AND%20RCT%20AND%20diabetes%20mellitus"
 ```
 
 ## Links
```

### Comparing `colrev-0.9.2/colrev/ops/built_in/search_sources/europe_pmc.py` & `colrev-0.9.3/colrev/ops/built_in/search_sources/europe_pmc.py`

 * *Files 3% similar despite different names*

```diff
@@ -43,14 +43,15 @@
 @dataclass
 class EuropePMCSearchSource(JsonSchemaMixin):
     """SearchSource for Europe PMC"""
 
     # settings_class = colrev.env.package_manager.DefaultSourceSettings
     source_identifier = "europe_pmc_id"
     search_type = colrev.settings.SearchType.DB
+    endpoint = "colrev.europe_pmc"
     api_search_supported = True
     ci_supported: bool = True
     heuristic_status = colrev.env.package_manager.SearchSourceHeuristicStatus.supported
     short_name = "Europe PMC"
     link = (
         "https://github.com/CoLRev-Environment/colrev/blob/main/"
         + "colrev/ops/built_in/search_sources/europe_pmc.md"
@@ -98,15 +99,15 @@
                 for s in source_operation.review_manager.settings.sources
                 if s.filename == self.__europe_pmc_md_filename
             ]
             if europe_pmc_md_source_l:
                 self.search_source = europe_pmc_md_source_l[0]
             else:
                 self.search_source = colrev.settings.SearchSource(
-                    endpoint="colrev.europe_pmc",
+                    endpoint=self.endpoint,
                     filename=self.__europe_pmc_md_filename,
                     search_type=colrev.settings.SearchType.OTHER,
                     search_parameters={},
                     comment="",
                 )
 
             self.europe_pmc_lock = Lock()
@@ -362,39 +363,34 @@
                     return record
 
         except (requests.exceptions.RequestException, colrev_exceptions.InvalidMerge):
             self.europe_pmc_lock.release()
 
         return record
 
-    def validate_source(
-        self,
-        search_operation: colrev.ops.search.Search,
-        source: colrev.settings.SearchSource,
-    ) -> None:
+    def __validate_source(self) -> None:
         """Validate the SearchSource (parameters etc.)"""
 
-        search_operation.review_manager.logger.debug(
-            f"Validate SearchSource {source.filename}"
-        )
+        source = self.search_source
+
+        self.review_manager.logger.debug(f"Validate SearchSource {source.filename}")
 
         if "query" not in source.search_parameters:
             raise colrev_exceptions.InvalidQueryException(
                 "Query required in search_parameters"
             )
 
-        search_operation.review_manager.logger.debug(
-            f"SearchSource {source.filename} validated"
-        )
+        self.review_manager.logger.debug(f"SearchSource {source.filename} validated")
 
     def run_search(
         self, search_operation: colrev.ops.search.Search, rerun: bool
     ) -> None:
         """Run a search of Europe PMC"""
 
+        self.__validate_source()
         # https://europepmc.org/RestfulWebService
 
         search_operation.review_manager.logger.info(
             f"Retrieve Europe PMC: {self.search_source.search_parameters}"
         )
 
         europe_pmc_feed = self.search_source.get_feed(
@@ -478,33 +474,31 @@
                     added = europe_pmc_feed.add_record(record=retrieved_record)
 
                     if added:
                         search_operation.review_manager.logger.info(
                             " retrieve europe_pmc_id="
                             + retrieved_record.data["europe_pmc_id"]
                         )
-                        europe_pmc_feed.nr_added += 1
                     else:
-                        changed = europe_pmc_feed.update_existing_record(
+                        europe_pmc_feed.update_existing_record(
                             records=records,
                             record_dict=retrieved_record.data,
                             prev_record_dict_version=prev_record_dict_version,
                             source=self.search_source,
                             update_time_variant_fields=rerun,
                         )
-                        if changed:
-                            europe_pmc_feed.nr_changed += 1
 
                 url = "END"
                 next_page_url_node = root.find("nextPageUrl")
                 if next_page_url_node is not None:
                     if next_page_url_node.text is not None:
                         url = next_page_url_node.text
 
             europe_pmc_feed.print_post_run_search_infos(records=records)
+
         except (requests.exceptions.RequestException, json.decoder.JSONDecodeError):
             pass
         except OperationalError as exc:
             raise colrev_exceptions.ServiceNotAvailableException(
                 "sqlite, required for requests CachedSession "
                 "(possibly caused by concurrent operations)"
             ) from exc
@@ -522,38 +516,40 @@
         if "https://europepmc.org" in data:  # nosec
             if data.count("https://europepmc.org") >= data.count("\n@"):
                 result["confidence"] = 1.0
 
         return result
 
     @classmethod
-    def add_endpoint(
-        cls, search_operation: colrev.ops.search.Search, query: str
-    ) -> colrev.settings.SearchSource:
+    def add_endpoint(cls, operation: colrev.ops.search.Search, params: str) -> None:
         """Add SearchSource as an endpoint (based on query provided to colrev search -a )"""
 
-        host = urlparse(query).hostname
+        if params is None:
+            operation.add_interactively(endpoint=cls.endpoint)
+            return
+
+        host = urlparse(params).hostname
 
         if host and host.endswith("europepmc.org"):
-            query = query.replace("https://europepmc.org/search?query=", "")
+            params = params.replace("https://europepmc.org/search?query=", "")
 
-            filename = search_operation.get_unique_filename(
-                file_path_string="europepmc"
-            )
-            query = (
-                "https://www.ebi.ac.uk/europepmc/webservices/rest/search?query=" + query
+            filename = operation.get_unique_filename(file_path_string="europepmc")
+            params = (
+                "https://www.ebi.ac.uk/europepmc/webservices/rest/search?query="
+                + params
             )
             add_source = colrev.settings.SearchSource(
-                endpoint="colrev.europe_pmc",
+                endpoint=cls.endpoint,
                 filename=filename,
                 search_type=colrev.settings.SearchType.DB,
-                search_parameters={"query": query},
+                search_parameters={"query": params},
                 comment="",
             )
-            return add_source
+            operation.review_manager.settings.sources.append(add_source)
+            return
 
         raise NotImplementedError
 
     def load(self, load_operation: colrev.ops.load.Load) -> dict:
         """Load the records from the SearchSource file"""
 
         if self.search_source.filename.suffix == ".bib":
```

### Comparing `colrev-0.9.2/colrev/ops/built_in/search_sources/google_scholar.py` & `colrev-0.9.3/colrev/ops/built_in/search_sources/google_scholar.py`

 * *Files 17% similar despite different names*

```diff
@@ -6,15 +6,14 @@
 from pathlib import Path
 
 import zope.interface
 from dacite import from_dict
 from dataclasses_jsonschema import JsonSchemaMixin
 
 import colrev.env.package_manager
-import colrev.exceptions as colrev_exceptions
 import colrev.ops.load_utils_bib
 import colrev.ops.search
 import colrev.record
 
 
 # pylint: disable=unused-argument
 # pylint: disable=duplicate-code
@@ -58,46 +57,18 @@
         if data.count("{pop0") > 0.9 * data.count("\n@"):
             result["confidence"] = 1.0
             return result
 
         return result
 
     @classmethod
-    def add_endpoint(
-        cls, search_operation: colrev.ops.search.Search, query: str
-    ) -> colrev.settings.SearchSource:
+    def add_endpoint(cls, operation: colrev.ops.search.Search, params: str) -> None:
         """Add SearchSource as an endpoint (based on query provided to colrev search -a )"""
         raise NotImplementedError
 
-    def validate_source(
-        self,
-        search_operation: colrev.ops.search.Search,
-        source: colrev.settings.SearchSource,
-    ) -> None:
-        """Validate the SearchSource (parameters etc.)"""
-
-        search_operation.review_manager.logger.debug(
-            f"Validate SearchSource {source.filename}"
-        )
-
-        if "query_file" not in source.search_parameters:
-            raise colrev_exceptions.InvalidQueryException(
-                f"Source missing query_file search_parameter ({source.filename})"
-            )
-
-        if not Path(source.search_parameters["query_file"]).is_file():
-            raise colrev_exceptions.InvalidQueryException(
-                f"File does not exist: query_file {source.search_parameters['query_file']} "
-                f"for ({source.filename})"
-            )
-
-        search_operation.review_manager.logger.debug(
-            f"SearchSource {source.filename} validated"
-        )
-
     def run_search(
         self, search_operation: colrev.ops.search.Search, rerun: bool
     ) -> None:
         """Run a search of GoogleScholar"""
 
     def get_masterdata(
         self,
```

### Comparing `colrev-0.9.2/colrev/ops/built_in/search_sources/ieee.md` & `colrev-0.9.3/colrev/ops/built_in/search_sources/ieee.md`

 * *Files 6% similar despite different names*

```diff
@@ -11,33 +11,33 @@
 ## Add the search source
 
 Download search results and store in `data/search/` directory.
 
 Data from the IEEE database can be retrieved with the URL from the [https://www.ieee.org/](https://ieeexploreapi.ieee.org/api/v1/search/articles?parameter&apikey=). Add the URL as follows:
 
 ```
-colrev search -a colrev.ieee:"https://ieeexploreapi.ieee.org/api/v1/search/articles?parameter=microsourcing"
+colrev search -a colrev.ieee -p "https://ieeexploreapi.ieee.org/api/v1/search/articles?parameter=microsourcing"
 ```
 All configured metadata fields, the abstract and the document text are queried.
 
 It is not necessary to pass an API key as a parameter here. In order to keep the key secret, you will be prompted to enter it through user input if it is not already stored in the settings. The api key can be requested via the IEEE Xplore API Portal [https://developer.ieee.org/member/register].
 
 
 Specific parameters can also be searched for, such as issn, isbn, doi, article_number, author, publication_year. For each of these, append "parameter=value" to the URL.
 
 ```
-colrev search -a colrev.ieee:"https://ieeexploreapi.ieee.org/api/v1/search/articles?issn=1063-6919"
+colrev search -a colrev.ieee -p "https://ieeexploreapi.ieee.org/api/v1/search/articles?issn=1063-6919"
 ```
 
 Multiple parameters can be concatenated using the "&" symbol.
 
 ```
-colrev search -a colrev.ieee:"https://ieeexploreapi.ieee.org/api/v1/search/articles?publication_year=2019&abstract=microsourcing"
+colrev search -a colrev.ieee -p "https://ieeexploreapi.ieee.org/api/v1/search/articles?publication_year=2019&abstract=microsourcing"
 ```
 
 If your search query includes Boolean operators, add "queryText=query" to the URL.
 
 ```
-colrev search -a colrev.ieee:"https://ieeexploreapi.ieee.org/api/v1/search/articles?booleanText=(rfid%20AND%20%22internet%20of%20things%22)"
+colrev search -a colrev.ieee -p "https://ieeexploreapi.ieee.org/api/v1/search/articles?booleanText=(rfid%20AND%20%22internet%20of%20things%22)"
 ```
 
 ## Links
```

### Comparing `colrev-0.9.2/colrev/ops/built_in/search_sources/ieee.py` & `colrev-0.9.3/colrev/ops/built_in/search_sources/ieee.py`

 * *Files 9% similar despite different names*

```diff
@@ -29,14 +29,15 @@
 class IEEEXploreSearchSource(JsonSchemaMixin):
     """SearchSource for IEEEXplore"""
 
     flag = True
     settings_class = colrev.env.package_manager.DefaultSourceSettings
     source_identifier = "ID"
     search_type = colrev.settings.SearchType.DB
+    endpoint = "colrev.ieee"
     api_search_supported = True
     ci_supported: bool = True
     heuristic_status = colrev.env.package_manager.SearchSourceHeuristicStatus.oni
     short_name = "IEEE Xplore"
     link = (
         "https://github.com/CoLRev-Environment/colrev/blob/main/"
         + "colrev/ops/built_in/search_sources/ieee.md"
@@ -99,77 +100,66 @@
 
         if settings:
             self.search_source = from_dict(
                 data_class=self.settings_class, data=settings
             )
         else:
             self.search_source = colrev.settings.SearchSource(
-                endpoint="colrev.ieee",
+                endpoint=self.endpoint,
                 filename=Path("data/search/ieee.bib"),
                 search_type=colrev.settings.SearchType.OTHER,
                 search_parameters={},
                 comment="",
             )
 
     # For run_search, a Python SDK would be available:
     # https://developer.ieee.org/Python_Software_Development_Kit
 
-    def validate_source(
-        self,
-        search_operation: colrev.ops.search.Search,
-        source: colrev.settings.SearchSource,
-    ) -> None:
-        """Validate the SearchSource (parameters etc.)"""
-
-        search_operation.review_manager.logger.debug(
-            f"Validate SearchSource {source.filename}"
-        )
-
-        search_operation.review_manager.logger.debug(
-            f"SearchSource {source.filename} validated"
-        )
-
     @classmethod
     def heuristic(cls, filename: Path, data: str) -> dict:
         """Source heuristic for IEEEXplore"""
 
         result = {"confidence": 0.1}
 
         return result
 
     @classmethod
-    def add_endpoint(
-        cls, search_operation: colrev.ops.search.Search, query: str
-    ) -> colrev.settings.SearchSource:
+    def add_endpoint(cls, operation: colrev.ops.search.Search, params: str) -> None:
         """Add SearchSource as an endpoint (based on query provided to colrev search -a )"""
-        if "https://ieeexploreapi.ieee.org/api/v1/search/articles?" in query:
-            query = query.replace(
+
+        if params is None:
+            operation.add_interactively(endpoint=cls.endpoint)
+            return
+
+        if "https://ieeexploreapi.ieee.org/api/v1/search/articles?" in params:
+            params = params.replace(
                 "https://ieeexploreapi.ieee.org/api/v1/search/articles?", ""
             ).lstrip("&")
 
-            parameter_pairs = query.split("&")
+            parameter_pairs = params.split("&")
             search_parameters = {}
             for parameter in parameter_pairs:
                 key, value = parameter.split("=")
                 search_parameters[key] = value
 
             last_value = list(search_parameters.values())[-1]
 
-            filename = search_operation.get_unique_filename(
+            filename = operation.get_unique_filename(
                 file_path_string=f"ieee_{last_value}"
             )
 
             add_source = colrev.settings.SearchSource(
-                endpoint="colrev.ieee",
+                endpoint=cls.endpoint,
                 filename=filename,
                 search_type=colrev.settings.SearchType.DB,
                 search_parameters=search_parameters,
                 comment="",
             )
-            return add_source
+            operation.review_manager.settings.sources.append(add_source)
+            return
 
         raise NotImplementedError
 
     def run_search(
         self, search_operation: colrev.ops.search.Search, rerun: bool
     ) -> None:
         """Run a search of IEEEXplore"""
@@ -223,31 +213,29 @@
                 prev_record_dict_version: dict = {}
                 record_dict = self.__create_record_dict(article)
                 record = colrev.record.Record(data=record_dict)
                 added = ieee_feed.add_record(record=record)
 
                 if added:
                     self.review_manager.logger.info(" retrieve " + record.data["ID"])
-                    ieee_feed.nr_added += 1
                 else:
                     changed = ieee_feed.update_existing_record(
                         records=records,
                         record_dict=record.data,
                         prev_record_dict_version=prev_record_dict_version,
                         source=self.search_source,
                         update_time_variant_fields=rerun,
                     )
                     if changed:
                         self.review_manager.logger.info(" update " + record.data["ID"])
-                        ieee_feed.nr_changed += 1
+
             query.startRecord += 200
             response = query.callAPI()
 
         ieee_feed.print_post_run_search_infos(records=records)
-
         ieee_feed.save_feed_file()
         self.review_manager.dataset.save_records_dict(records=records)
         self.review_manager.dataset.add_record_changes()
 
     def __update_special_case_fields(self, *, record_dict: dict, article: dict) -> None:
         if "start_page" in article:
             record_dict["pages"] = article.pop("start_page")
@@ -316,23 +304,22 @@
             if "publication_year" in entry and "year" not in entry:
                 entry["year"] = entry.pop("publication_year")
 
     def load(self, load_operation: colrev.ops.load.Load) -> dict:
         """Load the records from the SearchSource file"""
 
         if self.search_source.filename.suffix == ".ris":
-            ris_entries = colrev.ops.load_utils_ris.load_ris_entries(
+            ris_loader = colrev.ops.load_utils_ris.RISLoader(
+                load_operation=load_operation, source=self.search_source
+            )
+            ris_entries = ris_loader.load_ris_entries(
                 filename=self.search_source.filename
             )
             self.__ris_fixes(entries=ris_entries)
-            records = colrev.ops.load_utils_ris.convert_to_records(ris_entries)
-            load_operation.review_manager.dataset.save_records_dict_to_file(
-                records=records,
-                save_path=self.search_source.get_corresponding_bib_file(),
-            )
+            records = ris_loader.convert_to_records(entries=ris_entries)
             return records
 
         raise NotImplementedError
 
     def prepare(
         self, record: colrev.record.Record, source: colrev.settings.SearchSource
     ) -> colrev.record.Record:
```

### Comparing `colrev-0.9.2/colrev/ops/built_in/search_sources/ieee_api.py` & `colrev-0.9.3/colrev/ops/built_in/search_sources/ieee_api.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/built_in/search_sources/jstor.py` & `colrev-0.9.3/colrev/ops/built_in/search_sources/trid.py`

 * *Files 20% similar despite different names*

```diff
@@ -1,103 +1,72 @@
 #! /usr/bin/env python
-"""SearchSource: JSTOR"""
+"""SearchSource: Transport Research International Documentation"""
 from __future__ import annotations
 
 from dataclasses import dataclass
 from pathlib import Path
 
 import zope.interface
 from dacite import from_dict
 from dataclasses_jsonschema import JsonSchemaMixin
 
 import colrev.env.package_manager
-import colrev.exceptions as colrev_exceptions
 import colrev.ops.load_utils_ris
 import colrev.ops.search
 import colrev.record
 
+
 # pylint: disable=unused-argument
 # pylint: disable=duplicate-code
 
 
 @zope.interface.implementer(
     colrev.env.package_manager.SearchSourcePackageEndpointInterface
 )
 @dataclass
-class JSTORSearchSource(JsonSchemaMixin):
-    """SearchSource for JSTOR"""
+class TransportResearchInternationalDocumentation(JsonSchemaMixin):
+    """SearchSource for Transport Research International Documentation"""
 
     settings_class = colrev.env.package_manager.DefaultSourceSettings
-    source_identifier = "url"
+    source_identifier = "biburl"
     search_type = colrev.settings.SearchType.DB
     api_search_supported = False
     ci_supported: bool = False
     heuristic_status = colrev.env.package_manager.SearchSourceHeuristicStatus.supported
-    short_name = "JSTOR"
+    short_name = "TRID"
     link = (
         "https://github.com/CoLRev-Environment/colrev/blob/main/"
-        + "colrev/ops/built_in/search_sources/jstor.md"
+        + "colrev/ops/built_in/search_sources/trid.md"
     )
 
     def __init__(
         self, *, source_operation: colrev.operation.Operation, settings: dict
     ) -> None:
         self.search_source = from_dict(data_class=self.settings_class, data=settings)
 
-    def validate_source(
-        self,
-        search_operation: colrev.ops.search.Search,
-        source: colrev.settings.SearchSource,
-    ) -> None:
-        """Validate the SearchSource (parameters etc.)"""
-
-        search_operation.review_manager.logger.debug(
-            f"Validate SearchSource {source.filename}"
-        )
-
-        if "query_file" not in source.search_parameters:
-            raise colrev_exceptions.InvalidQueryException(
-                f"Source missing query_file search_parameter ({source.filename})"
-            )
-
-        if not Path(source.search_parameters["query_file"]).is_file():
-            raise colrev_exceptions.InvalidQueryException(
-                f"File does not exist: query_file {source.search_parameters['query_file']} "
-                f"for ({source.filename})"
-            )
-
-        search_operation.review_manager.logger.debug(
-            f"SearchSource {source.filename} validated"
-        )
-
     @classmethod
     def heuristic(cls, filename: Path, data: str) -> dict:
-        """Source heuristic for JSTOR"""
-
-        result = {"confidence": 0.1}
-
-        if "www.jstor.org:" in data:
-            if data.count("www.jstor.org") > data.count("\n@"):
-                result["confidence"] = 1.0
-        if data.startswith("Provider: JSTOR http://www.jstor.org"):
-            result["confidence"] = 1.0
+        """Source heuristic for Transport Research International Documentation"""
 
+        result = {"confidence": 0.0}
+        # Simple heuristic:
+        if "UR  - https://trid.trb.org/view/" in data:
+            result["confidence"] = 0.9
+            return result
         return result
 
     @classmethod
-    def add_endpoint(
-        cls, search_operation: colrev.ops.search.Search, query: str
-    ) -> colrev.settings.SearchSource:
+    def add_endpoint(cls, operation: colrev.ops.search.Search, params: str) -> None:
         """Add SearchSource as an endpoint (based on query provided to colrev search -a )"""
         raise NotImplementedError
 
     def run_search(
         self, search_operation: colrev.ops.search.Search, rerun: bool
     ) -> None:
-        """Run a search of JSTOR"""
+        """Run a search of TRID"""
 
     def get_masterdata(
         self,
         prep_operation: colrev.ops.prep.Prep,
         record: colrev.record.Record,
         save_feed: bool = True,
         timeout: int = 10,
@@ -105,31 +74,35 @@
         """Not implemented"""
         return record
 
     def __ris_fixes(self, *, entries: dict) -> None:
         for entry in entries:
             if "title" in entry and "primary_title" not in entry:
                 entry["primary_title"] = entry.pop("title")
+            if entry["type_of_reference"] in ["JOUR"]:
+                if "journal_name" in entry:
+                    entry["secondary_title"] = entry.pop("journal_name")
+            if "publication_year" in entry:
+                entry["year"] = entry.pop("publication_year")
 
     def load(self, load_operation: colrev.ops.load.Load) -> dict:
         """Load the records from the SearchSource file"""
 
         if self.search_source.filename.suffix == ".ris":
-            ris_entries = colrev.ops.load_utils_ris.load_ris_entries(
+            ris_loader = colrev.ops.load_utils_ris.RISLoader(
+                load_operation=load_operation, source=self.search_source
+            )
+            ris_entries = ris_loader.load_ris_entries(
                 filename=self.search_source.filename
             )
             self.__ris_fixes(entries=ris_entries)
-            records = colrev.ops.load_utils_ris.convert_to_records(ris_entries)
-            load_operation.review_manager.dataset.save_records_dict_to_file(
-                records=records,
-                save_path=self.search_source.get_corresponding_bib_file(),
-            )
+            records = ris_loader.convert_to_records(entries=ris_entries)
             return records
 
         raise NotImplementedError
 
     def prepare(
         self, record: colrev.record.Record, source: colrev.settings.SearchSource
     ) -> colrev.record.Record:
-        """Source-specific preparation for JSTOR"""
+        """Source-specific preparation for Transport Research International Documentation"""
 
         return record
```

### Comparing `colrev-0.9.2/colrev/ops/built_in/search_sources/local_index.py` & `colrev-0.9.3/colrev/ops/built_in/search_sources/local_index.py`

 * *Files 2% similar despite different names*

```diff
@@ -34,14 +34,15 @@
 class LocalIndexSearchSource(JsonSchemaMixin):
     """Performs a search in the LocalIndex"""
 
     # pylint: disable=too-many-instance-attributes
     settings_class = colrev.env.package_manager.DefaultSourceSettings
     source_identifier = "curation_ID"
     search_type = colrev.settings.SearchType.OTHER
+    endpoint = "colrev.local_index"
     api_search_supported = True
     ci_supported: bool = True
     heuristic_status = colrev.env.package_manager.SearchSourceHeuristicStatus.supported
     short_name = "LocalIndex"
     link = (
         "https://github.com/CoLRev-Environment/colrev/blob/main/"
         + "colrev/ops/built_in/search_sources/local_index.md"
@@ -55,15 +56,15 @@
         "year",
         "booktitle",
         "number",
         "volume",
         "issue",
         "author",
         "doi",
-        "dblp_key",
+        "colrev.dblp.dblp_key",
         "url",
     ]
 
     def __init__(
         self,
         *,
         source_operation: colrev.operation.Operation,
@@ -82,38 +83,32 @@
                 for s in source_operation.review_manager.settings.sources
                 if s.filename == self.__local_index_md_filename
             ]
             if li_md_source_l:
                 self.search_source = li_md_source_l[0]
             else:
                 self.search_source = colrev.settings.SearchSource(
-                    endpoint="colrev.local_index",
+                    endpoint=self.endpoint,
                     filename=self.__local_index_md_filename,
                     search_type=colrev.settings.SearchType.OTHER,
                     search_parameters={},
                     comment="",
                 )
 
             self.local_index_lock = Lock()
 
         self.origin_prefix = self.search_source.get_origin_prefix()
 
         self.local_index = source_operation.review_manager.get_local_index()
         self.review_manager = source_operation.review_manager
 
-    def validate_source(
-        self,
-        search_operation: colrev.ops.search.Search,
-        source: colrev.settings.SearchSource,
-    ) -> None:
+    def __validate_source(self) -> None:
         """Validate the SearchSource (parameters etc.)"""
-
-        search_operation.review_manager.logger.debug(
-            f"Validate SearchSource {source.filename}"
-        )
+        source = self.search_source
+        self.review_manager.logger.debug(f"Validate SearchSource {source.filename}")
 
         # if "query" not in source.search_parameters:
         # Note :  for md-sources, there is no query parameter.
         #     raise colrev_exceptions.InvalidQueryException(
         #         f"Source missing query search_parameter ({source.filename})"
         #     )
 
@@ -131,22 +126,24 @@
             # elif "url" in source.search_parameters["query"]:
             #     pass
             # # else:
             #     raise colrev_exceptions.InvalidQueryException(
             #         f"Source missing query/query search_parameter ({source.filename})"
             #     )
 
-        search_operation.review_manager.logger.debug(
-            f"SearchSource {source.filename} validated"
-        )
+        self.review_manager.logger.debug(f"SearchSource {source.filename} validated")
 
     def __retrieve_from_index(self) -> typing.List[dict]:
         params = self.search_source.search_parameters
         query = params["query"]
 
+        # TODO : generally prefix with SQL fields
+        if not any(x in query for x in ["title", "abstract"]):
+            query = f'title LIKE "%{query}%"'
+
         returned_records = self.local_index.search(query=query)
 
         records_to_import = [r.get_data() for r in returned_records]
         records_to_import = [r for r in records_to_import if r]
         keys_to_drop = [
             "colrev_status",
             "colrev_origin",
@@ -191,25 +188,21 @@
                     retrieved_record_dict["ID"]
                 ]
 
             local_index_feed.add_record(
                 record=colrev.record.Record(data=retrieved_record_dict)
             )
 
-            changed = local_index_feed.update_existing_record(
+            local_index_feed.update_existing_record(
                 records=records,
                 record_dict=retrieved_record_dict,
                 prev_record_dict_version=prev_record_dict_version,
                 source=self.search_source,
                 update_time_variant_fields=True,
             )
-            # Note : changed refers to the data/records.bib.
-            # Records that are not yet imported do not count.
-            if changed:
-                local_index_feed.nr_changed += 1
 
         local_index_feed.print_post_run_search_infos(records=records)
         local_index_feed.save_feed_file()
         search_operation.review_manager.dataset.save_records_dict(records=records)
         search_operation.review_manager.dataset.add_record_changes()
 
     def __run_parameter_search(
@@ -233,35 +226,37 @@
                     retrieved_record_dict["ID"]
                 ]
 
             added = local_index_feed.add_record(
                 record=colrev.record.Record(data=retrieved_record_dict)
             )
             if added:
-                local_index_feed.nr_added += 1
+                self.review_manager.logger.info(
+                    " retrieve " + retrieved_record_dict["ID"]
+                )
 
             else:
-                changed = local_index_feed.update_existing_record(
+                local_index_feed.update_existing_record(
                     records=records,
                     record_dict=retrieved_record_dict,
                     prev_record_dict_version=prev_record_dict_version,
                     source=self.search_source,
                     update_time_variant_fields=rerun,
                 )
-                if changed:
-                    local_index_feed.nr_changed += 1
 
         local_index_feed.print_post_run_search_infos(records=records)
         local_index_feed.save_feed_file()
 
     def run_search(
         self, search_operation: colrev.ops.search.Search, rerun: bool
     ) -> None:
         """Run a search of local-index"""
 
+        self.__validate_source()
+
         local_index_feed = self.search_source.get_feed(
             review_manager=search_operation.review_manager,
             source_identifier=self.source_identifier,
             update_only=(not rerun),
         )
 
         if self.search_source.is_md_source() or self.search_source.is_quasi_md_source():
@@ -284,30 +279,32 @@
         result = {"confidence": 0.0}
         if "curation_ID" in data:
             result["confidence"] = 1.0
 
         return result
 
     @classmethod
-    def add_endpoint(
-        cls, search_operation: colrev.ops.search.Search, query: str
-    ) -> colrev.settings.SearchSource:
+    def add_endpoint(cls, operation: colrev.ops.search.Search, params: str) -> None:
         """Add SearchSource as an endpoint (based on query provided to colrev search -a )"""
 
-        filename = search_operation.get_unique_filename(
-            file_path_string=f"local_index_{query}".replace("%", "").replace("'", "")
+        if params is None:
+            operation.add_interactively(endpoint=cls.endpoint)
+            return
+
+        filename = operation.get_unique_filename(
+            file_path_string=f"local_index_{params}".replace("%", "").replace("'", "")
         )
         add_source = colrev.settings.SearchSource(
-            endpoint="colrev.local_index",
+            endpoint=cls.endpoint,
             filename=filename,
             search_type=colrev.settings.SearchType.DB,
-            search_parameters={"query": query},
+            search_parameters={"query": params},
             comment="",
         )
-        return add_source
+        operation.review_manager.settings.sources.append(add_source)
 
     def load(self, load_operation: colrev.ops.load.Load) -> dict:
         """Load the records from the SearchSource file"""
 
         if self.search_source.filename.suffix == ".bib":
             records = colrev.ops.load_utils_bib.load_bib_file(
                 load_operation=load_operation, source=self.search_source
@@ -422,14 +419,20 @@
             local_index_feed.add_record(record=retrieved_record)
 
             retrieved_record.remove_field(key="curation_ID")
             record.merge(
                 merging_record=retrieved_record,
                 default_source=default_source,
             )
+            # If volume/number are no longer in the CURATED record
+            if "number" in record.data and "number" not in retrieved_record.data:
+                del record.data["number"]
+            if "volume" in record.data and "volume" not in retrieved_record.data:
+                del record.data["volume"]
+
             record.set_status(target_state=colrev.record.RecordState.md_prepared)
             if record.data.get("prescreen_exclusion", "NA") == "retracted":
                 record.prescreen_exclude(reason="retracted")
 
             git_repo = self.review_manager.dataset.get_repo()
             cur_project_source_paths = [str(self.review_manager.path)]
             for remote in git_repo.remotes:
@@ -461,18 +464,14 @@
         prep_operation: colrev.ops.prep.Prep,
         record: colrev.record.Record,
         save_feed: bool = True,
         timeout: int = 10,
     ) -> colrev.record.Record:
         """Retrieve masterdata from LocalIndex based on similarity with the record provided"""
 
-        if any(self.origin_prefix in o for o in record.data["colrev_origin"]):
-            # Already linked to a local-index record
-            return record
-
         retrieved_record = self.__retrieve_record_from_local_index(
             record=record,
             retrieval_similarity=prep_operation.retrieval_similarity,
         )
 
         # restriction: if we don't restrict to CURATED,
         # we may have to rethink the LocalIndexSearchFeed.set_ids()
```

### Comparing `colrev-0.9.2/colrev/ops/built_in/search_sources/open_alex.md` & `colrev-0.9.3/colrev/ops/built_in/search_sources/open_alex.md`

 * *Files 1% similar despite different names*

```diff
@@ -5,15 +5,15 @@
 - description
 - coverage (disciplines, types of work)
 - supported (details): run_search (including updates), load,  prep (including get_masterdata)
 
 ## Add the search source
 
 ```
-colrev search -a colrev.open_alex:"..."
+colrev search -a colrev.open_alex -p "..."
 ```
 
 To test the metadata provided for a particular `open_alex_id` use:
 ```
 https://api.openalex.org/works/OPEN_ALEX_ID
 ```
```

### Comparing `colrev-0.9.2/colrev/ops/built_in/search_sources/open_alex.py` & `colrev-0.9.3/colrev/ops/built_in/search_sources/open_alex.py`

 * *Files 7% similar despite different names*

```diff
@@ -5,14 +5,15 @@
 from dataclasses import dataclass
 from multiprocessing import Lock
 from pathlib import Path
 from typing import Optional
 from typing import TYPE_CHECKING
 
 import pyalex
+import requests
 import zope.interface
 from dataclasses_jsonschema import JsonSchemaMixin
 from pyalex import Works
 
 import colrev.env.package_manager
 import colrev.exceptions as colrev_exceptions
 import colrev.ops.load_utils_bib
@@ -104,31 +105,43 @@
                 ret_str = author_string
             else:
                 ret_str += " and " + author_string
         if ret_str != "":
             record_dict["author"] = ret_str
 
     def __parse_item_to_record(self, *, item: dict) -> colrev.record.Record:
-        record_dict = {}
-        record_dict["openalex_id"] = item["id"].replace("https://openalex.org/", "")
+        def set_entrytype(*, record_dict: dict, item: dict) -> None:
+            if "title" in record_dict and record_dict["title"] is None:
+                del record_dict["title"]
+            if item.get("type_crossref", "") == "proceedings-article":
+                record_dict["ENTRYTYPE"] = "inproceedings"
+                if (
+                    item.get("primary_location", None) is not None
+                    and item["primary_location"].get("source", None) is not None
+                ):
+                    display_name = item["primary_location"]["source"]["display_name"]
+                    if display_name != "Proceedings":
+                        record_dict["booktitle"] = display_name
+            elif item["type"] in ["journal-article", "article"]:
+                record_dict["ENTRYTYPE"] = "article"
+                if (
+                    item.get("primary_location", None) is not None
+                    and item["primary_location"].get("source", None) is not None
+                ):
+                    record_dict["journal"] = item["primary_location"]["source"][
+                        "display_name"
+                    ]
+            else:
+                record_dict["ENTRYTYPE"] = "misc"
 
-        record_dict["title"] = item.get("title", "")
-        if record_dict["title"] is None:
-            del record_dict["title"]
-        if item["type"] == "journal-article":
-            record_dict["ENTRYTYPE"] = "article"
-            if (
-                item.get("primary_location", None) is not None
-                and item["primary_location"].get("source", None) is not None
-            ):
-                record_dict["journal"] = item["primary_location"]["source"][
-                    "display_name"
-                ]
-        else:
-            record_dict["ENTRYTYPE"] = "misc"
+        record_dict = {}
+        record_dict["id"] = item["id"].replace("https://openalex.org/", "")
+        if "title" in item and item["title"] is not None:
+            record_dict["title"] = item["title"].lstrip("[").rstrip("].")
+        set_entrytype(record_dict=record_dict, item=item)
 
         if "publication_year" in item and item["publication_year"] is not None:
             record_dict["year"] = str(item["publication_year"])
         if "language" in item and item["language"] is not None:
             record_dict["language"] = item["language"]
 
         if "is_retracted" in item and item["is_retracted"]:
@@ -163,79 +176,75 @@
             record.remove_field(key="language")
 
     def __get_masterdata_record(
         self, *, record: colrev.record.Record
     ) -> colrev.record.Record:
         try:
             retrieved_record = self.__parse_item_to_record(
-                item=Works()[record.data["openalex_id"]]
+                item=Works()[record.data["colrev.open_alex.id"]]
             )
 
             self.open_alex_lock.acquire(timeout=120)
 
             # Note : need to reload file because the object is not shared between processes
             open_alex_feed = self.search_source.get_feed(
                 review_manager=self.review_manager,
                 source_identifier=self.source_identifier,
                 update_only=False,
             )
 
             open_alex_feed.set_id(record_dict=retrieved_record.data)
             open_alex_feed.add_record(record=retrieved_record)
+            record.change_entrytype(
+                new_entrytype=retrieved_record.data["ENTRYTYPE"],
+                qm=self.review_manager.get_qm(),
+            )
 
             record.merge(
                 merging_record=retrieved_record,
                 default_source=retrieved_record.data["colrev_origin"][0],
             )
             open_alex_feed.save_feed_file()
         except (
             colrev_exceptions.InvalidMerge,
             colrev_exceptions.RecordNotParsableException,
+            requests.exceptions.RequestException,
         ):
             pass
         except Exception as exc:
             raise exc
         finally:
-            self.open_alex_lock.release()
+            try:
+                self.open_alex_lock.release()
+            except ValueError:
+                pass
 
         return record
 
     def get_masterdata(
         self,
         prep_operation: colrev.ops.prep.Prep,
         record: colrev.record.Record,
         save_feed: bool = True,
         timeout: int = 30,
     ) -> colrev.record.Record:
         """Retrieve masterdata from OpenAlex based on similarity with the record provided"""
 
-        if "openalex_id" not in record.data:
+        if "colrev.open_alex.id" not in record.data:
             # Note: not yet implemented
             # https://github.com/OpenAPC/openapc-de/blob/master/python/import_dois.py
             # if len(record.data.get("title", "")) < 35 and "doi" not in record.data:
             #     return record
             # record = self.__check_doi_masterdata(record=record)
             return record
 
         record = self.__get_masterdata_record(record=record)
 
         return record
 
-    def validate_source(
-        self,
-        search_operation: colrev.ops.search.Search,
-        source: colrev.settings.SearchSource,
-    ) -> None:
-        """Validate the SearchSource (parameters etc.)"""
-
-        search_operation.review_manager.logger.debug(
-            f"Validate SearchSource {source.filename}"
-        )
-        # Note: not yet implemented
-
     def run_search(
         self, search_operation: colrev.ops.search.Search, rerun: bool
     ) -> None:
         """Run a search of OpenAlex"""
 
         # https://docs.openalex.org/api-entities/works
 
@@ -280,21 +289,19 @@
         """Source heuristic for OpenAlex"""
 
         result = {"confidence": 0.0}
 
         return result
 
     @classmethod
-    def add_endpoint(
-        cls, search_operation: colrev.ops.search.Search, query: str
-    ) -> colrev.settings.SearchSource:
+    def add_endpoint(cls, operation: colrev.ops.search.Search, params: str) -> None:
         """Add SearchSource as an endpoint (based on query provided to colrev search -a )"""
 
         raise colrev_exceptions.PackageParameterError(
-            f"Cannot add OpenAlex endpoint with query {query}"
+            f"Cannot add OpenAlex endpoint with query {params}"
         )
 
     def load(self, load_operation: colrev.ops.load.Load) -> dict:
         """Load the records from the SearchSource file"""
 
         if self.search_source.filename.suffix == ".bib":
             records = colrev.ops.load_utils_bib.load_bib_file(
```

### Comparing `colrev-0.9.2/colrev/ops/built_in/search_sources/open_citations_forward_search.py` & `colrev-0.9.3/colrev/ops/built_in/search_sources/open_citations_forward_search.py`

 * *Files 4% similar despite different names*

```diff
@@ -66,41 +66,35 @@
             search_type=colrev.settings.SearchType.FORWARD_SEARCH,
             search_parameters={
                 "scope": {"colrev_status": "rev_included|rev_synthesized"}
             },
             comment="",
         )
 
-    def validate_source(
-        self,
-        search_operation: colrev.ops.search.Search,
-        source: colrev.settings.SearchSource,
-    ) -> None:
+    def __validate_source(self) -> None:
         """Validate the SearchSource (parameters etc.)"""
 
-        search_operation.review_manager.logger.debug(
-            f"Validate SearchSource {source.filename}"
-        )
+        source = self.search_source
+
+        self.review_manager.logger.debug(f"Validate SearchSource {source.filename}")
 
         if "scope" not in source.search_parameters:
             raise colrev_exceptions.InvalidQueryException(
                 "Scope required in the search_parameters"
             )
 
         if (
             source.search_parameters["scope"]["colrev_status"]
             != "rev_included|rev_synthesized"
         ):
             raise colrev_exceptions.InvalidQueryException(
                 "search_parameters/scope/colrev_status must be rev_included|rev_synthesized"
             )
 
-        search_operation.review_manager.logger.debug(
-            f"SearchSource {source.filename} validated"
-        )
+        self.review_manager.logger.debug(f"SearchSource {source.filename} validated")
 
     def __fw_search_condition(self, *, record: dict) -> bool:
         if "doi" not in record:
             return False
 
         # rev_included/rev_synthesized required, but record not in rev_included/rev_synthesized
         if (
@@ -146,14 +140,16 @@
     def run_search(
         self, search_operation: colrev.ops.search.Search, rerun: bool
     ) -> None:
         """Run a forward search based on OpenCitations"""
 
         # pylint: disable=too-many-branches
 
+        self.__validate_source()
+
         records = search_operation.review_manager.dataset.load_records_dict()
 
         if not records:
             print("No records imported. Cannot run forward search yet.")
             return
 
         forward_search_feed = self.search_source.get_feed(
@@ -190,26 +186,24 @@
                     ]
 
                 added = forward_search_feed.add_record(
                     record=colrev.record.Record(data=new_record),
                 )
 
                 if added:
-                    forward_search_feed.nr_added += 1
+                    pass
                 elif rerun:
                     # Note : only re-index/update
-                    changed = forward_search_feed.update_existing_record(
+                    forward_search_feed.update_existing_record(
                         records=records,
                         record_dict=new_record,
                         prev_record_dict_version=prev_record_dict_version,
                         source=self.search_source,
                         update_time_variant_fields=rerun,
                     )
-                    if changed:
-                        forward_search_feed.nr_changed += 1
 
         forward_search_feed.save_feed_file()
         forward_search_feed.print_post_run_search_infos(records=records)
 
         if search_operation.review_manager.dataset.has_changes():
             search_operation.review_manager.create_commit(
                 msg="Forward search", script_call="colrev search"
@@ -220,20 +214,19 @@
         """Source heuristic for forward searches (OpenCitations)"""
 
         result = {"confidence": 0.0}
 
         return result
 
     @classmethod
-    def add_endpoint(
-        cls, search_operation: colrev.ops.search.Search, query: str
-    ) -> colrev.settings.SearchSource:
-        """Add SearchSource as an endpoint (based on query provided to colrev search -a )"""
+    def add_endpoint(cls, operation: colrev.ops.search.Search, params: str) -> None:
+        """Add SearchSource as an endpoint"""
 
-        return cls.get_default_source()
+        add_source = cls.get_default_source()
+        operation.review_manager.settings.sources.append(add_source)
 
     def get_masterdata(
         self,
         prep_operation: colrev.ops.prep.Prep,
         record: colrev.record.Record,
         save_feed: bool = True,
         timeout: int = 10,
```

### Comparing `colrev-0.9.2/colrev/ops/built_in/search_sources/open_library.py` & `colrev-0.9.3/colrev/ops/built_in/search_sources/open_library.py`

 * *Files 2% similar despite different names*

```diff
@@ -235,27 +235,18 @@
         """Source heuristic for OpenLibrary"""
 
         result = {"confidence": 0.0}
 
         return result
 
     @classmethod
-    def add_endpoint(
-        cls, search_operation: colrev.ops.search.Search, query: str
-    ) -> colrev.settings.SearchSource:
+    def add_endpoint(cls, operation: colrev.ops.search.Search, params: str) -> None:
         """Add SearchSource as an endpoint (based on query provided to colrev search -a )"""
         raise NotImplementedError
 
-    def validate_source(
-        self,
-        search_operation: colrev.ops.search.Search,
-        source: colrev.settings.SearchSource,
-    ) -> None:
-        """Validate the OpenLibrary (parameters etc.)"""
-
     def run_search(
         self, search_operation: colrev.ops.search.Search, rerun: bool
     ) -> None:
         """Run a search of OpenLibrary"""
 
     def get_masterdata(
         self,
```

### Comparing `colrev-0.9.2/colrev/ops/built_in/search_sources/pdf_backward_search.md` & `colrev-0.9.3/colrev/ops/built_in/search_sources/pdf_backward_search.md`

 * *Files 11% similar despite different names*

```diff
@@ -12,16 +12,16 @@
 Citation data is automatically consolidated with open-citations data to improve data quality.
 
 based on [GROBID](https://github.com/kermitt2/grobid)
 
 ## Add the search source
 
 ```
-colrev search -a colrev.pdf_backward_search:default
-colrev search -a colrev.pdf_backward_search:min_intext_citations=2
+colrev search -a colrev.pdf_backward_search -p default
+colrev search -a colrev.pdf_backward_search -p min_intext_citations=2
 ```
 
 ## Conducting a selective backward search
 
 A selective backward search for a single paper and selected references can be conducted by running
 ```
 colrev search -bws record_id
```

### Comparing `colrev-0.9.2/colrev/ops/built_in/search_sources/pdf_backward_search.py` & `colrev-0.9.3/colrev/ops/built_in/search_sources/pdf_backward_search.py`

 * *Files 2% similar despite different names*

```diff
@@ -80,24 +80,18 @@
             search_parameters={
                 "scope": {"colrev_status": "rev_included|rev_synthesized"},
                 "min_intext_citations": 3,
             },
             comment="",
         )
 
-    def validate_source(
-        self,
-        search_operation: colrev.ops.search.Search,
-        source: colrev.settings.SearchSource,
-    ) -> None:
+    def __validate_source(self) -> None:
         """Validate the SearchSource (parameters etc.)"""
-
-        search_operation.review_manager.logger.debug(
-            f"Validate SearchSource {source.filename}"
-        )
+        source = self.search_source
+        self.review_manager.logger.debug(f"Validate SearchSource {source.filename}")
 
         if "scope" not in source.search_parameters:
             raise colrev_exceptions.InvalidQueryException(
                 "Scope required in the search_parameters"
             )
 
         if source.search_parameters["scope"].get("file", "") == "paper.md":
@@ -107,17 +101,15 @@
                 source.search_parameters["scope"]["colrev_status"]
                 != "rev_included|rev_synthesized"
             ):
                 raise colrev_exceptions.InvalidQueryException(
                     "search_parameters/scope/colrev_status must be rev_included|rev_synthesized"
                 )
 
-        search_operation.review_manager.logger.debug(
-            f"SearchSource {source.filename} validated"
-        )
+        self.review_manager.logger.debug(f"SearchSource {source.filename} validated")
 
     def __bw_search_condition(self, *, record: dict) -> bool:
         # rev_included/rev_synthesized required, but record not in rev_included/rev_synthesized
         if (
             "colrev_status" in self.search_source.search_parameters["scope"]
             and self.search_source.search_parameters["scope"]["colrev_status"]
             == "rev_included|rev_synthesized"
@@ -196,28 +188,30 @@
         self,
         *,
         pdf_backward_search_feed: colrev.ops.search_feed.GeneralOriginFeed,
         records: dict,
     ) -> None:
         self.review_manager.logger.info("Comparing records with open-citations data")
         for parent_record_id in {
-            x["cited_by_ID"] for x in pdf_backward_search_feed.feed_records.values()
+            x["bwsearch_ref"] for x in pdf_backward_search_feed.feed_records.values()
         }:
-            parent_record = records[parent_record_id]
+            parent_record = records[
+                parent_record_id[: parent_record_id.find("_backward_search_")]
+            ]
 
             if "doi" not in parent_record:
                 continue
 
             backward_references = self.__get_reference_records(
                 record_dict=parent_record
             )
             updated = 0
             overall = 0
             for feed_record_dict in pdf_backward_search_feed.feed_records.values():
-                if feed_record_dict["cited_by_ID"] != parent_record_id:
+                if feed_record_dict["bwsearch_ref"] != parent_record_id:
                     continue
                 overall += 1
                 feed_record = colrev.record.Record(data=feed_record_dict)
                 max_similarity = 0.0
                 pos = -1
                 for i, backward_reference in enumerate(backward_references):
                     similarity = self.__get_similarity(
@@ -277,33 +271,31 @@
                     new_record["ID"]
                 ]
 
             added = pdf_backward_search_feed.add_record(
                 record=colrev.record.Record(data=new_record),
             )
 
-            if added:
-                pdf_backward_search_feed.nr_added += 1
-            elif rerun:
+            if not added and rerun:
                 # Note : only re-index/update
-                changed = pdf_backward_search_feed.update_existing_record(
+                pdf_backward_search_feed.update_existing_record(
                     records=records,
                     record_dict=new_record,
                     prev_record_dict_version=prev_record_dict_version,
                     source=self.search_source,
                     update_time_variant_fields=rerun,
                 )
-                if changed:
-                    pdf_backward_search_feed.nr_changed += 1
 
     def run_search(
         self, search_operation: colrev.ops.search.Search, rerun: bool
     ) -> None:
         """Run a search of PDFs (backward search based on GROBID)"""
 
+        self.__validate_source()
+
         # Do not run in continuous-integration environment
         if search_operation.review_manager.in_ci_environment():
             return
 
         records = search_operation.review_manager.dataset.load_records_dict()
 
         if not records:
@@ -359,31 +351,37 @@
         result = {"confidence": 0.0}
         if str(filename).endswith("_ref_list.pdf"):
             result["confidence"] = 1.0
             return result
         return result
 
     @classmethod
-    def add_endpoint(
-        cls, search_operation: colrev.ops.search.Search, query: str
-    ) -> colrev.settings.SearchSource:
+    def add_endpoint(cls, operation: colrev.ops.search.Search, params: str) -> None:
         """Add SearchSource as an endpoint (based on query provided to colrev search -a )"""
 
-        if query == "default":
-            return cls.get_default_source()
+        if params is None:
+            params = "min_intext_citations=3"
+
+        if params == "default":
+            add_source = cls.get_default_source()
+            operation.review_manager.settings.sources.append(add_source)
+            return
 
-        if query.startswith("min_intext_citations="):
-            source = cls.get_default_source()
-            min_intext_citations = query.replace("min_intext_citations=", "")
+        if params.startswith("min_intext_citations="):
+            add_source = cls.get_default_source()
+            min_intext_citations = params.replace("min_intext_citations=", "")
             assert min_intext_citations.isdigit()
-            source.search_parameters["min_intext_citations"] = int(min_intext_citations)
-            return source
+            add_source.search_parameters["min_intext_citations"] = int(
+                min_intext_citations
+            )
+            operation.review_manager.settings.sources.append(add_source)
+            return
 
         raise colrev_exceptions.PackageParameterError(
-            f"Cannot add backward_search endpoint with query {query}"
+            f"Cannot add backward_search endpoint with query {params}"
         )
 
     def load(self, load_operation: colrev.ops.load.Load) -> dict:
         """Load the records from the SearchSource file"""
 
         if self.search_source.filename.suffix == ".bib":
             records = colrev.ops.load_utils_bib.load_bib_file(
```

### Comparing `colrev-0.9.2/colrev/ops/built_in/search_sources/pdfs_dir.py` & `colrev-0.9.3/colrev/ops/built_in/search_sources/pdfs_dir.py`

 * *Files 0% similar despite different names*

```diff
@@ -384,24 +384,20 @@
             self.review_manager.logger.info(
                 f"Skipping PDF with _ocr.pdf/_wo_cp.pdf: {pdf_path}"
             )
             return True
 
         return False
 
-    def validate_source(
-        self,
-        search_operation: colrev.ops.search.Search,
-        source: colrev.settings.SearchSource,
-    ) -> None:
+    def __validate_source(self) -> None:
         """Validate the SearchSource (parameters etc.)"""
 
-        search_operation.review_manager.logger.debug(
-            f"Validate SearchSource {source.filename}"
-        )
+        source = self.search_source
+
+        self.review_manager.logger.debug(f"Validate SearchSource {source.filename}")
 
         if "subdir_pattern" in source.search_parameters:
             if source.search_parameters["subdir_pattern"] != [
                 "NA",
                 "volume_number",
                 "year",
                 "volume",
@@ -419,17 +415,15 @@
             raise colrev_exceptions.InvalidQueryException(
                 "scope required in search_parameters"
             )
         if "path" not in source.search_parameters["scope"]:
             raise colrev_exceptions.InvalidQueryException(
                 "path required in search_parameters/scope"
             )
-        search_operation.review_manager.logger.debug(
-            f"SearchSource {source.filename} validated"
-        )
+        self.review_manager.logger.debug(f"SearchSource {source.filename} validated")
 
     def __add_md_string(self, *, record_dict: dict) -> dict:
         md_copy = record_dict.copy()
         try:
             fsize = str(
                 (self.review_manager.path / Path(record_dict["file"])).stat().st_size
             )
@@ -572,27 +566,25 @@
                     new_record["ID"], {}
                 )
 
                 added = pdfs_dir_feed.add_record(
                     record=colrev.record.Record(data=new_record),
                 )
                 if added:
-                    pdfs_dir_feed.nr_added += 1
                     self.__add_doi_from_pdf_if_not_available(record_dict=new_record)
 
                 elif self.review_manager.force_mode:
                     # Note : only re-index/update
-                    if pdfs_dir_feed.update_existing_record(
+                    pdfs_dir_feed.update_existing_record(
                         records=records,
                         record_dict=new_record,
                         prev_record_dict_version=prev_record_dict_version,
                         source=self.search_source,
                         update_time_variant_fields=rerun,
-                    ):
-                        pdfs_dir_feed.nr_changed += 1
+                    )
 
             for record in pdfs_dir_feed.feed_records.values():
                 record.pop("md_string")
 
             pdfs_dir_feed.save_feed_file()
 
         pdfs_dir_feed.print_post_run_search_infos(records=records)
@@ -608,14 +600,16 @@
         del record.data["text_from_pdf"]
 
     def run_search(
         self, search_operation: colrev.ops.search.Search, rerun: bool
     ) -> None:
         """Run a search of a PDF directory (based on GROBID)"""
 
+        self.__validate_source()
+
         # Do not run in continuous-integration environment
         if search_operation.review_manager.in_ci_environment():
             return
 
         if search_operation.review_manager.force_mode:  # i.e., reindex all
             search_operation.review_manager.logger.info("Reindex all")
 
@@ -661,29 +655,27 @@
         ):
             result["confidence"] = 1.0
             return result
 
         return result
 
     @classmethod
-    def add_endpoint(
-        cls, search_operation: colrev.ops.search.Search, query: str
-    ) -> colrev.settings.SearchSource:
+    def add_endpoint(cls, operation: colrev.ops.search.Search, params: str) -> None:
         """Add SearchSource as an endpoint (based on query provided to colrev search -a )"""
 
-        filename = search_operation.get_unique_filename(file_path_string="pdfs")
+        filename = operation.get_unique_filename(file_path_string="pdfs")
         # pylint: disable=no-value-for-parameter
         add_source = colrev.settings.SearchSource(
             endpoint="colrev.pdfs_dir",
             filename=filename,
             search_type=colrev.settings.SearchType.PDFS,
             search_parameters={"scope": {"path": "data/pdfs"}},
             comment="",
         )
-        return add_source
+        operation.review_manager.settings.sources.append(add_source)
 
     def __update_based_on_doi(self, *, record_dict: dict) -> None:
         if "doi" not in record_dict:
             return
         try:
             retrieved_record = self.crossref_connector.query_doi(
                 doi=record_dict["doi"], etiquette=self.__etiquette
@@ -739,15 +731,15 @@
                 record = colrev.record.Record(data=record_dict)
                 missing_field_checker.apply_curation_restrictions(record=record)
             return records
 
         raise NotImplementedError
 
     def __fix_special_chars(self, *, record: colrev.record.Record) -> None:
-        # TODO : extract to separate scripts and also apply upon loading tei content
+        # We may also apply the following upon loading tei content
         if "title" in record.data:
             record.data["title"] = (
                 record.data["title"]
                 .replace("n ", "")
                 .replace("u ", "")
                 .replace(" ", "")
                 .replace("a ", "")
```

### Comparing `colrev-0.9.2/colrev/ops/built_in/search_sources/psycinfo.py` & `colrev-0.9.3/colrev/ops/built_in/search_sources/video_dir.py`

 * *Files 20% similar despite different names*

```diff
@@ -1,169 +1,168 @@
 #! /usr/bin/env python
-"""SearchSource: PsycINFO"""
+"""SearchSource: directory containing video files"""
 from __future__ import annotations
 
-import re
-from copy import deepcopy
 from dataclasses import dataclass
+from multiprocessing import Lock
 from pathlib import Path
 
 import zope.interface
 from dacite import from_dict
 from dataclasses_jsonschema import JsonSchemaMixin
-from rispy import BaseParser
-from rispy.config import LIST_TYPE_TAGS
-from rispy.config import TAG_KEY_MAPPING
 
 import colrev.env.package_manager
 import colrev.exceptions as colrev_exceptions
-import colrev.ops.load_utils_ris
+import colrev.ops.built_in.search_sources.website as website_connector
+import colrev.ops.load_utils_bib
 import colrev.ops.search
 import colrev.record
+import colrev.ui_cli.cli_colors as colors
 
 # pylint: disable=unused-argument
 # pylint: disable=duplicate-code
 
 
-class PsycInfoRISParser(BaseParser):
-    """Parser for Psycinfo RIS files."""
-
-    START_TAG = "TY"
-    IGNORE = ["FN", "VR", "EF"]
-    PATTERN = r"^[A-Z][A-Z0-9]+ |^ER\s?|^EF\s?"
-    mapping = deepcopy(TAG_KEY_MAPPING)
-    # mapping["A1"] = "authors"
-    mapping["PM"] = "pubmedid"
-    # mapping["T1"] = "primary_title"
-    # mapping["JF"] = "secondary_title"
-    DEFAULT_MAPPING = mapping
-    DEFAULT_LIST_TAGS = LIST_TYPE_TAGS
-
-    def get_content(self, line: str) -> str:
-        "Get the content from a line."
-        return line[line.find(" - ") + 2 :].strip()
-
-    def is_header(self, line: str) -> bool:
-        "Check whether the line is a header element"
-        return not re.match("[A-Z0-9]+  - ", line)
-
-
 @zope.interface.implementer(
     colrev.env.package_manager.SearchSourcePackageEndpointInterface
 )
 @dataclass
-class PsycINFOSearchSource(JsonSchemaMixin):
-    """SearchSource for PsycINFO"""
+class VideoDirSearchSource(JsonSchemaMixin):
+    """SearchSource for directory containing video files"""
+
+    # pylint: disable=too-many-instance-attributes
 
     settings_class = colrev.env.package_manager.DefaultSourceSettings
-    source_identifier = "url"
-    search_type = colrev.settings.SearchType.DB
-    api_search_supported = False
+    source_identifier = "file"
+    search_type = colrev.settings.SearchType.OTHER
+    api_search_supported = True
     ci_supported: bool = False
-    heuristic_status = colrev.env.package_manager.SearchSourceHeuristicStatus.oni
-    short_name = "PsycInfo (APA)"
+    heuristic_status = colrev.env.package_manager.SearchSourceHeuristicStatus.supported
+    short_name = "Video directory"
     link = (
         "https://github.com/CoLRev-Environment/colrev/blob/main/"
-        + "colrev/ops/built_in/search_sources/psycinfo.md"
+        + "colrev/ops/built_in/search_sources/video_dir.md"
     )
 
     def __init__(
         self, *, source_operation: colrev.operation.Operation, settings: dict
     ) -> None:
         self.search_source = from_dict(data_class=self.settings_class, data=settings)
+        self.source_operation = source_operation
+        self.pdf_preparation_operation = (
+            source_operation.review_manager.get_pdf_prep_operation(
+                notify_state_transition_operation=False
+            )
+        )
 
-    def validate_source(
-        self,
-        search_operation: colrev.ops.search.Search,
-        source: colrev.settings.SearchSource,
+        self.video_path = source_operation.review_manager.path / Path(
+            self.search_source.search_parameters["scope"]["path"]
+        )
+        self.review_manager = source_operation.review_manager
+        self.prep_operation = self.review_manager.get_prep_operation()
+        self.url_connector = website_connector.WebsiteConnector(
+            review_manager=self.review_manager
+        )
+        self.zotero_lock = Lock()
+
+    def __index_video(self, *, path: Path) -> dict:
+        record_dict = {"ENTRYTYPE": "online", "file": path}
+        return record_dict
+
+    def run_search(
+        self, search_operation: colrev.ops.search.Search, rerun: bool
     ) -> None:
-        """Validate the SearchSource (parameters etc.)"""
+        """Run a search of a directory containing videos"""
 
-        search_operation.review_manager.logger.debug(
-            f"Validate SearchSource {source.filename}"
+        search_operation.review_manager.logger.info(
+            f"{colors.ORANGE}For better metadata, please add the url "
+            f"(or authors and title){colors.END}"
         )
 
-        if "query_file" not in source.search_parameters:
-            raise colrev_exceptions.InvalidQueryException(
-                f"Source missing query_file search_parameter ({source.filename})"
-            )
+        video_feed = self.search_source.get_feed(
+            review_manager=search_operation.review_manager,
+            source_identifier=self.source_identifier,
+            update_only=(not rerun),
+        )
+
+        overall_files = [
+            x.relative_to(search_operation.review_manager.path)
+            for x in self.video_path.glob("**/*.mp4")
+        ]
+
+        new_records_added = 0
+        for file_to_add in overall_files:
+            new_record = self.__index_video(path=file_to_add)
+
+            try:
+                video_feed.set_id(record_dict=new_record)
+            except colrev_exceptions.NotFeedIdentifiableException:
+                continue
 
-        if not Path(source.search_parameters["query_file"]).is_file():
-            raise colrev_exceptions.InvalidQueryException(
-                f"File does not exist: query_file {source.search_parameters['query_file']} "
-                f"for ({source.filename})"
+            added = video_feed.add_record(
+                record=colrev.record.Record(data=new_record),
             )
+            if added:
+                new_records_added += 1
 
-        search_operation.review_manager.logger.debug(
-            f"SearchSource {source.filename} validated"
+        video_feed.save_feed_file()
+
+        search_operation.review_manager.logger.info(
+            f"New videos added: {new_records_added}"
         )
 
     @classmethod
     def heuristic(cls, filename: Path, data: str) -> dict:
-        """Source heuristic for PsycINFO"""
-
-        result = {"confidence": 0.1}
+        """Source heuristic for video directories"""
 
-        # Note : no features in bib file for identification
-
-        if data.startswith(
-            "Provider: American Psychological Association\nDatabase: PsycINFO"
-        ):
+        result = {"confidence": 0.0}
+        if filename.suffix in [".mp4"]:
             result["confidence"] = 1.0
-
+            return result
         return result
 
     @classmethod
-    def add_endpoint(
-        cls, search_operation: colrev.ops.search.Search, query: str
-    ) -> colrev.settings.SearchSource:
+    def add_endpoint(cls, operation: colrev.ops.search.Search, params: str) -> None:
         """Add SearchSource as an endpoint (based on query provided to colrev search -a )"""
         raise NotImplementedError
 
-    def run_search(
-        self, search_operation: colrev.ops.search.Search, rerun: bool
-    ) -> None:
-        """Run a search of Psycinfo"""
-
     def get_masterdata(
         self,
         prep_operation: colrev.ops.prep.Prep,
         record: colrev.record.Record,
         save_feed: bool = True,
         timeout: int = 10,
     ) -> colrev.record.Record:
         """Not implemented"""
         return record
 
-    def __ris_fixes(self, *, entries: dict) -> None:
-        for entry in entries:
-            if "alternate_title3" in entry and entry["type_of_reference"] in ["JOUR"]:
-                entry["secondary_title"] = entry.pop("alternate_title3")
-            if "publication_year" in entry:
-                entry["year"] = entry.pop("publication_year")
-            if "first_authors" in entry and "authors" not in entry:
-                entry["authors"] = entry.pop("first_authors")
-
     def load(self, load_operation: colrev.ops.load.Load) -> dict:
         """Load the records from the SearchSource file"""
 
-        if self.search_source.filename.suffix == ".ris":
-            ris_entries = colrev.ops.load_utils_ris.load_ris_entries(
-                filename=self.search_source.filename, ris_parser=PsycInfoRISParser
-            )
-            self.__ris_fixes(entries=ris_entries)
-            records = colrev.ops.load_utils_ris.convert_to_records(ris_entries)
-
-            load_operation.review_manager.dataset.save_records_dict_to_file(
-                records=records,
-                save_path=self.search_source.get_corresponding_bib_file(),
+        if self.search_source.filename.suffix == ".bib":
+            records = colrev.ops.load_utils_bib.load_bib_file(
+                load_operation=load_operation, source=self.search_source
             )
             return records
 
         raise NotImplementedError
 
     def prepare(
         self, record: colrev.record.Record, source: colrev.settings.SearchSource
     ) -> colrev.record.Record:
-        """Source-specific preparation for PsycINFO"""
+        """Source-specific preparation for video directories"""
+
+        if "url" in record.data:
+            self.zotero_lock = Lock()
+            url_record = record.copy_prep_rec()
+            self.url_connector.retrieve_md_from_website(record=url_record)
+            if url_record.data.get("author", "") != "":
+                record.update_field(
+                    key="author", value=url_record.data["author"], source="website"
+                )
+            if url_record.data.get("title", "") != "":
+                record.update_field(
+                    key="title", value=url_record.data["title"], source="website"
+                )
+            self.zotero_lock.release()
 
         return record
```

### Comparing `colrev-0.9.2/colrev/ops/built_in/search_sources/pubmed.md` & `colrev-0.9.3/colrev/ops/built_in/search_sources/pubmed.md`

 * *Files 12% similar despite different names*

```diff
@@ -9,11 +9,13 @@
 [Pubmed](https://pubmed.ncbi.nlm.nih.gov/)
 
 ## Add the search source
 
 To add a pubmed API search, enter the query in the [Pubmed web interface](https://pubmed.ncbi.nlm.nih.gov/), run the search, copy the url and run:
 
 ```
-colrev search -a colrev.pubmed:"https://pubmed.ncbi.nlm.nih.gov/?term=fitbit"
+colrev search -a colrev.pubmed -p "https://pubmed.ncbi.nlm.nih.gov/?term=fitbit"
 ```
 
 ## Links
+
+- [Data field descriptions](https://www.nlm.nih.gov/bsd/mms/medlineelements.html)
```

### Comparing `colrev-0.9.2/colrev/ops/built_in/search_sources/pubmed.py` & `colrev-0.9.3/colrev/ops/built_in/search_sources/pubmed.py`

 * *Files 4% similar despite different names*

```diff
@@ -15,14 +15,15 @@
 
 import defusedxml
 import requests
 import zope.interface
 from dacite import from_dict
 from dataclasses_jsonschema import JsonSchemaMixin
 from defusedxml.lxml import fromstring
+from lxml.etree import XMLSyntaxError
 
 import colrev.env.package_manager
 import colrev.exceptions as colrev_exceptions
 import colrev.ops.load_utils_table
 import colrev.ops.search
 import colrev.record
 
@@ -39,14 +40,15 @@
 @dataclass
 class PubMedSearchSource(JsonSchemaMixin):
     """SearchSource for Pubmed"""
 
     settings_class = colrev.env.package_manager.DefaultSourceSettings
     source_identifier = "pubmedid"
     search_type = colrev.settings.SearchType.DB
+    endpoint = "colrev.pubmed"
     api_search_supported = True
     ci_supported: bool = True
     heuristic_status = colrev.env.package_manager.SearchSourceHeuristicStatus.supported
     short_name = "PubMed"
     link = (
         "https://github.com/CoLRev-Environment/colrev/blob/main/"
         + "colrev/ops/built_in/search_sources/pubmed.md"
@@ -71,15 +73,15 @@
                 for s in source_operation.review_manager.settings.sources
                 if s.filename == self.__pubmed_md_filename
             ]
             if pubmed_md_source_l:
                 self.search_source = pubmed_md_source_l[0]
             else:
                 self.search_source = colrev.settings.SearchSource(
-                    endpoint="colrev.pubmed",
+                    endpoint=self.endpoint,
                     filename=self.__pubmed_md_filename,
                     search_type=colrev.settings.SearchType.OTHER,
                     search_parameters={},
                     comment="",
                 )
 
             self.pubmed_lock = Lock()
@@ -105,65 +107,63 @@
         if "pmid " in data:
             if data.count(" pmid ") > data.count("\n@"):
                 result["confidence"] = 1.0
 
         return result
 
     @classmethod
-    def add_endpoint(
-        cls, search_operation: colrev.ops.search.Search, query: str
-    ) -> colrev.settings.SearchSource:
+    def add_endpoint(cls, operation: colrev.ops.search.Search, params: str) -> None:
         """Add SearchSource as an endpoint (based on query provided to colrev search -a )"""
 
-        host = urlparse(query).hostname
+        if params is None:
+            operation.add_interactively(endpoint=cls.endpoint)
+            return
+
+        host = urlparse(params).hostname
 
         if host and host.endswith("pubmed.ncbi.nlm.nih.gov"):
-            query = query.replace("https://pubmed.ncbi.nlm.nih.gov/?term=", "")
+            params = params.replace("https://pubmed.ncbi.nlm.nih.gov/?term=", "")
 
-            filename = search_operation.get_unique_filename(
-                file_path_string=f"pubmed_{query.replace('&sort=', '')}"
+            filename = operation.get_unique_filename(
+                file_path_string=f"pubmed_{params.replace('&sort=', '')}"
             )
-            query = (
+            params = (
                 "https://eutils.ncbi.nlm.nih.gov/entrez/eutils/esearch.fcgi?db=pubmed&term="
-                + query
+                + params
             )
             add_source = colrev.settings.SearchSource(
-                endpoint="colrev.pubmed",
+                endpoint=cls.endpoint,
                 filename=filename,
                 search_type=colrev.settings.SearchType.DB,
-                search_parameters={"query": query},
+                search_parameters={"query": params},
                 comment="",
             )
-            return add_source
+            operation.review_manager.settings.sources.append(add_source)
+            return
 
         raise NotImplementedError
 
-    def validate_source(
-        self,
-        search_operation: colrev.ops.search.Search,
-        source: colrev.settings.SearchSource,
-    ) -> None:
+    def __validate_source(self) -> None:
         """Validate the SearchSource (parameters etc.)"""
 
-        search_operation.review_manager.logger.debug(
-            f"Validate SearchSource {source.filename}"
-        )
+        # TO DO
+        source = self.search_source
+
+        self.review_manager.logger.debug(f"Validate SearchSource {source.filename}")
 
         if source.filename.name != self.__pubmed_md_filename.name:
             if "query" not in source.search_parameters:
                 raise colrev_exceptions.InvalidQueryException(
                     f"Source missing query search_parameter ({source.filename})"
                 )
 
             # if "query_file" in source.search_parameters:
             # ...
 
-        search_operation.review_manager.logger.debug(
-            f"SearchSource {source.filename} validated"
-        )
+        self.review_manager.logger.debug(f"SearchSource {source.filename} validated")
 
     def check_availability(
         self, *, source_operation: colrev.operation.Operation
     ) -> None:
         """Check status (availability) of the Pubmed API"""
 
         try:
@@ -219,16 +219,20 @@
 
     @classmethod
     def __get_title_string(cls, *, root) -> str:  # type: ignore
         title = root.xpath(
             "/PubmedArticleSet/PubmedArticle/MedlineCitation/Article/ArticleTitle"
         )
         if title:
-            title = title[0].text.strip().rstrip(".")
-        return title
+            if title[0].text:
+                title = title[0].text.strip().rstrip(".")
+                if title.startswith("[") and title.endswith("]"):
+                    title = title[1:-1]
+                return title
+        return ""
 
     @classmethod
     def __get_abstract_string(cls, *, root) -> str:  # type: ignore
         abstract = root.xpath(
             "/PubmedArticleSet/PubmedArticle/MedlineCitation/Article/Abstract"
         )
         if abstract:
@@ -262,15 +266,15 @@
         if number:
             retrieved_record_dict.update(number=number[0].text)
 
         year = root.xpath(journal_path + "/JournalIssue/PubDate/Year")
         if year:
             retrieved_record_dict.update(year=year[0].text)
 
-        retrieved_record_dict.update(volume=cls.__get_abstract_string(root=root))
+        retrieved_record_dict.update(abstract=cls.__get_abstract_string(root=root))
 
         article_id_list = root.xpath(
             "/PubmedArticleSet/PubmedArticle/PubmedData/ArticleIdList"
         )
         for article_id in article_id_list[0]:
             id_type = article_id.attrib.get("IdType")
             if article_id.attrib.get("IdType") == "pubmed":
@@ -290,15 +294,16 @@
             del retrieved_record_dict["pii"]
 
         return retrieved_record_dict
 
     def __get_pubmed_ids(self, query: str, retstart: int) -> typing.List[str]:
         headers = {"user-agent": f"{__name__} (mailto:{self.email})"}
         session = self.review_manager.get_cached_session()
-
+        if not query.startswith("https://pubmed.ncbi.nlm.nih.gov/?term="):
+            query = "https://pubmed.ncbi.nlm.nih.gov/?term=" + query
         ret = session.request(
             "GET", query + f"&retstart={retstart}", headers=headers, timeout=30
         )
 
         ret.raise_for_status()
         if ret.status_code != 200:
             # review_manager.logger.debug(
@@ -343,14 +348,18 @@
 
             root = fromstring(str.encode(ret.text))
             retrieved_record = self.__pubmed_xml_to_record(root=root)
             if not retrieved_record:
                 return {"pubmed_id": pubmed_id}
         except requests.exceptions.RequestException:
             return {"pubmed_id": pubmed_id}
+        except XMLSyntaxError as exc:
+            raise colrev_exceptions.RecordNotParsableException(
+                "Error parsing xml"
+            ) from exc
         # pylint: disable=duplicate-code
         except OperationalError as exc:
             raise colrev_exceptions.ServiceNotAvailableException(
                 "sqlite, required for requests CachedSession "
                 "(possibly caused by concurrent operations)"
             ) from exc
 
@@ -422,28 +431,37 @@
                 record.set_masterdata_complete(
                     source=retrieved_record.data["colrev_origin"][0],
                     masterdata_repository=self.review_manager.settings.is_curated_repo(),
                 )
                 record.set_status(target_state=colrev.record.RecordState.md_prepared)
                 if save_feed:
                     pubmed_feed.save_feed_file()
-                self.pubmed_lock.release()
+                try:
+                    self.pubmed_lock.release()
+                except ValueError:
+                    pass
+
                 return record
             except (
                 colrev_exceptions.InvalidMerge,
                 colrev_exceptions.NotFeedIdentifiableException,
             ):
-                self.pubmed_lock.release()
+                try:
+                    self.pubmed_lock.release()
+                except ValueError:
+                    pass
+
                 return record
 
         except (
             requests.exceptions.RequestException,
             OSError,
             IndexError,
             colrev_exceptions.RecordNotFoundInPrepSourceException,
+            colrev_exceptions.RecordNotParsableException,
         ):
             pass
         return record
 
     def get_masterdata(
         self,
         prep_operation: colrev.ops.prep.Prep,
@@ -452,23 +470,26 @@
         timeout: int = 10,
     ) -> colrev.record.Record:
         """Retrieve masterdata from Pubmed based on similarity with the record provided"""
 
         # To test the metadata provided for a particular pubmed-id use:
         # https://eutils.ncbi.nlm.nih.gov/entrez/eutils/efetch.fcgi?db=pubmed&id=10075143&rettype=xml&retmode=text
 
-        if len(record.data.get("title", "")) < 35 and "pubmedid" not in record.data:
+        if (
+            len(record.data.get("title", "")) < 35
+            and "colrev.pubmed.pubmedid" not in record.data
+        ):
             return record
 
         # at this point, we coujld validate metadata
         # if "pubmedid" not in record.data:
         #    record = self.__check_doi_masterdata(record=record)
 
         # remove the following if we match basd on similarity
-        if "pubmedid" not in record.data:
+        if "colrev.pubmed.pubmedid" not in record.data:
             return record
 
         record = self.__get_masterdata_record(
             prep_operation=prep_operation,
             record=record,
             timeout=timeout,
             save_feed=save_feed,
@@ -530,25 +551,22 @@
 
                 added = pubmed_feed.add_record(record=prep_record)
 
                 if added:
                     search_operation.review_manager.logger.info(
                         " retrieve pubmed-id=" + prep_record.data["pubmedid"]
                     )
-                    pubmed_feed.nr_added += 1
                 else:
-                    changed = pubmed_feed.update_existing_record(
+                    pubmed_feed.update_existing_record(
                         records=records,
                         record_dict=prep_record.data,
                         prev_record_dict_version=prev_record_dict_version,
                         source=self.search_source,
                         update_time_variant_fields=rerun,
                     )
-                    if changed:
-                        pubmed_feed.nr_changed += 1
 
                 # Note : only retrieve/update the latest deposits (unless in rerun mode)
                 if not added and not rerun:
                     # problem: some publishers don't necessarily
                     # deposit papers chronologically
                     break
 
@@ -598,34 +616,34 @@
             if retrieved_record["ID"] in pubmed_feed.feed_records:
                 prev_record_dict_version = pubmed_feed.feed_records[
                     retrieved_record["ID"]
                 ]
 
             pubmed_feed.add_record(record=colrev.record.Record(data=retrieved_record))
 
-            changed = pubmed_feed.update_existing_record(
+            pubmed_feed.update_existing_record(
                 records=records,
                 record_dict=retrieved_record,
                 prev_record_dict_version=prev_record_dict_version,
                 source=self.search_source,
                 update_time_variant_fields=True,
             )
-            if changed:
-                pubmed_feed.nr_changed += 1
 
         pubmed_feed.save_feed_file()
         pubmed_feed.print_post_run_search_infos(records=records)
         search_operation.review_manager.dataset.save_records_dict(records=records)
         search_operation.review_manager.dataset.add_record_changes()
 
     def run_search(
         self, search_operation: colrev.ops.search.Search, rerun: bool
     ) -> None:
         """Run a search of Pubmed"""
 
+        self.__validate_source()
+
         pubmed_feed = self.search_source.get_feed(
             review_manager=search_operation.review_manager,
             source_identifier=self.source_identifier,
             update_only=(not rerun),
         )
 
         if self.search_source.is_md_source() or self.search_source.is_quasi_md_source():
@@ -642,28 +660,28 @@
             )
 
     def load(self, load_operation: colrev.ops.load.Load) -> dict:
         """Load the records from the SearchSource file"""
 
         if self.search_source.filename.suffix == ".csv":
             csv_loader = colrev.ops.load_utils_table.CSVLoader(
-                load_operation=load_operation, settings=self.search_source
+                load_operation=load_operation, source=self.search_source
             )
             records = csv_loader.load()
             self.__load_fixes(records=records)
-            load_operation.review_manager.dataset.save_records_dict_to_file(
-                records=records,
-                save_path=self.search_source.get_corresponding_bib_file(),
+            return records
+
+        if self.search_source.filename.suffix == ".bib":
+            records = colrev.ops.load_utils_bib.load_bib_file(
+                load_operation=load_operation, source=self.search_source
             )
             return records
 
         raise NotImplementedError
 
-    # TODO : csv: parse volume/number/pages from citation field
-
     def __load_fixes(
         self,
         records: typing.Dict,
     ) -> None:
         """Load fixes for Pubmed"""
 
         for record in records.values():
@@ -674,42 +692,52 @@
                     author_list[i] = (
                         author_field_parts[0] + ", " + " ".join(author_field_parts[1:])
                     )
 
                 record["author"] = " and ".join(author_list)
             if "first_author" in record:
                 del record["first_author"]
-            if "citation" in record:
-                del record["citation"]
-            if "create_date" in record:
-                del record["create_date"]
             if record.get("journal", "") != "":
                 record["ENTRYTYPE"] = "article"
             if record.get("pii", "pii").lower() == record.get("doi", "doi").lower():
                 del record["pii"]
             if record.get("nihms_id", "") == "nan":
                 del record["nihms_id"]
+            if "citation" in record:
+                details_part = record["citation"]
+                details_part = details_part[details_part.find(";") + 1 :]
+                details_part = details_part[: details_part.find(".")]
+                if ":" in details_part:
+                    record["pages"] = details_part[details_part.find(":") + 1 :]
+                    details_part = details_part[: details_part.find(":")]
+                if "(" in details_part:
+                    record["number"] = details_part[details_part.find("(") + 1 : -1]
+                    details_part = details_part[: details_part.find("(")]
+                record["volume"] = details_part
+                del record["citation"]
+            if "journal/book" in record:
+                record["journal"] = record.pop("journal/book")
 
     def prepare(
         self, record: colrev.record.Record, source: colrev.settings.SearchSource
     ) -> colrev.record.Record:
         """Source-specific preparation for Pubmed"""
 
-        if "first_author" in record.data:
-            record.remove_field(key="first_author")
-        if "journal/book" in record.data:
-            record.rename_field(key="journal/book", new_key="journal")
+        if "colrev.pubmed.first_author" in record.data:
+            record.remove_field(key="colrev.pubmed.first_author")
         if record.data.get("author") == "UNKNOWN" and "authors" in record.data:
             record.remove_field(key="author")
             record.rename_field(key="authors", new_key="author")
 
         if record.data.get("year") == "UNKNOWN":
             record.remove_field(key="year")
-            if "publication_year" in record.data:
-                record.rename_field(key="publication_year", new_key="year")
+            if "colrev.pubmed.publication_year" in record.data:
+                record.rename_field(
+                    key="colrev.pubmed.publication_year", new_key="year"
+                )
 
         if "author" in record.data:
             record.data["author"] = colrev.record.PrepRecord.format_author_field(
                 input_string=record.data["author"]
             )
 
         # TBD: how to distinguish other types?
```

### Comparing `colrev-0.9.2/colrev/ops/built_in/search_sources/scopus.py` & `colrev-0.9.3/colrev/ops/built_in/search_sources/scopus.py`

 * *Files 11% similar despite different names*

```diff
@@ -6,15 +6,14 @@
 from pathlib import Path
 
 import zope.interface
 from dacite import from_dict
 from dataclasses_jsonschema import JsonSchemaMixin
 
 import colrev.env.package_manager
-import colrev.exceptions as colrev_exceptions
 import colrev.ops.load_utils_bib
 import colrev.ops.search
 import colrev.record
 
 # pylint: disable=unused-argument
 # pylint: disable=duplicate-code
 
@@ -56,46 +55,18 @@
         if "www.scopus.com" in data:
             if data.count("www.scopus.com") >= data.count("\n@"):
                 result["confidence"] = 1.0
 
         return result
 
     @classmethod
-    def add_endpoint(
-        cls, search_operation: colrev.ops.search.Search, query: str
-    ) -> colrev.settings.SearchSource:
+    def add_endpoint(cls, operation: colrev.ops.search.Search, params: str) -> None:
         """Add SearchSource as an endpoint (based on query provided to colrev search -a )"""
         raise NotImplementedError
 
-    def validate_source(
-        self,
-        search_operation: colrev.ops.search.Search,
-        source: colrev.settings.SearchSource,
-    ) -> None:
-        """Validate the SearchSource (parameters etc.)"""
-
-        search_operation.review_manager.logger.debug(
-            f"Validate SearchSource {source.filename}"
-        )
-
-        if "query_file" not in source.search_parameters:
-            print(
-                f"Warning: Source missing query_file search_parameter ({source.filename})"
-            )
-        else:
-            if not Path(source.search_parameters["query_file"]).is_file():
-                raise colrev_exceptions.InvalidQueryException(
-                    f"File does not exist: query_file {source.search_parameters['query_file']} "
-                    f"for ({source.filename})"
-                )
-
-        search_operation.review_manager.logger.debug(
-            f"SearchSource {source.filename} validated"
-        )
-
     def run_search(
         self, search_operation: colrev.ops.search.Search, rerun: bool
     ) -> None:
         """Run a search of Scopus"""
 
     def get_masterdata(
         self,
@@ -119,51 +90,61 @@
         raise NotImplementedError
 
     def prepare(
         self, record: colrev.record.Record, source: colrev.settings.SearchSource
     ) -> colrev.record.Record:
         """Source-specific preparation for Scopus"""
 
+        if "conference" == record.data["ENTRYTYPE"]:
+            record.data["ENTRYTYPE"] = "inproceedings"
+
         if "book" == record.data["ENTRYTYPE"]:
             if "journal" in record.data and "booktitle" not in record.data:
                 record.rename_field(key="title", new_key="booktitle")
                 record.rename_field(key="journal", new_key="title")
 
-        if "document_type" in record.data:
-            if record.data["document_type"] == "Conference Paper":
+        if "colrev.scopus.document_type" in record.data:
+            if record.data["colrev.scopus.document_type"] == "Conference Paper":
                 record.change_entrytype(
                     new_entrytype="inproceedings", qm=self.quality_model
                 )
 
-            elif record.data["document_type"] == "Conference Review":
+            elif record.data["colrev.scopus.document_type"] == "Conference Review":
                 record.change_entrytype(
                     new_entrytype="proceedings", qm=self.quality_model
                 )
 
-            elif record.data["document_type"] == "Article":
+            elif record.data["colrev.scopus.document_type"] == "Article":
                 record.change_entrytype(new_entrytype="article", qm=self.quality_model)
 
-            record.remove_field(key="document_type")
+            record.remove_field(key="colrev.scopus.document_type")
 
-        if "Start_Page" in record.data and "End_Page" in record.data:
-            if record.data["Start_Page"] != "nan" and record.data["End_Page"] != "nan":
+        if (
+            "colrev.scopus.Start_Page" in record.data
+            and "colrev.scopus.End_Page" in record.data
+        ):
+            if (
+                record.data["colrev.scopus.Start_Page"] != "nan"
+                and record.data["colrev.scopus.End_Page"] != "nan"
+            ):
                 record.data["pages"] = (
-                    record.data["Start_Page"] + "--" + record.data["End_Page"]
+                    record.data["colrev.scopus.Start_Page"]
+                    + "--"
+                    + record.data["colrev.scopus.End_Page"]
                 )
                 record.data["pages"] = record.data["pages"].replace(".0", "")
-                record.remove_field(key="Start_Page")
-                record.remove_field(key="End_Page")
+                record.remove_field(key="colrev.scopus.Start_Page")
+                record.remove_field(key="colrev.scopus.End_Page")
 
-        if "note" in record.data:
-            if "cited By " in record.data["note"]:
-                record.rename_field(key="note", new_key="cited_by")
+        if "colrev.scopus.note" in record.data:
+            if "cited By " in record.data["colrev.scopus.note"]:
+                record.rename_field(key="colrev.scopus.note", new_key="cited_by")
                 record.data["cited_by"] = record.data["cited_by"].replace(
                     "cited By ", ""
                 )
 
         if "author" in record.data:
             record.data["author"] = record.data["author"].replace("; ", " and ")
 
-        record.remove_field(key="source")
-        record.remove_field(key="art_number")
+        record.remove_field(key="colrev.scopus.source")
 
         return record
```

### Comparing `colrev-0.9.2/colrev/ops/built_in/search_sources/springer_link.py` & `colrev-0.9.3/colrev/ops/built_in/search_sources/springer_link.py`

 * *Files 17% similar despite different names*

```diff
@@ -8,15 +8,14 @@
 from pathlib import Path
 
 import zope.interface
 from dacite import from_dict
 from dataclasses_jsonschema import JsonSchemaMixin
 
 import colrev.env.package_manager
-import colrev.exceptions as colrev_exceptions
 import colrev.ops.load_utils_table
 import colrev.ops.search
 import colrev.record
 
 # pylint: disable=unused-argument
 # pylint: disable=duplicate-code
 
@@ -45,40 +44,14 @@
 
     def __init__(
         self, *, source_operation: colrev.operation.Operation, settings: dict
     ) -> None:
         self.search_source = from_dict(data_class=self.settings_class, data=settings)
         self.quality_model = source_operation.review_manager.get_qm()
 
-    def validate_source(
-        self,
-        search_operation: colrev.ops.search.Search,
-        source: colrev.settings.SearchSource,
-    ) -> None:
-        """Validate the SearchSource (parameters etc.)"""
-
-        search_operation.review_manager.logger.debug(
-            f"Validate SearchSource {source.filename}"
-        )
-
-        if "query_file" not in source.search_parameters:
-            raise colrev_exceptions.InvalidQueryException(
-                f"Source missing query_file search_parameter ({source.filename})"
-            )
-
-        if not Path(source.search_parameters["query_file"]).is_file():
-            raise colrev_exceptions.InvalidQueryException(
-                f"File does not exist: query_file {source.search_parameters['query_file']} "
-                f"for ({source.filename})"
-            )
-
-        search_operation.review_manager.logger.debug(
-            f"SearchSource {source.filename} validated"
-        )
-
     @classmethod
     def heuristic(cls, filename: Path, data: str) -> dict:
         """Source heuristic for Springer Link"""
 
         result = {"confidence": 0.0}
 
         if filename.suffix == ".csv":
@@ -87,17 +60,15 @@
                 return result
 
         # Note : no features in bib file for identification
 
         return result
 
     @classmethod
-    def add_endpoint(
-        cls, search_operation: colrev.ops.search.Search, query: str
-    ) -> colrev.settings.SearchSource:
+    def add_endpoint(cls, operation: colrev.ops.search.Search, params: str) -> None:
         """Add SearchSource as an endpoint (based on query provided to colrev search -a )"""
         raise NotImplementedError
 
     def run_search(
         self, search_operation: colrev.ops.search.Search, rerun: bool
     ) -> None:
         """Run a search of SpringerLink"""
@@ -113,22 +84,18 @@
         return record
 
     def load(self, load_operation: colrev.ops.load.Load) -> dict:
         """Load the records from the SearchSource file"""
 
         if self.search_source.filename.suffix == ".csv":
             csv_loader = colrev.ops.load_utils_table.CSVLoader(
-                load_operation=load_operation, settings=self.search_source
+                load_operation=load_operation, source=self.search_source
             )
             records = csv_loader.load()
             self.__load_fixes(records=records)
-            load_operation.review_manager.dataset.save_records_dict_to_file(
-                records=records,
-                save_path=self.search_source.get_corresponding_bib_file(),
-            )
             return records
 
         raise NotImplementedError
 
     def __load_fixes(
         self,
         records: typing.Dict,
```

### Comparing `colrev-0.9.2/colrev/ops/built_in/search_sources/synergy_datasets.py` & `colrev-0.9.3/colrev/ops/search.py`

 * *Files 27% similar despite different names*

```diff
@@ -1,197 +1,209 @@
 #! /usr/bin/env python
-"""SearchSource: SYNERGY-datasets"""
+"""CoLRev search operation: Search for relevant records."""
 from __future__ import annotations
 
-import datetime
-import tempfile
-from dataclasses import dataclass
 from pathlib import Path
+from typing import Callable
+from typing import Optional
 
-import pandas as pd
-import zope.interface
-from dacite import from_dict
-from dataclasses_jsonschema import JsonSchemaMixin
-from git import Repo
-
-import colrev.env.package_manager
 import colrev.exceptions as colrev_exceptions
-import colrev.ops.built_in.search_sources.crossref
-import colrev.ops.load_utils_bib
-import colrev.ops.search
-import colrev.record
-
-# pylint: disable=unused-argument
-
-# pylint: disable=duplicate-code
-
-
-@zope.interface.implementer(
-    colrev.env.package_manager.SearchSourcePackageEndpointInterface
-)
-@dataclass
-class SYNERGYDatasetsSearchSource(JsonSchemaMixin):
-    """SearchSource for SYNERGY-datasets
-
-    https://github.com/asreview/synergy-dataset
-
-    csv files available in the releases (output directories) are supported:
-    https://github.com/asreview/synergy-dataset/tags
-
-    csv files containing article IDs are supported by source-specific preparation.
-    metadata is added based on dois and pubmedid (openalex is not yet supported)
-
-    """
-
-    settings_class = colrev.env.package_manager.DefaultSourceSettings
-    source_identifier = "ID"
-    search_type = colrev.settings.SearchType.DB
-    api_search_supported = False
-    ci_supported: bool = False
-    heuristic_status = colrev.env.package_manager.SearchSourceHeuristicStatus.supported
-    short_name = "SYNERGY-datasets"
-    link = (
-        "https://github.com/CoLRev-Environment/colrev/blob/main/"
-        + "colrev/ops/built_in/search_sources/systematic_review_datasets.md"
-    )
+import colrev.operation
+import colrev.settings
+import colrev.ui_cli.cli_colors as colors
+
+
+class Search(colrev.operation.Operation):
+    """Search for new records"""
 
     def __init__(
-        self, *, source_operation: colrev.operation.Operation, settings: dict
+        self,
+        *,
+        review_manager: colrev.review_manager.ReviewManager,
+        notify_state_transition_operation: bool = True,
     ) -> None:
-        self.search_source = from_dict(data_class=self.settings_class, data=settings)
-        self.quality_model = source_operation.review_manager.get_qm()
-        self.review_manager = source_operation.review_manager
-
-    @classmethod
-    def heuristic(cls, filename: Path, data: str) -> dict:
-        """Source heuristic for SYNERGY-datasets"""
-
-        result = {"confidence": 0.0}
-
-        if "doi,pmid,openalex_id,label_included" in data:
-            result["confidence"] = 1.0
-
-        if '"doi","pmid","openalex_id","label_included"' in data:
-            result["confidence"] = 1.0
-
-        if (
-            "record_id,pubmedID,title,authors,abstract,year,label_included,label_abstract_screening"
-            in data
-        ):
-            result["confidence"] = 1.0
-
-        return result
-
-    @classmethod
-    def add_endpoint(
-        cls, search_operation: colrev.ops.search.Search, query: str
-    ) -> colrev.settings.SearchSource:
-        """Add SearchSource as an endpoint (based on query provided to colrev search -a )"""
-
-        if query.startswith("dataset="):
-            dataset = query.replace("dataset=", "")
-            filename = search_operation.get_unique_filename(
-                file_path_string=f"SYNERGY_{dataset}"
+        super().__init__(
+            review_manager=review_manager,
+            operations_type=colrev.operation.OperationsType.search,
+            notify_state_transition_operation=notify_state_transition_operation,
+        )
+
+        self.sources = review_manager.settings.sources
+
+    def get_unique_filename(self, file_path_string: str, suffix: str = ".bib") -> Path:
+        """Get a unique filename for a (new) SearchSource"""
+
+        file_path_string = (
+            file_path_string.replace("+", "_").replace(" ", "_").replace(";", "_")
+        )
+
+        if file_path_string.endswith(suffix):
+            file_path_string = file_path_string.rstrip(suffix)
+        filename = Path(f"data/search/{file_path_string}{suffix}")
+        existing_filenames = [x.filename for x in self.sources]
+        if filename not in existing_filenames:
+            return filename
+
+        i = 1
+        while filename in existing_filenames:
+            filename = Path(f"data/search/{file_path_string}_{i}{suffix}")
+            i += 1
+
+        return filename
+
+    def __get_search_sources(
+        self, *, selection_str: Optional[str] = None
+    ) -> list[colrev.settings.SearchSource]:
+        sources_selected = self.sources
+        if selection_str and selection_str != "all":
+            selected_filenames = {Path(f).name for f in selection_str.split(",")}
+            sources_selected = [
+                s for s in self.sources if s.filename.name in selected_filenames
+            ]
+
+        assert len(sources_selected) != 0
+        for source in sources_selected:
+            source.filename = self.review_manager.path / Path(source.filename)
+        return sources_selected
+
+    def remove_forthcoming(self, *, source: colrev.settings.SearchSource) -> None:
+        """Remove forthcoming papers from a SearchSource"""
+
+        if self.review_manager.settings.search.retrieve_forthcoming:
+            return
+
+        if source.filename.suffix != ".bib":
+            print(f"{source.filename.suffix} not yet supported")
+            return
+
+        with open(source.filename, encoding="utf8") as bibtex_file:
+            records = self.review_manager.dataset.load_records_dict(
+                load_str=bibtex_file.read()
             )
-            add_source = colrev.settings.SearchSource(
-                endpoint="colrev.synergy_datasets",
-                filename=filename,
-                search_type=colrev.settings.SearchType.DB,
-                search_parameters={"dataset": dataset},
-                comment="",
+
+            record_list = list(records.values())
+            before = len(record_list)
+            record_list = [r for r in record_list if "forthcoming" != r.get("year", "")]
+            removed = before - len(record_list)
+            self.review_manager.logger.info(
+                f"{colors.GREEN}Removed {removed} forthcoming{colors.END}"
             )
-            return add_source
+            records = {r["ID"]: r for r in record_list}
+            self.review_manager.dataset.save_records_dict_to_file(
+                records=records, save_path=source.filename
+            )
+
+    # pylint: disable=no-self-argument
+    def check_source_selection_exists(var_name: str) -> Callable:  # type: ignore
+        """Check if the source selection exists"""
+
+        # pylint: disable=no-self-argument
+        def check_accepts(func_in: Callable) -> Callable:
+            def new_f(self, *args, **kwds) -> Callable:  # type: ignore
+                if kwds.get(var_name, None) is None:
+                    return func_in(self, *args, **kwds)
+                for search_source in kwds[var_name].split(","):
+                    if Path(search_source) not in [
+                        s.filename for s in self.review_manager.settings.sources
+                    ]:
+                        raise colrev_exceptions.ParameterError(
+                            parameter="select",
+                            value=kwds[var_name],
+                            options=[
+                                str(s.filename)
+                                for s in self.review_manager.settings.sources
+                            ],
+                        )
+                return func_in(self, *args, **kwds)
+
+            new_f.__name__ = func_in.__name__
+            return new_f
+
+        return check_accepts
+
+    def add_interactively(self, *, endpoint: str) -> None:
+        """Add a SearchSource interactively"""
+        print(f"Interactively add {endpoint} as a SearchSource")
+        print()
+
+        keywords = input("Enter the keywords:")
 
-        raise colrev_exceptions.PackageParameterError(
-            f"Cannot add crossref endpoint with query {query}"
+        filename = self.get_unique_filename(
+            file_path_string=f"{endpoint.replace('colrev.', '')}_{keywords}"
         )
+        add_source = colrev.settings.SearchSource(
+            endpoint=endpoint,
+            filename=filename,
+            search_type=colrev.settings.SearchType.DB,
+            search_parameters={"query": keywords},
+            comment="",
+        )
+        self.review_manager.settings.sources.append(add_source)
 
-    def validate_source(
+    @check_source_selection_exists(  # pylint: disable=too-many-function-args
+        "selection_str"
+    )
+    @colrev.operation.Operation.decorate()
+    def main(
         self,
-        search_operation: colrev.ops.search.Search,
-        source: colrev.settings.SearchSource,
+        *,
+        selection_str: Optional[str] = None,
+        rerun: bool,
+        skip_commit: bool = False,
     ) -> None:
-        """Validate the SearchSource (parameters etc.)"""
+        """Search for records (main entrypoint)"""
 
-    def run_search(
-        self, search_operation: colrev.ops.search.Search, rerun: bool
-    ) -> None:
-        """Run a search of SystematicReviewDatasets"""
+        rerun_flag = "" if not rerun else f" ({colors.GREEN}rerun{colors.END})"
+        self.review_manager.logger.info(f"Search{rerun_flag}")
+        self.review_manager.logger.info(
+            "Retrieve new records from an API or files (search sources)."
+        )
+        self.review_manager.logger.info(
+            "See https://colrev.readthedocs.io/en/latest/manual/metadata_retrieval/search.html"
+        )
+
+        # Reload the settings because the search sources may have been updated
+        self.review_manager.settings = self.review_manager.load_settings()
+
+        package_manager = self.review_manager.get_package_manager()
 
-        # TODO
-        date_now_string = datetime.datetime.now().strftime("%Y-%m-%d_%H-%M-%S")
-        temp_path = tempfile.gettempdir() / Path(f"{date_now_string}-synergy")
-        temp_path.mkdir()
-        Repo.clone_from(
-            "https://github.com/asreview/synergy-dataset", temp_path, depth=1
-        )
-        dataset_name = self.search_source.search_parameters["dataset"]
-        filename = Path(dataset_name) / Path(f"{dataset_name}_ids").with_suffix(".csv")
-        dataset_df = pd.read_csv(temp_path / Path("datasets") / filename)
-
-        synergy_feed = self.search_source.get_feed(
-            review_manager=self.review_manager,
-            source_identifier=self.source_identifier,
-            update_only=False,
-        )
-        for i, record in enumerate(dataset_df.to_dict(orient="records")):
-            record["ID"] = i
-            record["ENTRYTYPE"] = "article"
-            for k in list(record.keys()):
-                if str(record[k]) == "nan":
-                    del record[k]
-            if "doi" in record.keys():
-                record["doi"] = str(record["doi"]).replace("https://doi.org/", "")
-            if "pmid" in record.keys():
-                record["pmid"] = str(record["pmid"]).replace(
-                    "https://pubmed.ncbi.nlm.nih.gov/", ""
-                )
-            if "openalex_id" in record.keys():
-                record["openalex_id"] = str(record["openalex_id"]).replace(
-                    "https://openalex.org/", ""
-                )
+        for source in self.__get_search_sources(selection_str=selection_str):
+            endpoint_dict = package_manager.load_packages(
+                package_type=colrev.env.package_manager.PackageEndpointType.search_source,
+                selected_packages=[source.get_dict()],
+                operation=self,
+                only_ci_supported=self.review_manager.in_ci_environment(),
+            )
+            if source.endpoint.lower() not in endpoint_dict:
+                continue
+            endpoint = endpoint_dict[source.endpoint.lower()]
 
-            # Skip records without metadata
-            if {"ID", "ENTRYTYPE", "label_included"} == set(record.keys()):
+            if not endpoint.api_search_supported:  # type: ignore
                 continue
 
-            synergy_feed.set_id(record_dict=record)
-            synergy_feed.add_record(record=colrev.record.Record(data=record))
+            if not self.review_manager.high_level_operation:
+                print()
+            self.review_manager.logger.info(
+                f"search [{source.endpoint} > data/search/{source.filename.name}]"
+            )
 
-            # The linking of doi/... should happen in the prep operation
+            try:
+                endpoint.run_search(search_operation=self, rerun=rerun)  # type: ignore
+            except colrev.exceptions.ServiceNotAvailableException as exc:
+                if not self.review_manager.force_mode:
+                    raise colrev_exceptions.ServiceNotAvailableException(
+                        source.endpoint
+                    ) from exc
+                self.review_manager.logger.warning("ServiceNotAvailableException")
 
-        synergy_feed.save_feed_file()
+            if not source.filename.is_file():
+                continue
 
-    def get_masterdata(
-        self,
-        prep_operation: colrev.ops.prep.Prep,
-        record: colrev.record.Record,
-        save_feed: bool = True,
-        timeout: int = 10,
-    ) -> colrev.record.Record:
-        """Not implemented"""
-        return record
-
-    def load(self, load_operation: colrev.ops.load.Load) -> dict:
-        """Load the records from the SearchSource file"""
-
-        if self.search_source.filename.suffix == ".bib":
-            records = colrev.ops.load_utils_bib.load_bib_file(
-                load_operation=load_operation, source=self.search_source
-            )
-            for record in records.values():
-                if "pmid" in record:
-                    record["pubmedid"] = record["pmid"].replace(
-                        "https://pubmed.ncbi.nlm.nih.gov/", ""
-                    )
-                    del record["pmid"]
-            return records
-
-        raise NotImplementedError
-
-    def prepare(
-        self, record: colrev.record.Record, source: colrev.settings.SearchSource
-    ) -> colrev.record.Record:
-        """Source-specific preparation for SYNERGY-datasets"""
-        if not any(x in record.data for x in ["pmid", "doi", "openalex_id"]):
-            record.prescreen_exclude(reason="no-metadata-available")
-        return record
+            self.remove_forthcoming(source=source)
+            self.review_manager.dataset.format_records_file()
+            self.review_manager.dataset.add_record_changes()
+            self.review_manager.dataset.add_changes(path=source.filename)
+            if not skip_commit:
+                self.review_manager.create_commit(msg="Run search")
+
+        if self.review_manager.in_ci_environment():
+            print("\n\n")
```

### Comparing `colrev-0.9.2/colrev/ops/built_in/search_sources/taylor_and_francis.py` & `colrev-0.9.3/colrev/ops/built_in/search_sources/taylor_and_francis.py`

 * *Files 7% similar despite different names*

```diff
@@ -53,26 +53,19 @@
             if data.count("eprint = { \n    \n    ") >= data.count("\n@"):
                 result["confidence"] = 1.0
 
         return result
 
     @classmethod
     def add_endpoint(
-        cls, search_operation: colrev.ops.search.Search, query: str
+        cls, operation: colrev.ops.search.Search, params: str
     ) -> colrev.settings.SearchSource:
         """Add SearchSource as an endpoint (based on query provided to colrev search -a )"""
         raise NotImplementedError
 
-    def validate_source(
-        self,
-        search_operation: colrev.ops.search.Search,
-        source: colrev.settings.SearchSource,
-    ) -> None:
-        """Validate the SearchSource (parameters etc.)"""
-
     def run_search(
         self, search_operation: colrev.ops.search.Search, rerun: bool
     ) -> None:
         """Run a search of TaylorAndFrancis"""
 
     def get_masterdata(
         self,
@@ -97,15 +90,19 @@
 
     def prepare(
         self, record: colrev.record.Record, source: colrev.settings.SearchSource
     ) -> colrev.record.Record:
         """Source-specific preparation for Taylor and Francis"""
 
         # remove eprint and URL fields (they only have dois...)
-        record.remove_field(key="url")
-        record.remove_field(key="eprint")
-        if "note" in record.data and re.match(r"PMID: \d*", record.data["note"]):
-            record.rename_field(key="note", new_key="pmid")
-            record.data["pmid"] = record.data["pmid"][6:]
-        record.remove_field(key="publisher")
+        record.remove_field(key="colrev.taylor_and_francis.eprint")
+        if "colrev.taylor_and_francis.note" in record.data and re.match(
+            r"PMID: \d*", record.data["colrev.taylor_and_francis.note"]
+        ):
+            record.rename_field(
+                key="colrev.taylor_and_francis.note", new_key="colrev.pubmed.pubmedid"
+            )
+            record.data["colrev.pubmed.pubmedid"] = record.data[
+                "colrev.pubmed.pubmedid"
+            ][6:]
 
         return record
```

### Comparing `colrev-0.9.2/colrev/ops/built_in/search_sources/unknown_source.py` & `colrev-0.9.3/colrev/ops/built_in/search_sources/unknown_source.py`

 * *Files 10% similar despite different names*

```diff
@@ -17,14 +17,15 @@
 import colrev.env.package_manager
 import colrev.exceptions as colrev_exceptions
 import colrev.ops.load_utils_bib
 import colrev.ops.load_utils_md
 import colrev.ops.load_utils_ris
 import colrev.ops.search
 import colrev.record
+import colrev.ui_cli.cli_colors as colors
 
 # pylint: disable=unused-argument
 # pylint: disable=duplicate-code
 
 
 @zope.interface.implementer(
     colrev.env.package_manager.SearchSourcePackageEndpointInterface
@@ -66,42 +67,18 @@
         """Source heuristic for unknown sources"""
 
         result = {"confidence": 0.1}
 
         return result
 
     @classmethod
-    def add_endpoint(
-        cls, search_operation: colrev.ops.search.Search, query: str
-    ) -> colrev.settings.SearchSource:
+    def add_endpoint(cls, operation: colrev.ops.search.Search, params: str) -> None:
         """Add SearchSource as an endpoint (based on query provided to colrev search -a )"""
         raise NotImplementedError
 
-    def validate_source(
-        self,
-        search_operation: colrev.ops.search.Search,
-        source: colrev.settings.SearchSource,
-    ) -> None:
-        """Validate the SearchSource (parameters etc.)"""
-
-        search_operation.review_manager.logger.debug(
-            f"Validate SearchSource {source.filename}"
-        )
-
-        if "query_file" in source.search_parameters:
-            if not Path(source.search_parameters["query_file"]).is_file():
-                raise colrev_exceptions.InvalidQueryException(
-                    f"File does not exist: query_file {source.search_parameters['query_file']} "
-                    f"for ({source.filename})"
-                )
-
-        search_operation.review_manager.logger.debug(
-            f"SearchSource {source.filename} validated"
-        )
-
     def run_search(
         self, search_operation: colrev.ops.search.Search, rerun: bool
     ) -> None:
         """Run a search of Crossref"""
 
     def get_masterdata(
         self,
@@ -117,67 +94,124 @@
         for entry in entries:
             if "title" in entry and "primary_title" not in entry:
                 entry["primary_title"] = entry.pop("title")
 
             if "publication_year" in entry and "year" not in entry:
                 entry["year"] = entry.pop("publication_year")
 
+    def __rename_erroneous_extensions(self) -> None:
+        if self.search_source.filename.suffix in [".xls", ".xlsx"]:
+            return
+        data = self.search_source.filename.read_text(encoding="utf-8")
+        # # Correct the file extension if necessary
+        if re.findall(
+            r"^%0", data, re.MULTILINE
+        ) and self.search_source.filename.suffix not in [".enl"]:
+            new_filename = self.search_source.filename.with_suffix(".enl")
+            self.review_manager.logger.info(
+                f"{colors.GREEN}Rename to {new_filename} "
+                f"(because the format is .enl){colors.END}"
+            )
+            self.search_source.filename.rename(new_filename)
+            self.review_manager.dataset.add_changes(
+                path=self.search_source.filename, remove=True
+            )
+            self.search_source.filename = new_filename
+            self.review_manager.dataset.add_changes(path=new_filename)
+            self.review_manager.create_commit(
+                msg=f"Rename {self.search_source.filename}"
+            )
+            return
+
+        if re.findall(
+            r"^TI ", data, re.MULTILINE
+        ) and self.search_source.filename.suffix not in [".ris"]:
+            new_filename = self.search_source.filename.with_suffix(".ris")
+            self.review_manager.logger.info(
+                f"{colors.GREEN}Rename to {new_filename} "
+                f"(because the format is .ris){colors.END}"
+            )
+            self.search_source.filename.rename(new_filename)
+            self.review_manager.dataset.add_changes(
+                path=self.search_source.filename, remove=True
+            )
+            self.search_source.filename = new_filename
+            self.review_manager.dataset.add_changes(path=new_filename)
+            self.review_manager.create_commit(
+                msg=f"Rename {self.search_source.filename}"
+            )
+
+    def __load_ris(self, *, load_operation: colrev.ops.load.Load) -> dict:
+        ris_loader = colrev.ops.load_utils_ris.RISLoader(
+            load_operation=load_operation, source=self.search_source
+        )
+        ris_loader.apply_ris_fixes(filename=self.search_source.filename)
+        ris_entries = ris_loader.load_ris_entries(filename=self.search_source.filename)
+        self.__ris_fixes(entries=ris_entries)
+        records = ris_loader.convert_to_records(entries=ris_entries)
+        return records
+
+    def __load_bib(self, *, load_operation: colrev.ops.load.Load) -> dict:
+        records = colrev.ops.load_utils_bib.load_bib_file(
+            load_operation=load_operation, source=self.search_source
+        )
+        return records
+
+    def __load_csv(self, *, load_operation: colrev.ops.load.Load) -> dict:
+        csv_loader = colrev.ops.load_utils_table.CSVLoader(
+            load_operation=load_operation, source=self.search_source
+        )
+        records = csv_loader.load()
+        return records
+
+    def __load_xlsx(self, *, load_operation: colrev.ops.load.Load) -> dict:
+        excel_loader = colrev.ops.load_utils_table.ExcelLoader(
+            load_operation=load_operation, source=self.search_source
+        )
+        records = excel_loader.load()
+        return records
+
+    def __load_md(self, *, load_operation: colrev.ops.load.Load) -> dict:
+        md_loader = colrev.ops.load_utils_md.MarkdownLoader(
+            load_operation=load_operation, source=self.search_source
+        )
+        records = md_loader.load()
+        return records
+
+    def __load_enl(self, *, load_operation: colrev.ops.load.Load) -> dict:
+        enl_loader = colrev.ops.load_utils_enl.ENLLoader(
+            load_operation=load_operation, source=self.search_source
+        )
+        records = enl_loader.load(source=self.search_source)
+        return records
+
     def load(self, load_operation: colrev.ops.load.Load) -> dict:
         """Load the records from the SearchSource file"""
-        if self.search_source.filename.suffix == ".ris":
-            colrev.ops.load_utils_ris.apply_ris_fixes(
-                filename=self.search_source.filename
-            )
-            ris_entries = colrev.ops.load_utils_ris.load_ris_entries(
-                filename=self.search_source.filename
-            )
-            self.__ris_fixes(entries=ris_entries)
-            records = colrev.ops.load_utils_ris.convert_to_records(ris_entries)
-            return records
 
-        if self.search_source.filename.suffix == ".bib":
-            records = colrev.ops.load_utils_bib.load_bib_file(
-                load_operation=load_operation, source=self.search_source
-            )
-            return records
+        if not self.search_source.filename.is_file():
+            return {}
 
-        if self.search_source.filename.suffix == ".csv":
-            csv_loader = colrev.ops.load_utils_table.CSVLoader(
-                load_operation=load_operation, settings=self.search_source
-            )
-            records = csv_loader.load()
-            load_operation.review_manager.dataset.save_records_dict_to_file(
-                records=records,
-                save_path=self.search_source.get_corresponding_bib_file(),
-            )
-            return records
+        self.__rename_erroneous_extensions()
 
-        if self.search_source.filename.suffix in [".xls", ".xlsx"]:
-            excel_loader = colrev.ops.load_utils_table.ExcelLoader(
-                load_operation=load_operation, source=self.search_source
-            )
-            records = excel_loader.load()
-            load_operation.review_manager.dataset.save_records_dict_to_file(
-                records=records,
-                save_path=self.search_source.get_corresponding_bib_file(),
-            )
-            return records
+        __load_methods = {
+            ".ris": self.__load_ris,
+            ".bib": self.__load_bib,
+            ".csv": self.__load_csv,
+            ".xls": self.__load_xlsx,
+            ".xlsx": self.__load_xlsx,
+            ".md": self.__load_md,
+            ".enl": self.__load_enl,
+        }
 
-        if self.search_source.filename.suffix == ".md":
-            md_loader = colrev.ops.load_utils_md.MarkdownLoader(
-                load_operation=load_operation, source=self.search_source
-            )
-            records = md_loader.load()
-            load_operation.review_manager.dataset.save_records_dict_to_file(
-                records=records,
-                save_path=self.search_source.get_corresponding_bib_file(),
-            )
-            return records
+        if self.search_source.filename.suffix not in __load_methods:
+            raise NotImplementedError
 
-        raise NotImplementedError
+        return __load_methods[self.search_source.filename.suffix](
+            load_operation=load_operation
+        )
 
     def __heuristically_fix_entrytypes(
         self, *, record: colrev.record.PrepRecord
     ) -> None:
         """Prepare the record by heuristically correcting erroneous ENTRYTYPEs"""
 
         # Journal articles should not have booktitles/series set.
@@ -410,14 +444,16 @@
         self, record: colrev.record.PrepRecord, source: colrev.settings.SearchSource
     ) -> colrev.record.Record:
         """Source-specific preparation for unknown sources"""
 
         if not record.has_quality_defects() or record.masterdata_is_curated():
             return record
 
+        # TODO : assign fields (e.g., to colrev.pubmed.pubmedid)
+
         self.__heuristically_fix_entrytypes(
             record=record,
         )
 
         self.__impute_missing_fields(record=record)
 
         self.__format_fields(record=record)
```

### Comparing `colrev-0.9.2/colrev/ops/built_in/search_sources/utils.py` & `colrev-0.9.3/colrev/ops/built_in/search_sources/utils.py`

 * *Files 5% similar despite different names*

```diff
@@ -33,15 +33,15 @@
     for author in item.get("author", "NA"):
         a_string = ""
         if "family" in author:
             a_string += author["family"]
             if "given" in author:
                 a_string += f", {author['given']}"
             authors_strings.append(a_string)
-    return " and ".join(authors_strings)
+    return " and ".join(authors_strings).replace(",,", ",")
 
 
 def __get_number(*, item: dict) -> str:
     if "journal-issue" in item:
         if "issue" in item["journal-issue"]:
             item["issue"] = item["journal-issue"]["issue"]
     return str(item.get("issue", ""))
@@ -156,14 +156,17 @@
         "warning",
         "language",
     ]
     record_dict = {
         k: v for k, v in record_dict.items() if k in supported_fields and v != ""
     }
 
+    if record_dict.get("abstract", "") == "No abstract is available for this article.":
+        del record_dict["abstract"]
+
     return record_dict
 
 
 def json_to_record(*, item: dict) -> dict:
     """Convert a crossref item to a record dict"""
 
     try:
```

### Comparing `colrev-0.9.2/colrev/ops/built_in/search_sources/website.py` & `colrev-0.9.3/colrev/ops/built_in/search_sources/website.py`

 * *Files 0% similar despite different names*

```diff
@@ -138,15 +138,15 @@
         self.__set_doi(record=record, item=item)
         self.__set_date(record=record, item=item)
         self.__set_pages(record=record, item=item)
         self.__set_url(record=record, item=item)
         self.__set_keywords(record=record, item=item)
 
     def retrieve_md_from_website(self, *, record: colrev.record.Record) -> None:
-        """Retrieve the metadata the associated website (url) based on Zotero"""
+        """Retrieve the metadata of the associated website (url) based on Zotero"""
 
         self.zotero_lock.acquire(timeout=60)
 
         zotero_translation_service = (
             self.review_manager.get_zotero_translation_service()
         )
         zotero_translation_service.start()
```

### Comparing `colrev-0.9.2/colrev/ops/built_in/search_sources/wiley.md` & `colrev-0.9.3/colrev/ops/built_in/search_sources/wiley.md`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/clone.py` & `colrev-0.9.3/colrev/ops/clone.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/commit.py` & `colrev-0.9.3/colrev/ops/commit.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/correct.py` & `colrev-0.9.3/colrev/ops/correct.py`

 * *Files 4% similar despite different names*

```diff
@@ -42,15 +42,15 @@
         "metadata_source_repository_paths",
         "grobid-version",
         "colrev_pdf_id",
         "file",
         "colrev_origin",
         "colrev_data_provenance",
         "colrev_masterdata_provenance",
-        "sem_scholar_id",
+        "colrev.semantic_scholar.id",
         "cited_by",
         "abstract",
         "pages",
     ]
 
     def __init__(
         self,
@@ -78,16 +78,16 @@
         # because the subsetting of change_items does not seem to
         # work properly
         keys_to_drop = ["pages", "colrev_status"]
         for k in keys_to_drop:
             original_record.pop(k, None)
             corrected_record.pop(k, None)
 
-        # if "dblp_key" in corrected_record:
-        #     del corrected_record["dblp_key"]
+        # if "colrev.dblp.dblp_key" in corrected_record:
+        #     del corrected_record["colrev.dblp.dblp_key"]
 
     def __create_change_item(
         self,
         *,
         original_record: dict,
         corrected_record: dict,
     ) -> None:
@@ -129,20 +129,26 @@
 
         if len(selected_change_items) == 0:
             return
 
         if len(corrected_record.get("colrev_origin", [])) > len(
             original_record.get("colrev_origin", [])
         ):
-            if "dblp_key" in corrected_record and "dblp_key" in original_record:
-                if corrected_record["dblp_key"] != original_record["dblp_key"]:
+            if (
+                "colrev.dblp.dblp_key" in corrected_record
+                and "colrev.dblp.dblp_key" in original_record
+            ):
+                if (
+                    corrected_record["colrev.dblp.dblp_key"]
+                    != original_record["colrev.dblp.dblp_key"]
+                ):
                     selected_change_items = {  # type: ignore
                         "merge": [
-                            corrected_record["dblp_key"],
-                            original_record["dblp_key"],
+                            corrected_record["colrev.dblp.dblp_key"],
+                            original_record["colrev.dblp.dblp_key"],
                         ]
                     }
             # else:
             #     selected_change_items = {
             #         "merge": [
             #             corrected_record["ID"],
             #             original_record["ID"],
```

### Comparing `colrev-0.9.2/colrev/ops/dashboard.py` & `colrev-0.9.3/colrev/ops/dashboard.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/data.py` & `colrev-0.9.3/colrev/ops/data.py`

 * *Files 2% similar despite different names*

```diff
@@ -199,20 +199,14 @@
             margins=True,
         )
         self.review_manager.logger.info("Generate output/ENTRYTYPES.csv")
         tabulated.to_csv(output_dir / Path("ENTRYTYPES.csv"))
 
         self.review_manager.logger.info(f"Files are available in {output_dir.name}")
 
-    def add_data_endpoint(self, *, data_endpoint: dict) -> None:
-        """Add a data endpoint"""
-
-        self.review_manager.settings.data.data_package_endpoints.append(data_endpoint)
-        self.review_manager.save_settings()
-
     def setup_custom_script(self) -> None:
         """Setup a custom data script"""
 
         filedata = colrev.env.utils.get_package_file_content(
             file_path=Path("template/custom_scripts/custom_data_script.py")
         )
         if filedata:
```

### Comparing `colrev-0.9.2/colrev/ops/dedupe.py` & `colrev-0.9.3/colrev/ops/dedupe.py`

 * *Files 1% similar despite different names*

```diff
@@ -833,15 +833,21 @@
 
         self.review_manager.logger.info(
             "Dedupe operation [merge based on identical global_ids]"
         )
 
         records = self.review_manager.dataset.load_records_dict()
 
-        global_keys = ["doi", "colrev_id", "pubmedid", "dblp_key", "url"]
+        global_keys = [
+            "doi",
+            "colrev_id",
+            "colrev.pubmed.pubmedid",
+            "colrev.dblp.dblp_key",
+            "url",
+        ]
         if "colrev_id" in global_keys:
             for record in records.values():
                 try:
                     record["colrev_id"] = colrev.record.Record(
                         data=record
                     ).create_colrev_id()
                 except colrev_exceptions.NotEnoughDataToIdentifyException:
```

### Comparing `colrev-0.9.2/colrev/ops/distribute.py` & `colrev-0.9.3/colrev/ops/distribute.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/init.py` & `colrev-0.9.3/colrev/ops/init.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/load.py` & `colrev-0.9.3/colrev/ops/load.py`

 * *Files 11% similar despite different names*

```diff
@@ -1,43 +1,27 @@
 #! /usr/bin/env python
 """CoLRev load operation: Load records from search sources into references.bib."""
 from __future__ import annotations
 
-import html
 import itertools
-import re
 import string
 import typing
 from pathlib import Path
 
-import colrev.env.language_service
 import colrev.exceptions as colrev_exceptions
 import colrev.operation
+import colrev.ops.load_utils_formatter
 import colrev.record
 import colrev.settings
 import colrev.ui_cli.cli_colors as colors
 
 
 class Load(colrev.operation.Operation):
-    """Load the records"""
 
-    # TODO : extract to separate format conversion script
-    __LATEX_SPECIAL_CHAR_MAPPING = {
-        '\\"u': "",
-        "\\&": "&",
-        '\\"o': "",
-        '\\"a': "",
-        '\\"A': "",
-        '\\"O': "",
-        '\\"U': "",
-        "\\textendash": "",
-        "\\textemdash": "",
-        "\\~a": "",
-        "\\'o": "",
-    }
+    """Load the records"""
 
     def __init__(
         self,
         *,
         review_manager: colrev.review_manager.ReviewManager,
         notify_state_transition_operation: bool = True,
         hide_load_explanation: bool = False,
@@ -46,15 +30,16 @@
             review_manager=review_manager,
             operations_type=colrev.operation.OperationsType.load,
             notify_state_transition_operation=notify_state_transition_operation,
         )
 
         self.quality_model = review_manager.get_qm()
         self.package_manager = self.review_manager.get_package_manager()
-        self.language_service = colrev.env.language_service.LanguageService()
+
+        self.load_formatter = colrev.ops.load_utils_formatter.LoadFormatter()
 
         if not hide_load_explanation:
             self.review_manager.logger.info("Load")
             self.review_manager.logger.info(
                 "Load converts search results and adds them to the shared data/records.bib."
             )
             self.review_manager.logger.info(
@@ -73,19 +58,15 @@
         ]
 
         # Only files that are not yet registered
         # (also exclude bib files corresponding to a registered file)
         files = [
             f
             for f in files
-            if str(f.with_suffix(".bib"))
-            not in [
-                str(s.filename.with_suffix(".bib"))
-                for s in self.review_manager.settings.sources
-            ]
+            if f not in [s.filename for s in self.review_manager.settings.sources]
         ]
 
         return sorted(list(set(files)))
 
     def __get_currently_imported_origin_list(self) -> list:
         records_headers = self.review_manager.dataset.load_records_dict(
             header_only=True
@@ -104,63 +85,27 @@
         data: str,
     ) -> list:
         results_list = []
         for (
             endpoint,
             endpoint_class,
         ) in search_sources.items():
-            # pylint: disable=no-member
-            has_heuristic = getattr(endpoint_class, "heuristic", None)
-            if not has_heuristic:
-                self.review_manager.logger.debug(f"- {endpoint}: no heuristic")
-                continue
             res = endpoint_class.heuristic(filepath, data)  # type: ignore
             self.review_manager.logger.debug(f"- {endpoint}: {res['confidence']}")
             if res["confidence"] == 0.0:
                 continue
             try:
                 result_item = {}
 
                 res["endpoint"] = endpoint
 
                 search_type = endpoint_class.search_type
                 # Note : as the identifier, we use the filename
                 # (if search results are added by file/not via the API)
 
-                # Correct the file extension if necessary
-                if re.findall(r"^%0", data, re.MULTILINE) and filepath.suffix not in [
-                    ".enl"
-                ]:
-                    new_filename = filepath.with_suffix(".enl")
-                    self.review_manager.logger.info(
-                        f"{colors.GREEN}Rename to {new_filename} "
-                        f"(because the format is .enl){colors.END}"
-                    )
-                    filepath.rename(new_filename)
-                    self.review_manager.dataset.add_changes(path=filepath, remove=True)
-                    filepath = new_filename
-                    res["filename"] = filepath
-                    self.review_manager.dataset.add_changes(path=new_filename)
-                    self.review_manager.create_commit(msg=f"Rename {filepath}")
-
-                if re.findall(r"^TI ", data, re.MULTILINE) and filepath.suffix not in [
-                    ".ris"
-                ]:
-                    new_filename = filepath.with_suffix(".ris")
-                    self.review_manager.logger.info(
-                        f"{colors.GREEN}Rename to {new_filename} "
-                        f"(because the format is .ris){colors.END}"
-                    )
-                    filepath.rename(new_filename)
-                    self.review_manager.dataset.add_changes(path=filepath, remove=True)
-                    filepath = new_filename
-                    res["filename"] = filepath
-                    self.review_manager.dataset.add_changes(path=new_filename)
-                    self.review_manager.create_commit(msg=f"Rename {filepath}")
-
                 source_candidate = colrev.settings.SearchSource(
                     endpoint=endpoint,
                     filename=filepath,
                     search_type=search_type,
                     search_parameters={},
                     comment="",
                 )
@@ -170,18 +115,15 @@
 
                 results_list.append(result_item)
             except colrev_exceptions.UnsupportedImportFormatError:
                 continue
         return results_list
 
     def __apply_source_heuristics(
-        self,
-        *,
-        filepath: Path,
-        search_sources: dict,
+        self, *, filepath: Path, search_sources: dict
     ) -> list[typing.Dict]:
         """Apply heuristics to identify source"""
 
         data = ""
         try:
             data = filepath.read_text()
         except UnicodeDecodeError:
@@ -195,23 +137,58 @@
 
         # Reduce the results_list when there are results with very high confidence
         if [r for r in results_list if r["confidence"] > 0.95]:
             results_list = [r for r in results_list if r["confidence"] > 0.8]
 
         return results_list
 
-    def get_new_sources_heuristic_list(self) -> list:
-        """Get the heuristic result list of new SearchSources"""
+    def get_most_likely_sources(self) -> list:
+        """Get the most likely SearchSources
+
+        returns a dictionary:
+        {"filepath": [SearchSource1,..]}
+        """
+
+        heuristic_list = self.get_new_sources_heuristic_list()
+        selected_search_sources = []
+
+        for results_list in heuristic_list.values():
+            # Use the last / unknown_source
+            max_conf = 0.0
+            best_candidate_pos = 0
+            for i, heuristic_candidate in enumerate(results_list):
+                if heuristic_candidate["confidence"] > max_conf:
+                    best_candidate_pos = i + 1
+                    max_conf = heuristic_candidate["confidence"]
+            if not any(c["confidence"] > 0.1 for c in results_list):
+                source = [
+                    x
+                    for x in results_list
+                    if x["source_candidate"].endpoint == "colrev.unknown_source"
+                ][0]
+            else:
+                selection = str(best_candidate_pos)
+                source = results_list[int(selection) - 1]
+            selected_search_sources.append(source["source_candidate"])
+
+        return selected_search_sources
+
+    def get_new_sources_heuristic_list(self) -> dict:
+        """Get the heuristic result list of SearchSources candidates
+
+        returns a dictionary:
+        {"filepath": ({"search_source": SourceCandidate1", "confidence": 0.98},..]}
+        """
 
         # pylint: disable=redefined-outer-name
 
         new_search_files = self.__get_new_search_files()
         if not new_search_files:
             self.review_manager.logger.info("No new search files...")
-            return []
+            return {}
 
         self.review_manager.logger.debug("Load available search_source endpoints...")
 
         search_source_identifiers = self.package_manager.discover_packages(
             package_type=colrev.env.package_manager.PackageEndpointType.search_source,
             installed_only=True,
         )
@@ -219,53 +196,56 @@
         search_sources = self.package_manager.load_packages(
             package_type=colrev.env.package_manager.PackageEndpointType.search_source,
             selected_packages=[{"endpoint": p} for p in search_source_identifiers],
             operation=self,
             instantiate_objects=False,
         )
 
-        heuristic_result_list = []
-        for sfp in new_search_files:
-            sfp_name = sfp
-            if sfp_name in [
-                str(source.filename) for source in self.review_manager.settings.sources
-            ]:
-                continue
-
+        heuristic_results = {}
+        for sfp_name in new_search_files:
             if not self.review_manager.high_level_operation:
                 print()
             self.review_manager.logger.info(f"Discover new source: {sfp_name}")
 
-            heuristic_result_list.append(
-                self.__apply_source_heuristics(
-                    filepath=sfp,
-                    search_sources=search_sources,
-                )
+            heuristic_results[sfp_name] = self.__apply_source_heuristics(
+                filepath=sfp_name,
+                search_sources=search_sources,
             )
-        return heuristic_result_list
 
-    def __unescape_latex(self, *, input_str: str) -> str:
-        # Based on
-        # https://en.wikibooks.org/wiki/LaTeX/Special_Characters
+        return heuristic_results
 
-        for latex_char, repl_char in self.__LATEX_SPECIAL_CHAR_MAPPING.items():
-            input_str = input_str.replace(latex_char, repl_char)
+    def ensure_append_only(self, *, file: Path) -> None:
+        """Ensure that the file was only appended to.
 
-        input_str = input_str.replace("\\emph", "")
-        input_str = input_str.replace("\\textit", "")
+        This method must be called for all extensions that work
+        with an ex-post assignment of incremental IDs."""
 
-        return input_str
-
-    def __unescape_html(self, *, input_str: str) -> str:
-        input_str = html.unescape(input_str)
-        if "<" in input_str:
-            input_str = re.sub(r"<.*?>", "", input_str)
-        return input_str
+        git_repo = self.review_manager.dataset.get_repo()
+        revlist = (
+            (
+                commit.hexsha,
+                (commit.tree / "data" / "search" / file.name).data_stream.read(),
+            )
+            for commit in git_repo.iter_commits(paths=str(file))
+        )
+        prior_file_content = ""
+        for commit, filecontents in list(revlist):
+            print(prior_file_content)
+            if not filecontents.decode("utf-8").startswith(prior_file_content):
+                raise colrev_exceptions.AppendOnlyViolation(
+                    f"{file} was changed (commit: {commit})"
+                )
+            prior_file_content = filecontents.decode("utf-8")
+        current_contents = file.read_text(encoding="utf-8")
+        if not current_contents.startswith(prior_file_content):
+            raise colrev_exceptions.AppendOnlyViolation(
+                f"{file} was changed (uncommitted file)"
+            )
 
-    def import_provenance(
+    def __import_provenance(
         self,
         *,
         record: colrev.record.Record,
     ) -> None:
         """Set the provenance for an imported record"""
 
         def set_initial_import_provenance(*, record: colrev.record.Record) -> None:
@@ -292,105 +272,23 @@
             record.data["colrev_data_provenance"] = colrev_data_provenance
             record.data["colrev_masterdata_provenance"] = colrev_masterdata_provenance
 
         if not record.masterdata_is_curated():
             set_initial_import_provenance(record=record)
             record.update_masterdata_provenance(qm=self.quality_model)
 
-    def __import_format_fields(self, *, record: colrev.record.Record) -> None:
-        # pylint: disable=duplicate-code
-        # For better readability of the git diff:
-        fields_to_process = [
-            f
-            for f in [
-                "author",
-                "year",
-                "title",
-                "journal",
-                "booktitle",
-                "series",
-                "volume",
-                "number",
-                "pages",
-                "doi",
-                "abstract",
-            ]
-            if f in record.data
-        ]
-
-        for field in fields_to_process:
-            if "\\" in record.data[field]:
-                record.data[field] = self.__unescape_latex(input_str=record.data[field])
-            if "<" in record.data[field]:
-                record.data[field] = self.__unescape_html(input_str=record.data[field])
-
-            record.data[field] = (
-                record.data[field]
-                .replace("\n", " ")
-                .rstrip()
-                .lstrip()
-                .replace("{", "")
-                .replace("}", "")
-            )
-        if record.data.get("title", "UNKNOWN") != "UNKNOWN":
-            record.data["title"] = re.sub(r"\s+", " ", record.data["title"]).rstrip(".")
-
-        if "year" in record.data and str(record.data["year"]).endswith(".0"):
-            record.data["year"] = str(record.data["year"])[:-2]
-
-        if "pages" in record.data:
-            record.data["pages"] = record.data["pages"].replace("", "--")
-            if record.data["pages"].count("-") == 1:
-                record.data["pages"] = record.data["pages"].replace("-", "--")
-            if record.data["pages"].lower() == "n.pag":
-                del record.data["pages"]
-
-    def __import_process_fields(self, *, record: colrev.record.Record) -> None:
-        # Consistently set keys to lower case
-        lower_keys = [k.lower() for k in list(record.data.keys())]
-        for key, n_key in zip(list(record.data.keys()), lower_keys):
-            if key not in ["ID", "ENTRYTYPE"]:
-                record.data[n_key] = record.data.pop(key)
-
-        self.__import_format_fields(record=record)
-
-        if "number" not in record.data and "issue" in record.data:
-            record.data.update(number=record.data["issue"])
-            del record.data["issue"]
-
-        if record.data.get("volume", "") == "ahead-of-print":
-            del record.data["volume"]
-        if record.data.get("number", "") == "ahead-of-print":
-            del record.data["number"]
-
-        if "language" in record.data and len(record.data["language"]) != 3:
-            self.language_service.unify_to_iso_639_3_language_codes(record=record)
-
-        if "url" in record.data and "login?url=https" in record.data["url"]:
-            record.data["url"] = record.data["url"][
-                record.data["url"].find("login?url=https") + 10 :
-            ]
-
     def __import_record(self, *, record_dict: dict) -> dict:
-        self.review_manager.logger.debug(
-            f'import_record {record_dict["ID"]}: '
-            # f"\n{self.review_manager.p_printer.pformat(record_dict)}\n\n"
-        )
+        self.review_manager.logger.debug(f'import_record {record_dict["ID"]}: ')
 
         record = colrev.record.Record(data=record_dict)
-        if record.data["colrev_status"] == colrev.record.RecordState.md_retrieved:
-            self.__import_process_fields(record=record)
 
-        if "doi" in record.data:
-            record.data.update(
-                doi=record.data["doi"].replace("http://dx.doi.org/", "").upper()
-            )
-        self.import_provenance(
-            record=record,
-        )
+        # For better readability of the git diff:
+        self.load_formatter.run(record=record)
+
+        self.__import_provenance(record=record)
 
         if record.data["colrev_status"] in [
             colrev.record.RecordState.md_retrieved,
             colrev.record.RecordState.md_needs_manual_preparation,
         ]:
             record.set_status(target_state=colrev.record.RecordState.md_imported)
 
@@ -482,58 +380,62 @@
         *,
         source: colrev.env.package_manager.SearchSourcePackageEndpointInterface,
         keep_ids: bool,
     ) -> None:
         self.__setup_source_for_load(source=source)
         records = self.review_manager.dataset.load_records_dict()
         for source_record in source.search_source.source_records_list:
+            # prefix non-standardized field keys
+            for key in list(source_record.keys()):
+                if key in colrev.record.Record.standardized_field_keys:
+                    continue
+                source_record[
+                    f"{source.search_source.endpoint}.{key}"
+                ] = source_record.pop(key)
+
             source_record = self.__import_record(record_dict=source_record)
 
             # Make sure not to replace existing records
             order = 0
             letters = list(string.ascii_lowercase)
             next_unique_id = source_record["ID"]
             appends: list = []
             while next_unique_id in records:
                 if len(appends) == 0:
                     order += 1
                     appends = list(itertools.product(letters, repeat=order))
                 next_unique_id = source_record["ID"] + "".join(list(appends.pop(0)))
             source_record["ID"] = next_unique_id
+
             records[source_record["ID"]] = source_record
 
             self.review_manager.logger.info(
                 f" {colors.GREEN}{source_record['ID']}".ljust(46)
                 + f"md_retrieved   {source_record['colrev_status']}{colors.END}"
             )
 
         self.review_manager.dataset.save_records_dict(records=records)
         self.__validate_load(source=source)
 
-        if keep_ids:
-            self.review_manager.logger.warning(
-                "Not yet fully implemented. Need to check/resolve ID duplicates."
-            )
-        else:
+        if not keep_ids:
+            # Set IDs based on local_index
+            # (the same records are more likely to have the same ID on the same machine)
             self.review_manager.logger.debug("Set IDs")
             records = self.review_manager.dataset.set_ids(
                 records=records,
                 selected_ids=[
                     r["ID"] for r in source.search_source.source_records_list
                 ],
             )
 
         self.review_manager.logger.info(
             "New records loaded".ljust(38) + f"{source.search_source.to_import} records"
         )
 
         self.review_manager.dataset.add_setting_changes()
-        self.review_manager.dataset.add_changes(
-            path=source.search_source.get_corresponding_bib_file()
-        )
         self.review_manager.dataset.add_changes(path=source.search_source.filename)
         self.review_manager.dataset.add_record_changes()
         if (
             0 == getattr(source.search_source, "to_import", 0)
             and not self.review_manager.high_level_operation
         ):
             print()
@@ -555,18 +457,20 @@
                 self.review_manager.dataset.add_changes(
                     path=Path(obj.b_path), remove=True
                 )
 
     def __load_active_sources(
         self, *, new_sources: typing.List[colrev.settings.SearchSource]
     ) -> list:
+        assert all(isinstance(x, colrev.settings.SearchSource) for x in new_sources)
         checker = self.review_manager.get_checker()
         checker.check_sources()
         sources_settings = []
         for source in self.review_manager.settings.sources:
+            assert isinstance(source, colrev.settings.SearchSource)
             sources_settings.append(source)
         for source in new_sources:
             if source.filename not in [s.filename for s in sources_settings]:
                 sources_settings.append(source)
         sources = []
         package_manager = self.review_manager.get_package_manager()
         for source in sources_settings:
@@ -611,15 +515,22 @@
             ]
             self.review_manager.logger.error(
                 f"{colors.RED}Records not yet imported: {missing_origins}{colors.END}"
             )
         else:
             self.review_manager.logger.error(
                 f"{colors.RED}PROBLEM: "
-                f"{source.search_source.to_import - imported} records too much{colors.END}"
+                f"{-1*(source.search_source.to_import - imported)}"
+                f" records too much{colors.END}"
+            )
+            additional_origins = [
+                o for o in imported_origins if o not in origins_to_import
+            ]
+            self.review_manager.logger.error(
+                f"{colors.RED}Records additionally imported: {additional_origins}{colors.END}"
             )
 
     def __create_load_commit(self, source: colrev.settings.SearchSource) -> None:
         git_repo = self.review_manager.dataset.get_repo()
         stashed = "No local changes to save" != git_repo.git.stash(
             "push", "--keep-index"
         )
```

### Comparing `colrev-0.9.2/colrev/ops/load_utils_bib.py` & `colrev-0.9.3/colrev/ops/load_utils_bib.py`

 * *Files 16% similar despite different names*

```diff
@@ -1,41 +1,84 @@
 #! /usr/bin/env python
 """Convenience functions to load bib files"""
 from __future__ import annotations
 
 import os
 import re
 import typing
-from pathlib import Path
 from typing import TYPE_CHECKING
 
 import colrev.exceptions as colrev_exceptions
 
 if TYPE_CHECKING:
     import colrev.ops.load
 
 
-def __apply_file_fixes(*, load_operation: colrev.ops.load.Load, filename: Path) -> None:
+def __apply_file_fixes(
+    *,
+    load_operation: colrev.ops.load.Load,
+    source: colrev.settings.SearchSource,
+) -> None:
     # pylint: disable=duplicate-code
+    # pylint: disable=too-many-statements
 
-    if not filename.is_file():
+    def fix_key(
+        file: typing.IO, line: bytes, replacement_line: bytes, seekpos: int
+    ) -> int:
+        load_operation.review_manager.logger.info(
+            f"Fix invalid key: \n{line.decode('utf-8')}"
+            f"{replacement_line.decode('utf-8')}"
+        )
+        line = file.readline()
+        remaining = line + file.read()
+        file.seek(seekpos)
+        file.write(replacement_line)
+        seekpos = file.tell()
+        file.flush()
+        os.fsync(file)
+        file.write(remaining)
+        file.truncate()  # if the replacement is shorter...
+        file.seek(seekpos)
+        return seekpos
+
+    if not source.filename.is_file():
+        load_operation.review_manager.logger.debug(
+            f"Did not find bib file {source.filename} "
+        )
         return
 
+    with open(source.filename, encoding="utf8") as bibtex_file:
+        contents = bibtex_file.read()
+        bib_r = re.compile(r"@.*{.*,", re.M)
+        if len(re.findall(bib_r, contents)) == 0:
+            load_operation.review_manager.logger.error(
+                f"Not a bib file? {source.filename.name}"
+            )
+            raise colrev_exceptions.UnsupportedImportFormatError(source.filename)
+
     # Errors to fix before pybtex loading:
     # - set_incremental_ids (otherwise, not all records will be loaded)
     # - fix_keys (keys containing white spaces)
     record_ids: typing.List[str] = []
-    with open(filename, "r+b") as file:
+    with open(source.filename, "r+b") as file:
         seekpos = file.tell()
         line = file.readline()
         while line:
             if b"@" in line[:3]:
                 current_id = line[line.find(b"{") + 1 : line.rfind(b",")]
                 current_id_str = current_id.decode("utf-8").lstrip().rstrip()
 
+                if any(x in current_id_str for x in [";"]):
+                    replacement_line = re.sub(
+                        r";",
+                        r"_",
+                        line.decode("utf-8"),
+                    ).encode("utf-8")
+                    seekpos = fix_key(file, line, replacement_line, seekpos)
+
                 if current_id_str in record_ids:
                     next_id = (
                         load_operation.review_manager.dataset.generate_next_unique_id(
                             temp_id=current_id_str, existing_ids=record_ids
                         )
                     )
                     load_operation.review_manager.logger.info(
@@ -67,110 +110,100 @@
             # Fix keys
             if re.match(r"^\s*[a-zA-Z0-9]+\s+[a-zA-Z0-9]+\s*\=", line.decode("utf-8")):
                 replacement_line = re.sub(
                     r"(^\s*)([a-zA-Z0-9]+)\s+([a-zA-Z0-9]+)(\s*\=)",
                     r"\1\2_\3\4",
                     line.decode("utf-8"),
                 ).encode("utf-8")
-                load_operation.review_manager.logger.info(
-                    f"Fix invalid key: \n{line.decode('utf-8')}"
-                    f"{replacement_line.decode('utf-8')}"
-                )
-                line = file.readline()
-                remaining = line + file.read()
-                file.seek(seekpos)
-                file.write(replacement_line)
-                seekpos = file.tell()
-                file.flush()
-                os.fsync(file)
-                file.write(remaining)
-                file.truncate()  # if the replacement is shorter...
-                file.seek(seekpos)
+                seekpos = fix_key(file, line, replacement_line, seekpos)
 
             seekpos = file.tell()
             line = file.readline()
 
 
 def load_bib_file(
-    load_operation: colrev.ops.load.Load, source: colrev.settings.SearchSource
+    load_operation: colrev.ops.load.Load,
+    source: colrev.settings.SearchSource,
+    check_bib_file: bool = True,
 ) -> dict:
     """Load a bib file and return records dict"""
 
     def drop_empty_fields(*, records: dict) -> None:
         for record_id in records:
             records[record_id] = {
                 k: v for k, v in records[record_id].items() if v is not None
             }
             records[record_id] = {
                 k: v for k, v in records[record_id].items() if v != "nan"
             }
 
     def check_nr_in_bib(*, source: colrev.settings.SearchSource, records: dict) -> None:
+        load_operation.review_manager.logger.debug(
+            f"Loaded {source.filename.name} with {len(records)} records"
+        )
         nr_in_bib = load_operation.review_manager.dataset.get_nr_in_bib(
-            file_path=source.get_corresponding_bib_file()
+            file_path=source.filename
         )
         if len(records) < nr_in_bib:
             load_operation.review_manager.logger.error(
                 "broken bib file (not imported all records)"
             )
-            with open(source.get_corresponding_bib_file(), encoding="utf8") as file:
+            with open(source.filename, encoding="utf8") as file:
                 line = file.readline()
                 while line:
                     if "@" in line[:3]:
                         record_id = line[line.find("{") + 1 : line.rfind(",")]
                         if record_id not in [x["ID"] for x in records]:
                             load_operation.review_manager.logger.error(
                                 f"{record_id} not imported"
                             )
                     line = file.readline()
 
-    def check_bib_file(*, source: colrev.settings.SearchSource, records: dict) -> None:
+    def __check_bib_file(
+        *, source: colrev.settings.SearchSource, records: dict
+    ) -> None:
         if len(records.items()) <= 3:
             return
-        if not any("author" in r for ID, r in records.items()):
+        if not any("author" in r for r in records.values()):
             raise colrev_exceptions.ImportException(
                 f"Import failed (no record with author field): {source.filename.name}"
             )
 
         if not any("title" in r for ID, r in records.items()):
             raise colrev_exceptions.ImportException(
                 f"Import failed (no record with title field): {source.filename.name}"
             )
 
-    if not source.filename.is_file():
-        load_operation.review_manager.logger.debug(
-            f"Did not find bib file {source.get_corresponding_bib_file().name} "
-        )
-        return {}
-
-    with open(source.filename, encoding="utf8") as bibtex_file:
-        contents = bibtex_file.read()
-        bib_r = re.compile(r"@.*{.*,", re.M)
-        if len(re.findall(bib_r, contents)) == 0:
-            load_operation.review_manager.logger.error(
-                f"Not a bib file? {source.filename.name}"
-            )
+    def __load_records(*, source: colrev.settings.SearchSource) -> dict:
+        if not source.filename.is_file():
             return {}
+        with open(source.filename, encoding="utf8") as bibtex_file:
+            records = load_operation.review_manager.dataset.load_records_dict(
+                load_str=bibtex_file.read()
+            )
 
-    __apply_file_fixes(load_operation=load_operation, filename=source.filename)
+            if len(records) == 0:
+                load_operation.review_manager.report_logger.debug("No records loaded")
+                load_operation.review_manager.logger.debug("No records loaded")
+            return records
+
+    def lower_case_keys(*, records: dict) -> None:
+        for record in records.values():
+            for key in list(record.keys()):
+                if key in ["ID", "ENTRYTYPE"]:
+                    continue
+                if not key.islower():
+                    record[key.lower()] = record.pop(key)
 
-    with open(source.filename, encoding="utf8") as bibtex_file:
-        records = load_operation.review_manager.dataset.load_records_dict(
-            load_str=bibtex_file.read()
-        )
+    __apply_file_fixes(load_operation=load_operation, source=source)
 
+    records = __load_records(source=source)
     if len(records) == 0:
-        load_operation.review_manager.report_logger.debug("No records loaded")
-        load_operation.review_manager.logger.debug("No records loaded")
         return records
 
+    lower_case_keys(records=records)
     drop_empty_fields(records=records)
     records = dict(sorted(records.items()))
-
-    load_operation.review_manager.logger.debug(
-        f"Loaded {source.get_corresponding_bib_file().name} "
-        f"with {len(records)} records"
-    )
-
     check_nr_in_bib(source=source, records=records)
-    check_bib_file(source=source, records=records)
+    if check_bib_file:
+        __check_bib_file(source=source, records=records)
     return records
```

### Comparing `colrev-0.9.2/colrev/ops/load_utils_md.py` & `colrev-0.9.3/colrev/ops/load_utils_md.py`

 * *Files 8% similar despite different names*

```diff
@@ -27,14 +27,15 @@
         source: colrev.settings.SearchSource,
     ):
         self.source = source
         self.load_operation = load_operation
 
     def load(self) -> dict:
         """Load records from the source"""
+        self.load_operation.ensure_append_only(file=self.source.filename)
 
         self.load_operation.review_manager.logger.info(
             "Running GROBID to parse structured reference data"
         )
 
         grobid_service = self.load_operation.review_manager.get_grobid_service()
 
@@ -59,9 +60,12 @@
             )
             ind += 1
             data = data + "\n" + ret.text.replace("{-1,", "{" + str(ind) + ",")
 
         records = self.load_operation.review_manager.dataset.load_records_dict(
             load_str=data
         )
+        for record in records.values():
+            if record.get("year", "a") == record.get("date", "b"):
+                del record["date"]
 
         return records
```

### Comparing `colrev-0.9.2/colrev/ops/load_utils_ris.py` & `colrev-0.9.3/colrev/ops/load_utils_ris.py`

 * *Files 3% similar despite different names*

```diff
@@ -1,19 +1,24 @@
 #! /usr/bin/env python
 """Convenience functions to load ris files (based on rispy)"""
 from __future__ import annotations
 
 import re
 from pathlib import Path
+from typing import TYPE_CHECKING
 
 import rispy
 from rispy import BaseParser
 from rispy.config import LIST_TYPE_TAGS
 from rispy.config import TAG_KEY_MAPPING
 
+if TYPE_CHECKING:
+    import colrev.ops.load
+
+
 # Based on https://github.com/aurimasv/translators/wiki/RIS-Tag-Map
 REFERENCE_TYPES = {
     "JOUR": "article",
     "JFULL": "article",
     "ABST": "article",
     "INPR": "article",  # inpress
     "CONF": "inproceedings",
@@ -101,110 +106,123 @@
         return line[line.find(" - ") + 2 :].strip()
 
     def is_header(self, line: str) -> bool:
         "Check whether the line is a header element"
         return not re.match("[A-Z0-9]+  - ", line)
 
 
-def apply_ris_fixes(*, filename: Path) -> None:
-    """Fix common defects in RIS files"""
+class RISLoader:
 
-    # Error to fix: for lists of keywords, each line should start with the KW tag
+    """Loads ris files"""
 
-    with open(filename, encoding="UTF-8") as file:
-        lines = [line.rstrip("\n") for line in file]
-        for i, line in enumerate(lines):
-            if line.startswith("PMID "):
-                lines[i] = line.replace("PMID ", "PM ")
-
-        # add missing start tags in lists (like KW)
-        processing_tag = ""
-        for i, line in enumerate(lines):
-            tag_match = re.match(r"^[A-Z][A-Z0-9]+(\s+)-", line)  # |^ER\s?|^EF\s?
-            if tag_match:
-                processing_tag = tag_match.group()
-            elif line == "":
-                processing_tag = ""
-                continue
-            elif processing_tag == "":
-                continue
-            else:
-                lines[i] = f"{processing_tag} {line}"
+    def __init__(
+        self,
+        *,
+        load_operation: colrev.ops.load.Load,
+        source: colrev.settings.SearchSource,
+    ):
+        self.load_operation = load_operation
+        self.source = source
+
+    def apply_ris_fixes(self, *, filename: Path) -> None:
+        """Fix common defects in RIS files"""
+
+        # Error to fix: for lists of keywords, each line should start with the KW tag
+
+        with open(filename, encoding="UTF-8") as file:
+            lines = [line.rstrip("\n") for line in file]
+            for i, line in enumerate(lines):
+                if line.startswith("PMID "):
+                    lines[i] = line.replace("PMID ", "PM ")
+
+            # add missing start tags in lists (like KW)
+            processing_tag = ""
+            for i, line in enumerate(lines):
+                tag_match = re.match(r"^[A-Z][A-Z0-9]+(\s+)-", line)  # |^ER\s?|^EF\s?
+                if tag_match:
+                    processing_tag = tag_match.group()
+                elif line == "":
+                    processing_tag = ""
+                    continue
+                elif processing_tag == "":
+                    continue
+                else:
+                    lines[i] = f"{processing_tag} {line}"
+
+        with open(filename, "w", encoding="utf-8") as file:
+            for line in lines:
+                file.write(f"{line}\n")
+
+    def load_ris_entries(
+        self, *, filename: Path, ris_parser: BaseParser = DefaultRISParser
+    ) -> dict:
+        """Load ris entries
+
+        The resulting keys should coincide with those in the KEY_MAP
+        but they can be adapted before calling the convert_to_records()"""
+
+        # Note : depending on the source, a specific ris_parser implementation may be selected.
+        # its DEFAULT_LIST_TAGS can be extended with list fiels that should be joined automatically
+
+        self.load_operation.ensure_append_only(file=self.source.filename)
+
+        with open(filename, encoding="utf-8") as ris_file:
+            entries = rispy.load(file=ris_file, implementation=ris_parser)
 
-    with open(filename, "w", encoding="utf-8") as file:
-        for line in lines:
-            file.write(f"{line}\n")
-
-
-def load_ris_entries(
-    *, filename: Path, ris_parser: BaseParser = DefaultRISParser
-) -> dict:
-    """Load ris entries
-
-    The resulting keys should coincide with those in the KEY_MAP
-    but they can be adapted before calling the convert_to_records()"""
-
-    # Note : depending on the source, a specific ris_parser implementation may be selected.
-    # its DEFAULT_LIST_TAGS can be extended with list fiels that should be joined automatically
-
-    with open(filename, encoding="utf-8") as ris_file:
-        entries = rispy.load(file=ris_file, implementation=ris_parser)
-
-    for entry in entries:
-        if "pages" in entry:
-            continue
-        if "start_page" in entry and "end_page" in entry:
-            entry["pages"] = f"{entry.pop('start_page')}--{entry.pop('end_page')}"
-        elif "start_page" in entry:
-            entry["pages"] = f"{entry.pop('start_page')}"
-
-        for key in [
-            ris_parser.DEFAULT_MAPPING[k] for k in ris_parser.DEFAULT_LIST_TAGS
-        ]:
-            if key not in entry:
+        for entry in entries:
+            if "pages" in entry:
                 continue
-            if "author" in key:
-                entry[key] = " and ".join(entry[key])
-            elif "url" == key:
-                urls = entry["url"]
-                for url in urls:
-                    if url.endswith(".pdf"):
-                        entry["fulltext"] = url
-                    else:
-                        entry["url"] = url
-                        break
-            else:
-                entry[key] = ", ".join(entry[key])
-
-    return entries
-
-
-def convert_to_records(entries: dict) -> dict:
-    """Converts ris entries it to bib records"""
-
-    # Note : REFERENCE_TYPES and KEY_MAP are hard-coded (standard)
-    # This function intentionally fails when the input does not comply
-    # with this standard
-
-    records: dict = {}
-    for counter, entry in enumerate(entries):
-        _id = str(counter + 1).zfill(5)
-
-        type_of_ref = entry["type_of_reference"]
-        if type_of_ref not in REFERENCE_TYPES:
-            raise NotImplementedError(f"Undefined reference type: {type_of_ref}")
-
-        entry_type = REFERENCE_TYPES[type_of_ref]
-        entry["ID"] = _id
-        entry["ENTRYTYPE"] = entry_type
-
-        if entry_type not in KEY_MAP:
-            raise NotImplementedError(f"No KEY_MAP defined for {entry_type}")
-
-        record: dict = {}
-        for ris_key, key in KEY_MAP[entry_type].items():
-            if ris_key in entry:
-                record[key] = entry[ris_key]
+            if "start_page" in entry and "end_page" in entry:
+                entry["pages"] = f"{entry.pop('start_page')}--{entry.pop('end_page')}"
+            elif "start_page" in entry:
+                entry["pages"] = f"{entry.pop('start_page')}"
+
+            for key in [
+                ris_parser.DEFAULT_MAPPING[k] for k in ris_parser.DEFAULT_LIST_TAGS
+            ]:
+                if key not in entry:
+                    continue
+                if "author" in key:
+                    entry[key] = " and ".join(entry[key])
+                elif "url" == key:
+                    urls = entry["url"]
+                    for url in urls:
+                        if url.endswith(".pdf"):
+                            entry["fulltext"] = url
+                        else:
+                            entry["url"] = url
+                            break
+                else:
+                    entry[key] = ", ".join(entry[key])
+
+        return entries
+
+    def convert_to_records(self, *, entries: dict) -> dict:
+        """Converts ris entries it to bib records"""
+
+        # Note : REFERENCE_TYPES and KEY_MAP are hard-coded (standard)
+        # This function intentionally fails when the input does not comply
+        # with this standard
+
+        records: dict = {}
+        for counter, entry in enumerate(entries):
+            _id = str(counter + 1).zfill(5)
+
+            type_of_ref = entry["type_of_reference"]
+            if type_of_ref not in REFERENCE_TYPES:
+                raise NotImplementedError(f"Undefined reference type: {type_of_ref}")
+
+            entry_type = REFERENCE_TYPES[type_of_ref]
+            entry["ID"] = _id
+            entry["ENTRYTYPE"] = entry_type
+
+            if entry_type not in KEY_MAP:
+                raise NotImplementedError(f"No KEY_MAP defined for {entry_type}")
+
+            record: dict = {}
+            for ris_key, key in KEY_MAP[entry_type].items():
+                if ris_key in entry:
+                    record[key] = entry[ris_key]
 
-        records[_id] = record
+            records[_id] = record
 
-    return records
+        return records
```

### Comparing `colrev-0.9.2/colrev/ops/load_utils_table.py` & `colrev-0.9.3/colrev/ops/load_utils_table.py`

 * *Files 13% similar despite different names*

```diff
@@ -144,60 +144,70 @@
 
     """Loads csv files (based on pandas)"""
 
     def __init__(
         self,
         *,
         load_operation: colrev.ops.load.Load,
-        settings: colrev.settings.SearchSource,
+        source: colrev.settings.SearchSource,
     ):
         self.load_operation = load_operation
-        self.settings = settings
+        self.source = source
 
     def load(self) -> dict:
         """Load records from the source"""
 
+        self.load_operation.ensure_append_only(file=self.source.filename)
+
         try:
-            data = pd.read_csv(self.settings.filename)
+            data = pd.read_csv(self.source.filename)
         except pd.errors.ParserError as exc:
             raise colrev_exceptions.ImportException(
-                f"Error: Not a csv file? {self.settings.filename.name}"
+                f"Error: Not a csv file? {self.source.filename.name}"
             ) from exc
 
         data.columns = data.columns.str.replace(" ", "_")
         data.columns = data.columns.str.replace("-", "_")
         data.columns = data.columns.str.lower()
         records_value_list = data.to_dict("records")
 
         records_dict = TableLoadUtility.preprocess_records(records=records_value_list)
 
         if not all("ID" in r for r in records_dict.values()):
             for i, record in enumerate(records_dict.values()):
                 record["ID"] = str(i).rjust(6, "0")
 
         records = {r["ID"]: r for r in records_dict.values()}
+        for record_id, record in records.items():
+            if "author" in record and ";" in record["author"]:
+                record["author"] = record["author"].replace("; ", " and ")
+            records[record_id] = {
+                k: v for k, v in record.items() if v not in ["", "nan"]
+            }
 
         return records
 
 
 class ExcelLoader:
     """Loads Excel (xls, xlsx) files (based on pandas)"""
 
     def __init__(
         self,
         *,
         load_operation: colrev.ops.load.Load,
         source: colrev.settings.SearchSource,
     ):
-        self.source = source
         self.load_operation = load_operation
+        self.source = source
 
     def load(self) -> dict:
         """Load records from the source"""
 
+        self.load_operation.ensure_append_only(file=self.source.filename)
+
         try:
             data = pd.read_excel(
                 self.source.filename, dtype=str
             )  # dtype=str to avoid type casting
         except pd.errors.ParserError:
             self.load_operation.review_manager.logger.error(
                 f"Error: Not an xlsx file: {self.source.filename.name}"
@@ -205,10 +215,16 @@
             return {}
 
         data.columns = data.columns.str.replace(" ", "_")
         data.columns = data.columns.str.replace("-", "_")
         data.columns = data.columns.str.lower()
         record_value_list = data.to_dict("records")
         records_dicts = TableLoadUtility.preprocess_records(records=record_value_list)
-        records = {r["ID"]: r for r in records_dicts}
+        records = {r["ID"]: r for r in records_dicts.values()}
+        for record_id, record in records.items():
+            if "author" in record and ";" in record["author"]:
+                record["author"] = record["author"].replace("; ", " and ")
+            records[record_id] = {
+                k: v for k, v in record.items() if v not in ["", "nan"]
+            }
 
         return records
```

### Comparing `colrev-0.9.2/colrev/ops/merge.py` & `colrev-0.9.3/colrev/ops/merge.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/pages/home.py` & `colrev-0.9.3/colrev/ops/pages/home.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/pages/synthesizedrecords.py` & `colrev-0.9.3/colrev/ops/pages/synthesizedrecords.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/pdf_get.py` & `colrev-0.9.3/colrev/ops/pdf_get.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/pdf_get_man.py` & `colrev-0.9.3/colrev/ops/pdf_get_man.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/pdf_prep.py` & `colrev-0.9.3/colrev/ops/pdf_prep.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/pdf_prep_man.py` & `colrev-0.9.3/colrev/ops/pdf_prep_man.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/prep.py` & `colrev-0.9.3/colrev/ops/prep.py`

 * *Files 8% similar despite different names*

```diff
@@ -7,14 +7,15 @@
 import multiprocessing as mp
 import random
 import time
 import typing
 from copy import deepcopy
 from datetime import datetime
 from datetime import timedelta
+from multiprocessing import Lock
 from multiprocessing import Value
 from multiprocessing.pool import ThreadPool as Pool
 from pathlib import Path
 from typing import Optional
 
 from requests.exceptions import ConnectionError as requests_ConnectionError
 from requests.exceptions import ReadTimeout
@@ -85,24 +86,24 @@
         "editor",
         "book-group-author",
         "book-author",
         "keywords",
         "file",
         "fulltext",
         "publisher",
-        "dblp_key",
-        "sem_scholar_id",
+        "colrev.dblp.dblp_key",
+        "colrev.semantic_scholar.id",
+        "colrev.web_of_science.unique-id",
         "url",
         "isbn",
         "address",
         "edition",
         "warning",
         "crossref",
         "date",
-        "wos_accession_number",
         "link",
         "url",
         "crossmark",
         "warning",
         "note",
         "issn",
         "language",
@@ -134,14 +135,18 @@
         self.quality_model = review_manager.get_qm()
 
         self.polish = False
         self.debug_mode = False
         self.pad = 0
         self.__stats: typing.Dict[str, typing.List[timedelta]] = {}
 
+        self.temp_prep_lock = Lock()
+        self.current_temp_records = Path(".colrev/cur_temp_recs.bib")
+        self.temp_records = Path(".colrev/temp_recs.bib")
+
     def __add_stats(
         self, *, prep_round_package_endpoint: dict, start_time: datetime
     ) -> None:
         if prep_round_package_endpoint["endpoint"] not in self.__stats:
             self.__stats[prep_round_package_endpoint["endpoint"]] = [
                 datetime.now() - start_time
             ]
@@ -452,50 +457,127 @@
                 record.set_status(target_state=prior_state, force=True)
 
         if not self.review_manager.verbose_mode:
             self.__print_post_package_prep_info(
                 record=record, item=item, prior_state=prior_state
             )
 
+    def __save_to_temp(self, *, record: colrev.record.Record) -> None:
+        rec_str = self.review_manager.dataset.parse_bibtex_str(
+            recs_dict_in={record.data["ID"]: record.get_data()}
+        )
+        self.temp_prep_lock.acquire(timeout=120)
+        self.current_temp_records.parent.mkdir(exist_ok=True)
+        with open(self.current_temp_records, "a", encoding="utf-8") as cur_temp_rec:
+            cur_temp_rec.write(rec_str)
+        try:
+            self.temp_prep_lock.release()
+        except ValueError:
+            pass
+
+    def __complete_resumed_operation(self, *, prepared_records: list) -> None:
+        if self.temp_records.is_file():
+            temp_recs = self.review_manager.dataset.load_records_dict(
+                file_path=self.temp_records
+            )
+            prepared_records_ids = [x["ID"] for x in prepared_records]
+            for record in temp_recs.values():
+                if record["ID"] not in prepared_records_ids:
+                    prepared_records.append(record)
+
+        self.temp_records.unlink(missing_ok=True)
+        self.current_temp_records.unlink(missing_ok=True)
+
+    def __validate_record(
+        self, *, record: colrev.record.Record, prep_round_package_endpoint: str
+    ) -> None:
+        if "colrev_status" not in record.data:
+            print(record.data)
+            raise ValueError(
+                f"Record {record.data['ID']} has no colrev_status"
+                f" after {prep_round_package_endpoint}"
+            )
+        if not self.polish and record.data["colrev_status"] not in [
+            colrev.record.RecordState.md_imported,
+            colrev.record.RecordState.md_prepared,
+            colrev.record.RecordState.md_needs_manual_preparation,
+            colrev.record.RecordState.rev_prescreen_excluded,
+        ]:
+            print(record.data)
+            raise ValueError(
+                f"Record {record.data['ID']} has invalid status {record.data['colrev_status']}"
+                f" after {prep_round_package_endpoint}"
+            )
+        if "colrev_masterdata_provenance" not in record.data:
+            raise ValueError(
+                f"Record {record.data['ID']} has no colrev_masterdata_provenance"
+                f" after {prep_round_package_endpoint}"
+            )
+        if "ID" not in record.data:
+            raise ValueError(
+                f"Record {record.data['ID']} has no ID"
+                f" after {prep_round_package_endpoint}"
+            )
+        if "ENTRYTYPE" not in record.data:
+            raise ValueError(
+                f"Record {record.data['ID']} has no ENTRYTYPE"
+                f" after {prep_round_package_endpoint}"
+            )
+
     # Note : no named arguments for multiprocessing
     def prepare(self, item: dict) -> dict:
         """Prepare a record (based on package_endpoints in the settings)"""
 
+        # https://docs.python.org/3/library/concurrent.futures.html
+        # #concurrent.futures.Executor.map
+        # Exceptions are raised at the end/when results are retrieved from the iterator
+
         record: colrev.record.PrepRecord = item["record"]
 
         if not record.status_to_prepare() and not self.polish:
             return record.get_data()
 
         if self.review_manager.verbose_mode:
             self.review_manager.logger.info(" prep " + record.data["ID"])
 
+        if "colrev_data_provenance" not in record.data:
+            record.data["colrev_data_provenance"] = {}
+        if "colrev_masterdata_provenance" not in record.data:
+            record.data["colrev_masterdata_provenance"] = {}
+
         # preparation_record changes with each endpoint and
         # eventually replaces record (if md_prepared or endpoint.always_apply_changes)
         preparation_record = record.copy_prep_rec()
         prior_state = record.data["colrev_status"]
 
         for prep_round_package_endpoint in deepcopy(
             item["prep_round_package_endpoints"]
         ):
             try:
                 self.__package_prep(
                     prep_round_package_endpoint,
                     record,
                     preparation_record,
                 )
+                self.__validate_record(
+                    record=record,
+                    prep_round_package_endpoint=prep_round_package_endpoint,
+                )
             except colrev_exceptions.PreparationBreak:
                 break
 
         self.__post_package_prep(
             record=record,
             preparation_record=preparation_record,
             item=item,
             prior_state=prior_state,
         )
 
+        self.__save_to_temp(record=record)
+
         return record.get_data()
 
     def __select_record_list_for_reset(self, *, record_list: list[dict]) -> list[dict]:
         record_list = [
             rec
             for rec in record_list
             if str(rec["colrev_status"])
@@ -750,29 +832,70 @@
             prepare_data = self.__load_prep_data_for_debug(
                 debug_ids=debug_ids, debug_file=debug_file
             )
             if prepare_data["nr_tasks"] == 0:
                 print("ID not found in history.")
         else:
             prepare_data = self.__load_prep_data(polish=polish)
+        nr_items = len(prepare_data["items"])
+
+        if self.current_temp_records.is_file():
+            # combine and remove redundant records
+            cur_temp_recs = self.review_manager.dataset.load_records_dict(
+                file_path=self.current_temp_records
+            )
+            temp_recs = {}
+            if self.temp_records.is_file():
+                temp_recs = self.review_manager.dataset.load_records_dict(
+                    file_path=self.temp_records
+                )
+
+            combined_recs = {**temp_recs, **cur_temp_recs}
+            self.temp_records.parent.mkdir(exist_ok=True)
+            self.review_manager.dataset.save_records_dict_to_file(
+                records=combined_recs, save_path=self.temp_records
+            )
+            self.current_temp_records.unlink()
+
+        if self.temp_records.is_file():
+            temp_recs = self.review_manager.dataset.load_records_dict(
+                file_path=self.temp_records
+            )
+            self.review_manager.logger.info("Continue with existing records")
+            skipped_items = 0
+            list_to_skip = []
+            for item in prepare_data["items"]:
+                if item["ID"] not in temp_recs:
+                    continue
+                del temp_recs[item["ID"]]
+                list_to_skip.append(item["ID"])
+                skipped_items += 1
+            self.review_manager.logger.info(
+                f"{colors.GREEN}Skipped {skipped_items} records{colors.END}"
+            )
+            prepare_data["items"] = [
+                x for x in prepare_data["items"] if x["ID"] not in list_to_skip
+            ]
+
+            with PREP_COUNTER.get_lock():
+                PREP_COUNTER.value += skipped_items  # type: ignore
 
         if self.debug_mode:
             self.review_manager.logger.info(
                 "In this round, we set the similarity "
                 f"threshold ({self.retrieval_similarity})"
             )
             input("Press Enter to continue")
             self.review_manager.logger.info(
                 f"prepare_data: "
                 f"{self.review_manager.p_printer.pformat(prepare_data)}"
             )
         self.pad = prepare_data["PAD"]
         items = prepare_data["items"]
         prep_data = []
-        nr_items = len(items)
         for item in items:
             prep_data.append(
                 {
                     "record": colrev.record.PrepRecord(data=item),
                     "nr_items": nr_items,
                     # Note : we cannot load endpoints here
                     # because pathos/multiprocessing
@@ -860,17 +983,18 @@
                 "items": records,
             }
         return prep_data
 
     def __setup_prep_round(
         self, *, i: int, prep_round: colrev.settings.PrepRound
     ) -> None:
-        # pylint: disable=redefined-outer-name,invalid-name
-        PREP_COUNTER = Value("i", 0)
+        # pylint: disable=redefined-outer-name,invalid-name,global-statement
+        global PREP_COUNTER
         with PREP_COUNTER.get_lock():
+            PREP_COUNTER = Value("i", 0)
             PREP_COUNTER.value = 0  # type: ignore
 
         self.first_round = bool(i == 0)
 
         self.last_round = bool(
             i == len(self.review_manager.settings.prep.prep_rounds) - 1
         )
@@ -949,65 +1073,66 @@
                 )
 
     def __log_details(self, *, prepared_records: list) -> None:
         nr_recs = len(
             [
                 record
                 for record in prepared_records
-                if "CURATED" in record["colrev_masterdata_provenance"]
+                if "CURATED" in record.get("colrev_masterdata_provenance", "")
             ]
         )
 
         self.review_manager.logger.info(
-            "Overall curated ()".ljust(29)
+            "curated ()".ljust(29)
             + f"{colors.GREEN}{nr_recs}{colors.END}".rjust(20, " ")
             + " records"
         )
 
         nr_recs = len(
             [
                 record
                 for record in prepared_records
                 if record["colrev_status"] == colrev.record.RecordState.md_prepared
             ]
         )
 
         self.review_manager.logger.info(
-            "Overall md_prepared".ljust(29)
+            "md_prepared".ljust(29)
             + f"{colors.GREEN}{nr_recs}{colors.END}".rjust(20, " ")
             + " records"
         )
 
         nr_recs = len(
             [
                 record
                 for record in prepared_records
                 if record["colrev_status"]
                 == colrev.record.RecordState.md_needs_manual_preparation
             ]
         )
         if nr_recs > 0:
             self.review_manager.logger.info(
-                "To prepare manually".ljust(29)
+                "md_needs_manual_preparation".ljust(29)
                 + f"{colors.ORANGE}{nr_recs}{colors.END}".rjust(20, " ")
-                + " records"
+                + f" records ({nr_recs/len(prepared_records):.2%})"
             )
 
         nr_recs = len(
             [
                 record
                 for record in prepared_records
                 if record["colrev_status"]
                 == colrev.record.RecordState.rev_prescreen_excluded
             ]
         )
         if nr_recs > 0:
             self.review_manager.logger.info(
-                "Records prescreen-excluded".ljust(29)
+                "rev_prescreen_excluded".ljust(29)
                 + f"{colors.RED}{nr_recs}{colors.END}".rjust(20, " ")
+                + " records"
             )
 
     def skip_prep(self) -> None:
         """Skip the preparation"""
 
         records = self.review_manager.dataset.load_records_dict()
 
@@ -1153,15 +1278,15 @@
                     prep_round=prep_round,
                     debug_file=debug_file,
                     debug_ids=debug_ids,
                     polish=polish,
                 )
                 previous_preparation_data = deepcopy(preparation_data)
 
-                if len(preparation_data) == 0:
+                if len(preparation_data) == 0 and not self.temp_records.is_file():
                     self.review_manager.logger.info("No records to prepare.")
                     print()
                     return
 
                 if self.__cpu == 1:
                     # Note: preparation_data is not turned into a list of records.
                     prepared_records = []
@@ -1170,14 +1295,16 @@
                         prepared_records.append(record)
                 else:
                     pool = self.__get_prep_pool(prep_round=prep_round)
                     prepared_records = pool.map(self.prepare, preparation_data)
                     pool.close()
                     pool.join()
 
+                self.__complete_resumed_operation(prepared_records=prepared_records)
+
                 self.__create_prep_commit(
                     previous_preparation_data=previous_preparation_data,
                     prepared_records=prepared_records,
                     prep_round=prep_round,
                 )
 
         except requests_ConnectionError as exc:
```

### Comparing `colrev-0.9.2/colrev/ops/prep_man.py` & `colrev-0.9.3/colrev/ops/prep_man.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/prescreen.py` & `colrev-0.9.3/colrev/ops/prescreen.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/pull.py` & `colrev-0.9.3/colrev/ops/pull.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/push.py` & `colrev-0.9.3/colrev/ops/push.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/remove.py` & `colrev-0.9.3/colrev/ops/remove.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/repare.py` & `colrev-0.9.3/colrev/ops/repare.py`

 * *Files 3% similar despite different names*

```diff
@@ -28,15 +28,17 @@
         super().__init__(
             review_manager=review_manager,
             operations_type=colrev.operation.OperationsType.check,
             notify_state_transition_operation=False,
         )
         # fix file no longer available
         self.local_index = self.review_manager.get_local_index()
-        self.pdf_get_operation = self.review_manager.get_pdf_get_operation()
+        self.pdf_get_operation = self.review_manager.get_pdf_get_operation(
+            notify_state_transition_operation=False
+        )
 
     def __fix_broken_symlink_based_on_local_index(
         self, *, record: colrev.record.Record, full_path: Path
     ) -> None:
         """Fix broken symlinks based on local_index"""
 
         if os.path.islink(full_path) and not os.path.exists(full_path):
@@ -122,15 +124,15 @@
                 target_state=colrev.record.RecordState.rev_prescreen_included
             )
 
     def __get_source_feeds(self) -> dict:
         source_feeds = {}
         for source in self.review_manager.settings.sources:
             source_feeds[
-                str(source.get_corresponding_bib_file()).replace("data/search/", "")
+                str(source.filename).replace("data/search/", "")
             ] = source.get_feed(
                 review_manager=self.review_manager,
                 source_identifier="NA",
                 update_only=False,
             ).feed_records
         return source_feeds
 
@@ -139,32 +141,34 @@
             record.data["colrev_pdf_id"] = record.data["pdf_hash"]
             del record.data["pdf_hash"]
         if "pdf_prep_hints" in record.data:
             del record.data["pdf_prep_hints"]
         if "grobid-version" in record.data:
             del record.data["grobid-version"]
 
-        mk_to_remove = []
-        for key in record.data["colrev_data_provenance"]:
-            if key not in record.data:
-                mk_to_remove += [key]
-        for key in mk_to_remove:
-            del record.data["colrev_data_provenance"][key]
+        if "colrev_data_provenance" in record.data:
+            mk_to_remove = []
+            for key in record.data["colrev_data_provenance"]:
+                if key not in record.data:
+                    mk_to_remove += [key]
+            for key in mk_to_remove:
+                del record.data["colrev_data_provenance"][key]
 
-        mdk_to_remove = []
-        for key in record.data["colrev_masterdata_provenance"]:
-            if (
-                key not in record.data
-                and "CURATED" != key
-                and "not-missing"
-                not in record.data["colrev_masterdata_provenance"][key]["note"]
-            ):
-                mdk_to_remove += [key]
-        for key in mdk_to_remove:
-            del record.data["colrev_masterdata_provenance"][key]
+        if "colrev_masterdata_provenance" in record.data:
+            mdk_to_remove = []
+            for key in record.data["colrev_masterdata_provenance"]:
+                if (
+                    key not in record.data
+                    and "CURATED" != key
+                    and "not-missing"
+                    not in record.data["colrev_masterdata_provenance"][key]["note"]
+                ):
+                    mdk_to_remove += [key]
+            for key in mdk_to_remove:
+                del record.data["colrev_masterdata_provenance"][key]
 
         if self.review_manager.settings.is_curated_masterdata_repo():
             if "CURATED" in record.data["colrev_masterdata_provenance"]:
                 del record.data["colrev_masterdata_provenance"]["CURATED"]
 
     def __set_data_provenance_field(
         self, *, record: colrev.record.Record, key: str, source_feeds: dict
@@ -173,15 +177,16 @@
             if not any(
                 record.data["colrev_data_provenance"][key]["source"].startswith(sf)
                 for sf in list(source_feeds.keys())
             ):
                 del record.data["colrev_data_provenance"][key]
         if key not in record.data["colrev_data_provenance"]:
             for origin in record.data["colrev_origin"]:
-                origin_source, origin_id = origin.split("/")
+                origin_source = origin.split("/")[0]
+                origin_id = origin[len(origin_source) + 1 :]
                 if key in source_feeds[origin_source][origin_id]:
                     record.add_data_provenance(key=key, source=origin, note="")
         if key == "language":
             record.add_data_provenance(key=key, source="LanguageDetector", note="")
         if key == "tei_file":
             record.add_data_provenance(key=key, source="file|grobid", note="")
         if key == "colrev_pdf_id":
@@ -197,15 +202,16 @@
             prov_details["source"] = record.data["colrev_origin"][0]
 
     def __add_missing_masterdata_provenance(
         self, *, record: colrev.record.Record, key: str, value: str, source_feeds: dict
     ) -> None:
         options = {}
         for origin in record.data["colrev_origin"]:
-            origin_source, origin_id = origin.split("/")
+            origin_source = origin.split("/")[0]
+            origin_id = origin[len(origin_source) + 1 :]
             if key in source_feeds[origin_source][origin_id]:
                 options[origin_source] = source_feeds[origin_source][origin_id][key]
 
         source_value = "manual"
 
         # Note : simple heuristics:
         if value in options.values():
@@ -336,14 +342,37 @@
                         del curation_recs[record_id]
 
             self.review_manager.dataset.save_records_dict_to_file(
                 records=curation_recs, save_path=search_source.filename
             )
             self.review_manager.dataset.add_changes(path=search_source.filename)
 
+    def __update_field_names(self, *, records: dict) -> None:
+        for record_dict in records.values():
+            # TODO : extract to methods and call from upgrade.py
+            # TBD: which parts are in upgrade/repare and which parts are in prepare??
+            record = colrev.record.Record(data=record_dict)
+            if "fulltext" in record_dict.get("link", ""):
+                record.rename_field(key="link", new_key="fulltext")
+            if (
+                record.data.get("note", "").lower().startswith("cited by ")
+                and "cited_by" not in record.data
+            ):
+                record.data["note"] = record.data["note"][9:]
+                record.rename_field(key="note", new_key="cited_by")
+            if (
+                record.data.get("note", "").lower().startswith("cited by ")
+                and "cited_by" in record.data
+            ):
+                record.remove_field(key="note")
+            if record.data.get("link", "").startswith(
+                "https://api.elsevier.com/content/article/"
+            ) and record.data.get("link", "").endswith("Accept=text/xml"):
+                record.remove_field(key="link")
+
     @colrev.operation.Operation.decorate()
     def main(self) -> None:
         """Repare a CoLRev project (main entrypoint)"""
 
         # Try: open settings, except: notify & start repare
 
         # ...
@@ -390,12 +419,14 @@
         #             key="colrev_status_backup"
         #         )
         #     if "colrev_local_index" in record_dict:
         #         colrev.record.Record(data=record_dict).remove_field(
         #             key="colrev_local_index"
         #         )
 
+        self.__update_field_names(records=records)
+
         self.__fix_provenance(records=records)
 
         self.__fix_files(records=records)
 
         self.review_manager.dataset.save_records_dict(records=records)
```

### Comparing `colrev-0.9.2/colrev/ops/review_types.py` & `colrev-0.9.3/colrev/ops/review_types.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/screen.py` & `colrev-0.9.3/colrev/ops/screen.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/search_feed.py` & `colrev-0.9.3/colrev/ops/search_feed.py`

 * *Files 2% similar despite different names*

```diff
@@ -29,15 +29,15 @@
         *,
         review_manager: colrev.review_manager.ReviewManager,
         search_source: colrev.settings.SearchSource,
         source_identifier: str,
         update_only: bool,
     ):
         self.source = search_source
-        self.feed_file = search_source.get_corresponding_bib_file()
+        self.feed_file = search_source.filename
 
         # Note: the source_identifier identifies records in the search feed.
         # This could be a doi or link or database-specific ID (like WOS accession numbers)
         # The source_identifier can be stored in the main records.bib (it does not have to)
         # The record source_identifier (feed-specific) is used in search
         # or other operations (like prep)
         # In search operations, records are added/updated based on available_ids
@@ -101,14 +101,15 @@
         # Feed:
         feed_record_dict = record.data.copy()
         added_new = True
         if feed_record_dict[self.source_identifier] in self.__available_ids:
             added_new = False
         else:
             self.__max_id += 1
+            self.nr_added += 1
 
         if "colrev_data_provenance" in feed_record_dict:
             del feed_record_dict["colrev_data_provenance"]
         if "colrev_masterdata_provenance" in feed_record_dict:
             del feed_record_dict["colrev_masterdata_provenance"]
         if "colrev_status" in feed_record_dict:
             del feed_record_dict["colrev_status"]
@@ -135,35 +136,14 @@
         # Original record
         colrev_origin = f"{self.origin_prefix}/{record.data['ID']}"
         record.data["colrev_origin"] = [colrev_origin]
         record.add_provenance_all(source=colrev_origin)
 
         return added_new
 
-    def print_post_run_search_infos(self, *, records: dict) -> None:
-        """Print the search infos (after running the search)"""
-        if self.nr_added > 0:
-            self.review_manager.logger.info(
-                f"{colors.GREEN}Retrieved {self.nr_added} records{colors.END}"
-            )
-        else:
-            self.review_manager.logger.info(
-                f"{colors.GREEN}No additional records retrieved{colors.END}"
-            )
-
-        if self.nr_changed > 0:
-            self.review_manager.logger.info(
-                f"{colors.GREEN}Updated {self.nr_changed} records{colors.END}"
-            )
-        else:
-            if records:
-                self.review_manager.logger.info(
-                    f"{colors.GREEN}Records (data/records.bib) up-to-date{colors.END}"
-                )
-
     def save_feed_file(self) -> None:
         """Save the feed file"""
 
         search_operation = self.review_manager.get_search_operation()
         if len(self.feed_records) > 0:
             self.feed_file.parents[0].mkdir(parents=True, exist_ok=True)
             self.review_manager.dataset.save_records_dict_to_file(
@@ -393,14 +373,15 @@
 
         if self.__have_changed(
             record_a_orig=main_record_dict, record_b_orig=prev_record_dict_version
         ) or self.__have_changed(  # Note : not (yet) in the main records but changed
             record_a_orig=record_dict, record_b_orig=prev_record_dict_version
         ):
             changed = True
+            self.nr_changed += 1
             if self.__forthcoming_published(
                 record_dict=record_dict, prev_record=prev_record_dict_version
             ):
                 self.review_manager.logger.info(
                     f" {colors.GREEN}forthcoming paper published: "
                     f"{main_record_dict['ID']}{colors.END}"
                 )
@@ -412,7 +393,28 @@
                     f"({similarity_score}) in {main_record_dict['ID']}:{colors.END}"
                 )
                 self.review_manager.p_printer.pprint(
                     [x for x in dict_diff if "change" == x[0]]
                 )
 
         return changed
+
+    def print_post_run_search_infos(self, *, records: dict) -> None:
+        """Print the search infos (after running the search)"""
+        if self.nr_added > 0:
+            self.review_manager.logger.info(
+                f"{colors.GREEN}Retrieved {self.nr_added} records{colors.END}"
+            )
+        else:
+            self.review_manager.logger.info(
+                f"{colors.GREEN}No additional records retrieved{colors.END}"
+            )
+
+        if self.nr_changed > 0:
+            self.review_manager.logger.info(
+                f"{colors.GREEN}Updated {self.nr_changed} records{colors.END}"
+            )
+        else:
+            if records:
+                self.review_manager.logger.info(
+                    f"{colors.GREEN}Records (data/records.bib) up-to-date{colors.END}"
+                )
```

### Comparing `colrev-0.9.2/colrev/ops/search_sources.py` & `colrev-0.9.3/colrev/ops/search_sources.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/status.py` & `colrev-0.9.3/colrev/ops/status.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ops/sync.py` & `colrev-0.9.3/colrev/ops/sync.py`

 * *Files 2% similar despite different names*

```diff
@@ -192,17 +192,17 @@
                     bibtex_str += "\n"
                 first = False
 
                 bibtex_str += f"@{record_dict['ENTRYTYPE']}{{{record_id}"
 
                 field_order = [
                     "doi",
-                    "dblp_key",
-                    "sem_scholar_id",
-                    "wos_accession_number",
+                    "colrev.dblp.dblp_key",
+                    "colrev.semantic_scholar.id",
+                    "colrev.web_of_science.unique-id",
                     "author",
                     "booktitle",
                     "journal",
                     "title",
                     "year",
                     "volume",
                     "number",
```

### Comparing `colrev-0.9.2/colrev/ops/trace.py` & `colrev-0.9.3/colrev/ops/trace.py`

 * *Files 6% similar despite different names*

```diff
@@ -90,15 +90,18 @@
 
         self.review_manager.logger.info(f"Trace record by ID: {record_id}")
 
         revlist = self.review_manager.dataset.get_repo().iter_commits()
 
         prev_record: dict = {}
         for commit in reversed(list(revlist)):
-            filecontents = (commit.tree / "data" / "records.bib").data_stream.read()
+            try:
+                filecontents = (commit.tree / "data" / "records.bib").data_stream.read()
+            except KeyError:
+                continue
 
             commit_message_first_line = str(commit.message).partition("\n")[0]
 
             if self.review_manager.verbose_mode:
                 print(
                     "\n\n"
                     + time.strftime(
```

### Comparing `colrev-0.9.2/colrev/ops/upgrade.py` & `colrev-0.9.3/colrev/ops/upgrade.py`

 * *Files 11% similar despite different names*

```diff
@@ -129,14 +129,20 @@
             },
             {
                 "version": CoLRevVersion("0.9.0"),
                 "target_version": CoLRevVersion("0.9.1"),
                 "script": self.__migrate_0_9_1,
                 "released": True,
             },
+            {
+                "version": CoLRevVersion("0.9.2"),
+                "target_version": CoLRevVersion("0.9.3"),
+                "script": self.__migrate_0_9_3,
+                "released": True,
+            },
         ]
 
         # Note: we should always update the colrev_version in settings.json because the
         # checker.__check_software requires the settings version and
         # the installed version to be identical
 
         # skipping_versions_before_settings_version = True
@@ -392,14 +398,79 @@
         settings = self.__load_settings_dict()
         for source in settings["sources"]:
             if "load_conversion_package_endpoint" in source:
                 del source["load_conversion_package_endpoint"]
         self.__save_settings(settings)
         return self.repo.is_dirty()
 
+    def __migrate_0_9_3(self) -> bool:
+        settings = self.__load_settings_dict()
+        for source in settings["sources"]:
+            if source["endpoint"] == "colrev.crossref":
+                if "issn" not in source["search_parameters"].get("scope", {}):
+                    continue
+                if isinstance(source["search_parameters"]["scope"]["issn"], str):
+                    source["search_parameters"]["scope"]["issn"] = [
+                        source["search_parameters"]["scope"]["issn"]
+                    ]
+
+        self.__save_settings(settings)
+
+        records = self.review_manager.dataset.load_records_dict()
+        for record_dict in records.values():
+            # TODO : call methods in repare.py
+
+            if "pubmedid" in record_dict:
+                record = colrev.record.Record(data=record_dict)
+                record.rename_field(key="pubmedid", new_key="colrev.pubmed.pubmedid")
+
+            if "pii" in record_dict:
+                record = colrev.record.Record(data=record_dict)
+                record.rename_field(key="pii", new_key="colrev.pubmed.pii")
+
+            if "pmc" in record_dict:
+                record = colrev.record.Record(data=record_dict)
+                record.rename_field(key="pmc", new_key="colrev.pubmed.pmc")
+
+            if "label_included" in record_dict:
+                record = colrev.record.Record(data=record_dict)
+                record.rename_field(
+                    key="label_included",
+                    new_key="colrev.synergy_datasets.label_included",
+                )
+            if "method" in record_dict:
+                record = colrev.record.Record(data=record_dict)
+                record.rename_field(
+                    key="method", new_key="colrev.synergy_datasets.method"
+                )
+
+            if "dblp_key" in record_dict:
+                record = colrev.record.Record(data=record_dict)
+                record.rename_field(key="dblp_key", new_key="colrev.dblp.dblp_key")
+            if "wos_accession_number" in record_dict:
+                record = colrev.record.Record(data=record_dict)
+                record.rename_field(
+                    key="wos_accession_number",
+                    new_key="colrev.web_of_science.unique-id",
+                )
+            if "sem_scholar_id" in record_dict:
+                record = colrev.record.Record(data=record_dict)
+                record.rename_field(
+                    key="sem_scholar_id", new_key="colrev.semantic_scholar.id"
+                )
+
+            # TODO : update open_alex source
+            if "openalex_id" in record_dict:
+                record = colrev.record.Record(data=record_dict)
+                record.rename_field(key="openalex_id", new_key="colrev.open_alex.id")
+
+        self.review_manager.dataset.save_records_dict(records=records)
+        self.review_manager.dataset.add_record_changes()
+        return self.repo.is_dirty()
+
 
 # Note: we can ask users to make decisions (when defaults are not clear)
 # via input() or simply cancel the process (raise a CoLrevException)
 
 
 class CoLRevVersion:
     """Class for handling the CoLRev version"""
```

### Comparing `colrev-0.9.2/colrev/ops/validate.py` & `colrev-0.9.3/colrev/ops/validate.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/qm/checkers/container_title_abbreviated.py` & `colrev-0.9.3/colrev/qm/checkers/container_title_abbreviated.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/qm/checkers/doi_not_matching_pattern.py` & `colrev-0.9.3/colrev/qm/checkers/doi_not_matching_pattern.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/qm/checkers/erroneous_symbol_in_field.py` & `colrev-0.9.3/colrev/qm/checkers/erroneous_symbol_in_field.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/qm/checkers/erroneous_term_in_field.py` & `colrev-0.9.3/colrev/qm/checkers/erroneous_term_in_field.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/qm/checkers/erroneous_title_field.py` & `colrev-0.9.3/colrev/qm/checkers/erroneous_title_field.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/qm/checkers/html_chars.py` & `colrev-0.9.3/colrev/qm/checkers/language_unknown.py`

 * *Files 16% similar despite different names*

```diff
@@ -1,41 +1,38 @@
 #! /usr/bin/env python
-"""Checker for html-chars."""
+"""Checker for language-unknown."""
 from __future__ import annotations
 
-import re
-
 import colrev.qm.quality_model
 
 # pylint: disable=too-few-public-methods
 
 
-class HTMLCharChecker:
-    """The HTMLCharChecker"""
+class LanguageChecker:
+    """The LanguageChecker"""
 
-    msg = "html-chars"
-    __fields_to_check = [
-        "title",
-        "journal",
-        "booktitle",
-        "author",
-        "publisher",
-        "editor",
-    ]
+    msg = "language-unknown"
 
     def __init__(self, quality_model: colrev.qm.quality_model.QualityModel) -> None:
         self.quality_model = quality_model
 
     def run(self, *, record: colrev.record.Record) -> None:
-        """Run the html-chars checks"""
+        """Run the language-unknown checks"""
+
+        if record.data.get("title", "UNKNOWN") == "UNKNOWN":
+            return
+
+        if self.__language_unknown(record=record):
+            record.add_masterdata_provenance_note(key="title", note=self.msg)
+
+        else:
+            record.remove_masterdata_provenance_note(key="title", note=self.msg)
 
-        for key in self.__fields_to_check:
-            if key in record.data:
-                if re.search(r"&#\d+;", record.data[key]):
-                    record.add_masterdata_provenance_note(key=key, note=self.msg)
-                else:
-                    record.remove_masterdata_provenance_note(key=key, note=self.msg)
+    def __language_unknown(self, *, record: colrev.record.Record) -> bool:
+        if "language" in record.data:
+            return False
+        return True
 
 
 def register(quality_model: colrev.qm.quality_model.QualityModel) -> None:
     """Register the checker"""
-    quality_model.register_checker(HTMLCharChecker(quality_model))
+    quality_model.register_checker(LanguageChecker(quality_model))
```

### Comparing `colrev-0.9.2/colrev/qm/checkers/identical_values_between_title_and_container.py` & `colrev-0.9.3/colrev/qm/checkers/identical_values_between_title_and_container.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/qm/checkers/incomplete_field.py` & `colrev-0.9.3/colrev/qm/checkers/incomplete_field.py`

 * *Files 1% similar despite different names*

```diff
@@ -14,15 +14,15 @@
 
     def __init__(self, quality_model: colrev.qm.quality_model.QualityModel) -> None:
         self.quality_model = quality_model
 
     def run(self, *, record: colrev.record.Record) -> None:
         """Run the missing-field checks"""
 
-        for key in ["title", "journal", "booktitle", "author"]:
+        for key in ["title", "journal", "booktitle", "author", "abstract"]:
             if record.data.get(key, "UNKNOWN") == "UNKNOWN":
                 continue
             if self.__incomplete_field(record=record, key=key):
                 record.add_masterdata_provenance_note(key=key, note=self.msg)
             else:
                 record.remove_masterdata_provenance_note(key=key, note=self.msg)
```

### Comparing `colrev-0.9.2/colrev/qm/checkers/inconsistent_content.py` & `colrev-0.9.3/colrev/qm/checkers/inconsistent_content.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/qm/checkers/inconsistent_with_doi_metadata.py` & `colrev-0.9.3/colrev/qm/checkers/inconsistent_with_doi_metadata.py`

 * *Files 4% similar despite different names*

```diff
@@ -1,12 +1,11 @@
 #! /usr/bin/env python
 """Checker for inconsistent-with-doi-metadata."""
 from __future__ import annotations
 
-import requests.exceptions
 from thefuzz import fuzz
 
 import colrev.exceptions as colrev_exceptions
 import colrev.ops.built_in.search_sources.crossref as crossref_connector
 import colrev.qm.quality_model
 
 # pylint: disable=too-few-public-methods
@@ -69,16 +68,14 @@
                     < 60
                 ):
                     return True
 
         except (
             colrev_exceptions.RecordNotFoundInPrepSourceException,
             colrev_exceptions.RecordNotParsableException,
-            requests.exceptions.ConnectionError,
-            requests.exceptions.ReadTimeout,
         ):
             return False
         return False
 
 
 def register(quality_model: colrev.qm.quality_model.QualityModel) -> None:
     """Register the checker"""
```

### Comparing `colrev-0.9.2/colrev/qm/checkers/inconsistent_with_entrytype.py` & `colrev-0.9.3/colrev/qm/checkers/inconsistent_with_entrytype.py`

 * *Files 12% similar despite different names*

```diff
@@ -7,25 +7,25 @@
 # pylint: disable=too-few-public-methods
 
 
 class InconsistentWithEntrytypeChecker:
     """The InconsistentWithEntrytypeChecker"""
 
     record_field_inconsistencies: dict[str, list[str]] = {
-        "article": ["booktitle"],
-        "inproceedings": ["issue", "number", "journal"],
+        "article": ["booktitle", "isbn"],
+        "inproceedings": ["issue", "number", "journal", "isbn"],
         "incollection": [],
         "inbook": ["journal"],
-        "book": ["volume", "issue", "number", "journal"],
-        "phdthesis": ["volume", "issue", "number", "journal", "booktitle"],
-        "masterthesis": ["volume", "issue", "number", "journal", "booktitle"],
-        "techreport": ["volume", "issue", "number", "journal", "booktitle"],
-        "unpublished": ["volume", "issue", "number", "journal", "booktitle"],
-        "online": ["journal", "booktitle"],
-        "misc": ["journal", "booktitle"],
+        "book": ["issue", "number", "journal"],
+        "phdthesis": ["volume", "issue", "number", "journal", "booktitle", "isbn"],
+        "masterthesis": ["volume", "issue", "number", "journal", "booktitle", "isbn"],
+        "techreport": ["volume", "issue", "number", "journal", "booktitle", "isbn"],
+        "unpublished": ["volume", "issue", "number", "journal", "booktitle", "isbn"],
+        "online": ["journal", "booktitle", "isbn"],
+        "misc": ["journal", "booktitle", "isbn"],
     }
     """Fields considered inconsistent with the respective ENTRYTYPE"""
 
     msg = "inconsistent-with-entrytype"
 
     def __init__(self, quality_model: colrev.qm.quality_model.QualityModel) -> None:
         self.quality_model = quality_model
```

### Comparing `colrev-0.9.2/colrev/qm/checkers/inconsistent_with_url_metadata.py` & `colrev-0.9.3/colrev/qm/checkers/inconsistent_with_url_metadata.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/qm/checkers/isbn_not_matching_pattern.py` & `colrev-0.9.3/colrev/qm/checkers/isbn_not_matching_pattern.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/qm/checkers/language_format_error.py` & `colrev-0.9.3/colrev/qm/checkers/language_format_error.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/qm/checkers/language_unknown.py` & `colrev-0.9.3/colrev/qm/checkers/year_format.py`

 * *Files 18% similar despite different names*

```diff
@@ -1,38 +1,36 @@
 #! /usr/bin/env python
-"""Checker for language-unknown."""
+"""Checker for year-format."""
 from __future__ import annotations
 
+import re
+
 import colrev.qm.quality_model
 
 # pylint: disable=too-few-public-methods
 
 
-class LanguageChecker:
-    """The LanguageChecker"""
+class YearFormatChecker:
+    """The YearFormatChecker"""
 
-    msg = "language-unknown"
+    msg = "year-format"
 
     def __init__(self, quality_model: colrev.qm.quality_model.QualityModel) -> None:
         self.quality_model = quality_model
 
     def run(self, *, record: colrev.record.Record) -> None:
-        """Run the language-unknown checks"""
+        """Run the year-format checks"""
 
-        if record.data.get("title", "UNKNOWN") == "UNKNOWN":
+        if "year" not in record.data:
+            return
+        if record.data["year"] == "UNKNOWN":
             return
 
-        if self.__language_unknown(record=record):
-            record.add_masterdata_provenance_note(key="title", note=self.msg)
-
+        if not re.match(r"^\d{4}$", record.data["year"]):
+            record.add_masterdata_provenance_note(key="year", note=self.msg)
         else:
-            record.remove_masterdata_provenance_note(key="title", note=self.msg)
-
-    def __language_unknown(self, *, record: colrev.record.Record) -> bool:
-        if "language" in record.data:
-            return False
-        return True
+            record.remove_masterdata_provenance_note(key="year", note=self.msg)
 
 
 def register(quality_model: colrev.qm.quality_model.QualityModel) -> None:
     """Register the checker"""
-    quality_model.register_checker(LanguageChecker(quality_model))
+    quality_model.register_checker(YearFormatChecker(quality_model))
```

### Comparing `colrev-0.9.2/colrev/qm/checkers/missing_field.py` & `colrev-0.9.3/colrev/qm/checkers/missing_field.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/qm/checkers/mostly_all_caps.py` & `colrev-0.9.3/colrev/qm/checkers/mostly_all_caps.py`

 * *Files 12% similar despite different names*

```diff
@@ -39,13 +39,16 @@
                 record.remove_masterdata_provenance_note(key=key, note=self.msg)
                 continue
 
             # container-title-abbreviated
             if key in ["journal", "booktitle"] and len(record.data[key]) < 6:
                 continue
 
+            if record.data[key] == "PLoS ONE":
+                continue
+
             record.add_masterdata_provenance_note(key=key, note=self.msg)
 
 
 def register(quality_model: colrev.qm.quality_model.QualityModel) -> None:
     """Register the checker"""
     quality_model.register_checker(MostlyAllCapsFieldChecker(quality_model))
```

### Comparing `colrev-0.9.2/colrev/qm/checkers/name_abbreviated.py` & `colrev-0.9.3/colrev/qm/checkers/name_abbreviated.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/qm/checkers/name_format_separators.py` & `colrev-0.9.3/colrev/qm/checkers/name_format_separators.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/qm/checkers/name_format_titles.py` & `colrev-0.9.3/colrev/qm/checkers/name_format_titles.py`

 * *Files 14% similar despite different names*

```diff
@@ -30,14 +30,14 @@
 
             if self.__title_in_name(name=record.data[key]):
                 record.add_masterdata_provenance_note(key=key, note=self.msg)
             else:
                 record.remove_masterdata_provenance_note(key=key, note=self.msg)
 
     def __title_in_name(self, *, name: str) -> bool:
-        name_parts = self.__words_rgx.findall(name.lower())
+        name_parts = self.__words_rgx.findall(name.lower().replace(".", ""))
         return any(title.lower() in name_parts for title in self.titles)
 
 
 def register(quality_model: colrev.qm.quality_model.QualityModel) -> None:
     """Register the checker"""
     quality_model.register_checker(NameFormatTitleChecker(quality_model))
```

### Comparing `colrev-0.9.2/colrev/qm/checkers/page_range.py` & `colrev-0.9.3/colrev/qm/checkers/page_range.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/qm/checkers/record_not_in_toc.py` & `colrev-0.9.3/colrev/qm/checkers/record_not_in_toc.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/qm/checkers/thesis_with_multiple_authors.py` & `colrev-0.9.3/colrev/qm/checkers/thesis_with_multiple_authors.py`

 * *Files 6% similar despite different names*

```diff
@@ -20,17 +20,19 @@
 
         if self.__multiple_authored_thesis(record=record):
             record.add_masterdata_provenance_note(key="author", note=self.msg)
         else:
             record.remove_masterdata_provenance_note(key="author", note=self.msg)
 
     def __multiple_authored_thesis(self, *, record: colrev.record.Record) -> bool:
-        if "thesis" in record.data["ENTRYTYPE"] and " and " in record.data.get(
-            "author", ""
-        ):
+        if record.data["ENTRYTYPE"] in [
+            "thesis",
+            "phdthesis",
+            "mastertsthesis",
+        ] and " and " in record.data.get("author", ""):
             return True
         return False
 
 
 def register(quality_model: colrev.qm.quality_model.QualityModel) -> None:
     """Register the checker"""
     quality_model.register_checker(ThesisWithMultipleAuthorsChecker(quality_model))
```

### Comparing `colrev-0.9.2/colrev/qm/checkers/year_format.py` & `colrev-0.9.3/colrev/qm/checkers/html_tags.py`

 * *Files 20% similar despite different names*

```diff
@@ -1,36 +1,41 @@
 #! /usr/bin/env python
-"""Checker for year-format."""
+"""Checker for html-tags."""
 from __future__ import annotations
 
 import re
 
 import colrev.qm.quality_model
 
 # pylint: disable=too-few-public-methods
 
 
-class YearFormatChecker:
-    """The YearFormatChecker"""
+class HTMLTagChecker:
+    """The HTMLTagChecker"""
 
-    msg = "year-format"
+    msg = "html-tags"
+    __fields_to_check = [
+        "title",
+        "journal",
+        "booktitle",
+        "author",
+        "publisher",
+        "editor",
+    ]
 
     def __init__(self, quality_model: colrev.qm.quality_model.QualityModel) -> None:
         self.quality_model = quality_model
 
     def run(self, *, record: colrev.record.Record) -> None:
-        """Run the year-format checks"""
+        """Run the html-tags checks"""
 
-        if "year" not in record.data:
-            return
-        if record.data["year"] == "UNKNOWN":
-            return
-
-        if not re.match(r"^\d{4}$", record.data["year"]):
-            record.add_masterdata_provenance_note(key="year", note=self.msg)
-        else:
-            record.remove_masterdata_provenance_note(key="year", note=self.msg)
+        for key in self.__fields_to_check:
+            if key in record.data:
+                if re.search(r"&#\d+;", record.data[key]):
+                    record.add_masterdata_provenance_note(key=key, note=self.msg)
+                else:
+                    record.remove_masterdata_provenance_note(key=key, note=self.msg)
 
 
 def register(quality_model: colrev.qm.quality_model.QualityModel) -> None:
     """Register the checker"""
-    quality_model.register_checker(YearFormatChecker(quality_model))
+    quality_model.register_checker(HTMLTagChecker(quality_model))
```

### Comparing `colrev-0.9.2/colrev/qm/colrev_id.py` & `colrev-0.9.3/colrev/qm/colrev_id.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/qm/colrev_pdf_id.py` & `colrev-0.9.3/colrev/qm/colrev_pdf_id.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/qm/quality_model.py` & `colrev-0.9.3/colrev/qm/quality_model.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/record.py` & `colrev-0.9.3/colrev/record.py`

 * *Files 1% similar despite different names*

```diff
@@ -139,5585 +139,5617 @@
 000008a0: 2020 2020 2022 636f 6c72 6576 5f6d 6173       "colrev_mas
 000008b0: 7465 7264 6174 615f 7072 6f76 656e 616e  terdata_provenan
 000008c0: 6365 222c 0a20 2020 2020 2020 2022 636f  ce",.        "co
 000008d0: 6c72 6576 5f64 6174 615f 7072 6f76 656e  lrev_data_proven
 000008e0: 616e 6365 222c 0a20 2020 205d 0a0a 2020  ance",.    ]..  
 000008f0: 2020 7469 6d65 5f76 6172 6961 6e74 5f66    time_variant_f
 00000900: 6965 6c64 7320 3d20 5b22 6369 7465 645f  ields = ["cited_
-00000910: 6279 225d 0a0a 2020 2020 7070 203d 2070  by"]..    pp = p
-00000920: 7072 696e 742e 5072 6574 7479 5072 696e  print.PrettyPrin
-00000930: 7465 7228 696e 6465 6e74 3d34 2c20 7769  ter(indent=4, wi
-00000940: 6474 683d 3134 302c 2063 6f6d 7061 6374  dth=140, compact
-00000950: 3d46 616c 7365 290a 0a20 2020 2064 6566  =False)..    def
-00000960: 205f 5f69 6e69 745f 5f28 7365 6c66 2c20   __init__(self, 
-00000970: 2a2c 2064 6174 613a 2064 6963 7429 202d  *, data: dict) -
-00000980: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-00000990: 7365 6c66 2e64 6174 6120 3d20 6461 7461  self.data = data
-000009a0: 0a20 2020 2020 2020 2022 2222 4469 6374  .        """Dict
-000009b0: 696f 6e61 7279 2063 6f6e 7461 696e 696e  ionary containin
-000009c0: 6720 7468 6520 7265 636f 7264 2064 6174  g the record dat
-000009d0: 6122 2222 0a20 2020 2020 2020 2023 204e  a""".        # N
-000009e0: 6f74 6520 3a20 6176 6f69 6420 7061 7273  ote : avoid pars
-000009f0: 696e 6720 7570 6f6e 2052 6563 6f72 6420  ing upon Record 
-00000a00: 696e 7374 616e 7469 6174 696f 6e20 6173  instantiation as
-00000a10: 206d 7563 6820 6173 2070 6f73 7369 626c   much as possibl
-00000a20: 650a 2020 2020 2020 2020 2320 746f 206d  e.        # to m
-00000a30: 6169 6e74 6169 6e20 6869 6768 2070 6572  aintain high per
-00000a40: 666f 726d 616e 6365 2061 6e64 2065 6e73  formance and ens
-00000a50: 7572 6520 7069 636b 6c65 2d61 6269 6c69  ure pickle-abili
-00000a60: 6779 2028 696e 206d 756c 7469 7072 6f63  gy (in multiproc
-00000a70: 6573 7369 6e67 290a 0a20 2020 2064 6566  essing)..    def
-00000a80: 205f 5f72 6570 725f 5f28 7365 6c66 2920   __repr__(self) 
-00000a90: 2d3e 2073 7472 3a20 2023 2070 7261 676d  -> str:  # pragm
-00000aa0: 613a 206e 6f20 636f 7665 720a 2020 2020  a: no cover.    
-00000ab0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-00000ac0: 7070 2e70 666f 726d 6174 2873 656c 662e  pp.pformat(self.
-00000ad0: 6461 7461 290a 0a20 2020 2064 6566 205f  data)..    def _
-00000ae0: 5f73 7472 5f5f 2873 656c 6629 202d 3e20  _str__(self) -> 
-00000af0: 7374 723a 0a20 2020 2020 2020 2069 6465  str:.        ide
-00000b00: 6e74 6966 7969 6e67 5f6b 6579 735f 6f72  ntifying_keys_or
-00000b10: 6465 7220 3d20 5b22 4944 222c 2022 454e  der = ["ID", "EN
-00000b20: 5452 5954 5950 4522 5d20 2b20 5b0a 2020  TRYTYPE"] + [.  
-00000b30: 2020 2020 2020 2020 2020 6b20 666f 7220            k for 
-00000b40: 6b20 696e 2073 656c 662e 6964 656e 7469  k in self.identi
-00000b50: 6679 696e 675f 6669 656c 645f 6b65 7973  fying_field_keys
-00000b60: 2069 6620 6b20 696e 2073 656c 662e 6461   if k in self.da
-00000b70: 7461 0a20 2020 2020 2020 205d 0a20 2020  ta.        ].   
-00000b80: 2020 2020 2063 6f6d 706c 656d 656e 7461       complementa
-00000b90: 7279 5f6b 6579 735f 6f72 6465 7220 3d20  ry_keys_order = 
-00000ba0: 5b0a 2020 2020 2020 2020 2020 2020 6b20  [.            k 
-00000bb0: 666f 7220 6b2c 2076 2069 6e20 7365 6c66  for k, v in self
-00000bc0: 2e64 6174 612e 6974 656d 7328 2920 6966  .data.items() if
-00000bd0: 206b 206e 6f74 2069 6e20 6964 656e 7469   k not in identi
-00000be0: 6679 696e 675f 6b65 7973 5f6f 7264 6572  fying_keys_order
-00000bf0: 0a20 2020 2020 2020 205d 0a0a 2020 2020  .        ]..    
-00000c00: 2020 2020 696b 5f73 6f72 7465 6420 3d20      ik_sorted = 
-00000c10: 7b6b 3a20 7620 666f 7220 6b2c 2076 2069  {k: v for k, v i
-00000c20: 6e20 7365 6c66 2e64 6174 612e 6974 656d  n self.data.item
-00000c30: 7328 2920 6966 206b 2069 6e20 6964 656e  s() if k in iden
-00000c40: 7469 6679 696e 675f 6b65 7973 5f6f 7264  tifying_keys_ord
-00000c50: 6572 7d0a 2020 2020 2020 2020 636b 5f73  er}.        ck_s
-00000c60: 6f72 7465 6420 3d20 7b0a 2020 2020 2020  orted = {.      
-00000c70: 2020 2020 2020 6b3a 2076 2066 6f72 206b        k: v for k
-00000c80: 2c20 7620 696e 2073 656c 662e 6461 7461  , v in self.data
-00000c90: 2e69 7465 6d73 2829 2069 6620 6b20 696e  .items() if k in
-00000ca0: 2063 6f6d 706c 656d 656e 7461 7279 5f6b   complementary_k
-00000cb0: 6579 735f 6f72 6465 720a 2020 2020 2020  eys_order.      
-00000cc0: 2020 7d0a 2020 2020 2020 2020 7265 745f    }.        ret_
-00000cd0: 7374 7220 3d20 280a 2020 2020 2020 2020  str = (.        
-00000ce0: 2020 2020 7365 6c66 2e70 702e 7066 6f72      self.pp.pfor
-00000cf0: 6d61 7428 696b 5f73 6f72 7465 6429 5b3a  mat(ik_sorted)[:
-00000d00: 2d31 5d20 2b20 225c 6e22 202b 2073 656c  -1] + "\n" + sel
-00000d10: 662e 7070 2e70 666f 726d 6174 2863 6b5f  f.pp.pformat(ck_
-00000d20: 736f 7274 6564 295b 313a 5d0a 2020 2020  sorted)[1:].    
-00000d30: 2020 2020 290a 0a20 2020 2020 2020 2072      )..        r
-00000d40: 6574 7572 6e20 7265 745f 7374 720a 0a20  eturn ret_str.. 
-00000d50: 2020 2064 6566 205f 5f65 715f 5f28 7365     def __eq__(se
-00000d60: 6c66 2c20 6f74 6865 723a 206f 626a 6563  lf, other: objec
-00000d70: 7429 202d 3e20 626f 6f6c 3a0a 2020 2020  t) -> bool:.    
-00000d80: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-00000d90: 5f5f 6469 6374 5f5f 203d 3d20 6f74 6865  __dict__ == othe
-00000da0: 722e 5f5f 6469 6374 5f5f 0a0a 2020 2020  r.__dict__..    
-00000db0: 6465 6620 636f 7079 2873 656c 6629 202d  def copy(self) -
-00000dc0: 3e20 5265 636f 7264 3a0a 2020 2020 2020  > Record:.      
-00000dd0: 2020 2222 2243 6f70 7920 7468 6520 7265    """Copy the re
-00000de0: 636f 7264 206f 626a 6563 7422 2222 0a20  cord object""". 
-00000df0: 2020 2020 2020 2072 6574 7572 6e20 5265         return Re
-00000e00: 636f 7264 2864 6174 613d 6465 6570 636f  cord(data=deepco
-00000e10: 7079 2873 656c 662e 6461 7461 2929 0a0a  py(self.data))..
-00000e20: 2020 2020 6465 6620 636f 7079 5f70 7265      def copy_pre
-00000e30: 705f 7265 6328 7365 6c66 2920 2d3e 2050  p_rec(self) -> P
-00000e40: 7265 7052 6563 6f72 643a 0a20 2020 2020  repRecord:.     
-00000e50: 2020 2022 2222 436f 7079 2074 6865 2072     """Copy the r
-00000e60: 6563 6f72 6420 6f62 6a65 6374 2028 6173  ecord object (as
-00000e70: 2061 2050 7265 7052 6563 6f72 6429 2222   a PrepRecord)""
-00000e80: 220a 2020 2020 2020 2020 7265 7475 726e  ".        return
-00000e90: 2050 7265 7052 6563 6f72 6428 6461 7461   PrepRecord(data
-00000ea0: 3d64 6565 7063 6f70 7928 7365 6c66 2e64  =deepcopy(self.d
-00000eb0: 6174 6129 290a 0a20 2020 2064 6566 2075  ata))..    def u
-00000ec0: 7064 6174 655f 6279 5f72 6563 6f72 6428  pdate_by_record(
-00000ed0: 7365 6c66 2c20 2a2c 2075 7064 6174 655f  self, *, update_
-00000ee0: 7265 636f 7264 3a20 5265 636f 7264 2920  record: Record) 
-00000ef0: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-00000f00: 2022 2222 5570 6461 7465 2061 6c6c 2064   """Update all d
-00000f10: 6174 6120 6f66 2061 2072 6563 6f72 6420  ata of a record 
-00000f20: 6f62 6a65 6374 2062 6173 6564 206f 6e20  object based on 
-00000f30: 616e 6f74 6865 7220 7265 636f 7264 2222  another record""
-00000f40: 220a 2020 2020 2020 2020 7365 6c66 2e64  ".        self.d
-00000f50: 6174 6120 3d20 7570 6461 7465 5f72 6563  ata = update_rec
-00000f60: 6f72 642e 636f 7079 5f70 7265 705f 7265  ord.copy_prep_re
-00000f70: 6328 292e 6765 745f 6461 7461 2829 0a0a  c().get_data()..
-00000f80: 2020 2020 6465 6620 6765 745f 6469 6666      def get_diff
-00000f90: 280a 2020 2020 2020 2020 7365 6c66 2c20  (.        self, 
-00000fa0: 2a2c 206f 7468 6572 5f72 6563 6f72 643a  *, other_record:
-00000fb0: 2052 6563 6f72 642c 2069 6465 6e74 6966   Record, identif
-00000fc0: 7969 6e67 5f66 6965 6c64 735f 6f6e 6c79  ying_fields_only
-00000fd0: 3a20 626f 6f6c 203d 2054 7275 650a 2020  : bool = True.  
-00000fe0: 2020 2920 2d3e 206c 6973 743a 0a20 2020    ) -> list:.   
-00000ff0: 2020 2020 2022 2222 4765 7420 6469 6666       """Get diff
-00001000: 2062 6574 7765 656e 2072 6563 6f72 6420   between record 
-00001010: 6f62 6a65 6374 7322 2222 0a0a 2020 2020  objects"""..    
-00001020: 2020 2020 2320 7079 6c69 6e74 3a20 6469      # pylint: di
-00001030: 7361 626c 653d 746f 6f2d 6d61 6e79 2d62  sable=too-many-b
-00001040: 7261 6e63 6865 730a 0a20 2020 2020 2020  ranches..       
-00001050: 2064 6966 6620 3d20 5b5d 0a20 2020 2020   diff = [].     
-00001060: 2020 2069 6620 6964 656e 7469 6679 696e     if identifyin
-00001070: 675f 6669 656c 6473 5f6f 6e6c 793a 0a20  g_fields_only:. 
-00001080: 2020 2020 2020 2020 2020 2066 6f72 2073             for s
-00001090: 656c 6563 7465 645f 7475 706c 6520 696e  elected_tuple in
-000010a0: 206c 6973 7428 0a20 2020 2020 2020 2020   list(.         
-000010b0: 2020 2020 2020 2064 6963 7464 6966 6665         dictdiffe
-000010c0: 722e 6469 6666 2873 656c 662e 6765 745f  r.diff(self.get_
-000010d0: 6461 7461 2829 2c20 6f74 6865 725f 7265  data(), other_re
-000010e0: 636f 7264 2e67 6574 5f64 6174 6128 2929  cord.get_data())
-000010f0: 0a20 2020 2020 2020 2020 2020 2029 3a0a  .            ):.
-00001100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001110: 6966 2073 656c 6563 7465 645f 7475 706c  if selected_tupl
-00001120: 655b 305d 203d 3d20 2263 6861 6e67 6522  e[0] == "change"
-00001130: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00001140: 2020 2020 2020 6966 2073 656c 6563 7465        if selecte
-00001150: 645f 7475 706c 655b 315d 2069 6e20 7365  d_tuple[1] in se
-00001160: 6c66 2e69 6465 6e74 6966 7969 6e67 5f66  lf.identifying_f
-00001170: 6965 6c64 5f6b 6579 733a 0a20 2020 2020  ield_keys:.     
-00001180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001190: 2020 2064 6966 662e 6170 7065 6e64 2873     diff.append(s
-000011a0: 656c 6563 7465 645f 7475 706c 6529 0a20  elected_tuple). 
-000011b0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000011c0: 6620 7365 6c65 6374 6564 5f74 7570 6c65  f selected_tuple
-000011d0: 5b30 5d20 3d3d 2022 6164 6422 3a0a 2020  [0] == "add":.  
-000011e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000011f0: 2020 6164 6469 7469 6f6e 5f6c 6973 743a    addition_list:
-00001200: 2074 7970 696e 672e 5475 706c 6520 3d20   typing.Tuple = 
-00001210: 2822 6164 6422 2c20 2222 2c20 5b5d 290a  ("add", "", []).
-00001220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001230: 2020 2020 666f 7220 6164 6469 7469 6f6e      for addition
-00001240: 5f69 7465 6d20 696e 2073 656c 6563 7465  _item in selecte
-00001250: 645f 7475 706c 655b 325d 3a0a 2020 2020  d_tuple[2]:.    
-00001260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001270: 2020 2020 6966 2061 6464 6974 696f 6e5f      if addition_
-00001280: 6974 656d 5b30 5d20 696e 2073 656c 662e  item[0] in self.
-00001290: 6964 656e 7469 6679 696e 675f 6669 656c  identifying_fiel
-000012a0: 645f 6b65 7973 3a0a 2020 2020 2020 2020  d_keys:.        
-000012b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000012c0: 2020 2020 6164 6469 7469 6f6e 5f6c 6973      addition_lis
-000012d0: 745b 325d 2e61 7070 656e 6428 6164 6469  t[2].append(addi
-000012e0: 7469 6f6e 5f69 7465 6d29 0a20 2020 2020  tion_item).     
-000012f0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00001300: 6620 6164 6469 7469 6f6e 5f6c 6973 745b  f addition_list[
-00001310: 325d 3a0a 2020 2020 2020 2020 2020 2020  2]:.            
-00001320: 2020 2020 2020 2020 2020 2020 6469 6666              diff
-00001330: 2e61 7070 656e 6428 6164 6469 7469 6f6e  .append(addition
-00001340: 5f6c 6973 7429 0a20 2020 2020 2020 2020  _list).         
-00001350: 2020 2020 2020 2069 6620 7365 6c65 6374         if select
-00001360: 6564 5f74 7570 6c65 5b30 5d20 3d3d 2022  ed_tuple[0] == "
-00001370: 7265 6d6f 7665 223a 0a20 2020 2020 2020  remove":.       
-00001380: 2020 2020 2020 2020 2020 2020 2072 656d               rem
-00001390: 6f76 616c 5f6c 6973 743a 2074 7970 696e  oval_list: typin
-000013a0: 672e 5475 706c 6520 3d20 2822 7265 6d6f  g.Tuple = ("remo
-000013b0: 7665 222c 2022 222c 205b 5d29 0a20 2020  ve", "", []).   
-000013c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000013d0: 2066 6f72 2072 656d 6f76 616c 5f69 7465   for removal_ite
-000013e0: 6d20 696e 2073 656c 6563 7465 645f 7475  m in selected_tu
-000013f0: 706c 655b 325d 3a0a 2020 2020 2020 2020  ple[2]:.        
-00001400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001410: 6966 2072 656d 6f76 616c 5f69 7465 6d5b  if removal_item[
-00001420: 305d 2069 6e20 7365 6c66 2e69 6465 6e74  0] in self.ident
-00001430: 6966 7969 6e67 5f66 6965 6c64 5f6b 6579  ifying_field_key
-00001440: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-00001450: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00001460: 656d 6f76 616c 5f6c 6973 745b 325d 2e61  emoval_list[2].a
-00001470: 7070 656e 6428 7265 6d6f 7661 6c5f 6974  ppend(removal_it
-00001480: 656d 290a 2020 2020 2020 2020 2020 2020  em).            
-00001490: 2020 2020 2020 2020 6966 2072 656d 6f76          if remov
-000014a0: 616c 5f6c 6973 745b 325d 3a0a 2020 2020  al_list[2]:.    
+00000910: 6279 225d 0a0a 2020 2020 2320 544f 444f  by"]..    # TODO
+00000920: 203a 206c 696e 6b20 746f 2043 4550 0a20   : link to CEP. 
+00000930: 2020 2073 7461 6e64 6172 6469 7a65 645f     standardized_
+00000940: 6669 656c 645f 6b65 7973 203d 2028 0a20  field_keys = (. 
+00000950: 2020 2020 2020 2069 6465 6e74 6966 7969         identifyi
+00000960: 6e67 5f66 6965 6c64 5f6b 6579 730a 2020  ng_field_keys.  
+00000970: 2020 2020 2020 2b20 7072 6f76 656e 616e        + provenan
+00000980: 6365 5f6b 6579 730a 2020 2020 2020 2020  ce_keys.        
+00000990: 2b20 5b0a 2020 2020 2020 2020 2020 2020  + [.            
+000009a0: 2249 4422 2c0a 2020 2020 2020 2020 2020  "ID",.          
+000009b0: 2020 2245 4e54 5259 5459 5045 222c 0a20    "ENTRYTYPE",. 
+000009c0: 2020 2020 2020 2020 2020 2022 646f 6922             "doi"
+000009d0: 2c0a 2020 2020 2020 2020 2020 2020 2275  ,.            "u
+000009e0: 726c 222c 0a20 2020 2020 2020 2020 2020  rl",.           
+000009f0: 2022 6973 736e 222c 0a20 2020 2020 2020   "issn",.       
+00000a00: 2020 2020 2022 6973 626e 222c 0a20 2020       "isbn",.   
+00000a10: 2020 2020 2020 2020 2022 6675 6c6c 7465           "fullte
+00000a20: 7874 222c 0a20 2020 2020 2020 2020 2020  xt",.           
+00000a30: 2022 6162 7374 7261 6374 222c 0a20 2020   "abstract",.   
+00000a40: 2020 2020 2020 2020 2022 6b65 7977 6f72           "keywor
+00000a50: 6473 222c 0a20 2020 2020 2020 2020 2020  ds",.           
+00000a60: 2022 6369 7465 645f 6279 222c 0a20 2020   "cited_by",.   
+00000a70: 2020 2020 2020 2020 2022 6669 6c65 222c           "file",
+00000a80: 0a20 2020 2020 2020 2020 2020 2022 696e  .            "in
+00000a90: 7374 6974 7574 696f 6e22 2c0a 2020 2020  stitution",.    
+00000aa0: 2020 2020 2020 2020 226d 6f6e 7468 222c          "month",
+00000ab0: 0a20 2020 2020 2020 2020 2020 2022 7365  .            "se
+00000ac0: 7269 6573 222c 0a20 2020 2020 2020 2020  ries",.         
+00000ad0: 2020 2022 6c61 6e67 7561 6765 222c 0a20     "language",. 
+00000ae0: 2020 2020 2020 205d 0a20 2020 2029 0a20         ].    ). 
+00000af0: 2020 2022 2222 5374 616e 6461 7264 697a     """Standardiz
+00000b00: 6564 2066 6965 6c64 206b 6579 7322 2222  ed field keys"""
+00000b10: 0a0a 2020 2020 7070 203d 2070 7072 696e  ..    pp = pprin
+00000b20: 742e 5072 6574 7479 5072 696e 7465 7228  t.PrettyPrinter(
+00000b30: 696e 6465 6e74 3d34 2c20 7769 6474 683d  indent=4, width=
+00000b40: 3134 302c 2063 6f6d 7061 6374 3d46 616c  140, compact=Fal
+00000b50: 7365 290a 0a20 2020 2064 6566 205f 5f69  se)..    def __i
+00000b60: 6e69 745f 5f28 7365 6c66 2c20 2a2c 2064  nit__(self, *, d
+00000b70: 6174 613a 2064 6963 7429 202d 3e20 4e6f  ata: dict) -> No
+00000b80: 6e65 3a0a 2020 2020 2020 2020 7365 6c66  ne:.        self
+00000b90: 2e64 6174 6120 3d20 6461 7461 0a20 2020  .data = data.   
+00000ba0: 2020 2020 2022 2222 4469 6374 696f 6e61       """Dictiona
+00000bb0: 7279 2063 6f6e 7461 696e 696e 6720 7468  ry containing th
+00000bc0: 6520 7265 636f 7264 2064 6174 6122 2222  e record data"""
+00000bd0: 0a20 2020 2020 2020 2023 204e 6f74 6520  .        # Note 
+00000be0: 3a20 6176 6f69 6420 7061 7273 696e 6720  : avoid parsing 
+00000bf0: 7570 6f6e 2052 6563 6f72 6420 696e 7374  upon Record inst
+00000c00: 616e 7469 6174 696f 6e20 6173 206d 7563  antiation as muc
+00000c10: 6820 6173 2070 6f73 7369 626c 650a 2020  h as possible.  
+00000c20: 2020 2020 2020 2320 746f 206d 6169 6e74        # to maint
+00000c30: 6169 6e20 6869 6768 2070 6572 666f 726d  ain high perform
+00000c40: 616e 6365 2061 6e64 2065 6e73 7572 6520  ance and ensure 
+00000c50: 7069 636b 6c65 2d61 6269 6c69 6779 2028  pickle-abiligy (
+00000c60: 696e 206d 756c 7469 7072 6f63 6573 7369  in multiprocessi
+00000c70: 6e67 290a 0a20 2020 2064 6566 205f 5f72  ng)..    def __r
+00000c80: 6570 725f 5f28 7365 6c66 2920 2d3e 2073  epr__(self) -> s
+00000c90: 7472 3a20 2023 2070 7261 676d 613a 206e  tr:  # pragma: n
+00000ca0: 6f20 636f 7665 720a 2020 2020 2020 2020  o cover.        
+00000cb0: 7265 7475 726e 2073 656c 662e 7070 2e70  return self.pp.p
+00000cc0: 666f 726d 6174 2873 656c 662e 6461 7461  format(self.data
+00000cd0: 290a 0a20 2020 2064 6566 205f 5f73 7472  )..    def __str
+00000ce0: 5f5f 2873 656c 6629 202d 3e20 7374 723a  __(self) -> str:
+00000cf0: 0a20 2020 2020 2020 2069 6465 6e74 6966  .        identif
+00000d00: 7969 6e67 5f6b 6579 735f 6f72 6465 7220  ying_keys_order 
+00000d10: 3d20 5b22 4944 222c 2022 454e 5452 5954  = ["ID", "ENTRYT
+00000d20: 5950 4522 5d20 2b20 5b0a 2020 2020 2020  YPE"] + [.      
+00000d30: 2020 2020 2020 6b20 666f 7220 6b20 696e        k for k in
+00000d40: 2073 656c 662e 6964 656e 7469 6679 696e   self.identifyin
+00000d50: 675f 6669 656c 645f 6b65 7973 2069 6620  g_field_keys if 
+00000d60: 6b20 696e 2073 656c 662e 6461 7461 0a20  k in self.data. 
+00000d70: 2020 2020 2020 205d 0a20 2020 2020 2020         ].       
+00000d80: 2063 6f6d 706c 656d 656e 7461 7279 5f6b   complementary_k
+00000d90: 6579 735f 6f72 6465 7220 3d20 5b0a 2020  eys_order = [.  
+00000da0: 2020 2020 2020 2020 2020 6b20 666f 7220            k for 
+00000db0: 6b2c 2076 2069 6e20 7365 6c66 2e64 6174  k, v in self.dat
+00000dc0: 612e 6974 656d 7328 2920 6966 206b 206e  a.items() if k n
+00000dd0: 6f74 2069 6e20 6964 656e 7469 6679 696e  ot in identifyin
+00000de0: 675f 6b65 7973 5f6f 7264 6572 0a20 2020  g_keys_order.   
+00000df0: 2020 2020 205d 0a0a 2020 2020 2020 2020       ]..        
+00000e00: 696b 5f73 6f72 7465 6420 3d20 7b6b 3a20  ik_sorted = {k: 
+00000e10: 7620 666f 7220 6b2c 2076 2069 6e20 7365  v for k, v in se
+00000e20: 6c66 2e64 6174 612e 6974 656d 7328 2920  lf.data.items() 
+00000e30: 6966 206b 2069 6e20 6964 656e 7469 6679  if k in identify
+00000e40: 696e 675f 6b65 7973 5f6f 7264 6572 7d0a  ing_keys_order}.
+00000e50: 2020 2020 2020 2020 636b 5f73 6f72 7465          ck_sorte
+00000e60: 6420 3d20 7b0a 2020 2020 2020 2020 2020  d = {.          
+00000e70: 2020 6b3a 2076 2066 6f72 206b 2c20 7620    k: v for k, v 
+00000e80: 696e 2073 656c 662e 6461 7461 2e69 7465  in self.data.ite
+00000e90: 6d73 2829 2069 6620 6b20 696e 2063 6f6d  ms() if k in com
+00000ea0: 706c 656d 656e 7461 7279 5f6b 6579 735f  plementary_keys_
+00000eb0: 6f72 6465 720a 2020 2020 2020 2020 7d0a  order.        }.
+00000ec0: 2020 2020 2020 2020 7265 745f 7374 7220          ret_str 
+00000ed0: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
+00000ee0: 7365 6c66 2e70 702e 7066 6f72 6d61 7428  self.pp.pformat(
+00000ef0: 696b 5f73 6f72 7465 6429 5b3a 2d31 5d20  ik_sorted)[:-1] 
+00000f00: 2b20 225c 6e22 202b 2073 656c 662e 7070  + "\n" + self.pp
+00000f10: 2e70 666f 726d 6174 2863 6b5f 736f 7274  .pformat(ck_sort
+00000f20: 6564 295b 313a 5d0a 2020 2020 2020 2020  ed)[1:].        
+00000f30: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
+00000f40: 6e20 7265 745f 7374 720a 0a20 2020 2064  n ret_str..    d
+00000f50: 6566 205f 5f65 715f 5f28 7365 6c66 2c20  ef __eq__(self, 
+00000f60: 6f74 6865 723a 206f 626a 6563 7429 202d  other: object) -
+00000f70: 3e20 626f 6f6c 3a0a 2020 2020 2020 2020  > bool:.        
+00000f80: 7265 7475 726e 2073 656c 662e 5f5f 6469  return self.__di
+00000f90: 6374 5f5f 203d 3d20 6f74 6865 722e 5f5f  ct__ == other.__
+00000fa0: 6469 6374 5f5f 0a0a 2020 2020 6465 6620  dict__..    def 
+00000fb0: 636f 7079 2873 656c 6629 202d 3e20 5265  copy(self) -> Re
+00000fc0: 636f 7264 3a0a 2020 2020 2020 2020 2222  cord:.        ""
+00000fd0: 2243 6f70 7920 7468 6520 7265 636f 7264  "Copy the record
+00000fe0: 206f 626a 6563 7422 2222 0a20 2020 2020   object""".     
+00000ff0: 2020 2072 6574 7572 6e20 5265 636f 7264     return Record
+00001000: 2864 6174 613d 6465 6570 636f 7079 2873  (data=deepcopy(s
+00001010: 656c 662e 6461 7461 2929 0a0a 2020 2020  elf.data))..    
+00001020: 6465 6620 636f 7079 5f70 7265 705f 7265  def copy_prep_re
+00001030: 6328 7365 6c66 2920 2d3e 2050 7265 7052  c(self) -> PrepR
+00001040: 6563 6f72 643a 0a20 2020 2020 2020 2022  ecord:.        "
+00001050: 2222 436f 7079 2074 6865 2072 6563 6f72  ""Copy the recor
+00001060: 6420 6f62 6a65 6374 2028 6173 2061 2050  d object (as a P
+00001070: 7265 7052 6563 6f72 6429 2222 220a 2020  repRecord)""".  
+00001080: 2020 2020 2020 7265 7475 726e 2050 7265        return Pre
+00001090: 7052 6563 6f72 6428 6461 7461 3d64 6565  pRecord(data=dee
+000010a0: 7063 6f70 7928 7365 6c66 2e64 6174 6129  pcopy(self.data)
+000010b0: 290a 0a20 2020 2064 6566 2075 7064 6174  )..    def updat
+000010c0: 655f 6279 5f72 6563 6f72 6428 7365 6c66  e_by_record(self
+000010d0: 2c20 2a2c 2075 7064 6174 655f 7265 636f  , *, update_reco
+000010e0: 7264 3a20 5265 636f 7264 2920 2d3e 204e  rd: Record) -> N
+000010f0: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
+00001100: 5570 6461 7465 2061 6c6c 2064 6174 6120  Update all data 
+00001110: 6f66 2061 2072 6563 6f72 6420 6f62 6a65  of a record obje
+00001120: 6374 2062 6173 6564 206f 6e20 616e 6f74  ct based on anot
+00001130: 6865 7220 7265 636f 7264 2222 220a 2020  her record""".  
+00001140: 2020 2020 2020 7365 6c66 2e64 6174 6120        self.data 
+00001150: 3d20 7570 6461 7465 5f72 6563 6f72 642e  = update_record.
+00001160: 636f 7079 5f70 7265 705f 7265 6328 292e  copy_prep_rec().
+00001170: 6765 745f 6461 7461 2829 0a0a 2020 2020  get_data()..    
+00001180: 6465 6620 6765 745f 6469 6666 280a 2020  def get_diff(.  
+00001190: 2020 2020 2020 7365 6c66 2c20 2a2c 206f        self, *, o
+000011a0: 7468 6572 5f72 6563 6f72 643a 2052 6563  ther_record: Rec
+000011b0: 6f72 642c 2069 6465 6e74 6966 7969 6e67  ord, identifying
+000011c0: 5f66 6965 6c64 735f 6f6e 6c79 3a20 626f  _fields_only: bo
+000011d0: 6f6c 203d 2054 7275 650a 2020 2020 2920  ol = True.    ) 
+000011e0: 2d3e 206c 6973 743a 0a20 2020 2020 2020  -> list:.       
+000011f0: 2022 2222 4765 7420 6469 6666 2062 6574   """Get diff bet
+00001200: 7765 656e 2072 6563 6f72 6420 6f62 6a65  ween record obje
+00001210: 6374 7322 2222 0a0a 2020 2020 2020 2020  cts"""..        
+00001220: 2320 7079 6c69 6e74 3a20 6469 7361 626c  # pylint: disabl
+00001230: 653d 746f 6f2d 6d61 6e79 2d62 7261 6e63  e=too-many-branc
+00001240: 6865 730a 0a20 2020 2020 2020 2064 6966  hes..        dif
+00001250: 6620 3d20 5b5d 0a20 2020 2020 2020 2069  f = [].        i
+00001260: 6620 6964 656e 7469 6679 696e 675f 6669  f identifying_fi
+00001270: 656c 6473 5f6f 6e6c 793a 0a20 2020 2020  elds_only:.     
+00001280: 2020 2020 2020 2066 6f72 2073 656c 6563         for selec
+00001290: 7465 645f 7475 706c 6520 696e 206c 6973  ted_tuple in lis
+000012a0: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
+000012b0: 2020 2064 6963 7464 6966 6665 722e 6469     dictdiffer.di
+000012c0: 6666 2873 656c 662e 6765 745f 6461 7461  ff(self.get_data
+000012d0: 2829 2c20 6f74 6865 725f 7265 636f 7264  (), other_record
+000012e0: 2e67 6574 5f64 6174 6128 2929 0a20 2020  .get_data()).   
+000012f0: 2020 2020 2020 2020 2029 3a0a 2020 2020           ):.    
+00001300: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+00001310: 656c 6563 7465 645f 7475 706c 655b 305d  elected_tuple[0]
+00001320: 203d 3d20 2263 6861 6e67 6522 3a0a 2020   == "change":.  
+00001330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001340: 2020 6966 2073 656c 6563 7465 645f 7475    if selected_tu
+00001350: 706c 655b 315d 2069 6e20 7365 6c66 2e69  ple[1] in self.i
+00001360: 6465 6e74 6966 7969 6e67 5f66 6965 6c64  dentifying_field
+00001370: 5f6b 6579 733a 0a20 2020 2020 2020 2020  _keys:.         
+00001380: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00001390: 6966 662e 6170 7065 6e64 2873 656c 6563  iff.append(selec
+000013a0: 7465 645f 7475 706c 6529 0a20 2020 2020  ted_tuple).     
+000013b0: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+000013c0: 6c65 6374 6564 5f74 7570 6c65 5b30 5d20  lected_tuple[0] 
+000013d0: 3d3d 2022 6164 6422 3a0a 2020 2020 2020  == "add":.      
+000013e0: 2020 2020 2020 2020 2020 2020 2020 6164                ad
+000013f0: 6469 7469 6f6e 5f6c 6973 743a 2074 7970  dition_list: typ
+00001400: 696e 672e 5475 706c 6520 3d20 2822 6164  ing.Tuple = ("ad
+00001410: 6422 2c20 2222 2c20 5b5d 290a 2020 2020  d", "", []).    
+00001420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001430: 666f 7220 6164 6469 7469 6f6e 5f69 7465  for addition_ite
+00001440: 6d20 696e 2073 656c 6563 7465 645f 7475  m in selected_tu
+00001450: 706c 655b 325d 3a0a 2020 2020 2020 2020  ple[2]:.        
+00001460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001470: 6966 2061 6464 6974 696f 6e5f 6974 656d  if addition_item
+00001480: 5b30 5d20 696e 2073 656c 662e 6964 656e  [0] in self.iden
+00001490: 7469 6679 696e 675f 6669 656c 645f 6b65  tifying_field_ke
+000014a0: 7973 3a0a 2020 2020 2020 2020 2020 2020  ys:.            
 000014b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000014c0: 2020 2020 6469 6666 2e61 7070 656e 6428      diff.append(
-000014d0: 7265 6d6f 7661 6c5f 6c69 7374 290a 2020  removal_list).  
-000014e0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-000014f0: 2020 2020 2020 2020 6469 6666 203d 206c          diff = l
-00001500: 6973 7428 6469 6374 6469 6666 6572 2e64  ist(dictdiffer.d
-00001510: 6966 6628 7365 6c66 2e67 6574 5f64 6174  iff(self.get_dat
-00001520: 6128 292c 206f 7468 6572 5f72 6563 6f72  a(), other_recor
-00001530: 642e 6765 745f 6461 7461 2829 2929 0a0a  d.get_data()))..
-00001540: 2020 2020 2020 2020 7265 7475 726e 2064          return d
-00001550: 6966 660a 0a20 2020 2064 6566 2066 6f72  iff..    def for
-00001560: 6d61 745f 6269 625f 7374 796c 6528 7365  mat_bib_style(se
-00001570: 6c66 2920 2d3e 2073 7472 3a0a 2020 2020  lf) -> str:.    
-00001580: 2020 2020 2222 2253 696d 706c 6520 666f      """Simple fo
-00001590: 726d 6174 7465 7220 666f 7220 6269 626c  rmatter for bibl
-000015a0: 696f 6772 6170 6879 2d73 7479 6c65 206f  iography-style o
-000015b0: 7574 7075 7422 2222 0a20 2020 2020 2020  utput""".       
-000015c0: 2062 6962 5f66 6f72 6d61 7474 6564 203d   bib_formatted =
-000015d0: 2028 0a20 2020 2020 2020 2020 2020 2073   (.            s
-000015e0: 656c 662e 6461 7461 2e67 6574 2822 6175  elf.data.get("au
-000015f0: 7468 6f72 222c 2022 2229 0a20 2020 2020  thor", "").     
-00001600: 2020 2020 2020 202b 2022 2028 220a 2020         + " (".  
-00001610: 2020 2020 2020 2020 2020 2b20 7365 6c66            + self
-00001620: 2e64 6174 612e 6765 7428 2279 6561 7222  .data.get("year"
-00001630: 2c20 2222 290a 2020 2020 2020 2020 2020  , "").          
-00001640: 2020 2b20 2229 2022 0a20 2020 2020 2020    + ") ".       
-00001650: 2020 2020 202b 2073 656c 662e 6461 7461       + self.data
-00001660: 2e67 6574 2822 7469 746c 6522 2c20 2222  .get("title", ""
-00001670: 290a 2020 2020 2020 2020 2020 2020 2b20  ).            + 
-00001680: 222e 2022 0a20 2020 2020 2020 2020 2020  ". ".           
-00001690: 202b 2073 656c 662e 6461 7461 2e67 6574   + self.data.get
-000016a0: 2822 6a6f 7572 6e61 6c22 2c20 2222 290a  ("journal", "").
-000016b0: 2020 2020 2020 2020 2020 2020 2b20 7365              + se
-000016c0: 6c66 2e64 6174 612e 6765 7428 2262 6f6f  lf.data.get("boo
-000016d0: 6b74 6974 6c65 222c 2022 2229 0a20 2020  ktitle", "").   
-000016e0: 2020 2020 2020 2020 202b 2022 2c20 2822           + ", ("
-000016f0: 0a20 2020 2020 2020 2020 2020 202b 2073  .            + s
-00001700: 656c 662e 6461 7461 2e67 6574 2822 766f  elf.data.get("vo
-00001710: 6c75 6d65 222c 2022 2229 0a20 2020 2020  lume", "").     
-00001720: 2020 2020 2020 202b 2022 2920 220a 2020         + ") ".  
-00001730: 2020 2020 2020 2020 2020 2b20 7365 6c66            + self
-00001740: 2e64 6174 612e 6765 7428 226e 756d 6265  .data.get("numbe
-00001750: 7222 2c20 2222 290a 2020 2020 2020 2020  r", "").        
-00001760: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-00001770: 2062 6962 5f66 6f72 6d61 7474 6564 0a0a   bib_formatted..
-00001780: 2020 2020 6465 6620 5f5f 7361 7665 5f66      def __save_f
-00001790: 6965 6c64 5f64 6963 7428 7365 6c66 2c20  ield_dict(self, 
-000017a0: 2a2c 2069 6e70 7574 5f64 6963 743a 2064  *, input_dict: d
-000017b0: 6963 742c 2069 6e70 7574 5f6b 6579 3a20  ict, input_key: 
-000017c0: 7374 7229 202d 3e20 6c69 7374 3a0a 2020  str) -> list:.  
-000017d0: 2020 2020 2020 6c69 7374 5f74 6f5f 7265        list_to_re
-000017e0: 7475 726e 203d 205b 5d0a 2020 2020 2020  turn = [].      
-000017f0: 2020 6173 7365 7274 2069 6e70 7574 5f6b    assert input_k
-00001800: 6579 2069 6e20 5b22 636f 6c72 6576 5f6d  ey in ["colrev_m
-00001810: 6173 7465 7264 6174 615f 7072 6f76 656e  asterdata_proven
-00001820: 616e 6365 222c 2022 636f 6c72 6576 5f64  ance", "colrev_d
-00001830: 6174 615f 7072 6f76 656e 616e 6365 225d  ata_provenance"]
-00001840: 0a20 2020 2020 2020 2069 6620 696e 7075  .        if inpu
-00001850: 745f 6b65 7920 3d3d 2022 636f 6c72 6576  t_key == "colrev
-00001860: 5f6d 6173 7465 7264 6174 615f 7072 6f76  _masterdata_prov
-00001870: 656e 616e 6365 223a 0a20 2020 2020 2020  enance":.       
-00001880: 2020 2020 2066 6f72 206b 6579 2c20 7661       for key, va
-00001890: 6c75 6520 696e 2069 6e70 7574 5f64 6963  lue in input_dic
-000018a0: 742e 6974 656d 7328 293a 0a20 2020 2020  t.items():.     
-000018b0: 2020 2020 2020 2020 2020 2069 6620 6973             if is
-000018c0: 696e 7374 616e 6365 2876 616c 7565 2c20  instance(value, 
-000018d0: 6469 6374 293a 0a20 2020 2020 2020 2020  dict):.         
-000018e0: 2020 2020 2020 2020 2020 2066 6f72 6d61             forma
-000018f0: 7465 645f 6e6f 6465 203d 2022 2c22 2e6a  ted_node = ",".j
-00001900: 6f69 6e28 0a20 2020 2020 2020 2020 2020  oin(.           
-00001910: 2020 2020 2020 2020 2020 2020 2073 6f72               sor
-00001920: 7465 6428 6520 666f 7220 6520 696e 2076  ted(e for e in v
-00001930: 616c 7565 5b22 6e6f 7465 225d 2e73 706c  alue["note"].spl
-00001940: 6974 2822 2c22 2920 6966 2022 2220 213d  it(",") if "" !=
-00001950: 2065 290a 2020 2020 2020 2020 2020 2020   e).            
-00001960: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00001970: 2020 2020 2020 2020 2020 2020 2020 6c69                li
-00001980: 7374 5f74 6f5f 7265 7475 726e 2e61 7070  st_to_return.app
-00001990: 656e 6428 6622 7b6b 6579 7d3a 7b76 616c  end(f"{key}:{val
-000019a0: 7565 5b27 736f 7572 6365 275d 7d3b 7b66  ue['source']};{f
-000019b0: 6f72 6d61 7465 645f 6e6f 6465 7d3b 2229  ormated_node};")
-000019c0: 0a0a 2020 2020 2020 2020 656c 6966 2069  ..        elif i
-000019d0: 6e70 7574 5f6b 6579 203d 3d20 2263 6f6c  nput_key == "col
-000019e0: 7265 765f 6461 7461 5f70 726f 7665 6e61  rev_data_provena
-000019f0: 6e63 6522 3a0a 2020 2020 2020 2020 2020  nce":.          
-00001a00: 2020 666f 7220 6b65 792c 2076 616c 7565    for key, value
-00001a10: 2069 6e20 696e 7075 745f 6469 6374 2e69   in input_dict.i
-00001a20: 7465 6d73 2829 3a0a 2020 2020 2020 2020  tems():.        
-00001a30: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-00001a40: 7461 6e63 6528 7661 6c75 652c 2064 6963  tance(value, dic
-00001a50: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
-00001a60: 2020 2020 2020 2020 6c69 7374 5f74 6f5f          list_to_
-00001a70: 7265 7475 726e 2e61 7070 656e 6428 6622  return.append(f"
-00001a80: 7b6b 6579 7d3a 7b76 616c 7565 5b27 736f  {key}:{value['so
-00001a90: 7572 6365 275d 7d3b 7b76 616c 7565 5b27  urce']};{value['
-00001aa0: 6e6f 7465 275d 7d3b 2229 0a0a 2020 2020  note']};")..    
-00001ab0: 2020 2020 7265 7475 726e 206c 6973 745f      return list_
-00001ac0: 746f 5f72 6574 7572 6e0a 0a20 2020 2064  to_return..    d
-00001ad0: 6566 2067 6574 5f64 6174 6128 7365 6c66  ef get_data(self
-00001ae0: 2c20 2a2c 2073 7472 696e 6769 6679 3a20  , *, stringify: 
-00001af0: 626f 6f6c 203d 2046 616c 7365 2920 2d3e  bool = False) ->
-00001b00: 2064 6963 743a 0a20 2020 2020 2020 2022   dict:.        "
-00001b10: 2222 4765 7420 7468 6520 7265 636f 7264  ""Get the record
-00001b20: 2064 6174 6120 286f 7074 696f 6e61 6c6c   data (optionall
-00001b30: 793a 2069 6e20 7374 7269 6e67 6966 6965  y: in stringifie
-00001b40: 6420 7665 7273 696f 6e2c 2069 2e65 2e2c  d version, i.e.,
-00001b50: 2077 6974 686f 7574 206c 6973 7473 2f64   without lists/d
-00001b60: 6963 7473 2922 2222 0a0a 2020 2020 2020  icts)"""..      
-00001b70: 2020 6465 6620 5f5f 6765 745f 7374 7269    def __get_stri
-00001b80: 6e67 6966 6965 645f 7265 636f 7264 2829  ngified_record()
-00001b90: 202d 3e20 6469 6374 3a0a 2020 2020 2020   -> dict:.      
-00001ba0: 2020 2020 2020 6461 7461 5f63 6f70 7920        data_copy 
-00001bb0: 3d20 6465 6570 636f 7079 2873 656c 662e  = deepcopy(self.
-00001bc0: 6461 7461 290a 0a20 2020 2020 2020 2020  data)..         
-00001bd0: 2020 2064 6566 206c 6973 745f 746f 5f73     def list_to_s
-00001be0: 7472 282a 2c20 7661 6c3a 206c 6973 7429  tr(*, val: list)
-00001bf0: 202d 3e20 7374 723a 0a20 2020 2020 2020   -> str:.       
-00001c00: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00001c10: 2822 5c6e 2220 2b20 2220 2220 2a20 3336  ("\n" + " " * 36
-00001c20: 292e 6a6f 696e 285b 662e 7273 7472 6970  ).join([f.rstrip
-00001c30: 2829 2066 6f72 2066 2069 6e20 7661 6c5d  () for f in val]
-00001c40: 290a 0a20 2020 2020 2020 2020 2020 2066  )..            f
-00001c50: 6f72 206b 6579 2069 6e20 7365 6c66 2e6c  or key in self.l
-00001c60: 6973 745f 6669 656c 6473 5f6b 6579 733a  ist_fields_keys:
-00001c70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00001c80: 2069 6620 6b65 7920 696e 2064 6174 615f   if key in data_
-00001c90: 636f 7079 3a0a 2020 2020 2020 2020 2020  copy:.          
-00001ca0: 2020 2020 2020 2020 2020 6966 206b 6579            if key
-00001cb0: 2069 6e20 5b22 636f 6c72 6576 5f6f 7269   in ["colrev_ori
-00001cc0: 6769 6e22 5d3a 0a20 2020 2020 2020 2020  gin"]:.         
-00001cd0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00001ce0: 6174 615f 636f 7079 5b6b 6579 5d20 3d20  ata_copy[key] = 
-00001cf0: 736f 7274 6564 286c 6973 7428 7365 7428  sorted(list(set(
-00001d00: 6461 7461 5f63 6f70 795b 6b65 795d 2929  data_copy[key]))
-00001d10: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00001d20: 2020 2020 2020 666f 7220 696e 642c 2076        for ind, v
-00001d30: 616c 2069 6e20 656e 756d 6572 6174 6528  al in enumerate(
-00001d40: 6461 7461 5f63 6f70 795b 6b65 795d 293a  data_copy[key]):
-00001d50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00001d60: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
-00001d70: 7661 6c29 203e 2030 3a0a 2020 2020 2020  val) > 0:.      
-00001d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001d90: 2020 2020 2020 6966 2076 616c 5b2d 315d        if val[-1]
-00001da0: 2021 3d20 223b 223a 0a20 2020 2020 2020   != ";":.       
-00001db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001dc0: 2020 2020 2020 2020 2064 6174 615f 636f           data_co
-00001dd0: 7079 5b6b 6579 5d5b 696e 645d 203d 2076  py[key][ind] = v
-00001de0: 616c 202b 2022 3b22 0a20 2020 2020 2020  al + ";".       
-00001df0: 2020 2020 2020 2020 2020 2020 2064 6174               dat
-00001e00: 615f 636f 7079 5b6b 6579 5d20 3d20 6c69  a_copy[key] = li
-00001e10: 7374 5f74 6f5f 7374 7228 7661 6c3d 6461  st_to_str(val=da
-00001e20: 7461 5f63 6f70 795b 6b65 795d 290a 0a20  ta_copy[key]).. 
-00001e30: 2020 2020 2020 2020 2020 2066 6f72 206b             for k
-00001e40: 6579 2069 6e20 7365 6c66 2e64 6963 745f  ey in self.dict_
-00001e50: 6669 656c 6473 5f6b 6579 733a 0a20 2020  fields_keys:.   
-00001e60: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00001e70: 6b65 7920 696e 2064 6174 615f 636f 7079  key in data_copy
-00001e80: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00001e90: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-00001ea0: 6e63 6528 6461 7461 5f63 6f70 795b 6b65  nce(data_copy[ke
-00001eb0: 795d 2c20 6469 6374 293a 0a20 2020 2020  y], dict):.     
-00001ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001ed0: 2020 2064 6174 615f 636f 7079 5b6b 6579     data_copy[key
-00001ee0: 5d20 3d20 7365 6c66 2e5f 5f73 6176 655f  ] = self.__save_
-00001ef0: 6669 656c 645f 6469 6374 280a 2020 2020  field_dict(.    
-00001f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001f10: 2020 2020 2020 2020 696e 7075 745f 6469          input_di
-00001f20: 6374 3d64 6174 615f 636f 7079 5b6b 6579  ct=data_copy[key
-00001f30: 5d2c 2069 6e70 7574 5f6b 6579 3d6b 6579  ], input_key=key
-00001f40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00001f50: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00001f60: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00001f70: 6620 6973 696e 7374 616e 6365 2864 6174  f isinstance(dat
-00001f80: 615f 636f 7079 5b6b 6579 5d2c 206c 6973  a_copy[key], lis
-00001f90: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
-00001fa0: 2020 2020 2020 2020 2020 2020 6461 7461              data
-00001fb0: 5f63 6f70 795b 6b65 795d 203d 206c 6973  _copy[key] = lis
-00001fc0: 745f 746f 5f73 7472 2876 616c 3d64 6174  t_to_str(val=dat
-00001fd0: 615f 636f 7079 5b6b 6579 5d29 0a0a 2020  a_copy[key])..  
-00001fe0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00001ff0: 2064 6174 615f 636f 7079 0a0a 2020 2020   data_copy..    
-00002000: 2020 2020 6966 206e 6f74 2069 7369 6e73      if not isins
-00002010: 7461 6e63 6528 7365 6c66 2e64 6174 612e  tance(self.data.
-00002020: 6765 7428 2263 6f6c 7265 765f 6f72 6967  get("colrev_orig
-00002030: 696e 222c 205b 5d29 2c20 6c69 7374 293a  in", []), list):
-00002040: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00002050: 662e 6461 7461 5b22 636f 6c72 6576 5f6f  f.data["colrev_o
-00002060: 7269 6769 6e22 5d20 3d20 280a 2020 2020  rigin"] = (.    
-00002070: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00002080: 2e64 6174 615b 2263 6f6c 7265 765f 6f72  .data["colrev_or
-00002090: 6967 696e 225d 2e72 7374 7269 7028 223b  igin"].rstrip(";
-000020a0: 2229 2e73 706c 6974 2822 3b22 290a 2020  ").split(";").  
-000020b0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-000020c0: 2020 2020 6173 7365 7274 2069 7369 6e73      assert isins
-000020d0: 7461 6e63 6528 7365 6c66 2e64 6174 612e  tance(self.data.
-000020e0: 6765 7428 2263 6f6c 7265 765f 6f72 6967  get("colrev_orig
-000020f0: 696e 222c 205b 5d29 2c20 6c69 7374 290a  in", []), list).
-00002100: 0a20 2020 2020 2020 2069 6620 7374 7269  .        if stri
-00002110: 6e67 6966 793a 0a20 2020 2020 2020 2020  ngify:.         
-00002120: 2020 2072 6574 7572 6e20 5f5f 6765 745f     return __get_
-00002130: 7374 7269 6e67 6966 6965 645f 7265 636f  stringified_reco
-00002140: 7264 2829 0a0a 2020 2020 2020 2020 7265  rd()..        re
-00002150: 7475 726e 2073 656c 662e 6461 7461 0a0a  turn self.data..
-00002160: 2020 2020 6465 6620 6d61 7374 6572 6461      def masterda
-00002170: 7461 5f69 735f 6375 7261 7465 6428 7365  ta_is_curated(se
-00002180: 6c66 2920 2d3e 2062 6f6f 6c3a 0a20 2020  lf) -> bool:.   
-00002190: 2020 2020 2022 2222 4368 6563 6b20 7768       """Check wh
-000021a0: 6574 6865 7220 7468 6520 7265 636f 7264  ether the record
-000021b0: 206d 6173 7465 7264 6174 6120 6973 2063   masterdata is c
-000021c0: 7572 6174 6564 2222 220a 2020 2020 2020  urated""".      
-000021d0: 2020 7265 7475 726e 2022 4355 5241 5445    return "CURATE
-000021e0: 4422 2069 6e20 7365 6c66 2e64 6174 612e  D" in self.data.
-000021f0: 6765 7428 2263 6f6c 7265 765f 6d61 7374  get("colrev_mast
-00002200: 6572 6461 7461 5f70 726f 7665 6e61 6e63  erdata_provenanc
-00002210: 6522 2c20 7b7d 290a 0a20 2020 2064 6566  e", {})..    def
-00002220: 2073 6574 5f73 7461 7475 7328 7365 6c66   set_status(self
-00002230: 2c20 2a2c 2074 6172 6765 745f 7374 6174  , *, target_stat
-00002240: 653a 2052 6563 6f72 6453 7461 7465 2c20  e: RecordState, 
-00002250: 666f 7263 653a 2062 6f6f 6c20 3d20 4661  force: bool = Fa
-00002260: 6c73 6529 202d 3e20 4e6f 6e65 3a0a 2020  lse) -> None:.  
-00002270: 2020 2020 2020 2222 2253 6574 2074 6865        """Set the
-00002280: 2072 6563 6f72 6420 7374 6174 7573 2222   record status""
-00002290: 220a 2020 2020 2020 2020 6966 2052 6563  ".        if Rec
-000022a0: 6f72 6453 7461 7465 2e6d 645f 7072 6570  ordState.md_prep
-000022b0: 6172 6564 203d 3d20 7461 7267 6574 5f73  ared == target_s
-000022c0: 7461 7465 2061 6e64 206e 6f74 2066 6f72  tate and not for
-000022d0: 6365 3a0a 2020 2020 2020 2020 2020 2020  ce:.            
-000022e0: 6966 2073 656c 662e 6861 735f 7175 616c  if self.has_qual
-000022f0: 6974 795f 6465 6665 6374 7328 293a 0a20  ity_defects():. 
-00002300: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-00002310: 6172 6765 745f 7374 6174 6520 3d20 5265  arget_state = Re
-00002320: 636f 7264 5374 6174 652e 6d64 5f6e 6565  cordState.md_nee
-00002330: 6473 5f6d 616e 7561 6c5f 7072 6570 6172  ds_manual_prepar
-00002340: 6174 696f 6e0a 2020 2020 2020 2020 2320  ation.        # 
-00002350: 7079 6c69 6e74 3a20 6469 7361 626c 653d  pylint: disable=
-00002360: 6469 7265 6374 2d73 7461 7475 732d 6173  direct-status-as
-00002370: 7369 676e 0a20 2020 2020 2020 2073 656c  sign.        sel
-00002380: 662e 6461 7461 5b22 636f 6c72 6576 5f73  f.data["colrev_s
-00002390: 7461 7475 7322 5d20 3d20 7461 7267 6574  tatus"] = target
-000023a0: 5f73 7461 7465 0a0a 2020 2020 6465 6620  _state..    def 
-000023b0: 7368 6172 6573 5f6f 7269 6769 6e73 2873  shares_origins(s
-000023c0: 656c 662c 202a 2c20 6f74 6865 725f 7265  elf, *, other_re
-000023d0: 636f 7264 3a20 5265 636f 7264 2920 2d3e  cord: Record) ->
-000023e0: 2062 6f6f 6c3a 0a20 2020 2020 2020 2022   bool:.        "
-000023f0: 2222 4368 6563 6b20 6174 206c 6561 7374  ""Check at least
-00002400: 206f 6e65 206f 7269 6769 6e20 6973 2073   one origin is s
-00002410: 6861 7265 6420 7769 7468 2074 6865 206f  hared with the o
-00002420: 7468 6572 2072 6563 6f72 6422 2222 0a20  ther record""". 
-00002430: 2020 2020 2020 2072 6574 7572 6e20 616e         return an
-00002440: 7928 0a20 2020 2020 2020 2020 2020 2078  y(.            x
-00002450: 2069 6e20 6f74 6865 725f 7265 636f 7264   in other_record
-00002460: 2e64 6174 612e 6765 7428 2263 6f6c 7265  .data.get("colre
-00002470: 765f 6f72 6967 696e 222c 205b 5d29 0a20  v_origin", []). 
-00002480: 2020 2020 2020 2020 2020 2066 6f72 2078             for x
-00002490: 2069 6e20 7365 6c66 2e64 6174 612e 6765   in self.data.ge
-000024a0: 7428 2263 6f6c 7265 765f 6f72 6967 696e  t("colrev_origin
-000024b0: 222c 205b 5d29 0a20 2020 2020 2020 2029  ", []).        )
-000024c0: 0a0a 2020 2020 6465 6620 6765 745f 7661  ..    def get_va
-000024d0: 6c75 6528 7365 6c66 2c20 2a2c 206b 6579  lue(self, *, key
-000024e0: 3a20 7374 722c 2064 6566 6175 6c74 3a20  : str, default: 
-000024f0: 4f70 7469 6f6e 616c 5b73 7472 5d20 3d20  Optional[str] = 
-00002500: 4e6f 6e65 2920 2d3e 2073 7472 3a0a 2020  None) -> str:.  
-00002510: 2020 2020 2020 2222 2247 6574 2061 2072        """Get a r
-00002520: 6563 6f72 6420 7661 6c75 6520 2862 6173  ecord value (bas
-00002530: 6564 206f 6e20 7468 6520 6b65 7920 7061  ed on the key pa
-00002540: 7261 6d65 7465 7229 2222 220a 2020 2020  rameter)""".    
-00002550: 2020 2020 6966 2064 6566 6175 6c74 2069      if default i
-00002560: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-00002570: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-00002580: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-00002590: 203d 2073 656c 662e 6461 7461 5b6b 6579   = self.data[key
-000025a0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-000025b0: 2020 7265 7475 726e 2072 6574 0a20 2020    return ret.   
-000025c0: 2020 2020 2020 2020 2065 7863 6570 7420           except 
-000025d0: 4b65 7945 7272 6f72 3a0a 2020 2020 2020  KeyError:.      
-000025e0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-000025f0: 2064 6566 6175 6c74 0a20 2020 2020 2020   default.       
-00002600: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00002610: 2020 2072 6574 7572 6e20 7365 6c66 2e64     return self.d
-00002620: 6174 615b 6b65 795d 0a0a 2020 2020 6465  ata[key]..    de
-00002630: 6620 6765 745f 636f 6c72 6576 5f69 6428  f get_colrev_id(
-00002640: 7365 6c66 2920 2d3e 206c 6973 743a 0a20  self) -> list:. 
-00002650: 2020 2020 2020 2022 2222 4765 7420 7468         """Get th
-00002660: 6520 636f 6c72 6576 5f69 6420 6f66 2061  e colrev_id of a
-00002670: 2072 6563 6f72 6422 2222 0a20 2020 2020   record""".     
-00002680: 2020 2023 204e 6f74 6520 3a20 646f 206e     # Note : do n
-00002690: 6f74 2061 7574 6f6d 6174 6963 616c 6c79  ot automatically
-000026a0: 2063 7265 6174 6520 636f 6c72 6576 5f69   create colrev_i
-000026b0: 6473 0a20 2020 2020 2020 2023 206f 7220  ds.        # or 
-000026c0: 6174 206c 6561 7374 206b 6565 7020 696e  at least keep in
-000026d0: 206d 696e 6420 7468 6174 2074 6869 7320   mind that this 
-000026e0: 7769 6c6c 206e 6f74 2062 6520 706f 7373  will not be poss
-000026f0: 6962 6c65 2066 6f72 2073 6f6d 6520 7265  ible for some re
-00002700: 636f 7264 730a 2020 2020 2020 2020 636f  cords.        co
-00002710: 6c72 6576 5f69 6420 3d20 5b5d 0a20 2020  lrev_id = [].   
-00002720: 2020 2020 2069 6620 2263 6f6c 7265 765f       if "colrev_
-00002730: 6964 2220 696e 2073 656c 662e 6461 7461  id" in self.data
-00002740: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-00002750: 2069 7369 6e73 7461 6e63 6528 7365 6c66   isinstance(self
-00002760: 2e64 6174 615b 2263 6f6c 7265 765f 6964  .data["colrev_id
-00002770: 225d 2c20 7374 7229 3a0a 2020 2020 2020  "], str):.      
-00002780: 2020 2020 2020 2020 2020 636f 6c72 6576            colrev
-00002790: 5f69 6420 3d20 5b63 6964 2e6c 7374 7269  _id = [cid.lstri
-000027a0: 7028 2920 666f 7220 6369 6420 696e 2073  p() for cid in s
-000027b0: 656c 662e 6461 7461 5b22 636f 6c72 6576  elf.data["colrev
-000027c0: 5f69 6422 5d2e 7370 6c69 7428 223b 2229  _id"].split(";")
-000027d0: 5d0a 2020 2020 2020 2020 2020 2020 656c  ].            el
-000027e0: 6966 2069 7369 6e73 7461 6e63 6528 7365  if isinstance(se
-000027f0: 6c66 2e64 6174 615b 2263 6f6c 7265 765f  lf.data["colrev_
-00002800: 6964 225d 2c20 6c69 7374 293a 0a20 2020  id"], list):.   
-00002810: 2020 2020 2020 2020 2020 2020 2063 6f6c               col
-00002820: 7265 765f 6964 203d 2073 656c 662e 6461  rev_id = self.da
-00002830: 7461 5b22 636f 6c72 6576 5f69 6422 5d0a  ta["colrev_id"].
-00002840: 2020 2020 2020 2020 7265 7475 726e 205b          return [
-00002850: 6320 666f 7220 6320 696e 2063 6f6c 7265  c for c in colre
-00002860: 765f 6964 2069 6620 6c65 6e28 6329 203e  v_id if len(c) >
-00002870: 2032 305d 0a0a 2020 2020 6465 6620 6861   20]..    def ha
-00002880: 735f 6f76 6572 6c61 7070 696e 675f 636f  s_overlapping_co
-00002890: 6c72 6576 5f69 6428 7365 6c66 2c20 2a2c  lrev_id(self, *,
-000028a0: 2072 6563 6f72 643a 2052 6563 6f72 6429   record: Record)
-000028b0: 202d 3e20 626f 6f6c 3a0a 2020 2020 2020   -> bool:.      
-000028c0: 2020 2222 2243 6865 636b 2069 6620 6120    """Check if a 
-000028d0: 7265 636f 7264 2068 6173 2061 6e20 6f76  record has an ov
-000028e0: 6572 6c61 7070 696e 6720 636f 6c72 6576  erlapping colrev
-000028f0: 5f69 6420 7769 7468 2074 6865 206f 7468  _id with the oth
-00002900: 6572 2072 6563 6f72 6422 2222 0a20 2020  er record""".   
-00002910: 2020 2020 206f 776e 5f63 6f6c 7265 765f       own_colrev_
-00002920: 6964 7320 3d20 7365 6c66 2e67 6574 5f63  ids = self.get_c
-00002930: 6f6c 7265 765f 6964 2829 0a20 2020 2020  olrev_id().     
-00002940: 2020 206f 7468 6572 5f63 6f6c 7265 765f     other_colrev_
-00002950: 6964 7320 3d20 7265 636f 7264 2e67 6574  ids = record.get
-00002960: 5f63 6f6c 7265 765f 6964 2829 0a20 2020  _colrev_id().   
-00002970: 2020 2020 2069 6620 6c65 6e28 6f77 6e5f       if len(own_
-00002980: 636f 6c72 6576 5f69 6473 2920 3e20 3020  colrev_ids) > 0 
-00002990: 616e 6420 6c65 6e28 6f74 6865 725f 636f  and len(other_co
-000029a0: 6c72 6576 5f69 6473 2920 3e20 303a 0a20  lrev_ids) > 0:. 
-000029b0: 2020 2020 2020 2020 2020 2069 6620 616e             if an
-000029c0: 7928 6369 6420 696e 206f 776e 5f63 6f6c  y(cid in own_col
-000029d0: 7265 765f 6964 7320 666f 7220 6369 6420  rev_ids for cid 
-000029e0: 696e 206f 7468 6572 5f63 6f6c 7265 765f  in other_colrev_
-000029f0: 6964 7329 3a0a 2020 2020 2020 2020 2020  ids):.          
-00002a00: 2020 2020 2020 7265 7475 726e 2054 7275        return Tru
-00002a10: 650a 2020 2020 2020 2020 7265 7475 726e  e.        return
-00002a20: 2046 616c 7365 0a0a 2020 2020 6465 6620   False..    def 
-00002a30: 7570 6461 7465 5f66 6965 6c64 280a 2020  update_field(.  
-00002a40: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
-00002a50: 2020 2020 2a2c 0a20 2020 2020 2020 206b      *,.        k
-00002a60: 6579 3a20 7374 722c 0a20 2020 2020 2020  ey: str,.       
-00002a70: 2076 616c 7565 3a20 7374 722c 0a20 2020   value: str,.   
-00002a80: 2020 2020 2073 6f75 7263 653a 2073 7472       source: str
-00002a90: 2c0a 2020 2020 2020 2020 6e6f 7465 3a20  ,.        note: 
-00002aa0: 7374 7220 3d20 2222 2c0a 2020 2020 2020  str = "",.      
-00002ab0: 2020 6b65 6570 5f73 6f75 7263 655f 6966    keep_source_if
-00002ac0: 5f65 7175 616c 3a20 626f 6f6c 203d 2054  _equal: bool = T
-00002ad0: 7275 652c 0a20 2020 2020 2020 2061 7070  rue,.        app
-00002ae0: 656e 645f 6564 6974 3a20 626f 6f6c 203d  end_edit: bool =
-00002af0: 2054 7275 652c 0a20 2020 2029 202d 3e20   True,.    ) -> 
-00002b00: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
-00002b10: 2255 7064 6174 6520 6120 7265 636f 7264  "Update a record
-00002b20: 2066 6965 6c64 2028 696e 636c 7564 696e   field (includin
-00002b30: 6720 7072 6f76 656e 616e 6365 2069 6e66  g provenance inf
-00002b40: 6f72 6d61 7469 6f6e 2922 2222 0a20 2020  ormation)""".   
-00002b50: 2020 2020 2069 6620 6b65 6570 5f73 6f75       if keep_sou
-00002b60: 7263 655f 6966 5f65 7175 616c 3a0a 2020  rce_if_equal:.  
-00002b70: 2020 2020 2020 2020 2020 6966 206b 6579            if key
-00002b80: 2069 6e20 7365 6c66 2e64 6174 613a 0a20   in self.data:. 
-00002b90: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00002ba0: 6620 7365 6c66 2e64 6174 615b 6b65 795d  f self.data[key]
-00002bb0: 203d 3d20 7661 6c75 653a 0a20 2020 2020   == value:.     
-00002bc0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00002bd0: 6574 7572 6e0a 0a20 2020 2020 2020 2069  eturn..        i
-00002be0: 6620 6b65 7920 696e 2073 656c 662e 6964  f key in self.id
-00002bf0: 656e 7469 6679 696e 675f 6669 656c 645f  entifying_field_
-00002c00: 6b65 7973 3a0a 2020 2020 2020 2020 2020  keys:.          
-00002c10: 2020 6966 206e 6f74 2073 656c 662e 6d61    if not self.ma
-00002c20: 7374 6572 6461 7461 5f69 735f 6375 7261  sterdata_is_cura
-00002c30: 7465 6428 293a 0a20 2020 2020 2020 2020  ted():.         
-00002c40: 2020 2020 2020 2069 6620 6170 7065 6e64         if append
-00002c50: 5f65 6469 7420 616e 6420 6b65 7920 696e  _edit and key in
-00002c60: 2073 656c 662e 6461 7461 3a0a 2020 2020   self.data:.    
-00002c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002c80: 6966 206b 6579 2069 6e20 7365 6c66 2e64  if key in self.d
-00002c90: 6174 612e 6765 7428 2263 6f6c 7265 765f  ata.get("colrev_
-00002ca0: 6d61 7374 6572 6461 7461 5f70 726f 7665  masterdata_prove
-00002cb0: 6e61 6e63 6522 2c20 7b7d 293a 0a20 2020  nance", {}):.   
-00002cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002cd0: 2020 2020 2073 6f75 7263 6520 3d20 280a       source = (.
-00002ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002cf0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00002d00: 2e64 6174 615b 2263 6f6c 7265 765f 6d61  .data["colrev_ma
-00002d10: 7374 6572 6461 7461 5f70 726f 7665 6e61  sterdata_provena
-00002d20: 6e63 6522 5d5b 6b65 795d 5b22 736f 7572  nce"][key]["sour
-00002d30: 6365 225d 0a20 2020 2020 2020 2020 2020  ce"].           
-00002d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002d50: 202b 2022 7c22 0a20 2020 2020 2020 2020   + "|".         
-00002d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002d70: 2020 202b 2073 6f75 7263 650a 2020 2020     + source.    
-00002d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002d90: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-00002da0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-00002db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002dc0: 2020 2020 2020 2020 736f 7572 6365 203d          source =
-00002dd0: 2022 6f72 6967 696e 616c 7c22 202b 2073   "original|" + s
-00002de0: 6f75 7263 650a 2020 2020 2020 2020 2020  ource.          
-00002df0: 2020 2020 2020 7365 6c66 2e61 6464 5f6d        self.add_m
-00002e00: 6173 7465 7264 6174 615f 7072 6f76 656e  asterdata_proven
-00002e10: 616e 6365 286b 6579 3d6b 6579 2c20 736f  ance(key=key, so
-00002e20: 7572 6365 3d73 6f75 7263 652c 206e 6f74  urce=source, not
-00002e30: 653d 6e6f 7465 290a 2020 2020 2020 2020  e=note).        
-00002e40: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00002e50: 2020 6966 2061 7070 656e 645f 6564 6974    if append_edit
-00002e60: 2061 6e64 206b 6579 2069 6e20 7365 6c66   and key in self
-00002e70: 2e64 6174 613a 0a20 2020 2020 2020 2020  .data:.         
-00002e80: 2020 2020 2020 2069 6620 6b65 7920 696e         if key in
-00002e90: 2073 656c 662e 6461 7461 2e67 6574 2822   self.data.get("
-00002ea0: 636f 6c72 6576 5f64 6174 615f 7072 6f76  colrev_data_prov
-00002eb0: 656e 616e 6365 222c 207b 7d29 3a0a 2020  enance", {}):.  
+000014c0: 6164 6469 7469 6f6e 5f6c 6973 745b 325d  addition_list[2]
+000014d0: 2e61 7070 656e 6428 6164 6469 7469 6f6e  .append(addition
+000014e0: 5f69 7465 6d29 0a20 2020 2020 2020 2020  _item).         
+000014f0: 2020 2020 2020 2020 2020 2069 6620 6164             if ad
+00001500: 6469 7469 6f6e 5f6c 6973 745b 325d 3a0a  dition_list[2]:.
+00001510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001520: 2020 2020 2020 2020 6469 6666 2e61 7070          diff.app
+00001530: 656e 6428 6164 6469 7469 6f6e 5f6c 6973  end(addition_lis
+00001540: 7429 0a20 2020 2020 2020 2020 2020 2020  t).             
+00001550: 2020 2069 6620 7365 6c65 6374 6564 5f74     if selected_t
+00001560: 7570 6c65 5b30 5d20 3d3d 2022 7265 6d6f  uple[0] == "remo
+00001570: 7665 223a 0a20 2020 2020 2020 2020 2020  ve":.           
+00001580: 2020 2020 2020 2020 2072 656d 6f76 616c           removal
+00001590: 5f6c 6973 743a 2074 7970 696e 672e 5475  _list: typing.Tu
+000015a0: 706c 6520 3d20 2822 7265 6d6f 7665 222c  ple = ("remove",
+000015b0: 2022 222c 205b 5d29 0a20 2020 2020 2020   "", []).       
+000015c0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+000015d0: 2072 656d 6f76 616c 5f69 7465 6d20 696e   removal_item in
+000015e0: 2073 656c 6563 7465 645f 7475 706c 655b   selected_tuple[
+000015f0: 325d 3a0a 2020 2020 2020 2020 2020 2020  2]:.            
+00001600: 2020 2020 2020 2020 2020 2020 6966 2072              if r
+00001610: 656d 6f76 616c 5f69 7465 6d5b 305d 2069  emoval_item[0] i
+00001620: 6e20 7365 6c66 2e69 6465 6e74 6966 7969  n self.identifyi
+00001630: 6e67 5f66 6965 6c64 5f6b 6579 733a 0a20  ng_field_keys:. 
+00001640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001650: 2020 2020 2020 2020 2020 2072 656d 6f76             remov
+00001660: 616c 5f6c 6973 745b 325d 2e61 7070 656e  al_list[2].appen
+00001670: 6428 7265 6d6f 7661 6c5f 6974 656d 290a  d(removal_item).
+00001680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001690: 2020 2020 6966 2072 656d 6f76 616c 5f6c      if removal_l
+000016a0: 6973 745b 325d 3a0a 2020 2020 2020 2020  ist[2]:.        
+000016b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000016c0: 6469 6666 2e61 7070 656e 6428 7265 6d6f  diff.append(remo
+000016d0: 7661 6c5f 6c69 7374 290a 2020 2020 2020  val_list).      
+000016e0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+000016f0: 2020 2020 6469 6666 203d 206c 6973 7428      diff = list(
+00001700: 6469 6374 6469 6666 6572 2e64 6966 6628  dictdiffer.diff(
+00001710: 7365 6c66 2e67 6574 5f64 6174 6128 292c  self.get_data(),
+00001720: 206f 7468 6572 5f72 6563 6f72 642e 6765   other_record.ge
+00001730: 745f 6461 7461 2829 2929 0a0a 2020 2020  t_data()))..    
+00001740: 2020 2020 7265 7475 726e 2064 6966 660a      return diff.
+00001750: 0a20 2020 2064 6566 2066 6f72 6d61 745f  .    def format_
+00001760: 6269 625f 7374 796c 6528 7365 6c66 2920  bib_style(self) 
+00001770: 2d3e 2073 7472 3a0a 2020 2020 2020 2020  -> str:.        
+00001780: 2222 2253 696d 706c 6520 666f 726d 6174  """Simple format
+00001790: 7465 7220 666f 7220 6269 626c 696f 6772  ter for bibliogr
+000017a0: 6170 6879 2d73 7479 6c65 206f 7574 7075  aphy-style outpu
+000017b0: 7422 2222 0a20 2020 2020 2020 2062 6962  t""".        bib
+000017c0: 5f66 6f72 6d61 7474 6564 203d 2028 0a20  _formatted = (. 
+000017d0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000017e0: 6461 7461 2e67 6574 2822 6175 7468 6f72  data.get("author
+000017f0: 222c 2022 2229 0a20 2020 2020 2020 2020  ", "").         
+00001800: 2020 202b 2022 2028 220a 2020 2020 2020     + " (".      
+00001810: 2020 2020 2020 2b20 7365 6c66 2e64 6174        + self.dat
+00001820: 612e 6765 7428 2279 6561 7222 2c20 2222  a.get("year", ""
+00001830: 290a 2020 2020 2020 2020 2020 2020 2b20  ).            + 
+00001840: 2229 2022 0a20 2020 2020 2020 2020 2020  ") ".           
+00001850: 202b 2073 656c 662e 6461 7461 2e67 6574   + self.data.get
+00001860: 2822 7469 746c 6522 2c20 2222 290a 2020  ("title", "").  
+00001870: 2020 2020 2020 2020 2020 2b20 222e 2022            + ". "
+00001880: 0a20 2020 2020 2020 2020 2020 202b 2073  .            + s
+00001890: 656c 662e 6461 7461 2e67 6574 2822 6a6f  elf.data.get("jo
+000018a0: 7572 6e61 6c22 2c20 2222 290a 2020 2020  urnal", "").    
+000018b0: 2020 2020 2020 2020 2b20 7365 6c66 2e64          + self.d
+000018c0: 6174 612e 6765 7428 2262 6f6f 6b74 6974  ata.get("booktit
+000018d0: 6c65 222c 2022 2229 0a20 2020 2020 2020  le", "").       
+000018e0: 2020 2020 202b 2022 2c20 2822 0a20 2020       + ", (".   
+000018f0: 2020 2020 2020 2020 202b 2073 656c 662e           + self.
+00001900: 6461 7461 2e67 6574 2822 766f 6c75 6d65  data.get("volume
+00001910: 222c 2022 2229 0a20 2020 2020 2020 2020  ", "").         
+00001920: 2020 202b 2022 2920 220a 2020 2020 2020     + ") ".      
+00001930: 2020 2020 2020 2b20 7365 6c66 2e64 6174        + self.dat
+00001940: 612e 6765 7428 226e 756d 6265 7222 2c20  a.get("number", 
+00001950: 2222 290a 2020 2020 2020 2020 290a 2020  "").        ).  
+00001960: 2020 2020 2020 7265 7475 726e 2062 6962        return bib
+00001970: 5f66 6f72 6d61 7474 6564 0a0a 2020 2020  _formatted..    
+00001980: 6465 6620 5f5f 7361 7665 5f66 6965 6c64  def __save_field
+00001990: 5f64 6963 7428 7365 6c66 2c20 2a2c 2069  _dict(self, *, i
+000019a0: 6e70 7574 5f64 6963 743a 2064 6963 742c  nput_dict: dict,
+000019b0: 2069 6e70 7574 5f6b 6579 3a20 7374 7229   input_key: str)
+000019c0: 202d 3e20 6c69 7374 3a0a 2020 2020 2020   -> list:.      
+000019d0: 2020 6c69 7374 5f74 6f5f 7265 7475 726e    list_to_return
+000019e0: 203d 205b 5d0a 2020 2020 2020 2020 6173   = [].        as
+000019f0: 7365 7274 2069 6e70 7574 5f6b 6579 2069  sert input_key i
+00001a00: 6e20 5b22 636f 6c72 6576 5f6d 6173 7465  n ["colrev_maste
+00001a10: 7264 6174 615f 7072 6f76 656e 616e 6365  rdata_provenance
+00001a20: 222c 2022 636f 6c72 6576 5f64 6174 615f  ", "colrev_data_
+00001a30: 7072 6f76 656e 616e 6365 225d 0a20 2020  provenance"].   
+00001a40: 2020 2020 2069 6620 696e 7075 745f 6b65       if input_ke
+00001a50: 7920 3d3d 2022 636f 6c72 6576 5f6d 6173  y == "colrev_mas
+00001a60: 7465 7264 6174 615f 7072 6f76 656e 616e  terdata_provenan
+00001a70: 6365 223a 0a20 2020 2020 2020 2020 2020  ce":.           
+00001a80: 2066 6f72 206b 6579 2c20 7661 6c75 6520   for key, value 
+00001a90: 696e 2069 6e70 7574 5f64 6963 742e 6974  in input_dict.it
+00001aa0: 656d 7328 293a 0a20 2020 2020 2020 2020  ems():.         
+00001ab0: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
+00001ac0: 616e 6365 2876 616c 7565 2c20 6469 6374  ance(value, dict
+00001ad0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00001ae0: 2020 2020 2020 2066 6f72 6d61 7465 645f         formated_
+00001af0: 6e6f 6465 203d 2022 2c22 2e6a 6f69 6e28  node = ",".join(
+00001b00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00001b10: 2020 2020 2020 2020 2073 6f72 7465 6428           sorted(
+00001b20: 6520 666f 7220 6520 696e 2076 616c 7565  e for e in value
+00001b30: 5b22 6e6f 7465 225d 2e73 706c 6974 2822  ["note"].split("
+00001b40: 2c22 2920 6966 2022 2220 213d 2065 290a  ,") if "" != e).
+00001b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001b60: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+00001b70: 2020 2020 2020 2020 2020 6c69 7374 5f74            list_t
+00001b80: 6f5f 7265 7475 726e 2e61 7070 656e 6428  o_return.append(
+00001b90: 6622 7b6b 6579 7d3a 7b76 616c 7565 5b27  f"{key}:{value['
+00001ba0: 736f 7572 6365 275d 7d3b 7b66 6f72 6d61  source']};{forma
+00001bb0: 7465 645f 6e6f 6465 7d3b 2229 0a0a 2020  ted_node};")..  
+00001bc0: 2020 2020 2020 656c 6966 2069 6e70 7574        elif input
+00001bd0: 5f6b 6579 203d 3d20 2263 6f6c 7265 765f  _key == "colrev_
+00001be0: 6461 7461 5f70 726f 7665 6e61 6e63 6522  data_provenance"
+00001bf0: 3a0a 2020 2020 2020 2020 2020 2020 666f  :.            fo
+00001c00: 7220 6b65 792c 2076 616c 7565 2069 6e20  r key, value in 
+00001c10: 696e 7075 745f 6469 6374 2e69 7465 6d73  input_dict.items
+00001c20: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+00001c30: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+00001c40: 6528 7661 6c75 652c 2064 6963 7429 3a0a  e(value, dict):.
+00001c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001c60: 2020 2020 6c69 7374 5f74 6f5f 7265 7475      list_to_retu
+00001c70: 726e 2e61 7070 656e 6428 6622 7b6b 6579  rn.append(f"{key
+00001c80: 7d3a 7b76 616c 7565 5b27 736f 7572 6365  }:{value['source
+00001c90: 275d 7d3b 7b76 616c 7565 5b27 6e6f 7465  ']};{value['note
+00001ca0: 275d 7d3b 2229 0a0a 2020 2020 2020 2020  ']};")..        
+00001cb0: 7265 7475 726e 206c 6973 745f 746f 5f72  return list_to_r
+00001cc0: 6574 7572 6e0a 0a20 2020 2064 6566 2067  eturn..    def g
+00001cd0: 6574 5f64 6174 6128 7365 6c66 2c20 2a2c  et_data(self, *,
+00001ce0: 2073 7472 696e 6769 6679 3a20 626f 6f6c   stringify: bool
+00001cf0: 203d 2046 616c 7365 2920 2d3e 2064 6963   = False) -> dic
+00001d00: 743a 0a20 2020 2020 2020 2022 2222 4765  t:.        """Ge
+00001d10: 7420 7468 6520 7265 636f 7264 2064 6174  t the record dat
+00001d20: 6120 286f 7074 696f 6e61 6c6c 793a 2069  a (optionally: i
+00001d30: 6e20 7374 7269 6e67 6966 6965 6420 7665  n stringified ve
+00001d40: 7273 696f 6e2c 2069 2e65 2e2c 2077 6974  rsion, i.e., wit
+00001d50: 686f 7574 206c 6973 7473 2f64 6963 7473  hout lists/dicts
+00001d60: 2922 2222 0a0a 2020 2020 2020 2020 6465  )"""..        de
+00001d70: 6620 5f5f 6765 745f 7374 7269 6e67 6966  f __get_stringif
+00001d80: 6965 645f 7265 636f 7264 2829 202d 3e20  ied_record() -> 
+00001d90: 6469 6374 3a0a 2020 2020 2020 2020 2020  dict:.          
+00001da0: 2020 6461 7461 5f63 6f70 7920 3d20 6465    data_copy = de
+00001db0: 6570 636f 7079 2873 656c 662e 6461 7461  epcopy(self.data
+00001dc0: 290a 0a20 2020 2020 2020 2020 2020 2064  )..            d
+00001dd0: 6566 206c 6973 745f 746f 5f73 7472 282a  ef list_to_str(*
+00001de0: 2c20 7661 6c3a 206c 6973 7429 202d 3e20  , val: list) -> 
+00001df0: 7374 723a 0a20 2020 2020 2020 2020 2020  str:.           
+00001e00: 2020 2020 2072 6574 7572 6e20 2822 5c6e       return ("\n
+00001e10: 2220 2b20 2220 2220 2a20 3336 292e 6a6f  " + " " * 36).jo
+00001e20: 696e 285b 662e 7273 7472 6970 2829 2066  in([f.rstrip() f
+00001e30: 6f72 2066 2069 6e20 7661 6c5d 290a 0a20  or f in val]).. 
+00001e40: 2020 2020 2020 2020 2020 2066 6f72 206b             for k
+00001e50: 6579 2069 6e20 7365 6c66 2e6c 6973 745f  ey in self.list_
+00001e60: 6669 656c 6473 5f6b 6579 733a 0a20 2020  fields_keys:.   
+00001e70: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00001e80: 6b65 7920 696e 2064 6174 615f 636f 7079  key in data_copy
+00001e90: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00001ea0: 2020 2020 2020 6966 206b 6579 2069 6e20        if key in 
+00001eb0: 5b22 636f 6c72 6576 5f6f 7269 6769 6e22  ["colrev_origin"
+00001ec0: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
+00001ed0: 2020 2020 2020 2020 2020 2064 6174 615f             data_
+00001ee0: 636f 7079 5b6b 6579 5d20 3d20 736f 7274  copy[key] = sort
+00001ef0: 6564 286c 6973 7428 7365 7428 6461 7461  ed(list(set(data
+00001f00: 5f63 6f70 795b 6b65 795d 2929 290a 2020  _copy[key]))).  
+00001f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001f20: 2020 666f 7220 696e 642c 2076 616c 2069    for ind, val i
+00001f30: 6e20 656e 756d 6572 6174 6528 6461 7461  n enumerate(data
+00001f40: 5f63 6f70 795b 6b65 795d 293a 0a20 2020  _copy[key]):.   
+00001f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001f60: 2020 2020 2069 6620 6c65 6e28 7661 6c29       if len(val)
+00001f70: 203e 2030 3a0a 2020 2020 2020 2020 2020   > 0:.          
+00001f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001f90: 2020 6966 2076 616c 5b2d 315d 2021 3d20    if val[-1] != 
+00001fa0: 223b 223a 0a20 2020 2020 2020 2020 2020  ";":.           
+00001fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00001fc0: 2020 2020 2064 6174 615f 636f 7079 5b6b       data_copy[k
+00001fd0: 6579 5d5b 696e 645d 203d 2076 616c 202b  ey][ind] = val +
+00001fe0: 2022 3b22 0a20 2020 2020 2020 2020 2020   ";".           
+00001ff0: 2020 2020 2020 2020 2064 6174 615f 636f           data_co
+00002000: 7079 5b6b 6579 5d20 3d20 6c69 7374 5f74  py[key] = list_t
+00002010: 6f5f 7374 7228 7661 6c3d 6461 7461 5f63  o_str(val=data_c
+00002020: 6f70 795b 6b65 795d 290a 0a20 2020 2020  opy[key])..     
+00002030: 2020 2020 2020 2066 6f72 206b 6579 2069         for key i
+00002040: 6e20 7365 6c66 2e64 6963 745f 6669 656c  n self.dict_fiel
+00002050: 6473 5f6b 6579 733a 0a20 2020 2020 2020  ds_keys:.       
+00002060: 2020 2020 2020 2020 2069 6620 6b65 7920           if key 
+00002070: 696e 2064 6174 615f 636f 7079 3a0a 2020  in data_copy:.  
+00002080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002090: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+000020a0: 6461 7461 5f63 6f70 795b 6b65 795d 2c20  data_copy[key], 
+000020b0: 6469 6374 293a 0a20 2020 2020 2020 2020  dict):.         
+000020c0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+000020d0: 6174 615f 636f 7079 5b6b 6579 5d20 3d20  ata_copy[key] = 
+000020e0: 7365 6c66 2e5f 5f73 6176 655f 6669 656c  self.__save_fiel
+000020f0: 645f 6469 6374 280a 2020 2020 2020 2020  d_dict(.        
+00002100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002110: 2020 2020 696e 7075 745f 6469 6374 3d64      input_dict=d
+00002120: 6174 615f 636f 7079 5b6b 6579 5d2c 2069  ata_copy[key], i
+00002130: 6e70 7574 5f6b 6579 3d6b 6579 0a20 2020  nput_key=key.   
+00002140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002150: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+00002160: 2020 2020 2020 2020 2020 2069 6620 6973             if is
+00002170: 696e 7374 616e 6365 2864 6174 615f 636f  instance(data_co
+00002180: 7079 5b6b 6579 5d2c 206c 6973 7429 3a0a  py[key], list):.
+00002190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000021a0: 2020 2020 2020 2020 6461 7461 5f63 6f70          data_cop
+000021b0: 795b 6b65 795d 203d 206c 6973 745f 746f  y[key] = list_to
+000021c0: 5f73 7472 2876 616c 3d64 6174 615f 636f  _str(val=data_co
+000021d0: 7079 5b6b 6579 5d29 0a0a 2020 2020 2020  py[key])..      
+000021e0: 2020 2020 2020 7265 7475 726e 2064 6174        return dat
+000021f0: 615f 636f 7079 0a0a 2020 2020 2020 2020  a_copy..        
+00002200: 6966 206e 6f74 2069 7369 6e73 7461 6e63  if not isinstanc
+00002210: 6528 7365 6c66 2e64 6174 612e 6765 7428  e(self.data.get(
+00002220: 2263 6f6c 7265 765f 6f72 6967 696e 222c  "colrev_origin",
+00002230: 205b 5d29 2c20 6c69 7374 293a 0a20 2020   []), list):.   
+00002240: 2020 2020 2020 2020 2073 656c 662e 6461           self.da
+00002250: 7461 5b22 636f 6c72 6576 5f6f 7269 6769  ta["colrev_origi
+00002260: 6e22 5d20 3d20 280a 2020 2020 2020 2020  n"] = (.        
+00002270: 2020 2020 2020 2020 7365 6c66 2e64 6174          self.dat
+00002280: 615b 2263 6f6c 7265 765f 6f72 6967 696e  a["colrev_origin
+00002290: 225d 2e72 7374 7269 7028 223b 2229 2e73  "].rstrip(";").s
+000022a0: 706c 6974 2822 3b22 290a 2020 2020 2020  plit(";").      
+000022b0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+000022c0: 6173 7365 7274 2069 7369 6e73 7461 6e63  assert isinstanc
+000022d0: 6528 7365 6c66 2e64 6174 612e 6765 7428  e(self.data.get(
+000022e0: 2263 6f6c 7265 765f 6f72 6967 696e 222c  "colrev_origin",
+000022f0: 205b 5d29 2c20 6c69 7374 290a 0a20 2020   []), list)..   
+00002300: 2020 2020 2069 6620 7374 7269 6e67 6966       if stringif
+00002310: 793a 0a20 2020 2020 2020 2020 2020 2072  y:.            r
+00002320: 6574 7572 6e20 5f5f 6765 745f 7374 7269  eturn __get_stri
+00002330: 6e67 6966 6965 645f 7265 636f 7264 2829  ngified_record()
+00002340: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00002350: 2073 656c 662e 6461 7461 0a0a 2020 2020   self.data..    
+00002360: 6465 6620 6d61 7374 6572 6461 7461 5f69  def masterdata_i
+00002370: 735f 6375 7261 7465 6428 7365 6c66 2920  s_curated(self) 
+00002380: 2d3e 2062 6f6f 6c3a 0a20 2020 2020 2020  -> bool:.       
+00002390: 2022 2222 4368 6563 6b20 7768 6574 6865   """Check whethe
+000023a0: 7220 7468 6520 7265 636f 7264 206d 6173  r the record mas
+000023b0: 7465 7264 6174 6120 6973 2063 7572 6174  terdata is curat
+000023c0: 6564 2222 220a 2020 2020 2020 2020 7265  ed""".        re
+000023d0: 7475 726e 2022 4355 5241 5445 4422 2069  turn "CURATED" i
+000023e0: 6e20 7365 6c66 2e64 6174 612e 6765 7428  n self.data.get(
+000023f0: 2263 6f6c 7265 765f 6d61 7374 6572 6461  "colrev_masterda
+00002400: 7461 5f70 726f 7665 6e61 6e63 6522 2c20  ta_provenance", 
+00002410: 7b7d 290a 0a20 2020 2064 6566 2073 6574  {})..    def set
+00002420: 5f73 7461 7475 7328 7365 6c66 2c20 2a2c  _status(self, *,
+00002430: 2074 6172 6765 745f 7374 6174 653a 2052   target_state: R
+00002440: 6563 6f72 6453 7461 7465 2c20 666f 7263  ecordState, forc
+00002450: 653a 2062 6f6f 6c20 3d20 4661 6c73 6529  e: bool = False)
+00002460: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+00002470: 2020 2222 2253 6574 2074 6865 2072 6563    """Set the rec
+00002480: 6f72 6420 7374 6174 7573 2222 220a 2020  ord status""".  
+00002490: 2020 2020 2020 6966 2052 6563 6f72 6453        if RecordS
+000024a0: 7461 7465 2e6d 645f 7072 6570 6172 6564  tate.md_prepared
+000024b0: 203d 3d20 7461 7267 6574 5f73 7461 7465   == target_state
+000024c0: 2061 6e64 206e 6f74 2066 6f72 6365 3a0a   and not force:.
+000024d0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+000024e0: 656c 662e 6861 735f 7175 616c 6974 795f  elf.has_quality_
+000024f0: 6465 6665 6374 7328 293a 0a20 2020 2020  defects():.     
+00002500: 2020 2020 2020 2020 2020 2074 6172 6765             targe
+00002510: 745f 7374 6174 6520 3d20 5265 636f 7264  t_state = Record
+00002520: 5374 6174 652e 6d64 5f6e 6565 6473 5f6d  State.md_needs_m
+00002530: 616e 7561 6c5f 7072 6570 6172 6174 696f  anual_preparatio
+00002540: 6e0a 2020 2020 2020 2020 2320 7079 6c69  n.        # pyli
+00002550: 6e74 3a20 6469 7361 626c 653d 6469 7265  nt: disable=dire
+00002560: 6374 2d73 7461 7475 732d 6173 7369 676e  ct-status-assign
+00002570: 0a20 2020 2020 2020 2073 656c 662e 6461  .        self.da
+00002580: 7461 5b22 636f 6c72 6576 5f73 7461 7475  ta["colrev_statu
+00002590: 7322 5d20 3d20 7461 7267 6574 5f73 7461  s"] = target_sta
+000025a0: 7465 0a0a 2020 2020 6465 6620 7368 6172  te..    def shar
+000025b0: 6573 5f6f 7269 6769 6e73 2873 656c 662c  es_origins(self,
+000025c0: 202a 2c20 6f74 6865 725f 7265 636f 7264   *, other_record
+000025d0: 3a20 5265 636f 7264 2920 2d3e 2062 6f6f  : Record) -> boo
+000025e0: 6c3a 0a20 2020 2020 2020 2022 2222 4368  l:.        """Ch
+000025f0: 6563 6b20 6174 206c 6561 7374 206f 6e65  eck at least one
+00002600: 206f 7269 6769 6e20 6973 2073 6861 7265   origin is share
+00002610: 6420 7769 7468 2074 6865 206f 7468 6572  d with the other
+00002620: 2072 6563 6f72 6422 2222 0a20 2020 2020   record""".     
+00002630: 2020 2072 6574 7572 6e20 616e 7928 0a20     return any(. 
+00002640: 2020 2020 2020 2020 2020 2078 2069 6e20             x in 
+00002650: 6f74 6865 725f 7265 636f 7264 2e64 6174  other_record.dat
+00002660: 612e 6765 7428 2263 6f6c 7265 765f 6f72  a.get("colrev_or
+00002670: 6967 696e 222c 205b 5d29 0a20 2020 2020  igin", []).     
+00002680: 2020 2020 2020 2066 6f72 2078 2069 6e20         for x in 
+00002690: 7365 6c66 2e64 6174 612e 6765 7428 2263  self.data.get("c
+000026a0: 6f6c 7265 765f 6f72 6967 696e 222c 205b  olrev_origin", [
+000026b0: 5d29 0a20 2020 2020 2020 2029 0a0a 2020  ]).        )..  
+000026c0: 2020 6465 6620 6765 745f 7661 6c75 6528    def get_value(
+000026d0: 7365 6c66 2c20 2a2c 206b 6579 3a20 7374  self, *, key: st
+000026e0: 722c 2064 6566 6175 6c74 3a20 4f70 7469  r, default: Opti
+000026f0: 6f6e 616c 5b73 7472 5d20 3d20 4e6f 6e65  onal[str] = None
+00002700: 2920 2d3e 2073 7472 3a0a 2020 2020 2020  ) -> str:.      
+00002710: 2020 2222 2247 6574 2061 2072 6563 6f72    """Get a recor
+00002720: 6420 7661 6c75 6520 2862 6173 6564 206f  d value (based o
+00002730: 6e20 7468 6520 6b65 7920 7061 7261 6d65  n the key parame
+00002740: 7465 7229 2222 220a 2020 2020 2020 2020  ter)""".        
+00002750: 6966 2064 6566 6175 6c74 2069 7320 6e6f  if default is no
+00002760: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+00002770: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+00002780: 2020 2020 2020 2020 2072 6574 203d 2073           ret = s
+00002790: 656c 662e 6461 7461 5b6b 6579 5d0a 2020  elf.data[key].  
+000027a0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+000027b0: 7475 726e 2072 6574 0a20 2020 2020 2020  turn ret.       
+000027c0: 2020 2020 2065 7863 6570 7420 4b65 7945       except KeyE
+000027d0: 7272 6f72 3a0a 2020 2020 2020 2020 2020  rror:.          
+000027e0: 2020 2020 2020 7265 7475 726e 2064 6566        return def
+000027f0: 6175 6c74 0a20 2020 2020 2020 2065 6c73  ault.        els
+00002800: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+00002810: 6574 7572 6e20 7365 6c66 2e64 6174 615b  eturn self.data[
+00002820: 6b65 795d 0a0a 2020 2020 6465 6620 6765  key]..    def ge
+00002830: 745f 636f 6c72 6576 5f69 6428 7365 6c66  t_colrev_id(self
+00002840: 2920 2d3e 206c 6973 743a 0a20 2020 2020  ) -> list:.     
+00002850: 2020 2022 2222 4765 7420 7468 6520 636f     """Get the co
+00002860: 6c72 6576 5f69 6420 6f66 2061 2072 6563  lrev_id of a rec
+00002870: 6f72 6422 2222 0a20 2020 2020 2020 2023  ord""".        #
+00002880: 204e 6f74 6520 3a20 646f 206e 6f74 2061   Note : do not a
+00002890: 7574 6f6d 6174 6963 616c 6c79 2063 7265  utomatically cre
+000028a0: 6174 6520 636f 6c72 6576 5f69 6473 0a20  ate colrev_ids. 
+000028b0: 2020 2020 2020 2023 206f 7220 6174 206c         # or at l
+000028c0: 6561 7374 206b 6565 7020 696e 206d 696e  east keep in min
+000028d0: 6420 7468 6174 2074 6869 7320 7769 6c6c  d that this will
+000028e0: 206e 6f74 2062 6520 706f 7373 6962 6c65   not be possible
+000028f0: 2066 6f72 2073 6f6d 6520 7265 636f 7264   for some record
+00002900: 730a 2020 2020 2020 2020 636f 6c72 6576  s.        colrev
+00002910: 5f69 6420 3d20 5b5d 0a20 2020 2020 2020  _id = [].       
+00002920: 2069 6620 2263 6f6c 7265 765f 6964 2220   if "colrev_id" 
+00002930: 696e 2073 656c 662e 6461 7461 3a0a 2020  in self.data:.  
+00002940: 2020 2020 2020 2020 2020 6966 2069 7369            if isi
+00002950: 6e73 7461 6e63 6528 7365 6c66 2e64 6174  nstance(self.dat
+00002960: 615b 2263 6f6c 7265 765f 6964 225d 2c20  a["colrev_id"], 
+00002970: 7374 7229 3a0a 2020 2020 2020 2020 2020  str):.          
+00002980: 2020 2020 2020 636f 6c72 6576 5f69 6420        colrev_id 
+00002990: 3d20 5b63 6964 2e6c 7374 7269 7028 2920  = [cid.lstrip() 
+000029a0: 666f 7220 6369 6420 696e 2073 656c 662e  for cid in self.
+000029b0: 6461 7461 5b22 636f 6c72 6576 5f69 6422  data["colrev_id"
+000029c0: 5d2e 7370 6c69 7428 223b 2229 5d0a 2020  ].split(";")].  
+000029d0: 2020 2020 2020 2020 2020 656c 6966 2069            elif i
+000029e0: 7369 6e73 7461 6e63 6528 7365 6c66 2e64  sinstance(self.d
+000029f0: 6174 615b 2263 6f6c 7265 765f 6964 225d  ata["colrev_id"]
+00002a00: 2c20 6c69 7374 293a 0a20 2020 2020 2020  , list):.       
+00002a10: 2020 2020 2020 2020 2063 6f6c 7265 765f           colrev_
+00002a20: 6964 203d 2073 656c 662e 6461 7461 5b22  id = self.data["
+00002a30: 636f 6c72 6576 5f69 6422 5d0a 2020 2020  colrev_id"].    
+00002a40: 2020 2020 7265 7475 726e 205b 6320 666f      return [c fo
+00002a50: 7220 6320 696e 2063 6f6c 7265 765f 6964  r c in colrev_id
+00002a60: 2069 6620 6c65 6e28 6329 203e 2032 305d   if len(c) > 20]
+00002a70: 0a0a 2020 2020 6465 6620 6861 735f 6f76  ..    def has_ov
+00002a80: 6572 6c61 7070 696e 675f 636f 6c72 6576  erlapping_colrev
+00002a90: 5f69 6428 7365 6c66 2c20 2a2c 2072 6563  _id(self, *, rec
+00002aa0: 6f72 643a 2052 6563 6f72 6429 202d 3e20  ord: Record) -> 
+00002ab0: 626f 6f6c 3a0a 2020 2020 2020 2020 2222  bool:.        ""
+00002ac0: 2243 6865 636b 2069 6620 6120 7265 636f  "Check if a reco
+00002ad0: 7264 2068 6173 2061 6e20 6f76 6572 6c61  rd has an overla
+00002ae0: 7070 696e 6720 636f 6c72 6576 5f69 6420  pping colrev_id 
+00002af0: 7769 7468 2074 6865 206f 7468 6572 2072  with the other r
+00002b00: 6563 6f72 6422 2222 0a20 2020 2020 2020  ecord""".       
+00002b10: 206f 776e 5f63 6f6c 7265 765f 6964 7320   own_colrev_ids 
+00002b20: 3d20 7365 6c66 2e67 6574 5f63 6f6c 7265  = self.get_colre
+00002b30: 765f 6964 2829 0a20 2020 2020 2020 206f  v_id().        o
+00002b40: 7468 6572 5f63 6f6c 7265 765f 6964 7320  ther_colrev_ids 
+00002b50: 3d20 7265 636f 7264 2e67 6574 5f63 6f6c  = record.get_col
+00002b60: 7265 765f 6964 2829 0a20 2020 2020 2020  rev_id().       
+00002b70: 2069 6620 6c65 6e28 6f77 6e5f 636f 6c72   if len(own_colr
+00002b80: 6576 5f69 6473 2920 3e20 3020 616e 6420  ev_ids) > 0 and 
+00002b90: 6c65 6e28 6f74 6865 725f 636f 6c72 6576  len(other_colrev
+00002ba0: 5f69 6473 2920 3e20 303a 0a20 2020 2020  _ids) > 0:.     
+00002bb0: 2020 2020 2020 2069 6620 616e 7928 6369         if any(ci
+00002bc0: 6420 696e 206f 776e 5f63 6f6c 7265 765f  d in own_colrev_
+00002bd0: 6964 7320 666f 7220 6369 6420 696e 206f  ids for cid in o
+00002be0: 7468 6572 5f63 6f6c 7265 765f 6964 7329  ther_colrev_ids)
+00002bf0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00002c00: 2020 7265 7475 726e 2054 7275 650a 2020    return True.  
+00002c10: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+00002c20: 7365 0a0a 2020 2020 6465 6620 7570 6461  se..    def upda
+00002c30: 7465 5f66 6965 6c64 280a 2020 2020 2020  te_field(.      
+00002c40: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
+00002c50: 2a2c 0a20 2020 2020 2020 206b 6579 3a20  *,.        key: 
+00002c60: 7374 722c 0a20 2020 2020 2020 2076 616c  str,.        val
+00002c70: 7565 3a20 7374 722c 0a20 2020 2020 2020  ue: str,.       
+00002c80: 2073 6f75 7263 653a 2073 7472 2c0a 2020   source: str,.  
+00002c90: 2020 2020 2020 6e6f 7465 3a20 7374 7220        note: str 
+00002ca0: 3d20 2222 2c0a 2020 2020 2020 2020 6b65  = "",.        ke
+00002cb0: 6570 5f73 6f75 7263 655f 6966 5f65 7175  ep_source_if_equ
+00002cc0: 616c 3a20 626f 6f6c 203d 2054 7275 652c  al: bool = True,
+00002cd0: 0a20 2020 2020 2020 2061 7070 656e 645f  .        append_
+00002ce0: 6564 6974 3a20 626f 6f6c 203d 2054 7275  edit: bool = Tru
+00002cf0: 652c 0a20 2020 2029 202d 3e20 4e6f 6e65  e,.    ) -> None
+00002d00: 3a0a 2020 2020 2020 2020 2222 2255 7064  :.        """Upd
+00002d10: 6174 6520 6120 7265 636f 7264 2066 6965  ate a record fie
+00002d20: 6c64 2028 696e 636c 7564 696e 6720 7072  ld (including pr
+00002d30: 6f76 656e 616e 6365 2069 6e66 6f72 6d61  ovenance informa
+00002d40: 7469 6f6e 2922 2222 0a20 2020 2020 2020  tion)""".       
+00002d50: 2069 6620 6b65 6570 5f73 6f75 7263 655f   if keep_source_
+00002d60: 6966 5f65 7175 616c 3a0a 2020 2020 2020  if_equal:.      
+00002d70: 2020 2020 2020 6966 206b 6579 2069 6e20        if key in 
+00002d80: 7365 6c66 2e64 6174 613a 0a20 2020 2020  self.data:.     
+00002d90: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+00002da0: 6c66 2e64 6174 615b 6b65 795d 203d 3d20  lf.data[key] == 
+00002db0: 7661 6c75 653a 0a20 2020 2020 2020 2020  value:.         
+00002dc0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00002dd0: 6e0a 0a20 2020 2020 2020 2069 6620 6b65  n..        if ke
+00002de0: 7920 696e 2073 656c 662e 6964 656e 7469  y in self.identi
+00002df0: 6679 696e 675f 6669 656c 645f 6b65 7973  fying_field_keys
+00002e00: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+00002e10: 206e 6f74 2073 656c 662e 6d61 7374 6572   not self.master
+00002e20: 6461 7461 5f69 735f 6375 7261 7465 6428  data_is_curated(
+00002e30: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00002e40: 2020 2069 6620 6170 7065 6e64 5f65 6469     if append_edi
+00002e50: 7420 616e 6420 6b65 7920 696e 2073 656c  t and key in sel
+00002e60: 662e 6461 7461 3a0a 2020 2020 2020 2020  f.data:.        
+00002e70: 2020 2020 2020 2020 2020 2020 6966 206b              if k
+00002e80: 6579 2069 6e20 7365 6c66 2e64 6174 612e  ey in self.data.
+00002e90: 6765 7428 2263 6f6c 7265 765f 6d61 7374  get("colrev_mast
+00002ea0: 6572 6461 7461 5f70 726f 7665 6e61 6e63  erdata_provenanc
+00002eb0: 6522 2c20 7b7d 293a 0a20 2020 2020 2020  e", {}):.       
 00002ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002ed0: 2020 736f 7572 6365 203d 2028 0a20 2020    source = (.   
+00002ed0: 2073 6f75 7263 6520 3d20 280a 2020 2020   source = (.    
 00002ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002ef0: 2020 2020 2073 656c 662e 6461 7461 5b22       self.data["
-00002f00: 636f 6c72 6576 5f64 6174 615f 7072 6f76  colrev_data_prov
-00002f10: 656e 616e 6365 225d 5b6b 6579 5d5b 2273  enance"][key]["s
-00002f20: 6f75 7263 6522 5d0a 2020 2020 2020 2020  ource"].        
-00002f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002f40: 2b20 227c 220a 2020 2020 2020 2020 2020  + "|".          
-00002f50: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
-00002f60: 736f 7572 6365 0a20 2020 2020 2020 2020  source.         
-00002f70: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00002f80: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-00002f90: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00002fa0: 2020 2020 2020 2073 6f75 7263 6520 3d20         source = 
-00002fb0: 226f 7269 6769 6e61 6c7c 2220 2b20 736f  "original|" + so
-00002fc0: 7572 6365 0a20 2020 2020 2020 2020 2020  urce.           
-00002fd0: 2073 656c 662e 6164 645f 6461 7461 5f70   self.add_data_p
-00002fe0: 726f 7665 6e61 6e63 6528 6b65 793d 6b65  rovenance(key=ke
-00002ff0: 792c 2073 6f75 7263 653d 736f 7572 6365  y, source=source
-00003000: 2c20 6e6f 7465 3d6e 6f74 6529 0a20 2020  , note=note).   
-00003010: 2020 2020 2073 656c 662e 6461 7461 5b6b       self.data[k
-00003020: 6579 5d20 3d20 7661 6c75 650a 0a20 2020  ey] = value..   
-00003030: 2064 6566 2072 656e 616d 655f 6669 656c   def rename_fiel
-00003040: 6428 7365 6c66 2c20 2a2c 206b 6579 3a20  d(self, *, key: 
-00003050: 7374 722c 206e 6577 5f6b 6579 3a20 7374  str, new_key: st
-00003060: 7229 202d 3e20 4e6f 6e65 3a0a 2020 2020  r) -> None:.    
-00003070: 2020 2020 2222 2252 656e 616d 6520 6120      """Rename a 
-00003080: 6669 656c 6422 2222 0a20 2020 2020 2020  field""".       
-00003090: 2069 6620 6b65 7920 6e6f 7420 696e 2073   if key not in s
-000030a0: 656c 662e 6461 7461 3a0a 2020 2020 2020  elf.data:.      
-000030b0: 2020 2020 2020 7265 7475 726e 0a20 2020        return.   
-000030c0: 2020 2020 2076 616c 7565 203d 2073 656c       value = sel
-000030d0: 662e 6461 7461 5b6b 6579 5d0a 2020 2020  f.data[key].    
-000030e0: 2020 2020 7365 6c66 2e64 6174 615b 6e65      self.data[ne
-000030f0: 775f 6b65 795d 203d 2076 616c 7565 0a0a  w_key] = value..
-00003100: 2020 2020 2020 2020 6966 206b 6579 2069          if key i
-00003110: 6e20 7365 6c66 2e69 6465 6e74 6966 7969  n self.identifyi
-00003120: 6e67 5f66 6965 6c64 5f6b 6579 733a 0a20  ng_field_keys:. 
-00003130: 2020 2020 2020 2020 2020 2069 6620 2263             if "c
-00003140: 6f6c 7265 765f 6d61 7374 6572 6461 7461  olrev_masterdata
-00003150: 5f70 726f 7665 6e61 6e63 6522 206e 6f74  _provenance" not
-00003160: 2069 6e20 7365 6c66 2e64 6174 613a 0a20   in self.data:. 
-00003170: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00003180: 656c 662e 6461 7461 5b22 636f 6c72 6576  elf.data["colrev
-00003190: 5f6d 6173 7465 7264 6174 615f 7072 6f76  _masterdata_prov
-000031a0: 656e 616e 6365 225d 203d 207b 7d0a 2020  enance"] = {}.  
-000031b0: 2020 2020 2020 2020 2020 6966 206b 6579            if key
-000031c0: 2069 6e20 7365 6c66 2e64 6174 615b 2263   in self.data["c
-000031d0: 6f6c 7265 765f 6d61 7374 6572 6461 7461  olrev_masterdata
-000031e0: 5f70 726f 7665 6e61 6e63 6522 5d3a 0a20  _provenance"]:. 
-000031f0: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-00003200: 616c 7565 5f70 726f 7665 6e61 6e63 6520  alue_provenance 
-00003210: 3d20 7365 6c66 2e64 6174 615b 2263 6f6c  = self.data["col
-00003220: 7265 765f 6d61 7374 6572 6461 7461 5f70  rev_masterdata_p
-00003230: 726f 7665 6e61 6e63 6522 5d5b 6b65 795d  rovenance"][key]
-00003240: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003250: 2069 6620 2273 6f75 7263 6522 2069 6e20   if "source" in 
-00003260: 7661 6c75 655f 7072 6f76 656e 616e 6365  value_provenance
-00003270: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00003280: 2020 2020 2020 7661 6c75 655f 7072 6f76        value_prov
-00003290: 656e 616e 6365 5b22 736f 7572 6365 225d  enance["source"]
-000032a0: 202b 3d20 6622 7c72 656e 616d 652d 6672   += f"|rename-fr
-000032b0: 6f6d 3a7b 6b65 797d 220a 2020 2020 2020  om:{key}".      
-000032c0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-000032d0: 2020 2020 2020 2020 2020 2020 7661 6c75              valu
-000032e0: 655f 7072 6f76 656e 616e 6365 203d 207b  e_provenance = {
-000032f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003300: 2020 2020 2022 736f 7572 6365 223a 2066       "source": f
-00003310: 227c 7265 6e61 6d65 2d66 726f 6d3a 7b6b  "|rename-from:{k
-00003320: 6579 7d22 2c0a 2020 2020 2020 2020 2020  ey}",.          
-00003330: 2020 2020 2020 2020 2020 226e 6f74 6522            "note"
-00003340: 3a20 2222 2c0a 2020 2020 2020 2020 2020  : "",.          
-00003350: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
-00003360: 2020 2020 7365 6c66 2e64 6174 615b 2263      self.data["c
-00003370: 6f6c 7265 765f 6d61 7374 6572 6461 7461  olrev_masterdata
-00003380: 5f70 726f 7665 6e61 6e63 6522 5d5b 6e65  _provenance"][ne
-00003390: 775f 6b65 795d 203d 2076 616c 7565 5f70  w_key] = value_p
-000033a0: 726f 7665 6e61 6e63 650a 2020 2020 2020  rovenance.      
-000033b0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-000033c0: 2020 2020 6966 2022 636f 6c72 6576 5f64      if "colrev_d
-000033d0: 6174 615f 7072 6f76 656e 616e 6365 2220  ata_provenance" 
-000033e0: 6e6f 7420 696e 2073 656c 662e 6461 7461  not in self.data
-000033f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00003400: 2020 7365 6c66 2e64 6174 615b 2263 6f6c    self.data["col
-00003410: 7265 765f 6461 7461 5f70 726f 7665 6e61  rev_data_provena
-00003420: 6e63 6522 5d20 3d20 7b7d 0a20 2020 2020  nce"] = {}.     
-00003430: 2020 2020 2020 2069 6620 6b65 7920 696e         if key in
-00003440: 2073 656c 662e 6461 7461 5b22 636f 6c72   self.data["colr
-00003450: 6576 5f64 6174 615f 7072 6f76 656e 616e  ev_data_provenan
-00003460: 6365 225d 3a0a 2020 2020 2020 2020 2020  ce"]:.          
-00003470: 2020 2020 2020 7661 6c75 655f 7072 6f76        value_prov
-00003480: 656e 616e 6365 203d 2073 656c 662e 6461  enance = self.da
-00003490: 7461 5b22 636f 6c72 6576 5f64 6174 615f  ta["colrev_data_
-000034a0: 7072 6f76 656e 616e 6365 225d 5b6b 6579  provenance"][key
-000034b0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-000034c0: 2020 6966 2022 736f 7572 6365 2220 696e    if "source" in
-000034d0: 2076 616c 7565 5f70 726f 7665 6e61 6e63   value_provenanc
-000034e0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-000034f0: 2020 2020 2020 2076 616c 7565 5f70 726f         value_pro
-00003500: 7665 6e61 6e63 655b 2273 6f75 7263 6522  venance["source"
-00003510: 5d20 2b3d 2066 227c 7265 6e61 6d65 2d66  ] += f"|rename-f
-00003520: 726f 6d3a 7b6b 6579 7d22 0a20 2020 2020  rom:{key}".     
-00003530: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00003540: 2020 2020 2020 2020 2020 2020 2076 616c               val
-00003550: 7565 5f70 726f 7665 6e61 6e63 6520 3d20  ue_provenance = 
-00003560: 7b22 736f 7572 6365 223a 2066 227c 7265  {"source": f"|re
-00003570: 6e61 6d65 2d66 726f 6d3a 7b6b 6579 7d22  name-from:{key}"
-00003580: 2c20 226e 6f74 6522 3a20 2222 7d0a 2020  , "note": ""}.  
-00003590: 2020 2020 2020 2020 2020 7365 6c66 2e64            self.d
-000035a0: 6174 615b 2263 6f6c 7265 765f 6461 7461  ata["colrev_data
-000035b0: 5f70 726f 7665 6e61 6e63 6522 5d5b 6e65  _provenance"][ne
-000035c0: 775f 6b65 795d 203d 2076 616c 7565 5f70  w_key] = value_p
-000035d0: 726f 7665 6e61 6e63 650a 0a20 2020 2020  rovenance..     
-000035e0: 2020 2073 656c 662e 7265 6d6f 7665 5f66     self.remove_f
-000035f0: 6965 6c64 286b 6579 3d6b 6579 290a 0a20  ield(key=key).. 
-00003600: 2020 2064 6566 2063 6861 6e67 655f 656e     def change_en
-00003610: 7472 7974 7970 6528 0a20 2020 2020 2020  trytype(.       
-00003620: 2073 656c 662c 0a20 2020 2020 2020 202a   self,.        *
-00003630: 2c0a 2020 2020 2020 2020 6e65 775f 656e  ,.        new_en
-00003640: 7472 7974 7970 653a 2073 7472 2c0a 2020  trytype: str,.  
-00003650: 2020 2020 2020 716d 3a20 636f 6c72 6576        qm: colrev
-00003660: 2e71 6d2e 7175 616c 6974 795f 6d6f 6465  .qm.quality_mode
-00003670: 6c2e 5175 616c 6974 794d 6f64 656c 2c0a  l.QualityModel,.
-00003680: 2020 2020 2920 2d3e 204e 6f6e 653a 0a20      ) -> None:. 
-00003690: 2020 2020 2020 2022 2222 4368 616e 6765         """Change
-000036a0: 2074 6865 2045 4e54 5259 5459 5045 2222   the ENTRYTYPE""
-000036b0: 220a 2020 2020 2020 2020 666f 7220 7661  ".        for va
-000036c0: 6c75 6520 696e 2073 656c 662e 6461 7461  lue in self.data
-000036d0: 2e67 6574 2822 636f 6c72 6576 5f6d 6173  .get("colrev_mas
-000036e0: 7465 7264 6174 615f 7072 6f76 656e 616e  terdata_provenan
-000036f0: 6365 222c 207b 7d29 2e76 616c 7565 7328  ce", {}).values(
-00003700: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
-00003710: 6620 2269 6e63 6f6e 7369 7374 656e 742d  f "inconsistent-
-00003720: 7769 7468 2d65 6e74 7279 7479 7065 2220  with-entrytype" 
-00003730: 696e 2076 616c 7565 5b22 6e6f 7465 225d  in value["note"]
-00003740: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00003750: 2020 7661 6c75 655b 226e 6f74 6522 5d20    value["note"] 
-00003760: 3d20 2222 0a20 2020 2020 2020 2020 2020  = "".           
-00003770: 2069 6620 226d 6973 7369 6e67 2220 696e   if "missing" in
-00003780: 2076 616c 7565 5b22 6e6f 7465 225d 3a0a   value["note"]:.
-00003790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000037a0: 7661 6c75 655b 226e 6f74 6522 5d20 3d20  value["note"] = 
-000037b0: 2222 0a20 2020 2020 2020 206d 6973 7369  "".        missi
-000037c0: 6e67 5f66 6965 6c64 7320 3d20 5b6b 2066  ng_fields = [k f
-000037d0: 6f72 206b 2c20 7620 696e 2073 656c 662e  or k, v in self.
-000037e0: 6461 7461 2e69 7465 6d73 2829 2069 6620  data.items() if 
-000037f0: 7620 3d3d 2022 554e 4b4e 4f57 4e22 5d0a  v == "UNKNOWN"].
-00003800: 2020 2020 2020 2020 666f 7220 6d69 7373          for miss
-00003810: 696e 675f 6669 656c 6420 696e 206d 6973  ing_field in mis
-00003820: 7369 6e67 5f66 6965 6c64 733a 0a20 2020  sing_fields:.   
-00003830: 2020 2020 2020 2020 2073 656c 662e 7265           self.re
-00003840: 6d6f 7665 5f66 6965 6c64 286b 6579 3d6d  move_field(key=m
-00003850: 6973 7369 6e67 5f66 6965 6c64 290a 0a20  issing_field).. 
-00003860: 2020 2020 2020 2073 656c 662e 6461 7461         self.data
-00003870: 5b22 454e 5452 5954 5950 4522 5d20 3d20  ["ENTRYTYPE"] = 
-00003880: 6e65 775f 656e 7472 7974 7970 650a 2020  new_entrytype.  
-00003890: 2020 2020 2020 6966 206e 6577 5f65 6e74        if new_ent
-000038a0: 7279 7479 7065 2069 6e20 5b22 696e 7072  rytype in ["inpr
-000038b0: 6f63 6565 6469 6e67 7322 2c20 2270 726f  oceedings", "pro
-000038c0: 6365 6564 696e 6773 225d 3a0a 2020 2020  ceedings"]:.    
-000038d0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-000038e0: 6461 7461 2e67 6574 2822 766f 6c75 6d65  data.get("volume
-000038f0: 222c 2022 2229 203d 3d20 2255 4e4b 4e4f  ", "") == "UNKNO
-00003900: 574e 223a 0a20 2020 2020 2020 2020 2020  WN":.           
-00003910: 2020 2020 2073 656c 662e 7265 6d6f 7665       self.remove
-00003920: 5f66 6965 6c64 286b 6579 3d22 766f 6c75  _field(key="volu
-00003930: 6d65 2229 0a20 2020 2020 2020 2020 2020  me").           
-00003940: 2069 6620 7365 6c66 2e64 6174 612e 6765   if self.data.ge
-00003950: 7428 226e 756d 6265 7222 2c20 2222 2920  t("number", "") 
-00003960: 3d3d 2022 554e 4b4e 4f57 4e22 3a0a 2020  == "UNKNOWN":.  
-00003970: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00003980: 6c66 2e72 656d 6f76 655f 6669 656c 6428  lf.remove_field(
-00003990: 6b65 793d 226e 756d 6265 7222 290a 2020  key="number").  
-000039a0: 2020 2020 2020 2020 2020 6966 2022 6a6f            if "jo
-000039b0: 7572 6e61 6c22 2069 6e20 7365 6c66 2e64  urnal" in self.d
-000039c0: 6174 6120 616e 6420 2262 6f6f 6b74 6974  ata and "booktit
-000039d0: 6c65 2220 6e6f 7420 696e 2073 656c 662e  le" not in self.
-000039e0: 6461 7461 3a0a 2020 2020 2020 2020 2020  data:.          
-000039f0: 2020 2020 2020 7365 6c66 2e72 656e 616d        self.renam
-00003a00: 655f 6669 656c 6428 6b65 793d 226a 6f75  e_field(key="jou
-00003a10: 726e 616c 222c 206e 6577 5f6b 6579 3d22  rnal", new_key="
-00003a20: 626f 6f6b 7469 746c 6522 290a 2020 2020  booktitle").    
-00003a30: 2020 2020 656c 6966 206e 6577 5f65 6e74      elif new_ent
-00003a40: 7279 7479 7065 203d 3d20 2261 7274 6963  rytype == "artic
-00003a50: 6c65 223a 0a20 2020 2020 2020 2020 2020  le":.           
-00003a60: 2069 6620 2262 6f6f 6b74 6974 6c65 2220   if "booktitle" 
-00003a70: 696e 2073 656c 662e 6461 7461 3a0a 2020  in self.data:.  
-00003a80: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00003a90: 6c66 2e72 656e 616d 655f 6669 656c 6428  lf.rename_field(
-00003aa0: 6b65 793d 2262 6f6f 6b74 6974 6c65 222c  key="booktitle",
-00003ab0: 206e 6577 5f6b 6579 3d22 6a6f 7572 6e61   new_key="journa
-00003ac0: 6c22 290a 2020 2020 2020 2020 656c 6966  l").        elif
-00003ad0: 206e 6577 5f65 6e74 7279 7479 7065 2069   new_entrytype i
-00003ae0: 6e20 5b0a 2020 2020 2020 2020 2020 2020  n [.            
-00003af0: 2269 6e62 6f6f 6b22 2c0a 2020 2020 2020  "inbook",.      
-00003b00: 2020 2020 2020 2262 6f6f 6b22 2c0a 2020        "book",.  
-00003b10: 2020 2020 2020 2020 2020 2269 6e63 6f6c            "incol
-00003b20: 6c65 6374 696f 6e22 2c0a 2020 2020 2020  lection",.      
-00003b30: 2020 2020 2020 2270 6864 7468 6573 6973        "phdthesis
-00003b40: 222c 0a20 2020 2020 2020 2020 2020 2022  ",.            "
-00003b50: 7468 6573 6973 222c 0a20 2020 2020 2020  thesis",.       
-00003b60: 2020 2020 2022 6d61 7374 6572 7468 6573       "masterthes
-00003b70: 6973 222c 0a20 2020 2020 2020 2020 2020  is",.           
-00003b80: 2022 6261 6368 656c 6f72 7468 6573 6973   "bachelorthesis
-00003b90: 222c 0a20 2020 2020 2020 2020 2020 2022  ",.            "
-00003ba0: 7465 6368 7265 706f 7274 222c 0a20 2020  techreport",.   
-00003bb0: 2020 2020 2020 2020 2022 756e 7075 626c           "unpubl
-00003bc0: 6973 6865 6422 2c0a 2020 2020 2020 2020  ished",.        
-00003bd0: 2020 2020 226d 6973 6322 2c0a 2020 2020      "misc",.    
-00003be0: 2020 2020 2020 2020 2273 6f66 7477 6172          "softwar
-00003bf0: 6522 2c0a 2020 2020 2020 2020 2020 2020  e",.            
-00003c00: 226f 6e6c 696e 6522 2c0a 2020 2020 2020  "online",.      
-00003c10: 2020 5d3a 0a20 2020 2020 2020 2020 2020    ]:.           
-00003c20: 2070 6173 730a 2020 2020 2020 2020 656c   pass.        el
-00003c30: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00003c40: 7261 6973 6520 636f 6c72 6576 5f65 7863  raise colrev_exc
-00003c50: 6570 7469 6f6e 732e 4d69 7373 696e 6752  eptions.MissingR
-00003c60: 6563 6f72 6451 7561 6c69 7479 5275 6c65  ecordQualityRule
-00003c70: 5370 6563 6966 6963 6174 696f 6e28 0a20  Specification(. 
-00003c80: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00003c90: 224e 6f20 454e 5452 5954 5950 4520 7370  "No ENTRYTYPE sp
-00003ca0: 6563 6966 6963 6174 696f 6e20 287b 6e65  ecification ({ne
-00003cb0: 775f 656e 7472 7974 7970 657d 2922 0a20  w_entrytype})". 
-00003cc0: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
-00003cd0: 2020 2020 2020 7365 6c66 2e75 7064 6174        self.updat
-00003ce0: 655f 6d61 7374 6572 6461 7461 5f70 726f  e_masterdata_pro
-00003cf0: 7665 6e61 6e63 6528 716d 3d71 6d29 0a0a  venance(qm=qm)..
-00003d00: 2020 2020 6465 6620 7265 6d6f 7665 5f66      def remove_f
-00003d10: 6965 6c64 280a 2020 2020 2020 2020 7365  ield(.        se
-00003d20: 6c66 2c20 2a2c 206b 6579 3a20 7374 722c  lf, *, key: str,
-00003d30: 206e 6f74 5f6d 6973 7369 6e67 5f6e 6f74   not_missing_not
-00003d40: 653a 2062 6f6f 6c20 3d20 4661 6c73 652c  e: bool = False,
-00003d50: 2073 6f75 7263 653a 2073 7472 203d 2022   source: str = "
-00003d60: 220a 2020 2020 2920 2d3e 204e 6f6e 653a  ".    ) -> None:
-00003d70: 0a20 2020 2020 2020 2022 2222 5265 6d6f  .        """Remo
-00003d80: 7665 2061 2066 6965 6c64 2222 220a 0a20  ve a field""".. 
-00003d90: 2020 2020 2020 2069 6620 6b65 7920 696e         if key in
-00003da0: 2073 656c 662e 6461 7461 3a0a 2020 2020   self.data:.    
-00003db0: 2020 2020 2020 2020 6465 6c20 7365 6c66          del self
-00003dc0: 2e64 6174 615b 6b65 795d 0a0a 2020 2020  .data[key]..    
-00003dd0: 2020 2020 6966 2022 636f 6c72 6576 5f6d      if "colrev_m
-00003de0: 6173 7465 7264 6174 615f 7072 6f76 656e  asterdata_proven
-00003df0: 616e 6365 2220 6e6f 7420 696e 2073 656c  ance" not in sel
-00003e00: 662e 6461 7461 3a0a 2020 2020 2020 2020  f.data:.        
-00003e10: 2020 2020 7365 6c66 2e64 6174 615b 2263      self.data["c
-00003e20: 6f6c 7265 765f 6d61 7374 6572 6461 7461  olrev_masterdata
-00003e30: 5f70 726f 7665 6e61 6e63 6522 5d20 3d20  _provenance"] = 
-00003e40: 7b7d 0a0a 2020 2020 2020 2020 6966 206e  {}..        if n
-00003e50: 6f74 5f6d 6973 7369 6e67 5f6e 6f74 6520  ot_missing_note 
-00003e60: 616e 6420 6b65 7920 696e 2073 656c 662e  and key in self.
-00003e70: 6964 656e 7469 6679 696e 675f 6669 656c  identifying_fiel
-00003e80: 645f 6b65 7973 3a0a 2020 2020 2020 2020  d_keys:.        
-00003e90: 2020 2020 2320 4578 616d 706c 653a 206a      # Example: j
-00003ea0: 6f75 726e 616c 2077 6974 686f 7574 206e  ournal without n
-00003eb0: 756d 6265 720a 2020 2020 2020 2020 2020  umber.          
-00003ec0: 2020 2320 7765 2073 686f 756c 6420 6b65    # we should ke
-00003ed0: 6570 2074 6861 7420 696e 666f 726d 6174  ep that informat
-00003ee0: 696f 6e20 7468 6174 2061 2070 6172 7469  ion that a parti
-00003ef0: 6375 6c61 7220 6d61 7374 6572 6461 7461  cular masterdata
-00003f00: 0a20 2020 2020 2020 2020 2020 2023 2066  .            # f
-00003f10: 6965 6c64 2069 7320 6e6f 7420 7265 7175  ield is not requ
-00003f20: 6972 6564 0a20 2020 2020 2020 2020 2020  ired.           
-00003f30: 2069 6620 6b65 7920 6e6f 7420 696e 2073   if key not in s
-00003f40: 656c 662e 6461 7461 5b22 636f 6c72 6576  elf.data["colrev
-00003f50: 5f6d 6173 7465 7264 6174 615f 7072 6f76  _masterdata_prov
-00003f60: 656e 616e 6365 225d 3a0a 2020 2020 2020  enance"]:.      
-00003f70: 2020 2020 2020 2020 2020 7365 6c66 2e64            self.d
-00003f80: 6174 615b 2263 6f6c 7265 765f 6d61 7374  ata["colrev_mast
-00003f90: 6572 6461 7461 5f70 726f 7665 6e61 6e63  erdata_provenanc
-00003fa0: 6522 5d5b 6b65 795d 203d 207b 7d0a 2020  e"][key] = {}.  
-00003fb0: 2020 2020 2020 2020 2020 7365 6c66 2e64            self.d
-00003fc0: 6174 615b 2263 6f6c 7265 765f 6d61 7374  ata["colrev_mast
-00003fd0: 6572 6461 7461 5f70 726f 7665 6e61 6e63  erdata_provenanc
-00003fe0: 6522 5d5b 6b65 795d 5b22 6e6f 7465 225d  e"][key]["note"]
-00003ff0: 203d 2022 6e6f 742d 6d69 7373 696e 6722   = "not-missing"
-00004000: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00004010: 736f 7572 6365 2021 3d20 2222 3a0a 2020  source != "":.  
-00004020: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00004030: 6c66 2e64 6174 615b 2263 6f6c 7265 765f  lf.data["colrev_
-00004040: 6d61 7374 6572 6461 7461 5f70 726f 7665  masterdata_prove
-00004050: 6e61 6e63 6522 5d5b 6b65 795d 5b22 736f  nance"][key]["so
-00004060: 7572 6365 225d 203d 2073 6f75 7263 650a  urce"] = source.
-00004070: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00004080: 2020 2020 2020 2020 2020 6966 206b 6579            if key
-00004090: 2069 6e20 7365 6c66 2e69 6465 6e74 6966   in self.identif
-000040a0: 7969 6e67 5f66 6965 6c64 5f6b 6579 733a  ying_field_keys:
-000040b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000040c0: 2069 6620 6b65 7920 696e 2073 656c 662e   if key in self.
-000040d0: 6461 7461 2e67 6574 2822 636f 6c72 6576  data.get("colrev
-000040e0: 5f6d 6173 7465 7264 6174 615f 7072 6f76  _masterdata_prov
-000040f0: 656e 616e 6365 222c 207b 7d29 3a0a 2020  enance", {}):.  
-00004100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004110: 2020 6465 6c20 7365 6c66 2e64 6174 615b    del self.data[
-00004120: 2263 6f6c 7265 765f 6d61 7374 6572 6461  "colrev_masterda
-00004130: 7461 5f70 726f 7665 6e61 6e63 6522 5d5b  ta_provenance"][
-00004140: 6b65 795d 0a20 2020 2020 2020 2020 2020  key].           
-00004150: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00004160: 2020 2020 2020 2069 6620 6b65 7920 696e         if key in
-00004170: 2073 656c 662e 6461 7461 2e67 6574 2822   self.data.get("
-00004180: 636f 6c72 6576 5f64 6174 615f 7072 6f76  colrev_data_prov
-00004190: 656e 616e 6365 222c 207b 7d29 3a0a 2020  enance", {}):.  
-000041a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000041b0: 2020 6465 6c20 7365 6c66 2e64 6174 615b    del self.data[
-000041c0: 2263 6f6c 7265 765f 6461 7461 5f70 726f  "colrev_data_pro
-000041d0: 7665 6e61 6e63 6522 5d5b 6b65 795d 0a0a  venance"][key]..
-000041e0: 2020 2020 6465 6620 7365 745f 6d61 7374      def set_mast
-000041f0: 6572 6461 7461 5f63 6f6d 706c 6574 6528  erdata_complete(
-00004200: 0a20 2020 2020 2020 2073 656c 662c 202a  .        self, *
-00004210: 2c20 736f 7572 6365 3a20 7374 722c 206d  , source: str, m
-00004220: 6173 7465 7264 6174 615f 7265 706f 7369  asterdata_reposi
-00004230: 746f 7279 3a20 626f 6f6c 2c20 7265 706c  tory: bool, repl
-00004240: 6163 655f 736f 7572 6365 3a20 626f 6f6c  ace_source: bool
-00004250: 203d 2054 7275 650a 2020 2020 2920 2d3e   = True.    ) ->
-00004260: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
-00004270: 2222 5365 7420 7468 6520 6d61 7374 6572  ""Set the master
-00004280: 6461 7461 2074 6f20 636f 6d70 6c65 7465  data to complete
-00004290: 2222 220a 2020 2020 2020 2020 2320 7079  """.        # py
-000042a0: 6c69 6e74 3a20 6469 7361 626c 653d 746f  lint: disable=to
-000042b0: 6f2d 6d61 6e79 2d62 7261 6e63 6865 730a  o-many-branches.
-000042c0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-000042d0: 6d61 7374 6572 6461 7461 5f69 735f 6375  masterdata_is_cu
-000042e0: 7261 7465 6428 2920 6f72 206d 6173 7465  rated() or maste
-000042f0: 7264 6174 615f 7265 706f 7369 746f 7279  rdata_repository
-00004300: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00004310: 7475 726e 0a0a 2020 2020 2020 2020 6966  turn..        if
-00004320: 2022 636f 6c72 6576 5f6d 6173 7465 7264   "colrev_masterd
-00004330: 6174 615f 7072 6f76 656e 616e 6365 2220  ata_provenance" 
-00004340: 6e6f 7420 696e 2073 656c 662e 6461 7461  not in self.data
-00004350: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-00004360: 6c66 2e64 6174 615b 2263 6f6c 7265 765f  lf.data["colrev_
-00004370: 6d61 7374 6572 6461 7461 5f70 726f 7665  masterdata_prove
-00004380: 6e61 6e63 6522 5d20 3d20 7b7d 0a20 2020  nance"] = {}.   
-00004390: 2020 2020 206d 645f 705f 6469 6374 203d       md_p_dict =
-000043a0: 2073 656c 662e 6461 7461 5b22 636f 6c72   self.data["colr
-000043b0: 6576 5f6d 6173 7465 7264 6174 615f 7072  ev_masterdata_pr
-000043c0: 6f76 656e 616e 6365 225d 0a0a 2020 2020  ovenance"]..    
-000043d0: 2020 2020 666f 7220 6964 656e 7469 6679      for identify
-000043e0: 696e 675f 6669 656c 645f 6b65 7920 696e  ing_field_key in
-000043f0: 2073 656c 662e 6964 656e 7469 6679 696e   self.identifyin
-00004400: 675f 6669 656c 645f 6b65 7973 3a0a 2020  g_field_keys:.  
-00004410: 2020 2020 2020 2020 2020 6966 2069 6465            if ide
-00004420: 6e74 6966 7969 6e67 5f66 6965 6c64 5f6b  ntifying_field_k
-00004430: 6579 2069 6e20 5b22 6175 7468 6f72 222c  ey in ["author",
-00004440: 2022 7469 746c 6522 2c20 2279 6561 7222   "title", "year"
-00004450: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
-00004460: 2020 2063 6f6e 7469 6e75 650a 2020 2020     continue.    
-00004470: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00004480: 6461 7461 2e67 6574 2869 6465 6e74 6966  data.get(identif
-00004490: 7969 6e67 5f66 6965 6c64 5f6b 6579 2c20  ying_field_key, 
-000044a0: 224e 4122 2920 3d3d 2022 554e 4b4e 4f57  "NA") == "UNKNOW
-000044b0: 4e22 3a0a 2020 2020 2020 2020 2020 2020  N":.            
-000044c0: 2020 2020 6465 6c20 7365 6c66 2e64 6174      del self.dat
-000044d0: 615b 6964 656e 7469 6679 696e 675f 6669  a[identifying_fi
-000044e0: 656c 645f 6b65 795d 0a20 2020 2020 2020  eld_key].       
-000044f0: 2020 2020 2069 6620 6964 656e 7469 6679       if identify
-00004500: 696e 675f 6669 656c 645f 6b65 7920 696e  ing_field_key in
-00004510: 206d 645f 705f 6469 6374 3a0a 2020 2020   md_p_dict:.    
-00004520: 2020 2020 2020 2020 2020 2020 6e6f 7465              note
-00004530: 203d 206d 645f 705f 6469 6374 5b69 6465   = md_p_dict[ide
-00004540: 6e74 6966 7969 6e67 5f66 6965 6c64 5f6b  ntifying_field_k
-00004550: 6579 5d5b 226e 6f74 6522 5d0a 2020 2020  ey]["note"].    
-00004560: 2020 2020 2020 2020 2020 2020 6966 2022              if "
-00004570: 6d69 7373 696e 6722 2069 6e20 6e6f 7465  missing" in note
-00004580: 2061 6e64 2022 6e6f 742d 6d69 7373 696e   and "not-missin
-00004590: 6722 206e 6f74 2069 6e20 6e6f 7465 3a0a  g" not in note:.
-000045a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000045b0: 2020 2020 6d64 5f70 5f64 6963 745b 6964      md_p_dict[id
-000045c0: 656e 7469 6679 696e 675f 6669 656c 645f  entifying_field_
-000045d0: 6b65 795d 5b22 6e6f 7465 225d 203d 206e  key]["note"] = n
-000045e0: 6f74 652e 7265 706c 6163 6528 0a20 2020  ote.replace(.   
-000045f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004600: 2020 2020 2022 6d69 7373 696e 6722 2c20       "missing", 
-00004610: 2222 0a20 2020 2020 2020 2020 2020 2020  "".             
-00004620: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-00004630: 2020 6966 2073 656c 662e 6461 7461 5b22    if self.data["
-00004640: 454e 5452 5954 5950 4522 5d20 3d3d 2022  ENTRYTYPE"] == "
-00004650: 6172 7469 636c 6522 3a0a 2020 2020 2020  article":.      
-00004660: 2020 2020 2020 6966 2022 766f 6c75 6d65        if "volume
-00004670: 2220 6e6f 7420 696e 2073 656c 662e 6461  " not in self.da
-00004680: 7461 3a0a 2020 2020 2020 2020 2020 2020  ta:.            
-00004690: 2020 2020 6966 2022 766f 6c75 6d65 2220      if "volume" 
-000046a0: 696e 2073 656c 662e 6461 7461 5b22 636f  in self.data["co
-000046b0: 6c72 6576 5f6d 6173 7465 7264 6174 615f  lrev_masterdata_
-000046c0: 7072 6f76 656e 616e 6365 225d 3a0a 2020  provenance"]:.  
-000046d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000046e0: 2020 7365 6c66 2e64 6174 615b 2263 6f6c    self.data["col
-000046f0: 7265 765f 6d61 7374 6572 6461 7461 5f70  rev_masterdata_p
-00004700: 726f 7665 6e61 6e63 6522 5d5b 2276 6f6c  rovenance"]["vol
-00004710: 756d 6522 5d5b 0a20 2020 2020 2020 2020  ume"][.         
-00004720: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00004730: 6e6f 7465 220a 2020 2020 2020 2020 2020  note".          
-00004740: 2020 2020 2020 2020 2020 5d20 3d20 226e            ] = "n
-00004750: 6f74 2d6d 6973 7369 6e67 220a 2020 2020  ot-missing".    
-00004760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004770: 6966 2072 6570 6c61 6365 5f73 6f75 7263  if replace_sourc
-00004780: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00004790: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000047a0: 6461 7461 5b22 636f 6c72 6576 5f6d 6173  data["colrev_mas
-000047b0: 7465 7264 6174 615f 7072 6f76 656e 616e  terdata_provenan
-000047c0: 6365 225d 5b22 766f 6c75 6d65 225d 5b0a  ce"]["volume"][.
-000047d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000047e0: 2020 2020 2020 2020 2020 2020 2273 6f75              "sou
-000047f0: 7263 6522 0a20 2020 2020 2020 2020 2020  rce".           
-00004800: 2020 2020 2020 2020 2020 2020 205d 203d               ] =
-00004810: 2073 6f75 7263 650a 2020 2020 2020 2020   source.        
-00004820: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00004830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004840: 2020 7365 6c66 2e64 6174 615b 2263 6f6c    self.data["col
-00004850: 7265 765f 6d61 7374 6572 6461 7461 5f70  rev_masterdata_p
-00004860: 726f 7665 6e61 6e63 6522 5d5b 2276 6f6c  rovenance"]["vol
-00004870: 756d 6522 5d20 3d20 7b0a 2020 2020 2020  ume"] = {.      
+00002ef0: 2020 2020 2020 2020 7365 6c66 2e64 6174          self.dat
+00002f00: 615b 2263 6f6c 7265 765f 6d61 7374 6572  a["colrev_master
+00002f10: 6461 7461 5f70 726f 7665 6e61 6e63 6522  data_provenance"
+00002f20: 5d5b 6b65 795d 5b22 736f 7572 6365 225d  ][key]["source"]
+00002f30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00002f40: 2020 2020 2020 2020 2020 2020 202b 2022               + "
+00002f50: 7c22 0a20 2020 2020 2020 2020 2020 2020  |".             
+00002f60: 2020 2020 2020 2020 2020 2020 2020 202b                 +
+00002f70: 2073 6f75 7263 650a 2020 2020 2020 2020   source.        
+00002f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002f90: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00002fa0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00002fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002fc0: 2020 2020 736f 7572 6365 203d 2022 6f72      source = "or
+00002fd0: 6967 696e 616c 7c22 202b 2073 6f75 7263  iginal|" + sourc
+00002fe0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00002ff0: 2020 7365 6c66 2e61 6464 5f6d 6173 7465    self.add_maste
+00003000: 7264 6174 615f 7072 6f76 656e 616e 6365  rdata_provenance
+00003010: 286b 6579 3d6b 6579 2c20 736f 7572 6365  (key=key, source
+00003020: 3d73 6f75 7263 652c 206e 6f74 653d 6e6f  =source, note=no
+00003030: 7465 290a 2020 2020 2020 2020 656c 7365  te).        else
+00003040: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+00003050: 2061 7070 656e 645f 6564 6974 2061 6e64   append_edit and
+00003060: 206b 6579 2069 6e20 7365 6c66 2e64 6174   key in self.dat
+00003070: 613a 0a20 2020 2020 2020 2020 2020 2020  a:.             
+00003080: 2020 2069 6620 6b65 7920 696e 2073 656c     if key in sel
+00003090: 662e 6461 7461 2e67 6574 2822 636f 6c72  f.data.get("colr
+000030a0: 6576 5f64 6174 615f 7072 6f76 656e 616e  ev_data_provenan
+000030b0: 6365 222c 207b 7d29 3a0a 2020 2020 2020  ce", {}):.      
+000030c0: 2020 2020 2020 2020 2020 2020 2020 736f                so
+000030d0: 7572 6365 203d 2028 0a20 2020 2020 2020  urce = (.       
+000030e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000030f0: 2073 656c 662e 6461 7461 5b22 636f 6c72   self.data["colr
+00003100: 6576 5f64 6174 615f 7072 6f76 656e 616e  ev_data_provenan
+00003110: 6365 225d 5b6b 6579 5d5b 2273 6f75 7263  ce"][key]["sourc
+00003120: 6522 5d0a 2020 2020 2020 2020 2020 2020  e"].            
+00003130: 2020 2020 2020 2020 2020 2020 2b20 227c              + "|
+00003140: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00003150: 2020 2020 2020 2020 2020 2b20 736f 7572            + sour
+00003160: 6365 0a20 2020 2020 2020 2020 2020 2020  ce.             
+00003170: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00003180: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00003190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000031a0: 2020 2073 6f75 7263 6520 3d20 226f 7269     source = "ori
+000031b0: 6769 6e61 6c7c 2220 2b20 736f 7572 6365  ginal|" + source
+000031c0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+000031d0: 662e 6164 645f 6461 7461 5f70 726f 7665  f.add_data_prove
+000031e0: 6e61 6e63 6528 6b65 793d 6b65 792c 2073  nance(key=key, s
+000031f0: 6f75 7263 653d 736f 7572 6365 2c20 6e6f  ource=source, no
+00003200: 7465 3d6e 6f74 6529 0a20 2020 2020 2020  te=note).       
+00003210: 2073 656c 662e 6461 7461 5b6b 6579 5d20   self.data[key] 
+00003220: 3d20 7661 6c75 650a 0a20 2020 2064 6566  = value..    def
+00003230: 2072 656e 616d 655f 6669 656c 6428 7365   rename_field(se
+00003240: 6c66 2c20 2a2c 206b 6579 3a20 7374 722c  lf, *, key: str,
+00003250: 206e 6577 5f6b 6579 3a20 7374 7229 202d   new_key: str) -
+00003260: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+00003270: 2222 2252 656e 616d 6520 6120 6669 656c  """Rename a fiel
+00003280: 6422 2222 0a20 2020 2020 2020 2069 6620  d""".        if 
+00003290: 6b65 7920 6e6f 7420 696e 2073 656c 662e  key not in self.
+000032a0: 6461 7461 3a0a 2020 2020 2020 2020 2020  data:.          
+000032b0: 2020 7265 7475 726e 0a20 2020 2020 2020    return.       
+000032c0: 2076 616c 7565 203d 2073 656c 662e 6461   value = self.da
+000032d0: 7461 5b6b 6579 5d0a 2020 2020 2020 2020  ta[key].        
+000032e0: 7365 6c66 2e64 6174 615b 6e65 775f 6b65  self.data[new_ke
+000032f0: 795d 203d 2076 616c 7565 0a0a 2020 2020  y] = value..    
+00003300: 2020 2020 6966 206b 6579 2069 6e20 7365      if key in se
+00003310: 6c66 2e69 6465 6e74 6966 7969 6e67 5f66  lf.identifying_f
+00003320: 6965 6c64 5f6b 6579 733a 0a20 2020 2020  ield_keys:.     
+00003330: 2020 2020 2020 2069 6620 2263 6f6c 7265         if "colre
+00003340: 765f 6d61 7374 6572 6461 7461 5f70 726f  v_masterdata_pro
+00003350: 7665 6e61 6e63 6522 206e 6f74 2069 6e20  venance" not in 
+00003360: 7365 6c66 2e64 6174 613a 0a20 2020 2020  self.data:.     
+00003370: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00003380: 6461 7461 5b22 636f 6c72 6576 5f6d 6173  data["colrev_mas
+00003390: 7465 7264 6174 615f 7072 6f76 656e 616e  terdata_provenan
+000033a0: 6365 225d 203d 207b 7d0a 2020 2020 2020  ce"] = {}.      
+000033b0: 2020 2020 2020 6966 206b 6579 2069 6e20        if key in 
+000033c0: 7365 6c66 2e64 6174 615b 2263 6f6c 7265  self.data["colre
+000033d0: 765f 6d61 7374 6572 6461 7461 5f70 726f  v_masterdata_pro
+000033e0: 7665 6e61 6e63 6522 5d3a 0a20 2020 2020  venance"]:.     
+000033f0: 2020 2020 2020 2020 2020 2076 616c 7565             value
+00003400: 5f70 726f 7665 6e61 6e63 6520 3d20 7365  _provenance = se
+00003410: 6c66 2e64 6174 615b 2263 6f6c 7265 765f  lf.data["colrev_
+00003420: 6d61 7374 6572 6461 7461 5f70 726f 7665  masterdata_prove
+00003430: 6e61 6e63 6522 5d5b 6b65 795d 0a20 2020  nance"][key].   
+00003440: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00003450: 2273 6f75 7263 6522 2069 6e20 7661 6c75  "source" in valu
+00003460: 655f 7072 6f76 656e 616e 6365 3a0a 2020  e_provenance:.  
+00003470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003480: 2020 7661 6c75 655f 7072 6f76 656e 616e    value_provenan
+00003490: 6365 5b22 736f 7572 6365 225d 202b 3d20  ce["source"] += 
+000034a0: 6622 7c72 656e 616d 652d 6672 6f6d 3a7b  f"|rename-from:{
+000034b0: 6b65 797d 220a 2020 2020 2020 2020 2020  key}".          
+000034c0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+000034d0: 2020 2020 2020 2020 7661 6c75 655f 7072          value_pr
+000034e0: 6f76 656e 616e 6365 203d 207b 0a20 2020  ovenance = {.   
+000034f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003500: 2022 736f 7572 6365 223a 2066 227c 7265   "source": f"|re
+00003510: 6e61 6d65 2d66 726f 6d3a 7b6b 6579 7d22  name-from:{key}"
+00003520: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00003530: 2020 2020 2020 226e 6f74 6522 3a20 2222        "note": ""
+00003540: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00003550: 2020 7d0a 2020 2020 2020 2020 2020 2020    }.            
+00003560: 7365 6c66 2e64 6174 615b 2263 6f6c 7265  self.data["colre
+00003570: 765f 6d61 7374 6572 6461 7461 5f70 726f  v_masterdata_pro
+00003580: 7665 6e61 6e63 6522 5d5b 6e65 775f 6b65  venance"][new_ke
+00003590: 795d 203d 2076 616c 7565 5f70 726f 7665  y] = value_prove
+000035a0: 6e61 6e63 650a 2020 2020 2020 2020 656c  nance.        el
+000035b0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+000035c0: 6966 2022 636f 6c72 6576 5f64 6174 615f  if "colrev_data_
+000035d0: 7072 6f76 656e 616e 6365 2220 6e6f 7420  provenance" not 
+000035e0: 696e 2073 656c 662e 6461 7461 3a0a 2020  in self.data:.  
+000035f0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00003600: 6c66 2e64 6174 615b 2263 6f6c 7265 765f  lf.data["colrev_
+00003610: 6461 7461 5f70 726f 7665 6e61 6e63 6522  data_provenance"
+00003620: 5d20 3d20 7b7d 0a20 2020 2020 2020 2020  ] = {}.         
+00003630: 2020 2069 6620 6b65 7920 696e 2073 656c     if key in sel
+00003640: 662e 6461 7461 5b22 636f 6c72 6576 5f64  f.data["colrev_d
+00003650: 6174 615f 7072 6f76 656e 616e 6365 225d  ata_provenance"]
+00003660: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00003670: 2020 7661 6c75 655f 7072 6f76 656e 616e    value_provenan
+00003680: 6365 203d 2073 656c 662e 6461 7461 5b22  ce = self.data["
+00003690: 636f 6c72 6576 5f64 6174 615f 7072 6f76  colrev_data_prov
+000036a0: 656e 616e 6365 225d 5b6b 6579 5d0a 2020  enance"][key].  
+000036b0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+000036c0: 2022 736f 7572 6365 2220 696e 2076 616c   "source" in val
+000036d0: 7565 5f70 726f 7665 6e61 6e63 653a 0a20  ue_provenance:. 
+000036e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000036f0: 2020 2076 616c 7565 5f70 726f 7665 6e61     value_provena
+00003700: 6e63 655b 2273 6f75 7263 6522 5d20 2b3d  nce["source"] +=
+00003710: 2066 227c 7265 6e61 6d65 2d66 726f 6d3a   f"|rename-from:
+00003720: 7b6b 6579 7d22 0a20 2020 2020 2020 2020  {key}".         
+00003730: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00003740: 2020 2020 2020 2020 2076 616c 7565 5f70           value_p
+00003750: 726f 7665 6e61 6e63 6520 3d20 7b22 736f  rovenance = {"so
+00003760: 7572 6365 223a 2066 227c 7265 6e61 6d65  urce": f"|rename
+00003770: 2d66 726f 6d3a 7b6b 6579 7d22 2c20 226e  -from:{key}", "n
+00003780: 6f74 6522 3a20 2222 7d0a 2020 2020 2020  ote": ""}.      
+00003790: 2020 2020 2020 7365 6c66 2e64 6174 615b        self.data[
+000037a0: 2263 6f6c 7265 765f 6461 7461 5f70 726f  "colrev_data_pro
+000037b0: 7665 6e61 6e63 6522 5d5b 6e65 775f 6b65  venance"][new_ke
+000037c0: 795d 203d 2076 616c 7565 5f70 726f 7665  y] = value_prove
+000037d0: 6e61 6e63 650a 0a20 2020 2020 2020 2073  nance..        s
+000037e0: 656c 662e 7265 6d6f 7665 5f66 6965 6c64  elf.remove_field
+000037f0: 286b 6579 3d6b 6579 290a 0a20 2020 2064  (key=key)..    d
+00003800: 6566 2063 6861 6e67 655f 656e 7472 7974  ef change_entryt
+00003810: 7970 6528 0a20 2020 2020 2020 2073 656c  ype(.        sel
+00003820: 662c 0a20 2020 2020 2020 202a 2c0a 2020  f,.        *,.  
+00003830: 2020 2020 2020 6e65 775f 656e 7472 7974        new_entryt
+00003840: 7970 653a 2073 7472 2c0a 2020 2020 2020  ype: str,.      
+00003850: 2020 716d 3a20 636f 6c72 6576 2e71 6d2e    qm: colrev.qm.
+00003860: 7175 616c 6974 795f 6d6f 6465 6c2e 5175  quality_model.Qu
+00003870: 616c 6974 794d 6f64 656c 2c0a 2020 2020  alityModel,.    
+00003880: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+00003890: 2020 2022 2222 4368 616e 6765 2074 6865     """Change the
+000038a0: 2045 4e54 5259 5459 5045 2222 220a 2020   ENTRYTYPE""".  
+000038b0: 2020 2020 2020 666f 7220 7661 6c75 6520        for value 
+000038c0: 696e 2073 656c 662e 6461 7461 2e67 6574  in self.data.get
+000038d0: 2822 636f 6c72 6576 5f6d 6173 7465 7264  ("colrev_masterd
+000038e0: 6174 615f 7072 6f76 656e 616e 6365 222c  ata_provenance",
+000038f0: 207b 7d29 2e76 616c 7565 7328 293a 0a20   {}).values():. 
+00003900: 2020 2020 2020 2020 2020 2069 6620 2269             if "i
+00003910: 6e63 6f6e 7369 7374 656e 742d 7769 7468  nconsistent-with
+00003920: 2d65 6e74 7279 7479 7065 2220 696e 2076  -entrytype" in v
+00003930: 616c 7565 5b22 6e6f 7465 225d 3a0a 2020  alue["note"]:.  
+00003940: 2020 2020 2020 2020 2020 2020 2020 7661                va
+00003950: 6c75 655b 226e 6f74 6522 5d20 3d20 2222  lue["note"] = ""
+00003960: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00003970: 226d 6973 7369 6e67 2220 696e 2076 616c  "missing" in val
+00003980: 7565 5b22 6e6f 7465 225d 3a0a 2020 2020  ue["note"]:.    
+00003990: 2020 2020 2020 2020 2020 2020 7661 6c75              valu
+000039a0: 655b 226e 6f74 6522 5d20 3d20 2222 0a20  e["note"] = "". 
+000039b0: 2020 2020 2020 206d 6973 7369 6e67 5f66         missing_f
+000039c0: 6965 6c64 7320 3d20 5b6b 2066 6f72 206b  ields = [k for k
+000039d0: 2c20 7620 696e 2073 656c 662e 6461 7461  , v in self.data
+000039e0: 2e69 7465 6d73 2829 2069 6620 7620 3d3d  .items() if v ==
+000039f0: 2022 554e 4b4e 4f57 4e22 5d0a 2020 2020   "UNKNOWN"].    
+00003a00: 2020 2020 666f 7220 6d69 7373 696e 675f      for missing_
+00003a10: 6669 656c 6420 696e 206d 6973 7369 6e67  field in missing
+00003a20: 5f66 6965 6c64 733a 0a20 2020 2020 2020  _fields:.       
+00003a30: 2020 2020 2073 656c 662e 7265 6d6f 7665       self.remove
+00003a40: 5f66 6965 6c64 286b 6579 3d6d 6973 7369  _field(key=missi
+00003a50: 6e67 5f66 6965 6c64 290a 0a20 2020 2020  ng_field)..     
+00003a60: 2020 2073 656c 662e 6461 7461 5b22 454e     self.data["EN
+00003a70: 5452 5954 5950 4522 5d20 3d20 6e65 775f  TRYTYPE"] = new_
+00003a80: 656e 7472 7974 7970 650a 2020 2020 2020  entrytype.      
+00003a90: 2020 6966 206e 6577 5f65 6e74 7279 7479    if new_entryty
+00003aa0: 7065 2069 6e20 5b22 696e 7072 6f63 6565  pe in ["inprocee
+00003ab0: 6469 6e67 7322 2c20 2270 726f 6365 6564  dings", "proceed
+00003ac0: 696e 6773 225d 3a0a 2020 2020 2020 2020  ings"]:.        
+00003ad0: 2020 2020 6966 2073 656c 662e 6461 7461      if self.data
+00003ae0: 2e67 6574 2822 766f 6c75 6d65 222c 2022  .get("volume", "
+00003af0: 2229 203d 3d20 2255 4e4b 4e4f 574e 223a  ") == "UNKNOWN":
+00003b00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00003b10: 2073 656c 662e 7265 6d6f 7665 5f66 6965   self.remove_fie
+00003b20: 6c64 286b 6579 3d22 766f 6c75 6d65 2229  ld(key="volume")
+00003b30: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00003b40: 7365 6c66 2e64 6174 612e 6765 7428 226e  self.data.get("n
+00003b50: 756d 6265 7222 2c20 2222 2920 3d3d 2022  umber", "") == "
+00003b60: 554e 4b4e 4f57 4e22 3a0a 2020 2020 2020  UNKNOWN":.      
+00003b70: 2020 2020 2020 2020 2020 7365 6c66 2e72            self.r
+00003b80: 656d 6f76 655f 6669 656c 6428 6b65 793d  emove_field(key=
+00003b90: 226e 756d 6265 7222 290a 2020 2020 2020  "number").      
+00003ba0: 2020 2020 2020 6966 2022 6a6f 7572 6e61        if "journa
+00003bb0: 6c22 2069 6e20 7365 6c66 2e64 6174 6120  l" in self.data 
+00003bc0: 616e 6420 2262 6f6f 6b74 6974 6c65 2220  and "booktitle" 
+00003bd0: 6e6f 7420 696e 2073 656c 662e 6461 7461  not in self.data
+00003be0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00003bf0: 2020 7365 6c66 2e72 656e 616d 655f 6669    self.rename_fi
+00003c00: 656c 6428 6b65 793d 226a 6f75 726e 616c  eld(key="journal
+00003c10: 222c 206e 6577 5f6b 6579 3d22 626f 6f6b  ", new_key="book
+00003c20: 7469 746c 6522 290a 2020 2020 2020 2020  title").        
+00003c30: 656c 6966 206e 6577 5f65 6e74 7279 7479  elif new_entryty
+00003c40: 7065 203d 3d20 2261 7274 6963 6c65 223a  pe == "article":
+00003c50: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00003c60: 2262 6f6f 6b74 6974 6c65 2220 696e 2073  "booktitle" in s
+00003c70: 656c 662e 6461 7461 3a0a 2020 2020 2020  elf.data:.      
+00003c80: 2020 2020 2020 2020 2020 7365 6c66 2e72            self.r
+00003c90: 656e 616d 655f 6669 656c 6428 6b65 793d  ename_field(key=
+00003ca0: 2262 6f6f 6b74 6974 6c65 222c 206e 6577  "booktitle", new
+00003cb0: 5f6b 6579 3d22 6a6f 7572 6e61 6c22 290a  _key="journal").
+00003cc0: 2020 2020 2020 2020 656c 6966 206e 6577          elif new
+00003cd0: 5f65 6e74 7279 7479 7065 2069 6e20 5b0a  _entrytype in [.
+00003ce0: 2020 2020 2020 2020 2020 2020 2269 6e62              "inb
+00003cf0: 6f6f 6b22 2c0a 2020 2020 2020 2020 2020  ook",.          
+00003d00: 2020 2262 6f6f 6b22 2c0a 2020 2020 2020    "book",.      
+00003d10: 2020 2020 2020 2269 6e63 6f6c 6c65 6374        "incollect
+00003d20: 696f 6e22 2c0a 2020 2020 2020 2020 2020  ion",.          
+00003d30: 2020 2270 6864 7468 6573 6973 222c 0a20    "phdthesis",. 
+00003d40: 2020 2020 2020 2020 2020 2022 7468 6573             "thes
+00003d50: 6973 222c 0a20 2020 2020 2020 2020 2020  is",.           
+00003d60: 2022 6d61 7374 6572 7468 6573 6973 222c   "masterthesis",
+00003d70: 0a20 2020 2020 2020 2020 2020 2022 6261  .            "ba
+00003d80: 6368 656c 6f72 7468 6573 6973 222c 0a20  chelorthesis",. 
+00003d90: 2020 2020 2020 2020 2020 2022 7465 6368             "tech
+00003da0: 7265 706f 7274 222c 0a20 2020 2020 2020  report",.       
+00003db0: 2020 2020 2022 756e 7075 626c 6973 6865       "unpublishe
+00003dc0: 6422 2c0a 2020 2020 2020 2020 2020 2020  d",.            
+00003dd0: 226d 6973 6322 2c0a 2020 2020 2020 2020  "misc",.        
+00003de0: 2020 2020 2273 6f66 7477 6172 6522 2c0a      "software",.
+00003df0: 2020 2020 2020 2020 2020 2020 226f 6e6c              "onl
+00003e00: 696e 6522 2c0a 2020 2020 2020 2020 5d3a  ine",.        ]:
+00003e10: 0a20 2020 2020 2020 2020 2020 2070 6173  .            pas
+00003e20: 730a 2020 2020 2020 2020 656c 7365 3a0a  s.        else:.
+00003e30: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00003e40: 6520 636f 6c72 6576 5f65 7863 6570 7469  e colrev_excepti
+00003e50: 6f6e 732e 4d69 7373 696e 6752 6563 6f72  ons.MissingRecor
+00003e60: 6451 7561 6c69 7479 5275 6c65 5370 6563  dQualityRuleSpec
+00003e70: 6966 6963 6174 696f 6e28 0a20 2020 2020  ification(.     
+00003e80: 2020 2020 2020 2020 2020 2066 224e 6f20             f"No 
+00003e90: 454e 5452 5954 5950 4520 7370 6563 6966  ENTRYTYPE specif
+00003ea0: 6963 6174 696f 6e20 287b 6e65 775f 656e  ication ({new_en
+00003eb0: 7472 7974 7970 657d 2922 0a20 2020 2020  trytype})".     
+00003ec0: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+00003ed0: 2020 7365 6c66 2e75 7064 6174 655f 6d61    self.update_ma
+00003ee0: 7374 6572 6461 7461 5f70 726f 7665 6e61  sterdata_provena
+00003ef0: 6e63 6528 716d 3d71 6d29 0a0a 2020 2020  nce(qm=qm)..    
+00003f00: 6465 6620 7265 6d6f 7665 5f66 6965 6c64  def remove_field
+00003f10: 280a 2020 2020 2020 2020 7365 6c66 2c20  (.        self, 
+00003f20: 2a2c 206b 6579 3a20 7374 722c 206e 6f74  *, key: str, not
+00003f30: 5f6d 6973 7369 6e67 5f6e 6f74 653a 2062  _missing_note: b
+00003f40: 6f6f 6c20 3d20 4661 6c73 652c 2073 6f75  ool = False, sou
+00003f50: 7263 653a 2073 7472 203d 2022 220a 2020  rce: str = "".  
+00003f60: 2020 2920 2d3e 204e 6f6e 653a 0a20 2020    ) -> None:.   
+00003f70: 2020 2020 2022 2222 5265 6d6f 7665 2061       """Remove a
+00003f80: 2066 6965 6c64 2222 220a 0a20 2020 2020   field"""..     
+00003f90: 2020 2069 6620 6b65 7920 696e 2073 656c     if key in sel
+00003fa0: 662e 6461 7461 3a0a 2020 2020 2020 2020  f.data:.        
+00003fb0: 2020 2020 6465 6c20 7365 6c66 2e64 6174      del self.dat
+00003fc0: 615b 6b65 795d 0a0a 2020 2020 2020 2020  a[key]..        
+00003fd0: 6966 2022 636f 6c72 6576 5f6d 6173 7465  if "colrev_maste
+00003fe0: 7264 6174 615f 7072 6f76 656e 616e 6365  rdata_provenance
+00003ff0: 2220 6e6f 7420 696e 2073 656c 662e 6461  " not in self.da
+00004000: 7461 3a0a 2020 2020 2020 2020 2020 2020  ta:.            
+00004010: 7365 6c66 2e64 6174 615b 2263 6f6c 7265  self.data["colre
+00004020: 765f 6d61 7374 6572 6461 7461 5f70 726f  v_masterdata_pro
+00004030: 7665 6e61 6e63 6522 5d20 3d20 7b7d 0a0a  venance"] = {}..
+00004040: 2020 2020 2020 2020 6966 206e 6f74 5f6d          if not_m
+00004050: 6973 7369 6e67 5f6e 6f74 6520 616e 6420  issing_note and 
+00004060: 6b65 7920 696e 2073 656c 662e 6964 656e  key in self.iden
+00004070: 7469 6679 696e 675f 6669 656c 645f 6b65  tifying_field_ke
+00004080: 7973 3a0a 2020 2020 2020 2020 2020 2020  ys:.            
+00004090: 2320 4578 616d 706c 653a 206a 6f75 726e  # Example: journ
+000040a0: 616c 2077 6974 686f 7574 206e 756d 6265  al without numbe
+000040b0: 720a 2020 2020 2020 2020 2020 2020 2320  r.            # 
+000040c0: 7765 2073 686f 756c 6420 6b65 6570 2074  we should keep t
+000040d0: 6861 7420 696e 666f 726d 6174 696f 6e20  hat information 
+000040e0: 7468 6174 2061 2070 6172 7469 6375 6c61  that a particula
+000040f0: 7220 6d61 7374 6572 6461 7461 0a20 2020  r masterdata.   
+00004100: 2020 2020 2020 2020 2023 2066 6965 6c64           # field
+00004110: 2069 7320 6e6f 7420 7265 7175 6972 6564   is not required
+00004120: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00004130: 6b65 7920 6e6f 7420 696e 2073 656c 662e  key not in self.
+00004140: 6461 7461 5b22 636f 6c72 6576 5f6d 6173  data["colrev_mas
+00004150: 7465 7264 6174 615f 7072 6f76 656e 616e  terdata_provenan
+00004160: 6365 225d 3a0a 2020 2020 2020 2020 2020  ce"]:.          
+00004170: 2020 2020 2020 7365 6c66 2e64 6174 615b        self.data[
+00004180: 2263 6f6c 7265 765f 6d61 7374 6572 6461  "colrev_masterda
+00004190: 7461 5f70 726f 7665 6e61 6e63 6522 5d5b  ta_provenance"][
+000041a0: 6b65 795d 203d 207b 7d0a 2020 2020 2020  key] = {}.      
+000041b0: 2020 2020 2020 7365 6c66 2e64 6174 615b        self.data[
+000041c0: 2263 6f6c 7265 765f 6d61 7374 6572 6461  "colrev_masterda
+000041d0: 7461 5f70 726f 7665 6e61 6e63 6522 5d5b  ta_provenance"][
+000041e0: 6b65 795d 5b22 6e6f 7465 225d 203d 2022  key]["note"] = "
+000041f0: 6e6f 742d 6d69 7373 696e 6722 0a20 2020  not-missing".   
+00004200: 2020 2020 2020 2020 2069 6620 736f 7572           if sour
+00004210: 6365 2021 3d20 2222 3a0a 2020 2020 2020  ce != "":.      
+00004220: 2020 2020 2020 2020 2020 7365 6c66 2e64            self.d
+00004230: 6174 615b 2263 6f6c 7265 765f 6d61 7374  ata["colrev_mast
+00004240: 6572 6461 7461 5f70 726f 7665 6e61 6e63  erdata_provenanc
+00004250: 6522 5d5b 6b65 795d 5b22 736f 7572 6365  e"][key]["source
+00004260: 225d 203d 2073 6f75 7263 650a 2020 2020  "] = source.    
+00004270: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00004280: 2020 2020 2020 6966 206b 6579 2069 6e20        if key in 
+00004290: 7365 6c66 2e69 6465 6e74 6966 7969 6e67  self.identifying
+000042a0: 5f66 6965 6c64 5f6b 6579 733a 0a20 2020  _field_keys:.   
+000042b0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+000042c0: 6b65 7920 696e 2073 656c 662e 6461 7461  key in self.data
+000042d0: 2e67 6574 2822 636f 6c72 6576 5f6d 6173  .get("colrev_mas
+000042e0: 7465 7264 6174 615f 7072 6f76 656e 616e  terdata_provenan
+000042f0: 6365 222c 207b 7d29 3a0a 2020 2020 2020  ce", {}):.      
+00004300: 2020 2020 2020 2020 2020 2020 2020 6465                de
+00004310: 6c20 7365 6c66 2e64 6174 615b 2263 6f6c  l self.data["col
+00004320: 7265 765f 6d61 7374 6572 6461 7461 5f70  rev_masterdata_p
+00004330: 726f 7665 6e61 6e63 6522 5d5b 6b65 795d  rovenance"][key]
+00004340: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+00004350: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00004360: 2020 2069 6620 6b65 7920 696e 2073 656c     if key in sel
+00004370: 662e 6461 7461 2e67 6574 2822 636f 6c72  f.data.get("colr
+00004380: 6576 5f64 6174 615f 7072 6f76 656e 616e  ev_data_provenan
+00004390: 6365 222c 207b 7d29 3a0a 2020 2020 2020  ce", {}):.      
+000043a0: 2020 2020 2020 2020 2020 2020 2020 6465                de
+000043b0: 6c20 7365 6c66 2e64 6174 615b 2263 6f6c  l self.data["col
+000043c0: 7265 765f 6461 7461 5f70 726f 7665 6e61  rev_data_provena
+000043d0: 6e63 6522 5d5b 6b65 795d 0a0a 2020 2020  nce"][key]..    
+000043e0: 6465 6620 7365 745f 6d61 7374 6572 6461  def set_masterda
+000043f0: 7461 5f63 6f6d 706c 6574 6528 0a20 2020  ta_complete(.   
+00004400: 2020 2020 2073 656c 662c 202a 2c20 736f       self, *, so
+00004410: 7572 6365 3a20 7374 722c 206d 6173 7465  urce: str, maste
+00004420: 7264 6174 615f 7265 706f 7369 746f 7279  rdata_repository
+00004430: 3a20 626f 6f6c 2c20 7265 706c 6163 655f  : bool, replace_
+00004440: 736f 7572 6365 3a20 626f 6f6c 203d 2054  source: bool = T
+00004450: 7275 650a 2020 2020 2920 2d3e 204e 6f6e  rue.    ) -> Non
+00004460: 653a 0a20 2020 2020 2020 2022 2222 5365  e:.        """Se
+00004470: 7420 7468 6520 6d61 7374 6572 6461 7461  t the masterdata
+00004480: 2074 6f20 636f 6d70 6c65 7465 2222 220a   to complete""".
+00004490: 2020 2020 2020 2020 2320 7079 6c69 6e74          # pylint
+000044a0: 3a20 6469 7361 626c 653d 746f 6f2d 6d61  : disable=too-ma
+000044b0: 6e79 2d62 7261 6e63 6865 730a 2020 2020  ny-branches.    
+000044c0: 2020 2020 6966 2073 656c 662e 6d61 7374      if self.mast
+000044d0: 6572 6461 7461 5f69 735f 6375 7261 7465  erdata_is_curate
+000044e0: 6428 2920 6f72 206d 6173 7465 7264 6174  d() or masterdat
+000044f0: 615f 7265 706f 7369 746f 7279 3a0a 2020  a_repository:.  
+00004500: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00004510: 0a0a 2020 2020 2020 2020 6966 2022 636f  ..        if "co
+00004520: 6c72 6576 5f6d 6173 7465 7264 6174 615f  lrev_masterdata_
+00004530: 7072 6f76 656e 616e 6365 2220 6e6f 7420  provenance" not 
+00004540: 696e 2073 656c 662e 6461 7461 3a0a 2020  in self.data:.  
+00004550: 2020 2020 2020 2020 2020 7365 6c66 2e64            self.d
+00004560: 6174 615b 2263 6f6c 7265 765f 6d61 7374  ata["colrev_mast
+00004570: 6572 6461 7461 5f70 726f 7665 6e61 6e63  erdata_provenanc
+00004580: 6522 5d20 3d20 7b7d 0a20 2020 2020 2020  e"] = {}.       
+00004590: 206d 645f 705f 6469 6374 203d 2073 656c   md_p_dict = sel
+000045a0: 662e 6461 7461 5b22 636f 6c72 6576 5f6d  f.data["colrev_m
+000045b0: 6173 7465 7264 6174 615f 7072 6f76 656e  asterdata_proven
+000045c0: 616e 6365 225d 0a0a 2020 2020 2020 2020  ance"]..        
+000045d0: 666f 7220 6964 656e 7469 6679 696e 675f  for identifying_
+000045e0: 6669 656c 645f 6b65 7920 696e 2073 656c  field_key in sel
+000045f0: 662e 6964 656e 7469 6679 696e 675f 6669  f.identifying_fi
+00004600: 656c 645f 6b65 7973 3a0a 2020 2020 2020  eld_keys:.      
+00004610: 2020 2020 2020 6966 2069 6465 6e74 6966        if identif
+00004620: 7969 6e67 5f66 6965 6c64 5f6b 6579 2069  ying_field_key i
+00004630: 6e20 5b22 6175 7468 6f72 222c 2022 7469  n ["author", "ti
+00004640: 746c 6522 2c20 2279 6561 7222 5d3a 0a20  tle", "year"]:. 
+00004650: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00004660: 6f6e 7469 6e75 650a 2020 2020 2020 2020  ontinue.        
+00004670: 2020 2020 6966 2073 656c 662e 6461 7461      if self.data
+00004680: 2e67 6574 2869 6465 6e74 6966 7969 6e67  .get(identifying
+00004690: 5f66 6965 6c64 5f6b 6579 2c20 224e 4122  _field_key, "NA"
+000046a0: 2920 3d3d 2022 554e 4b4e 4f57 4e22 3a0a  ) == "UNKNOWN":.
+000046b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000046c0: 6465 6c20 7365 6c66 2e64 6174 615b 6964  del self.data[id
+000046d0: 656e 7469 6679 696e 675f 6669 656c 645f  entifying_field_
+000046e0: 6b65 795d 0a20 2020 2020 2020 2020 2020  key].           
+000046f0: 2069 6620 6964 656e 7469 6679 696e 675f   if identifying_
+00004700: 6669 656c 645f 6b65 7920 696e 206d 645f  field_key in md_
+00004710: 705f 6469 6374 3a0a 2020 2020 2020 2020  p_dict:.        
+00004720: 2020 2020 2020 2020 6e6f 7465 203d 206d          note = m
+00004730: 645f 705f 6469 6374 5b69 6465 6e74 6966  d_p_dict[identif
+00004740: 7969 6e67 5f66 6965 6c64 5f6b 6579 5d5b  ying_field_key][
+00004750: 226e 6f74 6522 5d0a 2020 2020 2020 2020  "note"].        
+00004760: 2020 2020 2020 2020 6966 2022 6d69 7373          if "miss
+00004770: 696e 6722 2069 6e20 6e6f 7465 2061 6e64  ing" in note and
+00004780: 2022 6e6f 742d 6d69 7373 696e 6722 206e   "not-missing" n
+00004790: 6f74 2069 6e20 6e6f 7465 3a0a 2020 2020  ot in note:.    
+000047a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000047b0: 6d64 5f70 5f64 6963 745b 6964 656e 7469  md_p_dict[identi
+000047c0: 6679 696e 675f 6669 656c 645f 6b65 795d  fying_field_key]
+000047d0: 5b22 6e6f 7465 225d 203d 206e 6f74 652e  ["note"] = note.
+000047e0: 7265 706c 6163 6528 0a20 2020 2020 2020  replace(.       
+000047f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004800: 2022 6d69 7373 696e 6722 2c20 2222 0a20   "missing", "". 
+00004810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004820: 2020 2029 0a0a 2020 2020 2020 2020 6966     )..        if
+00004830: 2073 656c 662e 6461 7461 5b22 454e 5452   self.data["ENTR
+00004840: 5954 5950 4522 5d20 3d3d 2022 6172 7469  YTYPE"] == "arti
+00004850: 636c 6522 3a0a 2020 2020 2020 2020 2020  cle":.          
+00004860: 2020 6966 2022 766f 6c75 6d65 2220 6e6f    if "volume" no
+00004870: 7420 696e 2073 656c 662e 6461 7461 3a0a  t in self.data:.
 00004880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004890: 2020 2273 6f75 7263 6522 3a20 736f 7572    "source": sour
-000048a0: 6365 2c0a 2020 2020 2020 2020 2020 2020  ce,.            
-000048b0: 2020 2020 2020 2020 2020 2020 226e 6f74              "not
-000048c0: 6522 3a20 226e 6f74 2d6d 6973 7369 6e67  e": "not-missing
-000048d0: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-000048e0: 2020 2020 2020 207d 0a0a 2020 2020 2020         }..      
-000048f0: 2020 2020 2020 6966 2022 6e75 6d62 6572        if "number
-00004900: 2220 6e6f 7420 696e 2073 656c 662e 6461  " not in self.da
-00004910: 7461 3a0a 2020 2020 2020 2020 2020 2020  ta:.            
-00004920: 2020 2020 6966 2022 6e75 6d62 6572 2220      if "number" 
-00004930: 696e 2073 656c 662e 6461 7461 5b22 636f  in self.data["co
-00004940: 6c72 6576 5f6d 6173 7465 7264 6174 615f  lrev_masterdata_
-00004950: 7072 6f76 656e 616e 6365 225d 3a0a 2020  provenance"]:.  
-00004960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004970: 2020 7365 6c66 2e64 6174 615b 2263 6f6c    self.data["col
-00004980: 7265 765f 6d61 7374 6572 6461 7461 5f70  rev_masterdata_p
-00004990: 726f 7665 6e61 6e63 6522 5d5b 226e 756d  rovenance"]["num
-000049a0: 6265 7222 5d5b 0a20 2020 2020 2020 2020  ber"][.         
-000049b0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-000049c0: 6e6f 7465 220a 2020 2020 2020 2020 2020  note".          
-000049d0: 2020 2020 2020 2020 2020 5d20 3d20 226e            ] = "n
-000049e0: 6f74 2d6d 6973 7369 6e67 220a 2020 2020  ot-missing".    
-000049f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004a00: 6966 2072 6570 6c61 6365 5f73 6f75 7263  if replace_sourc
-00004a10: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00004a20: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00004a30: 6461 7461 5b22 636f 6c72 6576 5f6d 6173  data["colrev_mas
-00004a40: 7465 7264 6174 615f 7072 6f76 656e 616e  terdata_provenan
-00004a50: 6365 225d 5b22 6e75 6d62 6572 225d 5b0a  ce"]["number"][.
-00004a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004a70: 2020 2020 2020 2020 2020 2020 2273 6f75              "sou
-00004a80: 7263 6522 0a20 2020 2020 2020 2020 2020  rce".           
-00004a90: 2020 2020 2020 2020 2020 2020 205d 203d               ] =
-00004aa0: 2073 6f75 7263 650a 2020 2020 2020 2020   source.        
-00004ab0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00004ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004ad0: 2020 7365 6c66 2e64 6174 615b 2263 6f6c    self.data["col
-00004ae0: 7265 765f 6d61 7374 6572 6461 7461 5f70  rev_masterdata_p
-00004af0: 726f 7665 6e61 6e63 6522 5d5b 226e 756d  rovenance"]["num
-00004b00: 6265 7222 5d20 3d20 7b0a 2020 2020 2020  ber"] = {.      
+00004890: 6966 2022 766f 6c75 6d65 2220 696e 2073  if "volume" in s
+000048a0: 656c 662e 6461 7461 5b22 636f 6c72 6576  elf.data["colrev
+000048b0: 5f6d 6173 7465 7264 6174 615f 7072 6f76  _masterdata_prov
+000048c0: 656e 616e 6365 225d 3a0a 2020 2020 2020  enance"]:.      
+000048d0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+000048e0: 6c66 2e64 6174 615b 2263 6f6c 7265 765f  lf.data["colrev_
+000048f0: 6d61 7374 6572 6461 7461 5f70 726f 7665  masterdata_prove
+00004900: 6e61 6e63 6522 5d5b 2276 6f6c 756d 6522  nance"]["volume"
+00004910: 5d5b 0a20 2020 2020 2020 2020 2020 2020  ][.             
+00004920: 2020 2020 2020 2020 2020 2022 6e6f 7465             "note
+00004930: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00004940: 2020 2020 2020 5d20 3d20 226e 6f74 2d6d        ] = "not-m
+00004950: 6973 7369 6e67 220a 2020 2020 2020 2020  issing".        
+00004960: 2020 2020 2020 2020 2020 2020 6966 2072              if r
+00004970: 6570 6c61 6365 5f73 6f75 7263 653a 0a20  eplace_source:. 
+00004980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004990: 2020 2020 2020 2073 656c 662e 6461 7461         self.data
+000049a0: 5b22 636f 6c72 6576 5f6d 6173 7465 7264  ["colrev_masterd
+000049b0: 6174 615f 7072 6f76 656e 616e 6365 225d  ata_provenance"]
+000049c0: 5b22 766f 6c75 6d65 225d 5b0a 2020 2020  ["volume"][.    
+000049d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000049e0: 2020 2020 2020 2020 2273 6f75 7263 6522          "source"
+000049f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004a00: 2020 2020 2020 2020 205d 203d 2073 6f75           ] = sou
+00004a10: 7263 650a 2020 2020 2020 2020 2020 2020  rce.            
+00004a20: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00004a30: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00004a40: 6c66 2e64 6174 615b 2263 6f6c 7265 765f  lf.data["colrev_
+00004a50: 6d61 7374 6572 6461 7461 5f70 726f 7665  masterdata_prove
+00004a60: 6e61 6e63 6522 5d5b 2276 6f6c 756d 6522  nance"]["volume"
+00004a70: 5d20 3d20 7b0a 2020 2020 2020 2020 2020  ] = {.          
+00004a80: 2020 2020 2020 2020 2020 2020 2020 2273                "s
+00004a90: 6f75 7263 6522 3a20 736f 7572 6365 2c0a  ource": source,.
+00004aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004ab0: 2020 2020 2020 2020 226e 6f74 6522 3a20          "note": 
+00004ac0: 226e 6f74 2d6d 6973 7369 6e67 222c 0a20  "not-missing",. 
+00004ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004ae0: 2020 207d 0a0a 2020 2020 2020 2020 2020     }..          
+00004af0: 2020 6966 2022 6e75 6d62 6572 2220 6e6f    if "number" no
+00004b00: 7420 696e 2073 656c 662e 6461 7461 3a0a  t in self.data:.
 00004b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004b20: 2020 2273 6f75 7263 6522 3a20 736f 7572    "source": sour
-00004b30: 6365 2c0a 2020 2020 2020 2020 2020 2020  ce,.            
-00004b40: 2020 2020 2020 2020 2020 2020 226e 6f74              "not
-00004b50: 6522 3a20 226e 6f74 2d6d 6973 7369 6e67  e": "not-missing
-00004b60: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-00004b70: 2020 2020 2020 207d 0a0a 2020 2020 6465         }..    de
-00004b80: 6620 7365 745f 6d61 7374 6572 6461 7461  f set_masterdata
-00004b90: 5f63 6f6e 7369 7374 656e 7428 7365 6c66  _consistent(self
-00004ba0: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-00004bb0: 2020 2022 2222 5365 7420 7468 6520 6d61     """Set the ma
-00004bc0: 7374 6572 6461 7461 2074 6f20 636f 6e73  sterdata to cons
-00004bd0: 6973 7465 6e74 2222 220a 2020 2020 2020  istent""".      
-00004be0: 2020 6966 2022 636f 6c72 6576 5f6d 6173    if "colrev_mas
-00004bf0: 7465 7264 6174 615f 7072 6f76 656e 616e  terdata_provenan
-00004c00: 6365 2220 6e6f 7420 696e 2073 656c 662e  ce" not in self.
-00004c10: 6461 7461 3a0a 2020 2020 2020 2020 2020  data:.          
-00004c20: 2020 7365 6c66 2e64 6174 615b 2263 6f6c    self.data["col
-00004c30: 7265 765f 6d61 7374 6572 6461 7461 5f70  rev_masterdata_p
-00004c40: 726f 7665 6e61 6e63 6522 5d20 3d20 7b7d  rovenance"] = {}
-00004c50: 0a20 2020 2020 2020 206d 645f 705f 6469  .        md_p_di
-00004c60: 6374 203d 2073 656c 662e 6461 7461 5b22  ct = self.data["
-00004c70: 636f 6c72 6576 5f6d 6173 7465 7264 6174  colrev_masterdat
-00004c80: 615f 7072 6f76 656e 616e 6365 225d 0a0a  a_provenance"]..
-00004c90: 2020 2020 2020 2020 666f 7220 6964 656e          for iden
-00004ca0: 7469 6679 696e 675f 6669 656c 645f 6b65  tifying_field_ke
-00004cb0: 7920 696e 2073 656c 662e 6964 656e 7469  y in self.identi
-00004cc0: 6679 696e 675f 6669 656c 645f 6b65 7973  fying_field_keys
-00004cd0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-00004ce0: 2069 6465 6e74 6966 7969 6e67 5f66 6965   identifying_fie
-00004cf0: 6c64 5f6b 6579 2069 6e20 6d64 5f70 5f64  ld_key in md_p_d
-00004d00: 6963 743a 0a20 2020 2020 2020 2020 2020  ict:.           
-00004d10: 2020 2020 206e 6f74 6520 3d20 6d64 5f70       note = md_p
-00004d20: 5f64 6963 745b 6964 656e 7469 6679 696e  _dict[identifyin
-00004d30: 675f 6669 656c 645f 6b65 795d 5b22 6e6f  g_field_key]["no
-00004d40: 7465 225d 0a20 2020 2020 2020 2020 2020  te"].           
-00004d50: 2020 2020 2069 6620 2269 6e63 6f6e 7369       if "inconsi
-00004d60: 7374 656e 742d 7769 7468 2d65 6e74 7279  stent-with-entry
-00004d70: 7479 7065 2220 696e 206e 6f74 653a 0a20  type" in note:. 
-00004d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004d90: 2020 206d 645f 705f 6469 6374 5b69 6465     md_p_dict[ide
-00004da0: 6e74 6966 7969 6e67 5f66 6965 6c64 5f6b  ntifying_field_k
-00004db0: 6579 5d5b 226e 6f74 6522 5d20 3d20 6e6f  ey]["note"] = no
-00004dc0: 7465 2e72 6570 6c61 6365 280a 2020 2020  te.replace(.    
-00004dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004de0: 2020 2020 2269 6e63 6f6e 7369 7374 656e      "inconsisten
-00004df0: 742d 7769 7468 2d65 6e74 7279 7479 7065  t-with-entrytype
-00004e00: 222c 2022 220a 2020 2020 2020 2020 2020  ", "".          
-00004e10: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
-00004e20: 2064 6566 2072 6573 6574 5f70 6466 5f70   def reset_pdf_p
-00004e30: 726f 7665 6e61 6e63 655f 6e6f 7465 7328  rovenance_notes(
-00004e40: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
-00004e50: 2020 2020 2020 2022 2222 5265 7365 7420         """Reset 
-00004e60: 7468 6520 5044 4620 2866 696c 6529 2070  the PDF (file) p
-00004e70: 726f 7665 6e61 6e63 6520 6e6f 7465 7322  rovenance notes"
-00004e80: 2222 0a20 2020 2020 2020 2069 6620 2263  "".        if "c
-00004e90: 6f6c 7265 765f 6461 7461 5f70 726f 7665  olrev_data_prove
-00004ea0: 6e61 6e63 6522 206e 6f74 2069 6e20 7365  nance" not in se
-00004eb0: 6c66 2e64 6174 613a 0a20 2020 2020 2020  lf.data:.       
-00004ec0: 2020 2020 2073 656c 662e 6164 645f 6461       self.add_da
-00004ed0: 7461 5f70 726f 7665 6e61 6e63 655f 6e6f  ta_provenance_no
-00004ee0: 7465 286b 6579 3d22 6669 6c65 222c 206e  te(key="file", n
-00004ef0: 6f74 653d 2222 290a 2020 2020 2020 2020  ote="").        
-00004f00: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00004f10: 2020 6966 2022 6669 6c65 2220 696e 2073    if "file" in s
-00004f20: 656c 662e 6461 7461 5b22 636f 6c72 6576  elf.data["colrev
-00004f30: 5f64 6174 615f 7072 6f76 656e 616e 6365  _data_provenance
-00004f40: 225d 3a0a 2020 2020 2020 2020 2020 2020  "]:.            
-00004f50: 2020 2020 7365 6c66 2e64 6174 615b 2263      self.data["c
-00004f60: 6f6c 7265 765f 6461 7461 5f70 726f 7665  olrev_data_prove
-00004f70: 6e61 6e63 6522 5d5b 2266 696c 6522 5d5b  nance"]["file"][
-00004f80: 226e 6f74 6522 5d20 3d20 2222 0a20 2020  "note"] = "".   
-00004f90: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00004fa0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00004fb0: 656c 662e 6461 7461 5b22 636f 6c72 6576  elf.data["colrev
-00004fc0: 5f64 6174 615f 7072 6f76 656e 616e 6365  _data_provenance
-00004fd0: 225d 5b22 6669 6c65 225d 203d 207b 0a20  "]["file"] = {. 
-00004fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004ff0: 2020 2022 736f 7572 6365 223a 2022 4e41     "source": "NA
-00005000: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-00005010: 2020 2020 2020 2022 6e6f 7465 223a 2022         "note": "
-00005020: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-00005030: 2020 207d 0a0a 2020 2020 6465 6620 5f5f     }..    def __
-00005040: 6d65 7267 655f 6f72 6967 696e 7328 7365  merge_origins(se
-00005050: 6c66 2c20 2a2c 206d 6572 6769 6e67 5f72  lf, *, merging_r
-00005060: 6563 6f72 643a 2052 6563 6f72 6429 202d  ecord: Record) -
-00005070: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-00005080: 2222 224d 6572 6765 2074 6865 206f 7269  """Merge the ori
-00005090: 6769 6e73 2077 6974 6820 7468 6f73 6520  gins with those 
-000050a0: 6f66 2074 6865 206d 6572 6769 6e67 5f72  of the merging_r
-000050b0: 6563 6f72 6422 2222 0a0a 2020 2020 2020  ecord"""..      
-000050c0: 2020 6966 2022 636f 6c72 6576 5f6f 7269    if "colrev_ori
-000050d0: 6769 6e22 2069 6e20 6d65 7267 696e 675f  gin" in merging_
-000050e0: 7265 636f 7264 2e64 6174 613a 0a20 2020  record.data:.   
-000050f0: 2020 2020 2020 2020 206f 7269 6769 6e73           origins
-00005100: 203d 2073 656c 662e 6461 7461 5b22 636f   = self.data["co
-00005110: 6c72 6576 5f6f 7269 6769 6e22 5d20 2b20  lrev_origin"] + 
-00005120: 6d65 7267 696e 675f 7265 636f 7264 2e64  merging_record.d
-00005130: 6174 615b 2263 6f6c 7265 765f 6f72 6967  ata["colrev_orig
-00005140: 696e 225d 0a20 2020 2020 2020 2020 2020  in"].           
-00005150: 2073 656c 662e 6461 7461 5b22 636f 6c72   self.data["colr
-00005160: 6576 5f6f 7269 6769 6e22 5d20 3d20 736f  ev_origin"] = so
-00005170: 7274 6564 286c 6973 7428 7365 7428 6f72  rted(list(set(or
-00005180: 6967 696e 7329 2929 0a0a 2020 2020 6465  igins)))..    de
-00005190: 6620 5f5f 6d65 7267 655f 7374 6174 7573  f __merge_status
-000051a0: 2873 656c 662c 202a 2c20 6d65 7267 696e  (self, *, mergin
-000051b0: 675f 7265 636f 7264 3a20 5265 636f 7264  g_record: Record
-000051c0: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-000051d0: 2020 2022 2222 4d65 7267 6520 7468 6520     """Merge the 
-000051e0: 7374 6174 7573 2077 6974 6820 7468 6520  status with the 
-000051f0: 6d65 7267 696e 675f 7265 636f 7264 2222  merging_record""
-00005200: 220a 0a20 2020 2020 2020 2069 6620 2263  "..        if "c
-00005210: 6f6c 7265 765f 7374 6174 7573 2220 696e  olrev_status" in
-00005220: 206d 6572 6769 6e67 5f72 6563 6f72 642e   merging_record.
-00005230: 6461 7461 3a0a 2020 2020 2020 2020 2020  data:.          
-00005240: 2020 2320 5365 7420 626f 7468 2073 7461    # Set both sta
-00005250: 7475 7320 746f 2074 6865 206c 6174 7465  tus to the latte
-00005260: 7220 696e 2074 6865 2073 7461 7465 206d  r in the state m
-00005270: 6f64 656c 0a20 2020 2020 2020 2020 2020  odel.           
-00005280: 2069 6620 7365 6c66 2e64 6174 615b 2263   if self.data["c
-00005290: 6f6c 7265 765f 7374 6174 7573 225d 203c  olrev_status"] <
-000052a0: 206d 6572 6769 6e67 5f72 6563 6f72 642e   merging_record.
-000052b0: 6461 7461 5b22 636f 6c72 6576 5f73 7461  data["colrev_sta
-000052c0: 7475 7322 5d3a 0a20 2020 2020 2020 2020  tus"]:.         
-000052d0: 2020 2020 2020 2073 656c 662e 7365 745f         self.set_
-000052e0: 7374 6174 7573 2874 6172 6765 745f 7374  status(target_st
-000052f0: 6174 653d 6d65 7267 696e 675f 7265 636f  ate=merging_reco
-00005300: 7264 2e64 6174 615b 2263 6f6c 7265 765f  rd.data["colrev_
-00005310: 7374 6174 7573 225d 290a 2020 2020 2020  status"]).      
-00005320: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00005330: 2020 2020 2020 2020 2020 2020 6d65 7267              merg
-00005340: 696e 675f 7265 636f 7264 2e73 6574 5f73  ing_record.set_s
-00005350: 7461 7475 7328 7461 7267 6574 5f73 7461  tatus(target_sta
-00005360: 7465 3d73 656c 662e 6461 7461 5b22 636f  te=self.data["co
-00005370: 6c72 6576 5f73 7461 7475 7322 5d29 0a0a  lrev_status"])..
-00005380: 2020 2020 6465 6620 5f5f 6765 745f 6d65      def __get_me
-00005390: 7267 696e 675f 7661 6c28 7365 6c66 2c20  rging_val(self, 
-000053a0: 2a2c 206d 6572 6769 6e67 5f72 6563 6f72  *, merging_recor
-000053b0: 643a 2052 6563 6f72 642c 206b 6579 3a20  d: Record, key: 
-000053c0: 7374 7229 202d 3e20 7374 723a 0a20 2020  str) -> str:.   
-000053d0: 2020 2020 2076 616c 203d 206d 6572 6769       val = mergi
-000053e0: 6e67 5f72 6563 6f72 642e 6461 7461 2e67  ng_record.data.g
-000053f0: 6574 286b 6579 2c20 2222 290a 0a20 2020  et(key, "")..   
-00005400: 2020 2020 2069 6620 7661 6c20 3d3d 2022       if val == "
-00005410: 223a 0a20 2020 2020 2020 2020 2020 2072  ":.            r
-00005420: 6574 7572 6e20 2222 0a20 2020 2020 2020  eturn "".       
-00005430: 2069 6620 6e6f 7420 7661 6c3a 0a20 2020   if not val:.   
-00005440: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00005450: 2222 0a0a 2020 2020 2020 2020 2320 646f  ""..        # do
-00005460: 206e 6f74 206f 7665 7272 6964 6520 7072   not override pr
-00005470: 6f76 656e 616e 6365 2c20 4944 2c20 2e2e  ovenance, ID, ..
-00005480: 2e20 6669 656c 6473 0a20 2020 2020 2020  . fields.       
-00005490: 2069 6620 6b65 7920 696e 205b 0a20 2020   if key in [.   
-000054a0: 2020 2020 2020 2020 2022 4944 222c 0a20           "ID",. 
-000054b0: 2020 2020 2020 2020 2020 2022 636f 6c72             "colr
-000054c0: 6576 5f6d 6173 7465 7264 6174 615f 7072  ev_masterdata_pr
-000054d0: 6f76 656e 616e 6365 222c 0a20 2020 2020  ovenance",.     
-000054e0: 2020 2020 2020 2022 636f 6c72 6576 5f64         "colrev_d
-000054f0: 6174 615f 7072 6f76 656e 616e 6365 222c  ata_provenance",
-00005500: 0a20 2020 2020 2020 2020 2020 2022 636f  .            "co
-00005510: 6c72 6576 5f69 6422 2c0a 2020 2020 2020  lrev_id",.      
-00005520: 2020 2020 2020 2263 6f6c 7265 765f 7374        "colrev_st
-00005530: 6174 7573 222c 0a20 2020 2020 2020 2020  atus",.         
-00005540: 2020 2022 636f 6c72 6576 5f6f 7269 6769     "colrev_origi
-00005550: 6e22 2c0a 2020 2020 2020 2020 2020 2020  n",.            
-00005560: 224d 4f56 4544 5f44 5550 455f 4944 222c  "MOVED_DUPE_ID",
-00005570: 0a20 2020 2020 2020 205d 3a0a 2020 2020  .        ]:.    
-00005580: 2020 2020 2020 2020 7265 7475 726e 2022          return "
-00005590: 220a 0a20 2020 2020 2020 2072 6574 7572  "..        retur
-000055a0: 6e20 7661 6c0a 0a20 2020 2064 6566 205f  n val..    def _
-000055b0: 5f70 7265 7665 6e74 5f69 6e76 616c 6964  _prevent_invalid
-000055c0: 5f6d 6572 6765 7328 7365 6c66 2c20 2a2c  _merges(self, *,
-000055d0: 206d 6572 6769 6e67 5f72 6563 6f72 643a   merging_record:
-000055e0: 2052 6563 6f72 6429 202d 3e20 4e6f 6e65   Record) -> None
-000055f0: 3a0a 2020 2020 2020 2020 2222 2250 7265  :.        """Pre
-00005600: 7665 6e74 7320 696e 7661 6c69 6420 6d65  vents invalid me
-00005610: 7267 6573 206c 696b 6520 2e2e 2e20 7061  rges like ... pa
-00005620: 7274 2031 202f 202e 2e2e 2070 6172 7420  rt 1 / ... part 
-00005630: 3222 2222 0a0a 2020 2020 2020 2020 6c6f  2"""..        lo
-00005640: 7765 725f 7469 746c 655f 6120 3d20 7365  wer_title_a = se
-00005650: 6c66 2e64 6174 612e 6765 7428 2274 6974  lf.data.get("tit
-00005660: 6c65 222c 2022 2229 2e6c 6f77 6572 2829  le", "").lower()
-00005670: 0a20 2020 2020 2020 206c 6f77 6572 5f74  .        lower_t
-00005680: 6974 6c65 5f62 203d 206d 6572 6769 6e67  itle_b = merging
-00005690: 5f72 6563 6f72 642e 6461 7461 2e67 6574  _record.data.get
-000056a0: 2822 7469 746c 6522 2c20 2222 292e 6c6f  ("title", "").lo
-000056b0: 7765 7228 290a 0a20 2020 2020 2020 2070  wer()..        p
-000056c0: 6172 745f 6d61 7463 685f 6120 3d20 7265  art_match_a = re
-000056d0: 2e66 696e 6461 6c6c 2872 2270 6172 7420  .findall(r"part 
-000056e0: 5b41 2d5a 612d 7a30 2d39 5d2b 2422 2c20  [A-Za-z0-9]+$", 
-000056f0: 6c6f 7765 725f 7469 746c 655f 6129 0a20  lower_title_a). 
-00005700: 2020 2020 2020 2070 6172 745f 6d61 7463         part_matc
-00005710: 685f 6220 3d20 7265 2e66 696e 6461 6c6c  h_b = re.findall
-00005720: 2872 2270 6172 7420 5b41 2d5a 612d 7a30  (r"part [A-Za-z0
-00005730: 2d39 5d2b 2422 2c20 6c6f 7765 725f 7469  -9]+$", lower_ti
-00005740: 746c 655f 6229 0a0a 2020 2020 2020 2020  tle_b)..        
-00005750: 6966 2070 6172 745f 6d61 7463 685f 6120  if part_match_a 
-00005760: 213d 2070 6172 745f 6d61 7463 685f 623a  != part_match_b:
-00005770: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-00005780: 7365 2063 6f6c 7265 765f 6578 6365 7074  se colrev_except
-00005790: 696f 6e73 2e49 6e76 616c 6964 4d65 7267  ions.InvalidMerg
-000057a0: 6528 7265 636f 7264 5f61 3d73 656c 662c  e(record_a=self,
-000057b0: 2072 6563 6f72 645f 623d 6d65 7267 696e   record_b=mergin
-000057c0: 675f 7265 636f 7264 290a 0a20 2020 2020  g_record)..     
-000057d0: 2020 2074 6572 6d73 5f72 6571 7569 7265     terms_require
-000057e0: 645f 746f 5f6d 6174 6368 203d 205b 0a20  d_to_match = [. 
-000057f0: 2020 2020 2020 2020 2020 2022 6572 7261             "erra
-00005800: 7475 6d22 2c0a 2020 2020 2020 2020 2020  tum",.          
-00005810: 2020 2263 6f72 7265 6374 696f 6e22 2c0a    "correction",.
-00005820: 2020 2020 2020 2020 2020 2020 2263 6f72              "cor
-00005830: 7269 6765 6e64 756d 222c 0a20 2020 2020  rigendum",.     
-00005840: 2020 2020 2020 2022 636f 6d6d 656e 7422         "comment"
-00005850: 2c0a 2020 2020 2020 2020 2020 2020 2263  ,.            "c
-00005860: 6f6d 6d65 6e74 6172 7922 2c0a 2020 2020  ommentary",.    
-00005870: 2020 2020 2020 2020 2272 6573 706f 6e73          "respons
-00005880: 6522 2c0a 2020 2020 2020 2020 5d0a 2020  e",.        ].  
-00005890: 2020 2020 2020 7465 726d 735f 696e 5f61        terms_in_a
-000058a0: 203d 205b 7420 666f 7220 7420 696e 2074   = [t for t in t
-000058b0: 6572 6d73 5f72 6571 7569 7265 645f 746f  erms_required_to
-000058c0: 5f6d 6174 6368 2069 6620 7420 696e 206c  _match if t in l
-000058d0: 6f77 6572 5f74 6974 6c65 5f61 5d0a 2020  ower_title_a].  
-000058e0: 2020 2020 2020 7465 726d 735f 696e 5f62        terms_in_b
-000058f0: 203d 205b 7420 666f 7220 7420 696e 2074   = [t for t in t
-00005900: 6572 6d73 5f72 6571 7569 7265 645f 746f  erms_required_to
-00005910: 5f6d 6174 6368 2069 6620 7420 696e 206c  _match if t in l
-00005920: 6f77 6572 5f74 6974 6c65 5f62 5d0a 0a20  ower_title_b].. 
-00005930: 2020 2020 2020 2069 6620 7465 726d 735f         if terms_
-00005940: 696e 5f61 2021 3d20 7465 726d 735f 696e  in_a != terms_in
-00005950: 5f62 3a0a 2020 2020 2020 2020 2020 2020  _b:.            
-00005960: 7261 6973 6520 636f 6c72 6576 5f65 7863  raise colrev_exc
-00005970: 6570 7469 6f6e 732e 496e 7661 6c69 644d  eptions.InvalidM
-00005980: 6572 6765 2872 6563 6f72 645f 613d 7365  erge(record_a=se
-00005990: 6c66 2c20 7265 636f 7264 5f62 3d6d 6572  lf, record_b=mer
-000059a0: 6769 6e67 5f72 6563 6f72 6429 0a0a 2020  ging_record)..  
-000059b0: 2020 6465 6620 6d65 7267 6528 0a20 2020    def merge(.   
-000059c0: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
-000059d0: 2020 202a 2c0a 2020 2020 2020 2020 6d65     *,.        me
-000059e0: 7267 696e 675f 7265 636f 7264 3a20 5265  rging_record: Re
-000059f0: 636f 7264 2c0a 2020 2020 2020 2020 6465  cord,.        de
-00005a00: 6661 756c 745f 736f 7572 6365 3a20 7374  fault_source: st
-00005a10: 722c 0a20 2020 2020 2020 2070 7265 6665  r,.        prefe
-00005a20: 7272 6564 5f6d 6173 7465 7264 6174 615f  rred_masterdata_
-00005a30: 736f 7572 6365 5f70 7265 6669 7865 733a  source_prefixes:
-00005a40: 204f 7074 696f 6e61 6c5b 6c69 7374 5d20   Optional[list] 
-00005a50: 3d20 4e6f 6e65 2c0a 2020 2020 2920 2d3e  = None,.    ) ->
-00005a60: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
-00005a70: 2222 4765 6e65 7261 6c2d 7075 7270 6f73  ""General-purpos
-00005a80: 6520 7265 636f 7264 206d 6572 6769 6e67  e record merging
-00005a90: 0a20 2020 2020 2020 2066 6f72 2070 7265  .        for pre
-00005aa0: 7061 7261 7469 6f6e 2c20 6375 7261 7465  paration, curate
-00005ab0: 642f 6e6f 6e2d 6375 7261 7465 6420 7265  d/non-curated re
-00005ac0: 636f 7264 7320 616e 6420 7265 636f 7264  cords and record
-00005ad0: 7320 7769 7468 206f 7269 6769 6e73 0a0a  s with origins..
-00005ae0: 0a20 2020 2020 2020 2041 7070 6c79 2068  .        Apply h
-00005af0: 6575 7269 7374 6963 7320 746f 2063 7265  euristics to cre
-00005b00: 6174 6520 6120 6675 7369 6f6e 206f 6620  ate a fusion of 
-00005b10: 7468 6520 6265 7374 2066 6965 6c64 7320  the best fields 
-00005b20: 6261 7365 6420 6f6e 0a20 2020 2020 2020  based on.       
-00005b30: 2071 7561 6c69 7479 2068 6575 7269 7374   quality heurist
-00005b40: 6963 7322 2222 0a0a 2020 2020 2020 2020  ics"""..        
-00005b50: 2320 7079 6c69 6e74 3a20 6469 7361 626c  # pylint: disabl
-00005b60: 653d 746f 6f2d 6d61 6e79 2d62 7261 6e63  e=too-many-branc
-00005b70: 6865 730a 0a20 2020 2020 2020 206d 6572  hes..        mer
-00005b80: 6769 6e67 5f72 6563 6f72 645f 7072 6566  ging_record_pref
-00005b90: 6572 7265 6420 3d20 4661 6c73 650a 2020  erred = False.  
-00005ba0: 2020 2020 2020 6966 2070 7265 6665 7272        if preferr
-00005bb0: 6564 5f6d 6173 7465 7264 6174 615f 736f  ed_masterdata_so
-00005bc0: 7572 6365 5f70 7265 6669 7865 733a 0a20  urce_prefixes:. 
-00005bd0: 2020 2020 2020 2020 2020 2069 6620 616e             if an
-00005be0: 7928 0a20 2020 2020 2020 2020 2020 2020  y(.             
-00005bf0: 2020 2061 6e79 2870 7320 696e 206f 7269     any(ps in ori
-00005c00: 6769 6e20 666f 7220 7073 2069 6e20 7072  gin for ps in pr
-00005c10: 6566 6572 7265 645f 6d61 7374 6572 6461  eferred_masterda
-00005c20: 7461 5f73 6f75 7263 655f 7072 6566 6978  ta_source_prefix
-00005c30: 6573 290a 2020 2020 2020 2020 2020 2020  es).            
-00005c40: 2020 2020 666f 7220 6f72 6967 696e 2069      for origin i
-00005c50: 6e20 6d65 7267 696e 675f 7265 636f 7264  n merging_record
-00005c60: 2e64 6174 615b 2263 6f6c 7265 765f 6f72  .data["colrev_or
-00005c70: 6967 696e 225d 0a20 2020 2020 2020 2020  igin"].         
-00005c80: 2020 2029 3a0a 2020 2020 2020 2020 2020     ):.          
-00005c90: 2020 2020 2020 6d65 7267 696e 675f 7265        merging_re
-00005ca0: 636f 7264 5f70 7265 6665 7272 6564 203d  cord_preferred =
-00005cb0: 2054 7275 650a 0a20 2020 2020 2020 2073   True..        s
-00005cc0: 656c 662e 5f5f 7072 6576 656e 745f 696e  elf.__prevent_in
-00005cd0: 7661 6c69 645f 6d65 7267 6573 286d 6572  valid_merges(mer
-00005ce0: 6769 6e67 5f72 6563 6f72 643d 6d65 7267  ging_record=merg
-00005cf0: 696e 675f 7265 636f 7264 290a 2020 2020  ing_record).    
-00005d00: 2020 2020 7365 6c66 2e5f 5f6d 6572 6765      self.__merge
-00005d10: 5f6f 7269 6769 6e73 286d 6572 6769 6e67  _origins(merging
-00005d20: 5f72 6563 6f72 643d 6d65 7267 696e 675f  _record=merging_
-00005d30: 7265 636f 7264 290a 2020 2020 2020 2020  record).        
-00005d40: 7365 6c66 2e5f 5f6d 6572 6765 5f73 7461  self.__merge_sta
-00005d50: 7475 7328 6d65 7267 696e 675f 7265 636f  tus(merging_reco
-00005d60: 7264 3d6d 6572 6769 6e67 5f72 6563 6f72  rd=merging_recor
-00005d70: 6429 0a0a 2020 2020 2020 2020 6966 206e  d)..        if n
-00005d80: 6f74 2073 656c 662e 6d61 7374 6572 6461  ot self.masterda
-00005d90: 7461 5f69 735f 6375 7261 7465 6428 2920  ta_is_curated() 
-00005da0: 616e 6420 6d65 7267 696e 675f 7265 636f  and merging_reco
-00005db0: 7264 2e6d 6173 7465 7264 6174 615f 6973  rd.masterdata_is
-00005dc0: 5f63 7572 6174 6564 2829 3a0a 2020 2020  _curated():.    
-00005dd0: 2020 2020 2020 2020 7365 6c66 2e64 6174          self.dat
-00005de0: 615b 2263 6f6c 7265 765f 6d61 7374 6572  a["colrev_master
-00005df0: 6461 7461 5f70 726f 7665 6e61 6e63 6522  data_provenance"
-00005e00: 5d20 3d20 6d65 7267 696e 675f 7265 636f  ] = merging_reco
-00005e10: 7264 2e64 6174 615b 0a20 2020 2020 2020  rd.data[.       
-00005e20: 2020 2020 2020 2020 2022 636f 6c72 6576           "colrev
-00005e30: 5f6d 6173 7465 7264 6174 615f 7072 6f76  _masterdata_prov
-00005e40: 656e 616e 6365 220a 2020 2020 2020 2020  enance".        
-00005e50: 2020 2020 5d0a 2020 2020 2020 2020 2020      ].          
-00005e60: 2020 2320 4e6f 7465 203a 2072 656d 6f76    # Note : remov
-00005e70: 6520 616c 6c20 6d61 7374 6572 6461 7461  e all masterdata
-00005e80: 2066 6965 6c64 730a 2020 2020 2020 2020   fields.        
-00005e90: 2020 2020 2320 6265 6361 7573 6520 7468      # because th
-00005ea0: 6520 6375 7261 7465 6420 7265 636f 7264  e curated record
-00005eb0: 206d 6179 2068 6176 6520 6665 7765 7220   may have fewer 
-00005ec0: 6d61 7374 6572 6461 7461 2066 6965 6c64  masterdata field
-00005ed0: 730a 2020 2020 2020 2020 2020 2020 2320  s.            # 
-00005ee0: 616e 6420 7765 2069 7465 7261 7465 206f  and we iterate o
-00005ef0: 7665 7220 7468 6520 6375 7261 7465 6420  ver the curated 
-00005f00: 7265 636f 7264 2028 6d65 7267 696e 675f  record (merging_
-00005f10: 7265 636f 7264 2920 696e 2074 6865 206e  record) in the n
-00005f20: 6578 7420 7374 6570 0a20 2020 2020 2020  ext step.       
-00005f30: 2020 2020 2066 6f72 206b 2069 6e20 6c69       for k in li
-00005f40: 7374 2873 656c 662e 6461 7461 2e6b 6579  st(self.data.key
-00005f50: 7328 2929 3a0a 2020 2020 2020 2020 2020  s()):.          
-00005f60: 2020 2020 2020 6966 206b 2069 6e20 5265        if k in Re
-00005f70: 636f 7264 2e69 6465 6e74 6966 7969 6e67  cord.identifying
-00005f80: 5f66 6965 6c64 5f6b 6579 7320 616e 6420  _field_keys and 
-00005f90: 6b20 213d 2022 7061 6765 7322 3a0a 2020  k != "pages":.  
-00005fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005fb0: 2020 6465 6c20 7365 6c66 2e64 6174 615b    del self.data[
-00005fc0: 6b5d 0a0a 2020 2020 2020 2020 666f 7220  k]..        for 
-00005fd0: 6b65 7920 696e 206c 6973 7428 6d65 7267  key in list(merg
-00005fe0: 696e 675f 7265 636f 7264 2e64 6174 612e  ing_record.data.
-00005ff0: 6b65 7973 2829 293a 0a20 2020 2020 2020  keys()):.       
-00006000: 2020 2020 2076 616c 203d 2073 656c 662e       val = self.
-00006010: 5f5f 6765 745f 6d65 7267 696e 675f 7661  __get_merging_va
-00006020: 6c28 6d65 7267 696e 675f 7265 636f 7264  l(merging_record
-00006030: 3d6d 6572 6769 6e67 5f72 6563 6f72 642c  =merging_record,
-00006040: 206b 6579 3d6b 6579 290a 2020 2020 2020   key=key).      
-00006050: 2020 2020 2020 6966 2076 616c 203d 3d20        if val == 
-00006060: 2222 3a0a 2020 2020 2020 2020 2020 2020  "":.            
-00006070: 2020 2020 636f 6e74 696e 7565 0a0a 2020      continue..  
-00006080: 2020 2020 2020 2020 2020 6669 656c 645f            field_
-00006090: 7072 6f76 656e 616e 6365 203d 206d 6572  provenance = mer
-000060a0: 6769 6e67 5f72 6563 6f72 642e 6765 745f  ging_record.get_
-000060b0: 6669 656c 645f 7072 6f76 656e 616e 6365  field_provenance
-000060c0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-000060d0: 2020 6b65 793d 6b65 792c 2064 6566 6175    key=key, defau
-000060e0: 6c74 5f73 6f75 7263 653d 6465 6661 756c  lt_source=defaul
-000060f0: 745f 736f 7572 6365 0a20 2020 2020 2020  t_source.       
-00006100: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-00006110: 2020 2073 6f75 7263 6520 3d20 6669 656c     source = fiel
-00006120: 645f 7072 6f76 656e 616e 6365 5b22 736f  d_provenance["so
-00006130: 7572 6365 225d 0a20 2020 2020 2020 2020  urce"].         
-00006140: 2020 206e 6f74 6520 3d20 6669 656c 645f     note = field_
-00006150: 7072 6f76 656e 616e 6365 5b22 6e6f 7465  provenance["note
-00006160: 225d 0a0a 2020 2020 2020 2020 2020 2020  "]..            
-00006170: 2320 416c 7761 7973 2075 7064 6174 6520  # Always update 
-00006180: 6672 6f6d 2063 7572 6174 6564 206d 6572  from curated mer
-00006190: 6769 6e67 5f72 6563 6f72 6473 0a20 2020  ging_records.   
-000061a0: 2020 2020 2020 2020 2069 6620 6d65 7267           if merg
-000061b0: 696e 675f 7265 636f 7264 2e6d 6173 7465  ing_record.maste
-000061c0: 7264 6174 615f 6973 5f63 7572 6174 6564  rdata_is_curated
-000061d0: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-000061e0: 2020 2020 7365 6c66 2e64 6174 615b 6b65      self.data[ke
-000061f0: 795d 203d 206d 6572 6769 6e67 5f72 6563  y] = merging_rec
-00006200: 6f72 642e 6461 7461 5b6b 6579 5d0a 2020  ord.data[key].  
-00006210: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00006220: 206b 6579 206e 6f74 2069 6e20 5265 636f   key not in Reco
-00006230: 7264 2e69 6465 6e74 6966 7969 6e67 5f66  rd.identifying_f
-00006240: 6965 6c64 5f6b 6579 7320 2b20 5b22 454e  ield_keys + ["EN
-00006250: 5452 5954 5950 4522 5d3a 0a20 2020 2020  TRYTYPE"]:.     
-00006260: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00006270: 656c 662e 6164 645f 6461 7461 5f70 726f  elf.add_data_pro
-00006280: 7665 6e61 6e63 6528 6b65 793d 6b65 792c  venance(key=key,
-00006290: 2073 6f75 7263 653d 736f 7572 6365 2c20   source=source, 
-000062a0: 6e6f 7465 3d6e 6f74 6529 0a0a 2020 2020  note=note)..    
-000062b0: 2020 2020 2020 2020 2320 446f 206e 6f74          # Do not
-000062c0: 2063 6861 6e67 6520 6966 204d 4552 4749   change if MERGI
-000062d0: 4e47 5f52 4543 4f52 4420 6973 206e 6f74  NG_RECORD is not
-000062e0: 2063 7572 6174 6564 0a20 2020 2020 2020   curated.       
-000062f0: 2020 2020 2065 6c69 6620 280a 2020 2020       elif (.    
-00006300: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00006310: 2e6d 6173 7465 7264 6174 615f 6973 5f63  .masterdata_is_c
-00006320: 7572 6174 6564 2829 0a20 2020 2020 2020  urated().       
-00006330: 2020 2020 2020 2020 2061 6e64 206e 6f74           and not
-00006340: 206d 6572 6769 6e67 5f72 6563 6f72 642e   merging_record.
-00006350: 6d61 7374 6572 6461 7461 5f69 735f 6375  masterdata_is_cu
-00006360: 7261 7465 6428 290a 2020 2020 2020 2020  rated().        
-00006370: 2020 2020 293a 0a20 2020 2020 2020 2020      ):.         
-00006380: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
-00006390: 0a20 2020 2020 2020 2020 2020 2023 2050  .            # P
-000063a0: 6172 7420 313a 2069 6465 6e74 6966 7969  art 1: identifyi
-000063b0: 6e67 2066 6965 6c64 730a 2020 2020 2020  ng fields.      
-000063c0: 2020 2020 2020 6966 206b 6579 2069 6e20        if key in 
-000063d0: 5265 636f 7264 2e69 6465 6e74 6966 7969  Record.identifyi
-000063e0: 6e67 5f66 6965 6c64 5f6b 6579 733a 0a20  ng_field_keys:. 
-000063f0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00006400: 6620 7072 6566 6572 7265 645f 6d61 7374  f preferred_mast
-00006410: 6572 6461 7461 5f73 6f75 7263 655f 7072  erdata_source_pr
-00006420: 6566 6978 6573 3a0a 2020 2020 2020 2020  efixes:.        
-00006430: 2020 2020 2020 2020 2020 2020 6966 206d              if m
-00006440: 6572 6769 6e67 5f72 6563 6f72 645f 7072  erging_record_pr
-00006450: 6566 6572 7265 643a 0a20 2020 2020 2020  eferred:.       
-00006460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006470: 2073 656c 662e 7570 6461 7465 5f66 6965   self.update_fie
-00006480: 6c64 280a 2020 2020 2020 2020 2020 2020  ld(.            
-00006490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000064a0: 6b65 793d 6b65 792c 2076 616c 7565 3d73  key=key, value=s
-000064b0: 7472 2876 616c 292c 2073 6f75 7263 653d  tr(val), source=
-000064c0: 736f 7572 6365 2c20 6170 7065 6e64 5f65  source, append_e
-000064d0: 6469 743d 4661 6c73 650a 2020 2020 2020  dit=False.      
-000064e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000064f0: 2020 290a 0a20 2020 2020 2020 2020 2020    )..           
-00006500: 2020 2020 2023 2046 7573 6520 6265 7374       # Fuse best
-00006510: 2066 6965 6c64 7320 6966 206e 6f6e 6520   fields if none 
-00006520: 6973 2063 7572 6174 6564 0a20 2020 2020  is curated.     
-00006530: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00006540: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006550: 2020 2020 2073 656c 662e 5f5f 6675 7365       self.__fuse
-00006560: 5f62 6573 745f 6669 656c 6428 0a20 2020  _best_field(.   
-00006570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006580: 2020 2020 206d 6572 6769 6e67 5f72 6563       merging_rec
-00006590: 6f72 643d 6d65 7267 696e 675f 7265 636f  ord=merging_reco
-000065a0: 7264 2c0a 2020 2020 2020 2020 2020 2020  rd,.            
-000065b0: 2020 2020 2020 2020 2020 2020 6b65 793d              key=
-000065c0: 6b65 792c 0a20 2020 2020 2020 2020 2020  key,.           
-000065d0: 2020 2020 2020 2020 2020 2020 2076 616c               val
-000065e0: 3d73 7472 2876 616c 292c 0a20 2020 2020  =str(val),.     
-000065f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006600: 2020 2073 6f75 7263 653d 736f 7572 6365     source=source
-00006610: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00006620: 2020 2020 2020 2020 2020 6e6f 7465 3d6e            note=n
-00006630: 6f74 652c 0a20 2020 2020 2020 2020 2020  ote,.           
-00006640: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
-00006650: 2020 2020 2020 2020 2320 5061 7274 2032          # Part 2
-00006660: 3a20 6f74 6865 7220 6669 656c 6473 0a20  : other fields. 
-00006670: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00006680: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006690: 2023 206b 6565 7020 6578 6973 7469 6e67   # keep existing
-000066a0: 2076 616c 7565 7320 7065 7220 6465 6661   values per defa
-000066b0: 756c 740a 2020 2020 2020 2020 2020 2020  ult.            
-000066c0: 2020 2020 6966 206b 6579 2069 6e20 7365      if key in se
-000066d0: 6c66 2e64 6174 613a 0a20 2020 2020 2020  lf.data:.       
-000066e0: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-000066f0: 7469 6e75 650a 2020 2020 2020 2020 2020  tinue.          
-00006700: 2020 2020 2020 7365 6c66 2e75 7064 6174        self.updat
-00006710: 655f 6669 656c 6428 0a20 2020 2020 2020  e_field(.       
-00006720: 2020 2020 2020 2020 2020 2020 206b 6579               key
-00006730: 3d6b 6579 2c0a 2020 2020 2020 2020 2020  =key,.          
-00006740: 2020 2020 2020 2020 2020 7661 6c75 653d            value=
-00006750: 7374 7228 7661 6c29 2c0a 2020 2020 2020  str(val),.      
-00006760: 2020 2020 2020 2020 2020 2020 2020 736f                so
-00006770: 7572 6365 3d73 6f75 7263 652c 0a20 2020  urce=source,.   
-00006780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006790: 206e 6f74 653d 6e6f 7465 2c0a 2020 2020   note=note,.    
+00004b20: 6966 2022 6e75 6d62 6572 2220 696e 2073  if "number" in s
+00004b30: 656c 662e 6461 7461 5b22 636f 6c72 6576  elf.data["colrev
+00004b40: 5f6d 6173 7465 7264 6174 615f 7072 6f76  _masterdata_prov
+00004b50: 656e 616e 6365 225d 3a0a 2020 2020 2020  enance"]:.      
+00004b60: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00004b70: 6c66 2e64 6174 615b 2263 6f6c 7265 765f  lf.data["colrev_
+00004b80: 6d61 7374 6572 6461 7461 5f70 726f 7665  masterdata_prove
+00004b90: 6e61 6e63 6522 5d5b 226e 756d 6265 7222  nance"]["number"
+00004ba0: 5d5b 0a20 2020 2020 2020 2020 2020 2020  ][.             
+00004bb0: 2020 2020 2020 2020 2020 2022 6e6f 7465             "note
+00004bc0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00004bd0: 2020 2020 2020 5d20 3d20 226e 6f74 2d6d        ] = "not-m
+00004be0: 6973 7369 6e67 220a 2020 2020 2020 2020  issing".        
+00004bf0: 2020 2020 2020 2020 2020 2020 6966 2072              if r
+00004c00: 6570 6c61 6365 5f73 6f75 7263 653a 0a20  eplace_source:. 
+00004c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004c20: 2020 2020 2020 2073 656c 662e 6461 7461         self.data
+00004c30: 5b22 636f 6c72 6576 5f6d 6173 7465 7264  ["colrev_masterd
+00004c40: 6174 615f 7072 6f76 656e 616e 6365 225d  ata_provenance"]
+00004c50: 5b22 6e75 6d62 6572 225d 5b0a 2020 2020  ["number"][.    
+00004c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004c70: 2020 2020 2020 2020 2273 6f75 7263 6522          "source"
+00004c80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004c90: 2020 2020 2020 2020 205d 203d 2073 6f75           ] = sou
+00004ca0: 7263 650a 2020 2020 2020 2020 2020 2020  rce.            
+00004cb0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00004cc0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00004cd0: 6c66 2e64 6174 615b 2263 6f6c 7265 765f  lf.data["colrev_
+00004ce0: 6d61 7374 6572 6461 7461 5f70 726f 7665  masterdata_prove
+00004cf0: 6e61 6e63 6522 5d5b 226e 756d 6265 7222  nance"]["number"
+00004d00: 5d20 3d20 7b0a 2020 2020 2020 2020 2020  ] = {.          
+00004d10: 2020 2020 2020 2020 2020 2020 2020 2273                "s
+00004d20: 6f75 7263 6522 3a20 736f 7572 6365 2c0a  ource": source,.
+00004d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004d40: 2020 2020 2020 2020 226e 6f74 6522 3a20          "note": 
+00004d50: 226e 6f74 2d6d 6973 7369 6e67 222c 0a20  "not-missing",. 
+00004d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004d70: 2020 207d 0a0a 2020 2020 6465 6620 7365     }..    def se
+00004d80: 745f 6d61 7374 6572 6461 7461 5f63 6f6e  t_masterdata_con
+00004d90: 7369 7374 656e 7428 7365 6c66 2920 2d3e  sistent(self) ->
+00004da0: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
+00004db0: 2222 5365 7420 7468 6520 6d61 7374 6572  ""Set the master
+00004dc0: 6461 7461 2074 6f20 636f 6e73 6973 7465  data to consiste
+00004dd0: 6e74 2222 220a 2020 2020 2020 2020 6966  nt""".        if
+00004de0: 2022 636f 6c72 6576 5f6d 6173 7465 7264   "colrev_masterd
+00004df0: 6174 615f 7072 6f76 656e 616e 6365 2220  ata_provenance" 
+00004e00: 6e6f 7420 696e 2073 656c 662e 6461 7461  not in self.data
+00004e10: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+00004e20: 6c66 2e64 6174 615b 2263 6f6c 7265 765f  lf.data["colrev_
+00004e30: 6d61 7374 6572 6461 7461 5f70 726f 7665  masterdata_prove
+00004e40: 6e61 6e63 6522 5d20 3d20 7b7d 0a20 2020  nance"] = {}.   
+00004e50: 2020 2020 206d 645f 705f 6469 6374 203d       md_p_dict =
+00004e60: 2073 656c 662e 6461 7461 5b22 636f 6c72   self.data["colr
+00004e70: 6576 5f6d 6173 7465 7264 6174 615f 7072  ev_masterdata_pr
+00004e80: 6f76 656e 616e 6365 225d 0a0a 2020 2020  ovenance"]..    
+00004e90: 2020 2020 666f 7220 6964 656e 7469 6679      for identify
+00004ea0: 696e 675f 6669 656c 645f 6b65 7920 696e  ing_field_key in
+00004eb0: 2073 656c 662e 6964 656e 7469 6679 696e   self.identifyin
+00004ec0: 675f 6669 656c 645f 6b65 7973 3a0a 2020  g_field_keys:.  
+00004ed0: 2020 2020 2020 2020 2020 6966 2069 6465            if ide
+00004ee0: 6e74 6966 7969 6e67 5f66 6965 6c64 5f6b  ntifying_field_k
+00004ef0: 6579 2069 6e20 6d64 5f70 5f64 6963 743a  ey in md_p_dict:
+00004f00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004f10: 206e 6f74 6520 3d20 6d64 5f70 5f64 6963   note = md_p_dic
+00004f20: 745b 6964 656e 7469 6679 696e 675f 6669  t[identifying_fi
+00004f30: 656c 645f 6b65 795d 5b22 6e6f 7465 225d  eld_key]["note"]
+00004f40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004f50: 2069 6620 2269 6e63 6f6e 7369 7374 656e   if "inconsisten
+00004f60: 742d 7769 7468 2d65 6e74 7279 7479 7065  t-with-entrytype
+00004f70: 2220 696e 206e 6f74 653a 0a20 2020 2020  " in note:.     
+00004f80: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00004f90: 645f 705f 6469 6374 5b69 6465 6e74 6966  d_p_dict[identif
+00004fa0: 7969 6e67 5f66 6965 6c64 5f6b 6579 5d5b  ying_field_key][
+00004fb0: 226e 6f74 6522 5d20 3d20 6e6f 7465 2e72  "note"] = note.r
+00004fc0: 6570 6c61 6365 280a 2020 2020 2020 2020  eplace(.        
+00004fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004fe0: 2269 6e63 6f6e 7369 7374 656e 742d 7769  "inconsistent-wi
+00004ff0: 7468 2d65 6e74 7279 7479 7065 222c 2022  th-entrytype", "
+00005000: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00005010: 2020 2020 2020 290a 0a20 2020 2064 6566        )..    def
+00005020: 2072 6573 6574 5f70 6466 5f70 726f 7665   reset_pdf_prove
+00005030: 6e61 6e63 655f 6e6f 7465 7328 7365 6c66  nance_notes(self
+00005040: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+00005050: 2020 2022 2222 5265 7365 7420 7468 6520     """Reset the 
+00005060: 5044 4620 2866 696c 6529 2070 726f 7665  PDF (file) prove
+00005070: 6e61 6e63 6520 6e6f 7465 7322 2222 0a20  nance notes""". 
+00005080: 2020 2020 2020 2069 6620 2263 6f6c 7265         if "colre
+00005090: 765f 6461 7461 5f70 726f 7665 6e61 6e63  v_data_provenanc
+000050a0: 6522 206e 6f74 2069 6e20 7365 6c66 2e64  e" not in self.d
+000050b0: 6174 613a 0a20 2020 2020 2020 2020 2020  ata:.           
+000050c0: 2073 656c 662e 6164 645f 6461 7461 5f70   self.add_data_p
+000050d0: 726f 7665 6e61 6e63 655f 6e6f 7465 286b  rovenance_note(k
+000050e0: 6579 3d22 6669 6c65 222c 206e 6f74 653d  ey="file", note=
+000050f0: 2222 290a 2020 2020 2020 2020 656c 7365  "").        else
+00005100: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+00005110: 2022 6669 6c65 2220 696e 2073 656c 662e   "file" in self.
+00005120: 6461 7461 5b22 636f 6c72 6576 5f64 6174  data["colrev_dat
+00005130: 615f 7072 6f76 656e 616e 6365 225d 3a0a  a_provenance"]:.
+00005140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005150: 7365 6c66 2e64 6174 615b 2263 6f6c 7265  self.data["colre
+00005160: 765f 6461 7461 5f70 726f 7665 6e61 6e63  v_data_provenanc
+00005170: 6522 5d5b 2266 696c 6522 5d5b 226e 6f74  e"]["file"]["not
+00005180: 6522 5d20 3d20 2222 0a20 2020 2020 2020  e"] = "".       
+00005190: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+000051a0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000051b0: 6461 7461 5b22 636f 6c72 6576 5f64 6174  data["colrev_dat
+000051c0: 615f 7072 6f76 656e 616e 6365 225d 5b22  a_provenance"]["
+000051d0: 6669 6c65 225d 203d 207b 0a20 2020 2020  file"] = {.     
+000051e0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+000051f0: 736f 7572 6365 223a 2022 4e41 222c 0a20  source": "NA",. 
+00005200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005210: 2020 2022 6e6f 7465 223a 2022 222c 0a20     "note": "",. 
+00005220: 2020 2020 2020 2020 2020 2020 2020 207d                 }
+00005230: 0a0a 2020 2020 6465 6620 5f5f 6d65 7267  ..    def __merg
+00005240: 655f 6f72 6967 696e 7328 7365 6c66 2c20  e_origins(self, 
+00005250: 2a2c 206d 6572 6769 6e67 5f72 6563 6f72  *, merging_recor
+00005260: 643a 2052 6563 6f72 6429 202d 3e20 4e6f  d: Record) -> No
+00005270: 6e65 3a0a 2020 2020 2020 2020 2222 224d  ne:.        """M
+00005280: 6572 6765 2074 6865 206f 7269 6769 6e73  erge the origins
+00005290: 2077 6974 6820 7468 6f73 6520 6f66 2074   with those of t
+000052a0: 6865 206d 6572 6769 6e67 5f72 6563 6f72  he merging_recor
+000052b0: 6422 2222 0a0a 2020 2020 2020 2020 6966  d"""..        if
+000052c0: 2022 636f 6c72 6576 5f6f 7269 6769 6e22   "colrev_origin"
+000052d0: 2069 6e20 6d65 7267 696e 675f 7265 636f   in merging_reco
+000052e0: 7264 2e64 6174 613a 0a20 2020 2020 2020  rd.data:.       
+000052f0: 2020 2020 206f 7269 6769 6e73 203d 2073       origins = s
+00005300: 656c 662e 6461 7461 5b22 636f 6c72 6576  elf.data["colrev
+00005310: 5f6f 7269 6769 6e22 5d20 2b20 6d65 7267  _origin"] + merg
+00005320: 696e 675f 7265 636f 7264 2e64 6174 615b  ing_record.data[
+00005330: 2263 6f6c 7265 765f 6f72 6967 696e 225d  "colrev_origin"]
+00005340: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00005350: 662e 6461 7461 5b22 636f 6c72 6576 5f6f  f.data["colrev_o
+00005360: 7269 6769 6e22 5d20 3d20 736f 7274 6564  rigin"] = sorted
+00005370: 286c 6973 7428 7365 7428 6f72 6967 696e  (list(set(origin
+00005380: 7329 2929 0a0a 2020 2020 6465 6620 5f5f  s)))..    def __
+00005390: 6d65 7267 655f 7374 6174 7573 2873 656c  merge_status(sel
+000053a0: 662c 202a 2c20 6d65 7267 696e 675f 7265  f, *, merging_re
+000053b0: 636f 7264 3a20 5265 636f 7264 2920 2d3e  cord: Record) ->
+000053c0: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
+000053d0: 2222 4d65 7267 6520 7468 6520 7374 6174  ""Merge the stat
+000053e0: 7573 2077 6974 6820 7468 6520 6d65 7267  us with the merg
+000053f0: 696e 675f 7265 636f 7264 2222 220a 0a20  ing_record""".. 
+00005400: 2020 2020 2020 2069 6620 2263 6f6c 7265         if "colre
+00005410: 765f 7374 6174 7573 2220 696e 206d 6572  v_status" in mer
+00005420: 6769 6e67 5f72 6563 6f72 642e 6461 7461  ging_record.data
+00005430: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
+00005440: 5365 7420 626f 7468 2073 7461 7475 7320  Set both status 
+00005450: 746f 2074 6865 206c 6174 7465 7220 696e  to the latter in
+00005460: 2074 6865 2073 7461 7465 206d 6f64 656c   the state model
+00005470: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00005480: 7365 6c66 2e64 6174 615b 2263 6f6c 7265  self.data["colre
+00005490: 765f 7374 6174 7573 225d 203c 206d 6572  v_status"] < mer
+000054a0: 6769 6e67 5f72 6563 6f72 642e 6461 7461  ging_record.data
+000054b0: 5b22 636f 6c72 6576 5f73 7461 7475 7322  ["colrev_status"
+000054c0: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
+000054d0: 2020 2073 656c 662e 7365 745f 7374 6174     self.set_stat
+000054e0: 7573 2874 6172 6765 745f 7374 6174 653d  us(target_state=
+000054f0: 6d65 7267 696e 675f 7265 636f 7264 2e64  merging_record.d
+00005500: 6174 615b 2263 6f6c 7265 765f 7374 6174  ata["colrev_stat
+00005510: 7573 225d 290a 2020 2020 2020 2020 2020  us"]).          
+00005520: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00005530: 2020 2020 2020 2020 6d65 7267 696e 675f          merging_
+00005540: 7265 636f 7264 2e73 6574 5f73 7461 7475  record.set_statu
+00005550: 7328 7461 7267 6574 5f73 7461 7465 3d73  s(target_state=s
+00005560: 656c 662e 6461 7461 5b22 636f 6c72 6576  elf.data["colrev
+00005570: 5f73 7461 7475 7322 5d29 0a0a 2020 2020  _status"])..    
+00005580: 6465 6620 5f5f 6765 745f 6d65 7267 696e  def __get_mergin
+00005590: 675f 7661 6c28 7365 6c66 2c20 2a2c 206d  g_val(self, *, m
+000055a0: 6572 6769 6e67 5f72 6563 6f72 643a 2052  erging_record: R
+000055b0: 6563 6f72 642c 206b 6579 3a20 7374 7229  ecord, key: str)
+000055c0: 202d 3e20 7374 723a 0a20 2020 2020 2020   -> str:.       
+000055d0: 2076 616c 203d 206d 6572 6769 6e67 5f72   val = merging_r
+000055e0: 6563 6f72 642e 6461 7461 2e67 6574 286b  ecord.data.get(k
+000055f0: 6579 2c20 2222 290a 0a20 2020 2020 2020  ey, "")..       
+00005600: 2069 6620 7661 6c20 3d3d 2022 223a 0a20   if val == "":. 
+00005610: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00005620: 6e20 2222 0a20 2020 2020 2020 2069 6620  n "".        if 
+00005630: 6e6f 7420 7661 6c3a 0a20 2020 2020 2020  not val:.       
+00005640: 2020 2020 2072 6574 7572 6e20 2222 0a0a       return ""..
+00005650: 2020 2020 2020 2020 2320 646f 206e 6f74          # do not
+00005660: 206f 7665 7272 6964 6520 7072 6f76 656e   override proven
+00005670: 616e 6365 2c20 4944 2c20 2e2e 2e20 6669  ance, ID, ... fi
+00005680: 656c 6473 0a20 2020 2020 2020 2069 6620  elds.        if 
+00005690: 6b65 7920 696e 205b 0a20 2020 2020 2020  key in [.       
+000056a0: 2020 2020 2022 4944 222c 0a20 2020 2020       "ID",.     
+000056b0: 2020 2020 2020 2022 636f 6c72 6576 5f6d         "colrev_m
+000056c0: 6173 7465 7264 6174 615f 7072 6f76 656e  asterdata_proven
+000056d0: 616e 6365 222c 0a20 2020 2020 2020 2020  ance",.         
+000056e0: 2020 2022 636f 6c72 6576 5f64 6174 615f     "colrev_data_
+000056f0: 7072 6f76 656e 616e 6365 222c 0a20 2020  provenance",.   
+00005700: 2020 2020 2020 2020 2022 636f 6c72 6576           "colrev
+00005710: 5f69 6422 2c0a 2020 2020 2020 2020 2020  _id",.          
+00005720: 2020 2263 6f6c 7265 765f 7374 6174 7573    "colrev_status
+00005730: 222c 0a20 2020 2020 2020 2020 2020 2022  ",.            "
+00005740: 636f 6c72 6576 5f6f 7269 6769 6e22 2c0a  colrev_origin",.
+00005750: 2020 2020 2020 2020 2020 2020 224d 4f56              "MOV
+00005760: 4544 5f44 5550 455f 4944 222c 0a20 2020  ED_DUPE_ID",.   
+00005770: 2020 2020 205d 3a0a 2020 2020 2020 2020       ]:.        
+00005780: 2020 2020 7265 7475 726e 2022 220a 0a20      return "".. 
+00005790: 2020 2020 2020 2072 6574 7572 6e20 7661         return va
+000057a0: 6c0a 0a20 2020 2064 6566 205f 5f70 7265  l..    def __pre
+000057b0: 7665 6e74 5f69 6e76 616c 6964 5f6d 6572  vent_invalid_mer
+000057c0: 6765 7328 7365 6c66 2c20 2a2c 206d 6572  ges(self, *, mer
+000057d0: 6769 6e67 5f72 6563 6f72 643a 2052 6563  ging_record: Rec
+000057e0: 6f72 6429 202d 3e20 4e6f 6e65 3a0a 2020  ord) -> None:.  
+000057f0: 2020 2020 2020 2222 2250 7265 7665 6e74        """Prevent
+00005800: 7320 696e 7661 6c69 6420 6d65 7267 6573  s invalid merges
+00005810: 206c 696b 6520 2e2e 2e20 7061 7274 2031   like ... part 1
+00005820: 202f 202e 2e2e 2070 6172 7420 3222 2222   / ... part 2"""
+00005830: 0a0a 2020 2020 2020 2020 6c6f 7765 725f  ..        lower_
+00005840: 7469 746c 655f 6120 3d20 7365 6c66 2e64  title_a = self.d
+00005850: 6174 612e 6765 7428 2274 6974 6c65 222c  ata.get("title",
+00005860: 2022 2229 2e6c 6f77 6572 2829 0a20 2020   "").lower().   
+00005870: 2020 2020 206c 6f77 6572 5f74 6974 6c65       lower_title
+00005880: 5f62 203d 206d 6572 6769 6e67 5f72 6563  _b = merging_rec
+00005890: 6f72 642e 6461 7461 2e67 6574 2822 7469  ord.data.get("ti
+000058a0: 746c 6522 2c20 2222 292e 6c6f 7765 7228  tle", "").lower(
+000058b0: 290a 0a20 2020 2020 2020 2070 6172 745f  )..        part_
+000058c0: 6d61 7463 685f 6120 3d20 7265 2e66 696e  match_a = re.fin
+000058d0: 6461 6c6c 2872 2270 6172 7420 5b41 2d5a  dall(r"part [A-Z
+000058e0: 612d 7a30 2d39 5d2b 2422 2c20 6c6f 7765  a-z0-9]+$", lowe
+000058f0: 725f 7469 746c 655f 6129 0a20 2020 2020  r_title_a).     
+00005900: 2020 2070 6172 745f 6d61 7463 685f 6220     part_match_b 
+00005910: 3d20 7265 2e66 696e 6461 6c6c 2872 2270  = re.findall(r"p
+00005920: 6172 7420 5b41 2d5a 612d 7a30 2d39 5d2b  art [A-Za-z0-9]+
+00005930: 2422 2c20 6c6f 7765 725f 7469 746c 655f  $", lower_title_
+00005940: 6229 0a0a 2020 2020 2020 2020 6966 2070  b)..        if p
+00005950: 6172 745f 6d61 7463 685f 6120 213d 2070  art_match_a != p
+00005960: 6172 745f 6d61 7463 685f 623a 0a20 2020  art_match_b:.   
+00005970: 2020 2020 2020 2020 2072 6169 7365 2063           raise c
+00005980: 6f6c 7265 765f 6578 6365 7074 696f 6e73  olrev_exceptions
+00005990: 2e49 6e76 616c 6964 4d65 7267 6528 7265  .InvalidMerge(re
+000059a0: 636f 7264 5f61 3d73 656c 662c 2072 6563  cord_a=self, rec
+000059b0: 6f72 645f 623d 6d65 7267 696e 675f 7265  ord_b=merging_re
+000059c0: 636f 7264 290a 0a20 2020 2020 2020 2074  cord)..        t
+000059d0: 6572 6d73 5f72 6571 7569 7265 645f 746f  erms_required_to
+000059e0: 5f6d 6174 6368 203d 205b 0a20 2020 2020  _match = [.     
+000059f0: 2020 2020 2020 2022 6572 7261 7475 6d22         "erratum"
+00005a00: 2c0a 2020 2020 2020 2020 2020 2020 2263  ,.            "c
+00005a10: 6f72 7265 6374 696f 6e22 2c0a 2020 2020  orrection",.    
+00005a20: 2020 2020 2020 2020 2263 6f72 7269 6765          "corrige
+00005a30: 6e64 756d 222c 0a20 2020 2020 2020 2020  ndum",.         
+00005a40: 2020 2022 636f 6d6d 656e 7422 2c0a 2020     "comment",.  
+00005a50: 2020 2020 2020 2020 2020 2263 6f6d 6d65            "comme
+00005a60: 6e74 6172 7922 2c0a 2020 2020 2020 2020  ntary",.        
+00005a70: 2020 2020 2272 6573 706f 6e73 6522 2c0a      "response",.
+00005a80: 2020 2020 2020 2020 5d0a 2020 2020 2020          ].      
+00005a90: 2020 7465 726d 735f 696e 5f61 203d 205b    terms_in_a = [
+00005aa0: 7420 666f 7220 7420 696e 2074 6572 6d73  t for t in terms
+00005ab0: 5f72 6571 7569 7265 645f 746f 5f6d 6174  _required_to_mat
+00005ac0: 6368 2069 6620 7420 696e 206c 6f77 6572  ch if t in lower
+00005ad0: 5f74 6974 6c65 5f61 5d0a 2020 2020 2020  _title_a].      
+00005ae0: 2020 7465 726d 735f 696e 5f62 203d 205b    terms_in_b = [
+00005af0: 7420 666f 7220 7420 696e 2074 6572 6d73  t for t in terms
+00005b00: 5f72 6571 7569 7265 645f 746f 5f6d 6174  _required_to_mat
+00005b10: 6368 2069 6620 7420 696e 206c 6f77 6572  ch if t in lower
+00005b20: 5f74 6974 6c65 5f62 5d0a 0a20 2020 2020  _title_b]..     
+00005b30: 2020 2069 6620 7465 726d 735f 696e 5f61     if terms_in_a
+00005b40: 2021 3d20 7465 726d 735f 696e 5f62 3a0a   != terms_in_b:.
+00005b50: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00005b60: 6520 636f 6c72 6576 5f65 7863 6570 7469  e colrev_excepti
+00005b70: 6f6e 732e 496e 7661 6c69 644d 6572 6765  ons.InvalidMerge
+00005b80: 2872 6563 6f72 645f 613d 7365 6c66 2c20  (record_a=self, 
+00005b90: 7265 636f 7264 5f62 3d6d 6572 6769 6e67  record_b=merging
+00005ba0: 5f72 6563 6f72 6429 0a0a 2020 2020 6465  _record)..    de
+00005bb0: 6620 6d65 7267 6528 0a20 2020 2020 2020  f merge(.       
+00005bc0: 2073 656c 662c 0a20 2020 2020 2020 202a   self,.        *
+00005bd0: 2c0a 2020 2020 2020 2020 6d65 7267 696e  ,.        mergin
+00005be0: 675f 7265 636f 7264 3a20 5265 636f 7264  g_record: Record
+00005bf0: 2c0a 2020 2020 2020 2020 6465 6661 756c  ,.        defaul
+00005c00: 745f 736f 7572 6365 3a20 7374 722c 0a20  t_source: str,. 
+00005c10: 2020 2020 2020 2070 7265 6665 7272 6564         preferred
+00005c20: 5f6d 6173 7465 7264 6174 615f 736f 7572  _masterdata_sour
+00005c30: 6365 5f70 7265 6669 7865 733a 204f 7074  ce_prefixes: Opt
+00005c40: 696f 6e61 6c5b 6c69 7374 5d20 3d20 4e6f  ional[list] = No
+00005c50: 6e65 2c0a 2020 2020 2920 2d3e 204e 6f6e  ne,.    ) -> Non
+00005c60: 653a 0a20 2020 2020 2020 2022 2222 4765  e:.        """Ge
+00005c70: 6e65 7261 6c2d 7075 7270 6f73 6520 7265  neral-purpose re
+00005c80: 636f 7264 206d 6572 6769 6e67 0a20 2020  cord merging.   
+00005c90: 2020 2020 2066 6f72 2070 7265 7061 7261       for prepara
+00005ca0: 7469 6f6e 2c20 6375 7261 7465 642f 6e6f  tion, curated/no
+00005cb0: 6e2d 6375 7261 7465 6420 7265 636f 7264  n-curated record
+00005cc0: 7320 616e 6420 7265 636f 7264 7320 7769  s and records wi
+00005cd0: 7468 206f 7269 6769 6e73 0a0a 0a20 2020  th origins...   
+00005ce0: 2020 2020 2041 7070 6c79 2068 6575 7269       Apply heuri
+00005cf0: 7374 6963 7320 746f 2063 7265 6174 6520  stics to create 
+00005d00: 6120 6675 7369 6f6e 206f 6620 7468 6520  a fusion of the 
+00005d10: 6265 7374 2066 6965 6c64 7320 6261 7365  best fields base
+00005d20: 6420 6f6e 0a20 2020 2020 2020 2071 7561  d on.        qua
+00005d30: 6c69 7479 2068 6575 7269 7374 6963 7322  lity heuristics"
+00005d40: 2222 0a0a 2020 2020 2020 2020 2320 7079  ""..        # py
+00005d50: 6c69 6e74 3a20 6469 7361 626c 653d 746f  lint: disable=to
+00005d60: 6f2d 6d61 6e79 2d62 7261 6e63 6865 730a  o-many-branches.
+00005d70: 0a20 2020 2020 2020 206d 6572 6769 6e67  .        merging
+00005d80: 5f72 6563 6f72 645f 7072 6566 6572 7265  _record_preferre
+00005d90: 6420 3d20 4661 6c73 650a 2020 2020 2020  d = False.      
+00005da0: 2020 6966 2070 7265 6665 7272 6564 5f6d    if preferred_m
+00005db0: 6173 7465 7264 6174 615f 736f 7572 6365  asterdata_source
+00005dc0: 5f70 7265 6669 7865 733a 0a20 2020 2020  _prefixes:.     
+00005dd0: 2020 2020 2020 2069 6620 616e 7928 0a20         if any(. 
+00005de0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00005df0: 6e79 2870 7320 696e 206f 7269 6769 6e20  ny(ps in origin 
+00005e00: 666f 7220 7073 2069 6e20 7072 6566 6572  for ps in prefer
+00005e10: 7265 645f 6d61 7374 6572 6461 7461 5f73  red_masterdata_s
+00005e20: 6f75 7263 655f 7072 6566 6978 6573 290a  ource_prefixes).
+00005e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005e40: 666f 7220 6f72 6967 696e 2069 6e20 6d65  for origin in me
+00005e50: 7267 696e 675f 7265 636f 7264 2e64 6174  rging_record.dat
+00005e60: 615b 2263 6f6c 7265 765f 6f72 6967 696e  a["colrev_origin
+00005e70: 225d 0a20 2020 2020 2020 2020 2020 2029  "].            )
+00005e80: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00005e90: 2020 6d65 7267 696e 675f 7265 636f 7264    merging_record
+00005ea0: 5f70 7265 6665 7272 6564 203d 2054 7275  _preferred = Tru
+00005eb0: 650a 0a20 2020 2020 2020 2073 656c 662e  e..        self.
+00005ec0: 5f5f 7072 6576 656e 745f 696e 7661 6c69  __prevent_invali
+00005ed0: 645f 6d65 7267 6573 286d 6572 6769 6e67  d_merges(merging
+00005ee0: 5f72 6563 6f72 643d 6d65 7267 696e 675f  _record=merging_
+00005ef0: 7265 636f 7264 290a 2020 2020 2020 2020  record).        
+00005f00: 7365 6c66 2e5f 5f6d 6572 6765 5f6f 7269  self.__merge_ori
+00005f10: 6769 6e73 286d 6572 6769 6e67 5f72 6563  gins(merging_rec
+00005f20: 6f72 643d 6d65 7267 696e 675f 7265 636f  ord=merging_reco
+00005f30: 7264 290a 2020 2020 2020 2020 7365 6c66  rd).        self
+00005f40: 2e5f 5f6d 6572 6765 5f73 7461 7475 7328  .__merge_status(
+00005f50: 6d65 7267 696e 675f 7265 636f 7264 3d6d  merging_record=m
+00005f60: 6572 6769 6e67 5f72 6563 6f72 6429 0a0a  erging_record)..
+00005f70: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
+00005f80: 656c 662e 6d61 7374 6572 6461 7461 5f69  elf.masterdata_i
+00005f90: 735f 6375 7261 7465 6428 2920 616e 6420  s_curated() and 
+00005fa0: 6d65 7267 696e 675f 7265 636f 7264 2e6d  merging_record.m
+00005fb0: 6173 7465 7264 6174 615f 6973 5f63 7572  asterdata_is_cur
+00005fc0: 6174 6564 2829 3a0a 2020 2020 2020 2020  ated():.        
+00005fd0: 2020 2020 7365 6c66 2e64 6174 615b 2263      self.data["c
+00005fe0: 6f6c 7265 765f 6d61 7374 6572 6461 7461  olrev_masterdata
+00005ff0: 5f70 726f 7665 6e61 6e63 6522 5d20 3d20  _provenance"] = 
+00006000: 6d65 7267 696e 675f 7265 636f 7264 2e64  merging_record.d
+00006010: 6174 615b 0a20 2020 2020 2020 2020 2020  ata[.           
+00006020: 2020 2020 2022 636f 6c72 6576 5f6d 6173       "colrev_mas
+00006030: 7465 7264 6174 615f 7072 6f76 656e 616e  terdata_provenan
+00006040: 6365 220a 2020 2020 2020 2020 2020 2020  ce".            
+00006050: 5d0a 2020 2020 2020 2020 2020 2020 2320  ].            # 
+00006060: 4e6f 7465 203a 2072 656d 6f76 6520 616c  Note : remove al
+00006070: 6c20 6d61 7374 6572 6461 7461 2066 6965  l masterdata fie
+00006080: 6c64 730a 2020 2020 2020 2020 2020 2020  lds.            
+00006090: 2320 6265 6361 7573 6520 7468 6520 6375  # because the cu
+000060a0: 7261 7465 6420 7265 636f 7264 206d 6179  rated record may
+000060b0: 2068 6176 6520 6665 7765 7220 6d61 7374   have fewer mast
+000060c0: 6572 6461 7461 2066 6965 6c64 730a 2020  erdata fields.  
+000060d0: 2020 2020 2020 2020 2020 2320 616e 6420            # and 
+000060e0: 7765 2069 7465 7261 7465 206f 7665 7220  we iterate over 
+000060f0: 7468 6520 6375 7261 7465 6420 7265 636f  the curated reco
+00006100: 7264 2028 6d65 7267 696e 675f 7265 636f  rd (merging_reco
+00006110: 7264 2920 696e 2074 6865 206e 6578 7420  rd) in the next 
+00006120: 7374 6570 0a20 2020 2020 2020 2020 2020  step.           
+00006130: 2066 6f72 206b 2069 6e20 6c69 7374 2873   for k in list(s
+00006140: 656c 662e 6461 7461 2e6b 6579 7328 2929  elf.data.keys())
+00006150: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00006160: 2020 6966 206b 2069 6e20 5265 636f 7264    if k in Record
+00006170: 2e69 6465 6e74 6966 7969 6e67 5f66 6965  .identifying_fie
+00006180: 6c64 5f6b 6579 7320 616e 6420 6b20 213d  ld_keys and k !=
+00006190: 2022 7061 6765 7322 3a0a 2020 2020 2020   "pages":.      
+000061a0: 2020 2020 2020 2020 2020 2020 2020 6465                de
+000061b0: 6c20 7365 6c66 2e64 6174 615b 6b5d 0a0a  l self.data[k]..
+000061c0: 2020 2020 2020 2020 666f 7220 6b65 7920          for key 
+000061d0: 696e 206c 6973 7428 6d65 7267 696e 675f  in list(merging_
+000061e0: 7265 636f 7264 2e64 6174 612e 6b65 7973  record.data.keys
+000061f0: 2829 293a 0a20 2020 2020 2020 2020 2020  ()):.           
+00006200: 2076 616c 203d 2073 656c 662e 5f5f 6765   val = self.__ge
+00006210: 745f 6d65 7267 696e 675f 7661 6c28 6d65  t_merging_val(me
+00006220: 7267 696e 675f 7265 636f 7264 3d6d 6572  rging_record=mer
+00006230: 6769 6e67 5f72 6563 6f72 642c 206b 6579  ging_record, key
+00006240: 3d6b 6579 290a 2020 2020 2020 2020 2020  =key).          
+00006250: 2020 6966 2076 616c 203d 3d20 2222 3a0a    if val == "":.
+00006260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006270: 636f 6e74 696e 7565 0a0a 2020 2020 2020  continue..      
+00006280: 2020 2020 2020 6669 656c 645f 7072 6f76        field_prov
+00006290: 656e 616e 6365 203d 206d 6572 6769 6e67  enance = merging
+000062a0: 5f72 6563 6f72 642e 6765 745f 6669 656c  _record.get_fiel
+000062b0: 645f 7072 6f76 656e 616e 6365 280a 2020  d_provenance(.  
+000062c0: 2020 2020 2020 2020 2020 2020 2020 6b65                ke
+000062d0: 793d 6b65 792c 2064 6566 6175 6c74 5f73  y=key, default_s
+000062e0: 6f75 7263 653d 6465 6661 756c 745f 736f  ource=default_so
+000062f0: 7572 6365 0a20 2020 2020 2020 2020 2020  urce.           
+00006300: 2029 0a20 2020 2020 2020 2020 2020 2073   ).            s
+00006310: 6f75 7263 6520 3d20 6669 656c 645f 7072  ource = field_pr
+00006320: 6f76 656e 616e 6365 5b22 736f 7572 6365  ovenance["source
+00006330: 225d 0a20 2020 2020 2020 2020 2020 206e  "].            n
+00006340: 6f74 6520 3d20 6669 656c 645f 7072 6f76  ote = field_prov
+00006350: 656e 616e 6365 5b22 6e6f 7465 225d 0a0a  enance["note"]..
+00006360: 2020 2020 2020 2020 2020 2020 2320 416c              # Al
+00006370: 7761 7973 2075 7064 6174 6520 6672 6f6d  ways update from
+00006380: 2063 7572 6174 6564 206d 6572 6769 6e67   curated merging
+00006390: 5f72 6563 6f72 6473 0a20 2020 2020 2020  _records.       
+000063a0: 2020 2020 2069 6620 6d65 7267 696e 675f       if merging_
+000063b0: 7265 636f 7264 2e6d 6173 7465 7264 6174  record.masterdat
+000063c0: 615f 6973 5f63 7572 6174 6564 2829 3a0a  a_is_curated():.
+000063d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000063e0: 7365 6c66 2e64 6174 615b 6b65 795d 203d  self.data[key] =
+000063f0: 206d 6572 6769 6e67 5f72 6563 6f72 642e   merging_record.
+00006400: 6461 7461 5b6b 6579 5d0a 2020 2020 2020  data[key].      
+00006410: 2020 2020 2020 2020 2020 6966 206b 6579            if key
+00006420: 206e 6f74 2069 6e20 5265 636f 7264 2e69   not in Record.i
+00006430: 6465 6e74 6966 7969 6e67 5f66 6965 6c64  dentifying_field
+00006440: 5f6b 6579 7320 2b20 5b22 454e 5452 5954  _keys + ["ENTRYT
+00006450: 5950 4522 5d3a 0a20 2020 2020 2020 2020  YPE"]:.         
+00006460: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00006470: 6164 645f 6461 7461 5f70 726f 7665 6e61  add_data_provena
+00006480: 6e63 6528 6b65 793d 6b65 792c 2073 6f75  nce(key=key, sou
+00006490: 7263 653d 736f 7572 6365 2c20 6e6f 7465  rce=source, note
+000064a0: 3d6e 6f74 6529 0a0a 2020 2020 2020 2020  =note)..        
+000064b0: 2020 2020 2320 446f 206e 6f74 2063 6861      # Do not cha
+000064c0: 6e67 6520 6966 204d 4552 4749 4e47 5f52  nge if MERGING_R
+000064d0: 4543 4f52 4420 6973 206e 6f74 2063 7572  ECORD is not cur
+000064e0: 6174 6564 0a20 2020 2020 2020 2020 2020  ated.           
+000064f0: 2065 6c69 6620 280a 2020 2020 2020 2020   elif (.        
+00006500: 2020 2020 2020 2020 7365 6c66 2e6d 6173          self.mas
+00006510: 7465 7264 6174 615f 6973 5f63 7572 6174  terdata_is_curat
+00006520: 6564 2829 0a20 2020 2020 2020 2020 2020  ed().           
+00006530: 2020 2020 2061 6e64 206e 6f74 206d 6572       and not mer
+00006540: 6769 6e67 5f72 6563 6f72 642e 6d61 7374  ging_record.mast
+00006550: 6572 6461 7461 5f69 735f 6375 7261 7465  erdata_is_curate
+00006560: 6428 290a 2020 2020 2020 2020 2020 2020  d().            
+00006570: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00006580: 2020 2063 6f6e 7469 6e75 650a 0a20 2020     continue..   
+00006590: 2020 2020 2020 2020 2023 2050 6172 7420           # Part 
+000065a0: 313a 2069 6465 6e74 6966 7969 6e67 2066  1: identifying f
+000065b0: 6965 6c64 730a 2020 2020 2020 2020 2020  ields.          
+000065c0: 2020 6966 206b 6579 2069 6e20 5265 636f    if key in Reco
+000065d0: 7264 2e69 6465 6e74 6966 7969 6e67 5f66  rd.identifying_f
+000065e0: 6965 6c64 5f6b 6579 733a 0a20 2020 2020  ield_keys:.     
+000065f0: 2020 2020 2020 2020 2020 2069 6620 7072             if pr
+00006600: 6566 6572 7265 645f 6d61 7374 6572 6461  eferred_masterda
+00006610: 7461 5f73 6f75 7263 655f 7072 6566 6978  ta_source_prefix
+00006620: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+00006630: 2020 2020 2020 2020 6966 206d 6572 6769          if mergi
+00006640: 6e67 5f72 6563 6f72 645f 7072 6566 6572  ng_record_prefer
+00006650: 7265 643a 0a20 2020 2020 2020 2020 2020  red:.           
+00006660: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00006670: 662e 7570 6461 7465 5f66 6965 6c64 280a  f.update_field(.
+00006680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006690: 2020 2020 2020 2020 2020 2020 6b65 793d              key=
+000066a0: 6b65 792c 2076 616c 7565 3d73 7472 2876  key, value=str(v
+000066b0: 616c 292c 2073 6f75 7263 653d 736f 7572  al), source=sour
+000066c0: 6365 2c20 6170 7065 6e64 5f65 6469 743d  ce, append_edit=
+000066d0: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
+000066e0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+000066f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006700: 2023 2046 7573 6520 6265 7374 2066 6965   # Fuse best fie
+00006710: 6c64 7320 6966 206e 6f6e 6520 6973 2063  lds if none is c
+00006720: 7572 6174 6564 0a20 2020 2020 2020 2020  urated.         
+00006730: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00006740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006750: 2073 656c 662e 5f5f 6675 7365 5f62 6573   self.__fuse_bes
+00006760: 745f 6669 656c 6428 0a20 2020 2020 2020  t_field(.       
+00006770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006780: 206d 6572 6769 6e67 5f72 6563 6f72 643d   merging_record=
+00006790: 6d65 7267 696e 675f 7265 636f 7264 2c0a  merging_record,.
 000067a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000067b0: 6b65 6570 5f73 6f75 7263 655f 6966 5f65  keep_source_if_e
-000067c0: 7175 616c 3d54 7275 652c 0a20 2020 2020  qual=True,.     
-000067d0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-000067e0: 7070 656e 645f 6564 6974 3d46 616c 7365  ppend_edit=False
-000067f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00006800: 2020 290a 0a20 2020 2040 636c 6173 736d    )..    @classm
-00006810: 6574 686f 640a 2020 2020 6465 6620 5f5f  ethod.    def __
-00006820: 7365 6c65 6374 5f62 6573 745f 6175 7468  select_best_auth
-00006830: 6f72 280a 2020 2020 2020 2020 636c 732c  or(.        cls,
-00006840: 202a 2c20 7265 636f 7264 3a20 5265 636f   *, record: Reco
-00006850: 7264 2c20 6d65 7267 696e 675f 7265 636f  rd, merging_reco
-00006860: 7264 3a20 5265 636f 7264 2c20 7072 6566  rd: Record, pref
-00006870: 6572 7265 645f 736f 7572 6365 733a 206c  erred_sources: l
-00006880: 6973 740a 2020 2020 2920 2d3e 2073 7472  ist.    ) -> str
-00006890: 3a0a 2020 2020 2020 2020 2320 7079 6c69  :.        # pyli
-000068a0: 6e74 3a20 6469 7361 626c 653d 746f 6f2d  nt: disable=too-
-000068b0: 6d61 6e79 2d72 6574 7572 6e2d 7374 6174  many-return-stat
-000068c0: 656d 656e 7473 0a20 2020 2020 2020 2069  ements.        i
-000068d0: 6620 2263 6f6c 7265 765f 6d61 7374 6572  f "colrev_master
-000068e0: 6461 7461 5f70 726f 7665 6e61 6e63 6522  data_provenance"
-000068f0: 206e 6f74 2069 6e20 7265 636f 7264 2e64   not in record.d
-00006900: 6174 613a 0a20 2020 2020 2020 2020 2020  ata:.           
-00006910: 2072 6563 6f72 642e 6461 7461 5b22 636f   record.data["co
-00006920: 6c72 6576 5f6d 6173 7465 7264 6174 615f  lrev_masterdata_
-00006930: 7072 6f76 656e 616e 6365 225d 203d 207b  provenance"] = {
-00006940: 7d0a 2020 2020 2020 2020 7265 636f 7264  }.        record
-00006950: 5f61 5f70 726f 7620 3d20 7265 636f 7264  _a_prov = record
-00006960: 2e64 6174 615b 2263 6f6c 7265 765f 6d61  .data["colrev_ma
-00006970: 7374 6572 6461 7461 5f70 726f 7665 6e61  sterdata_provena
-00006980: 6e63 6522 5d0a 0a20 2020 2020 2020 2069  nce"]..        i
-00006990: 6620 2263 6f6c 7265 765f 6d61 7374 6572  f "colrev_master
-000069a0: 6461 7461 5f70 726f 7665 6e61 6e63 6522  data_provenance"
-000069b0: 206e 6f74 2069 6e20 6d65 7267 696e 675f   not in merging_
-000069c0: 7265 636f 7264 2e64 6174 613a 0a20 2020  record.data:.   
-000069d0: 2020 2020 2020 2020 206d 6572 6769 6e67           merging
-000069e0: 5f72 6563 6f72 642e 6461 7461 5b22 636f  _record.data["co
-000069f0: 6c72 6576 5f6d 6173 7465 7264 6174 615f  lrev_masterdata_
-00006a00: 7072 6f76 656e 616e 6365 225d 203d 207b  provenance"] = {
-00006a10: 7d0a 2020 2020 2020 2020 6d65 7267 696e  }.        mergin
-00006a20: 675f 7265 636f 7264 5f61 5f70 726f 7620  g_record_a_prov 
-00006a30: 3d20 6d65 7267 696e 675f 7265 636f 7264  = merging_record
-00006a40: 2e64 6174 615b 2263 6f6c 7265 765f 6d61  .data["colrev_ma
-00006a50: 7374 6572 6461 7461 5f70 726f 7665 6e61  sterdata_provena
-00006a60: 6e63 6522 5d0a 0a20 2020 2020 2020 2069  nce"]..        i
-00006a70: 6620 2261 7574 686f 7222 2069 6e20 7265  f "author" in re
-00006a80: 636f 7264 5f61 5f70 726f 7620 616e 6420  cord_a_prov and 
-00006a90: 2261 7574 686f 7222 206e 6f74 2069 6e20  "author" not in 
-00006aa0: 6d65 7267 696e 675f 7265 636f 7264 5f61  merging_record_a
-00006ab0: 5f70 726f 763a 0a20 2020 2020 2020 2020  _prov:.         
-00006ac0: 2020 2023 2050 7265 6665 7220 6e6f 6e2d     # Prefer non-
-00006ad0: 6465 6665 6374 2076 6572 7369 6f6e 0a20  defect version. 
-00006ae0: 2020 2020 2020 2020 2020 2069 6620 2271             if "q
-00006af0: 7561 6c69 7479 5f64 6566 6563 7422 2069  uality_defect" i
-00006b00: 6e20 7265 636f 7264 5f61 5f70 726f 765b  n record_a_prov[
-00006b10: 2261 7574 686f 7222 5d2e 6765 7428 226e  "author"].get("n
-00006b20: 6f74 6522 2c20 2222 293a 0a20 2020 2020  ote", ""):.     
-00006b30: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00006b40: 6e20 6d65 7267 696e 675f 7265 636f 7264  n merging_record
-00006b50: 2e64 6174 615b 2261 7574 686f 7222 5d0a  .data["author"].
-00006b60: 2020 2020 2020 2020 2020 2020 2320 5072              # Pr
-00006b70: 6566 6572 2063 6f6d 706c 6574 6520 7665  efer complete ve
-00006b80: 7273 696f 6e0a 2020 2020 2020 2020 2020  rsion.          
-00006b90: 2020 6966 2022 696e 636f 6d70 6c65 7465    if "incomplete
-00006ba0: 2220 696e 2072 6563 6f72 645f 615f 7072  " in record_a_pr
-00006bb0: 6f76 5b22 6175 7468 6f72 225d 2e67 6574  ov["author"].get
-00006bc0: 2822 6e6f 7465 222c 2022 2229 3a0a 2020  ("note", ""):.  
-00006bd0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00006be0: 7475 726e 206d 6572 6769 6e67 5f72 6563  turn merging_rec
-00006bf0: 6f72 642e 6461 7461 5b22 6175 7468 6f72  ord.data["author
-00006c00: 225d 0a20 2020 2020 2020 2065 6c69 6620  "].        elif 
-00006c10: 2261 7574 686f 7222 2069 6e20 7265 636f  "author" in reco
-00006c20: 7264 5f61 5f70 726f 7620 616e 6420 2261  rd_a_prov and "a
-00006c30: 7574 686f 7222 2069 6e20 6d65 7267 696e  uthor" in mergin
-00006c40: 675f 7265 636f 7264 5f61 5f70 726f 763a  g_record_a_prov:
-00006c50: 0a20 2020 2020 2020 2020 2020 2023 2050  .            # P
-00006c60: 7265 6665 7220 6e6f 6e2d 6465 6665 6374  refer non-defect
-00006c70: 2076 6572 7369 6f6e 0a20 2020 2020 2020   version.       
-00006c80: 2020 2020 2069 6620 2271 7561 6c69 7479       if "quality
-00006c90: 5f64 6566 6563 7422 2069 6e20 7265 636f  _defect" in reco
-00006ca0: 7264 5f61 5f70 726f 765b 2261 7574 686f  rd_a_prov["autho
-00006cb0: 7222 5d2e 6765 7428 0a20 2020 2020 2020  r"].get(.       
-00006cc0: 2020 2020 2020 2020 2022 6e6f 7465 222c           "note",
-00006cd0: 2022 220a 2020 2020 2020 2020 2020 2020   "".            
-00006ce0: 2920 616e 6420 2271 7561 6c69 7479 5f64  ) and "quality_d
-00006cf0: 6566 6563 7422 206e 6f74 2069 6e20 6d65  efect" not in me
-00006d00: 7267 696e 675f 7265 636f 7264 5f61 5f70  rging_record_a_p
-00006d10: 726f 765b 2261 7574 686f 7222 5d2e 6765  rov["author"].ge
-00006d20: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
-00006d30: 2020 2022 6e6f 7465 222c 2022 220a 2020     "note", "".  
-00006d40: 2020 2020 2020 2020 2020 293a 0a20 2020            ):.   
-00006d50: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-00006d60: 7572 6e20 6d65 7267 696e 675f 7265 636f  urn merging_reco
-00006d70: 7264 2e64 6174 615b 2261 7574 686f 7222  rd.data["author"
-00006d80: 5d0a 0a20 2020 2020 2020 2020 2020 2023  ]..            #
-00006d90: 2050 7265 6665 7220 636f 6d70 6c65 7465   Prefer complete
-00006da0: 2076 6572 7369 6f6e 0a20 2020 2020 2020   version.       
-00006db0: 2020 2020 2069 6620 2269 6e63 6f6d 706c       if "incompl
-00006dc0: 6574 6522 2069 6e20 7265 636f 7264 5f61  ete" in record_a
-00006dd0: 5f70 726f 765b 2261 7574 686f 7222 5d2e  _prov["author"].
-00006de0: 6765 7428 0a20 2020 2020 2020 2020 2020  get(.           
-00006df0: 2020 2020 2022 6e6f 7465 222c 2022 220a       "note", "".
-00006e00: 2020 2020 2020 2020 2020 2020 2920 616e              ) an
-00006e10: 6420 2269 6e63 6f6d 706c 6574 6522 206e  d "incomplete" n
-00006e20: 6f74 2069 6e20 6d65 7267 696e 675f 7265  ot in merging_re
-00006e30: 636f 7264 5f61 5f70 726f 765b 2261 7574  cord_a_prov["aut
-00006e40: 686f 7222 5d2e 6765 7428 226e 6f74 6522  hor"].get("note"
-00006e50: 2c20 2222 293a 0a20 2020 2020 2020 2020  , ""):.         
-00006e60: 2020 2020 2020 2072 6574 7572 6e20 6d65         return me
-00006e70: 7267 696e 675f 7265 636f 7264 2e64 6174  rging_record.dat
-00006e80: 615b 2261 7574 686f 7222 5d0a 0a20 2020  a["author"]..   
-00006e90: 2020 2020 2069 6620 6c65 6e28 7265 636f       if len(reco
-00006ea0: 7264 2e64 6174 615b 2261 7574 686f 7222  rd.data["author"
-00006eb0: 5d29 203e 2030 2061 6e64 206c 656e 286d  ]) > 0 and len(m
-00006ec0: 6572 6769 6e67 5f72 6563 6f72 642e 6461  erging_record.da
-00006ed0: 7461 5b22 6175 7468 6f72 225d 2920 3e20  ta["author"]) > 
-00006ee0: 303a 0a20 2020 2020 2020 2020 2020 2064  0:.            d
-00006ef0: 6566 6175 6c74 5f6d 6f73 746c 795f 7570  efault_mostly_up
-00006f00: 7065 7220 3d20 280a 2020 2020 2020 2020  per = (.        
-00006f10: 2020 2020 2020 2020 636f 6c72 6576 2e65          colrev.e
-00006f20: 6e76 2e75 7469 6c73 2e70 6572 6365 6e74  nv.utils.percent
-00006f30: 5f75 7070 6572 5f63 6861 7273 2872 6563  _upper_chars(rec
-00006f40: 6f72 642e 6461 7461 5b22 6175 7468 6f72  ord.data["author
-00006f50: 225d 2920 3e20 302e 380a 2020 2020 2020  "]) > 0.8.      
-00006f60: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00006f70: 2020 2020 6361 6e64 6964 6174 655f 6d6f      candidate_mo
-00006f80: 7374 6c79 5f75 7070 6572 203d 2028 0a20  stly_upper = (. 
-00006f90: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00006fa0: 6f6c 7265 762e 656e 762e 7574 696c 732e  olrev.env.utils.
-00006fb0: 7065 7263 656e 745f 7570 7065 725f 6368  percent_upper_ch
-00006fc0: 6172 7328 6d65 7267 696e 675f 7265 636f  ars(merging_reco
-00006fd0: 7264 2e64 6174 615b 2261 7574 686f 7222  rd.data["author"
-00006fe0: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
-00006ff0: 2020 203e 2030 2e38 0a20 2020 2020 2020     > 0.8.       
-00007000: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-00007010: 2020 2020 2320 5072 6566 6572 2074 6974      # Prefer tit
-00007020: 6c65 2063 6173 6520 286e 6f74 2061 6c6c  le case (not all
-00007030: 2d63 6170 7329 0a20 2020 2020 2020 2020  -caps).         
-00007040: 2020 2069 6620 6465 6661 756c 745f 6d6f     if default_mo
-00007050: 7374 6c79 5f75 7070 6572 2061 6e64 206e  stly_upper and n
-00007060: 6f74 2063 616e 6469 6461 7465 5f6d 6f73  ot candidate_mos
-00007070: 746c 795f 7570 7065 723a 0a20 2020 2020  tly_upper:.     
-00007080: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00007090: 6e20 6d65 7267 696e 675f 7265 636f 7264  n merging_record
-000070a0: 2e64 6174 615b 2261 7574 686f 7222 5d0a  .data["author"].
-000070b0: 0a20 2020 2020 2020 2023 2050 7265 6665  .        # Prefe
-000070c0: 7220 736f 7572 6365 730a 2020 2020 2020  r sources.      
-000070d0: 2020 6966 2022 6175 7468 6f72 2220 696e    if "author" in
-000070e0: 206d 6572 6769 6e67 5f72 6563 6f72 645f   merging_record_
-000070f0: 615f 7072 6f76 3a0a 2020 2020 2020 2020  a_prov:.        
-00007100: 2020 2020 6966 2061 6e79 280a 2020 2020      if any(.    
-00007110: 2020 2020 2020 2020 2020 2020 7820 696e              x in
-00007120: 206d 6572 6769 6e67 5f72 6563 6f72 645f   merging_record_
-00007130: 615f 7072 6f76 5b22 6175 7468 6f72 225d  a_prov["author"]
-00007140: 5b22 736f 7572 6365 225d 0a20 2020 2020  ["source"].     
-00007150: 2020 2020 2020 2020 2020 2066 6f72 2078             for x
-00007160: 2069 6e20 7072 6566 6572 7265 645f 736f   in preferred_so
-00007170: 7572 6365 730a 2020 2020 2020 2020 2020  urces.          
-00007180: 2020 293a 0a20 2020 2020 2020 2020 2020    ):.           
-00007190: 2020 2020 2072 6574 7572 6e20 6d65 7267       return merg
-000071a0: 696e 675f 7265 636f 7264 2e64 6174 615b  ing_record.data[
-000071b0: 2261 7574 686f 7222 5d0a 2020 2020 2020  "author"].      
-000071c0: 2020 7265 7475 726e 2072 6563 6f72 642e    return record.
-000071d0: 6461 7461 5b22 6175 7468 6f72 225d 0a0a  data["author"]..
-000071e0: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
-000071f0: 0a20 2020 2064 6566 205f 5f73 656c 6563  .    def __selec
-00007200: 745f 6265 7374 5f70 6167 6573 280a 2020  t_best_pages(.  
-00007210: 2020 2020 2020 636c 732c 0a20 2020 2020        cls,.     
-00007220: 2020 202a 2c0a 2020 2020 2020 2020 7265     *,.        re
-00007230: 636f 7264 3a20 5265 636f 7264 2c0a 2020  cord: Record,.  
-00007240: 2020 2020 2020 6d65 7267 696e 675f 7265        merging_re
-00007250: 636f 7264 3a20 5265 636f 7264 2c0a 2020  cord: Record,.  
-00007260: 2020 2020 2020 7072 6566 6572 7265 645f        preferred_
-00007270: 736f 7572 6365 733a 206c 6973 742c 2020  sources: list,  
-00007280: 2320 7079 6c69 6e74 3a20 6469 7361 626c  # pylint: disabl
-00007290: 653d 756e 7573 6564 2d61 7267 756d 656e  e=unused-argumen
-000072a0: 740a 2020 2020 2920 2d3e 2073 7472 3a0a  t.    ) -> str:.
-000072b0: 2020 2020 2020 2020 6265 7374 5f70 6167          best_pag
-000072c0: 6573 203d 2072 6563 6f72 642e 6461 7461  es = record.data
-000072d0: 5b22 7061 6765 7322 5d0a 2020 2020 2020  ["pages"].      
-000072e0: 2020 6966 2022 2d2d 2220 696e 206d 6572    if "--" in mer
-000072f0: 6769 6e67 5f72 6563 6f72 642e 6461 7461  ging_record.data
-00007300: 5b22 7061 6765 7322 5d20 616e 6420 222d  ["pages"] and "-
-00007310: 2d22 206e 6f74 2069 6e20 7265 636f 7264  -" not in record
-00007320: 2e64 6174 615b 2270 6167 6573 225d 3a0a  .data["pages"]:.
-00007330: 2020 2020 2020 2020 2020 2020 6265 7374              best
-00007340: 5f70 6167 6573 203d 206d 6572 6769 6e67  _pages = merging
-00007350: 5f72 6563 6f72 642e 6461 7461 5b22 7061  _record.data["pa
-00007360: 6765 7322 5d0a 2020 2020 2020 2020 7265  ges"].        re
-00007370: 7475 726e 2062 6573 745f 7061 6765 730a  turn best_pages.
-00007380: 0a20 2020 2040 636c 6173 736d 6574 686f  .    @classmetho
-00007390: 640a 2020 2020 6465 6620 5f5f 7365 6c65  d.    def __sele
-000073a0: 6374 5f62 6573 745f 7469 746c 6528 0a20  ct_best_title(. 
-000073b0: 2020 2020 2020 2063 6c73 2c0a 2020 2020         cls,.    
-000073c0: 2020 2020 2a2c 0a20 2020 2020 2020 2072      *,.        r
-000073d0: 6563 6f72 643a 2052 6563 6f72 642c 0a20  ecord: Record,. 
-000073e0: 2020 2020 2020 206d 6572 6769 6e67 5f72         merging_r
-000073f0: 6563 6f72 643a 2052 6563 6f72 642c 0a20  ecord: Record,. 
-00007400: 2020 2020 2020 2070 7265 6665 7272 6564         preferred
-00007410: 5f73 6f75 7263 6573 3a20 6c69 7374 2c20  _sources: list, 
-00007420: 2023 2070 796c 696e 743a 2064 6973 6162   # pylint: disab
-00007430: 6c65 3d75 6e75 7365 642d 6172 6775 6d65  le=unused-argume
-00007440: 6e74 0a20 2020 2029 202d 3e20 7374 723a  nt.    ) -> str:
-00007450: 0a20 2020 2020 2020 2064 6566 6175 6c74  .        default
-00007460: 203d 2072 6563 6f72 642e 6461 7461 5b22   = record.data["
-00007470: 7469 746c 6522 5d0a 2020 2020 2020 2020  title"].        
-00007480: 6361 6e64 6964 6174 6520 3d20 6d65 7267  candidate = merg
-00007490: 696e 675f 7265 636f 7264 2e64 6174 615b  ing_record.data[
-000074a0: 2274 6974 6c65 225d 0a20 2020 2020 2020  "title"].       
-000074b0: 2062 6573 745f 7469 746c 6520 3d20 7265   best_title = re
-000074c0: 636f 7264 2e64 6174 615b 2274 6974 6c65  cord.data["title
-000074d0: 225d 0a0a 2020 2020 2020 2020 2320 4e6f  "]..        # No
-000074e0: 7465 203a 2061 766f 6964 2073 7769 7463  te : avoid switc
-000074f0: 6869 6e67 2074 6974 6c65 730a 2020 2020  hing titles.    
-00007500: 2020 2020 6966 2064 6566 6175 6c74 2e72      if default.r
-00007510: 6570 6c61 6365 2822 202d 2022 2c20 223a  eplace(" - ", ":
-00007520: 2022 2920 3d3d 2063 616e 6469 6461 7465   ") == candidate
-00007530: 2e72 6570 6c61 6365 2822 202d 2022 2c20  .replace(" - ", 
-00007540: 223a 2022 293a 0a20 2020 2020 2020 2020  ": "):.         
-00007550: 2020 2072 6574 7572 6e20 6465 6661 756c     return defaul
-00007560: 740a 0a20 2020 2020 2020 2064 6566 6175  t..        defau
-00007570: 6c74 5f75 7070 6572 203d 2063 6f6c 7265  lt_upper = colre
-00007580: 762e 656e 762e 7574 696c 732e 7065 7263  v.env.utils.perc
-00007590: 656e 745f 7570 7065 725f 6368 6172 7328  ent_upper_chars(
-000075a0: 6465 6661 756c 7429 0a20 2020 2020 2020  default).       
-000075b0: 2063 616e 6469 6461 7465 5f75 7070 6572   candidate_upper
-000075c0: 203d 2063 6f6c 7265 762e 656e 762e 7574   = colrev.env.ut
-000075d0: 696c 732e 7065 7263 656e 745f 7570 7065  ils.percent_uppe
-000075e0: 725f 6368 6172 7328 6361 6e64 6964 6174  r_chars(candidat
-000075f0: 6529 0a0a 2020 2020 2020 2020 6966 2063  e)..        if c
-00007600: 616e 6469 6461 7465 5b2d 315d 206e 6f74  andidate[-1] not
-00007610: 2069 6e20 5b22 2a22 2c20 2231 222c 2022   in ["*", "1", "
-00007620: 3222 5d3a 0a20 2020 2020 2020 2020 2020  2"]:.           
-00007630: 2023 2052 656c 6174 6976 656c 7920 7369   # Relatively si
-00007640: 6d70 6c65 2072 756c 652e 2e2e 0a20 2020  mple rule....   
-00007650: 2020 2020 2020 2020 2023 2063 6174 6368           # catch
-00007660: 6573 2063 6173 6573 2077 6865 6e20 6465  es cases when de
-00007670: 6661 756c 7420 6973 2061 6c6c 2075 7070  fault is all upp
-00007680: 6572 206f 7220 7469 746c 6520 6361 7365  er or title case
-00007690: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000076a0: 6465 6661 756c 745f 7570 7065 7220 3e20  default_upper > 
-000076b0: 6361 6e64 6964 6174 655f 7570 7065 723a  candidate_upper:
-000076c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000076d0: 2062 6573 745f 7469 746c 6520 3d20 6361   best_title = ca
-000076e0: 6e64 6964 6174 650a 2020 2020 2020 2020  ndidate.        
-000076f0: 7265 7475 726e 2062 6573 745f 7469 746c  return best_titl
-00007700: 650a 0a20 2020 2040 636c 6173 736d 6574  e..    @classmet
-00007710: 686f 640a 2020 2020 6465 6620 5f5f 7365  hod.    def __se
-00007720: 6c65 6374 5f62 6573 745f 6a6f 7572 6e61  lect_best_journa
-00007730: 6c28 0a20 2020 2020 2020 2063 6c73 2c0a  l(.        cls,.
-00007740: 2020 2020 2020 2020 2a2c 0a20 2020 2020          *,.     
-00007750: 2020 2072 6563 6f72 643a 2052 6563 6f72     record: Recor
-00007760: 642c 0a20 2020 2020 2020 206d 6572 6769  d,.        mergi
-00007770: 6e67 5f72 6563 6f72 643a 2052 6563 6f72  ng_record: Recor
-00007780: 642c 0a20 2020 2020 2020 2070 7265 6665  d,.        prefe
-00007790: 7272 6564 5f73 6f75 7263 6573 3a20 6c69  rred_sources: li
-000077a0: 7374 2c20 2023 2070 796c 696e 743a 2064  st,  # pylint: d
-000077b0: 6973 6162 6c65 3d75 6e75 7365 642d 6172  isable=unused-ar
-000077c0: 6775 6d65 6e74 0a20 2020 2029 202d 3e20  gument.    ) -> 
-000077d0: 7374 723a 0a20 2020 2020 2020 2072 6574  str:.        ret
-000077e0: 7572 6e20 636c 732e 5f5f 7365 6c65 6374  urn cls.__select
-000077f0: 5f62 6573 745f 636f 6e74 6169 6e65 725f  _best_container_
-00007800: 7469 746c 6528 0a20 2020 2020 2020 2020  title(.         
-00007810: 2020 2064 6566 6175 6c74 3d72 6563 6f72     default=recor
-00007820: 642e 6461 7461 5b22 6a6f 7572 6e61 6c22  d.data["journal"
-00007830: 5d2c 2063 616e 6469 6461 7465 3d6d 6572  ], candidate=mer
-00007840: 6769 6e67 5f72 6563 6f72 642e 6461 7461  ging_record.data
-00007850: 5b22 6a6f 7572 6e61 6c22 5d0a 2020 2020  ["journal"].    
-00007860: 2020 2020 290a 0a20 2020 2040 636c 6173      )..    @clas
-00007870: 736d 6574 686f 640a 2020 2020 6465 6620  smethod.    def 
-00007880: 5f5f 7365 6c65 6374 5f62 6573 745f 626f  __select_best_bo
-00007890: 6f6b 7469 746c 6528 0a20 2020 2020 2020  oktitle(.       
-000078a0: 2063 6c73 2c0a 2020 2020 2020 2020 2a2c   cls,.        *,
-000078b0: 0a20 2020 2020 2020 2072 6563 6f72 643a  .        record:
-000078c0: 2052 6563 6f72 642c 0a20 2020 2020 2020   Record,.       
-000078d0: 206d 6572 6769 6e67 5f72 6563 6f72 643a   merging_record:
-000078e0: 2052 6563 6f72 642c 0a20 2020 2020 2020   Record,.       
-000078f0: 2070 7265 6665 7272 6564 5f73 6f75 7263   preferred_sourc
-00007900: 6573 3a20 6c69 7374 2c20 2023 2070 796c  es: list,  # pyl
-00007910: 696e 743a 2064 6973 6162 6c65 3d75 6e75  int: disable=unu
-00007920: 7365 642d 6172 6775 6d65 6e74 0a20 2020  sed-argument.   
-00007930: 2029 202d 3e20 7374 723a 0a20 2020 2020   ) -> str:.     
-00007940: 2020 2072 6574 7572 6e20 636c 732e 5f5f     return cls.__
-00007950: 7365 6c65 6374 5f62 6573 745f 636f 6e74  select_best_cont
-00007960: 6169 6e65 725f 7469 746c 6528 0a20 2020  ainer_title(.   
-00007970: 2020 2020 2020 2020 2064 6566 6175 6c74           default
-00007980: 3d72 6563 6f72 642e 6461 7461 5b22 626f  =record.data["bo
-00007990: 6f6b 7469 746c 6522 5d2c 2063 616e 6469  oktitle"], candi
-000079a0: 6461 7465 3d6d 6572 6769 6e67 5f72 6563  date=merging_rec
-000079b0: 6f72 642e 6461 7461 5b22 626f 6f6b 7469  ord.data["bookti
-000079c0: 746c 6522 5d0a 2020 2020 2020 2020 290a  tle"].        ).
-000079d0: 0a20 2020 2040 636c 6173 736d 6574 686f  .    @classmetho
-000079e0: 640a 2020 2020 6465 6620 5f5f 7365 6c65  d.    def __sele
-000079f0: 6374 5f62 6573 745f 636f 6e74 6169 6e65  ct_best_containe
-00007a00: 725f 7469 746c 6528 636c 732c 202a 2c20  r_title(cls, *, 
-00007a10: 6465 6661 756c 743a 2073 7472 2c20 6361  default: str, ca
-00007a20: 6e64 6964 6174 653a 2073 7472 2920 2d3e  ndidate: str) ->
-00007a30: 2073 7472 3a0a 2020 2020 2020 2020 6265   str:.        be
-00007a40: 7374 5f6a 6f75 726e 616c 203d 2064 6566  st_journal = def
-00007a50: 6175 6c74 0a0a 2020 2020 2020 2020 6465  ault..        de
-00007a60: 6661 756c 745f 7570 7065 7220 3d20 636f  fault_upper = co
-00007a70: 6c72 6576 2e65 6e76 2e75 7469 6c73 2e70  lrev.env.utils.p
-00007a80: 6572 6365 6e74 5f75 7070 6572 5f63 6861  ercent_upper_cha
-00007a90: 7273 2864 6566 6175 6c74 290a 2020 2020  rs(default).    
-00007aa0: 2020 2020 6361 6e64 6964 6174 655f 7570      candidate_up
-00007ab0: 7065 7220 3d20 636f 6c72 6576 2e65 6e76  per = colrev.env
-00007ac0: 2e75 7469 6c73 2e70 6572 6365 6e74 5f75  .utils.percent_u
-00007ad0: 7070 6572 5f63 6861 7273 2863 616e 6469  pper_chars(candi
-00007ae0: 6461 7465 290a 0a20 2020 2020 2020 2023  date)..        #
-00007af0: 2053 696d 706c 6520 6865 7572 6973 7469   Simple heuristi
-00007b00: 6320 746f 2061 766f 6964 2061 6262 7265  c to avoid abbre
-00007b10: 7669 6174 696f 6e73 0a20 2020 2020 2020  viations.       
-00007b20: 2069 6620 222e 2220 696e 2064 6566 6175   if "." in defau
-00007b30: 6c74 2061 6e64 2022 2e22 206e 6f74 2069  lt and "." not i
-00007b40: 6e20 6361 6e64 6964 6174 653a 0a20 2020  n candidate:.   
-00007b50: 2020 2020 2020 2020 2062 6573 745f 6a6f           best_jo
-00007b60: 7572 6e61 6c20 3d20 6361 6e64 6964 6174  urnal = candidat
-00007b70: 650a 2020 2020 2020 2020 2320 5265 6c61  e.        # Rela
-00007b80: 7469 7665 6c79 2073 696d 706c 6520 7275  tively simple ru
-00007b90: 6c65 2e2e 2e0a 2020 2020 2020 2020 2320  le....        # 
-00007ba0: 6361 7463 6865 7320 6361 7365 7320 7768  catches cases wh
-00007bb0: 656e 2064 6566 6175 6c74 2069 7320 616c  en default is al
-00007bc0: 6c20 7570 7065 7220 6f72 2074 6974 6c65  l upper or title
-00007bd0: 2063 6173 650a 2020 2020 2020 2020 6966   case.        if
-00007be0: 2064 6566 6175 6c74 5f75 7070 6572 203e   default_upper >
-00007bf0: 2063 616e 6469 6461 7465 5f75 7070 6572   candidate_upper
-00007c00: 3a0a 2020 2020 2020 2020 2020 2020 6265  :.            be
-00007c10: 7374 5f6a 6f75 726e 616c 203d 2063 616e  st_journal = can
-00007c20: 6469 6461 7465 0a20 2020 2020 2020 2072  didate.        r
-00007c30: 6574 7572 6e20 6265 7374 5f6a 6f75 726e  eturn best_journ
-00007c40: 616c 0a0a 2020 2020 6465 6620 5f5f 6675  al..    def __fu
-00007c50: 7365 5f62 6573 745f 6669 656c 6428 0a20  se_best_field(. 
-00007c60: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
-00007c70: 2020 2020 202a 2c0a 2020 2020 2020 2020       *,.        
-00007c80: 6d65 7267 696e 675f 7265 636f 7264 3a20  merging_record: 
-00007c90: 5265 636f 7264 2c0a 2020 2020 2020 2020  Record,.        
-00007ca0: 6b65 793a 2073 7472 2c0a 2020 2020 2020  key: str,.      
-00007cb0: 2020 7661 6c3a 2073 7472 2c0a 2020 2020    val: str,.    
-00007cc0: 2020 2020 736f 7572 6365 3a20 7374 722c      source: str,
-00007cd0: 0a20 2020 2020 2020 206e 6f74 653a 2073  .        note: s
-00007ce0: 7472 2c20 2023 2070 796c 696e 743a 2064  tr,  # pylint: d
-00007cf0: 6973 6162 6c65 3d75 6e75 7365 642d 6172  isable=unused-ar
-00007d00: 6775 6d65 6e74 0a20 2020 2029 202d 3e20  gument.    ) -> 
-00007d10: 4e6f 6e65 3a0a 2020 2020 2020 2020 2320  None:.        # 
-00007d20: 4e6f 7465 203a 2074 6865 2061 7373 756d  Note : the assum
-00007d30: 7074 696f 6e20 6973 2074 6861 7420 7765  ption is that we
-00007d40: 206e 6565 6420 6d61 7374 6572 6461 7461   need masterdata
-00007d50: 5f70 726f 7665 6e61 6e63 6520 6e6f 7465  _provenance note
-00007d60: 730a 2020 2020 2020 2020 2320 6f6e 6c79  s.        # only
-00007d70: 2066 6f72 2061 7574 686f 7273 0a0a 2020   for authors..  
-00007d80: 2020 2020 2020 6375 7374 6f6d 5f66 6965        custom_fie
-00007d90: 6c64 5f73 656c 6563 746f 7273 203d 207b  ld_selectors = {
-00007da0: 0a20 2020 2020 2020 2020 2020 2022 6175  .            "au
-00007db0: 7468 6f72 223a 2073 656c 662e 5f5f 7365  thor": self.__se
-00007dc0: 6c65 6374 5f62 6573 745f 6175 7468 6f72  lect_best_author
-00007dd0: 2c0a 2020 2020 2020 2020 2020 2020 2270  ,.            "p
-00007de0: 6167 6573 223a 2073 656c 662e 5f5f 7365  ages": self.__se
-00007df0: 6c65 6374 5f62 6573 745f 7061 6765 732c  lect_best_pages,
-00007e00: 0a20 2020 2020 2020 2020 2020 2022 7469  .            "ti
-00007e10: 746c 6522 3a20 7365 6c66 2e5f 5f73 656c  tle": self.__sel
-00007e20: 6563 745f 6265 7374 5f74 6974 6c65 2c0a  ect_best_title,.
-00007e30: 2020 2020 2020 2020 2020 2020 226a 6f75              "jou
-00007e40: 726e 616c 223a 2073 656c 662e 5f5f 7365  rnal": self.__se
-00007e50: 6c65 6374 5f62 6573 745f 6a6f 7572 6e61  lect_best_journa
-00007e60: 6c2c 0a20 2020 2020 2020 2020 2020 2022  l,.            "
-00007e70: 626f 6f6b 7469 746c 6522 3a20 7365 6c66  booktitle": self
-00007e80: 2e5f 5f73 656c 6563 745f 6265 7374 5f62  .__select_best_b
-00007e90: 6f6f 6b74 6974 6c65 2c0a 2020 2020 2020  ooktitle,.      
-00007ea0: 2020 7d0a 0a20 2020 2020 2020 2069 6620    }..        if 
-00007eb0: 6b65 7920 696e 2063 7573 746f 6d5f 6669  key in custom_fi
-00007ec0: 656c 645f 7365 6c65 6374 6f72 733a 0a20  eld_selectors:. 
-00007ed0: 2020 2020 2020 2020 2020 2069 6620 6b65             if ke
-00007ee0: 7920 696e 2073 656c 662e 6461 7461 3a0a  y in self.data:.
-00007ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007f00: 6265 7374 5f76 616c 7565 203d 2063 7573  best_value = cus
-00007f10: 746f 6d5f 6669 656c 645f 7365 6c65 6374  tom_field_select
-00007f20: 6f72 735b 6b65 795d 280a 2020 2020 2020  ors[key](.      
-00007f30: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00007f40: 636f 7264 3d73 656c 662c 0a20 2020 2020  cord=self,.     
-00007f50: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-00007f60: 6572 6769 6e67 5f72 6563 6f72 643d 6d65  erging_record=me
-00007f70: 7267 696e 675f 7265 636f 7264 2c0a 2020  rging_record,.  
-00007f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007f90: 2020 7072 6566 6572 7265 645f 736f 7572    preferred_sour
-00007fa0: 6365 733d 7365 6c66 2e70 7265 6665 7272  ces=self.preferr
-00007fb0: 6564 5f73 6f75 7263 6573 2c0a 2020 2020  ed_sources,.    
-00007fc0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00007fd0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00007fe0: 2073 656c 662e 6461 7461 5b6b 6579 5d20   self.data[key] 
-00007ff0: 213d 2062 6573 745f 7661 6c75 653a 0a20  != best_value:. 
-00008000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008010: 2020 2073 656c 662e 7570 6461 7465 5f66     self.update_f
-00008020: 6965 6c64 280a 2020 2020 2020 2020 2020  ield(.          
-00008030: 2020 2020 2020 2020 2020 2020 2020 6b65                ke
-00008040: 793d 6b65 792c 2076 616c 7565 3d62 6573  y=key, value=bes
-00008050: 745f 7661 6c75 652c 2073 6f75 7263 653d  t_value, source=
-00008060: 736f 7572 6365 2c20 6170 7065 6e64 5f65  source, append_e
-00008070: 6469 743d 4661 6c73 650a 2020 2020 2020  dit=False.      
-00008080: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-00008090: 2020 2020 2020 2020 2020 2020 656c 7365              else
-000080a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000080b0: 2020 7365 6c66 2e75 7064 6174 655f 6669    self.update_fi
-000080c0: 656c 6428 6b65 793d 6b65 792c 2076 616c  eld(key=key, val
-000080d0: 7565 3d76 616c 2c20 736f 7572 6365 3d73  ue=val, source=s
-000080e0: 6f75 7263 652c 2061 7070 656e 645f 6564  ource, append_ed
-000080f0: 6974 3d46 616c 7365 290a 0a20 2020 2020  it=False)..     
-00008100: 2020 2065 6c69 6620 6b65 7920 3d3d 2022     elif key == "
-00008110: 6669 6c65 223a 0a20 2020 2020 2020 2020  file":.         
-00008120: 2020 2069 6620 6b65 7920 696e 2073 656c     if key in sel
-00008130: 662e 6461 7461 3a0a 2020 2020 2020 2020  f.data:.        
-00008140: 2020 2020 2020 2020 7365 6c66 2e64 6174          self.dat
-00008150: 615b 6b65 795d 203d 2073 656c 662e 6461  a[key] = self.da
-00008160: 7461 5b6b 6579 5d20 2b20 223b 2220 2b20  ta[key] + ";" + 
-00008170: 6d65 7267 696e 675f 7265 636f 7264 2e64  merging_record.d
-00008180: 6174 612e 6765 7428 6b65 792c 2022 2229  ata.get(key, "")
-00008190: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-000081a0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-000081b0: 2020 2073 656c 662e 6461 7461 5b6b 6579     self.data[key
-000081c0: 5d20 3d20 6d65 7267 696e 675f 7265 636f  ] = merging_reco
-000081d0: 7264 2e64 6174 615b 6b65 795d 0a20 2020  rd.data[key].   
-000081e0: 2020 2020 2065 6c69 6620 6b65 7920 696e       elif key in
-000081f0: 205b 2275 726c 222c 2022 6c69 6e6b 225d   ["url", "link"]
-00008200: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-00008210: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
-00008220: 2020 206b 6579 2069 6e20 7365 6c66 2e64     key in self.d
-00008230: 6174 610a 2020 2020 2020 2020 2020 2020  ata.            
-00008240: 2020 2020 616e 6420 7365 6c66 2e64 6174      and self.dat
-00008250: 615b 6b65 795d 2e72 7374 7269 7028 222f  a[key].rstrip("/
-00008260: 2229 2021 3d20 6d65 7267 696e 675f 7265  ") != merging_re
-00008270: 636f 7264 2e64 6174 615b 6b65 795d 2e72  cord.data[key].r
-00008280: 7374 7269 7028 222f 2229 0a20 2020 2020  strip("/").     
-00008290: 2020 2020 2020 2020 2020 2061 6e64 2022             and "
-000082a0: 6874 7470 7322 206e 6f74 2069 6e20 7365  https" not in se
-000082b0: 6c66 2e64 6174 615b 6b65 795d 0a20 2020  lf.data[key].   
-000082c0: 2020 2020 2020 2020 2029 3a0a 2020 2020           ):.    
-000082d0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000082e0: 2e75 7064 6174 655f 6669 656c 6428 6b65  .update_field(ke
-000082f0: 793d 6b65 792c 2076 616c 7565 3d76 616c  y=key, value=val
-00008300: 2c20 736f 7572 6365 3d73 6f75 7263 652c  , source=source,
-00008310: 2061 7070 656e 645f 6564 6974 3d46 616c   append_edit=Fal
-00008320: 7365 290a 0a20 2020 2020 2020 2065 6c69  se)..        eli
-00008330: 6620 2255 4e4b 4e4f 574e 2220 3d3d 2073  f "UNKNOWN" == s
-00008340: 656c 662e 6461 7461 2e67 6574 280a 2020  elf.data.get(.  
-00008350: 2020 2020 2020 2020 2020 6b65 792c 2022            key, "
-00008360: 220a 2020 2020 2020 2020 2920 616e 6420  ".        ) and 
-00008370: 2255 4e4b 4e4f 574e 2220 213d 206d 6572  "UNKNOWN" != mer
-00008380: 6769 6e67 5f72 6563 6f72 642e 6461 7461  ging_record.data
-00008390: 2e67 6574 286b 6579 2c20 2222 293a 0a20  .get(key, ""):. 
-000083a0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000083b0: 6461 7461 5b6b 6579 5d20 3d20 6d65 7267  data[key] = merg
-000083c0: 696e 675f 7265 636f 7264 2e64 6174 615b  ing_record.data[
-000083d0: 6b65 795d 0a20 2020 2020 2020 2020 2020  key].           
-000083e0: 2069 6620 6b65 7920 696e 2073 656c 662e   if key in self.
-000083f0: 6964 656e 7469 6679 696e 675f 6669 656c  identifying_fiel
-00008400: 645f 6b65 7973 3a0a 2020 2020 2020 2020  d_keys:.        
-00008410: 2020 2020 2020 2020 7365 6c66 2e61 6464          self.add
-00008420: 5f6d 6173 7465 7264 6174 615f 7072 6f76  _masterdata_prov
-00008430: 656e 616e 6365 286b 6579 3d6b 6579 2c20  enance(key=key, 
-00008440: 736f 7572 6365 3d73 6f75 7263 6529 0a20  source=source). 
-00008450: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00008460: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008470: 2073 656c 662e 6164 645f 6461 7461 5f70   self.add_data_p
-00008480: 726f 7665 6e61 6e63 6528 6b65 793d 6b65  rovenance(key=ke
-00008490: 792c 2073 6f75 7263 653d 736f 7572 6365  y, source=source
-000084a0: 290a 0a20 2020 2020 2020 2023 2065 6c69  )..        # eli
-000084b0: 6620 6d65 7267 696e 675f 7265 636f 7264  f merging_record
-000084c0: 2e64 6174 612e 6765 7428 6b65 792c 2022  .data.get(key, "
-000084d0: 554e 4b4e 4f57 4e22 2920 3d3d 2022 554e  UNKNOWN") == "UN
-000084e0: 4b4e 4f57 4e22 3a0a 2020 2020 2020 2020  KNOWN":.        
-000084f0: 2320 2020 2020 7061 7373 0a20 2020 2020  #     pass.     
-00008500: 2020 2023 204e 6f74 6520 3a20 7468 6520     # Note : the 
-00008510: 666f 6c6c 6f77 696e 6720 6973 2064 6561  following is dea
-00008520: 6374 6976 6174 6564 2074 6f20 6176 6f69  ctivated to avoi
-00008530: 6420 6672 6571 7565 6e74 2063 6861 6e67  d frequent chang
-00008540: 6573 2069 6e20 6d65 7267 6564 2072 6563  es in merged rec
-00008550: 6f72 6473 0a20 2020 2020 2020 2023 2065  ords.        # e
-00008560: 6c73 653a 0a20 2020 2020 2020 2023 2020  lse:.        #  
-00008570: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-00008580: 2320 2020 2020 2020 2020 6966 206b 6579  #         if key
-00008590: 2069 6e20 7365 6c66 2e69 6465 6e74 6966   in self.identif
-000085a0: 7969 6e67 5f66 6965 6c64 5f6b 6579 733a  ying_field_keys:
-000085b0: 0a20 2020 2020 2020 2023 2020 2020 2020  .        #      
-000085c0: 2020 2020 2020 2073 6f75 7263 6520 3d20         source = 
-000085d0: 6d65 7267 696e 675f 7265 636f 7264 2e64  merging_record.d
-000085e0: 6174 615b 2263 6f6c 7265 765f 6d61 7374  ata["colrev_mast
-000085f0: 6572 6461 7461 5f70 726f 7665 6e61 6e63  erdata_provenanc
-00008600: 6522 5d5b 6b65 795d 5b0a 2020 2020 2020  e"][key][.      
-00008610: 2020 2320 2020 2020 2020 2020 2020 2020    #             
-00008620: 2020 2020 2273 6f75 7263 6522 0a20 2020      "source".   
-00008630: 2020 2020 2023 2020 2020 2020 2020 2020       #          
-00008640: 2020 205d 0a20 2020 2020 2020 2023 2020     ].        #  
+000067b0: 2020 2020 2020 2020 6b65 793d 6b65 792c          key=key,
+000067c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000067d0: 2020 2020 2020 2020 2076 616c 3d73 7472           val=str
+000067e0: 2876 616c 292c 0a20 2020 2020 2020 2020  (val),.         
+000067f0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00006800: 6f75 7263 653d 736f 7572 6365 2c0a 2020  ource=source,.  
+00006810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006820: 2020 2020 2020 6e6f 7465 3d6e 6f74 652c        note=note,
+00006830: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006840: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+00006850: 2020 2020 2320 5061 7274 2032 3a20 6f74      # Part 2: ot
+00006860: 6865 7220 6669 656c 6473 0a20 2020 2020  her fields.     
+00006870: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00006880: 2020 2020 2020 2020 2020 2020 2023 206b               # k
+00006890: 6565 7020 6578 6973 7469 6e67 2076 616c  eep existing val
+000068a0: 7565 7320 7065 7220 6465 6661 756c 740a  ues per default.
+000068b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000068c0: 6966 206b 6579 2069 6e20 7365 6c66 2e64  if key in self.d
+000068d0: 6174 613a 0a20 2020 2020 2020 2020 2020  ata:.           
+000068e0: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
+000068f0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00006900: 2020 7365 6c66 2e75 7064 6174 655f 6669    self.update_fi
+00006910: 656c 6428 0a20 2020 2020 2020 2020 2020  eld(.           
+00006920: 2020 2020 2020 2020 206b 6579 3d6b 6579           key=key
+00006930: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00006940: 2020 2020 2020 7661 6c75 653d 7374 7228        value=str(
+00006950: 7661 6c29 2c0a 2020 2020 2020 2020 2020  val),.          
+00006960: 2020 2020 2020 2020 2020 736f 7572 6365            source
+00006970: 3d73 6f75 7263 652c 0a20 2020 2020 2020  =source,.       
+00006980: 2020 2020 2020 2020 2020 2020 206e 6f74               not
+00006990: 653d 6e6f 7465 2c0a 2020 2020 2020 2020  e=note,.        
+000069a0: 2020 2020 2020 2020 2020 2020 6b65 6570              keep
+000069b0: 5f73 6f75 7263 655f 6966 5f65 7175 616c  _source_if_equal
+000069c0: 3d54 7275 652c 0a20 2020 2020 2020 2020  =True,.         
+000069d0: 2020 2020 2020 2020 2020 2061 7070 656e             appen
+000069e0: 645f 6564 6974 3d46 616c 7365 2c0a 2020  d_edit=False,.  
+000069f0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+00006a00: 0a20 2020 2040 636c 6173 736d 6574 686f  .    @classmetho
+00006a10: 640a 2020 2020 6465 6620 5f5f 7365 6c65  d.    def __sele
+00006a20: 6374 5f62 6573 745f 6175 7468 6f72 280a  ct_best_author(.
+00006a30: 2020 2020 2020 2020 636c 732c 202a 2c20          cls, *, 
+00006a40: 7265 636f 7264 3a20 5265 636f 7264 2c20  record: Record, 
+00006a50: 6d65 7267 696e 675f 7265 636f 7264 3a20  merging_record: 
+00006a60: 5265 636f 7264 2c20 7072 6566 6572 7265  Record, preferre
+00006a70: 645f 736f 7572 6365 733a 206c 6973 740a  d_sources: list.
+00006a80: 2020 2020 2920 2d3e 2073 7472 3a0a 2020      ) -> str:.  
+00006a90: 2020 2020 2020 2320 7079 6c69 6e74 3a20        # pylint: 
+00006aa0: 6469 7361 626c 653d 746f 6f2d 6d61 6e79  disable=too-many
+00006ab0: 2d72 6574 7572 6e2d 7374 6174 656d 656e  -return-statemen
+00006ac0: 7473 0a20 2020 2020 2020 2069 6620 2263  ts.        if "c
+00006ad0: 6f6c 7265 765f 6d61 7374 6572 6461 7461  olrev_masterdata
+00006ae0: 5f70 726f 7665 6e61 6e63 6522 206e 6f74  _provenance" not
+00006af0: 2069 6e20 7265 636f 7264 2e64 6174 613a   in record.data:
+00006b00: 0a20 2020 2020 2020 2020 2020 2072 6563  .            rec
+00006b10: 6f72 642e 6461 7461 5b22 636f 6c72 6576  ord.data["colrev
+00006b20: 5f6d 6173 7465 7264 6174 615f 7072 6f76  _masterdata_prov
+00006b30: 656e 616e 6365 225d 203d 207b 7d0a 2020  enance"] = {}.  
+00006b40: 2020 2020 2020 7265 636f 7264 5f61 5f70        record_a_p
+00006b50: 726f 7620 3d20 7265 636f 7264 2e64 6174  rov = record.dat
+00006b60: 615b 2263 6f6c 7265 765f 6d61 7374 6572  a["colrev_master
+00006b70: 6461 7461 5f70 726f 7665 6e61 6e63 6522  data_provenance"
+00006b80: 5d0a 0a20 2020 2020 2020 2069 6620 2263  ]..        if "c
+00006b90: 6f6c 7265 765f 6d61 7374 6572 6461 7461  olrev_masterdata
+00006ba0: 5f70 726f 7665 6e61 6e63 6522 206e 6f74  _provenance" not
+00006bb0: 2069 6e20 6d65 7267 696e 675f 7265 636f   in merging_reco
+00006bc0: 7264 2e64 6174 613a 0a20 2020 2020 2020  rd.data:.       
+00006bd0: 2020 2020 206d 6572 6769 6e67 5f72 6563       merging_rec
+00006be0: 6f72 642e 6461 7461 5b22 636f 6c72 6576  ord.data["colrev
+00006bf0: 5f6d 6173 7465 7264 6174 615f 7072 6f76  _masterdata_prov
+00006c00: 656e 616e 6365 225d 203d 207b 7d0a 2020  enance"] = {}.  
+00006c10: 2020 2020 2020 6d65 7267 696e 675f 7265        merging_re
+00006c20: 636f 7264 5f61 5f70 726f 7620 3d20 6d65  cord_a_prov = me
+00006c30: 7267 696e 675f 7265 636f 7264 2e64 6174  rging_record.dat
+00006c40: 615b 2263 6f6c 7265 765f 6d61 7374 6572  a["colrev_master
+00006c50: 6461 7461 5f70 726f 7665 6e61 6e63 6522  data_provenance"
+00006c60: 5d0a 0a20 2020 2020 2020 2069 6620 2261  ]..        if "a
+00006c70: 7574 686f 7222 2069 6e20 7265 636f 7264  uthor" in record
+00006c80: 5f61 5f70 726f 7620 616e 6420 2261 7574  _a_prov and "aut
+00006c90: 686f 7222 206e 6f74 2069 6e20 6d65 7267  hor" not in merg
+00006ca0: 696e 675f 7265 636f 7264 5f61 5f70 726f  ing_record_a_pro
+00006cb0: 763a 0a20 2020 2020 2020 2020 2020 2023  v:.            #
+00006cc0: 2050 7265 6665 7220 6e6f 6e2d 6465 6665   Prefer non-defe
+00006cd0: 6374 2076 6572 7369 6f6e 0a20 2020 2020  ct version.     
+00006ce0: 2020 2020 2020 2069 6620 2271 7561 6c69         if "quali
+00006cf0: 7479 5f64 6566 6563 7422 2069 6e20 7265  ty_defect" in re
+00006d00: 636f 7264 5f61 5f70 726f 765b 2261 7574  cord_a_prov["aut
+00006d10: 686f 7222 5d2e 6765 7428 226e 6f74 6522  hor"].get("note"
+00006d20: 2c20 2222 293a 0a20 2020 2020 2020 2020  , ""):.         
+00006d30: 2020 2020 2020 2072 6574 7572 6e20 6d65         return me
+00006d40: 7267 696e 675f 7265 636f 7264 2e64 6174  rging_record.dat
+00006d50: 615b 2261 7574 686f 7222 5d0a 2020 2020  a["author"].    
+00006d60: 2020 2020 2020 2020 2320 5072 6566 6572          # Prefer
+00006d70: 2063 6f6d 706c 6574 6520 7665 7273 696f   complete versio
+00006d80: 6e0a 2020 2020 2020 2020 2020 2020 6966  n.            if
+00006d90: 2022 696e 636f 6d70 6c65 7465 2220 696e   "incomplete" in
+00006da0: 2072 6563 6f72 645f 615f 7072 6f76 5b22   record_a_prov["
+00006db0: 6175 7468 6f72 225d 2e67 6574 2822 6e6f  author"].get("no
+00006dc0: 7465 222c 2022 2229 3a0a 2020 2020 2020  te", ""):.      
+00006dd0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00006de0: 206d 6572 6769 6e67 5f72 6563 6f72 642e   merging_record.
+00006df0: 6461 7461 5b22 6175 7468 6f72 225d 0a20  data["author"]. 
+00006e00: 2020 2020 2020 2065 6c69 6620 2261 7574         elif "aut
+00006e10: 686f 7222 2069 6e20 7265 636f 7264 5f61  hor" in record_a
+00006e20: 5f70 726f 7620 616e 6420 2261 7574 686f  _prov and "autho
+00006e30: 7222 2069 6e20 6d65 7267 696e 675f 7265  r" in merging_re
+00006e40: 636f 7264 5f61 5f70 726f 763a 0a20 2020  cord_a_prov:.   
+00006e50: 2020 2020 2020 2020 2023 2050 7265 6665           # Prefe
+00006e60: 7220 6e6f 6e2d 6465 6665 6374 2076 6572  r non-defect ver
+00006e70: 7369 6f6e 0a20 2020 2020 2020 2020 2020  sion.           
+00006e80: 2069 6620 2271 7561 6c69 7479 5f64 6566   if "quality_def
+00006e90: 6563 7422 2069 6e20 7265 636f 7264 5f61  ect" in record_a
+00006ea0: 5f70 726f 765b 2261 7574 686f 7222 5d2e  _prov["author"].
+00006eb0: 6765 7428 0a20 2020 2020 2020 2020 2020  get(.           
+00006ec0: 2020 2020 2022 6e6f 7465 222c 2022 220a       "note", "".
+00006ed0: 2020 2020 2020 2020 2020 2020 2920 616e              ) an
+00006ee0: 6420 2271 7561 6c69 7479 5f64 6566 6563  d "quality_defec
+00006ef0: 7422 206e 6f74 2069 6e20 6d65 7267 696e  t" not in mergin
+00006f00: 675f 7265 636f 7264 5f61 5f70 726f 765b  g_record_a_prov[
+00006f10: 2261 7574 686f 7222 5d2e 6765 7428 0a20  "author"].get(. 
+00006f20: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00006f30: 6e6f 7465 222c 2022 220a 2020 2020 2020  note", "".      
+00006f40: 2020 2020 2020 293a 0a20 2020 2020 2020        ):.       
+00006f50: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00006f60: 6d65 7267 696e 675f 7265 636f 7264 2e64  merging_record.d
+00006f70: 6174 615b 2261 7574 686f 7222 5d0a 0a20  ata["author"].. 
+00006f80: 2020 2020 2020 2020 2020 2023 2050 7265             # Pre
+00006f90: 6665 7220 636f 6d70 6c65 7465 2076 6572  fer complete ver
+00006fa0: 7369 6f6e 0a20 2020 2020 2020 2020 2020  sion.           
+00006fb0: 2069 6620 2269 6e63 6f6d 706c 6574 6522   if "incomplete"
+00006fc0: 2069 6e20 7265 636f 7264 5f61 5f70 726f   in record_a_pro
+00006fd0: 765b 2261 7574 686f 7222 5d2e 6765 7428  v["author"].get(
+00006fe0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006ff0: 2022 6e6f 7465 222c 2022 220a 2020 2020   "note", "".    
+00007000: 2020 2020 2020 2020 2920 616e 6420 2269          ) and "i
+00007010: 6e63 6f6d 706c 6574 6522 206e 6f74 2069  ncomplete" not i
+00007020: 6e20 6d65 7267 696e 675f 7265 636f 7264  n merging_record
+00007030: 5f61 5f70 726f 765b 2261 7574 686f 7222  _a_prov["author"
+00007040: 5d2e 6765 7428 226e 6f74 6522 2c20 2222  ].get("note", ""
+00007050: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00007060: 2020 2072 6574 7572 6e20 6d65 7267 696e     return mergin
+00007070: 675f 7265 636f 7264 2e64 6174 615b 2261  g_record.data["a
+00007080: 7574 686f 7222 5d0a 0a20 2020 2020 2020  uthor"]..       
+00007090: 2069 6620 6c65 6e28 7265 636f 7264 2e64   if len(record.d
+000070a0: 6174 615b 2261 7574 686f 7222 5d29 203e  ata["author"]) >
+000070b0: 2030 2061 6e64 206c 656e 286d 6572 6769   0 and len(mergi
+000070c0: 6e67 5f72 6563 6f72 642e 6461 7461 5b22  ng_record.data["
+000070d0: 6175 7468 6f72 225d 2920 3e20 303a 0a20  author"]) > 0:. 
+000070e0: 2020 2020 2020 2020 2020 2064 6566 6175             defau
+000070f0: 6c74 5f6d 6f73 746c 795f 7570 7065 7220  lt_mostly_upper 
+00007100: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
+00007110: 2020 2020 636f 6c72 6576 2e65 6e76 2e75      colrev.env.u
+00007120: 7469 6c73 2e70 6572 6365 6e74 5f75 7070  tils.percent_upp
+00007130: 6572 5f63 6861 7273 2872 6563 6f72 642e  er_chars(record.
+00007140: 6461 7461 5b22 6175 7468 6f72 225d 2920  data["author"]) 
+00007150: 3e20 302e 380a 2020 2020 2020 2020 2020  > 0.8.          
+00007160: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+00007170: 6361 6e64 6964 6174 655f 6d6f 7374 6c79  candidate_mostly
+00007180: 5f75 7070 6572 203d 2028 0a20 2020 2020  _upper = (.     
+00007190: 2020 2020 2020 2020 2020 2063 6f6c 7265             colre
+000071a0: 762e 656e 762e 7574 696c 732e 7065 7263  v.env.utils.perc
+000071b0: 656e 745f 7570 7065 725f 6368 6172 7328  ent_upper_chars(
+000071c0: 6d65 7267 696e 675f 7265 636f 7264 2e64  merging_record.d
+000071d0: 6174 615b 2261 7574 686f 7222 5d29 0a20  ata["author"]). 
+000071e0: 2020 2020 2020 2020 2020 2020 2020 203e                 >
+000071f0: 2030 2e38 0a20 2020 2020 2020 2020 2020   0.8.           
+00007200: 2029 0a0a 2020 2020 2020 2020 2020 2020   )..            
+00007210: 2320 5072 6566 6572 2074 6974 6c65 2063  # Prefer title c
+00007220: 6173 6520 286e 6f74 2061 6c6c 2d63 6170  ase (not all-cap
+00007230: 7329 0a20 2020 2020 2020 2020 2020 2069  s).            i
+00007240: 6620 6465 6661 756c 745f 6d6f 7374 6c79  f default_mostly
+00007250: 5f75 7070 6572 2061 6e64 206e 6f74 2063  _upper and not c
+00007260: 616e 6469 6461 7465 5f6d 6f73 746c 795f  andidate_mostly_
+00007270: 7570 7065 723a 0a20 2020 2020 2020 2020  upper:.         
+00007280: 2020 2020 2020 2072 6574 7572 6e20 6d65         return me
+00007290: 7267 696e 675f 7265 636f 7264 2e64 6174  rging_record.dat
+000072a0: 615b 2261 7574 686f 7222 5d0a 0a20 2020  a["author"]..   
+000072b0: 2020 2020 2023 2050 7265 6665 7220 736f       # Prefer so
+000072c0: 7572 6365 730a 2020 2020 2020 2020 6966  urces.        if
+000072d0: 2022 6175 7468 6f72 2220 696e 206d 6572   "author" in mer
+000072e0: 6769 6e67 5f72 6563 6f72 645f 615f 7072  ging_record_a_pr
+000072f0: 6f76 3a0a 2020 2020 2020 2020 2020 2020  ov:.            
+00007300: 6966 2061 6e79 280a 2020 2020 2020 2020  if any(.        
+00007310: 2020 2020 2020 2020 7820 696e 206d 6572          x in mer
+00007320: 6769 6e67 5f72 6563 6f72 645f 615f 7072  ging_record_a_pr
+00007330: 6f76 5b22 6175 7468 6f72 225d 5b22 736f  ov["author"]["so
+00007340: 7572 6365 225d 0a20 2020 2020 2020 2020  urce"].         
+00007350: 2020 2020 2020 2066 6f72 2078 2069 6e20         for x in 
+00007360: 7072 6566 6572 7265 645f 736f 7572 6365  preferred_source
+00007370: 730a 2020 2020 2020 2020 2020 2020 293a  s.            ):
+00007380: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007390: 2072 6574 7572 6e20 6d65 7267 696e 675f   return merging_
+000073a0: 7265 636f 7264 2e64 6174 615b 2261 7574  record.data["aut
+000073b0: 686f 7222 5d0a 2020 2020 2020 2020 7265  hor"].        re
+000073c0: 7475 726e 2072 6563 6f72 642e 6461 7461  turn record.data
+000073d0: 5b22 6175 7468 6f72 225d 0a0a 2020 2020  ["author"]..    
+000073e0: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
+000073f0: 2064 6566 205f 5f73 656c 6563 745f 6265   def __select_be
+00007400: 7374 5f70 6167 6573 280a 2020 2020 2020  st_pages(.      
+00007410: 2020 636c 732c 0a20 2020 2020 2020 202a    cls,.        *
+00007420: 2c0a 2020 2020 2020 2020 7265 636f 7264  ,.        record
+00007430: 3a20 5265 636f 7264 2c0a 2020 2020 2020  : Record,.      
+00007440: 2020 6d65 7267 696e 675f 7265 636f 7264    merging_record
+00007450: 3a20 5265 636f 7264 2c0a 2020 2020 2020  : Record,.      
+00007460: 2020 7072 6566 6572 7265 645f 736f 7572    preferred_sour
+00007470: 6365 733a 206c 6973 742c 2020 2320 7079  ces: list,  # py
+00007480: 6c69 6e74 3a20 6469 7361 626c 653d 756e  lint: disable=un
+00007490: 7573 6564 2d61 7267 756d 656e 740a 2020  used-argument.  
+000074a0: 2020 2920 2d3e 2073 7472 3a0a 2020 2020    ) -> str:.    
+000074b0: 2020 2020 6265 7374 5f70 6167 6573 203d      best_pages =
+000074c0: 2072 6563 6f72 642e 6461 7461 5b22 7061   record.data["pa
+000074d0: 6765 7322 5d0a 2020 2020 2020 2020 6966  ges"].        if
+000074e0: 2022 2d2d 2220 696e 206d 6572 6769 6e67   "--" in merging
+000074f0: 5f72 6563 6f72 642e 6461 7461 5b22 7061  _record.data["pa
+00007500: 6765 7322 5d20 616e 6420 222d 2d22 206e  ges"] and "--" n
+00007510: 6f74 2069 6e20 7265 636f 7264 2e64 6174  ot in record.dat
+00007520: 615b 2270 6167 6573 225d 3a0a 2020 2020  a["pages"]:.    
+00007530: 2020 2020 2020 2020 6265 7374 5f70 6167          best_pag
+00007540: 6573 203d 206d 6572 6769 6e67 5f72 6563  es = merging_rec
+00007550: 6f72 642e 6461 7461 5b22 7061 6765 7322  ord.data["pages"
+00007560: 5d0a 2020 2020 2020 2020 7265 7475 726e  ].        return
+00007570: 2062 6573 745f 7061 6765 730a 0a20 2020   best_pages..   
+00007580: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
+00007590: 2020 6465 6620 5f5f 7365 6c65 6374 5f62    def __select_b
+000075a0: 6573 745f 7469 746c 6528 0a20 2020 2020  est_title(.     
+000075b0: 2020 2063 6c73 2c0a 2020 2020 2020 2020     cls,.        
+000075c0: 2a2c 0a20 2020 2020 2020 2072 6563 6f72  *,.        recor
+000075d0: 643a 2052 6563 6f72 642c 0a20 2020 2020  d: Record,.     
+000075e0: 2020 206d 6572 6769 6e67 5f72 6563 6f72     merging_recor
+000075f0: 643a 2052 6563 6f72 642c 0a20 2020 2020  d: Record,.     
+00007600: 2020 2070 7265 6665 7272 6564 5f73 6f75     preferred_sou
+00007610: 7263 6573 3a20 6c69 7374 2c20 2023 2070  rces: list,  # p
+00007620: 796c 696e 743a 2064 6973 6162 6c65 3d75  ylint: disable=u
+00007630: 6e75 7365 642d 6172 6775 6d65 6e74 0a20  nused-argument. 
+00007640: 2020 2029 202d 3e20 7374 723a 0a20 2020     ) -> str:.   
+00007650: 2020 2020 2064 6566 6175 6c74 203d 2072       default = r
+00007660: 6563 6f72 642e 6461 7461 5b22 7469 746c  ecord.data["titl
+00007670: 6522 5d0a 2020 2020 2020 2020 6361 6e64  e"].        cand
+00007680: 6964 6174 6520 3d20 6d65 7267 696e 675f  idate = merging_
+00007690: 7265 636f 7264 2e64 6174 615b 2274 6974  record.data["tit
+000076a0: 6c65 225d 0a20 2020 2020 2020 2062 6573  le"].        bes
+000076b0: 745f 7469 746c 6520 3d20 7265 636f 7264  t_title = record
+000076c0: 2e64 6174 615b 2274 6974 6c65 225d 0a0a  .data["title"]..
+000076d0: 2020 2020 2020 2020 2320 4e6f 7465 203a          # Note :
+000076e0: 2061 766f 6964 2073 7769 7463 6869 6e67   avoid switching
+000076f0: 2074 6974 6c65 730a 2020 2020 2020 2020   titles.        
+00007700: 6966 2064 6566 6175 6c74 2e72 6570 6c61  if default.repla
+00007710: 6365 2822 202d 2022 2c20 223a 2022 2920  ce(" - ", ": ") 
+00007720: 3d3d 2063 616e 6469 6461 7465 2e72 6570  == candidate.rep
+00007730: 6c61 6365 2822 202d 2022 2c20 223a 2022  lace(" - ", ": "
+00007740: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
+00007750: 6574 7572 6e20 6465 6661 756c 740a 0a20  eturn default.. 
+00007760: 2020 2020 2020 2064 6566 6175 6c74 5f75         default_u
+00007770: 7070 6572 203d 2063 6f6c 7265 762e 656e  pper = colrev.en
+00007780: 762e 7574 696c 732e 7065 7263 656e 745f  v.utils.percent_
+00007790: 7570 7065 725f 6368 6172 7328 6465 6661  upper_chars(defa
+000077a0: 756c 7429 0a20 2020 2020 2020 2063 616e  ult).        can
+000077b0: 6469 6461 7465 5f75 7070 6572 203d 2063  didate_upper = c
+000077c0: 6f6c 7265 762e 656e 762e 7574 696c 732e  olrev.env.utils.
+000077d0: 7065 7263 656e 745f 7570 7065 725f 6368  percent_upper_ch
+000077e0: 6172 7328 6361 6e64 6964 6174 6529 0a0a  ars(candidate)..
+000077f0: 2020 2020 2020 2020 6966 2063 616e 6469          if candi
+00007800: 6461 7465 5b2d 315d 206e 6f74 2069 6e20  date[-1] not in 
+00007810: 5b22 2a22 2c20 2231 222c 2022 3222 5d3a  ["*", "1", "2"]:
+00007820: 0a20 2020 2020 2020 2020 2020 2023 2052  .            # R
+00007830: 656c 6174 6976 656c 7920 7369 6d70 6c65  elatively simple
+00007840: 2072 756c 652e 2e2e 0a20 2020 2020 2020   rule....       
+00007850: 2020 2020 2023 2063 6174 6368 6573 2063       # catches c
+00007860: 6173 6573 2077 6865 6e20 6465 6661 756c  ases when defaul
+00007870: 7420 6973 2061 6c6c 2075 7070 6572 206f  t is all upper o
+00007880: 7220 7469 746c 6520 6361 7365 0a20 2020  r title case.   
+00007890: 2020 2020 2020 2020 2069 6620 6465 6661           if defa
+000078a0: 756c 745f 7570 7065 7220 3e20 6361 6e64  ult_upper > cand
+000078b0: 6964 6174 655f 7570 7065 723a 0a20 2020  idate_upper:.   
+000078c0: 2020 2020 2020 2020 2020 2020 2062 6573               bes
+000078d0: 745f 7469 746c 6520 3d20 6361 6e64 6964  t_title = candid
+000078e0: 6174 650a 2020 2020 2020 2020 7265 7475  ate.        retu
+000078f0: 726e 2062 6573 745f 7469 746c 650a 0a20  rn best_title.. 
+00007900: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
+00007910: 2020 2020 6465 6620 5f5f 7365 6c65 6374      def __select
+00007920: 5f62 6573 745f 6a6f 7572 6e61 6c28 0a20  _best_journal(. 
+00007930: 2020 2020 2020 2063 6c73 2c0a 2020 2020         cls,.    
+00007940: 2020 2020 2a2c 0a20 2020 2020 2020 2072      *,.        r
+00007950: 6563 6f72 643a 2052 6563 6f72 642c 0a20  ecord: Record,. 
+00007960: 2020 2020 2020 206d 6572 6769 6e67 5f72         merging_r
+00007970: 6563 6f72 643a 2052 6563 6f72 642c 0a20  ecord: Record,. 
+00007980: 2020 2020 2020 2070 7265 6665 7272 6564         preferred
+00007990: 5f73 6f75 7263 6573 3a20 6c69 7374 2c20  _sources: list, 
+000079a0: 2023 2070 796c 696e 743a 2064 6973 6162   # pylint: disab
+000079b0: 6c65 3d75 6e75 7365 642d 6172 6775 6d65  le=unused-argume
+000079c0: 6e74 0a20 2020 2029 202d 3e20 7374 723a  nt.    ) -> str:
+000079d0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000079e0: 636c 732e 5f5f 7365 6c65 6374 5f62 6573  cls.__select_bes
+000079f0: 745f 636f 6e74 6169 6e65 725f 7469 746c  t_container_titl
+00007a00: 6528 0a20 2020 2020 2020 2020 2020 2064  e(.            d
+00007a10: 6566 6175 6c74 3d72 6563 6f72 642e 6461  efault=record.da
+00007a20: 7461 5b22 6a6f 7572 6e61 6c22 5d2c 2063  ta["journal"], c
+00007a30: 616e 6469 6461 7465 3d6d 6572 6769 6e67  andidate=merging
+00007a40: 5f72 6563 6f72 642e 6461 7461 5b22 6a6f  _record.data["jo
+00007a50: 7572 6e61 6c22 5d0a 2020 2020 2020 2020  urnal"].        
+00007a60: 290a 0a20 2020 2040 636c 6173 736d 6574  )..    @classmet
+00007a70: 686f 640a 2020 2020 6465 6620 5f5f 7365  hod.    def __se
+00007a80: 6c65 6374 5f62 6573 745f 626f 6f6b 7469  lect_best_bookti
+00007a90: 746c 6528 0a20 2020 2020 2020 2063 6c73  tle(.        cls
+00007aa0: 2c0a 2020 2020 2020 2020 2a2c 0a20 2020  ,.        *,.   
+00007ab0: 2020 2020 2072 6563 6f72 643a 2052 6563       record: Rec
+00007ac0: 6f72 642c 0a20 2020 2020 2020 206d 6572  ord,.        mer
+00007ad0: 6769 6e67 5f72 6563 6f72 643a 2052 6563  ging_record: Rec
+00007ae0: 6f72 642c 0a20 2020 2020 2020 2070 7265  ord,.        pre
+00007af0: 6665 7272 6564 5f73 6f75 7263 6573 3a20  ferred_sources: 
+00007b00: 6c69 7374 2c20 2023 2070 796c 696e 743a  list,  # pylint:
+00007b10: 2064 6973 6162 6c65 3d75 6e75 7365 642d   disable=unused-
+00007b20: 6172 6775 6d65 6e74 0a20 2020 2029 202d  argument.    ) -
+00007b30: 3e20 7374 723a 0a20 2020 2020 2020 2072  > str:.        r
+00007b40: 6574 7572 6e20 636c 732e 5f5f 7365 6c65  eturn cls.__sele
+00007b50: 6374 5f62 6573 745f 636f 6e74 6169 6e65  ct_best_containe
+00007b60: 725f 7469 746c 6528 0a20 2020 2020 2020  r_title(.       
+00007b70: 2020 2020 2064 6566 6175 6c74 3d72 6563       default=rec
+00007b80: 6f72 642e 6461 7461 5b22 626f 6f6b 7469  ord.data["bookti
+00007b90: 746c 6522 5d2c 2063 616e 6469 6461 7465  tle"], candidate
+00007ba0: 3d6d 6572 6769 6e67 5f72 6563 6f72 642e  =merging_record.
+00007bb0: 6461 7461 5b22 626f 6f6b 7469 746c 6522  data["booktitle"
+00007bc0: 5d0a 2020 2020 2020 2020 290a 0a20 2020  ].        )..   
+00007bd0: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
+00007be0: 2020 6465 6620 5f5f 7365 6c65 6374 5f62    def __select_b
+00007bf0: 6573 745f 636f 6e74 6169 6e65 725f 7469  est_container_ti
+00007c00: 746c 6528 636c 732c 202a 2c20 6465 6661  tle(cls, *, defa
+00007c10: 756c 743a 2073 7472 2c20 6361 6e64 6964  ult: str, candid
+00007c20: 6174 653a 2073 7472 2920 2d3e 2073 7472  ate: str) -> str
+00007c30: 3a0a 2020 2020 2020 2020 6265 7374 5f6a  :.        best_j
+00007c40: 6f75 726e 616c 203d 2064 6566 6175 6c74  ournal = default
+00007c50: 0a0a 2020 2020 2020 2020 6465 6661 756c  ..        defaul
+00007c60: 745f 7570 7065 7220 3d20 636f 6c72 6576  t_upper = colrev
+00007c70: 2e65 6e76 2e75 7469 6c73 2e70 6572 6365  .env.utils.perce
+00007c80: 6e74 5f75 7070 6572 5f63 6861 7273 2864  nt_upper_chars(d
+00007c90: 6566 6175 6c74 290a 2020 2020 2020 2020  efault).        
+00007ca0: 6361 6e64 6964 6174 655f 7570 7065 7220  candidate_upper 
+00007cb0: 3d20 636f 6c72 6576 2e65 6e76 2e75 7469  = colrev.env.uti
+00007cc0: 6c73 2e70 6572 6365 6e74 5f75 7070 6572  ls.percent_upper
+00007cd0: 5f63 6861 7273 2863 616e 6469 6461 7465  _chars(candidate
+00007ce0: 290a 0a20 2020 2020 2020 2023 2053 696d  )..        # Sim
+00007cf0: 706c 6520 6865 7572 6973 7469 6320 746f  ple heuristic to
+00007d00: 2061 766f 6964 2061 6262 7265 7669 6174   avoid abbreviat
+00007d10: 696f 6e73 0a20 2020 2020 2020 2069 6620  ions.        if 
+00007d20: 222e 2220 696e 2064 6566 6175 6c74 2061  "." in default a
+00007d30: 6e64 2022 2e22 206e 6f74 2069 6e20 6361  nd "." not in ca
+00007d40: 6e64 6964 6174 653a 0a20 2020 2020 2020  ndidate:.       
+00007d50: 2020 2020 2062 6573 745f 6a6f 7572 6e61       best_journa
+00007d60: 6c20 3d20 6361 6e64 6964 6174 650a 2020  l = candidate.  
+00007d70: 2020 2020 2020 2320 5265 6c61 7469 7665        # Relative
+00007d80: 6c79 2073 696d 706c 6520 7275 6c65 2e2e  ly simple rule..
+00007d90: 2e0a 2020 2020 2020 2020 2320 6361 7463  ..        # catc
+00007da0: 6865 7320 6361 7365 7320 7768 656e 2064  hes cases when d
+00007db0: 6566 6175 6c74 2069 7320 616c 6c20 7570  efault is all up
+00007dc0: 7065 7220 6f72 2074 6974 6c65 2063 6173  per or title cas
+00007dd0: 650a 2020 2020 2020 2020 6966 2064 6566  e.        if def
+00007de0: 6175 6c74 5f75 7070 6572 203e 2063 616e  ault_upper > can
+00007df0: 6469 6461 7465 5f75 7070 6572 3a0a 2020  didate_upper:.  
+00007e00: 2020 2020 2020 2020 2020 6265 7374 5f6a            best_j
+00007e10: 6f75 726e 616c 203d 2063 616e 6469 6461  ournal = candida
+00007e20: 7465 0a20 2020 2020 2020 2072 6574 7572  te.        retur
+00007e30: 6e20 6265 7374 5f6a 6f75 726e 616c 0a0a  n best_journal..
+00007e40: 2020 2020 6465 6620 5f5f 6675 7365 5f62      def __fuse_b
+00007e50: 6573 745f 6669 656c 6428 0a20 2020 2020  est_field(.     
+00007e60: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
+00007e70: 202a 2c0a 2020 2020 2020 2020 6d65 7267   *,.        merg
+00007e80: 696e 675f 7265 636f 7264 3a20 5265 636f  ing_record: Reco
+00007e90: 7264 2c0a 2020 2020 2020 2020 6b65 793a  rd,.        key:
+00007ea0: 2073 7472 2c0a 2020 2020 2020 2020 7661   str,.        va
+00007eb0: 6c3a 2073 7472 2c0a 2020 2020 2020 2020  l: str,.        
+00007ec0: 736f 7572 6365 3a20 7374 722c 0a20 2020  source: str,.   
+00007ed0: 2020 2020 206e 6f74 653a 2073 7472 2c20       note: str, 
+00007ee0: 2023 2070 796c 696e 743a 2064 6973 6162   # pylint: disab
+00007ef0: 6c65 3d75 6e75 7365 642d 6172 6775 6d65  le=unused-argume
+00007f00: 6e74 0a20 2020 2029 202d 3e20 4e6f 6e65  nt.    ) -> None
+00007f10: 3a0a 2020 2020 2020 2020 2320 4e6f 7465  :.        # Note
+00007f20: 203a 2074 6865 2061 7373 756d 7074 696f   : the assumptio
+00007f30: 6e20 6973 2074 6861 7420 7765 206e 6565  n is that we nee
+00007f40: 6420 6d61 7374 6572 6461 7461 5f70 726f  d masterdata_pro
+00007f50: 7665 6e61 6e63 6520 6e6f 7465 730a 2020  venance notes.  
+00007f60: 2020 2020 2020 2320 6f6e 6c79 2066 6f72        # only for
+00007f70: 2061 7574 686f 7273 0a0a 2020 2020 2020   authors..      
+00007f80: 2020 6375 7374 6f6d 5f66 6965 6c64 5f73    custom_field_s
+00007f90: 656c 6563 746f 7273 203d 207b 0a20 2020  electors = {.   
+00007fa0: 2020 2020 2020 2020 2022 6175 7468 6f72           "author
+00007fb0: 223a 2073 656c 662e 5f5f 7365 6c65 6374  ": self.__select
+00007fc0: 5f62 6573 745f 6175 7468 6f72 2c0a 2020  _best_author,.  
+00007fd0: 2020 2020 2020 2020 2020 2270 6167 6573            "pages
+00007fe0: 223a 2073 656c 662e 5f5f 7365 6c65 6374  ": self.__select
+00007ff0: 5f62 6573 745f 7061 6765 732c 0a20 2020  _best_pages,.   
+00008000: 2020 2020 2020 2020 2022 7469 746c 6522           "title"
+00008010: 3a20 7365 6c66 2e5f 5f73 656c 6563 745f  : self.__select_
+00008020: 6265 7374 5f74 6974 6c65 2c0a 2020 2020  best_title,.    
+00008030: 2020 2020 2020 2020 226a 6f75 726e 616c          "journal
+00008040: 223a 2073 656c 662e 5f5f 7365 6c65 6374  ": self.__select
+00008050: 5f62 6573 745f 6a6f 7572 6e61 6c2c 0a20  _best_journal,. 
+00008060: 2020 2020 2020 2020 2020 2022 626f 6f6b             "book
+00008070: 7469 746c 6522 3a20 7365 6c66 2e5f 5f73  title": self.__s
+00008080: 656c 6563 745f 6265 7374 5f62 6f6f 6b74  elect_best_bookt
+00008090: 6974 6c65 2c0a 2020 2020 2020 2020 7d0a  itle,.        }.
+000080a0: 0a20 2020 2020 2020 2069 6620 6b65 7920  .        if key 
+000080b0: 696e 2063 7573 746f 6d5f 6669 656c 645f  in custom_field_
+000080c0: 7365 6c65 6374 6f72 733a 0a20 2020 2020  selectors:.     
+000080d0: 2020 2020 2020 2069 6620 6b65 7920 696e         if key in
+000080e0: 2073 656c 662e 6461 7461 3a0a 2020 2020   self.data:.    
+000080f0: 2020 2020 2020 2020 2020 2020 6265 7374              best
+00008100: 5f76 616c 7565 203d 2063 7573 746f 6d5f  _value = custom_
+00008110: 6669 656c 645f 7365 6c65 6374 6f72 735b  field_selectors[
+00008120: 6b65 795d 280a 2020 2020 2020 2020 2020  key](.          
+00008130: 2020 2020 2020 2020 2020 7265 636f 7264            record
+00008140: 3d73 656c 662c 0a20 2020 2020 2020 2020  =self,.         
+00008150: 2020 2020 2020 2020 2020 206d 6572 6769             mergi
+00008160: 6e67 5f72 6563 6f72 643d 6d65 7267 696e  ng_record=mergin
+00008170: 675f 7265 636f 7264 2c0a 2020 2020 2020  g_record,.      
+00008180: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+00008190: 6566 6572 7265 645f 736f 7572 6365 733d  eferred_sources=
+000081a0: 7365 6c66 2e70 7265 6665 7272 6564 5f73  self.preferred_s
+000081b0: 6f75 7263 6573 2c0a 2020 2020 2020 2020  ources,.        
+000081c0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+000081d0: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
+000081e0: 662e 6461 7461 5b6b 6579 5d20 213d 2062  f.data[key] != b
+000081f0: 6573 745f 7661 6c75 653a 0a20 2020 2020  est_value:.     
+00008200: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00008210: 656c 662e 7570 6461 7465 5f66 6965 6c64  elf.update_field
+00008220: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00008230: 2020 2020 2020 2020 2020 6b65 793d 6b65            key=ke
+00008240: 792c 2076 616c 7565 3d62 6573 745f 7661  y, value=best_va
+00008250: 6c75 652c 2073 6f75 7263 653d 736f 7572  lue, source=sour
+00008260: 6365 2c20 6170 7065 6e64 5f65 6469 743d  ce, append_edit=
+00008270: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
+00008280: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00008290: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+000082a0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+000082b0: 6c66 2e75 7064 6174 655f 6669 656c 6428  lf.update_field(
+000082c0: 6b65 793d 6b65 792c 2076 616c 7565 3d76  key=key, value=v
+000082d0: 616c 2c20 736f 7572 6365 3d73 6f75 7263  al, source=sourc
+000082e0: 652c 2061 7070 656e 645f 6564 6974 3d46  e, append_edit=F
+000082f0: 616c 7365 290a 0a20 2020 2020 2020 2065  alse)..        e
+00008300: 6c69 6620 6b65 7920 3d3d 2022 6669 6c65  lif key == "file
+00008310: 223a 0a20 2020 2020 2020 2020 2020 2069  ":.            i
+00008320: 6620 6b65 7920 696e 2073 656c 662e 6461  f key in self.da
+00008330: 7461 3a0a 2020 2020 2020 2020 2020 2020  ta:.            
+00008340: 2020 2020 7365 6c66 2e64 6174 615b 6b65      self.data[ke
+00008350: 795d 203d 2073 656c 662e 6461 7461 5b6b  y] = self.data[k
+00008360: 6579 5d20 2b20 223b 2220 2b20 6d65 7267  ey] + ";" + merg
+00008370: 696e 675f 7265 636f 7264 2e64 6174 612e  ing_record.data.
+00008380: 6765 7428 6b65 792c 2022 2229 0a20 2020  get(key, "").   
+00008390: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+000083a0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000083b0: 656c 662e 6461 7461 5b6b 6579 5d20 3d20  elf.data[key] = 
+000083c0: 6d65 7267 696e 675f 7265 636f 7264 2e64  merging_record.d
+000083d0: 6174 615b 6b65 795d 0a20 2020 2020 2020  ata[key].       
+000083e0: 2065 6c69 6620 6b65 7920 696e 205b 2275   elif key in ["u
+000083f0: 726c 222c 2022 6c69 6e6b 225d 3a0a 2020  rl", "link"]:.  
+00008400: 2020 2020 2020 2020 2020 6966 2028 0a20            if (. 
+00008410: 2020 2020 2020 2020 2020 2020 2020 206b                 k
+00008420: 6579 2069 6e20 7365 6c66 2e64 6174 610a  ey in self.data.
+00008430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008440: 616e 6420 7365 6c66 2e64 6174 615b 6b65  and self.data[ke
+00008450: 795d 2e72 7374 7269 7028 222f 2229 2021  y].rstrip("/") !
+00008460: 3d20 6d65 7267 696e 675f 7265 636f 7264  = merging_record
+00008470: 2e64 6174 615b 6b65 795d 2e72 7374 7269  .data[key].rstri
+00008480: 7028 222f 2229 0a20 2020 2020 2020 2020  p("/").         
+00008490: 2020 2020 2020 2061 6e64 2022 6874 7470         and "http
+000084a0: 7322 206e 6f74 2069 6e20 7365 6c66 2e64  s" not in self.d
+000084b0: 6174 615b 6b65 795d 0a20 2020 2020 2020  ata[key].       
+000084c0: 2020 2020 2029 3a0a 2020 2020 2020 2020       ):.        
+000084d0: 2020 2020 2020 2020 7365 6c66 2e75 7064          self.upd
+000084e0: 6174 655f 6669 656c 6428 6b65 793d 6b65  ate_field(key=ke
+000084f0: 792c 2076 616c 7565 3d76 616c 2c20 736f  y, value=val, so
+00008500: 7572 6365 3d73 6f75 7263 652c 2061 7070  urce=source, app
+00008510: 656e 645f 6564 6974 3d46 616c 7365 290a  end_edit=False).
+00008520: 0a20 2020 2020 2020 2065 6c69 6620 2255  .        elif "U
+00008530: 4e4b 4e4f 574e 2220 3d3d 2073 656c 662e  NKNOWN" == self.
+00008540: 6461 7461 2e67 6574 280a 2020 2020 2020  data.get(.      
+00008550: 2020 2020 2020 6b65 792c 2022 220a 2020        key, "".  
+00008560: 2020 2020 2020 2920 616e 6420 2255 4e4b        ) and "UNK
+00008570: 4e4f 574e 2220 213d 206d 6572 6769 6e67  NOWN" != merging
+00008580: 5f72 6563 6f72 642e 6461 7461 2e67 6574  _record.data.get
+00008590: 286b 6579 2c20 2222 293a 0a20 2020 2020  (key, ""):.     
+000085a0: 2020 2020 2020 2073 656c 662e 6461 7461         self.data
+000085b0: 5b6b 6579 5d20 3d20 6d65 7267 696e 675f  [key] = merging_
+000085c0: 7265 636f 7264 2e64 6174 615b 6b65 795d  record.data[key]
+000085d0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000085e0: 6b65 7920 696e 2073 656c 662e 6964 656e  key in self.iden
+000085f0: 7469 6679 696e 675f 6669 656c 645f 6b65  tifying_field_ke
+00008600: 7973 3a0a 2020 2020 2020 2020 2020 2020  ys:.            
+00008610: 2020 2020 7365 6c66 2e61 6464 5f6d 6173      self.add_mas
+00008620: 7465 7264 6174 615f 7072 6f76 656e 616e  terdata_provenan
+00008630: 6365 286b 6579 3d6b 6579 2c20 736f 7572  ce(key=key, sour
+00008640: 6365 3d73 6f75 7263 6529 0a20 2020 2020  ce=source).     
 00008650: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00008660: 2020 2020 2023 2020 2020 2020 2020 2020       #          
-00008670: 2020 2073 6f75 7263 6520 3d20 6d65 7267     source = merg
-00008680: 696e 675f 7265 636f 7264 2e64 6174 615b  ing_record.data[
-00008690: 2263 6f6c 7265 765f 6461 7461 5f70 726f  "colrev_data_pro
-000086a0: 7665 6e61 6e63 6522 5d5b 6b65 795d 5b0a  venance"][key][.
-000086b0: 2020 2020 2020 2020 2320 2020 2020 2020          #       
-000086c0: 2020 2020 2020 2020 2020 2273 6f75 7263            "sourc
-000086d0: 6522 0a20 2020 2020 2020 2023 2020 2020  e".        #    
-000086e0: 2020 2020 2020 2020 205d 0a20 2020 2020           ].     
-000086f0: 2020 2023 2020 2020 2065 7863 6570 7420     #     except 
-00008700: 4b65 7945 7272 6f72 3a0a 2020 2020 2020  KeyError:.      
-00008710: 2020 2320 2020 2020 2020 2020 7061 7373    #         pass
-00008720: 0a20 2020 2020 2020 2023 2069 6620 7661  .        # if va
-00008730: 6c20 213d 2073 7472 286d 6572 6769 6e67  l != str(merging
-00008740: 5f72 6563 6f72 642e 6461 7461 5b6b 6579  _record.data[key
-00008750: 5d29 3a0a 2020 2020 2020 2020 2320 2020  ]):.        #   
-00008760: 2020 7365 6c66 2e75 7064 6174 655f 6669    self.update_fi
-00008770: 656c 6428 0a20 2020 2020 2020 2023 2020  eld(.        #  
-00008780: 2020 2020 2020 206b 6579 3d6b 6579 2c0a         key=key,.
-00008790: 2020 2020 2020 2020 2320 2020 2020 2020          #       
-000087a0: 2020 7661 6c75 653d 7374 7228 6d65 7267    value=str(merg
-000087b0: 696e 675f 7265 636f 7264 2e64 6174 615b  ing_record.data[
-000087c0: 6b65 795d 292c 0a20 2020 2020 2020 2023  key]),.        #
-000087d0: 2020 2020 2020 2020 2073 6f75 7263 653d           source=
-000087e0: 736f 7572 6365 2c0a 2020 2020 2020 2020  source,.        
-000087f0: 2320 2020 2020 2020 2020 6e6f 7465 3d6e  #         note=n
-00008800: 6f74 652c 0a20 2020 2020 2020 2023 2020  ote,.        #  
-00008810: 2020 2029 0a20 2020 2020 2020 2023 2073     ).        # s
-00008820: 656c 662e 7570 6461 7465 5f66 6965 6c64  elf.update_field
-00008830: 286b 6579 3d6b 6579 2c20 7661 6c75 653d  (key=key, value=
-00008840: 7661 6c2c 2073 6f75 7263 653d 736f 7572  val, source=sour
-00008850: 6365 2c20 6e6f 7465 3d6e 6f74 6529 0a0a  ce, note=note)..
-00008860: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
-00008870: 0a20 2020 2064 6566 2067 6574 5f72 6563  .    def get_rec
-00008880: 6f72 645f 6368 616e 6765 5f73 636f 7265  ord_change_score
-00008890: 2863 6c73 2c20 2a2c 2072 6563 6f72 645f  (cls, *, record_
-000088a0: 613a 2052 6563 6f72 642c 2072 6563 6f72  a: Record, recor
-000088b0: 645f 623a 2052 6563 6f72 6429 202d 3e20  d_b: Record) -> 
-000088c0: 666c 6f61 743a 0a20 2020 2020 2020 2022  float:.        "
-000088d0: 2222 4465 7465 726d 696e 6520 686f 7720  ""Determine how 
-000088e0: 6d75 6368 2072 6563 6f72 6473 2063 6861  much records cha
-000088f0: 6e67 6564 0a0a 2020 2020 2020 2020 5468  nged..        Th
-00008900: 6973 206d 6574 686f 6420 6973 206c 6573  is method is les
-00008910: 7320 7365 6e73 6974 6976 6520 7468 616e  s sensitive than
-00008920: 2067 6574 5f72 6563 6f72 645f 7369 6d69   get_record_simi
-00008930: 6c61 7269 7479 2c20 6573 7065 6369 616c  larity, especial
-00008940: 6c79 2077 6865 6e0a 2020 2020 2020 2020  ly when.        
-00008950: 6669 656c 6473 2061 7265 206d 6973 7369  fields are missi
-00008960: 6e67 2e20 466f 7220 6578 616d 706c 652c  ng. For example,
-00008970: 2069 6620 7468 6520 6a6f 7572 6e61 6c20   if the journal 
-00008980: 6669 656c 6420 6973 206d 6973 7369 6e67  field is missing
-00008990: 2069 6e20 626f 7468 0a20 2020 2020 2020   in both.       
-000089a0: 2072 6563 6f72 6473 2c20 6765 745f 7369   records, get_si
-000089b0: 6d69 6c61 7269 7479 2077 696c 6c20 7265  milarity will re
-000089c0: 7475 726e 2061 2076 616c 7565 203e 2031  turn a value > 1
-000089d0: 2e30 2e20 5468 6520 6765 745f 7265 636f  .0. The get_reco
-000089e0: 7264 5f63 6861 6e67 6573 0a20 2020 2020  rd_changes.     
-000089f0: 2020 2077 696c 6c20 7265 7475 726e 2030     will return 0
-00008a00: 2e30 2028 6966 2061 6c6c 206f 7468 6572  .0 (if all other
-00008a10: 2066 6965 6c64 7320 6172 6520 6571 7561   fields are equa
-00008a20: 6c29 2e22 2222 0a0a 2020 2020 2020 2020  l)."""..        
-00008a30: 2320 4174 2073 6f6d 6520 706f 696e 742c  # At some point,
-00008a40: 2074 6869 7320 6d61 7920 6265 636f 6d65   this may become
-00008a50: 206d 6f72 6520 7365 6e73 6974 6976 6520   more sensitive 
-00008a60: 746f 206d 616a 6f72 2063 6861 6e67 6573  to major changes
-00008a70: 0a20 2020 2020 2020 2073 7472 5f61 203d  .        str_a =
-00008a80: 2028 0a20 2020 2020 2020 2020 2020 2066   (.            f
-00008a90: 227b 7265 636f 7264 5f61 2e64 6174 612e  "{record_a.data.
-00008aa0: 6765 7428 2761 7574 686f 7227 2c20 2727  get('author', ''
-00008ab0: 297d 2028 7b72 6563 6f72 645f 612e 6461  )} ({record_a.da
-00008ac0: 7461 2e67 6574 2827 7965 6172 272c 2027  ta.get('year', '
-00008ad0: 2729 7d29 2022 0a20 2020 2020 2020 2020  ')}) ".         
-00008ae0: 2020 202b 2066 227b 7265 636f 7264 5f61     + f"{record_a
-00008af0: 2e64 6174 612e 6765 7428 2774 6974 6c65  .data.get('title
-00008b00: 272c 2027 2729 7d2e 2022 0a20 2020 2020  ', '')}. ".     
-00008b10: 2020 2020 2020 202b 2066 227b 7265 636f         + f"{reco
-00008b20: 7264 5f61 2e64 6174 612e 6765 7428 276a  rd_a.data.get('j
-00008b30: 6f75 726e 616c 272c 2027 2729 7d7b 7265  ournal', '')}{re
-00008b40: 636f 7264 5f61 2e64 6174 612e 6765 7428  cord_a.data.get(
-00008b50: 2762 6f6f 6b74 6974 6c65 272c 2027 2729  'booktitle', '')
-00008b60: 7d2c 2022 0a20 2020 2020 2020 2020 2020  }, ".           
-00008b70: 202b 2066 227b 7265 636f 7264 5f61 2e64   + f"{record_a.d
-00008b80: 6174 612e 6765 7428 2776 6f6c 756d 6527  ata.get('volume'
-00008b90: 2c20 2727 297d 2028 7b72 6563 6f72 645f  , '')} ({record_
-00008ba0: 612e 6461 7461 2e67 6574 2827 6e75 6d62  a.data.get('numb
-00008bb0: 6572 272c 2027 2729 7d29 220a 2020 2020  er', '')})".    
-00008bc0: 2020 2020 290a 2020 2020 2020 2020 7374      ).        st
-00008bd0: 725f 6220 3d20 280a 2020 2020 2020 2020  r_b = (.        
-00008be0: 2020 2020 6622 7b72 6563 6f72 645f 622e      f"{record_b.
-00008bf0: 6461 7461 2e67 6574 2827 6175 7468 6f72  data.get('author
-00008c00: 272c 2027 2729 7d20 287b 7265 636f 7264  ', '')} ({record
-00008c10: 5f62 2e64 6174 612e 6765 7428 2779 6561  _b.data.get('yea
-00008c20: 7227 2c20 2727 297d 2920 220a 2020 2020  r', '')}) ".    
-00008c30: 2020 2020 2020 2020 2b20 6622 7b72 6563          + f"{rec
-00008c40: 6f72 645f 622e 6461 7461 2e67 6574 2827  ord_b.data.get('
-00008c50: 7469 746c 6527 2c20 2727 297d 2e20 220a  title', '')}. ".
-00008c60: 2020 2020 2020 2020 2020 2020 2b20 6622              + f"
-00008c70: 7b72 6563 6f72 645f 622e 6461 7461 2e67  {record_b.data.g
-00008c80: 6574 2827 6a6f 7572 6e61 6c27 2c20 2727  et('journal', ''
-00008c90: 297d 7b72 6563 6f72 645f 622e 6461 7461  )}{record_b.data
-00008ca0: 2e67 6574 2827 626f 6f6b 7469 746c 6527  .get('booktitle'
-00008cb0: 2c20 2727 297d 2c20 220a 2020 2020 2020  , '')}, ".      
-00008cc0: 2020 2020 2020 2b20 6622 7b72 6563 6f72        + f"{recor
-00008cd0: 645f 622e 6461 7461 2e67 6574 2827 766f  d_b.data.get('vo
-00008ce0: 6c75 6d65 272c 2027 2729 7d20 287b 7265  lume', '')} ({re
-00008cf0: 636f 7264 5f62 2e64 6174 612e 6765 7428  cord_b.data.get(
-00008d00: 276e 756d 6265 7227 2c20 2727 297d 2922  'number', '')})"
-00008d10: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
-00008d20: 2020 2072 6574 7572 6e20 3120 2d20 6675     return 1 - fu
-00008d30: 7a7a 2e72 6174 696f 2873 7472 5f61 2e6c  zz.ratio(str_a.l
-00008d40: 6f77 6572 2829 2c20 7374 725f 622e 6c6f  ower(), str_b.lo
-00008d50: 7765 7228 2929 202f 2031 3030 0a0a 2020  wer()) / 100..  
-00008d60: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
-00008d70: 2020 2064 6566 2067 6574 5f72 6563 6f72     def get_recor
-00008d80: 645f 7369 6d69 6c61 7269 7479 2863 6c73  d_similarity(cls
-00008d90: 2c20 2a2c 2072 6563 6f72 645f 613a 2052  , *, record_a: R
-00008da0: 6563 6f72 642c 2072 6563 6f72 645f 623a  ecord, record_b:
-00008db0: 2052 6563 6f72 6429 202d 3e20 666c 6f61   Record) -> floa
-00008dc0: 743a 0a20 2020 2020 2020 2022 2222 4465  t:.        """De
-00008dd0: 7465 726d 696e 6520 7468 6520 7369 6d69  termine the simi
-00008de0: 6c61 7269 7479 2062 6574 7765 656e 2074  larity between t
-00008df0: 776f 2072 6563 6f72 6473 2028 7468 6569  wo records (thei
-00008e00: 7220 6d61 7374 6572 6461 7461 2922 2222  r masterdata)"""
-00008e10: 0a20 2020 2020 2020 2072 6563 6f72 645f  .        record_
-00008e20: 615f 6469 6374 203d 2072 6563 6f72 645f  a_dict = record_
-00008e30: 612e 636f 7079 2829 2e67 6574 5f64 6174  a.copy().get_dat
-00008e40: 6128 290a 2020 2020 2020 2020 7265 636f  a().        reco
-00008e50: 7264 5f62 5f64 6963 7420 3d20 7265 636f  rd_b_dict = reco
-00008e60: 7264 5f62 2e63 6f70 7928 292e 6765 745f  rd_b.copy().get_
-00008e70: 6461 7461 2829 0a0a 2020 2020 2020 2020  data()..        
-00008e80: 6d61 6e64 6174 6f72 795f 6669 656c 6473  mandatory_fields
-00008e90: 203d 205b 0a20 2020 2020 2020 2020 2020   = [.           
-00008ea0: 2022 7469 746c 6522 2c0a 2020 2020 2020   "title",.      
-00008eb0: 2020 2020 2020 2261 7574 686f 7222 2c0a        "author",.
-00008ec0: 2020 2020 2020 2020 2020 2020 2279 6561              "yea
-00008ed0: 7222 2c0a 2020 2020 2020 2020 2020 2020  r",.            
-00008ee0: 226a 6f75 726e 616c 222c 0a20 2020 2020  "journal",.     
-00008ef0: 2020 2020 2020 2022 766f 6c75 6d65 222c         "volume",
-00008f00: 0a20 2020 2020 2020 2020 2020 2022 6e75  .            "nu
-00008f10: 6d62 6572 222c 0a20 2020 2020 2020 2020  mber",.         
-00008f20: 2020 2022 7061 6765 7322 2c0a 2020 2020     "pages",.    
-00008f30: 2020 2020 2020 2020 2262 6f6f 6b74 6974          "booktit
-00008f40: 6c65 222c 0a20 2020 2020 2020 205d 0a0a  le",.        ]..
-00008f50: 2020 2020 2020 2020 666f 7220 6d61 6e64          for mand
-00008f60: 6174 6f72 795f 6669 656c 6420 696e 206d  atory_field in m
-00008f70: 616e 6461 746f 7279 5f66 6965 6c64 733a  andatory_fields:
-00008f80: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00008f90: 7265 636f 7264 5f61 5f64 6963 742e 6765  record_a_dict.ge
-00008fa0: 7428 6d61 6e64 6174 6f72 795f 6669 656c  t(mandatory_fiel
-00008fb0: 642c 2022 554e 4b4e 4f57 4e22 2920 3d3d  d, "UNKNOWN") ==
-00008fc0: 2022 554e 4b4e 4f57 4e22 3a0a 2020 2020   "UNKNOWN":.    
-00008fd0: 2020 2020 2020 2020 2020 2020 7265 636f              reco
-00008fe0: 7264 5f61 5f64 6963 745b 6d61 6e64 6174  rd_a_dict[mandat
-00008ff0: 6f72 795f 6669 656c 645d 203d 2022 220a  ory_field] = "".
-00009000: 2020 2020 2020 2020 2020 2020 6966 2072              if r
-00009010: 6563 6f72 645f 625f 6469 6374 2e67 6574  ecord_b_dict.get
-00009020: 286d 616e 6461 746f 7279 5f66 6965 6c64  (mandatory_field
-00009030: 2c20 2255 4e4b 4e4f 574e 2229 203d 3d20  , "UNKNOWN") == 
-00009040: 2255 4e4b 4e4f 574e 223a 0a20 2020 2020  "UNKNOWN":.     
-00009050: 2020 2020 2020 2020 2020 2072 6563 6f72             recor
-00009060: 645f 625f 6469 6374 5b6d 616e 6461 746f  d_b_dict[mandato
-00009070: 7279 5f66 6965 6c64 5d20 3d20 2222 0a0a  ry_field] = ""..
-00009080: 2020 2020 2020 2020 6966 2022 636f 6e74          if "cont
-00009090: 6169 6e65 725f 7469 746c 6522 206e 6f74  ainer_title" not
-000090a0: 2069 6e20 7265 636f 7264 5f61 5f64 6963   in record_a_dic
-000090b0: 743a 0a20 2020 2020 2020 2020 2020 2072  t:.            r
-000090c0: 6563 6f72 645f 615f 6469 6374 5b22 636f  ecord_a_dict["co
-000090d0: 6e74 6169 6e65 725f 7469 746c 6522 5d20  ntainer_title"] 
-000090e0: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
-000090f0: 2020 2020 7265 636f 7264 5f61 5f64 6963      record_a_dic
-00009100: 742e 6765 7428 226a 6f75 726e 616c 222c  t.get("journal",
-00009110: 2022 2229 0a20 2020 2020 2020 2020 2020   "").           
-00009120: 2020 2020 202b 2072 6563 6f72 645f 615f       + record_a_
-00009130: 6469 6374 2e67 6574 2822 626f 6f6b 7469  dict.get("bookti
-00009140: 746c 6522 2c20 2222 290a 2020 2020 2020  tle", "").      
-00009150: 2020 2020 2020 2020 2020 2b20 7265 636f            + reco
-00009160: 7264 5f61 5f64 6963 742e 6765 7428 2273  rd_a_dict.get("s
-00009170: 6572 6965 7322 2c20 2222 290a 2020 2020  eries", "").    
-00009180: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-00009190: 2020 2069 6620 2263 6f6e 7461 696e 6572     if "container
-000091a0: 5f74 6974 6c65 2220 6e6f 7420 696e 2072  _title" not in r
-000091b0: 6563 6f72 645f 625f 6469 6374 3a0a 2020  ecord_b_dict:.  
-000091c0: 2020 2020 2020 2020 2020 7265 636f 7264            record
-000091d0: 5f62 5f64 6963 745b 2263 6f6e 7461 696e  _b_dict["contain
-000091e0: 6572 5f74 6974 6c65 225d 203d 2028 0a20  er_title"] = (. 
-000091f0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00009200: 6563 6f72 645f 625f 6469 6374 2e67 6574  ecord_b_dict.get
-00009210: 2822 6a6f 7572 6e61 6c22 2c20 2222 290a  ("journal", "").
-00009220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009230: 2b20 7265 636f 7264 5f62 5f64 6963 742e  + record_b_dict.
-00009240: 6765 7428 2262 6f6f 6b74 6974 6c65 222c  get("booktitle",
-00009250: 2022 2229 0a20 2020 2020 2020 2020 2020   "").           
-00009260: 2020 2020 202b 2072 6563 6f72 645f 625f       + record_b_
-00009270: 6469 6374 2e67 6574 2822 7365 7269 6573  dict.get("series
-00009280: 222c 2022 2229 0a20 2020 2020 2020 2020  ", "").         
-00009290: 2020 2029 0a0a 2020 2020 2020 2020 6466     )..        df
-000092a0: 5f61 203d 2070 642e 4461 7461 4672 616d  _a = pd.DataFram
-000092b0: 652e 6672 6f6d 5f64 6963 7428 5b72 6563  e.from_dict([rec
-000092c0: 6f72 645f 615f 6469 6374 5d29 2020 2320  ord_a_dict])  # 
-000092d0: 7479 7065 3a20 6967 6e6f 7265 0a20 2020  type: ignore.   
-000092e0: 2020 2020 2064 665f 6220 3d20 7064 2e44       df_b = pd.D
-000092f0: 6174 6146 7261 6d65 2e66 726f 6d5f 6469  ataFrame.from_di
-00009300: 6374 285b 7265 636f 7264 5f62 5f64 6963  ct([record_b_dic
-00009310: 745d 2920 2023 2074 7970 653a 2069 676e  t])  # type: ign
-00009320: 6f72 650a 0a20 2020 2020 2020 2072 6574  ore..        ret
-00009330: 7572 6e20 5265 636f 7264 2e67 6574 5f73  urn Record.get_s
-00009340: 696d 696c 6172 6974 7928 6466 5f61 3d64  imilarity(df_a=d
-00009350: 665f 612e 696c 6f63 5b30 5d2c 2064 665f  f_a.iloc[0], df_
-00009360: 623d 6466 5f62 2e69 6c6f 635b 305d 290a  b=df_b.iloc[0]).
-00009370: 0a20 2020 2040 636c 6173 736d 6574 686f  .    @classmetho
-00009380: 640a 2020 2020 6465 6620 6765 745f 7369  d.    def get_si
-00009390: 6d69 6c61 7269 7479 2863 6c73 2c20 2a2c  milarity(cls, *,
-000093a0: 2064 665f 613a 2064 6963 742c 2064 665f   df_a: dict, df_
-000093b0: 623a 2064 6963 7429 202d 3e20 666c 6f61  b: dict) -> floa
-000093c0: 743a 0a20 2020 2020 2020 2022 2222 4465  t:.        """De
-000093d0: 7465 726d 696e 6520 7468 6520 7369 6d69  termine the simi
-000093e0: 6c61 7269 7479 2062 6574 7765 656e 2074  larity between t
-000093f0: 776f 2072 6563 6f72 6473 2222 220a 0a20  wo records""".. 
-00009400: 2020 2020 2020 2064 6574 6169 6c73 203d         details =
-00009410: 2052 6563 6f72 642e 6765 745f 7369 6d69   Record.get_simi
-00009420: 6c61 7269 7479 5f64 6574 6169 6c65 6428  larity_detailed(
-00009430: 7265 636f 7264 5f61 3d64 665f 612c 2072  record_a=df_a, r
-00009440: 6563 6f72 645f 623d 6466 5f62 290a 2020  ecord_b=df_b).  
-00009450: 2020 2020 2020 7265 7475 726e 2064 6574        return det
-00009460: 6169 6c73 5b22 7363 6f72 6522 5d0a 0a20  ails["score"].. 
-00009470: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
-00009480: 2020 2020 6465 6620 6765 745f 7369 6d69      def get_simi
-00009490: 6c61 7269 7479 5f64 6574 6169 6c65 6428  larity_detailed(
-000094a0: 636c 732c 202a 2c20 7265 636f 7264 5f61  cls, *, record_a
-000094b0: 3a20 6469 6374 2c20 7265 636f 7264 5f62  : dict, record_b
-000094c0: 3a20 6469 6374 2920 2d3e 2064 6963 743a  : dict) -> dict:
-000094d0: 0a20 2020 2020 2020 2022 2222 4465 7465  .        """Dete
-000094e0: 726d 696e 6520 7468 6520 6465 7461 696c  rmine the detail
-000094f0: 6564 2073 696d 696c 6172 6974 6965 7320  ed similarities 
-00009500: 6265 7477 6565 6e20 7265 636f 7264 7322  between records"
-00009510: 2222 0a20 2020 2020 2020 2074 7279 3a0a  "".        try:.
-00009520: 2020 2020 2020 2020 2020 2020 6175 7468              auth
-00009530: 6f72 5f73 696d 696c 6172 6974 7920 3d20  or_similarity = 
-00009540: 6675 7a7a 2e72 6174 696f 2872 6563 6f72  fuzz.ratio(recor
-00009550: 645f 615b 2261 7574 686f 7222 5d2c 2072  d_a["author"], r
-00009560: 6563 6f72 645f 625b 2261 7574 686f 7222  ecord_b["author"
-00009570: 5d29 202f 2031 3030 0a0a 2020 2020 2020  ]) / 100..      
-00009580: 2020 2020 2020 7469 746c 655f 7369 6d69        title_simi
-00009590: 6c61 7269 7479 203d 2028 0a20 2020 2020  larity = (.     
-000095a0: 2020 2020 2020 2020 2020 2066 757a 7a2e             fuzz.
-000095b0: 7261 7469 6f28 0a20 2020 2020 2020 2020  ratio(.         
-000095c0: 2020 2020 2020 2020 2020 2072 6563 6f72             recor
-000095d0: 645f 615b 2274 6974 6c65 225d 2e6c 6f77  d_a["title"].low
-000095e0: 6572 2829 2e72 6570 6c61 6365 2822 3a22  er().replace(":"
-000095f0: 2c20 2222 292e 7265 706c 6163 6528 222d  , "").replace("-
-00009600: 222c 2022 2229 2c0a 2020 2020 2020 2020  ", ""),.        
-00009610: 2020 2020 2020 2020 2020 2020 7265 636f              reco
-00009620: 7264 5f62 5b22 7469 746c 6522 5d2e 6c6f  rd_b["title"].lo
-00009630: 7765 7228 292e 7265 706c 6163 6528 223a  wer().replace(":
-00009640: 222c 2022 2229 2e72 6570 6c61 6365 2822  ", "").replace("
-00009650: 2d22 2c20 2222 292c 0a20 2020 2020 2020  -", ""),.       
-00009660: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00009670: 2020 2020 2020 2020 2020 202f 2031 3030             / 100
-00009680: 0a20 2020 2020 2020 2020 2020 2029 0a0a  .            )..
-00009690: 2020 2020 2020 2020 2020 2020 2320 7061              # pa
-000096a0: 7274 6961 6c20 7261 7469 6f20 2863 6174  rtial ratio (cat
-000096b0: 6368 696e 6720 3230 3130 2d31 3020 6f72  ching 2010-10 or
-000096c0: 2032 3030 312d 3230 3032 290a 2020 2020   2001-2002).    
-000096d0: 2020 2020 2020 2020 7965 6172 5f73 696d          year_sim
-000096e0: 696c 6172 6974 7920 3d20 280a 2020 2020  ilarity = (.    
-000096f0: 2020 2020 2020 2020 2020 2020 6675 7a7a              fuzz
-00009700: 2e72 6174 696f 2873 7472 2872 6563 6f72  .ratio(str(recor
-00009710: 645f 615b 2279 6561 7222 5d29 2c20 7374  d_a["year"]), st
-00009720: 7228 7265 636f 7264 5f62 5b22 7965 6172  r(record_b["year
-00009730: 225d 2929 202f 2031 3030 0a20 2020 2020  "])) / 100.     
-00009740: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-00009750: 2020 2020 2020 6f75 746c 6574 5f73 696d        outlet_sim
-00009760: 696c 6172 6974 7920 3d20 302e 300a 2020  ilarity = 0.0.  
-00009770: 2020 2020 2020 2020 2020 6966 2072 6563            if rec
-00009780: 6f72 645f 625b 2263 6f6e 7461 696e 6572  ord_b["container
-00009790: 5f74 6974 6c65 225d 2061 6e64 2072 6563  _title"] and rec
-000097a0: 6f72 645f 615b 2263 6f6e 7461 696e 6572  ord_a["container
-000097b0: 5f74 6974 6c65 225d 3a0a 2020 2020 2020  _title"]:.      
-000097c0: 2020 2020 2020 2020 2020 6f75 746c 6574            outlet
-000097d0: 5f73 696d 696c 6172 6974 7920 3d20 280a  _similarity = (.
-000097e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000097f0: 2020 2020 6675 7a7a 2e72 6174 696f 2872      fuzz.ratio(r
-00009800: 6563 6f72 645f 615b 2263 6f6e 7461 696e  ecord_a["contain
-00009810: 6572 5f74 6974 6c65 225d 2c20 7265 636f  er_title"], reco
-00009820: 7264 5f62 5b22 636f 6e74 6169 6e65 725f  rd_b["container_
-00009830: 7469 746c 6522 5d29 0a20 2020 2020 2020  title"]).       
-00009840: 2020 2020 2020 2020 2020 2020 202f 2031               / 1
-00009850: 3030 0a20 2020 2020 2020 2020 2020 2020  00.             
-00009860: 2020 2029 0a0a 2020 2020 2020 2020 2020     )..          
-00009870: 2020 6966 2073 7472 2872 6563 6f72 645f    if str(record_
-00009880: 615b 226a 6f75 726e 616c 225d 2920 213d  a["journal"]) !=
-00009890: 2022 6e61 6e22 3a0a 2020 2020 2020 2020   "nan":.        
-000098a0: 2020 2020 2020 2020 2320 4e6f 7465 3a20          # Note: 
-000098b0: 666f 7220 6a6f 7572 6e61 6c73 2070 6170  for journals pap
-000098c0: 6572 732c 2077 6520 6578 7065 6374 206d  ers, we expect m
-000098d0: 6f72 6520 6465 7461 696c 730a 2020 2020  ore details.    
-000098e0: 2020 2020 2020 2020 2020 2020 766f 6c75              volu
-000098f0: 6d65 5f73 696d 696c 6172 6974 7920 3d20  me_similarity = 
-00009900: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00009910: 2020 2020 2020 3120 6966 2028 7265 636f        1 if (reco
-00009920: 7264 5f61 5b22 766f 6c75 6d65 225d 203d  rd_a["volume"] =
-00009930: 3d20 7265 636f 7264 5f62 5b22 766f 6c75  = record_b["volu
-00009940: 6d65 225d 2920 656c 7365 2030 0a20 2020  me"]) else 0.   
-00009950: 2020 2020 2020 2020 2020 2020 2029 0a0a               )..
-00009960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009970: 6e75 6d62 6572 5f73 696d 696c 6172 6974  number_similarit
-00009980: 7920 3d20 280a 2020 2020 2020 2020 2020  y = (.          
-00009990: 2020 2020 2020 2020 2020 3120 6966 2028            1 if (
-000099a0: 7265 636f 7264 5f61 5b22 6e75 6d62 6572  record_a["number
-000099b0: 225d 203d 3d20 7265 636f 7264 5f62 5b22  "] == record_b["
-000099c0: 6e75 6d62 6572 225d 2920 656c 7365 2030  number"]) else 0
-000099d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000099e0: 2029 0a0a 2020 2020 2020 2020 2020 2020   )..            
-000099f0: 2020 2020 2320 7061 6765 2073 696d 696c      # page simil
-00009a00: 6172 6974 7920 6973 206e 6f74 2063 6f6e  arity is not con
-00009a10: 7369 6465 7265 6420 6174 2074 6865 206d  sidered at the m
-00009a20: 6f6d 656e 742e 0a20 2020 2020 2020 2020  oment..         
-00009a30: 2020 2020 2020 2023 0a20 2020 2020 2020         #.       
-00009a40: 2020 2020 2020 2020 2023 2073 6f6d 6574           # somet
-00009a50: 696d 6573 2c20 6f6e 6c79 2074 6865 2066  imes, only the f
-00009a60: 6972 7374 2070 6167 6520 6973 2070 726f  irst page is pro
-00009a70: 7669 6465 642e 0a20 2020 2020 2020 2020  vided..         
-00009a80: 2020 2020 2020 2023 2069 6620 7374 7228         # if str(
-00009a90: 7265 636f 7264 5f61 5b22 7061 6765 7322  record_a["pages"
-00009aa0: 5d29 203d 3d20 226e 616e 2220 6f72 2073  ]) == "nan" or s
-00009ab0: 7472 2872 6563 6f72 645f 625b 2270 6167  tr(record_b["pag
-00009ac0: 6573 225d 2920 3d3d 2022 6e61 6e22 3a0a  es"]) == "nan":.
-00009ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009ae0: 2320 2020 2020 7061 6765 735f 7369 6d69  #     pages_simi
-00009af0: 6c61 7269 7479 203d 2031 0a20 2020 2020  larity = 1.     
-00009b00: 2020 2020 2020 2020 2020 2023 2065 6c73             # els
-00009b10: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00009b20: 2020 2023 2020 2020 2069 6620 7265 636f     #     if reco
-00009b30: 7264 5f61 5b22 7061 6765 7322 5d20 3d3d  rd_a["pages"] ==
-00009b40: 2072 6563 6f72 645f 625b 2270 6167 6573   record_b["pages
-00009b50: 225d 3a0a 2020 2020 2020 2020 2020 2020  "]:.            
-00009b60: 2020 2020 2320 2020 2020 2020 2020 7061      #         pa
-00009b70: 6765 735f 7369 6d69 6c61 7269 7479 203d  ges_similarity =
-00009b80: 2031 0a20 2020 2020 2020 2020 2020 2020   1.             
-00009b90: 2020 2023 2020 2020 2065 6c73 653a 0a20     #     else:. 
-00009ba0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00009bb0: 2020 2020 2020 2020 2069 6620 7265 636f           if reco
-00009bc0: 7264 5f61 5b22 7061 6765 7322 5d2e 7370  rd_a["pages"].sp
-00009bd0: 6c69 7428 222d 2229 5b30 5d20 3d3d 2072  lit("-")[0] == r
-00009be0: 6563 6f72 645f 625b 2270 6167 6573 225d  ecord_b["pages"]
-00009bf0: 2e73 706c 6974 2822 2d22 295b 305d 3a0a  .split("-")[0]:.
-00009c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009c10: 2320 2020 2020 2020 2020 2020 2020 7061  #             pa
-00009c20: 6765 735f 7369 6d69 6c61 7269 7479 203d  ges_similarity =
-00009c30: 2031 0a20 2020 2020 2020 2020 2020 2020   1.             
-00009c40: 2020 2023 2020 2020 2020 2020 2065 6c73     #         els
-00009c50: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00009c60: 2020 2023 2020 2020 2020 2020 2020 2020     #            
-00009c70: 7061 6765 735f 7369 6d69 6c61 7269 7479  pages_similarity
-00009c80: 203d 2030 0a0a 2020 2020 2020 2020 2020   = 0..          
-00009c90: 2020 2020 2020 2320 5075 7420 6d6f 7265        # Put more
-00009ca0: 2077 6569 6768 7420 6f6e 206f 7468 6572   weight on other
-00009cb0: 2066 6965 6c64 7320 6966 2074 6865 2074   fields if the t
-00009cc0: 6974 6c65 2069 7320 7665 7279 2063 6f6d  itle is very com
-00009cd0: 6d6f 6e0a 2020 2020 2020 2020 2020 2020  mon.            
-00009ce0: 2020 2020 2320 6965 2e2c 206e 6f6e 2d64      # ie., non-d
-00009cf0: 6973 7469 6e63 7469 7665 0a20 2020 2020  istinctive.     
-00009d00: 2020 2020 2020 2020 2020 2023 2054 6865             # The
-00009d10: 206c 6973 7420 6973 2062 6173 6564 206f   list is based o
-00009d20: 6e20 6120 6c61 7267 6520 6578 706f 7274  n a large export
-00009d30: 206f 6620 6469 7374 696e 6374 2070 6170   of distinct pap
-00009d40: 6572 732c 2074 6162 756c 6174 6564 0a20  ers, tabulated. 
-00009d50: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00009d60: 2061 6363 6f72 6469 6e67 2074 6f20 7469   according to ti
-00009d70: 746c 6573 2061 6e64 2073 6f72 7465 6420  tles and sorted 
-00009d80: 6279 2066 7265 7175 656e 6379 0a20 2020  by frequency.   
-00009d90: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00009da0: 5b72 6563 6f72 645f 615b 2274 6974 6c65  [record_a["title
-00009db0: 225d 2c20 7265 636f 7264 5f62 5b22 7469  "], record_b["ti
-00009dc0: 746c 6522 5d5d 2069 6e20 5b0a 2020 2020  tle"]] in [.    
-00009dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009de0: 5b22 6564 6974 6f72 6961 6c22 2c20 2265  ["editorial", "e
-00009df0: 6469 746f 7269 616c 225d 2c0a 2020 2020  ditorial"],.    
-00009e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009e10: 5b22 6564 6974 6f72 6961 6c20 696e 7472  ["editorial intr
-00009e20: 6f64 7563 7469 6f6e 222c 2022 6564 6974  oduction", "edit
-00009e30: 6f72 6961 6c20 696e 7472 6f64 7563 7469  orial introducti
-00009e40: 6f6e 225d 2c0a 2020 2020 2020 2020 2020  on"],.          
-00009e50: 2020 2020 2020 2020 2020 5b22 6564 6974            ["edit
-00009e60: 6f72 6961 6c20 6e6f 7465 7322 2c20 2265  orial notes", "e
-00009e70: 6469 746f 7269 616c 206e 6f74 6573 225d  ditorial notes"]
-00009e80: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00009e90: 2020 2020 2020 5b22 6564 6974 6f72 2773        ["editor's
-00009ea0: 2063 6f6d 6d65 6e74 7322 2c20 2265 6469   comments", "edi
-00009eb0: 746f 7227 7320 636f 6d6d 656e 7473 225d  tor's comments"]
-00009ec0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00009ed0: 2020 2020 2020 5b22 626f 6f6b 2072 6576        ["book rev
-00009ee0: 6965 7773 222c 2022 626f 6f6b 2072 6576  iews", "book rev
-00009ef0: 6965 7773 225d 2c0a 2020 2020 2020 2020  iews"],.        
-00009f00: 2020 2020 2020 2020 2020 2020 5b22 6564              ["ed
-00009f10: 6974 6f72 6961 6c20 6e6f 7465 222c 2022  itorial note", "
-00009f20: 6564 6974 6f72 6961 6c20 6e6f 7465 225d  editorial note"]
-00009f30: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00009f40: 2020 2020 2020 5b22 7265 7669 6577 6572        ["reviewer
-00009f50: 2061 636b 6f77 6c65 6467 6d65 6e74 222c   ackowledgment",
-00009f60: 2022 7265 7669 6577 6572 2061 636b 6f77   "reviewer ackow
-00009f70: 6c65 6467 6d65 6e74 225d 2c0a 2020 2020  ledgment"],.    
-00009f80: 2020 2020 2020 2020 2020 2020 5d3a 0a20              ]:. 
-00009f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009fa0: 2020 2077 6569 6768 7473 203d 205b 302e     weights = [0.
-00009fb0: 3137 352c 2030 2c20 302e 3137 352c 2030  175, 0, 0.175, 0
-00009fc0: 2e31 3735 2c20 302e 3237 352c 2030 2e32  .175, 0.275, 0.2
-00009fd0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-00009fe0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00009ff0: 2020 2020 2020 2020 2020 2020 7765 6967              weig
-0000a000: 6874 7320 3d20 5b30 2e32 2c20 302e 3235  hts = [0.2, 0.25
-0000a010: 2c20 302e 3133 2c20 302e 322c 2030 2e31  , 0.13, 0.2, 0.1
-0000a020: 322c 2030 2e31 5d0a 0a20 2020 2020 2020  2, 0.1]..       
-0000a030: 2020 2020 2020 2020 2073 696d 5f6e 616d           sim_nam
-0000a040: 6573 203d 205b 0a20 2020 2020 2020 2020  es = [.         
-0000a050: 2020 2020 2020 2020 2020 2022 6175 7468             "auth
-0000a060: 6f72 7322 2c0a 2020 2020 2020 2020 2020  ors",.          
-0000a070: 2020 2020 2020 2020 2020 2274 6974 6c65            "title
-0000a080: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-0000a090: 2020 2020 2020 2022 7965 6172 222c 0a20         "year",. 
-0000a0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a0b0: 2020 2022 6f75 746c 6574 222c 0a20 2020     "outlet",.   
+00008660: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00008670: 662e 6164 645f 6461 7461 5f70 726f 7665  f.add_data_prove
+00008680: 6e61 6e63 6528 6b65 793d 6b65 792c 2073  nance(key=key, s
+00008690: 6f75 7263 653d 736f 7572 6365 290a 0a20  ource=source).. 
+000086a0: 2020 2020 2020 2023 2065 6c69 6620 6d65         # elif me
+000086b0: 7267 696e 675f 7265 636f 7264 2e64 6174  rging_record.dat
+000086c0: 612e 6765 7428 6b65 792c 2022 554e 4b4e  a.get(key, "UNKN
+000086d0: 4f57 4e22 2920 3d3d 2022 554e 4b4e 4f57  OWN") == "UNKNOW
+000086e0: 4e22 3a0a 2020 2020 2020 2020 2320 2020  N":.        #   
+000086f0: 2020 7061 7373 0a20 2020 2020 2020 2023    pass.        #
+00008700: 204e 6f74 6520 3a20 7468 6520 666f 6c6c   Note : the foll
+00008710: 6f77 696e 6720 6973 2064 6561 6374 6976  owing is deactiv
+00008720: 6174 6564 2074 6f20 6176 6f69 6420 6672  ated to avoid fr
+00008730: 6571 7565 6e74 2063 6861 6e67 6573 2069  equent changes i
+00008740: 6e20 6d65 7267 6564 2072 6563 6f72 6473  n merged records
+00008750: 0a20 2020 2020 2020 2023 2065 6c73 653a  .        # else:
+00008760: 0a20 2020 2020 2020 2023 2020 2020 2074  .        #     t
+00008770: 7279 3a0a 2020 2020 2020 2020 2320 2020  ry:.        #   
+00008780: 2020 2020 2020 6966 206b 6579 2069 6e20        if key in 
+00008790: 7365 6c66 2e69 6465 6e74 6966 7969 6e67  self.identifying
+000087a0: 5f66 6965 6c64 5f6b 6579 733a 0a20 2020  _field_keys:.   
+000087b0: 2020 2020 2023 2020 2020 2020 2020 2020       #          
+000087c0: 2020 2073 6f75 7263 6520 3d20 6d65 7267     source = merg
+000087d0: 696e 675f 7265 636f 7264 2e64 6174 615b  ing_record.data[
+000087e0: 2263 6f6c 7265 765f 6d61 7374 6572 6461  "colrev_masterda
+000087f0: 7461 5f70 726f 7665 6e61 6e63 6522 5d5b  ta_provenance"][
+00008800: 6b65 795d 5b0a 2020 2020 2020 2020 2320  key][.        # 
+00008810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008820: 2273 6f75 7263 6522 0a20 2020 2020 2020  "source".       
+00008830: 2023 2020 2020 2020 2020 2020 2020 205d   #             ]
+00008840: 0a20 2020 2020 2020 2023 2020 2020 2020  .        #      
+00008850: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00008860: 2023 2020 2020 2020 2020 2020 2020 2073   #             s
+00008870: 6f75 7263 6520 3d20 6d65 7267 696e 675f  ource = merging_
+00008880: 7265 636f 7264 2e64 6174 615b 2263 6f6c  record.data["col
+00008890: 7265 765f 6461 7461 5f70 726f 7665 6e61  rev_data_provena
+000088a0: 6e63 6522 5d5b 6b65 795d 5b0a 2020 2020  nce"][key][.    
+000088b0: 2020 2020 2320 2020 2020 2020 2020 2020      #           
+000088c0: 2020 2020 2020 2273 6f75 7263 6522 0a20        "source". 
+000088d0: 2020 2020 2020 2023 2020 2020 2020 2020         #        
+000088e0: 2020 2020 205d 0a20 2020 2020 2020 2023       ].        #
+000088f0: 2020 2020 2065 7863 6570 7420 4b65 7945       except KeyE
+00008900: 7272 6f72 3a0a 2020 2020 2020 2020 2320  rror:.        # 
+00008910: 2020 2020 2020 2020 7061 7373 0a20 2020          pass.   
+00008920: 2020 2020 2023 2069 6620 7661 6c20 213d       # if val !=
+00008930: 2073 7472 286d 6572 6769 6e67 5f72 6563   str(merging_rec
+00008940: 6f72 642e 6461 7461 5b6b 6579 5d29 3a0a  ord.data[key]):.
+00008950: 2020 2020 2020 2020 2320 2020 2020 7365          #     se
+00008960: 6c66 2e75 7064 6174 655f 6669 656c 6428  lf.update_field(
+00008970: 0a20 2020 2020 2020 2023 2020 2020 2020  .        #      
+00008980: 2020 206b 6579 3d6b 6579 2c0a 2020 2020     key=key,.    
+00008990: 2020 2020 2320 2020 2020 2020 2020 7661      #         va
+000089a0: 6c75 653d 7374 7228 6d65 7267 696e 675f  lue=str(merging_
+000089b0: 7265 636f 7264 2e64 6174 615b 6b65 795d  record.data[key]
+000089c0: 292c 0a20 2020 2020 2020 2023 2020 2020  ),.        #    
+000089d0: 2020 2020 2073 6f75 7263 653d 736f 7572       source=sour
+000089e0: 6365 2c0a 2020 2020 2020 2020 2320 2020  ce,.        #   
+000089f0: 2020 2020 2020 6e6f 7465 3d6e 6f74 652c        note=note,
+00008a00: 0a20 2020 2020 2020 2023 2020 2020 2029  .        #     )
+00008a10: 0a20 2020 2020 2020 2023 2073 656c 662e  .        # self.
+00008a20: 7570 6461 7465 5f66 6965 6c64 286b 6579  update_field(key
+00008a30: 3d6b 6579 2c20 7661 6c75 653d 7661 6c2c  =key, value=val,
+00008a40: 2073 6f75 7263 653d 736f 7572 6365 2c20   source=source, 
+00008a50: 6e6f 7465 3d6e 6f74 6529 0a0a 2020 2020  note=note)..    
+00008a60: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
+00008a70: 2064 6566 2067 6574 5f72 6563 6f72 645f   def get_record_
+00008a80: 6368 616e 6765 5f73 636f 7265 2863 6c73  change_score(cls
+00008a90: 2c20 2a2c 2072 6563 6f72 645f 613a 2052  , *, record_a: R
+00008aa0: 6563 6f72 642c 2072 6563 6f72 645f 623a  ecord, record_b:
+00008ab0: 2052 6563 6f72 6429 202d 3e20 666c 6f61   Record) -> floa
+00008ac0: 743a 0a20 2020 2020 2020 2022 2222 4465  t:.        """De
+00008ad0: 7465 726d 696e 6520 686f 7720 6d75 6368  termine how much
+00008ae0: 2072 6563 6f72 6473 2063 6861 6e67 6564   records changed
+00008af0: 0a0a 2020 2020 2020 2020 5468 6973 206d  ..        This m
+00008b00: 6574 686f 6420 6973 206c 6573 7320 7365  ethod is less se
+00008b10: 6e73 6974 6976 6520 7468 616e 2067 6574  nsitive than get
+00008b20: 5f72 6563 6f72 645f 7369 6d69 6c61 7269  _record_similari
+00008b30: 7479 2c20 6573 7065 6369 616c 6c79 2077  ty, especially w
+00008b40: 6865 6e0a 2020 2020 2020 2020 6669 656c  hen.        fiel
+00008b50: 6473 2061 7265 206d 6973 7369 6e67 2e20  ds are missing. 
+00008b60: 466f 7220 6578 616d 706c 652c 2069 6620  For example, if 
+00008b70: 7468 6520 6a6f 7572 6e61 6c20 6669 656c  the journal fiel
+00008b80: 6420 6973 206d 6973 7369 6e67 2069 6e20  d is missing in 
+00008b90: 626f 7468 0a20 2020 2020 2020 2072 6563  both.        rec
+00008ba0: 6f72 6473 2c20 6765 745f 7369 6d69 6c61  ords, get_simila
+00008bb0: 7269 7479 2077 696c 6c20 7265 7475 726e  rity will return
+00008bc0: 2061 2076 616c 7565 203e 2031 2e30 2e20   a value > 1.0. 
+00008bd0: 5468 6520 6765 745f 7265 636f 7264 5f63  The get_record_c
+00008be0: 6861 6e67 6573 0a20 2020 2020 2020 2077  hanges.        w
+00008bf0: 696c 6c20 7265 7475 726e 2030 2e30 2028  ill return 0.0 (
+00008c00: 6966 2061 6c6c 206f 7468 6572 2066 6965  if all other fie
+00008c10: 6c64 7320 6172 6520 6571 7561 6c29 2e22  lds are equal)."
+00008c20: 2222 0a0a 2020 2020 2020 2020 2320 4174  ""..        # At
+00008c30: 2073 6f6d 6520 706f 696e 742c 2074 6869   some point, thi
+00008c40: 7320 6d61 7920 6265 636f 6d65 206d 6f72  s may become mor
+00008c50: 6520 7365 6e73 6974 6976 6520 746f 206d  e sensitive to m
+00008c60: 616a 6f72 2063 6861 6e67 6573 0a20 2020  ajor changes.   
+00008c70: 2020 2020 2073 7472 5f61 203d 2028 0a20       str_a = (. 
+00008c80: 2020 2020 2020 2020 2020 2066 227b 7265             f"{re
+00008c90: 636f 7264 5f61 2e64 6174 612e 6765 7428  cord_a.data.get(
+00008ca0: 2761 7574 686f 7227 2c20 2727 297d 2028  'author', '')} (
+00008cb0: 7b72 6563 6f72 645f 612e 6461 7461 2e67  {record_a.data.g
+00008cc0: 6574 2827 7965 6172 272c 2027 2729 7d29  et('year', '')})
+00008cd0: 2022 0a20 2020 2020 2020 2020 2020 202b   ".            +
+00008ce0: 2066 227b 7265 636f 7264 5f61 2e64 6174   f"{record_a.dat
+00008cf0: 612e 6765 7428 2774 6974 6c65 272c 2027  a.get('title', '
+00008d00: 2729 7d2e 2022 0a20 2020 2020 2020 2020  ')}. ".         
+00008d10: 2020 202b 2066 227b 7265 636f 7264 5f61     + f"{record_a
+00008d20: 2e64 6174 612e 6765 7428 276a 6f75 726e  .data.get('journ
+00008d30: 616c 272c 2027 2729 7d7b 7265 636f 7264  al', '')}{record
+00008d40: 5f61 2e64 6174 612e 6765 7428 2762 6f6f  _a.data.get('boo
+00008d50: 6b74 6974 6c65 272c 2027 2729 7d2c 2022  ktitle', '')}, "
+00008d60: 0a20 2020 2020 2020 2020 2020 202b 2066  .            + f
+00008d70: 227b 7265 636f 7264 5f61 2e64 6174 612e  "{record_a.data.
+00008d80: 6765 7428 2776 6f6c 756d 6527 2c20 2727  get('volume', ''
+00008d90: 297d 2028 7b72 6563 6f72 645f 612e 6461  )} ({record_a.da
+00008da0: 7461 2e67 6574 2827 6e75 6d62 6572 272c  ta.get('number',
+00008db0: 2027 2729 7d29 220a 2020 2020 2020 2020   '')})".        
+00008dc0: 290a 2020 2020 2020 2020 7374 725f 6220  ).        str_b 
+00008dd0: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
+00008de0: 6622 7b72 6563 6f72 645f 622e 6461 7461  f"{record_b.data
+00008df0: 2e67 6574 2827 6175 7468 6f72 272c 2027  .get('author', '
+00008e00: 2729 7d20 287b 7265 636f 7264 5f62 2e64  ')} ({record_b.d
+00008e10: 6174 612e 6765 7428 2779 6561 7227 2c20  ata.get('year', 
+00008e20: 2727 297d 2920 220a 2020 2020 2020 2020  '')}) ".        
+00008e30: 2020 2020 2b20 6622 7b72 6563 6f72 645f      + f"{record_
+00008e40: 622e 6461 7461 2e67 6574 2827 7469 746c  b.data.get('titl
+00008e50: 6527 2c20 2727 297d 2e20 220a 2020 2020  e', '')}. ".    
+00008e60: 2020 2020 2020 2020 2b20 6622 7b72 6563          + f"{rec
+00008e70: 6f72 645f 622e 6461 7461 2e67 6574 2827  ord_b.data.get('
+00008e80: 6a6f 7572 6e61 6c27 2c20 2727 297d 7b72  journal', '')}{r
+00008e90: 6563 6f72 645f 622e 6461 7461 2e67 6574  ecord_b.data.get
+00008ea0: 2827 626f 6f6b 7469 746c 6527 2c20 2727  ('booktitle', ''
+00008eb0: 297d 2c20 220a 2020 2020 2020 2020 2020  )}, ".          
+00008ec0: 2020 2b20 6622 7b72 6563 6f72 645f 622e    + f"{record_b.
+00008ed0: 6461 7461 2e67 6574 2827 766f 6c75 6d65  data.get('volume
+00008ee0: 272c 2027 2729 7d20 287b 7265 636f 7264  ', '')} ({record
+00008ef0: 5f62 2e64 6174 612e 6765 7428 276e 756d  _b.data.get('num
+00008f00: 6265 7227 2c20 2727 297d 2922 0a20 2020  ber', '')})".   
+00008f10: 2020 2020 2029 0a20 2020 2020 2020 2072       ).        r
+00008f20: 6574 7572 6e20 3120 2d20 6675 7a7a 2e72  eturn 1 - fuzz.r
+00008f30: 6174 696f 2873 7472 5f61 2e6c 6f77 6572  atio(str_a.lower
+00008f40: 2829 2c20 7374 725f 622e 6c6f 7765 7228  (), str_b.lower(
+00008f50: 2929 202f 2031 3030 0a0a 2020 2020 4063  )) / 100..    @c
+00008f60: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
+00008f70: 6566 2067 6574 5f72 6563 6f72 645f 7369  ef get_record_si
+00008f80: 6d69 6c61 7269 7479 2863 6c73 2c20 2a2c  milarity(cls, *,
+00008f90: 2072 6563 6f72 645f 613a 2052 6563 6f72   record_a: Recor
+00008fa0: 642c 2072 6563 6f72 645f 623a 2052 6563  d, record_b: Rec
+00008fb0: 6f72 6429 202d 3e20 666c 6f61 743a 0a20  ord) -> float:. 
+00008fc0: 2020 2020 2020 2022 2222 4465 7465 726d         """Determ
+00008fd0: 696e 6520 7468 6520 7369 6d69 6c61 7269  ine the similari
+00008fe0: 7479 2062 6574 7765 656e 2074 776f 2072  ty between two r
+00008ff0: 6563 6f72 6473 2028 7468 6569 7220 6d61  ecords (their ma
+00009000: 7374 6572 6461 7461 2922 2222 0a20 2020  sterdata)""".   
+00009010: 2020 2020 2072 6563 6f72 645f 615f 6469       record_a_di
+00009020: 6374 203d 2072 6563 6f72 645f 612e 636f  ct = record_a.co
+00009030: 7079 2829 2e67 6574 5f64 6174 6128 290a  py().get_data().
+00009040: 2020 2020 2020 2020 7265 636f 7264 5f62          record_b
+00009050: 5f64 6963 7420 3d20 7265 636f 7264 5f62  _dict = record_b
+00009060: 2e63 6f70 7928 292e 6765 745f 6461 7461  .copy().get_data
+00009070: 2829 0a0a 2020 2020 2020 2020 6d61 6e64  ()..        mand
+00009080: 6174 6f72 795f 6669 656c 6473 203d 205b  atory_fields = [
+00009090: 0a20 2020 2020 2020 2020 2020 2022 7469  .            "ti
+000090a0: 746c 6522 2c0a 2020 2020 2020 2020 2020  tle",.          
+000090b0: 2020 2261 7574 686f 7222 2c0a 2020 2020    "author",.    
+000090c0: 2020 2020 2020 2020 2279 6561 7222 2c0a          "year",.
+000090d0: 2020 2020 2020 2020 2020 2020 226a 6f75              "jou
+000090e0: 726e 616c 222c 0a20 2020 2020 2020 2020  rnal",.         
+000090f0: 2020 2022 766f 6c75 6d65 222c 0a20 2020     "volume",.   
+00009100: 2020 2020 2020 2020 2022 6e75 6d62 6572           "number
+00009110: 222c 0a20 2020 2020 2020 2020 2020 2022  ",.            "
+00009120: 7061 6765 7322 2c0a 2020 2020 2020 2020  pages",.        
+00009130: 2020 2020 2262 6f6f 6b74 6974 6c65 222c      "booktitle",
+00009140: 0a20 2020 2020 2020 205d 0a0a 2020 2020  .        ]..    
+00009150: 2020 2020 666f 7220 6d61 6e64 6174 6f72      for mandator
+00009160: 795f 6669 656c 6420 696e 206d 616e 6461  y_field in manda
+00009170: 746f 7279 5f66 6965 6c64 733a 0a20 2020  tory_fields:.   
+00009180: 2020 2020 2020 2020 2069 6620 7265 636f           if reco
+00009190: 7264 5f61 5f64 6963 742e 6765 7428 6d61  rd_a_dict.get(ma
+000091a0: 6e64 6174 6f72 795f 6669 656c 642c 2022  ndatory_field, "
+000091b0: 554e 4b4e 4f57 4e22 2920 3d3d 2022 554e  UNKNOWN") == "UN
+000091c0: 4b4e 4f57 4e22 3a0a 2020 2020 2020 2020  KNOWN":.        
+000091d0: 2020 2020 2020 2020 7265 636f 7264 5f61          record_a
+000091e0: 5f64 6963 745b 6d61 6e64 6174 6f72 795f  _dict[mandatory_
+000091f0: 6669 656c 645d 203d 2022 220a 2020 2020  field] = "".    
+00009200: 2020 2020 2020 2020 6966 2072 6563 6f72          if recor
+00009210: 645f 625f 6469 6374 2e67 6574 286d 616e  d_b_dict.get(man
+00009220: 6461 746f 7279 5f66 6965 6c64 2c20 2255  datory_field, "U
+00009230: 4e4b 4e4f 574e 2229 203d 3d20 2255 4e4b  NKNOWN") == "UNK
+00009240: 4e4f 574e 223a 0a20 2020 2020 2020 2020  NOWN":.         
+00009250: 2020 2020 2020 2072 6563 6f72 645f 625f         record_b_
+00009260: 6469 6374 5b6d 616e 6461 746f 7279 5f66  dict[mandatory_f
+00009270: 6965 6c64 5d20 3d20 2222 0a0a 2020 2020  ield] = ""..    
+00009280: 2020 2020 6966 2022 636f 6e74 6169 6e65      if "containe
+00009290: 725f 7469 746c 6522 206e 6f74 2069 6e20  r_title" not in 
+000092a0: 7265 636f 7264 5f61 5f64 6963 743a 0a20  record_a_dict:. 
+000092b0: 2020 2020 2020 2020 2020 2072 6563 6f72             recor
+000092c0: 645f 615f 6469 6374 5b22 636f 6e74 6169  d_a_dict["contai
+000092d0: 6e65 725f 7469 746c 6522 5d20 3d20 280a  ner_title"] = (.
+000092e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000092f0: 7265 636f 7264 5f61 5f64 6963 742e 6765  record_a_dict.ge
+00009300: 7428 226a 6f75 726e 616c 222c 2022 2229  t("journal", "")
+00009310: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009320: 202b 2072 6563 6f72 645f 615f 6469 6374   + record_a_dict
+00009330: 2e67 6574 2822 626f 6f6b 7469 746c 6522  .get("booktitle"
+00009340: 2c20 2222 290a 2020 2020 2020 2020 2020  , "").          
+00009350: 2020 2020 2020 2b20 7265 636f 7264 5f61        + record_a
+00009360: 5f64 6963 742e 6765 7428 2273 6572 6965  _dict.get("serie
+00009370: 7322 2c20 2222 290a 2020 2020 2020 2020  s", "").        
+00009380: 2020 2020 290a 0a20 2020 2020 2020 2069      )..        i
+00009390: 6620 2263 6f6e 7461 696e 6572 5f74 6974  f "container_tit
+000093a0: 6c65 2220 6e6f 7420 696e 2072 6563 6f72  le" not in recor
+000093b0: 645f 625f 6469 6374 3a0a 2020 2020 2020  d_b_dict:.      
+000093c0: 2020 2020 2020 7265 636f 7264 5f62 5f64        record_b_d
+000093d0: 6963 745b 2263 6f6e 7461 696e 6572 5f74  ict["container_t
+000093e0: 6974 6c65 225d 203d 2028 0a20 2020 2020  itle"] = (.     
+000093f0: 2020 2020 2020 2020 2020 2072 6563 6f72             recor
+00009400: 645f 625f 6469 6374 2e67 6574 2822 6a6f  d_b_dict.get("jo
+00009410: 7572 6e61 6c22 2c20 2222 290a 2020 2020  urnal", "").    
+00009420: 2020 2020 2020 2020 2020 2020 2b20 7265              + re
+00009430: 636f 7264 5f62 5f64 6963 742e 6765 7428  cord_b_dict.get(
+00009440: 2262 6f6f 6b74 6974 6c65 222c 2022 2229  "booktitle", "")
+00009450: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009460: 202b 2072 6563 6f72 645f 625f 6469 6374   + record_b_dict
+00009470: 2e67 6574 2822 7365 7269 6573 222c 2022  .get("series", "
+00009480: 2229 0a20 2020 2020 2020 2020 2020 2029  ").            )
+00009490: 0a0a 2020 2020 2020 2020 6466 5f61 203d  ..        df_a =
+000094a0: 2070 642e 4461 7461 4672 616d 652e 6672   pd.DataFrame.fr
+000094b0: 6f6d 5f64 6963 7428 5b72 6563 6f72 645f  om_dict([record_
+000094c0: 615f 6469 6374 5d29 2020 2320 7479 7065  a_dict])  # type
+000094d0: 3a20 6967 6e6f 7265 0a20 2020 2020 2020  : ignore.       
+000094e0: 2064 665f 6220 3d20 7064 2e44 6174 6146   df_b = pd.DataF
+000094f0: 7261 6d65 2e66 726f 6d5f 6469 6374 285b  rame.from_dict([
+00009500: 7265 636f 7264 5f62 5f64 6963 745d 2920  record_b_dict]) 
+00009510: 2023 2074 7970 653a 2069 676e 6f72 650a   # type: ignore.
+00009520: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00009530: 5265 636f 7264 2e67 6574 5f73 696d 696c  Record.get_simil
+00009540: 6172 6974 7928 6466 5f61 3d64 665f 612e  arity(df_a=df_a.
+00009550: 696c 6f63 5b30 5d2c 2064 665f 623d 6466  iloc[0], df_b=df
+00009560: 5f62 2e69 6c6f 635b 305d 290a 0a20 2020  _b.iloc[0])..   
+00009570: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
+00009580: 2020 6465 6620 6765 745f 7369 6d69 6c61    def get_simila
+00009590: 7269 7479 2863 6c73 2c20 2a2c 2064 665f  rity(cls, *, df_
+000095a0: 613a 2064 6963 742c 2064 665f 623a 2064  a: dict, df_b: d
+000095b0: 6963 7429 202d 3e20 666c 6f61 743a 0a20  ict) -> float:. 
+000095c0: 2020 2020 2020 2022 2222 4465 7465 726d         """Determ
+000095d0: 696e 6520 7468 6520 7369 6d69 6c61 7269  ine the similari
+000095e0: 7479 2062 6574 7765 656e 2074 776f 2072  ty between two r
+000095f0: 6563 6f72 6473 2222 220a 0a20 2020 2020  ecords"""..     
+00009600: 2020 2064 6574 6169 6c73 203d 2052 6563     details = Rec
+00009610: 6f72 642e 6765 745f 7369 6d69 6c61 7269  ord.get_similari
+00009620: 7479 5f64 6574 6169 6c65 6428 7265 636f  ty_detailed(reco
+00009630: 7264 5f61 3d64 665f 612c 2072 6563 6f72  rd_a=df_a, recor
+00009640: 645f 623d 6466 5f62 290a 2020 2020 2020  d_b=df_b).      
+00009650: 2020 7265 7475 726e 2064 6574 6169 6c73    return details
+00009660: 5b22 7363 6f72 6522 5d0a 0a20 2020 2040  ["score"]..    @
+00009670: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
+00009680: 6465 6620 6765 745f 7369 6d69 6c61 7269  def get_similari
+00009690: 7479 5f64 6574 6169 6c65 6428 636c 732c  ty_detailed(cls,
+000096a0: 202a 2c20 7265 636f 7264 5f61 3a20 6469   *, record_a: di
+000096b0: 6374 2c20 7265 636f 7264 5f62 3a20 6469  ct, record_b: di
+000096c0: 6374 2920 2d3e 2064 6963 743a 0a20 2020  ct) -> dict:.   
+000096d0: 2020 2020 2022 2222 4465 7465 726d 696e       """Determin
+000096e0: 6520 7468 6520 6465 7461 696c 6564 2073  e the detailed s
+000096f0: 696d 696c 6172 6974 6965 7320 6265 7477  imilarities betw
+00009700: 6565 6e20 7265 636f 7264 7322 2222 0a20  een records""". 
+00009710: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+00009720: 2020 2020 2020 2020 6175 7468 6f72 5f73          author_s
+00009730: 696d 696c 6172 6974 7920 3d20 6675 7a7a  imilarity = fuzz
+00009740: 2e72 6174 696f 2872 6563 6f72 645f 615b  .ratio(record_a[
+00009750: 2261 7574 686f 7222 5d2c 2072 6563 6f72  "author"], recor
+00009760: 645f 625b 2261 7574 686f 7222 5d29 202f  d_b["author"]) /
+00009770: 2031 3030 0a0a 2020 2020 2020 2020 2020   100..          
+00009780: 2020 7469 746c 655f 7369 6d69 6c61 7269    title_similari
+00009790: 7479 203d 2028 0a20 2020 2020 2020 2020  ty = (.         
+000097a0: 2020 2020 2020 2066 757a 7a2e 7261 7469         fuzz.rati
+000097b0: 6f28 0a20 2020 2020 2020 2020 2020 2020  o(.             
+000097c0: 2020 2020 2020 2072 6563 6f72 645f 615b         record_a[
+000097d0: 2274 6974 6c65 225d 2e6c 6f77 6572 2829  "title"].lower()
+000097e0: 2e72 6570 6c61 6365 2822 3a22 2c20 2222  .replace(":", ""
+000097f0: 292e 7265 706c 6163 6528 222d 222c 2022  ).replace("-", "
+00009800: 2229 2c0a 2020 2020 2020 2020 2020 2020  "),.            
+00009810: 2020 2020 2020 2020 7265 636f 7264 5f62          record_b
+00009820: 5b22 7469 746c 6522 5d2e 6c6f 7765 7228  ["title"].lower(
+00009830: 292e 7265 706c 6163 6528 223a 222c 2022  ).replace(":", "
+00009840: 2229 2e72 6570 6c61 6365 2822 2d22 2c20  ").replace("-", 
+00009850: 2222 292c 0a20 2020 2020 2020 2020 2020  ""),.           
+00009860: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+00009870: 2020 2020 2020 202f 2031 3030 0a20 2020         / 100.   
+00009880: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+00009890: 2020 2020 2020 2020 2320 7061 7274 6961          # partia
+000098a0: 6c20 7261 7469 6f20 2863 6174 6368 696e  l ratio (catchin
+000098b0: 6720 3230 3130 2d31 3020 6f72 2032 3030  g 2010-10 or 200
+000098c0: 312d 3230 3032 290a 2020 2020 2020 2020  1-2002).        
+000098d0: 2020 2020 7965 6172 5f73 696d 696c 6172      year_similar
+000098e0: 6974 7920 3d20 280a 2020 2020 2020 2020  ity = (.        
+000098f0: 2020 2020 2020 2020 6675 7a7a 2e72 6174          fuzz.rat
+00009900: 696f 2873 7472 2872 6563 6f72 645f 615b  io(str(record_a[
+00009910: 2279 6561 7222 5d29 2c20 7374 7228 7265  "year"]), str(re
+00009920: 636f 7264 5f62 5b22 7965 6172 225d 2929  cord_b["year"]))
+00009930: 202f 2031 3030 0a20 2020 2020 2020 2020   / 100.         
+00009940: 2020 2029 0a0a 2020 2020 2020 2020 2020     )..          
+00009950: 2020 6f75 746c 6574 5f73 696d 696c 6172    outlet_similar
+00009960: 6974 7920 3d20 302e 300a 2020 2020 2020  ity = 0.0.      
+00009970: 2020 2020 2020 6966 2072 6563 6f72 645f        if record_
+00009980: 625b 2263 6f6e 7461 696e 6572 5f74 6974  b["container_tit
+00009990: 6c65 225d 2061 6e64 2072 6563 6f72 645f  le"] and record_
+000099a0: 615b 2263 6f6e 7461 696e 6572 5f74 6974  a["container_tit
+000099b0: 6c65 225d 3a0a 2020 2020 2020 2020 2020  le"]:.          
+000099c0: 2020 2020 2020 6f75 746c 6574 5f73 696d        outlet_sim
+000099d0: 696c 6172 6974 7920 3d20 280a 2020 2020  ilarity = (.    
+000099e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000099f0: 6675 7a7a 2e72 6174 696f 2872 6563 6f72  fuzz.ratio(recor
+00009a00: 645f 615b 2263 6f6e 7461 696e 6572 5f74  d_a["container_t
+00009a10: 6974 6c65 225d 2c20 7265 636f 7264 5f62  itle"], record_b
+00009a20: 5b22 636f 6e74 6169 6e65 725f 7469 746c  ["container_titl
+00009a30: 6522 5d29 0a20 2020 2020 2020 2020 2020  e"]).           
+00009a40: 2020 2020 2020 2020 202f 2031 3030 0a20           / 100. 
+00009a50: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00009a60: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00009a70: 2073 7472 2872 6563 6f72 645f 615b 226a   str(record_a["j
+00009a80: 6f75 726e 616c 225d 2920 213d 2022 6e61  ournal"]) != "na
+00009a90: 6e22 3a0a 2020 2020 2020 2020 2020 2020  n":.            
+00009aa0: 2020 2020 2320 4e6f 7465 3a20 666f 7220      # Note: for 
+00009ab0: 6a6f 7572 6e61 6c73 2070 6170 6572 732c  journals papers,
+00009ac0: 2077 6520 6578 7065 6374 206d 6f72 6520   we expect more 
+00009ad0: 6465 7461 696c 730a 2020 2020 2020 2020  details.        
+00009ae0: 2020 2020 2020 2020 766f 6c75 6d65 5f73          volume_s
+00009af0: 696d 696c 6172 6974 7920 3d20 280a 2020  imilarity = (.  
+00009b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009b10: 2020 3120 6966 2028 7265 636f 7264 5f61    1 if (record_a
+00009b20: 5b22 766f 6c75 6d65 225d 203d 3d20 7265  ["volume"] == re
+00009b30: 636f 7264 5f62 5b22 766f 6c75 6d65 225d  cord_b["volume"]
+00009b40: 2920 656c 7365 2030 0a20 2020 2020 2020  ) else 0.       
+00009b50: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+00009b60: 2020 2020 2020 2020 2020 2020 6e75 6d62              numb
+00009b70: 6572 5f73 696d 696c 6172 6974 7920 3d20  er_similarity = 
+00009b80: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00009b90: 2020 2020 2020 3120 6966 2028 7265 636f        1 if (reco
+00009ba0: 7264 5f61 5b22 6e75 6d62 6572 225d 203d  rd_a["number"] =
+00009bb0: 3d20 7265 636f 7264 5f62 5b22 6e75 6d62  = record_b["numb
+00009bc0: 6572 225d 2920 656c 7365 2030 0a20 2020  er"]) else 0.   
+00009bd0: 2020 2020 2020 2020 2020 2020 2029 0a0a               )..
+00009be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009bf0: 2320 7061 6765 2073 696d 696c 6172 6974  # page similarit
+00009c00: 7920 6973 206e 6f74 2063 6f6e 7369 6465  y is not conside
+00009c10: 7265 6420 6174 2074 6865 206d 6f6d 656e  red at the momen
+00009c20: 742e 0a20 2020 2020 2020 2020 2020 2020  t..             
+00009c30: 2020 2023 0a20 2020 2020 2020 2020 2020     #.           
+00009c40: 2020 2020 2023 2073 6f6d 6574 696d 6573       # sometimes
+00009c50: 2c20 6f6e 6c79 2074 6865 2066 6972 7374  , only the first
+00009c60: 2070 6167 6520 6973 2070 726f 7669 6465   page is provide
+00009c70: 642e 0a20 2020 2020 2020 2020 2020 2020  d..             
+00009c80: 2020 2023 2069 6620 7374 7228 7265 636f     # if str(reco
+00009c90: 7264 5f61 5b22 7061 6765 7322 5d29 203d  rd_a["pages"]) =
+00009ca0: 3d20 226e 616e 2220 6f72 2073 7472 2872  = "nan" or str(r
+00009cb0: 6563 6f72 645f 625b 2270 6167 6573 225d  ecord_b["pages"]
+00009cc0: 2920 3d3d 2022 6e61 6e22 3a0a 2020 2020  ) == "nan":.    
+00009cd0: 2020 2020 2020 2020 2020 2020 2320 2020              #   
+00009ce0: 2020 7061 6765 735f 7369 6d69 6c61 7269    pages_similari
+00009cf0: 7479 203d 2031 0a20 2020 2020 2020 2020  ty = 1.         
+00009d00: 2020 2020 2020 2023 2065 6c73 653a 0a20         # else:. 
+00009d10: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00009d20: 2020 2020 2069 6620 7265 636f 7264 5f61       if record_a
+00009d30: 5b22 7061 6765 7322 5d20 3d3d 2072 6563  ["pages"] == rec
+00009d40: 6f72 645f 625b 2270 6167 6573 225d 3a0a  ord_b["pages"]:.
+00009d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009d60: 2320 2020 2020 2020 2020 7061 6765 735f  #         pages_
+00009d70: 7369 6d69 6c61 7269 7479 203d 2031 0a20  similarity = 1. 
+00009d80: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00009d90: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00009da0: 2020 2020 2020 2020 2020 2023 2020 2020             #    
+00009db0: 2020 2020 2069 6620 7265 636f 7264 5f61       if record_a
+00009dc0: 5b22 7061 6765 7322 5d2e 7370 6c69 7428  ["pages"].split(
+00009dd0: 222d 2229 5b30 5d20 3d3d 2072 6563 6f72  "-")[0] == recor
+00009de0: 645f 625b 2270 6167 6573 225d 2e73 706c  d_b["pages"].spl
+00009df0: 6974 2822 2d22 295b 305d 3a0a 2020 2020  it("-")[0]:.    
+00009e00: 2020 2020 2020 2020 2020 2020 2320 2020              #   
+00009e10: 2020 2020 2020 2020 2020 7061 6765 735f            pages_
+00009e20: 7369 6d69 6c61 7269 7479 203d 2031 0a20  similarity = 1. 
+00009e30: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00009e40: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00009e50: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00009e60: 2020 2020 2020 2020 2020 2020 7061 6765              page
+00009e70: 735f 7369 6d69 6c61 7269 7479 203d 2030  s_similarity = 0
+00009e80: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00009e90: 2020 2320 5075 7420 6d6f 7265 2077 6569    # Put more wei
+00009ea0: 6768 7420 6f6e 206f 7468 6572 2066 6965  ght on other fie
+00009eb0: 6c64 7320 6966 2074 6865 2074 6974 6c65  lds if the title
+00009ec0: 2069 7320 7665 7279 2063 6f6d 6d6f 6e0a   is very common.
+00009ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009ee0: 2320 6965 2e2c 206e 6f6e 2d64 6973 7469  # ie., non-disti
+00009ef0: 6e63 7469 7665 0a20 2020 2020 2020 2020  nctive.         
+00009f00: 2020 2020 2020 2023 2054 6865 206c 6973         # The lis
+00009f10: 7420 6973 2062 6173 6564 206f 6e20 6120  t is based on a 
+00009f20: 6c61 7267 6520 6578 706f 7274 206f 6620  large export of 
+00009f30: 6469 7374 696e 6374 2070 6170 6572 732c  distinct papers,
+00009f40: 2074 6162 756c 6174 6564 0a20 2020 2020   tabulated.     
+00009f50: 2020 2020 2020 2020 2020 2023 2061 6363             # acc
+00009f60: 6f72 6469 6e67 2074 6f20 7469 746c 6573  ording to titles
+00009f70: 2061 6e64 2073 6f72 7465 6420 6279 2066   and sorted by f
+00009f80: 7265 7175 656e 6379 0a20 2020 2020 2020  requency.       
+00009f90: 2020 2020 2020 2020 2069 6620 5b72 6563           if [rec
+00009fa0: 6f72 645f 615b 2274 6974 6c65 225d 2c20  ord_a["title"], 
+00009fb0: 7265 636f 7264 5f62 5b22 7469 746c 6522  record_b["title"
+00009fc0: 5d5d 2069 6e20 5b0a 2020 2020 2020 2020  ]] in [.        
+00009fd0: 2020 2020 2020 2020 2020 2020 5b22 6564              ["ed
+00009fe0: 6974 6f72 6961 6c22 2c20 2265 6469 746f  itorial", "edito
+00009ff0: 7269 616c 225d 2c0a 2020 2020 2020 2020  rial"],.        
+0000a000: 2020 2020 2020 2020 2020 2020 5b22 6564              ["ed
+0000a010: 6974 6f72 6961 6c20 696e 7472 6f64 7563  itorial introduc
+0000a020: 7469 6f6e 222c 2022 6564 6974 6f72 6961  tion", "editoria
+0000a030: 6c20 696e 7472 6f64 7563 7469 6f6e 225d  l introduction"]
+0000a040: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000a050: 2020 2020 2020 5b22 6564 6974 6f72 6961        ["editoria
+0000a060: 6c20 6e6f 7465 7322 2c20 2265 6469 746f  l notes", "edito
+0000a070: 7269 616c 206e 6f74 6573 225d 2c0a 2020  rial notes"],.  
+0000a080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a090: 2020 5b22 6564 6974 6f72 2773 2063 6f6d    ["editor's com
+0000a0a0: 6d65 6e74 7322 2c20 2265 6469 746f 7227  ments", "editor'
+0000a0b0: 7320 636f 6d6d 656e 7473 225d 2c0a 2020  s comments"],.  
 0000a0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a0d0: 2022 766f 6c75 6d65 222c 0a20 2020 2020   "volume",.     
-0000a0e0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0000a0f0: 6e75 6d62 6572 222c 0a20 2020 2020 2020  number",.       
-0000a100: 2020 2020 2020 2020 205d 0a20 2020 2020           ].     
-0000a110: 2020 2020 2020 2020 2020 2073 696d 696c             simil
-0000a120: 6172 6974 6965 7320 3d20 5b0a 2020 2020  arities = [.    
+0000a0d0: 2020 5b22 626f 6f6b 2072 6576 6965 7773    ["book reviews
+0000a0e0: 222c 2022 626f 6f6b 2072 6576 6965 7773  ", "book reviews
+0000a0f0: 225d 2c0a 2020 2020 2020 2020 2020 2020  "],.            
+0000a100: 2020 2020 2020 2020 5b22 6564 6974 6f72          ["editor
+0000a110: 6961 6c20 6e6f 7465 222c 2022 6564 6974  ial note", "edit
+0000a120: 6f72 6961 6c20 6e6f 7465 225d 2c0a 2020  orial note"],.  
 0000a130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a140: 6175 7468 6f72 5f73 696d 696c 6172 6974  author_similarit
-0000a150: 792c 0a20 2020 2020 2020 2020 2020 2020  y,.             
-0000a160: 2020 2020 2020 2074 6974 6c65 5f73 696d         title_sim
-0000a170: 696c 6172 6974 792c 0a20 2020 2020 2020  ilarity,.       
-0000a180: 2020 2020 2020 2020 2020 2020 2079 6561               yea
-0000a190: 725f 7369 6d69 6c61 7269 7479 2c0a 2020  r_similarity,.  
-0000a1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a1b0: 2020 6f75 746c 6574 5f73 696d 696c 6172    outlet_similar
-0000a1c0: 6974 792c 0a20 2020 2020 2020 2020 2020  ity,.           
-0000a1d0: 2020 2020 2020 2020 2076 6f6c 756d 655f           volume_
-0000a1e0: 7369 6d69 6c61 7269 7479 2c0a 2020 2020  similarity,.    
-0000a1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a200: 6e75 6d62 6572 5f73 696d 696c 6172 6974  number_similarit
-0000a210: 792c 0a20 2020 2020 2020 2020 2020 2020  y,.             
-0000a220: 2020 205d 0a0a 2020 2020 2020 2020 2020     ]..          
-0000a230: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000a240: 2020 2020 2020 2020 7765 6967 6874 7320          weights 
-0000a250: 3d20 5b30 2e31 352c 2030 2e37 352c 2030  = [0.15, 0.75, 0
-0000a260: 2e30 352c 2030 2e30 355d 0a20 2020 2020  .05, 0.05].     
-0000a270: 2020 2020 2020 2020 2020 2073 696d 5f6e             sim_n
-0000a280: 616d 6573 203d 205b 0a20 2020 2020 2020  ames = [.       
-0000a290: 2020 2020 2020 2020 2020 2020 2022 6175               "au
-0000a2a0: 7468 6f72 222c 0a20 2020 2020 2020 2020  thor",.         
-0000a2b0: 2020 2020 2020 2020 2020 2022 7469 746c             "titl
-0000a2c0: 6522 2c0a 2020 2020 2020 2020 2020 2020  e",.            
-0000a2d0: 2020 2020 2020 2020 2279 6561 7222 2c0a          "year",.
-0000a2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a2f0: 2020 2020 226f 7574 6c65 7422 2c0a 2020      "outlet",.  
-0000a300: 2020 2020 2020 2020 2020 2020 2020 5d0a                ].
-0000a310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a320: 7369 6d69 6c61 7269 7469 6573 203d 205b  similarities = [
-0000a330: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a340: 2020 2020 2061 7574 686f 725f 7369 6d69       author_simi
-0000a350: 6c61 7269 7479 2c0a 2020 2020 2020 2020  larity,.        
-0000a360: 2020 2020 2020 2020 2020 2020 7469 746c              titl
-0000a370: 655f 7369 6d69 6c61 7269 7479 2c0a 2020  e_similarity,.  
-0000a380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a390: 2020 7965 6172 5f73 696d 696c 6172 6974    year_similarit
-0000a3a0: 792c 0a20 2020 2020 2020 2020 2020 2020  y,.             
-0000a3b0: 2020 2020 2020 206f 7574 6c65 745f 7369         outlet_si
-0000a3c0: 6d69 6c61 7269 7479 2c0a 2020 2020 2020  milarity,.      
-0000a3d0: 2020 2020 2020 2020 2020 5d0a 0a20 2020            ]..   
-0000a3e0: 2020 2020 2020 2020 2077 6569 6768 7465           weighte
-0000a3f0: 645f 6176 6572 6167 6520 3d20 7375 6d28  d_average = sum(
-0000a400: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a410: 2073 696d 696c 6172 6974 6965 735b 675d   similarities[g]
-0000a420: 202a 2077 6569 6768 7473 5b67 5d20 666f   * weights[g] fo
-0000a430: 7220 6720 696e 2072 616e 6765 286c 656e  r g in range(len
-0000a440: 2873 696d 696c 6172 6974 6965 7329 290a  (similarities)).
-0000a450: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
-0000a460: 2020 2020 2020 2020 2020 2064 6574 6169             detai
-0000a470: 6c73 203d 2028 0a20 2020 2020 2020 2020  ls = (.         
-0000a480: 2020 2020 2020 2022 5b22 0a20 2020 2020         "[".     
-0000a490: 2020 2020 2020 2020 2020 202b 2022 2c22             + ","
-0000a4a0: 2e6a 6f69 6e28 5b73 696d 5f6e 616d 6573  .join([sim_names
-0000a4b0: 5b67 5d20 666f 7220 6720 696e 2072 616e  [g] for g in ran
-0000a4c0: 6765 286c 656e 2873 696d 696c 6172 6974  ge(len(similarit
-0000a4d0: 6965 7329 295d 290a 2020 2020 2020 2020  ies))]).        
-0000a4e0: 2020 2020 2020 2020 2b20 225d 220a 2020          + "]".  
-0000a4f0: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
-0000a500: 222a 7765 6967 6874 735f 7665 636f 725e  "*weights_vecor^
-0000a510: 5420 3d20 220a 2020 2020 2020 2020 2020  T = ".          
-0000a520: 2020 2020 2020 2b20 225b 220a 2020 2020        + "[".    
-0000a530: 2020 2020 2020 2020 2020 2020 2b20 222c              + ",
-0000a540: 222e 6a6f 696e 285b 7374 7228 7369 6d69  ".join([str(simi
-0000a550: 6c61 7269 7469 6573 5b67 5d29 2066 6f72  larities[g]) for
-0000a560: 2067 2069 6e20 7261 6e67 6528 6c65 6e28   g in range(len(
-0000a570: 7369 6d69 6c61 7269 7469 6573 2929 5d29  similarities))])
-0000a580: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a590: 202b 2022 5d2a 220a 2020 2020 2020 2020   + "]*".        
-0000a5a0: 2020 2020 2020 2020 2b20 225b 220a 2020          + "[".  
-0000a5b0: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
-0000a5c0: 222c 222e 6a6f 696e 285b 7374 7228 7765  ",".join([str(we
-0000a5d0: 6967 6874 735b 675d 2920 666f 7220 6720  ights[g]) for g 
-0000a5e0: 696e 2072 616e 6765 286c 656e 2873 696d  in range(len(sim
-0000a5f0: 696c 6172 6974 6965 7329 295d 290a 2020  ilarities))]).  
-0000a600: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
-0000a610: 225d 5e54 220a 2020 2020 2020 2020 2020  "]^T".          
-0000a620: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-0000a630: 7369 6d69 6c61 7269 7479 5f73 636f 7265  similarity_score
-0000a640: 203d 2072 6f75 6e64 2877 6569 6768 7465   = round(weighte
-0000a650: 645f 6176 6572 6167 652c 2034 290a 2020  d_average, 4).  
-0000a660: 2020 2020 2020 6578 6365 7074 2041 7474        except Att
-0000a670: 7269 6275 7465 4572 726f 723a 0a20 2020  ributeError:.   
-0000a680: 2020 2020 2020 2020 2073 696d 696c 6172           similar
-0000a690: 6974 795f 7363 6f72 6520 3d20 300a 2020  ity_score = 0.  
-0000a6a0: 2020 2020 2020 2020 2020 6465 7461 696c            detail
-0000a6b0: 7320 3d20 2222 0a20 2020 2020 2020 2072  s = "".        r
-0000a6c0: 6574 7572 6e20 7b22 7363 6f72 6522 3a20  eturn {"score": 
-0000a6d0: 7369 6d69 6c61 7269 7479 5f73 636f 7265  similarity_score
-0000a6e0: 2c20 2264 6574 6169 6c73 223a 2064 6574  , "details": det
-0000a6f0: 6169 6c73 7d0a 0a20 2020 2064 6566 2067  ails}..    def g
-0000a700: 6574 5f66 6965 6c64 5f70 726f 7665 6e61  et_field_provena
-0000a710: 6e63 6528 0a20 2020 2020 2020 2073 656c  nce(.        sel
-0000a720: 662c 202a 2c20 6b65 793a 2073 7472 2c20  f, *, key: str, 
-0000a730: 6465 6661 756c 745f 736f 7572 6365 3a20  default_source: 
-0000a740: 7374 7220 3d20 224f 5249 4749 4e41 4c22  str = "ORIGINAL"
-0000a750: 0a20 2020 2029 202d 3e20 6469 6374 3a0a  .    ) -> dict:.
-0000a760: 2020 2020 2020 2020 2222 2247 6574 2074          """Get t
-0000a770: 6865 2070 726f 7665 6e61 6e63 6520 666f  he provenance fo
-0000a780: 7220 6120 7365 6c65 6374 6564 2066 6965  r a selected fie
-0000a790: 6c64 2028 6b65 7929 2222 220a 2020 2020  ld (key)""".    
-0000a7a0: 2020 2020 6465 6661 756c 745f 6e6f 7465      default_note
-0000a7b0: 203d 2022 220a 2020 2020 2020 2020 6e6f   = "".        no
-0000a7c0: 7465 203d 2064 6566 6175 6c74 5f6e 6f74  te = default_not
-0000a7d0: 650a 2020 2020 2020 2020 736f 7572 6365  e.        source
-0000a7e0: 203d 2064 6566 6175 6c74 5f73 6f75 7263   = default_sourc
-0000a7f0: 650a 2020 2020 2020 2020 6966 206b 6579  e.        if key
-0000a800: 2069 6e20 7365 6c66 2e69 6465 6e74 6966   in self.identif
-0000a810: 7969 6e67 5f66 6965 6c64 5f6b 6579 733a  ying_field_keys:
-0000a820: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000a830: 2263 6f6c 7265 765f 6d61 7374 6572 6461  "colrev_masterda
-0000a840: 7461 5f70 726f 7665 6e61 6e63 6522 2069  ta_provenance" i
-0000a850: 6e20 7365 6c66 2e64 6174 613a 0a20 2020  n self.data:.   
-0000a860: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0000a870: 6b65 7920 696e 2073 656c 662e 6461 7461  key in self.data
-0000a880: 2e67 6574 2822 636f 6c72 6576 5f6d 6173  .get("colrev_mas
-0000a890: 7465 7264 6174 615f 7072 6f76 656e 616e  terdata_provenan
-0000a8a0: 6365 222c 207b 7d29 3a0a 2020 2020 2020  ce", {}):.      
-0000a8b0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0000a8c0: 2022 736f 7572 6365 2220 696e 2073 656c   "source" in sel
-0000a8d0: 662e 6461 7461 5b22 636f 6c72 6576 5f6d  f.data["colrev_m
-0000a8e0: 6173 7465 7264 6174 615f 7072 6f76 656e  asterdata_proven
-0000a8f0: 616e 6365 225d 5b6b 6579 5d3a 0a20 2020  ance"][key]:.   
-0000a900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a910: 2020 2020 2073 6f75 7263 6520 3d20 7365       source = se
-0000a920: 6c66 2e64 6174 615b 2263 6f6c 7265 765f  lf.data["colrev_
-0000a930: 6d61 7374 6572 6461 7461 5f70 726f 7665  masterdata_prove
-0000a940: 6e61 6e63 6522 5d5b 6b65 795d 5b0a 2020  nance"][key][.  
-0000a950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a960: 2020 2020 2020 2020 2020 2273 6f75 7263            "sourc
-0000a970: 6522 0a20 2020 2020 2020 2020 2020 2020  e".             
-0000a980: 2020 2020 2020 2020 2020 205d 0a20 2020             ].   
-0000a990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a9a0: 2069 6620 226e 6f74 6522 2069 6e20 7365   if "note" in se
-0000a9b0: 6c66 2e64 6174 615b 2263 6f6c 7265 765f  lf.data["colrev_
-0000a9c0: 6d61 7374 6572 6461 7461 5f70 726f 7665  masterdata_prove
-0000a9d0: 6e61 6e63 6522 5d5b 6b65 795d 3a0a 2020  nance"][key]:.  
-0000a9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a9f0: 2020 2020 2020 6e6f 7465 203d 2073 656c        note = sel
-0000aa00: 662e 6461 7461 5b22 636f 6c72 6576 5f6d  f.data["colrev_m
-0000aa10: 6173 7465 7264 6174 615f 7072 6f76 656e  asterdata_proven
-0000aa20: 616e 6365 225d 5b6b 6579 5d5b 226e 6f74  ance"][key]["not
-0000aa30: 6522 5d0a 2020 2020 2020 2020 656c 7365  e"].        else
-0000aa40: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-0000aa50: 2022 636f 6c72 6576 5f64 6174 615f 7072   "colrev_data_pr
-0000aa60: 6f76 656e 616e 6365 2220 696e 2073 656c  ovenance" in sel
-0000aa70: 662e 6461 7461 3a0a 2020 2020 2020 2020  f.data:.        
-0000aa80: 2020 2020 2020 2020 6966 206b 6579 2069          if key i
-0000aa90: 6e20 7365 6c66 2e64 6174 615b 2263 6f6c  n self.data["col
-0000aaa0: 7265 765f 6461 7461 5f70 726f 7665 6e61  rev_data_provena
-0000aab0: 6e63 6522 5d3a 0a20 2020 2020 2020 2020  nce"]:.         
-0000aac0: 2020 2020 2020 2020 2020 2069 6620 2273             if "s
-0000aad0: 6f75 7263 6522 2069 6e20 7365 6c66 2e64  ource" in self.d
-0000aae0: 6174 615b 2263 6f6c 7265 765f 6461 7461  ata["colrev_data
-0000aaf0: 5f70 726f 7665 6e61 6e63 6522 5d5b 6b65  _provenance"][ke
-0000ab00: 795d 3a0a 2020 2020 2020 2020 2020 2020  y]:.            
-0000ab10: 2020 2020 2020 2020 2020 2020 736f 7572              sour
-0000ab20: 6365 203d 2073 656c 662e 6461 7461 5b22  ce = self.data["
-0000ab30: 636f 6c72 6576 5f64 6174 615f 7072 6f76  colrev_data_prov
-0000ab40: 656e 616e 6365 225d 5b6b 6579 5d5b 2273  enance"][key]["s
-0000ab50: 6f75 7263 6522 5d0a 2020 2020 2020 2020  ource"].        
-0000ab60: 2020 2020 2020 2020 2020 2020 6966 2022              if "
-0000ab70: 6e6f 7465 2220 696e 2073 656c 662e 6461  note" in self.da
-0000ab80: 7461 5b22 636f 6c72 6576 5f64 6174 615f  ta["colrev_data_
-0000ab90: 7072 6f76 656e 616e 6365 225d 5b6b 6579  provenance"][key
-0000aba0: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
-0000abb0: 2020 2020 2020 2020 2020 206e 6f74 6520             note 
-0000abc0: 3d20 7365 6c66 2e64 6174 615b 2263 6f6c  = self.data["col
-0000abd0: 7265 765f 6461 7461 5f70 726f 7665 6e61  rev_data_provena
-0000abe0: 6e63 6522 5d5b 6b65 795d 5b22 6e6f 7465  nce"][key]["note
-0000abf0: 225d 0a0a 2020 2020 2020 2020 7265 7475  "]..        retu
-0000ac00: 726e 207b 2273 6f75 7263 6522 3a20 736f  rn {"source": so
-0000ac10: 7572 6365 2c20 226e 6f74 6522 3a20 6e6f  urce, "note": no
-0000ac20: 7465 7d0a 0a20 2020 2064 6566 2072 656d  te}..    def rem
-0000ac30: 6f76 655f 6d61 7374 6572 6461 7461 5f70  ove_masterdata_p
-0000ac40: 726f 7665 6e61 6e63 655f 6e6f 7465 2873  rovenance_note(s
-0000ac50: 656c 662c 202a 2c20 6b65 793a 2073 7472  elf, *, key: str
-0000ac60: 2c20 6e6f 7465 3a20 7374 7229 202d 3e20  , note: str) -> 
-0000ac70: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
-0000ac80: 2252 656d 6f76 6520 6120 6d61 7374 6572  "Remove a master
-0000ac90: 6461 7461 2070 726f 7665 6e61 6e63 6520  data provenance 
-0000aca0: 6e6f 7465 2222 220a 2020 2020 2020 2020  note""".        
-0000acb0: 6966 2022 636f 6c72 6576 5f6d 6173 7465  if "colrev_maste
-0000acc0: 7264 6174 615f 7072 6f76 656e 616e 6365  rdata_provenance
-0000acd0: 2220 6e6f 7420 696e 2073 656c 662e 6461  " not in self.da
-0000ace0: 7461 3a0a 2020 2020 2020 2020 2020 2020  ta:.            
-0000acf0: 7265 7475 726e 0a20 2020 2020 2020 2069  return.        i
-0000ad00: 6620 6b65 7920 6e6f 7420 696e 2073 656c  f key not in sel
-0000ad10: 662e 6461 7461 5b22 636f 6c72 6576 5f6d  f.data["colrev_m
-0000ad20: 6173 7465 7264 6174 615f 7072 6f76 656e  asterdata_proven
-0000ad30: 616e 6365 225d 3a0a 2020 2020 2020 2020  ance"]:.        
-0000ad40: 2020 2020 7265 7475 726e 0a20 2020 2020      return.     
-0000ad50: 2020 206e 6f74 6573 203d 2073 656c 662e     notes = self.
-0000ad60: 6461 7461 5b22 636f 6c72 6576 5f6d 6173  data["colrev_mas
-0000ad70: 7465 7264 6174 615f 7072 6f76 656e 616e  terdata_provenan
-0000ad80: 6365 225d 5b6b 6579 5d5b 226e 6f74 6522  ce"][key]["note"
-0000ad90: 5d2e 7370 6c69 7428 222c 2229 0a20 2020  ].split(",").   
-0000ada0: 2020 2020 2069 6620 6e6f 7465 206e 6f74       if note not
-0000adb0: 2069 6e20 6e6f 7465 733a 0a20 2020 2020   in notes:.     
-0000adc0: 2020 2020 2020 2072 6574 7572 6e0a 2020         return.  
-0000add0: 2020 2020 2020 7365 6c66 2e64 6174 615b        self.data[
-0000ade0: 2263 6f6c 7265 765f 6d61 7374 6572 6461  "colrev_masterda
-0000adf0: 7461 5f70 726f 7665 6e61 6e63 6522 5d5b  ta_provenance"][
-0000ae00: 6b65 795d 5b22 6e6f 7465 225d 203d 2022  key]["note"] = "
-0000ae10: 2c22 2e6a 6f69 6e28 0a20 2020 2020 2020  ,".join(.       
-0000ae20: 2020 2020 206e 2066 6f72 206e 2069 6e20       n for n in 
-0000ae30: 6e6f 7465 7320 6966 206e 2021 3d20 6e6f  notes if n != no
-0000ae40: 7465 0a20 2020 2020 2020 2029 0a0a 2020  te.        )..  
-0000ae50: 2020 6465 6620 6164 645f 6d61 7374 6572    def add_master
-0000ae60: 6461 7461 5f70 726f 7665 6e61 6e63 655f  data_provenance_
-0000ae70: 6e6f 7465 2873 656c 662c 202a 2c20 6b65  note(self, *, ke
-0000ae80: 793a 2073 7472 2c20 6e6f 7465 3a20 7374  y: str, note: st
-0000ae90: 7229 202d 3e20 4e6f 6e65 3a0a 2020 2020  r) -> None:.    
-0000aea0: 2020 2020 2222 2241 6464 2061 206d 6173      """Add a mas
-0000aeb0: 7465 7264 6174 6120 7072 6f76 656e 616e  terdata provenan
-0000aec0: 6365 206e 6f74 6520 2862 6173 6564 206f  ce note (based o
-0000aed0: 6e20 6120 6b65 7929 2222 220a 2020 2020  n a key)""".    
-0000aee0: 2020 2020 6966 2022 636f 6c72 6576 5f6d      if "colrev_m
-0000aef0: 6173 7465 7264 6174 615f 7072 6f76 656e  asterdata_proven
-0000af00: 616e 6365 2220 6e6f 7420 696e 2073 656c  ance" not in sel
-0000af10: 662e 6461 7461 3a0a 2020 2020 2020 2020  f.data:.        
-0000af20: 2020 2020 7365 6c66 2e64 6174 615b 2263      self.data["c
-0000af30: 6f6c 7265 765f 6d61 7374 6572 6461 7461  olrev_masterdata
-0000af40: 5f70 726f 7665 6e61 6e63 6522 5d20 3d20  _provenance"] = 
-0000af50: 7b7d 0a20 2020 2020 2020 2069 6620 6b65  {}.        if ke
-0000af60: 7920 696e 2073 656c 662e 6461 7461 2e67  y in self.data.g
-0000af70: 6574 2822 636f 6c72 6576 5f6d 6173 7465  et("colrev_maste
-0000af80: 7264 6174 615f 7072 6f76 656e 616e 6365  rdata_provenance
-0000af90: 222c 207b 7d29 3a0a 2020 2020 2020 2020  ", {}):.        
-0000afa0: 2020 2020 6966 2028 0a20 2020 2020 2020      if (.       
-0000afb0: 2020 2020 2020 2020 2022 2220 3d3d 2073           "" == s
-0000afc0: 656c 662e 6461 7461 5b22 636f 6c72 6576  elf.data["colrev
-0000afd0: 5f6d 6173 7465 7264 6174 615f 7072 6f76  _masterdata_prov
-0000afe0: 656e 616e 6365 225d 5b6b 6579 5d5b 226e  enance"][key]["n
-0000aff0: 6f74 6522 5d0a 2020 2020 2020 2020 2020  ote"].          
-0000b000: 2020 2020 2020 6f72 2022 2220 3d3d 206e        or "" == n
-0000b010: 6f74 650a 2020 2020 2020 2020 2020 2020  ote.            
-0000b020: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0000b030: 2020 2073 656c 662e 6461 7461 5b22 636f     self.data["co
-0000b040: 6c72 6576 5f6d 6173 7465 7264 6174 615f  lrev_masterdata_
-0000b050: 7072 6f76 656e 616e 6365 225d 5b6b 6579  provenance"][key
-0000b060: 5d5b 226e 6f74 6522 5d20 3d20 6e6f 7465  ]["note"] = note
-0000b070: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
-0000b080: 6620 6e6f 7465 206e 6f74 2069 6e20 7365  f note not in se
-0000b090: 6c66 2e64 6174 615b 2263 6f6c 7265 765f  lf.data["colrev_
-0000b0a0: 6d61 7374 6572 6461 7461 5f70 726f 7665  masterdata_prove
-0000b0b0: 6e61 6e63 6522 5d5b 6b65 795d 5b0a 2020  nance"][key][.  
-0000b0c0: 2020 2020 2020 2020 2020 2020 2020 226e                "n
-0000b0d0: 6f74 6522 0a20 2020 2020 2020 2020 2020  ote".           
-0000b0e0: 205d 2e73 706c 6974 2822 2c22 293a 0a20   ].split(","):. 
-0000b0f0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000b100: 656c 662e 6461 7461 5b22 636f 6c72 6576  elf.data["colrev
-0000b110: 5f6d 6173 7465 7264 6174 615f 7072 6f76  _masterdata_prov
-0000b120: 656e 616e 6365 225d 5b6b 6579 5d5b 226e  enance"][key]["n
-0000b130: 6f74 6522 5d20 2b3d 2066 222c 7b6e 6f74  ote"] += f",{not
-0000b140: 657d 220a 2020 2020 2020 2020 656c 7365  e}".        else
-0000b150: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-0000b160: 6c66 2e64 6174 615b 2263 6f6c 7265 765f  lf.data["colrev_
-0000b170: 6d61 7374 6572 6461 7461 5f70 726f 7665  masterdata_prove
-0000b180: 6e61 6e63 6522 5d5b 6b65 795d 203d 207b  nance"][key] = {
-0000b190: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b1a0: 2022 736f 7572 6365 223a 2022 4f52 4947   "source": "ORIG
-0000b1b0: 494e 414c 222c 0a20 2020 2020 2020 2020  INAL",.         
-0000b1c0: 2020 2020 2020 2022 6e6f 7465 223a 206e         "note": n
-0000b1d0: 6f74 652c 0a20 2020 2020 2020 2020 2020  ote,.           
-0000b1e0: 207d 0a0a 2020 2020 2020 2020 6578 6973   }..        exis
-0000b1f0: 7469 6e67 5f6e 6f74 6520 3d20 7365 6c66  ting_note = self
-0000b200: 2e64 6174 615b 2263 6f6c 7265 765f 6d61  .data["colrev_ma
-0000b210: 7374 6572 6461 7461 5f70 726f 7665 6e61  sterdata_provena
-0000b220: 6e63 6522 5d5b 6b65 795d 5b22 6e6f 7465  nce"][key]["note
-0000b230: 225d 0a20 2020 2020 2020 2069 6620 2271  "].        if "q
-0000b240: 7561 6c69 7479 5f64 6566 6563 7422 2069  uality_defect" i
-0000b250: 6e20 6578 6973 7469 6e67 5f6e 6f74 6520  n existing_note 
-0000b260: 616e 6420 616e 7928 0a20 2020 2020 2020  and any(.       
-0000b270: 2020 2020 2078 2069 6e20 6578 6973 7469       x in existi
-0000b280: 6e67 5f6e 6f74 6520 666f 7220 7820 696e  ng_note for x in
-0000b290: 205b 226d 6973 7369 6e67 222c 2022 6469   ["missing", "di
-0000b2a0: 7361 6772 6565 6d65 6e74 225d 0a20 2020  sagreement"].   
-0000b2b0: 2020 2020 2029 3a0a 2020 2020 2020 2020       ):.        
-0000b2c0: 2020 2020 7365 6c66 2e64 6174 615b 2263      self.data["c
-0000b2d0: 6f6c 7265 765f 6d61 7374 6572 6461 7461  olrev_masterdata
-0000b2e0: 5f70 726f 7665 6e61 6e63 6522 5d5b 6b65  _provenance"][ke
-0000b2f0: 795d 5b22 6e6f 7465 225d 203d 2028 0a20  y]["note"] = (. 
-0000b300: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0000b310: 7869 7374 696e 675f 6e6f 7465 2e72 6570  xisting_note.rep
-0000b320: 6c61 6365 2822 7175 616c 6974 795f 6465  lace("quality_de
-0000b330: 6665 6374 222c 2022 2229 2e72 7374 7269  fect", "").rstri
-0000b340: 7028 222c 2229 2e6c 7374 7269 7028 222c  p(",").lstrip(",
-0000b350: 2229 0a20 2020 2020 2020 2020 2020 2029  ").            )
-0000b360: 0a0a 2020 2020 6465 6620 6164 645f 6461  ..    def add_da
-0000b370: 7461 5f70 726f 7665 6e61 6e63 655f 6e6f  ta_provenance_no
-0000b380: 7465 2873 656c 662c 202a 2c20 6b65 793a  te(self, *, key:
-0000b390: 2073 7472 2c20 6e6f 7465 3a20 7374 7229   str, note: str)
-0000b3a0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-0000b3b0: 2020 2222 2241 6464 2061 2064 6174 6120    """Add a data 
-0000b3c0: 7072 6f76 656e 616e 6365 206e 6f74 6520  provenance note 
-0000b3d0: 2862 6173 6564 206f 6e20 6120 6b65 7929  (based on a key)
-0000b3e0: 2222 220a 2020 2020 2020 2020 6966 2022  """.        if "
-0000b3f0: 636f 6c72 6576 5f64 6174 615f 7072 6f76  colrev_data_prov
-0000b400: 656e 616e 6365 2220 6e6f 7420 696e 2073  enance" not in s
-0000b410: 656c 662e 6461 7461 3a0a 2020 2020 2020  elf.data:.      
-0000b420: 2020 2020 2020 7365 6c66 2e64 6174 615b        self.data[
-0000b430: 2263 6f6c 7265 765f 6461 7461 5f70 726f  "colrev_data_pro
-0000b440: 7665 6e61 6e63 6522 5d20 3d20 7b7d 0a20  venance"] = {}. 
-0000b450: 2020 2020 2020 2069 6620 6b65 7920 696e         if key in
-0000b460: 2073 656c 662e 6461 7461 5b22 636f 6c72   self.data["colr
-0000b470: 6576 5f64 6174 615f 7072 6f76 656e 616e  ev_data_provenan
-0000b480: 6365 225d 3a0a 2020 2020 2020 2020 2020  ce"]:.          
-0000b490: 2020 6966 2073 656c 662e 6461 7461 5b22    if self.data["
-0000b4a0: 636f 6c72 6576 5f64 6174 615f 7072 6f76  colrev_data_prov
-0000b4b0: 656e 616e 6365 225d 5b6b 6579 5d5b 226e  enance"][key]["n
-0000b4c0: 6f74 6522 5d20 3d3d 2022 223a 0a20 2020  ote"] == "":.   
-0000b4d0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0000b4e0: 662e 6461 7461 5b22 636f 6c72 6576 5f64  f.data["colrev_d
-0000b4f0: 6174 615f 7072 6f76 656e 616e 6365 225d  ata_provenance"]
-0000b500: 5b6b 6579 5d5b 226e 6f74 6522 5d20 3d20  [key]["note"] = 
-0000b510: 6e6f 7465 0a20 2020 2020 2020 2020 2020  note.           
-0000b520: 2065 6c69 6620 6e6f 7465 206e 6f74 2069   elif note not i
-0000b530: 6e20 7365 6c66 2e64 6174 615b 2263 6f6c  n self.data["col
-0000b540: 7265 765f 6461 7461 5f70 726f 7665 6e61  rev_data_provena
-0000b550: 6e63 6522 5d5b 6b65 795d 5b22 6e6f 7465  nce"][key]["note
-0000b560: 225d 2e73 706c 6974 280a 2020 2020 2020  "].split(.      
-0000b570: 2020 2020 2020 2020 2020 222c 220a 2020            ",".  
-0000b580: 2020 2020 2020 2020 2020 293a 0a20 2020            ):.   
-0000b590: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0000b5a0: 662e 6461 7461 5b22 636f 6c72 6576 5f64  f.data["colrev_d
-0000b5b0: 6174 615f 7072 6f76 656e 616e 6365 225d  ata_provenance"]
-0000b5c0: 5b6b 6579 5d5b 226e 6f74 6522 5d20 2b3d  [key]["note"] +=
-0000b5d0: 2066 222c 7b6e 6f74 657d 220a 2020 2020   f",{note}".    
-0000b5e0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0000b5f0: 2020 2020 2020 7365 6c66 2e64 6174 615b        self.data[
-0000b600: 2263 6f6c 7265 765f 6461 7461 5f70 726f  "colrev_data_pro
-0000b610: 7665 6e61 6e63 6522 5d5b 6b65 795d 203d  venance"][key] =
-0000b620: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
-0000b630: 2020 2022 736f 7572 6365 223a 2022 4f52     "source": "OR
-0000b640: 4947 494e 414c 222c 0a20 2020 2020 2020  IGINAL",.       
-0000b650: 2020 2020 2020 2020 2022 6e6f 7465 223a           "note":
-0000b660: 206e 6f74 652c 0a20 2020 2020 2020 2020   note,.         
-0000b670: 2020 207d 0a0a 2020 2020 6465 6620 6164     }..    def ad
-0000b680: 645f 6d61 7374 6572 6461 7461 5f70 726f  d_masterdata_pro
-0000b690: 7665 6e61 6e63 6528 0a20 2020 2020 2020  venance(.       
-0000b6a0: 2073 656c 662c 202a 2c20 6b65 793a 2073   self, *, key: s
-0000b6b0: 7472 2c20 736f 7572 6365 3a20 7374 722c  tr, source: str,
-0000b6c0: 206e 6f74 653a 2073 7472 203d 2022 220a   note: str = "".
-0000b6d0: 2020 2020 2920 2d3e 204e 6f6e 653a 0a20      ) -> None:. 
-0000b6e0: 2020 2020 2020 2022 2222 4164 6420 6120         """Add a 
-0000b6f0: 6d61 7374 6572 6461 7461 2070 726f 7665  masterdata prove
-0000b700: 6e61 6e63 652c 2069 6e63 6c75 6469 6e67  nance, including
-0000b710: 2073 6f75 7263 6520 616e 6420 6e6f 7465   source and note
-0000b720: 2028 6261 7365 6420 6f6e 2061 206b 6579   (based on a key
-0000b730: 2922 2222 0a20 2020 2020 2020 2069 6620  )""".        if 
-0000b740: 2263 6f6c 7265 765f 6d61 7374 6572 6461  "colrev_masterda
-0000b750: 7461 5f70 726f 7665 6e61 6e63 6522 206e  ta_provenance" n
-0000b760: 6f74 2069 6e20 7365 6c66 2e64 6174 613a  ot in self.data:
-0000b770: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0000b780: 662e 6461 7461 5b22 636f 6c72 6576 5f6d  f.data["colrev_m
-0000b790: 6173 7465 7264 6174 615f 7072 6f76 656e  asterdata_proven
-0000b7a0: 616e 6365 225d 203d 207b 7d0a 2020 2020  ance"] = {}.    
-0000b7b0: 2020 2020 6d64 5f70 5f64 6963 7420 3d20      md_p_dict = 
-0000b7c0: 7365 6c66 2e64 6174 615b 2263 6f6c 7265  self.data["colre
-0000b7d0: 765f 6d61 7374 6572 6461 7461 5f70 726f  v_masterdata_pro
-0000b7e0: 7665 6e61 6e63 6522 5d0a 0a20 2020 2020  venance"]..     
-0000b7f0: 2020 2069 6620 6b65 7920 696e 206d 645f     if key in md_
-0000b800: 705f 6469 6374 3a0a 2020 2020 2020 2020  p_dict:.        
-0000b810: 2020 2020 6966 206d 645f 705f 6469 6374      if md_p_dict
-0000b820: 5b6b 6579 5d5b 226e 6f74 6522 5d20 3d3d  [key]["note"] ==
-0000b830: 2022 2220 6f72 2022 2220 3d3d 206e 6f74   "" or "" == not
-0000b840: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0000b850: 2020 206d 645f 705f 6469 6374 5b6b 6579     md_p_dict[key
-0000b860: 5d5b 226e 6f74 6522 5d20 3d20 6e6f 7465  ]["note"] = note
-0000b870: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
-0000b880: 6620 226d 6973 7369 6e67 2220 3d3d 206e  f "missing" == n
-0000b890: 6f74 6520 616e 6420 226e 6f74 2d6d 6973  ote and "not-mis
-0000b8a0: 7369 6e67 2220 696e 206d 645f 705f 6469  sing" in md_p_di
-0000b8b0: 6374 5b6b 6579 5d5b 226e 6f74 6522 5d2e  ct[key]["note"].
-0000b8c0: 7370 6c69 7428 0a20 2020 2020 2020 2020  split(.         
-0000b8d0: 2020 2020 2020 2022 2c22 0a20 2020 2020         ",".     
-0000b8e0: 2020 2020 2020 2029 3a0a 2020 2020 2020         ):.      
-0000b8f0: 2020 2020 2020 2020 2020 6d64 5f70 5f64            md_p_d
-0000b900: 6963 745b 6b65 795d 5b22 6e6f 7465 225d  ict[key]["note"]
-0000b910: 203d 2022 6d69 7373 696e 6722 0a20 2020   = "missing".   
-0000b920: 2020 2020 2020 2020 2065 6c69 6620 6e6f           elif no
-0000b930: 7465 206e 6f74 2069 6e20 6d64 5f70 5f64  te not in md_p_d
-0000b940: 6963 745b 6b65 795d 5b22 6e6f 7465 225d  ict[key]["note"]
-0000b950: 2e73 706c 6974 2822 2c22 293a 0a20 2020  .split(","):.   
-0000b960: 2020 2020 2020 2020 2020 2020 206d 645f               md_
-0000b970: 705f 6469 6374 5b6b 6579 5d5b 226e 6f74  p_dict[key]["not
-0000b980: 6522 5d20 2b3d 2066 222c 7b6e 6f74 657d  e"] += f",{note}
-0000b990: 220a 2020 2020 2020 2020 2020 2020 6d64  ".            md
-0000b9a0: 5f70 5f64 6963 745b 6b65 795d 5b22 736f  _p_dict[key]["so
-0000b9b0: 7572 6365 225d 203d 2073 6f75 7263 650a  urce"] = source.
-0000b9c0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0000b9d0: 2020 2020 2020 2020 2020 6d64 5f70 5f64            md_p_d
-0000b9e0: 6963 745b 6b65 795d 203d 207b 2273 6f75  ict[key] = {"sou
-0000b9f0: 7263 6522 3a20 736f 7572 6365 2c20 226e  rce": source, "n
-0000ba00: 6f74 6522 3a20 6622 7b6e 6f74 657d 227d  ote": f"{note}"}
-0000ba10: 0a0a 2020 2020 6465 6620 6164 645f 7072  ..    def add_pr
-0000ba20: 6f76 656e 616e 6365 5f61 6c6c 2873 656c  ovenance_all(sel
-0000ba30: 662c 202a 2c20 736f 7572 6365 3a20 7374  f, *, source: st
-0000ba40: 7229 202d 3e20 4e6f 6e65 3a0a 2020 2020  r) -> None:.    
-0000ba50: 2020 2020 2222 2241 6464 2061 2064 6174      """Add a dat
-0000ba60: 6120 7072 6f76 656e 616e 6365 2028 736f  a provenance (so
-0000ba70: 7572 6365 2920 746f 2061 6c6c 2066 6965  urce) to all fie
-0000ba80: 6c64 7322 2222 0a20 2020 2020 2020 2069  lds""".        i
-0000ba90: 6620 2263 6f6c 7265 765f 6d61 7374 6572  f "colrev_master
-0000baa0: 6461 7461 5f70 726f 7665 6e61 6e63 6522  data_provenance"
-0000bab0: 206e 6f74 2069 6e20 7365 6c66 2e64 6174   not in self.dat
-0000bac0: 613a 0a20 2020 2020 2020 2020 2020 2073  a:.            s
-0000bad0: 656c 662e 6461 7461 5b22 636f 6c72 6576  elf.data["colrev
-0000bae0: 5f6d 6173 7465 7264 6174 615f 7072 6f76  _masterdata_prov
-0000baf0: 656e 616e 6365 225d 203d 207b 7d0a 2020  enance"] = {}.  
-0000bb00: 2020 2020 2020 6966 2022 636f 6c72 6576        if "colrev
-0000bb10: 5f64 6174 615f 7072 6f76 656e 616e 6365  _data_provenance
-0000bb20: 2220 6e6f 7420 696e 2073 656c 662e 6461  " not in self.da
-0000bb30: 7461 3a0a 2020 2020 2020 2020 2020 2020  ta:.            
-0000bb40: 7365 6c66 2e64 6174 615b 2263 6f6c 7265  self.data["colre
-0000bb50: 765f 6461 7461 5f70 726f 7665 6e61 6e63  v_data_provenanc
-0000bb60: 6522 5d20 3d20 7b7d 0a0a 2020 2020 2020  e"] = {}..      
-0000bb70: 2020 6d64 5f70 5f64 6963 7420 3d20 7365    md_p_dict = se
-0000bb80: 6c66 2e64 6174 615b 2263 6f6c 7265 765f  lf.data["colrev_
-0000bb90: 6d61 7374 6572 6461 7461 5f70 726f 7665  masterdata_prove
-0000bba0: 6e61 6e63 6522 5d0a 2020 2020 2020 2020  nance"].        
-0000bbb0: 645f 705f 6469 6374 203d 2073 656c 662e  d_p_dict = self.
-0000bbc0: 6461 7461 5b22 636f 6c72 6576 5f64 6174  data["colrev_dat
-0000bbd0: 615f 7072 6f76 656e 616e 6365 225d 0a20  a_provenance"]. 
-0000bbe0: 2020 2020 2020 2066 6f72 206b 6579 2069         for key i
-0000bbf0: 6e20 7365 6c66 2e64 6174 612e 6b65 7973  n self.data.keys
-0000bc00: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-0000bc10: 6966 206b 6579 2069 6e20 5b0a 2020 2020  if key in [.    
-0000bc20: 2020 2020 2020 2020 2020 2020 2245 4e54              "ENT
-0000bc30: 5259 5459 5045 222c 0a20 2020 2020 2020  RYTYPE",.       
-0000bc40: 2020 2020 2020 2020 2022 636f 6c72 6576           "colrev
-0000bc50: 5f64 6174 615f 7072 6f76 656e 616e 6365  _data_provenance
-0000bc60: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-0000bc70: 2020 2022 636f 6c72 6576 5f6d 6173 7465     "colrev_maste
-0000bc80: 7264 6174 615f 7072 6f76 656e 616e 6365  rdata_provenance
-0000bc90: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-0000bca0: 2020 2022 636f 6c72 6576 5f73 7461 7475     "colrev_statu
-0000bcb0: 7322 2c0a 2020 2020 2020 2020 2020 2020  s",.            
-0000bcc0: 2020 2020 2263 6f6c 7265 765f 6964 222c      "colrev_id",
-0000bcd0: 0a20 2020 2020 2020 2020 2020 205d 3a0a  .            ]:.
-0000bce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bcf0: 636f 6e74 696e 7565 0a20 2020 2020 2020  continue.       
-0000bd00: 2020 2020 2069 6620 280a 2020 2020 2020       if (.      
-0000bd10: 2020 2020 2020 2020 2020 6b65 7920 696e            key in
-0000bd20: 2073 656c 662e 6964 656e 7469 6679 696e   self.identifyin
-0000bd30: 675f 6669 656c 645f 6b65 7973 0a20 2020  g_field_keys.   
-0000bd40: 2020 2020 2020 2020 2020 2020 2061 6e64               and
-0000bd50: 2022 4355 5241 5445 4422 206e 6f74 2069   "CURATED" not i
-0000bd60: 6e20 7365 6c66 2e64 6174 615b 2263 6f6c  n self.data["col
-0000bd70: 7265 765f 6d61 7374 6572 6461 7461 5f70  rev_masterdata_p
-0000bd80: 726f 7665 6e61 6e63 6522 5d0a 2020 2020  rovenance"].    
-0000bd90: 2020 2020 2020 2020 293a 0a20 2020 2020          ):.     
-0000bda0: 2020 2020 2020 2020 2020 206d 645f 705f             md_p_
-0000bdb0: 6469 6374 5b6b 6579 5d20 3d20 7b22 736f  dict[key] = {"so
-0000bdc0: 7572 6365 223a 2073 6f75 7263 652c 2022  urce": source, "
-0000bdd0: 6e6f 7465 223a 2022 227d 0a20 2020 2020  note": ""}.     
-0000bde0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0000bdf0: 2020 2020 2020 2020 2020 2020 2064 5f70               d_p
-0000be00: 5f64 6963 745b 6b65 795d 203d 207b 2273  _dict[key] = {"s
-0000be10: 6f75 7263 6522 3a20 736f 7572 6365 2c20  ource": source, 
-0000be20: 226e 6f74 6522 3a20 2222 7d0a 0a20 2020  "note": ""}..   
-0000be30: 2064 6566 2061 6464 5f64 6174 615f 7072   def add_data_pr
-0000be40: 6f76 656e 616e 6365 2873 656c 662c 202a  ovenance(self, *
-0000be50: 2c20 6b65 793a 2073 7472 2c20 736f 7572  , key: str, sour
-0000be60: 6365 3a20 7374 722c 206e 6f74 653a 2073  ce: str, note: s
-0000be70: 7472 203d 2022 2229 202d 3e20 4e6f 6e65  tr = "") -> None
-0000be80: 3a0a 2020 2020 2020 2020 2222 2241 6464  :.        """Add
-0000be90: 2061 2064 6174 6120 7072 6f76 656e 616e   a data provenan
-0000bea0: 6365 2c20 696e 636c 7564 696e 6720 736f  ce, including so
-0000beb0: 7572 6365 2061 6e64 206e 6f74 6520 2862  urce and note (b
-0000bec0: 6173 6564 206f 6e20 6120 6b65 7929 2222  ased on a key)""
-0000bed0: 220a 2020 2020 2020 2020 6966 2022 636f  ".        if "co
-0000bee0: 6c72 6576 5f64 6174 615f 7072 6f76 656e  lrev_data_proven
-0000bef0: 616e 6365 2220 6e6f 7420 696e 2073 656c  ance" not in sel
-0000bf00: 662e 6461 7461 3a0a 2020 2020 2020 2020  f.data:.        
-0000bf10: 2020 2020 7365 6c66 2e64 6174 615b 2263      self.data["c
-0000bf20: 6f6c 7265 765f 6461 7461 5f70 726f 7665  olrev_data_prove
-0000bf30: 6e61 6e63 6522 5d20 3d20 7b7d 0a20 2020  nance"] = {}.   
-0000bf40: 2020 2020 206d 645f 705f 6469 6374 203d       md_p_dict =
-0000bf50: 2073 656c 662e 6461 7461 5b22 636f 6c72   self.data["colr
-0000bf60: 6576 5f64 6174 615f 7072 6f76 656e 616e  ev_data_provenan
-0000bf70: 6365 225d 0a20 2020 2020 2020 2069 6620  ce"].        if 
-0000bf80: 6b65 7920 696e 206d 645f 705f 6469 6374  key in md_p_dict
-0000bf90: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-0000bfa0: 206e 6f74 6520 213d 2022 223a 0a20 2020   note != "":.   
-0000bfb0: 2020 2020 2020 2020 2020 2020 206d 645f               md_
-0000bfc0: 705f 6469 6374 5b6b 6579 5d5b 226e 6f74  p_dict[key]["not
-0000bfd0: 6522 5d20 2b3d 2066 222c 7b6e 6f74 657d  e"] += f",{note}
-0000bfe0: 220a 2020 2020 2020 2020 2020 2020 656c  ".            el
-0000bff0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0000c000: 2020 2020 6d64 5f70 5f64 6963 745b 6b65      md_p_dict[ke
-0000c010: 795d 5b22 6e6f 7465 225d 203d 2022 220a  y]["note"] = "".
-0000c020: 2020 2020 2020 2020 2020 2020 6d64 5f70              md_p
-0000c030: 5f64 6963 745b 6b65 795d 5b22 736f 7572  _dict[key]["sour
-0000c040: 6365 225d 203d 2073 6f75 7263 650a 2020  ce"] = source.  
-0000c050: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0000c060: 2020 2020 2020 2020 6d64 5f70 5f64 6963          md_p_dic
-0000c070: 745b 6b65 795d 203d 207b 2273 6f75 7263  t[key] = {"sourc
-0000c080: 6522 3a20 736f 7572 6365 2c20 226e 6f74  e": source, "not
-0000c090: 6522 3a20 6622 7b6e 6f74 657d 227d 0a0a  e": f"{note}"}..
-0000c0a0: 2020 2020 6465 6620 636f 6d70 6c65 7465      def complete
-0000c0b0: 5f70 726f 7665 6e61 6e63 6528 7365 6c66  _provenance(self
-0000c0c0: 2c20 2a2c 2073 6f75 7263 655f 696e 666f  , *, source_info
-0000c0d0: 3a20 7374 7229 202d 3e20 626f 6f6c 3a0a  : str) -> bool:.
-0000c0e0: 2020 2020 2020 2020 2222 2243 6f6d 706c          """Compl
-0000c0f0: 6574 6520 7072 6f76 656e 616e 6365 2069  ete provenance i
-0000c100: 6e66 6f72 6d61 7469 6f6e 2066 6f72 2069  nformation for i
-0000c110: 6e64 6578 696e 6722 2222 0a0a 2020 2020  ndexing"""..    
-0000c120: 2020 2020 666f 7220 6b65 7920 696e 206c      for key in l
-0000c130: 6973 7428 7365 6c66 2e64 6174 612e 6b65  ist(self.data.ke
-0000c140: 7973 2829 293a 0a20 2020 2020 2020 2020  ys()):.         
-0000c150: 2020 2069 6620 280a 2020 2020 2020 2020     if (.        
-0000c160: 2020 2020 2020 2020 6b65 790a 2020 2020          key.    
-0000c170: 2020 2020 2020 2020 2020 2020 696e 205b              in [
-0000c180: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c190: 2020 2020 2022 636f 6c72 6576 5f69 6422       "colrev_id"
-0000c1a0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000c1b0: 2020 2020 2020 2245 4e54 5259 5459 5045        "ENTRYTYPE
-0000c1c0: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-0000c1d0: 2020 2020 2020 2022 4944 222c 0a20 2020         "ID",.   
-0000c1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c1f0: 2022 6d65 7461 6461 7461 5f73 6f75 7263   "metadata_sourc
-0000c200: 655f 7265 706f 7369 746f 7279 5f70 6174  e_repository_pat
-0000c210: 6873 222c 0a20 2020 2020 2020 2020 2020  hs",.           
-0000c220: 2020 2020 2020 2020 2022 6c6f 6361 6c5f           "local_
-0000c230: 6375 7261 7465 645f 6d65 7461 6461 7461  curated_metadata
-0000c240: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-0000c250: 2020 205d 0a20 2020 2020 2020 2020 2020     ].           
-0000c260: 2020 2020 202b 2073 656c 662e 7072 6f76       + self.prov
-0000c270: 656e 616e 6365 5f6b 6579 730a 2020 2020  enance_keys.    
-0000c280: 2020 2020 2020 2020 293a 0a20 2020 2020          ):.     
-0000c290: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
-0000c2a0: 6e75 650a 0a20 2020 2020 2020 2020 2020  nue..           
-0000c2b0: 2069 6620 6b65 7920 696e 2073 656c 662e   if key in self.
-0000c2c0: 6964 656e 7469 6679 696e 675f 6669 656c  identifying_fiel
-0000c2d0: 645f 6b65 7973 3a0a 2020 2020 2020 2020  d_keys:.        
-0000c2e0: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
-0000c2f0: 656c 662e 6d61 7374 6572 6461 7461 5f69  elf.masterdata_i
-0000c300: 735f 6375 7261 7465 6428 293a 0a20 2020  s_curated():.   
-0000c310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c320: 2073 656c 662e 6164 645f 6d61 7374 6572   self.add_master
-0000c330: 6461 7461 5f70 726f 7665 6e61 6e63 6528  data_provenance(
-0000c340: 6b65 793d 6b65 792c 2073 6f75 7263 653d  key=key, source=
-0000c350: 736f 7572 6365 5f69 6e66 6f2c 206e 6f74  source_info, not
-0000c360: 653d 2222 290a 2020 2020 2020 2020 2020  e="").          
-0000c370: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000c380: 2020 2020 2020 2020 7365 6c66 2e61 6464          self.add
-0000c390: 5f64 6174 615f 7072 6f76 656e 616e 6365  _data_provenance
-0000c3a0: 286b 6579 3d6b 6579 2c20 736f 7572 6365  (key=key, source
-0000c3b0: 3d73 6f75 7263 655f 696e 666f 2c20 6e6f  =source_info, no
-0000c3c0: 7465 3d22 2229 0a0a 2020 2020 2020 2020  te="")..        
-0000c3d0: 7265 7475 726e 2054 7275 650a 0a20 2020  return True..   
-0000c3e0: 2064 6566 2068 6173 5f71 7561 6c69 7479   def has_quality
-0000c3f0: 5f64 6566 6563 7473 2873 656c 6629 202d  _defects(self) -
-0000c400: 3e20 626f 6f6c 3a0a 2020 2020 2020 2020  > bool:.        
-0000c410: 2222 2243 6865 636b 2077 6865 7468 6572  """Check whether
-0000c420: 2061 2072 6563 6f72 6420 6861 7320 7175   a record has qu
-0000c430: 616c 6974 7920 6465 6665 6374 7322 2222  ality defects"""
-0000c440: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0000c450: 616e 7928 0a20 2020 2020 2020 2020 2020  any(.           
-0000c460: 2078 5b22 6e6f 7465 225d 2021 3d20 2222   x["note"] != ""
-0000c470: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-0000c480: 2078 2069 6e20 7365 6c66 2e64 6174 612e   x in self.data.
-0000c490: 6765 7428 2263 6f6c 7265 765f 6d61 7374  get("colrev_mast
-0000c4a0: 6572 6461 7461 5f70 726f 7665 6e61 6e63  erdata_provenanc
-0000c4b0: 6522 2c20 7b7d 292e 7661 6c75 6573 2829  e", {}).values()
-0000c4c0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000c4d0: 6e6f 7420 616e 7928 7920 3d3d 2078 5b22  not any(y == x["
-0000c4e0: 6e6f 7465 225d 2066 6f72 2079 2069 6e20  note"] for y in 
-0000c4f0: 5b22 6e6f 742d 6d69 7373 696e 6722 5d29  ["not-missing"])
-0000c500: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-0000c510: 6465 6620 6765 745f 636f 6e74 6169 6e65  def get_containe
-0000c520: 725f 7469 746c 6528 7365 6c66 2920 2d3e  r_title(self) ->
-0000c530: 2073 7472 3a0a 2020 2020 2020 2020 2222   str:.        ""
-0000c540: 2247 6574 2074 6865 2072 6563 6f72 6427  "Get the record'
-0000c550: 7320 636f 6e74 6169 6e65 7220 7469 746c  s container titl
-0000c560: 6520 286a 6f75 726e 616c 206e 616d 652c  e (journal name,
-0000c570: 2062 6f6f 6b74 6974 6c65 2c20 6574 632e   booktitle, etc.
-0000c580: 2922 2222 0a20 2020 2020 2020 2063 6f6e  )""".        con
-0000c590: 7461 696e 6572 5f74 6974 6c65 203d 2022  tainer_title = "
-0000c5a0: 4e41 220a 2020 2020 2020 2020 6966 2022  NA".        if "
-0000c5b0: 454e 5452 5954 5950 4522 206e 6f74 2069  ENTRYTYPE" not i
-0000c5c0: 6e20 7365 6c66 2e64 6174 613a 0a20 2020  n self.data:.   
-0000c5d0: 2020 2020 2020 2020 2063 6f6e 7461 696e           contain
-0000c5e0: 6572 5f74 6974 6c65 203d 2073 656c 662e  er_title = self.
-0000c5f0: 6461 7461 2e67 6574 2822 6a6f 7572 6e61  data.get("journa
-0000c600: 6c22 2c20 7365 6c66 2e64 6174 612e 6765  l", self.data.ge
-0000c610: 7428 2262 6f6f 6b74 6974 6c65 222c 2022  t("booktitle", "
-0000c620: 4e41 2229 290a 2020 2020 2020 2020 656c  NA")).        el
-0000c630: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0000c640: 6966 2073 656c 662e 6461 7461 5b22 454e  if self.data["EN
-0000c650: 5452 5954 5950 4522 5d20 3d3d 2022 6172  TRYTYPE"] == "ar
-0000c660: 7469 636c 6522 3a0a 2020 2020 2020 2020  ticle":.        
-0000c670: 2020 2020 2020 2020 636f 6e74 6169 6e65          containe
-0000c680: 725f 7469 746c 6520 3d20 7365 6c66 2e64  r_title = self.d
-0000c690: 6174 612e 6765 7428 226a 6f75 726e 616c  ata.get("journal
-0000c6a0: 222c 2022 4e41 2229 0a20 2020 2020 2020  ", "NA").       
-0000c6b0: 2020 2020 2069 6620 7365 6c66 2e64 6174       if self.dat
-0000c6c0: 615b 2245 4e54 5259 5459 5045 225d 203d  a["ENTRYTYPE"] =
-0000c6d0: 3d20 2269 6e70 726f 6365 6564 696e 6773  = "inproceedings
-0000c6e0: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
-0000c6f0: 2020 2063 6f6e 7461 696e 6572 5f74 6974     container_tit
-0000c700: 6c65 203d 2073 656c 662e 6461 7461 2e67  le = self.data.g
-0000c710: 6574 2822 626f 6f6b 7469 746c 6522 2c20  et("booktitle", 
-0000c720: 224e 4122 290a 2020 2020 2020 2020 2020  "NA").          
-0000c730: 2020 6966 2073 656c 662e 6461 7461 5b22    if self.data["
-0000c740: 454e 5452 5954 5950 4522 5d20 3d3d 2022  ENTRYTYPE"] == "
-0000c750: 626f 6f6b 223a 0a20 2020 2020 2020 2020  book":.         
-0000c760: 2020 2020 2020 2063 6f6e 7461 696e 6572         container
-0000c770: 5f74 6974 6c65 203d 2073 656c 662e 6461  _title = self.da
-0000c780: 7461 2e67 6574 2822 7469 746c 6522 2c20  ta.get("title", 
-0000c790: 224e 4122 290a 2020 2020 2020 2020 2020  "NA").          
-0000c7a0: 2020 6966 2073 656c 662e 6461 7461 5b22    if self.data["
-0000c7b0: 454e 5452 5954 5950 4522 5d20 3d3d 2022  ENTRYTYPE"] == "
-0000c7c0: 696e 626f 6f6b 223a 0a20 2020 2020 2020  inbook":.       
-0000c7d0: 2020 2020 2020 2020 2063 6f6e 7461 696e           contain
-0000c7e0: 6572 5f74 6974 6c65 203d 2073 656c 662e  er_title = self.
-0000c7f0: 6461 7461 2e67 6574 2822 626f 6f6b 7469  data.get("bookti
-0000c800: 746c 6522 2c20 224e 4122 290a 2020 2020  tle", "NA").    
-0000c810: 2020 2020 7265 7475 726e 2063 6f6e 7461      return conta
-0000c820: 696e 6572 5f74 6974 6c65 0a0a 2020 2020  iner_title..    
-0000c830: 6465 6620 6372 6561 7465 5f63 6f6c 7265  def create_colre
-0000c840: 765f 6964 280a 2020 2020 2020 2020 7365  v_id(.        se
-0000c850: 6c66 2c0a 2020 2020 2020 2020 2a2c 0a20  lf,.        *,. 
-0000c860: 2020 2020 2020 2061 7373 756d 655f 636f         assume_co
-0000c870: 6d70 6c65 7465 3a20 626f 6f6c 203d 2046  mplete: bool = F
-0000c880: 616c 7365 2c0a 2020 2020 2920 2d3e 2073  alse,.    ) -> s
-0000c890: 7472 3a0a 2020 2020 2020 2020 2222 2252  tr:.        """R
-0000c8a0: 6574 7572 6e73 2074 6865 2063 6f6c 7265  eturns the colre
-0000c8b0: 765f 6964 206f 6620 7468 6520 5265 636f  v_id of the Reco
-0000c8c0: 7264 2e22 2222 0a0a 2020 2020 2020 2020  rd."""..        
-0000c8d0: 7265 7475 726e 2063 6f6c 7265 762e 716d  return colrev.qm
-0000c8e0: 2e63 6f6c 7265 765f 6964 2e63 7265 6174  .colrev_id.creat
-0000c8f0: 655f 636f 6c72 6576 5f69 6428 0a20 2020  e_colrev_id(.   
-0000c900: 2020 2020 2020 2020 2072 6563 6f72 643d           record=
-0000c910: 7365 6c66 2c0a 2020 2020 2020 2020 2020  self,.          
-0000c920: 2020 6173 7375 6d65 5f63 6f6d 706c 6574    assume_complet
-0000c930: 653d 6173 7375 6d65 5f63 6f6d 706c 6574  e=assume_complet
-0000c940: 652c 0a20 2020 2020 2020 2029 0a0a 2020  e,.        )..  
-0000c950: 2020 6465 6620 7072 6573 6372 6565 6e5f    def prescreen_
-0000c960: 6578 636c 7564 6528 7365 6c66 2c20 2a2c  exclude(self, *,
-0000c970: 2072 6561 736f 6e3a 2073 7472 2c20 7072   reason: str, pr
-0000c980: 696e 745f 7761 726e 696e 673a 2062 6f6f  int_warning: boo
-0000c990: 6c20 3d20 4661 6c73 6529 202d 3e20 4e6f  l = False) -> No
-0000c9a0: 6e65 3a0a 2020 2020 2020 2020 2222 2250  ne:.        """P
-0000c9b0: 7265 7363 7265 656e 2d65 7863 6c75 6465  rescreen-exclude
-0000c9c0: 2061 2072 6563 6f72 6422 2222 0a20 2020   a record""".   
-0000c9d0: 2020 2020 2023 2057 6172 6e20 7768 656e       # Warn when
-0000c9e0: 2073 6574 7469 6e67 2072 6576 5f73 796e   setting rev_syn
-0000c9f0: 7468 6573 697a 6564 2f72 6576 5f69 6e63  thesized/rev_inc
-0000ca00: 6c75 6465 6420 746f 2070 7265 7363 7265  luded to prescre
-0000ca10: 656e 5f65 7863 6c75 6465 640a 2020 2020  en_excluded.    
-0000ca20: 2020 2020 2320 4573 7065 6369 616c 6c79      # Especially
-0000ca30: 2069 6e20 6361 7365 7320 696e 2077 6869   in cases in whi
-0000ca40: 6368 2074 6865 2070 7265 7363 7265 656e  ch the prescreen
-0000ca50: 2d65 7863 6c75 7369 6f6e 2064 6563 6973  -exclusion decis
-0000ca60: 696f 6e0a 2020 2020 2020 2020 2320 6973  ion.        # is
-0000ca70: 2072 6576 6973 6564 2028 652e 672e 2c20   revised (e.g., 
-0000ca80: 6265 6361 7573 6520 6120 7061 7065 7220  because a paper 
-0000ca90: 7761 7320 7265 7472 6163 7465 6429 0a20  was retracted). 
-0000caa0: 2020 2020 2020 2023 2049 6e20 7468 6573         # In thes
-0000cab0: 6520 6361 7365 732c 2074 6865 2070 6170  e cases, the pap
-0000cac0: 6572 206d 6179 2061 6c72 6561 6479 2062  er may already b
-0000cad0: 6520 696e 2074 6865 2064 6174 6120 6578  e in the data ex
-0000cae0: 7472 6163 7469 6f6e 2f73 796e 7468 6573  traction/synthes
-0000caf0: 6973 0a20 2020 2020 2020 2069 6620 7365  is.        if se
-0000cb00: 6c66 2e64 6174 612e 6765 7428 2263 6f6c  lf.data.get("col
-0000cb10: 7265 765f 7374 6174 7573 222c 2022 4e41  rev_status", "NA
-0000cb20: 2229 2069 6e20 5b0a 2020 2020 2020 2020  ") in [.        
-0000cb30: 2020 2020 5265 636f 7264 5374 6174 652e      RecordState.
-0000cb40: 7265 765f 7379 6e74 6865 7369 7a65 642c  rev_synthesized,
-0000cb50: 0a20 2020 2020 2020 2020 2020 2052 6563  .            Rec
-0000cb60: 6f72 6453 7461 7465 2e72 6576 5f69 6e63  ordState.rev_inc
-0000cb70: 6c75 6465 642c 0a20 2020 2020 2020 205d  luded,.        ]
-0000cb80: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
-0000cb90: 696e 7428 0a20 2020 2020 2020 2020 2020  int(.           
-0000cba0: 2020 2020 2066 225c 6e7b 636f 6c6f 7273       f"\n{colors
-0000cbb0: 2e52 4544 7d57 6172 6e69 6e67 3a20 7365  .RED}Warning: se
-0000cbc0: 7474 696e 6720 7061 7065 7220 746f 2070  tting paper to p
-0000cbd0: 7265 7363 7265 656e 5f65 7863 6c75 6465  rescreen_exclude
-0000cbe0: 642e 2050 6c65 6173 6520 6368 6563 6b20  d. Please check 
-0000cbf0: 616e 6420 220a 2020 2020 2020 2020 2020  and ".          
-0000cc00: 2020 2020 2020 6622 7265 6d6f 7665 2066        f"remove f
-0000cc10: 726f 6d20 7379 6e74 6865 7369 733a 207b  rom synthesis: {
-0000cc20: 7365 6c66 2e64 6174 615b 2749 4427 5d7d  self.data['ID']}
-0000cc30: 7b63 6f6c 6f72 732e 454e 447d 5c6e 220a  {colors.END}\n".
-0000cc40: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
-0000cc50: 2020 2020 2020 2073 656c 662e 7365 745f         self.set_
-0000cc60: 7374 6174 7573 2874 6172 6765 745f 7374  status(target_st
-0000cc70: 6174 653d 5265 636f 7264 5374 6174 652e  ate=RecordState.
-0000cc80: 7265 765f 7072 6573 6372 6565 6e5f 6578  rev_prescreen_ex
-0000cc90: 636c 7564 6564 290a 0a20 2020 2020 2020  cluded)..       
-0000cca0: 2069 6620 280a 2020 2020 2020 2020 2020   if (.          
-0000ccb0: 2020 2272 6574 7261 6374 6564 2220 6e6f    "retracted" no
-0000ccc0: 7420 696e 2073 656c 662e 6461 7461 2e67  t in self.data.g
-0000ccd0: 6574 2822 7072 6573 6372 6565 6e5f 6578  et("prescreen_ex
-0000cce0: 636c 7573 696f 6e22 2c20 2222 290a 2020  clusion", "").  
-0000ccf0: 2020 2020 2020 2020 2020 616e 6420 2272            and "r
-0000cd00: 6574 7261 6374 6564 2220 3d3d 2072 6561  etracted" == rea
-0000cd10: 736f 6e0a 2020 2020 2020 2020 2020 2020  son.            
-0000cd20: 616e 6420 7072 696e 745f 7761 726e 696e  and print_warnin
-0000cd30: 670a 2020 2020 2020 2020 293a 0a20 2020  g.        ):.   
-0000cd40: 2020 2020 2020 2020 2070 7269 6e74 280a           print(.
-0000cd50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cd60: 6622 5c6e 7b63 6f6c 6f72 732e 5245 447d  f"\n{colors.RED}
-0000cd70: 5061 7065 7220 7265 7472 6163 7465 6420  Paper retracted 
-0000cd80: 616e 6420 7072 6573 6372 6565 6e20 220a  and prescreen ".
-0000cd90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cda0: 6622 6578 636c 7564 6564 3a20 7b73 656c  f"excluded: {sel
-0000cdb0: 662e 6461 7461 5b27 4944 275d 7d7b 636f  f.data['ID']}{co
-0000cdc0: 6c6f 7273 2e45 4e44 7d5c 6e22 0a20 2020  lors.END}\n".   
-0000cdd0: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
-0000cde0: 2020 2020 7365 6c66 2e64 6174 615b 2270      self.data["p
-0000cdf0: 7265 7363 7265 656e 5f65 7863 6c75 7369  rescreen_exclusi
-0000ce00: 6f6e 225d 203d 2072 6561 736f 6e0a 0a20  on"] = reason.. 
-0000ce10: 2020 2020 2020 2023 204e 6f74 653a 2077         # Note: w
-0000ce20: 6865 6e20 7265 636f 7264 7320 6172 6520  hen records are 
-0000ce30: 7072 6573 6372 6565 6e2d 6578 636c 7564  prescreen-exclud
-0000ce40: 6564 2064 7572 696e 6720 7072 6570 3a0a  ed during prep:.
-0000ce50: 2020 2020 2020 2020 746f 5f64 726f 7020          to_drop 
-0000ce60: 3d20 5b5d 0a20 2020 2020 2020 2066 6f72  = [].        for
-0000ce70: 206b 6579 2c20 7661 6c75 6520 696e 2073   key, value in s
-0000ce80: 656c 662e 6461 7461 2e69 7465 6d73 2829  elf.data.items()
-0000ce90: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-0000cea0: 2076 616c 7565 203d 3d20 2255 4e4b 4e4f   value == "UNKNO
-0000ceb0: 574e 223a 0a20 2020 2020 2020 2020 2020  WN":.           
-0000cec0: 2020 2020 2074 6f5f 6472 6f70 2e61 7070       to_drop.app
-0000ced0: 656e 6428 6b65 7929 0a20 2020 2020 2020  end(key).       
-0000cee0: 2066 6f72 206b 6579 2069 6e20 746f 5f64   for key in to_d
-0000cef0: 726f 703a 0a20 2020 2020 2020 2020 2020  rop:.           
-0000cf00: 2073 656c 662e 7265 6d6f 7665 5f66 6965   self.remove_fie
-0000cf10: 6c64 286b 6579 3d6b 6579 290a 0a20 2020  ld(key=key)..   
-0000cf20: 2064 6566 2065 7874 7261 6374 5f74 6578   def extract_tex
-0000cf30: 745f 6279 5f70 6167 6528 0a20 2020 2020  t_by_page(.     
-0000cf40: 2020 2073 656c 662c 202a 2c20 7061 6765     self, *, page
-0000cf50: 733a 204f 7074 696f 6e61 6c5b 6c69 7374  s: Optional[list
-0000cf60: 5d20 3d20 4e6f 6e65 2c20 7072 6f6a 6563  ] = None, projec
-0000cf70: 745f 7061 7468 3a20 5061 7468 0a20 2020  t_path: Path.   
-0000cf80: 2029 202d 3e20 7374 723a 0a20 2020 2020   ) -> str:.     
-0000cf90: 2020 2022 2222 4578 7472 6163 7420 7468     """Extract th
-0000cfa0: 6520 7465 7874 2066 726f 6d20 7468 6520  e text from the 
-0000cfb0: 5044 4620 666f 7220 6120 6769 7665 6e20  PDF for a given 
-0000cfc0: 6e75 6d62 6572 206f 6620 7061 6765 7322  number of pages"
-0000cfd0: 2222 0a20 2020 2020 2020 2074 6578 745f  "".        text_
-0000cfe0: 6c69 7374 3a20 6c69 7374 203d 205b 5d0a  list: list = [].
-0000cff0: 2020 2020 2020 2020 7064 665f 7061 7468          pdf_path
-0000d000: 203d 2070 726f 6a65 6374 5f70 6174 6820   = project_path 
-0000d010: 2f20 5061 7468 2873 656c 662e 6461 7461  / Path(self.data
-0000d020: 5b22 6669 6c65 225d 290a 0a20 2020 2020  ["file"])..     
-0000d030: 2020 2023 2068 7474 7073 3a2f 2f73 7461     # https://sta
-0000d040: 636b 6f76 6572 666c 6f77 2e63 6f6d 2f71  ckoverflow.com/q
-0000d050: 7565 7374 696f 6e73 2f34 3934 3537 3434  uestions/4945744
-0000d060: 332f 7079 7468 6f6e 2d70 6466 6d69 6e65  3/python-pdfmine
-0000d070: 722d 636f 6e76 6572 7473 2d70 6466 2d66  r-converts-pdf-f
-0000d080: 696c 652d 696e 746f 2d6f 6e65 2d63 6875  ile-into-one-chu
-0000d090: 6e6b 2d6f 662d 7374 7269 6e67 2d77 6974  nk-of-string-wit
-0000d0a0: 682d 6e6f 2d73 7061 6365 732d 6265 7477  h-no-spaces-betw
-0000d0b0: 6565 0a20 2020 2020 2020 206c 6170 6172  ee.        lapar
-0000d0c0: 616d 7320 3d20 7064 666d 696e 6572 2e6c  ams = pdfminer.l
-0000d0d0: 6179 6f75 742e 4c41 5061 7261 6d73 2829  ayout.LAParams()
-0000d0e0: 0a20 2020 2020 2020 2073 6574 6174 7472  .        setattr
-0000d0f0: 286c 6170 6172 616d 732c 2022 616c 6c5f  (laparams, "all_
-0000d100: 7465 7874 7322 2c20 5472 7565 290a 0a20  texts", True).. 
-0000d110: 2020 2020 2020 2077 6974 6820 6f70 656e         with open
-0000d120: 2870 6466 5f70 6174 682c 2022 7262 2229  (pdf_path, "rb")
-0000d130: 2061 7320 7064 665f 6669 6c65 3a0a 2020   as pdf_file:.  
-0000d140: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
-0000d150: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0000d160: 6f72 2070 6167 6520 696e 2050 4446 5061  or page in PDFPa
-0000d170: 6765 2e67 6574 5f70 6167 6573 280a 2020  ge.get_pages(.  
-0000d180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d190: 2020 7064 665f 6669 6c65 2c0a 2020 2020    pdf_file,.    
-0000d1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d1b0: 7061 6765 6e6f 733d 7061 6765 732c 2020  pagenos=pages,  
-0000d1c0: 2320 6e6f 7465 3a20 6d61 7962 6520 736b  # note: maybe sk
-0000d1d0: 6970 2070 6f74 656e 7469 616c 2063 6f76  ip potential cov
-0000d1e0: 6572 2070 6167 6573 3f0a 2020 2020 2020  er pages?.      
-0000d1f0: 2020 2020 2020 2020 2020 2020 2020 6361                ca
-0000d200: 6368 696e 673d 5472 7565 2c0a 2020 2020  ching=True,.    
-0000d210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d220: 6368 6563 6b5f 6578 7472 6163 7461 626c  check_extractabl
-0000d230: 653d 5472 7565 2c0a 2020 2020 2020 2020  e=True,.        
-0000d240: 2020 2020 2020 2020 293a 0a20 2020 2020          ):.     
-0000d250: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000d260: 6573 6f75 7263 655f 6d61 6e61 6765 7220  esource_manager 
-0000d270: 3d20 5044 4652 6573 6f75 7263 654d 616e  = PDFResourceMan
-0000d280: 6167 6572 2829 0a20 2020 2020 2020 2020  ager().         
-0000d290: 2020 2020 2020 2020 2020 2066 616b 655f             fake_
-0000d2a0: 6669 6c65 5f68 616e 646c 6520 3d20 696f  file_handle = io
-0000d2b0: 2e53 7472 696e 6749 4f28 290a 2020 2020  .StringIO().    
-0000d2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d2d0: 636f 6e76 6572 7465 7220 3d20 5465 7874  converter = Text
-0000d2e0: 436f 6e76 6572 7465 7228 0a20 2020 2020  Converter(.     
-0000d2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d300: 2020 2072 6573 6f75 7263 655f 6d61 6e61     resource_mana
-0000d310: 6765 722c 2066 616b 655f 6669 6c65 5f68  ger, fake_file_h
-0000d320: 616e 646c 652c 206c 6170 6172 616d 733d  andle, laparams=
-0000d330: 6c61 7061 7261 6d73 0a20 2020 2020 2020  laparams.       
-0000d340: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
-0000d350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d360: 2020 2070 6167 655f 696e 7465 7270 7265     page_interpre
-0000d370: 7465 7220 3d20 5044 4650 6167 6549 6e74  ter = PDFPageInt
-0000d380: 6572 7072 6574 6572 2872 6573 6f75 7263  erpreter(resourc
-0000d390: 655f 6d61 6e61 6765 722c 2063 6f6e 7665  e_manager, conve
-0000d3a0: 7274 6572 290a 2020 2020 2020 2020 2020  rter).          
-0000d3b0: 2020 2020 2020 2020 2020 7061 6765 5f69            page_i
-0000d3c0: 6e74 6572 7072 6574 6572 2e70 726f 6365  nterpreter.proce
-0000d3d0: 7373 5f70 6167 6528 7061 6765 290a 0a20  ss_page(page).. 
-0000d3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d3f0: 2020 2074 6578 7420 3d20 6661 6b65 5f66     text = fake_f
-0000d400: 696c 655f 6861 6e64 6c65 2e67 6574 7661  ile_handle.getva
-0000d410: 6c75 6528 290a 2020 2020 2020 2020 2020  lue().          
-0000d420: 2020 2020 2020 2020 2020 7465 7874 5f6c            text_l
-0000d430: 6973 7420 2b3d 2074 6578 740a 0a20 2020  ist += text..   
-0000d440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d450: 2023 2063 6c6f 7365 206f 7065 6e20 6861   # close open ha
-0000d460: 6e64 6c65 730a 2020 2020 2020 2020 2020  ndles.          
-0000d470: 2020 2020 2020 2020 2020 636f 6e76 6572            conver
-0000d480: 7465 722e 636c 6f73 6528 290a 2020 2020  ter.close().    
-0000d490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d4a0: 6661 6b65 5f66 696c 655f 6861 6e64 6c65  fake_file_handle
-0000d4b0: 2e63 6c6f 7365 2829 0a20 2020 2020 2020  .close().       
-0000d4c0: 2020 2020 2065 7863 6570 7420 2854 7970       except (Typ
-0000d4d0: 6545 7272 6f72 2c20 4b65 7945 7272 6f72  eError, KeyError
-0000d4e0: 293a 2020 2320 7072 6167 6d61 3a20 6e6f  ):  # pragma: no
-0000d4f0: 2063 6f76 6572 0a20 2020 2020 2020 2020   cover.         
-0000d500: 2020 2020 2020 2070 6173 730a 2020 2020         pass.    
-0000d510: 2020 2020 7265 7475 726e 2022 222e 6a6f      return "".jo
-0000d520: 696e 2874 6578 745f 6c69 7374 290a 0a20  in(text_list).. 
-0000d530: 2020 2064 6566 2073 6574 5f70 6167 6573     def set_pages
-0000d540: 5f69 6e5f 7064 6628 7365 6c66 2c20 2a2c  _in_pdf(self, *,
-0000d550: 2070 726f 6a65 6374 5f70 6174 683a 2050   project_path: P
-0000d560: 6174 6829 202d 3e20 4e6f 6e65 3a0a 2020  ath) -> None:.  
-0000d570: 2020 2020 2020 2222 2253 6574 2074 6865        """Set the
-0000d580: 2070 6167 6573 5f69 6e5f 6669 6c65 2066   pages_in_file f
-0000d590: 6965 6c64 2062 6173 6564 206f 6e20 7468  ield based on th
-0000d5a0: 6520 5044 4622 2222 0a20 2020 2020 2020  e PDF""".       
-0000d5b0: 2070 6466 5f70 6174 6820 3d20 7072 6f6a   pdf_path = proj
-0000d5c0: 6563 745f 7061 7468 202f 2050 6174 6828  ect_path / Path(
-0000d5d0: 7365 6c66 2e64 6174 615b 2266 696c 6522  self.data["file"
-0000d5e0: 5d29 0a20 2020 2020 2020 2077 6974 6820  ]).        with 
-0000d5f0: 6f70 656e 2870 6466 5f70 6174 682c 2022  open(pdf_path, "
-0000d600: 7262 2229 2061 7320 6669 6c65 3a0a 2020  rb") as file:.  
-0000d610: 2020 2020 2020 2020 2020 7061 7273 6572            parser
-0000d620: 203d 2050 4446 5061 7273 6572 2866 696c   = PDFParser(fil
-0000d630: 6529 0a20 2020 2020 2020 2020 2020 2064  e).            d
-0000d640: 6f63 756d 656e 7420 3d20 5044 4644 6f63  ocument = PDFDoc
-0000d650: 756d 656e 7428 7061 7273 6572 290a 2020  ument(parser).  
-0000d660: 2020 2020 2020 2020 2020 7061 6765 735f            pages_
-0000d670: 696e 5f66 696c 6520 3d20 7265 736f 6c76  in_file = resolv
-0000d680: 6531 2864 6f63 756d 656e 742e 6361 7461  e1(document.cata
-0000d690: 6c6f 675b 2250 6167 6573 225d 295b 2243  log["Pages"])["C
-0000d6a0: 6f75 6e74 225d 0a20 2020 2020 2020 2073  ount"].        s
-0000d6b0: 656c 662e 6461 7461 5b22 7061 6765 735f  elf.data["pages_
-0000d6c0: 696e 5f66 696c 6522 5d20 3d20 7061 6765  in_file"] = page
-0000d6d0: 735f 696e 5f66 696c 650a 0a20 2020 2064  s_in_file..    d
-0000d6e0: 6566 2073 6574 5f74 6578 745f 6672 6f6d  ef set_text_from
-0000d6f0: 5f70 6466 2873 656c 662c 202a 2c20 7072  _pdf(self, *, pr
-0000d700: 6f6a 6563 745f 7061 7468 3a20 5061 7468  oject_path: Path
-0000d710: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-0000d720: 2020 2022 2222 5365 7420 7468 6520 7465     """Set the te
-0000d730: 7874 5f66 726f 6d5f 7064 6620 6669 656c  xt_from_pdf fiel
-0000d740: 6420 6261 7365 6420 6f6e 2074 6865 2050  d based on the P
-0000d750: 4446 2222 220a 2020 2020 2020 2020 7365  DF""".        se
-0000d760: 6c66 2e64 6174 615b 2274 6578 745f 6672  lf.data["text_fr
-0000d770: 6f6d 5f70 6466 225d 203d 2022 220a 2020  om_pdf"] = "".  
-0000d780: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-0000d790: 2020 2020 2020 2073 656c 662e 7365 745f         self.set_
-0000d7a0: 7061 6765 735f 696e 5f70 6466 2870 726f  pages_in_pdf(pro
-0000d7b0: 6a65 6374 5f70 6174 683d 7072 6f6a 6563  ject_path=projec
-0000d7c0: 745f 7061 7468 290a 2020 2020 2020 2020  t_path).        
-0000d7d0: 2020 2020 7465 7874 203d 2073 656c 662e      text = self.
-0000d7e0: 6578 7472 6163 745f 7465 7874 5f62 795f  extract_text_by_
-0000d7f0: 7061 6765 2870 6167 6573 3d5b 302c 2031  page(pages=[0, 1
-0000d800: 2c20 325d 2c20 7072 6f6a 6563 745f 7061  , 2], project_pa
-0000d810: 7468 3d70 726f 6a65 6374 5f70 6174 6829  th=project_path)
-0000d820: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0000d830: 662e 6461 7461 5b22 7465 7874 5f66 726f  f.data["text_fro
-0000d840: 6d5f 7064 6622 5d20 3d20 7465 7874 2e72  m_pdf"] = text.r
-0000d850: 6570 6c61 6365 2822 5c6e 222c 2022 2022  eplace("\n", " "
-0000d860: 292e 7265 706c 6163 6528 225c 7830 6322  ).replace("\x0c"
-0000d870: 2c20 2222 290a 0a20 2020 2020 2020 2065  , "")..        e
-0000d880: 7863 6570 7420 5044 4653 796e 7461 7845  xcept PDFSyntaxE
-0000d890: 7272 6f72 3a20 2023 2070 7261 676d 613a  rror:  # pragma:
-0000d8a0: 206e 6f20 636f 7665 720a 2020 2020 2020   no cover.      
-0000d8b0: 2020 2020 2020 7365 6c66 2e61 6464 5f64        self.add_d
-0000d8c0: 6174 615f 7072 6f76 656e 616e 6365 5f6e  ata_provenance_n
-0000d8d0: 6f74 6528 6b65 793d 2266 696c 6522 2c20  ote(key="file", 
-0000d8e0: 6e6f 7465 3d22 7064 665f 7265 6164 6572  note="pdf_reader
-0000d8f0: 5f65 7272 6f72 2229 0a20 2020 2020 2020  _error").       
-0000d900: 2020 2020 2073 656c 662e 6461 7461 2e75       self.data.u
-0000d910: 7064 6174 6528 636f 6c72 6576 5f73 7461  pdate(colrev_sta
-0000d920: 7475 733d 5265 636f 7264 5374 6174 652e  tus=RecordState.
-0000d930: 7064 665f 6e65 6564 735f 6d61 6e75 616c  pdf_needs_manual
-0000d940: 5f70 7265 7061 7261 7469 6f6e 290a 2020  _preparation).  
-0000d950: 2020 2020 2020 6578 6365 7074 2050 4446        except PDF
-0000d960: 5465 7874 4578 7472 6163 7469 6f6e 4e6f  TextExtractionNo
-0000d970: 7441 6c6c 6f77 6564 3a20 2023 2070 7261  tAllowed:  # pra
-0000d980: 676d 613a 206e 6f20 636f 7665 720a 2020  gma: no cover.  
-0000d990: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-0000d9a0: 6464 5f64 6174 615f 7072 6f76 656e 616e  dd_data_provenan
-0000d9b0: 6365 5f6e 6f74 6528 6b65 793d 2266 696c  ce_note(key="fil
-0000d9c0: 6522 2c20 6e6f 7465 3d22 7064 665f 7072  e", note="pdf_pr
-0000d9d0: 6f74 6563 7465 6422 290a 2020 2020 2020  otected").      
-0000d9e0: 2020 2020 2020 7365 6c66 2e64 6174 612e        self.data.
-0000d9f0: 7570 6461 7465 2863 6f6c 7265 765f 7374  update(colrev_st
-0000da00: 6174 7573 3d52 6563 6f72 6453 7461 7465  atus=RecordState
-0000da10: 2e70 6466 5f6e 6565 6473 5f6d 616e 7561  .pdf_needs_manua
-0000da20: 6c5f 7072 6570 6172 6174 696f 6e29 0a0a  l_preparation)..
-0000da30: 2020 2020 6465 6620 6578 7472 6163 745f      def extract_
-0000da40: 7061 6765 7328 0a20 2020 2020 2020 2073  pages(.        s
-0000da50: 656c 662c 202a 2c20 7061 6765 733a 206c  elf, *, pages: l
-0000da60: 6973 742c 2070 726f 6a65 6374 5f70 6174  ist, project_pat
-0000da70: 683a 2050 6174 682c 2073 6176 655f 746f  h: Path, save_to
-0000da80: 5f70 6174 683a 204f 7074 696f 6e61 6c5b  _path: Optional[
-0000da90: 5061 7468 5d20 3d20 4e6f 6e65 0a20 2020  Path] = None.   
-0000daa0: 2029 202d 3e20 4e6f 6e65 3a20 2023 2070   ) -> None:  # p
-0000dab0: 7261 676d 613a 206e 6f20 636f 7665 720a  ragma: no cover.
-0000dac0: 2020 2020 2020 2020 2222 2245 7874 7261          """Extra
-0000dad0: 6374 2070 6167 6573 2066 726f 6d20 7468  ct pages from th
-0000dae0: 6520 5044 4620 2873 6176 6569 6e67 2074  e PDF (saveing t
-0000daf0: 6865 6d20 746f 2074 6865 2073 6176 655f  hem to the save_
-0000db00: 746f 5f70 6174 6829 2222 220a 2020 2020  to_path)""".    
-0000db10: 2020 2020 7064 665f 7061 7468 203d 2070      pdf_path = p
-0000db20: 726f 6a65 6374 5f70 6174 6820 2f20 5061  roject_path / Pa
-0000db30: 7468 2873 656c 662e 6461 7461 5b22 6669  th(self.data["fi
-0000db40: 6c65 225d 290a 2020 2020 2020 2020 7064  le"]).        pd
-0000db50: 665f 7265 6164 6572 203d 2050 6466 4669  f_reader = PdfFi
-0000db60: 6c65 5265 6164 6572 2873 7472 2870 6466  leReader(str(pdf
-0000db70: 5f70 6174 6829 2c20 7374 7269 6374 3d46  _path), strict=F
-0000db80: 616c 7365 290a 2020 2020 2020 2020 7772  alse).        wr
-0000db90: 6974 6572 203d 2050 6466 4669 6c65 5772  iter = PdfFileWr
-0000dba0: 6974 6572 2829 0a20 2020 2020 2020 2066  iter().        f
-0000dbb0: 6f72 2069 2069 6e20 7261 6e67 6528 302c  or i in range(0,
-0000dbc0: 206c 656e 2870 6466 5f72 6561 6465 722e   len(pdf_reader.
-0000dbd0: 7061 6765 7329 293a 0a20 2020 2020 2020  pages)):.       
-0000dbe0: 2020 2020 2069 6620 6920 696e 2070 6167       if i in pag
-0000dbf0: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-0000dc00: 2020 2020 636f 6e74 696e 7565 0a20 2020      continue.   
-0000dc10: 2020 2020 2020 2020 2077 7269 7465 722e           writer.
-0000dc20: 6164 6450 6167 6528 7064 665f 7265 6164  addPage(pdf_read
-0000dc30: 6572 2e67 6574 5061 6765 2869 2929 0a20  er.getPage(i)). 
-0000dc40: 2020 2020 2020 2077 6974 6820 6f70 656e         with open
-0000dc50: 2870 6466 5f70 6174 682c 2022 7762 2229  (pdf_path, "wb")
-0000dc60: 2061 7320 6f75 7466 696c 653a 0a20 2020   as outfile:.   
-0000dc70: 2020 2020 2020 2020 2077 7269 7465 722e           writer.
-0000dc80: 7772 6974 6528 6f75 7466 696c 6529 0a0a  write(outfile)..
-0000dc90: 2020 2020 2020 2020 6966 2073 6176 655f          if save_
-0000dca0: 746f 5f70 6174 683a 0a20 2020 2020 2020  to_path:.       
-0000dcb0: 2020 2020 2077 7269 7465 725f 6370 203d       writer_cp =
-0000dcc0: 2050 6466 4669 6c65 5772 6974 6572 2829   PdfFileWriter()
-0000dcd0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-0000dce0: 2070 6167 6520 696e 2070 6167 6573 3a0a   page in pages:.
-0000dcf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dd00: 7772 6974 6572 5f63 702e 6164 6450 6167  writer_cp.addPag
-0000dd10: 6528 7064 665f 7265 6164 6572 2e67 6574  e(pdf_reader.get
-0000dd20: 5061 6765 2870 6167 6529 290a 2020 2020  Page(page)).    
-0000dd30: 2020 2020 2020 2020 6669 6c65 7061 7468          filepath
-0000dd40: 203d 2050 6174 6828 7064 665f 7061 7468   = Path(pdf_path
-0000dd50: 290a 2020 2020 2020 2020 2020 2020 7769  ).            wi
-0000dd60: 7468 206f 7065 6e28 7361 7665 5f74 6f5f  th open(save_to_
-0000dd70: 7061 7468 202f 2066 696c 6570 6174 682e  path / filepath.
-0000dd80: 6e61 6d65 2c20 2277 6222 2920 6173 206f  name, "wb") as o
-0000dd90: 7574 6669 6c65 3a0a 2020 2020 2020 2020  utfile:.        
-0000dda0: 2020 2020 2020 2020 7772 6974 6572 5f63          writer_c
-0000ddb0: 702e 7772 6974 6528 6f75 7466 696c 6529  p.write(outfile)
-0000ddc0: 0a0a 2020 2020 4063 6c61 7373 6d65 7468  ..    @classmeth
-0000ddd0: 6f64 0a20 2020 2064 6566 2067 6574 5f63  od.    def get_c
-0000dde0: 6f6c 7265 765f 7064 665f 6964 280a 2020  olrev_pdf_id(.  
-0000ddf0: 2020 2020 2020 636c 732c 0a20 2020 2020        cls,.     
-0000de00: 2020 202a 2c0a 2020 2020 2020 2020 7064     *,.        pd
-0000de10: 665f 7061 7468 3a20 5061 7468 2c0a 2020  f_path: Path,.  
-0000de20: 2020 2920 2d3e 2073 7472 3a20 2023 2070    ) -> str:  # p
-0000de30: 7261 676d 613a 206e 6f20 636f 7665 720a  ragma: no cover.
-0000de40: 2020 2020 2020 2020 2222 2247 656e 6572          """Gener
-0000de50: 6174 6520 7468 6520 636f 6c72 6576 5f70  ate the colrev_p
-0000de60: 6466 5f69 6422 2222 0a0a 2020 2020 2020  df_id"""..      
-0000de70: 2020 7265 7475 726e 2063 6f6c 7265 762e    return colrev.
-0000de80: 716d 2e63 6f6c 7265 765f 7064 665f 6964  qm.colrev_pdf_id
-0000de90: 2e63 7265 6174 655f 636f 6c72 6576 5f70  .create_colrev_p
-0000dea0: 6466 5f69 6428 7064 665f 7061 7468 3d70  df_id(pdf_path=p
-0000deb0: 6466 5f70 6174 6829 0a0a 2020 2020 6465  df_path)..    de
-0000dec0: 6620 6765 745f 746f 635f 6b65 7928 7365  f get_toc_key(se
-0000ded0: 6c66 2920 2d3e 2073 7472 3a0a 2020 2020  lf) -> str:.    
-0000dee0: 2020 2020 2222 2247 6574 2074 6865 2072      """Get the r
-0000def0: 6563 6f72 6427 7320 746f 632d 6b65 7922  ecord's toc-key"
-0000df00: 2222 0a0a 2020 2020 2020 2020 7472 793a  ""..        try:
-0000df10: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000df20: 7365 6c66 2e64 6174 615b 2245 4e54 5259  self.data["ENTRY
-0000df30: 5459 5045 225d 203d 3d20 2261 7274 6963  TYPE"] == "artic
-0000df40: 6c65 223a 0a20 2020 2020 2020 2020 2020  le":.           
-0000df50: 2020 2020 2074 6f63 5f6b 6579 203d 2028       toc_key = (
-0000df60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000df70: 2020 2020 2073 656c 662e 6461 7461 5b22       self.data["
-0000df80: 6a6f 7572 6e61 6c22 5d0a 2020 2020 2020  journal"].      
-0000df90: 2020 2020 2020 2020 2020 2020 2020 2e72                .r
-0000dfa0: 6570 6c61 6365 2822 2022 2c20 222d 2229  eplace(" ", "-")
-0000dfb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000dfc0: 2020 2020 202e 7265 706c 6163 6528 225c       .replace("\
-0000dfd0: 5c22 2c20 2222 290a 2020 2020 2020 2020  \", "").        
-0000dfe0: 2020 2020 2020 2020 2020 2020 2e72 6570              .rep
-0000dff0: 6c61 6365 2822 2622 2c20 2261 6e64 2229  lace("&", "and")
-0000e000: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e010: 2020 2020 202e 6c6f 7765 7228 290a 2020       .lower().  
-0000e020: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-0000e030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e040: 746f 635f 6b65 7920 2b3d 2028 0a20 2020  toc_key += (.   
-0000e050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e060: 2066 227c 7b73 656c 662e 6461 7461 5b27   f"|{self.data['
-0000e070: 766f 6c75 6d65 275d 7d22 0a20 2020 2020  volume']}".     
-0000e080: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0000e090: 6620 2822 554e 4b4e 4f57 4e22 2021 3d20  f ("UNKNOWN" != 
-0000e0a0: 7365 6c66 2e64 6174 612e 6765 7428 2276  self.data.get("v
-0000e0b0: 6f6c 756d 6522 2c20 2255 4e4b 4e4f 574e  olume", "UNKNOWN
-0000e0c0: 2229 290a 2020 2020 2020 2020 2020 2020  ")).            
-0000e0d0: 2020 2020 2020 2020 656c 7365 2022 7c2d          else "|-
-0000e0e0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0000e0f0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-0000e100: 2020 2020 746f 635f 6b65 7920 2b3d 2028      toc_key += (
-0000e110: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e120: 2020 2020 2066 227c 7b73 656c 662e 6461       f"|{self.da
-0000e130: 7461 5b27 6e75 6d62 6572 275d 7d22 0a20  ta['number']}". 
-0000e140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e150: 2020 2069 6620 2822 554e 4b4e 4f57 4e22     if ("UNKNOWN"
-0000e160: 2021 3d20 7365 6c66 2e64 6174 612e 6765   != self.data.ge
-0000e170: 7428 226e 756d 6265 7222 2c20 2255 4e4b  t("number", "UNK
-0000e180: 4e4f 574e 2229 290a 2020 2020 2020 2020  NOWN")).        
-0000e190: 2020 2020 2020 2020 2020 2020 656c 7365              else
-0000e1a0: 2022 7c2d 220a 2020 2020 2020 2020 2020   "|-".          
-0000e1b0: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-0000e1c0: 2020 2020 2065 6c69 6620 7365 6c66 2e64       elif self.d
-0000e1d0: 6174 615b 2245 4e54 5259 5459 5045 225d  ata["ENTRYTYPE"]
-0000e1e0: 203d 3d20 2269 6e70 726f 6365 6564 696e   == "inproceedin
-0000e1f0: 6773 223a 0a20 2020 2020 2020 2020 2020  gs":.           
-0000e200: 2020 2020 2074 6f63 5f6b 6579 203d 2028       toc_key = (
-0000e210: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e220: 2020 2020 2073 656c 662e 6461 7461 5b22       self.data["
-0000e230: 626f 6f6b 7469 746c 6522 5d0a 2020 2020  booktitle"].    
-0000e240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e250: 2e72 6570 6c61 6365 2822 2022 2c20 222d  .replace(" ", "-
-0000e260: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-0000e270: 2020 2020 2020 202e 7265 706c 6163 6528         .replace(
-0000e280: 225c 5c22 2c20 2222 290a 2020 2020 2020  "\\", "").      
-0000e290: 2020 2020 2020 2020 2020 2020 2020 2e72                .r
-0000e2a0: 6570 6c61 6365 2822 2622 2c20 2261 6e64  eplace("&", "and
-0000e2b0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-0000e2c0: 2020 2020 2020 202e 6c6f 7765 7228 290a         .lower().
-0000e2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e2e0: 2020 2020 2b20 6622 7c7b 7365 6c66 2e64      + f"|{self.d
-0000e2f0: 6174 612e 6765 7428 2779 6561 7227 2c20  ata.get('year', 
-0000e300: 2727 297d 220a 2020 2020 2020 2020 2020  '')}".          
-0000e310: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0000e320: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0000e330: 2020 2020 2020 2020 2020 6d73 6720 3d20            msg = 
-0000e340: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000e350: 2020 2020 2020 6622 454e 5452 5954 5950        f"ENTRYTYP
-0000e360: 4520 7b73 656c 662e 6461 7461 5b27 454e  E {self.data['EN
-0000e370: 5452 5954 5950 4527 5d7d 2022 0a20 2020  TRYTYPE']} ".   
-0000e380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e390: 202b 2066 2228 7b73 656c 662e 6461 7461   + f"({self.data
-0000e3a0: 5b27 4944 275d 7d29 206e 6f74 2074 6f63  ['ID']}) not toc
-0000e3b0: 2d69 6465 6e74 6966 6961 626c 6522 0a20  -identifiable". 
-0000e3c0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-0000e3d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e3e0: 2072 6169 7365 2063 6f6c 7265 765f 6578   raise colrev_ex
-0000e3f0: 6365 7074 696f 6e73 2e4e 6f74 544f 4349  ceptions.NotTOCI
-0000e400: 6465 6e74 6966 6961 626c 6545 7863 6570  dentifiableExcep
-0000e410: 7469 6f6e 286d 7367 290a 2020 2020 2020  tion(msg).      
-0000e420: 2020 6578 6365 7074 204b 6579 4572 726f    except KeyErro
-0000e430: 7220 6173 2065 7863 3a0a 2020 2020 2020  r as exc:.      
-0000e440: 2020 2020 2020 7261 6973 6520 636f 6c72        raise colr
-0000e450: 6576 5f65 7863 6570 7469 6f6e 732e 4e6f  ev_exceptions.No
-0000e460: 7454 4f43 4964 656e 7469 6669 6162 6c65  tTOCIdentifiable
-0000e470: 4578 6365 7074 696f 6e28 0a20 2020 2020  Exception(.     
-0000e480: 2020 2020 2020 2020 2020 2066 226d 6973             f"mis
-0000e490: 7369 6e67 206b 6579 207b 6578 637d 220a  sing key {exc}".
-0000e4a0: 2020 2020 2020 2020 2020 2020 2920 6672              ) fr
-0000e4b0: 6f6d 2065 7863 0a0a 2020 2020 2020 2020  om exc..        
-0000e4c0: 7265 7475 726e 2074 6f63 5f6b 6579 0a0a  return toc_key..
-0000e4d0: 2020 2020 6465 6620 7072 696e 745f 6369      def print_ci
-0000e4e0: 7461 7469 6f6e 5f66 6f72 6d61 7428 7365  tation_format(se
-0000e4f0: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
-0000e500: 2020 2020 2022 2222 5072 696e 7420 7468       """Print th
-0000e510: 6520 7265 636f 7264 2061 7320 6120 6369  e record as a ci
-0000e520: 7461 7469 6f6e 2222 220a 2020 2020 2020  tation""".      
-0000e530: 2020 666f 726d 6174 7465 645f 7265 6620    formatted_ref 
-0000e540: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
-0000e550: 6622 7b73 656c 662e 6461 7461 2e67 6574  f"{self.data.get
-0000e560: 2827 6175 7468 6f72 272c 2027 2729 7d20  ('author', '')} 
-0000e570: 287b 7365 6c66 2e64 6174 612e 6765 7428  ({self.data.get(
-0000e580: 2779 6561 7227 2c20 2727 297d 2920 220a  'year', '')}) ".
-0000e590: 2020 2020 2020 2020 2020 2020 2b20 6622              + f"
-0000e5a0: 7b73 656c 662e 6461 7461 2e67 6574 2827  {self.data.get('
-0000e5b0: 7469 746c 6527 2c20 2727 297d 2e20 220a  title', '')}. ".
-0000e5c0: 2020 2020 2020 2020 2020 2020 2b20 6622              + f"
-0000e5d0: 7b73 656c 662e 6461 7461 2e67 6574 2827  {self.data.get('
-0000e5e0: 6a6f 7572 6e61 6c27 2c20 2727 297d 7b73  journal', '')}{s
-0000e5f0: 656c 662e 6461 7461 2e67 6574 2827 626f  elf.data.get('bo
-0000e600: 6f6b 7469 746c 6527 2c20 2727 297d 2c20  oktitle', '')}, 
-0000e610: 220a 2020 2020 2020 2020 2020 2020 2b20  ".            + 
-0000e620: 6622 7b73 656c 662e 6461 7461 2e67 6574  f"{self.data.get
-0000e630: 2827 766f 6c75 6d65 272c 2027 2729 7d20  ('volume', '')} 
-0000e640: 287b 7365 6c66 2e64 6174 612e 6765 7428  ({self.data.get(
-0000e650: 276e 756d 6265 7227 2c20 2727 297d 2922  'number', '')})"
-0000e660: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
-0000e670: 2020 2070 7269 6e74 2866 6f72 6d61 7474     print(formatt
-0000e680: 6564 5f72 6566 290a 0a20 2020 2064 6566  ed_ref)..    def
-0000e690: 2067 6574 5f74 6569 5f66 696c 656e 616d   get_tei_filenam
-0000e6a0: 6528 7365 6c66 2920 2d3e 2050 6174 683a  e(self) -> Path:
-0000e6b0: 0a20 2020 2020 2020 2022 2222 4765 7420  .        """Get 
-0000e6c0: 7468 6520 5445 4920 6669 6c65 6e61 6d65  the TEI filename
-0000e6d0: 2061 7373 6f63 6961 7465 6420 7769 7468   associated with
-0000e6e0: 2074 6865 2066 696c 6520 2850 4446 2922   the file (PDF)"
-0000e6f0: 2222 0a20 2020 2020 2020 2074 6569 5f66  "".        tei_f
-0000e700: 696c 656e 616d 6520 3d20 5061 7468 2866  ilename = Path(f
-0000e710: 272e 7465 692f 7b73 656c 662e 6461 7461  '.tei/{self.data
-0000e720: 5b22 4944 225d 7d2e 7465 692e 786d 6c27  ["ID"]}.tei.xml'
-0000e730: 290a 2020 2020 2020 2020 6966 2022 6669  ).        if "fi
-0000e740: 6c65 2220 696e 2073 656c 662e 6461 7461  le" in self.data
-0000e750: 3a0a 2020 2020 2020 2020 2020 2020 7465  :.            te
-0000e760: 695f 6669 6c65 6e61 6d65 203d 2050 6174  i_filename = Pat
-0000e770: 6828 0a20 2020 2020 2020 2020 2020 2020  h(.             
-0000e780: 2020 2073 656c 662e 6461 7461 5b22 6669     self.data["fi
-0000e790: 6c65 225d 2e72 6570 6c61 6365 2822 7064  le"].replace("pd
-0000e7a0: 6673 2f22 2c20 222e 7465 692f 2229 0a20  fs/", ".tei/"). 
-0000e7b0: 2020 2020 2020 2020 2020 2029 2e77 6974             ).wit
-0000e7c0: 685f 7375 6666 6978 2822 2e74 6569 2e78  h_suffix(".tei.x
-0000e7d0: 6d6c 2229 0a20 2020 2020 2020 2072 6574  ml").        ret
-0000e7e0: 7572 6e20 7465 695f 6669 6c65 6e61 6d65  urn tei_filename
-0000e7f0: 0a0a 2020 2020 4063 6c61 7373 6d65 7468  ..    @classmeth
-0000e800: 6f64 0a20 2020 2064 6566 2070 7269 6e74  od.    def print
-0000e810: 5f64 6966 665f 7061 6972 2863 6c73 2c20  _diff_pair(cls, 
-0000e820: 2a2c 2072 6563 6f72 645f 7061 6972 3a20  *, record_pair: 
-0000e830: 6c69 7374 2c20 6b65 7973 3a20 6c69 7374  list, keys: list
-0000e840: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-0000e850: 2020 2022 2222 5072 696e 7420 7468 6520     """Print the 
-0000e860: 6469 6666 2062 6574 7765 656e 2074 776f  diff between two
-0000e870: 2072 6563 6f72 6473 2222 220a 0a20 2020   records"""..   
-0000e880: 2020 2020 2064 6566 2070 7269 6e74 5f64       def print_d
-0000e890: 6966 6628 6368 616e 6765 3a20 7475 706c  iff(change: tupl
-0000e8a0: 6529 202d 3e20 7374 723a 0a20 2020 2020  e) -> str:.     
-0000e8b0: 2020 2020 2020 2064 6966 6620 3d20 6469         diff = di
-0000e8c0: 6666 6c69 622e 4469 6666 6572 2829 0a20  fflib.Differ(). 
-0000e8d0: 2020 2020 2020 2020 2020 206c 6574 7465             lette
-0000e8e0: 7273 203d 206c 6973 7428 6469 6666 2e63  rs = list(diff.c
-0000e8f0: 6f6d 7061 7265 2863 6861 6e67 655b 315d  ompare(change[1]
-0000e900: 2c20 6368 616e 6765 5b30 5d29 290a 2020  , change[0])).  
-0000e910: 2020 2020 2020 2020 2020 666f 7220 692c            for i,
-0000e920: 206c 6574 7465 7220 696e 2065 6e75 6d65   letter in enume
-0000e930: 7261 7465 286c 6574 7465 7273 293a 0a20  rate(letters):. 
-0000e940: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0000e950: 6620 6c65 7474 6572 2e73 7461 7274 7377  f letter.startsw
-0000e960: 6974 6828 2220 2022 293a 0a20 2020 2020  ith("  "):.     
-0000e970: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-0000e980: 6574 7465 7273 5b69 5d20 3d20 6c65 7474  etters[i] = lett
-0000e990: 6572 735b 695d 5b2d 315d 0a20 2020 2020  ers[i][-1].     
-0000e9a0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-0000e9b0: 6c65 7474 6572 2e73 7461 7274 7377 6974  letter.startswit
-0000e9c0: 6828 222b 2022 293a 0a20 2020 2020 2020  h("+ "):.       
-0000e9d0: 2020 2020 2020 2020 2020 2020 206c 6574               let
-0000e9e0: 7465 7273 5b69 5d20 3d20 6622 7b63 6f6c  ters[i] = f"{col
-0000e9f0: 6f72 732e 5245 447d 2220 2b20 6c65 7474  ors.RED}" + lett
-0000ea00: 6572 735b 695d 5b2d 315d 202b 2066 227b  ers[i][-1] + f"{
-0000ea10: 636f 6c6f 7273 2e45 4e44 7d22 0a20 2020  colors.END}".   
-0000ea20: 2020 2020 2020 2020 2020 2020 2065 6c69               eli
-0000ea30: 6620 6c65 7474 6572 2e73 7461 7274 7377  f letter.startsw
-0000ea40: 6974 6828 222d 2022 293a 0a20 2020 2020  ith("- "):.     
-0000ea50: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-0000ea60: 6574 7465 7273 5b69 5d20 3d20 6622 7b63  etters[i] = f"{c
-0000ea70: 6f6c 6f72 732e 4752 4545 4e7d 2220 2b20  olors.GREEN}" + 
-0000ea80: 6c65 7474 6572 735b 695d 5b2d 315d 202b  letters[i][-1] +
-0000ea90: 2066 227b 636f 6c6f 7273 2e45 4e44 7d22   f"{colors.END}"
-0000eaa0: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
-0000eab0: 203d 2022 222e 6a6f 696e 286c 6574 7465   = "".join(lette
-0000eac0: 7273 292e 7265 706c 6163 6528 225c 6e22  rs).replace("\n"
-0000ead0: 2c20 2220 2229 0a20 2020 2020 2020 2020  , " ").         
-0000eae0: 2020 2072 6574 7572 6e20 7265 730a 0a20     return res.. 
-0000eaf0: 2020 2020 2020 2066 6f72 206b 6579 2069         for key i
-0000eb00: 6e20 6b65 7973 3a0a 2020 2020 2020 2020  n keys:.        
-0000eb10: 2020 2020 7072 6576 5f76 616c 203d 2022      prev_val = "
-0000eb20: 5f46 4952 5354 5f56 414c 220a 2020 2020  _FIRST_VAL".    
-0000eb30: 2020 2020 2020 2020 666f 7220 7265 6320          for rec 
-0000eb40: 696e 2072 6563 6f72 645f 7061 6972 3a0a  in record_pair:.
-0000eb50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000eb60: 6966 2070 7265 765f 7661 6c20 3d3d 2072  if prev_val == r
-0000eb70: 6563 2e67 6574 286b 6579 2c20 2222 2920  ec.get(key, "") 
-0000eb80: 6f72 2070 7265 765f 7661 6c20 3d3d 2022  or prev_val == "
-0000eb90: 5f46 4952 5354 5f56 414c 223a 0a20 2020  _FIRST_VAL":.   
-0000eba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ebb0: 206c 696e 6520 3d20 6622 7b72 6563 2e67   line = f"{rec.g
-0000ebc0: 6574 286b 6579 2c20 2727 297d 220a 2020  et(key, '')}".  
-0000ebd0: 2020 2020 2020 2020 2020 2020 2020 656c                el
-0000ebe0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0000ebf0: 2020 2020 2020 2020 7369 6d69 6c61 7269          similari
-0000ec00: 7479 203d 2030 2e30 0a20 2020 2020 2020  ty = 0.0.       
-0000ec10: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0000ec20: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000ec30: 2020 2020 2020 2020 2020 7072 6576 5f76            prev_v
-0000ec40: 616c 2069 7320 6e6f 7420 4e6f 6e65 0a20  al is not None. 
-0000ec50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ec60: 2020 2020 2020 2061 6e64 2072 6563 2e67         and rec.g
-0000ec70: 6574 286b 6579 2c20 2222 2920 213d 2022  et(key, "") != "
-0000ec80: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0000ec90: 2020 2020 2020 2020 2020 616e 6420 7072            and pr
-0000eca0: 6576 5f76 616c 2021 3d20 2222 0a20 2020  ev_val != "".   
-0000ecb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ecc0: 2020 2020 2061 6e64 2072 6563 5b6b 6579       and rec[key
-0000ecd0: 5d20 6973 206e 6f74 204e 6f6e 650a 2020  ] is not None.  
-0000ece0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ecf0: 2020 293a 0a20 2020 2020 2020 2020 2020    ):.           
-0000ed00: 2020 2020 2020 2020 2020 2020 2073 696d               sim
-0000ed10: 696c 6172 6974 7920 3d20 6675 7a7a 2e70  ilarity = fuzz.p
-0000ed20: 6172 7469 616c 5f72 6174 696f 2870 7265  artial_ratio(pre
-0000ed30: 765f 7661 6c2c 2072 6563 5b6b 6579 5d29  v_val, rec[key])
-0000ed40: 202f 2031 3030 0a20 2020 2020 2020 2020   / 100.         
-0000ed50: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0000ed60: 204e 6f74 6520 3a20 7468 6520 6675 7a7a   Note : the fuzz
-0000ed70: 2e70 6172 7469 616c 5f72 6174 696f 2077  .partial_ratio w
-0000ed80: 6f72 6b73 2062 6574 7465 7220 666f 7220  orks better for 
-0000ed90: 7061 7274 6961 6c20 7375 6273 7472 696e  partial substrin
-0000eda0: 6773 0a20 2020 2020 2020 2020 2020 2020  gs.             
-0000edb0: 2020 2020 2020 2020 2020 2023 2066 726f             # fro
-0000edc0: 6d20 6469 6666 6c69 6220 696d 706f 7274  m difflib import
-0000edd0: 2053 6571 7565 6e63 654d 6174 6368 6572   SequenceMatcher
-0000ede0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000edf0: 2020 2020 2020 2020 2023 2073 696d 696c           # simil
-0000ee00: 6172 6974 7920 3d20 5365 7175 656e 6365  arity = Sequence
-0000ee10: 4d61 7463 6865 7228 4e6f 6e65 2c20 7072  Matcher(None, pr
-0000ee20: 6576 5f76 616c 2c20 7265 635b 6b65 795d  ev_val, rec[key]
-0000ee30: 292e 7261 7469 6f28 290a 2020 2020 2020  ).ratio().      
-0000ee40: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0000ee50: 2073 696d 696c 6172 6974 7920 3c20 302e   similarity < 0.
-0000ee60: 3520 6f72 206b 6579 2069 6e20 5b0a 2020  5 or key in [.  
-0000ee70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ee80: 2020 2020 2020 2276 6f6c 756d 6522 2c0a        "volume",.
-0000ee90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000eea0: 2020 2020 2020 2020 226e 756d 6265 7222          "number"
-0000eeb0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000eec0: 2020 2020 2020 2020 2020 2279 6561 7222            "year"
-0000eed0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000eee0: 2020 2020 2020 5d3a 0a20 2020 2020 2020        ]:.       
-0000eef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ef00: 206c 696e 6520 3d20 6622 7b63 6f6c 6f72   line = f"{color
-0000ef10: 732e 5245 447d 7b72 6563 2e67 6574 286b  s.RED}{rec.get(k
-0000ef20: 6579 2c20 2727 297d 7b63 6f6c 6f72 732e  ey, '')}{colors.
-0000ef30: 454e 447d 220a 2020 2020 2020 2020 2020  END}".          
-0000ef40: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-0000ef50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ef60: 2020 2020 2020 2020 6c69 6e65 203d 2070          line = p
-0000ef70: 7269 6e74 5f64 6966 6628 2870 7265 765f  rint_diff((prev_
-0000ef80: 7661 6c2c 2072 6563 2e67 6574 286b 6579  val, rec.get(key
-0000ef90: 2c20 2222 2929 290a 2020 2020 2020 2020  , ""))).        
-0000efa0: 2020 2020 2020 2020 7072 696e 7428 6622          print(f"
-0000efb0: 7b6b 6579 7d20 3a20 7b6c 696e 657d 2229  {key} : {line}")
-0000efc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000efd0: 2070 7265 765f 7661 6c20 3d20 7265 632e   prev_val = rec.
-0000efe0: 6765 7428 6b65 792c 2022 2229 0a20 2020  get(key, "").   
-0000eff0: 2020 2020 2020 2020 2070 7269 6e74 2829           print()
-0000f000: 0a0a 2020 2020 6465 6620 636c 6561 6e75  ..    def cleanu
-0000f010: 705f 7064 665f 7072 6f63 6573 7369 6e67  p_pdf_processing
-0000f020: 5f66 6965 6c64 7328 7365 6c66 2920 2d3e  _fields(self) ->
-0000f030: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
-0000f040: 2222 436c 6561 6e75 7020 7468 6520 5044  ""Cleanup the PD
-0000f050: 4620 7072 6f63 6573 7369 6e67 2066 6965  F processing fie
-0000f060: 6c73 2028 7465 7874 5f66 726f 6d5f 7064  ls (text_from_pd
-0000f070: 662c 2070 6167 6573 5f69 6e5f 6669 6c65  f, pages_in_file
-0000f080: 2922 2222 0a20 2020 2020 2020 2069 6620  )""".        if 
-0000f090: 2274 6578 745f 6672 6f6d 5f70 6466 2220  "text_from_pdf" 
-0000f0a0: 696e 2073 656c 662e 6461 7461 3a0a 2020  in self.data:.  
-0000f0b0: 2020 2020 2020 2020 2020 6465 6c20 7365            del se
-0000f0c0: 6c66 2e64 6174 615b 2274 6578 745f 6672  lf.data["text_fr
-0000f0d0: 6f6d 5f70 6466 225d 0a20 2020 2020 2020  om_pdf"].       
-0000f0e0: 2069 6620 2270 6167 6573 5f69 6e5f 6669   if "pages_in_fi
-0000f0f0: 6c65 2220 696e 2073 656c 662e 6461 7461  le" in self.data
-0000f100: 3a0a 2020 2020 2020 2020 2020 2020 6465  :.            de
-0000f110: 6c20 7365 6c66 2e64 6174 615b 2270 6167  l self.data["pag
-0000f120: 6573 5f69 6e5f 6669 6c65 225d 0a0a 2020  es_in_file"]..  
-0000f130: 2020 6465 6620 7570 6461 7465 5f6d 6173    def update_mas
-0000f140: 7465 7264 6174 615f 7072 6f76 656e 616e  terdata_provenan
-0000f150: 6365 280a 2020 2020 2020 2020 7365 6c66  ce(.        self
-0000f160: 2c20 2a2c 2071 6d3a 2063 6f6c 7265 762e  , *, qm: colrev.
-0000f170: 716d 2e71 7561 6c69 7479 5f6d 6f64 656c  qm.quality_model
-0000f180: 2e51 7561 6c69 7479 4d6f 6465 6c2c 2073  .QualityModel, s
-0000f190: 6574 5f70 7265 7061 7265 643a 2062 6f6f  et_prepared: boo
-0000f1a0: 6c20 3d20 4661 6c73 650a 2020 2020 2920  l = False.    ) 
-0000f1b0: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-0000f1c0: 2022 2222 5570 6461 7465 2074 6865 206d   """Update the m
-0000f1d0: 6173 7465 7264 6174 6120 7072 6f76 656e  asterdata proven
-0000f1e0: 616e 6365 2222 220a 0a20 2020 2020 2020  ance"""..       
-0000f1f0: 2069 6620 2263 6f6c 7265 765f 6d61 7374   if "colrev_mast
-0000f200: 6572 6461 7461 5f70 726f 7665 6e61 6e63  erdata_provenanc
-0000f210: 6522 206e 6f74 2069 6e20 7365 6c66 2e64  e" not in self.d
-0000f220: 6174 613a 0a20 2020 2020 2020 2020 2020  ata:.           
-0000f230: 2073 656c 662e 6461 7461 5b22 636f 6c72   self.data["colr
-0000f240: 6576 5f6d 6173 7465 7264 6174 615f 7072  ev_masterdata_pr
-0000f250: 6f76 656e 616e 6365 225d 203d 207b 7d0a  ovenance"] = {}.
-0000f260: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-0000f270: 2e6d 6173 7465 7264 6174 615f 6973 5f63  .masterdata_is_c
-0000f280: 7572 6174 6564 2829 3a0a 2020 2020 2020  urated():.      
-0000f290: 2020 2020 2020 7265 7475 726e 0a0a 2020        return..  
-0000f2a0: 2020 2020 2020 2320 4170 706c 7920 7468        # Apply th
-0000f2b0: 6520 6368 6563 6b65 7273 2028 696e 636c  e checkers (incl
-0000f2c0: 7564 696e 6720 6669 656c 6420 6b65 7920  uding field key 
-0000f2d0: 7265 7175 6972 656d 656e 7473 2065 7463  requirements etc
-0000f2e0: 2e29 0a20 2020 2020 2020 2071 6d2e 7275  .).        qm.ru
-0000f2f0: 6e28 7265 636f 7264 3d73 656c 6629 0a0a  n(record=self)..
-0000f300: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-0000f310: 6861 735f 7175 616c 6974 795f 6465 6665  has_quality_defe
-0000f320: 6374 7328 293a 0a20 2020 2020 2020 2020  cts():.         
-0000f330: 2020 2073 656c 662e 7365 745f 7374 6174     self.set_stat
-0000f340: 7573 2874 6172 6765 745f 7374 6174 653d  us(target_state=
-0000f350: 5265 636f 7264 5374 6174 652e 6d64 5f6e  RecordState.md_n
-0000f360: 6565 6473 5f6d 616e 7561 6c5f 7072 6570  eeds_manual_prep
-0000f370: 6172 6174 696f 6e29 0a20 2020 2020 2020  aration).       
-0000f380: 2065 6c69 6620 7365 745f 7072 6570 6172   elif set_prepar
-0000f390: 6564 3a0a 2020 2020 2020 2020 2020 2020  ed:.            
-0000f3a0: 7365 6c66 2e73 6574 5f73 7461 7475 7328  self.set_status(
-0000f3b0: 7461 7267 6574 5f73 7461 7465 3d52 6563  target_state=Rec
-0000f3c0: 6f72 6453 7461 7465 2e6d 645f 7072 6570  ordState.md_prep
-0000f3d0: 6172 6564 290a 0a20 2020 2064 6566 2063  ared)..    def c
-0000f3e0: 6865 636b 5f70 6f74 656e 7469 616c 5f72  heck_potential_r
-0000f3f0: 6574 7261 6374 7328 7365 6c66 2920 2d3e  etracts(self) ->
-0000f400: 2062 6f6f 6c3a 0a20 2020 2020 2020 2022   bool:.        "
-0000f410: 2222 4368 6563 6b20 666f 7220 706f 7465  ""Check for pote
-0000f420: 6e74 6961 6c20 7265 7472 6163 7473 2222  ntial retracts""
-0000f430: 220a 2020 2020 2020 2020 2320 4e6f 7465  ".        # Note
-0000f440: 203a 2077 6520 7265 7472 6965 7665 6420   : we retrieved 
-0000f450: 6d65 7461 6461 7461 2069 6e20 6765 745f  metadata in get_
-0000f460: 6d61 7374 6572 6461 7461 5f66 726f 6d5f  masterdata_from_
-0000f470: 6372 6f73 7372 6566 2829 0a20 2020 2020  crossref().     
-0000f480: 2020 2069 6620 7365 6c66 2e64 6174 612e     if self.data.
-0000f490: 6765 7428 2263 726f 7373 6d61 726b 222c  get("crossmark",
-0000f4a0: 2022 2229 203d 3d20 2254 7275 6522 3a0a   "") == "True":.
-0000f4b0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000f4c0: 2e70 7265 7363 7265 656e 5f65 7863 6c75  .prescreen_exclu
-0000f4d0: 6465 2872 6561 736f 6e3d 2272 6574 7261  de(reason="retra
-0000f4e0: 6374 6564 222c 2070 7269 6e74 5f77 6172  cted", print_war
-0000f4f0: 6e69 6e67 3d54 7275 6529 0a20 2020 2020  ning=True).     
-0000f500: 2020 2020 2020 2073 656c 662e 7265 6d6f         self.remo
-0000f510: 7665 5f66 6965 6c64 286b 6579 3d22 6372  ve_field(key="cr
-0000f520: 6f73 736d 6172 6b22 290a 2020 2020 2020  ossmark").      
-0000f530: 2020 2020 2020 7265 7475 726e 2054 7275        return Tru
-0000f540: 650a 2020 2020 2020 2020 6966 2073 656c  e.        if sel
-0000f550: 662e 6461 7461 2e67 6574 2822 7761 726e  f.data.get("warn
-0000f560: 696e 6722 2c20 2222 2920 3d3d 2022 5769  ing", "") == "Wi
-0000f570: 7468 6472 6177 6e20 2861 6363 6f72 6469  thdrawn (accordi
-0000f580: 6e67 2074 6f20 4442 4c50 2922 3a0a 2020  ng to DBLP)":.  
-0000f590: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
-0000f5a0: 7265 7363 7265 656e 5f65 7863 6c75 6465  rescreen_exclude
-0000f5b0: 2872 6561 736f 6e3d 2272 6574 7261 6374  (reason="retract
-0000f5c0: 6564 222c 2070 7269 6e74 5f77 6172 6e69  ed", print_warni
-0000f5d0: 6e67 3d54 7275 6529 0a20 2020 2020 2020  ng=True).       
-0000f5e0: 2020 2020 2073 656c 662e 7265 6d6f 7665       self.remove
-0000f5f0: 5f66 6965 6c64 286b 6579 3d22 7761 726e  _field(key="warn
-0000f600: 696e 6722 290a 2020 2020 2020 2020 2020  ing").          
-0000f610: 2020 7265 7475 726e 2054 7275 650a 2020    return True.  
-0000f620: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
-0000f630: 7365 0a0a 2020 2020 6465 6620 7072 696e  se..    def prin
-0000f640: 745f 7072 6573 6372 6565 6e5f 7265 636f  t_prescreen_reco
-0000f650: 7264 2873 656c 6629 202d 3e20 4e6f 6e65  rd(self) -> None
-0000f660: 3a0a 2020 2020 2020 2020 2222 2250 7269  :.        """Pri
-0000f670: 6e74 2074 6865 2072 6563 6f72 6420 666f  nt the record fo
-0000f680: 7220 7072 6573 6372 6565 6e20 6f70 6572  r prescreen oper
-0000f690: 6174 696f 6e73 2222 220a 0a20 2020 2020  ations"""..     
-0000f6a0: 2020 2072 6574 5f73 7472 203d 2066 2220     ret_str = f" 
-0000f6b0: 2049 443a 207b 7365 6c66 2e64 6174 615b   ID: {self.data[
-0000f6c0: 2749 4427 5d7d 2028 7b73 656c 662e 6461  'ID']} ({self.da
-0000f6d0: 7461 5b27 454e 5452 5954 5950 4527 5d7d  ta['ENTRYTYPE']}
-0000f6e0: 2922 0a20 2020 2020 2020 2072 6574 5f73  )".        ret_s
-0000f6f0: 7472 202b 3d20 280a 2020 2020 2020 2020  tr += (.        
-0000f700: 2020 2020 6622 5c6e 2020 7b63 6f6c 6f72      f"\n  {color
-0000f710: 732e 4752 4545 4e7d 7b73 656c 662e 6461  s.GREEN}{self.da
-0000f720: 7461 2e67 6574 2827 7469 746c 6527 2c20  ta.get('title', 
-0000f730: 276e 6f20 7469 746c 6527 297d 7b63 6f6c  'no title')}{col
-0000f740: 6f72 732e 454e 447d 220a 2020 2020 2020  ors.END}".      
-0000f750: 2020 2020 2020 6622 5c6e 2020 7b73 656c        f"\n  {sel
-0000f760: 662e 6461 7461 2e67 6574 2827 6175 7468  f.data.get('auth
-0000f770: 6f72 272c 2027 6e6f 2d61 7574 686f 7227  or', 'no-author'
-0000f780: 297d 220a 2020 2020 2020 2020 290a 2020  )}".        ).  
-0000f790: 2020 2020 2020 6966 2073 656c 662e 6461        if self.da
-0000f7a0: 7461 5b22 454e 5452 5954 5950 4522 5d20  ta["ENTRYTYPE"] 
-0000f7b0: 3d3d 2022 6172 7469 636c 6522 3a0a 2020  == "article":.  
-0000f7c0: 2020 2020 2020 2020 2020 7265 745f 7374            ret_st
-0000f7d0: 7220 2b3d 2028 0a20 2020 2020 2020 2020  r += (.         
-0000f7e0: 2020 2020 2020 2066 225c 6e20 207b 7365         f"\n  {se
-0000f7f0: 6c66 2e64 6174 612e 6765 7428 276a 6f75  lf.data.get('jou
-0000f800: 726e 616c 272c 2027 6e6f 2d6a 6f75 726e  rnal', 'no-journ
-0000f810: 616c 2729 7d20 220a 2020 2020 2020 2020  al')} ".        
-0000f820: 2020 2020 2020 2020 6622 287b 7365 6c66          f"({self
-0000f830: 2e64 6174 612e 6765 7428 2779 6561 7227  .data.get('year'
-0000f840: 2c20 276e 6f2d 7965 6172 2729 7d29 2022  , 'no-year')}) "
-0000f850: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f860: 2066 227b 7365 6c66 2e64 6174 612e 6765   f"{self.data.ge
-0000f870: 7428 2776 6f6c 756d 6527 2c20 276e 6f2d  t('volume', 'no-
-0000f880: 766f 6c75 6d65 2729 7d22 0a20 2020 2020  volume')}".     
-0000f890: 2020 2020 2020 2020 2020 2066 2228 7b73             f"({s
-0000f8a0: 656c 662e 6461 7461 2e67 6574 2827 6e75  elf.data.get('nu
-0000f8b0: 6d62 6572 272c 2027 2729 7d29 220a 2020  mber', '')})".  
-0000f8c0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-0000f8d0: 2020 2020 656c 6966 2073 656c 662e 6461      elif self.da
-0000f8e0: 7461 5b22 454e 5452 5954 5950 4522 5d20  ta["ENTRYTYPE"] 
-0000f8f0: 3d3d 2022 696e 7072 6f63 6565 6469 6e67  == "inproceeding
-0000f900: 7322 3a0a 2020 2020 2020 2020 2020 2020  s":.            
-0000f910: 7265 745f 7374 7220 2b3d 2066 225c 6e20  ret_str += f"\n 
-0000f920: 207b 7365 6c66 2e64 6174 612e 6765 7428   {self.data.get(
-0000f930: 2762 6f6f 6b74 6974 6c65 272c 2027 6e6f  'booktitle', 'no
-0000f940: 2d62 6f6f 6b74 6974 6c65 2729 7d22 0a20  -booktitle')}". 
-0000f950: 2020 2020 2020 2069 6620 2261 6273 7472         if "abstr
-0000f960: 6163 7422 2069 6e20 7365 6c66 2e64 6174  act" in self.dat
-0000f970: 613a 0a20 2020 2020 2020 2020 2020 206c  a:.            l
-0000f980: 696e 6573 203d 2074 6578 7477 7261 702e  ines = textwrap.
-0000f990: 7772 6170 2873 656c 662e 6461 7461 5b22  wrap(self.data["
-0000f9a0: 6162 7374 7261 6374 225d 2c20 3130 302c  abstract"], 100,
-0000f9b0: 2062 7265 616b 5f6c 6f6e 675f 776f 7264   break_long_word
-0000f9c0: 733d 4661 6c73 6529 0a20 2020 2020 2020  s=False).       
-0000f9d0: 2020 2020 2069 6620 6c69 6e65 733a 0a20       if lines:. 
-0000f9e0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000f9f0: 6574 5f73 7472 202b 3d20 6622 5c6e 2020  et_str += f"\n  
-0000fa00: 4162 7374 7261 6374 3a20 7b6c 696e 6573  Abstract: {lines
-0000fa10: 2e70 6f70 2830 297d 5c6e 220a 2020 2020  .pop(0)}\n".    
-0000fa20: 2020 2020 2020 2020 2020 2020 7265 745f              ret_
-0000fa30: 7374 7220 2b3d 2022 5c6e 2020 222e 6a6f  str += "\n  ".jo
-0000fa40: 696e 286c 696e 6573 2920 2b20 2222 0a0a  in(lines) + ""..
-0000fa50: 2020 2020 2020 2020 6966 2022 7572 6c22          if "url"
-0000fa60: 2069 6e20 7365 6c66 2e64 6174 613a 0a20   in self.data:. 
-0000fa70: 2020 2020 2020 2020 2020 2072 6574 5f73             ret_s
-0000fa80: 7472 202b 3d20 6622 5c6e 2020 7572 6c3a  tr += f"\n  url:
-0000fa90: 207b 7365 6c66 2e64 6174 615b 2775 726c   {self.data['url
-0000faa0: 275d 7d22 0a0a 2020 2020 2020 2020 6966  ']}"..        if
-0000fab0: 2022 6669 6c65 2220 696e 2073 656c 662e   "file" in self.
-0000fac0: 6461 7461 3a0a 2020 2020 2020 2020 2020  data:.          
-0000fad0: 2020 7265 745f 7374 7220 2b3d 2066 225c    ret_str += f"\
-0000fae0: 6e20 2066 696c 653a 207b 7365 6c66 2e64  n  file: {self.d
-0000faf0: 6174 615b 2766 696c 6527 5d7d 220a 0a20  ata['file']}".. 
-0000fb00: 2020 2020 2020 2070 7269 6e74 2872 6574         print(ret
-0000fb10: 5f73 7472 290a 0a20 2020 2064 6566 2070  _str)..    def p
-0000fb20: 7269 6e74 5f70 6466 5f70 7265 705f 6d61  rint_pdf_prep_ma
-0000fb30: 6e28 7365 6c66 2920 2d3e 204e 6f6e 653a  n(self) -> None:
-0000fb40: 0a20 2020 2020 2020 2022 2222 5072 696e  .        """Prin
-0000fb50: 7420 7468 6520 7265 636f 7264 2066 6f72  t the record for
-0000fb60: 2070 6466 2d70 7265 702d 6d61 6e20 6f70   pdf-prep-man op
-0000fb70: 6572 6174 696f 6e73 2222 220a 2020 2020  erations""".    
-0000fb80: 2020 2020 2320 7079 6c69 6e74 3a20 6469      # pylint: di
-0000fb90: 7361 626c 653d 746f 6f2d 6d61 6e79 2d62  sable=too-many-b
-0000fba0: 7261 6e63 6865 730a 2020 2020 2020 2020  ranches.        
-0000fbb0: 7265 745f 7374 7220 3d20 2222 0a20 2020  ret_str = "".   
-0000fbc0: 2020 2020 2069 6620 2266 696c 6522 2069       if "file" i
-0000fbd0: 6e20 7365 6c66 2e64 6174 613a 0a20 2020  n self.data:.   
-0000fbe0: 2020 2020 2020 2020 2072 6574 5f73 7472           ret_str
-0000fbf0: 202b 3d20 6622 5c6e 6669 6c65 3a20 7b63   += f"\nfile: {c
-0000fc00: 6f6c 6f72 732e 4f52 414e 4745 7d7b 7365  olors.ORANGE}{se
-0000fc10: 6c66 2e64 6174 615b 2766 696c 6527 5d7d  lf.data['file']}
-0000fc20: 7b63 6f6c 6f72 732e 454e 447d 5c6e 5c6e  {colors.END}\n\n
-0000fc30: 220a 0a20 2020 2020 2020 2070 6466 5f70  "..        pdf_p
-0000fc40: 7265 705f 6e6f 7465 203d 2073 656c 662e  rep_note = self.
-0000fc50: 6765 745f 6669 656c 645f 7072 6f76 656e  get_field_proven
-0000fc60: 616e 6365 286b 6579 3d22 6669 6c65 2229  ance(key="file")
-0000fc70: 0a0a 2020 2020 2020 2020 6966 2022 6175  ..        if "au
-0000fc80: 7468 6f72 5f6e 6f74 5f69 6e5f 6669 7273  thor_not_in_firs
-0000fc90: 745f 7061 6765 7322 2069 6e20 7064 665f  t_pages" in pdf_
-0000fca0: 7072 6570 5f6e 6f74 655b 226e 6f74 6522  prep_note["note"
-0000fcb0: 5d3a 0a20 2020 2020 2020 2020 2020 2072  ]:.            r
-0000fcc0: 6574 5f73 7472 202b 3d20 280a 2020 2020  et_str += (.    
-0000fcd0: 2020 2020 2020 2020 2020 2020 6622 7b63              f"{c
-0000fce0: 6f6c 6f72 732e 5245 447d 7b73 656c 662e  olors.RED}{self.
-0000fcf0: 6461 7461 2e67 6574 2827 6175 7468 6f72  data.get('author
-0000fd00: 272c 2027 6e6f 2d61 7574 686f 7227 297d  ', 'no-author')}
-0000fd10: 7b63 6f6c 6f72 732e 454e 447d 5c6e 220a  {colors.END}\n".
-0000fd20: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-0000fd30: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0000fd40: 2020 2020 2020 2020 7265 745f 7374 7220          ret_str 
-0000fd50: 2b3d 2028 0a20 2020 2020 2020 2020 2020  += (.           
-0000fd60: 2020 2020 2066 227b 636f 6c6f 7273 2e47       f"{colors.G
-0000fd70: 5245 454e 7d7b 7365 6c66 2e64 6174 612e  REEN}{self.data.
-0000fd80: 6765 7428 2761 7574 686f 7227 2c20 276e  get('author', 'n
-0000fd90: 6f2d 6175 7468 6f72 2729 7d7b 636f 6c6f  o-author')}{colo
-0000fda0: 7273 2e45 4e44 7d5c 6e22 0a20 2020 2020  rs.END}\n".     
-0000fdb0: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-0000fdc0: 2020 6966 2022 7469 746c 655f 6e6f 745f    if "title_not_
-0000fdd0: 696e 5f66 6972 7374 5f70 6167 6573 2220  in_first_pages" 
-0000fde0: 696e 2070 6466 5f70 7265 705f 6e6f 7465  in pdf_prep_note
-0000fdf0: 5b22 6e6f 7465 225d 3a0a 2020 2020 2020  ["note"]:.      
-0000fe00: 2020 2020 2020 7265 745f 7374 7220 2b3d        ret_str +=
-0000fe10: 2066 227b 636f 6c6f 7273 2e52 4544 7d7b   f"{colors.RED}{
-0000fe20: 7365 6c66 2e64 6174 612e 6765 7428 2774  self.data.get('t
-0000fe30: 6974 6c65 272c 2027 6e6f 2074 6974 6c65  itle', 'no title
-0000fe40: 2729 7d7b 636f 6c6f 7273 2e45 4e44 7d5c  ')}{colors.END}\
-0000fe50: 6e22 0a20 2020 2020 2020 2065 6c73 653a  n".        else:
-0000fe60: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0000fe70: 5f73 7472 202b 3d20 280a 2020 2020 2020  _str += (.      
-0000fe80: 2020 2020 2020 2020 2020 6622 7b63 6f6c            f"{col
-0000fe90: 6f72 732e 4752 4545 4e7d 7b73 656c 662e  ors.GREEN}{self.
-0000fea0: 6461 7461 2e67 6574 2827 7469 746c 6527  data.get('title'
-0000feb0: 2c20 276e 6f20 7469 746c 6527 297d 7b63  , 'no title')}{c
-0000fec0: 6f6c 6f72 732e 454e 447d 5c6e 220a 2020  olors.END}\n".  
-0000fed0: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
-0000fee0: 2020 2020 2069 6620 7365 6c66 2e64 6174       if self.dat
-0000fef0: 615b 2245 4e54 5259 5459 5045 225d 203d  a["ENTRYTYPE"] =
-0000ff00: 3d20 2261 7274 6963 6c65 223a 0a20 2020  = "article":.   
-0000ff10: 2020 2020 2020 2020 2072 6574 5f73 7472           ret_str
-0000ff20: 202b 3d20 280a 2020 2020 2020 2020 2020   += (.          
-0000ff30: 2020 2020 2020 6622 7b73 656c 662e 6461        f"{self.da
-0000ff40: 7461 2e67 6574 2827 6a6f 7572 6e61 6c27  ta.get('journal'
-0000ff50: 2c20 276e 6f2d 6a6f 7572 6e61 6c27 297d  , 'no-journal')}
-0000ff60: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
-0000ff70: 2020 2066 2228 7b73 656c 662e 6461 7461     f"({self.data
-0000ff80: 2e67 6574 2827 7965 6172 272c 2027 6e6f  .get('year', 'no
-0000ff90: 2d79 6561 7227 297d 2920 220a 2020 2020  -year')}) ".    
-0000ffa0: 2020 2020 2020 2020 2020 2020 6622 7b73              f"{s
-0000ffb0: 656c 662e 6461 7461 2e67 6574 2827 766f  elf.data.get('vo
-0000ffc0: 6c75 6d65 272c 2027 6e6f 2d76 6f6c 756d  lume', 'no-volum
-0000ffd0: 6527 297d 220a 2020 2020 2020 2020 2020  e')}".          
-0000ffe0: 2020 2020 2020 6622 287b 7365 6c66 2e64        f"({self.d
-0000fff0: 6174 612e 6765 7428 276e 756d 6265 7227  ata.get('number'
-00010000: 2c20 2727 297d 2922 0a20 2020 2020 2020  , '')})".       
-00010010: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-00010020: 2020 2069 6620 2270 6167 6573 2220 696e     if "pages" in
-00010030: 2073 656c 662e 6461 7461 3a0a 2020 2020   self.data:.    
-00010040: 2020 2020 2020 2020 2020 2020 6966 2022              if "
-00010050: 6e72 5f70 6167 6573 5f6e 6f74 5f6d 6174  nr_pages_not_mat
-00010060: 6368 696e 6722 2069 6e20 7064 665f 7072  ching" in pdf_pr
-00010070: 6570 5f6e 6f74 655b 226e 6f74 6522 5d3a  ep_note["note"]:
-00010080: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010090: 2020 2020 2072 6574 5f73 7472 202b 3d20       ret_str += 
-000100a0: 6622 2c20 7b63 6f6c 6f72 732e 5245 447d  f", {colors.RED}
-000100b0: 7070 2e7b 7365 6c66 2e64 6174 615b 2770  pp.{self.data['p
-000100c0: 6167 6573 275d 7d7b 636f 6c6f 7273 2e45  ages']}{colors.E
-000100d0: 4e44 7d5c 6e22 0a20 2020 2020 2020 2020  ND}\n".         
-000100e0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-000100f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010100: 2072 6574 5f73 7472 202b 3d20 6622 2c20   ret_str += f", 
-00010110: 7070 2e7b 636f 6c6f 7273 2e47 5245 454e  pp.{colors.GREEN
-00010120: 7d7b 7365 6c66 2e64 6174 615b 2770 6167  }{self.data['pag
-00010130: 6573 275d 7d7b 636f 6c6f 7273 2e45 4e44  es']}{colors.END
-00010140: 7d5c 6e22 0a20 2020 2020 2020 2020 2020  }\n".           
-00010150: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00010160: 2020 2020 2020 2072 6574 5f73 7472 202b         ret_str +
-00010170: 3d20 225c 6e22 0a20 2020 2020 2020 2065  = "\n".        e
-00010180: 6c69 6620 7365 6c66 2e64 6174 615b 2245  lif self.data["E
-00010190: 4e54 5259 5459 5045 225d 203d 3d20 2269  NTRYTYPE"] == "i
-000101a0: 6e70 726f 6365 6564 696e 6773 223a 0a20  nproceedings":. 
-000101b0: 2020 2020 2020 2020 2020 2072 6574 5f73             ret_s
-000101c0: 7472 202b 3d20 6622 7b73 656c 662e 6461  tr += f"{self.da
-000101d0: 7461 2e67 6574 2827 626f 6f6b 7469 746c  ta.get('booktitl
-000101e0: 6527 2c20 276e 6f2d 626f 6f6b 7469 746c  e', 'no-booktitl
-000101f0: 6527 297d 5c6e 220a 2020 2020 2020 2020  e')}\n".        
-00010200: 6966 2022 6162 7374 7261 6374 2220 696e  if "abstract" in
-00010210: 2073 656c 662e 6461 7461 3a0a 2020 2020   self.data:.    
-00010220: 2020 2020 2020 2020 6c69 6e65 7320 3d20          lines = 
-00010230: 7465 7874 7772 6170 2e77 7261 7028 7365  textwrap.wrap(se
-00010240: 6c66 2e64 6174 615b 2261 6273 7472 6163  lf.data["abstrac
-00010250: 7422 5d2c 2031 3030 2c20 6272 6561 6b5f  t"], 100, break_
-00010260: 6c6f 6e67 5f77 6f72 6473 3d46 616c 7365  long_words=False
-00010270: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-00010280: 745f 7374 7220 2b3d 2066 225c 6e41 6273  t_str += f"\nAbs
-00010290: 7472 6163 743a 207b 6c69 6e65 732e 706f  tract: {lines.po
-000102a0: 7028 3029 7d5c 6e22 0a20 2020 2020 2020  p(0)}\n".       
-000102b0: 2020 2020 2072 6574 5f73 7472 202b 3d20       ret_str += 
-000102c0: 225c 6e22 2e6a 6f69 6e28 6c69 6e65 7329  "\n".join(lines)
-000102d0: 202b 2022 5c6e 220a 0a20 2020 2020 2020   + "\n"..       
-000102e0: 2069 6620 2275 726c 2220 696e 2073 656c   if "url" in sel
-000102f0: 662e 6461 7461 3a0a 2020 2020 2020 2020  f.data:.        
-00010300: 2020 2020 7265 745f 7374 7220 2b3d 2066      ret_str += f
-00010310: 225c 6e75 726c 3a20 7b73 656c 662e 6461  "\nurl: {self.da
-00010320: 7461 5b27 7572 6c27 5d7d 5c6e 220a 0a20  ta['url']}\n".. 
-00010330: 2020 2020 2020 2070 7269 6e74 2872 6574         print(ret
-00010340: 5f73 7472 290a 0a0a 636c 6173 7320 5072  _str)...class Pr
-00010350: 6570 5265 636f 7264 2852 6563 6f72 6429  epRecord(Record)
-00010360: 3a0a 2020 2020 2222 2254 6865 2050 7265  :.    """The Pre
-00010370: 7052 6563 6f72 6420 636c 6173 7320 7072  pRecord class pr
-00010380: 6f76 6964 6573 2061 2072 616e 6765 206f  ovides a range o
-00010390: 6620 636f 6e76 656e 6965 6e63 6520 6675  f convenience fu
-000103a0: 6e63 7469 6f6e 7320 666f 7220 7265 636f  nctions for reco
-000103b0: 7264 2070 7265 7061 7261 7469 6f6e 2222  rd preparation""
-000103c0: 220a 0a20 2020 2040 636c 6173 736d 6574  "..    @classmet
-000103d0: 686f 640a 2020 2020 6465 6620 666f 726d  hod.    def form
-000103e0: 6174 5f61 7574 686f 725f 6669 656c 6428  at_author_field(
-000103f0: 636c 732c 202a 2c20 696e 7075 745f 7374  cls, *, input_st
-00010400: 7269 6e67 3a20 7374 7229 202d 3e20 7374  ring: str) -> st
-00010410: 723a 0a20 2020 2020 2020 2022 2222 466f  r:.        """Fo
-00010420: 726d 6174 2074 6865 2061 7574 686f 7220  rmat the author 
-00010430: 6669 656c 6420 2872 6563 6f67 6e69 7a69  field (recognizi
-00010440: 6e67 2066 6972 7374 2f6c 6173 7420 6e61  ng first/last na
-00010450: 6d65 7320 6261 7365 6420 6f6e 2048 756d  mes based on Hum
-00010460: 616e 4e61 6d65 2070 6172 7365 7229 2222  anName parser)""
-00010470: 220a 0a20 2020 2020 2020 2064 6566 206d  "..        def m
-00010480: 6f73 746c 795f 7570 7065 725f 6361 7365  ostly_upper_case
-00010490: 2869 6e70 7574 5f73 7472 696e 673a 2073  (input_string: s
-000104a0: 7472 2920 2d3e 2062 6f6f 6c3a 0a20 2020  tr) -> bool:.   
-000104b0: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-000104c0: 7265 2e6d 6174 6368 2872 225b 612d 7a41  re.match(r"[a-zA
-000104d0: 2d5a 5d2b 222c 2069 6e70 7574 5f73 7472  -Z]+", input_str
-000104e0: 696e 6729 3a0a 2020 2020 2020 2020 2020  ing):.          
-000104f0: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
-00010500: 7365 0a20 2020 2020 2020 2020 2020 2069  se.            i
-00010510: 6e70 7574 5f73 7472 696e 6720 3d20 696e  nput_string = in
-00010520: 7075 745f 7374 7269 6e67 2e72 6570 6c61  put_string.repla
-00010530: 6365 2822 2e22 2c20 2222 292e 7265 706c  ce(".", "").repl
-00010540: 6163 6528 222c 222c 2022 2229 0a20 2020  ace(",", "").   
-00010550: 2020 2020 2020 2020 2077 6f72 6473 203d           words =
-00010560: 2069 6e70 7574 5f73 7472 696e 672e 7370   input_string.sp
-00010570: 6c69 7428 290a 2020 2020 2020 2020 2020  lit().          
-00010580: 2020 7265 7475 726e 2073 756d 2877 6f72    return sum(wor
-00010590: 642e 6973 7570 7065 7228 2920 666f 7220  d.isupper() for 
-000105a0: 776f 7264 2069 6e20 776f 7264 7329 202f  word in words) /
-000105b0: 206c 656e 2877 6f72 6473 2920 3e20 302e   len(words) > 0.
-000105c0: 380a 0a20 2020 2020 2020 2069 6e70 7574  8..        input
-000105d0: 5f73 7472 696e 6720 3d20 696e 7075 745f  _string = input_
-000105e0: 7374 7269 6e67 2e72 6570 6c61 6365 2822  string.replace("
-000105f0: 5c6e 222c 2022 2022 290a 2020 2020 2020  \n", " ").      
-00010600: 2020 2320 4442 4c50 2061 7070 656e 6473    # DBLP appends
-00010610: 2069 6465 6e74 6966 6965 7273 2074 6f20   identifiers to 
-00010620: 6e6f 6e2d 756e 6971 7565 2061 7574 686f  non-unique autho
-00010630: 7273 0a20 2020 2020 2020 2069 6e70 7574  rs.        input
-00010640: 5f73 7472 696e 6720 3d20 7374 7228 7265  _string = str(re
-00010650: 2e73 7562 2872 225b 302d 395d 7b34 7d22  .sub(r"[0-9]{4}"
-00010660: 2c20 2222 2c20 696e 7075 745f 7374 7269  , "", input_stri
-00010670: 6e67 2929 0a0a 2020 2020 2020 2020 6966  ng))..        if
-00010680: 2022 2061 6e64 2022 2069 6e20 696e 7075   " and " in inpu
-00010690: 745f 7374 7269 6e67 3a0a 2020 2020 2020  t_string:.      
-000106a0: 2020 2020 2020 6e61 6d65 7320 3d20 696e        names = in
-000106b0: 7075 745f 7374 7269 6e67 2e73 706c 6974  put_string.split
-000106c0: 2822 2061 6e64 2022 290a 2020 2020 2020  (" and ").      
-000106d0: 2020 656c 6966 2069 6e70 7574 5f73 7472    elif input_str
-000106e0: 696e 672e 636f 756e 7428 222c 2229 203e  ing.count(",") >
-000106f0: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
-00010700: 6e61 6d65 7320 3d20 696e 7075 745f 7374  names = input_st
-00010710: 7269 6e67 2e73 706c 6974 2822 2c20 2229  ring.split(", ")
-00010720: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-00010730: 2020 2020 2020 2020 2020 206e 616d 6573             names
-00010740: 203d 205b 696e 7075 745f 7374 7269 6e67   = [input_string
-00010750: 5d0a 2020 2020 2020 2020 6175 7468 6f72  ].        author
-00010760: 5f73 7472 696e 6720 3d20 2222 0a20 2020  _string = "".   
-00010770: 2020 2020 2066 6f72 206e 616d 6520 696e       for name in
-00010780: 206e 616d 6573 3a0a 2020 2020 2020 2020   names:.        
-00010790: 2020 2020 2320 4e6f 7465 3a20 6874 7470      # Note: http
-000107a0: 733a 2f2f 6769 7468 7562 2e63 6f6d 2f64  s://github.com/d
-000107b0: 6572 656b 3733 2f70 7974 686f 6e2d 6e61  erek73/python-na
-000107c0: 6d65 7061 7273 6572 0a20 2020 2020 2020  meparser.       
-000107d0: 2020 2020 2023 2069 7320 7665 7279 2065       # is very e
-000107e0: 6666 6563 7469 7665 2028 6d61 7962 6520  ffective (maybe 
-000107f0: 6e6f 7420 7065 7266 6563 7429 0a0a 2020  not perfect)..  
-00010800: 2020 2020 2020 2020 2020 7061 7273 6564            parsed
-00010810: 5f6e 616d 6520 3d20 4875 6d61 6e4e 616d  _name = HumanNam
-00010820: 6528 6e61 6d65 290a 2020 2020 2020 2020  e(name).        
-00010830: 2020 2020 6966 206d 6f73 746c 795f 7570      if mostly_up
-00010840: 7065 725f 6361 7365 2869 6e70 7574 5f73  per_case(input_s
-00010850: 7472 696e 672e 7265 706c 6163 6528 2220  tring.replace(" 
-00010860: 616e 6420 222c 2022 2229 2e72 6570 6c61  and ", "").repla
-00010870: 6365 2822 4a72 222c 2022 2229 293a 0a20  ce("Jr", "")):. 
-00010880: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00010890: 6172 7365 645f 6e61 6d65 2e63 6170 6974  arsed_name.capit
-000108a0: 616c 697a 6528 666f 7263 653d 5472 7565  alize(force=True
-000108b0: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
-000108c0: 2046 6978 2074 7970 6963 616c 2070 6172   Fix typical par
-000108d0: 7365 7220 6572 726f 720a 2020 2020 2020  ser error.      
-000108e0: 2020 2020 2020 6966 2070 6172 7365 645f        if parsed_
-000108f0: 6e61 6d65 2e6c 6173 7420 3d3d 2022 2220  name.last == "" 
-00010900: 616e 6420 7061 7273 6564 5f6e 616d 652e  and parsed_name.
-00010910: 7469 746c 6520 213d 2022 223a 0a20 2020  title != "":.   
-00010920: 2020 2020 2020 2020 2020 2020 2070 6172               par
-00010930: 7365 645f 6e61 6d65 2e6c 6173 7420 3d20  sed_name.last = 
-00010940: 7061 7273 6564 5f6e 616d 652e 7469 746c  parsed_name.titl
-00010950: 650a 0a20 2020 2020 2020 2020 2020 2023  e..            #
-00010960: 2070 796c 696e 743a 2064 6973 6162 6c65   pylint: disable
-00010970: 3d63 6861 696e 6564 2d63 6f6d 7061 7269  =chained-compari
-00010980: 736f 6e0a 2020 2020 2020 2020 2020 2020  son.            
-00010990: 2320 4669 783a 2077 6865 6e20 6669 7273  # Fix: when firs
-000109a0: 7420 6e61 6d65 7320 6172 6520 6162 6272  t names are abbr
-000109b0: 6576 6961 7465 642c 206e 616d 6570 6172  eviated, namepar
-000109c0: 7365 7220 6372 6561 7465 7320 6572 726f  ser creates erro
-000109d0: 7273 3a0a 2020 2020 2020 2020 2020 2020  rs:.            
-000109e0: 6966 2028 0a20 2020 2020 2020 2020 2020  if (.           
-000109f0: 2020 2020 206c 656e 2870 6172 7365 645f       len(parsed_
-00010a00: 6e61 6d65 2e6c 6173 7429 203c 3d20 330a  name.last) <= 3.
-00010a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010a20: 616e 6420 7061 7273 6564 5f6e 616d 652e  and parsed_name.
-00010a30: 6c61 7374 2e69 7375 7070 6572 2829 0a20  last.isupper(). 
-00010a40: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-00010a50: 6e64 206c 656e 2870 6172 7365 645f 6e61  nd len(parsed_na
-00010a60: 6d65 2e66 6972 7374 2920 3e20 330a 2020  me.first) > 3.  
-00010a70: 2020 2020 2020 2020 2020 2020 2020 616e                an
-00010a80: 6420 6e6f 7420 7061 7273 6564 5f6e 616d  d not parsed_nam
-00010a90: 652e 6669 7273 742e 6973 7570 7065 7228  e.first.isupper(
-00010aa0: 290a 2020 2020 2020 2020 2020 2020 293a  ).            ):
-00010ab0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010ac0: 2023 2069 6e20 7468 6573 6520 6361 7365   # in these case
-00010ad0: 6573 2c20 6669 7273 7420 616e 6420 6c61  es, first and la
-00010ae0: 7374 206e 616d 6573 2061 7265 2063 6f6e  st names are con
-00010af0: 6675 7365 640a 2020 2020 2020 2020 2020  fused.          
-00010b00: 2020 2020 2020 6175 7468 6f72 5f6e 616d        author_nam
-00010b10: 655f 7374 7269 6e67 203d 2070 6172 7365  e_string = parse
-00010b20: 645f 6e61 6d65 2e66 6972 7374 202b 2022  d_name.first + "
-00010b30: 2c20 2220 2b20 7061 7273 6564 5f6e 616d  , " + parsed_nam
-00010b40: 652e 6c61 7374 0a20 2020 2020 2020 2020  e.last.         
-00010b50: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00010b60: 2020 2020 2020 2020 2070 6172 7365 645f           parsed_
-00010b70: 6e61 6d65 2e73 7472 696e 675f 666f 726d  name.string_form
-00010b80: 6174 203d 2022 7b6c 6173 747d 207b 7375  at = "{last} {su
-00010b90: 6666 6978 7d2c 207b 6669 7273 747d 207b  ffix}, {first} {
-00010ba0: 6d69 6464 6c65 7d22 0a20 2020 2020 2020  middle}".       
-00010bb0: 2020 2020 2020 2020 2023 2027 7b6c 6173           # '{las
-00010bc0: 747d 207b 7375 6666 6978 7d2c 207b 6669  t} {suffix}, {fi
-00010bd0: 7273 747d 2028 7b6e 6963 6b6e 616d 657d  rst} ({nickname}
-00010be0: 2920 7b6d 6964 646c 657d 270a 2020 2020  ) {middle}'.    
-00010bf0: 2020 2020 2020 2020 2020 2020 6175 7468              auth
-00010c00: 6f72 5f6e 616d 655f 7374 7269 6e67 203d  or_name_string =
-00010c10: 2073 7472 2870 6172 7365 645f 6e61 6d65   str(parsed_name
-00010c20: 292e 7265 706c 6163 6528 2220 2c20 222c  ).replace(" , ",
-00010c30: 2022 2c20 2229 0a20 2020 2020 2020 2020   ", ").         
-00010c40: 2020 2020 2020 2023 204e 6f74 653a 2074         # Note: t
-00010c50: 6865 7265 2061 7265 2065 7272 6f72 7320  here are errors 
-00010c60: 666f 7220 7468 6520 666f 6c6c 6f77 696e  for the followin
-00010c70: 6720 6175 7468 6f72 3a0a 2020 2020 2020  g author:.      
-00010c80: 2020 2020 2020 2020 2020 2320 4a52 2043            # JR C
-00010c90: 726f 6d77 656c 6c20 616e 6420 484b 2047  romwell and HK G
-00010ca0: 6172 646e 6572 0a20 2020 2020 2020 2020  ardner.         
-00010cb0: 2020 2020 2020 2023 2054 6865 204a 5220         # The JR 
-00010cc0: 6973 2070 726f 6261 626c 7920 7265 636f  is probably reco
-00010cd0: 676e 697a 6564 2061 7320 4a75 6e69 6f72  gnized as Junior
-00010ce0: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00010cf0: 2020 2320 4368 6563 6b20 7768 6574 6865    # Check whethe
-00010d00: 7220 7468 6973 2069 7320 6669 7865 6420  r this is fixed 
-00010d10: 696e 2074 6865 2047 726f 6269 6420 6e61  in the Grobid na
-00010d20: 6d65 2070 6172 7365 720a 0a20 2020 2020  me parser..     
-00010d30: 2020 2020 2020 2069 6620 6175 7468 6f72         if author
-00010d40: 5f73 7472 696e 6720 3d3d 2022 223a 0a20  _string == "":. 
-00010d50: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-00010d60: 7574 686f 725f 7374 7269 6e67 203d 2061  uthor_string = a
-00010d70: 7574 686f 725f 6e61 6d65 5f73 7472 696e  uthor_name_strin
-00010d80: 670a 2020 2020 2020 2020 2020 2020 656c  g.            el
-00010d90: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00010da0: 2020 2020 6175 7468 6f72 5f73 7472 696e      author_strin
-00010db0: 6720 3d20 6175 7468 6f72 5f73 7472 696e  g = author_strin
-00010dc0: 6720 2b20 2220 616e 6420 2220 2b20 6175  g + " and " + au
-00010dd0: 7468 6f72 5f6e 616d 655f 7374 7269 6e67  thor_name_string
-00010de0: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00010df0: 2061 7574 686f 725f 7374 7269 6e67 0a0a   author_string..
-00010e00: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
-00010e10: 0a20 2020 2064 6566 205f 5f66 6f72 6d61  .    def __forma
-00010e20: 745f 6175 7468 6f72 735f 7374 7269 6e67  t_authors_string
-00010e30: 5f66 6f72 5f63 6f6d 7061 7269 736f 6e28  _for_comparison(
-00010e40: 636c 732c 202a 2c20 7265 636f 7264 3a20  cls, *, record: 
-00010e50: 5265 636f 7264 2920 2d3e 204e 6f6e 653a  Record) -> None:
-00010e60: 0a20 2020 2020 2020 2069 6620 2261 7574  .        if "aut
-00010e70: 686f 7222 206e 6f74 2069 6e20 7265 636f  hor" not in reco
-00010e80: 7264 2e64 6174 613a 0a20 2020 2020 2020  rd.data:.       
-00010e90: 2020 2020 2072 6574 7572 6e0a 2020 2020       return.    
-00010ea0: 2020 2020 6175 7468 6f72 7320 3d20 7265      authors = re
-00010eb0: 636f 7264 2e64 6174 615b 2261 7574 686f  cord.data["autho
-00010ec0: 7222 5d0a 2020 2020 2020 2020 6175 7468  r"].        auth
-00010ed0: 6f72 7320 3d20 7374 7228 6175 7468 6f72  ors = str(author
-00010ee0: 7329 2e6c 6f77 6572 2829 0a20 2020 2020  s).lower().     
-00010ef0: 2020 2061 7574 686f 7273 5f73 7472 696e     authors_strin
-00010f00: 6720 3d20 2222 0a20 2020 2020 2020 2061  g = "".        a
-00010f10: 7574 686f 7273 203d 2063 6f6c 7265 762e  uthors = colrev.
-00010f20: 656e 762e 7574 696c 732e 7265 6d6f 7665  env.utils.remove
-00010f30: 5f61 6363 656e 7473 2869 6e70 7574 5f73  _accents(input_s
-00010f40: 7472 3d61 7574 686f 7273 290a 0a20 2020  tr=authors)..   
-00010f50: 2020 2020 2023 2061 6262 7265 7669 6174       # abbreviat
-00010f60: 6520 6669 7273 7420 6e61 6d65 730a 2020  e first names.  
-00010f70: 2020 2020 2020 2320 2257 6562 7374 6572        # "Webster
-00010f80: 2c20 4a61 6e65 2220 2d3e 2022 5765 6273  , Jane" -> "Webs
-00010f90: 7465 722c 204a 220a 2020 2020 2020 2020  ter, J".        
-00010fa0: 2320 616c 736f 2072 656d 6f76 6520 616c  # also remove al
-00010fb0: 6c20 7370 6563 6961 6c20 6368 6172 6163  l special charac
-00010fc0: 7465 7273 2061 6e64 2064 6f20 6e6f 7420  ters and do not 
-00010fd0: 696e 636c 7564 6520 7365 7061 7261 746f  include separato
-00010fe0: 7273 2028 616e 6429 0a20 2020 2020 2020  rs (and).       
-00010ff0: 2066 6f72 2061 7574 686f 7220 696e 2061   for author in a
-00011000: 7574 686f 7273 2e73 706c 6974 2822 2061  uthors.split(" a
-00011010: 6e64 2022 293a 0a20 2020 2020 2020 2020  nd "):.         
-00011020: 2020 2069 6620 222c 2220 696e 2061 7574     if "," in aut
-00011030: 686f 723a 0a20 2020 2020 2020 2020 2020  hor:.           
-00011040: 2020 2020 206c 6173 745f 6e61 6d65 7320       last_names 
-00011050: 3d20 5b0a 2020 2020 2020 2020 2020 2020  = [.            
-00011060: 2020 2020 2020 2020 776f 7264 5b30 5d20          word[0] 
-00011070: 666f 7220 776f 7264 2069 6e20 6175 7468  for word in auth
-00011080: 6f72 2e73 706c 6974 2822 2c22 295b 315d  or.split(",")[1]
-00011090: 2e73 706c 6974 2822 2022 2920 6966 206c  .split(" ") if l
-000110a0: 656e 2877 6f72 6429 203e 2030 0a20 2020  en(word) > 0.   
-000110b0: 2020 2020 2020 2020 2020 2020 205d 0a20               ]. 
-000110c0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-000110d0: 7574 686f 7273 5f73 7472 696e 6720 3d20  uthors_string = 
-000110e0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-000110f0: 2020 2020 2020 6175 7468 6f72 735f 7374        authors_st
-00011100: 7269 6e67 0a20 2020 2020 2020 2020 2020  ring.           
-00011110: 2020 2020 2020 2020 202b 2061 7574 686f           + autho
-00011120: 722e 7370 6c69 7428 222c 2229 5b30 5d0a  r.split(",")[0].
-00011130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011140: 2020 2020 2b20 2220 220a 2020 2020 2020      + " ".      
-00011150: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
-00011160: 2220 222e 6a6f 696e 286c 6173 745f 6e61  " ".join(last_na
-00011170: 6d65 7329 0a20 2020 2020 2020 2020 2020  mes).           
-00011180: 2020 2020 2020 2020 202b 2022 2022 0a20           + " ". 
-00011190: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-000111a0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-000111b0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-000111c0: 2020 2061 7574 686f 7273 5f73 7472 696e     authors_strin
-000111d0: 6720 3d20 6175 7468 6f72 735f 7374 7269  g = authors_stri
-000111e0: 6e67 202b 2061 7574 686f 7220 2b20 2220  ng + author + " 
-000111f0: 220a 2020 2020 2020 2020 6175 7468 6f72  ".        author
-00011200: 735f 7374 7269 6e67 203d 2072 652e 7375  s_string = re.su
-00011210: 6228 7222 5b5e 412d 5a61 2d7a 302d 392c  b(r"[^A-Za-z0-9,
-00011220: 205d 2b22 2c20 2222 2c20 6175 7468 6f72   ]+", "", author
-00011230: 735f 7374 7269 6e67 2e72 7374 7269 7028  s_string.rstrip(
-00011240: 2929 0a20 2020 2020 2020 2072 6563 6f72  )).        recor
-00011250: 642e 6461 7461 5b22 6175 7468 6f72 225d  d.data["author"]
-00011260: 203d 2061 7574 686f 7273 5f73 7472 696e   = authors_strin
-00011270: 670a 0a20 2020 2064 6566 2063 6f6e 7461  g..    def conta
-00011280: 696e 6572 5f69 735f 6162 6272 6576 6961  iner_is_abbrevia
-00011290: 7465 6428 7365 6c66 2920 2d3e 2062 6f6f  ted(self) -> boo
-000112a0: 6c3a 0a20 2020 2020 2020 2022 2222 4368  l:.        """Ch
-000112b0: 6563 6b20 7768 6574 6865 7220 7468 6520  eck whether the 
-000112c0: 636f 6e74 6169 6e65 7220 7469 746c 6520  container title 
-000112d0: 6973 2061 6262 7265 7669 6174 6564 2222  is abbreviated""
-000112e0: 220a 2020 2020 2020 2020 6966 2022 6a6f  ".        if "jo
-000112f0: 7572 6e61 6c22 2069 6e20 7365 6c66 2e64  urnal" in self.d
-00011300: 6174 613a 0a20 2020 2020 2020 2020 2020  ata:.           
-00011310: 2069 6620 7365 6c66 2e64 6174 615b 226a   if self.data["j
-00011320: 6f75 726e 616c 225d 2e63 6f75 6e74 2822  ournal"].count("
-00011330: 2e22 2920 3e20 323a 0a20 2020 2020 2020  .") > 2:.       
-00011340: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00011350: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
-00011360: 2069 6620 7365 6c66 2e64 6174 615b 226a   if self.data["j
-00011370: 6f75 726e 616c 225d 2e69 7375 7070 6572  ournal"].isupper
-00011380: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-00011390: 2020 2020 7265 7475 726e 2054 7275 650a      return True.
-000113a0: 2020 2020 2020 2020 6966 2022 626f 6f6b          if "book
-000113b0: 7469 746c 6522 2069 6e20 7365 6c66 2e64  title" in self.d
-000113c0: 6174 613a 0a20 2020 2020 2020 2020 2020  ata:.           
-000113d0: 2069 6620 7365 6c66 2e64 6174 615b 2262   if self.data["b
-000113e0: 6f6f 6b74 6974 6c65 225d 2e63 6f75 6e74  ooktitle"].count
-000113f0: 2822 2e22 2920 3e20 323a 0a20 2020 2020  (".") > 2:.     
-00011400: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00011410: 6e20 5472 7565 0a20 2020 2020 2020 2020  n True.         
-00011420: 2020 2069 6620 7365 6c66 2e64 6174 615b     if self.data[
-00011430: 2262 6f6f 6b74 6974 6c65 225d 2e69 7375  "booktitle"].isu
-00011440: 7070 6572 2829 3a0a 2020 2020 2020 2020  pper():.        
-00011450: 2020 2020 2020 2020 7265 7475 726e 2054          return T
-00011460: 7275 650a 2020 2020 2020 2020 2320 6164  rue.        # ad
-00011470: 6420 6865 7572 6973 7469 6373 3f20 2865  d heuristics? (e
-00011480: 2e67 2e2c 2048 6177 6169 6920 496e 7420  .g., Hawaii Int 
-00011490: 436f 6e66 2053 7973 7420 5363 6929 0a20  Conf Syst Sci). 
-000114a0: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
-000114b0: 6c73 650a 0a20 2020 2040 636c 6173 736d  lse..    @classm
-000114c0: 6574 686f 640a 2020 2020 6465 6620 5f5f  ethod.    def __
-000114d0: 6162 6272 6576 6961 7465 5f63 6f6e 7461  abbreviate_conta
-000114e0: 696e 6572 5f74 6974 6c65 7328 0a20 2020  iner_titles(.   
-000114f0: 2020 2020 2063 6c73 2c0a 2020 2020 2020       cls,.      
-00011500: 2020 2a2c 0a20 2020 2020 2020 2072 6563    *,.        rec
-00011510: 6f72 643a 2063 6f6c 7265 762e 7265 636f  ord: colrev.reco
-00011520: 7264 2e50 7265 7052 6563 6f72 642c 0a20  rd.PrepRecord,. 
-00011530: 2020 2020 2020 2072 6574 7269 6576 6564         retrieved
-00011540: 5f72 6563 6f72 643a 2063 6f6c 7265 762e  _record: colrev.
-00011550: 7265 636f 7264 2e50 7265 7052 6563 6f72  record.PrepRecor
-00011560: 642c 0a20 2020 2029 202d 3e20 4e6f 6e65  d,.    ) -> None
-00011570: 3a0a 2020 2020 2020 2020 6465 6620 6162  :.        def ab
-00011580: 6272 6576 6961 7465 5f63 6f6e 7461 696e  breviate_contain
-00011590: 6572 282a 2c20 7265 636f 7264 3a20 636f  er(*, record: co
-000115a0: 6c72 6576 2e72 6563 6f72 642e 5265 636f  lrev.record.Reco
-000115b0: 7264 2c20 6d69 6e5f 6c65 6e3a 2069 6e74  rd, min_len: int
-000115c0: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-000115d0: 2020 2020 2020 2069 6620 226a 6f75 726e         if "journ
-000115e0: 616c 2220 696e 2072 6563 6f72 642e 6461  al" in record.da
-000115f0: 7461 3a0a 2020 2020 2020 2020 2020 2020  ta:.            
-00011600: 2020 2020 7265 636f 7264 2e64 6174 615b      record.data[
-00011610: 226a 6f75 726e 616c 225d 203d 2022 2022  "journal"] = " "
-00011620: 2e6a 6f69 6e28 0a20 2020 2020 2020 2020  .join(.         
-00011630: 2020 2020 2020 2020 2020 205b 785b 3a6d             [x[:m
-00011640: 696e 5f6c 656e 5d20 666f 7220 7820 696e  in_len] for x in
-00011650: 2072 6563 6f72 642e 6461 7461 5b22 6a6f   record.data["jo
-00011660: 7572 6e61 6c22 5d2e 7370 6c69 7428 2220  urnal"].split(" 
-00011670: 2229 5d0a 2020 2020 2020 2020 2020 2020  ")].            
-00011680: 2020 2020 290a 0a20 2020 2020 2020 2064      )..        d
-00011690: 6566 2067 6574 5f61 6262 7265 765f 636f  ef get_abbrev_co
-000116a0: 6e74 6169 6e65 725f 6d69 6e5f 6c65 6e28  ntainer_min_len(
-000116b0: 2a2c 2072 6563 6f72 643a 2063 6f6c 7265  *, record: colre
-000116c0: 762e 7265 636f 7264 2e52 6563 6f72 6429  v.record.Record)
-000116d0: 202d 3e20 696e 743a 0a20 2020 2020 2020   -> int:.       
-000116e0: 2020 2020 206d 696e 5f6c 656e 203d 202d       min_len = -
-000116f0: 310a 2020 2020 2020 2020 2020 2020 6966  1.            if
-00011700: 2022 6a6f 7572 6e61 6c22 2069 6e20 7265   "journal" in re
-00011710: 636f 7264 2e64 6174 613a 0a20 2020 2020  cord.data:.     
-00011720: 2020 2020 2020 2020 2020 206d 696e 5f6c             min_l
-00011730: 656e 203d 206d 696e 280a 2020 2020 2020  en = min(.      
-00011740: 2020 2020 2020 2020 2020 2020 2020 6c65                le
-00011750: 6e28 7829 2066 6f72 2078 2069 6e20 7265  n(x) for x in re
-00011760: 636f 7264 2e64 6174 615b 226a 6f75 726e  cord.data["journ
-00011770: 616c 225d 2e72 6570 6c61 6365 2822 2e22  al"].replace("."
-00011780: 2c20 2222 292e 7370 6c69 7428 2220 2229  , "").split(" ")
-00011790: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000117a0: 2029 0a20 2020 2020 2020 2020 2020 2069   ).            i
-000117b0: 6620 2262 6f6f 6b74 6974 6c65 2220 696e  f "booktitle" in
-000117c0: 2072 6563 6f72 642e 6461 7461 3a0a 2020   record.data:.  
-000117d0: 2020 2020 2020 2020 2020 2020 2020 6d69                mi
-000117e0: 6e5f 6c65 6e20 3d20 6d69 6e28 0a20 2020  n_len = min(.   
+0000a140: 2020 5b22 7265 7669 6577 6572 2061 636b    ["reviewer ack
+0000a150: 6f77 6c65 6467 6d65 6e74 222c 2022 7265  owledgment", "re
+0000a160: 7669 6577 6572 2061 636b 6f77 6c65 6467  viewer ackowledg
+0000a170: 6d65 6e74 225d 2c0a 2020 2020 2020 2020  ment"],.        
+0000a180: 2020 2020 2020 2020 5d3a 0a20 2020 2020          ]:.     
+0000a190: 2020 2020 2020 2020 2020 2020 2020 2077                 w
+0000a1a0: 6569 6768 7473 203d 205b 302e 3137 352c  eights = [0.175,
+0000a1b0: 2030 2c20 302e 3137 352c 2030 2e31 3735   0, 0.175, 0.175
+0000a1c0: 2c20 302e 3237 352c 2030 2e32 5d0a 2020  , 0.275, 0.2].  
+0000a1d0: 2020 2020 2020 2020 2020 2020 2020 656c                el
+0000a1e0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0000a1f0: 2020 2020 2020 2020 7765 6967 6874 7320          weights 
+0000a200: 3d20 5b30 2e32 2c20 302e 3235 2c20 302e  = [0.2, 0.25, 0.
+0000a210: 3133 2c20 302e 322c 2030 2e31 322c 2030  13, 0.2, 0.12, 0
+0000a220: 2e31 5d0a 0a20 2020 2020 2020 2020 2020  .1]..           
+0000a230: 2020 2020 2073 696d 5f6e 616d 6573 203d       sim_names =
+0000a240: 205b 0a20 2020 2020 2020 2020 2020 2020   [.             
+0000a250: 2020 2020 2020 2022 6175 7468 6f72 7322         "authors"
+0000a260: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000a270: 2020 2020 2020 2274 6974 6c65 222c 0a20        "title",. 
+0000a280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a290: 2020 2022 7965 6172 222c 0a20 2020 2020     "year",.     
+0000a2a0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0000a2b0: 6f75 746c 6574 222c 0a20 2020 2020 2020  outlet",.       
+0000a2c0: 2020 2020 2020 2020 2020 2020 2022 766f               "vo
+0000a2d0: 6c75 6d65 222c 0a20 2020 2020 2020 2020  lume",.         
+0000a2e0: 2020 2020 2020 2020 2020 2022 6e75 6d62             "numb
+0000a2f0: 6572 222c 0a20 2020 2020 2020 2020 2020  er",.           
+0000a300: 2020 2020 205d 0a20 2020 2020 2020 2020       ].         
+0000a310: 2020 2020 2020 2073 696d 696c 6172 6974         similarit
+0000a320: 6965 7320 3d20 5b0a 2020 2020 2020 2020  ies = [.        
+0000a330: 2020 2020 2020 2020 2020 2020 6175 7468              auth
+0000a340: 6f72 5f73 696d 696c 6172 6974 792c 0a20  or_similarity,. 
+0000a350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a360: 2020 2074 6974 6c65 5f73 696d 696c 6172     title_similar
+0000a370: 6974 792c 0a20 2020 2020 2020 2020 2020  ity,.           
+0000a380: 2020 2020 2020 2020 2079 6561 725f 7369           year_si
+0000a390: 6d69 6c61 7269 7479 2c0a 2020 2020 2020  milarity,.      
+0000a3a0: 2020 2020 2020 2020 2020 2020 2020 6f75                ou
+0000a3b0: 746c 6574 5f73 696d 696c 6172 6974 792c  tlet_similarity,
+0000a3c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a3d0: 2020 2020 2076 6f6c 756d 655f 7369 6d69       volume_simi
+0000a3e0: 6c61 7269 7479 2c0a 2020 2020 2020 2020  larity,.        
+0000a3f0: 2020 2020 2020 2020 2020 2020 6e75 6d62              numb
+0000a400: 6572 5f73 696d 696c 6172 6974 792c 0a20  er_similarity,. 
+0000a410: 2020 2020 2020 2020 2020 2020 2020 205d                 ]
+0000a420: 0a0a 2020 2020 2020 2020 2020 2020 656c  ..            el
+0000a430: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0000a440: 2020 2020 7765 6967 6874 7320 3d20 5b30      weights = [0
+0000a450: 2e31 352c 2030 2e37 352c 2030 2e30 352c  .15, 0.75, 0.05,
+0000a460: 2030 2e30 355d 0a20 2020 2020 2020 2020   0.05].         
+0000a470: 2020 2020 2020 2073 696d 5f6e 616d 6573         sim_names
+0000a480: 203d 205b 0a20 2020 2020 2020 2020 2020   = [.           
+0000a490: 2020 2020 2020 2020 2022 6175 7468 6f72           "author
+0000a4a0: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+0000a4b0: 2020 2020 2020 2022 7469 746c 6522 2c0a         "title",.
+0000a4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a4d0: 2020 2020 2279 6561 7222 2c0a 2020 2020      "year",.    
+0000a4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a4f0: 226f 7574 6c65 7422 2c0a 2020 2020 2020  "outlet",.      
+0000a500: 2020 2020 2020 2020 2020 5d0a 2020 2020            ].    
+0000a510: 2020 2020 2020 2020 2020 2020 7369 6d69              simi
+0000a520: 6c61 7269 7469 6573 203d 205b 0a20 2020  larities = [.   
+0000a530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a540: 2061 7574 686f 725f 7369 6d69 6c61 7269   author_similari
+0000a550: 7479 2c0a 2020 2020 2020 2020 2020 2020  ty,.            
+0000a560: 2020 2020 2020 2020 7469 746c 655f 7369          title_si
+0000a570: 6d69 6c61 7269 7479 2c0a 2020 2020 2020  milarity,.      
+0000a580: 2020 2020 2020 2020 2020 2020 2020 7965                ye
+0000a590: 6172 5f73 696d 696c 6172 6974 792c 0a20  ar_similarity,. 
+0000a5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a5b0: 2020 206f 7574 6c65 745f 7369 6d69 6c61     outlet_simila
+0000a5c0: 7269 7479 2c0a 2020 2020 2020 2020 2020  rity,.          
+0000a5d0: 2020 2020 2020 5d0a 0a20 2020 2020 2020        ]..       
+0000a5e0: 2020 2020 2077 6569 6768 7465 645f 6176       weighted_av
+0000a5f0: 6572 6167 6520 3d20 7375 6d28 0a20 2020  erage = sum(.   
+0000a600: 2020 2020 2020 2020 2020 2020 2073 696d               sim
+0000a610: 696c 6172 6974 6965 735b 675d 202a 2077  ilarities[g] * w
+0000a620: 6569 6768 7473 5b67 5d20 666f 7220 6720  eights[g] for g 
+0000a630: 696e 2072 616e 6765 286c 656e 2873 696d  in range(len(sim
+0000a640: 696c 6172 6974 6965 7329 290a 2020 2020  ilarities)).    
+0000a650: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+0000a660: 2020 2020 2020 2064 6574 6169 6c73 203d         details =
+0000a670: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
+0000a680: 2020 2022 5b22 0a20 2020 2020 2020 2020     "[".         
+0000a690: 2020 2020 2020 202b 2022 2c22 2e6a 6f69         + ",".joi
+0000a6a0: 6e28 5b73 696d 5f6e 616d 6573 5b67 5d20  n([sim_names[g] 
+0000a6b0: 666f 7220 6720 696e 2072 616e 6765 286c  for g in range(l
+0000a6c0: 656e 2873 696d 696c 6172 6974 6965 7329  en(similarities)
+0000a6d0: 295d 290a 2020 2020 2020 2020 2020 2020  )]).            
+0000a6e0: 2020 2020 2b20 225d 220a 2020 2020 2020      + "]".      
+0000a6f0: 2020 2020 2020 2020 2020 2b20 222a 7765            + "*we
+0000a700: 6967 6874 735f 7665 636f 725e 5420 3d20  ights_vecor^T = 
+0000a710: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+0000a720: 2020 2b20 225b 220a 2020 2020 2020 2020    + "[".        
+0000a730: 2020 2020 2020 2020 2b20 222c 222e 6a6f          + ",".jo
+0000a740: 696e 285b 7374 7228 7369 6d69 6c61 7269  in([str(similari
+0000a750: 7469 6573 5b67 5d29 2066 6f72 2067 2069  ties[g]) for g i
+0000a760: 6e20 7261 6e67 6528 6c65 6e28 7369 6d69  n range(len(simi
+0000a770: 6c61 7269 7469 6573 2929 5d29 0a20 2020  larities))]).   
+0000a780: 2020 2020 2020 2020 2020 2020 202b 2022               + "
+0000a790: 5d2a 220a 2020 2020 2020 2020 2020 2020  ]*".            
+0000a7a0: 2020 2020 2b20 225b 220a 2020 2020 2020      + "[".      
+0000a7b0: 2020 2020 2020 2020 2020 2b20 222c 222e            + ",".
+0000a7c0: 6a6f 696e 285b 7374 7228 7765 6967 6874  join([str(weight
+0000a7d0: 735b 675d 2920 666f 7220 6720 696e 2072  s[g]) for g in r
+0000a7e0: 616e 6765 286c 656e 2873 696d 696c 6172  ange(len(similar
+0000a7f0: 6974 6965 7329 295d 290a 2020 2020 2020  ities))]).      
+0000a800: 2020 2020 2020 2020 2020 2b20 225d 5e54            + "]^T
+0000a810: 220a 2020 2020 2020 2020 2020 2020 290a  ".            ).
+0000a820: 2020 2020 2020 2020 2020 2020 7369 6d69              simi
+0000a830: 6c61 7269 7479 5f73 636f 7265 203d 2072  larity_score = r
+0000a840: 6f75 6e64 2877 6569 6768 7465 645f 6176  ound(weighted_av
+0000a850: 6572 6167 652c 2034 290a 2020 2020 2020  erage, 4).      
+0000a860: 2020 6578 6365 7074 2041 7474 7269 6275    except Attribu
+0000a870: 7465 4572 726f 723a 0a20 2020 2020 2020  teError:.       
+0000a880: 2020 2020 2073 696d 696c 6172 6974 795f       similarity_
+0000a890: 7363 6f72 6520 3d20 300a 2020 2020 2020  score = 0.      
+0000a8a0: 2020 2020 2020 6465 7461 696c 7320 3d20        details = 
+0000a8b0: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
+0000a8c0: 6e20 7b22 7363 6f72 6522 3a20 7369 6d69  n {"score": simi
+0000a8d0: 6c61 7269 7479 5f73 636f 7265 2c20 2264  larity_score, "d
+0000a8e0: 6574 6169 6c73 223a 2064 6574 6169 6c73  etails": details
+0000a8f0: 7d0a 0a20 2020 2064 6566 2067 6574 5f66  }..    def get_f
+0000a900: 6965 6c64 5f70 726f 7665 6e61 6e63 6528  ield_provenance(
+0000a910: 0a20 2020 2020 2020 2073 656c 662c 202a  .        self, *
+0000a920: 2c20 6b65 793a 2073 7472 2c20 6465 6661  , key: str, defa
+0000a930: 756c 745f 736f 7572 6365 3a20 7374 7220  ult_source: str 
+0000a940: 3d20 224f 5249 4749 4e41 4c22 0a20 2020  = "ORIGINAL".   
+0000a950: 2029 202d 3e20 6469 6374 3a0a 2020 2020   ) -> dict:.    
+0000a960: 2020 2020 2222 2247 6574 2074 6865 2070      """Get the p
+0000a970: 726f 7665 6e61 6e63 6520 666f 7220 6120  rovenance for a 
+0000a980: 7365 6c65 6374 6564 2066 6965 6c64 2028  selected field (
+0000a990: 6b65 7929 2222 220a 2020 2020 2020 2020  key)""".        
+0000a9a0: 6465 6661 756c 745f 6e6f 7465 203d 2022  default_note = "
+0000a9b0: 220a 2020 2020 2020 2020 6e6f 7465 203d  ".        note =
+0000a9c0: 2064 6566 6175 6c74 5f6e 6f74 650a 2020   default_note.  
+0000a9d0: 2020 2020 2020 736f 7572 6365 203d 2064        source = d
+0000a9e0: 6566 6175 6c74 5f73 6f75 7263 650a 2020  efault_source.  
+0000a9f0: 2020 2020 2020 6966 206b 6579 2069 6e20        if key in 
+0000aa00: 7365 6c66 2e69 6465 6e74 6966 7969 6e67  self.identifying
+0000aa10: 5f66 6965 6c64 5f6b 6579 733a 0a20 2020  _field_keys:.   
+0000aa20: 2020 2020 2020 2020 2069 6620 2263 6f6c           if "col
+0000aa30: 7265 765f 6d61 7374 6572 6461 7461 5f70  rev_masterdata_p
+0000aa40: 726f 7665 6e61 6e63 6522 2069 6e20 7365  rovenance" in se
+0000aa50: 6c66 2e64 6174 613a 0a20 2020 2020 2020  lf.data:.       
+0000aa60: 2020 2020 2020 2020 2069 6620 6b65 7920           if key 
+0000aa70: 696e 2073 656c 662e 6461 7461 2e67 6574  in self.data.get
+0000aa80: 2822 636f 6c72 6576 5f6d 6173 7465 7264  ("colrev_masterd
+0000aa90: 6174 615f 7072 6f76 656e 616e 6365 222c  ata_provenance",
+0000aaa0: 207b 7d29 3a0a 2020 2020 2020 2020 2020   {}):.          
+0000aab0: 2020 2020 2020 2020 2020 6966 2022 736f            if "so
+0000aac0: 7572 6365 2220 696e 2073 656c 662e 6461  urce" in self.da
+0000aad0: 7461 5b22 636f 6c72 6576 5f6d 6173 7465  ta["colrev_maste
+0000aae0: 7264 6174 615f 7072 6f76 656e 616e 6365  rdata_provenance
+0000aaf0: 225d 5b6b 6579 5d3a 0a20 2020 2020 2020  "][key]:.       
+0000ab00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ab10: 2073 6f75 7263 6520 3d20 7365 6c66 2e64   source = self.d
+0000ab20: 6174 615b 2263 6f6c 7265 765f 6d61 7374  ata["colrev_mast
+0000ab30: 6572 6461 7461 5f70 726f 7665 6e61 6e63  erdata_provenanc
+0000ab40: 6522 5d5b 6b65 795d 5b0a 2020 2020 2020  e"][key][.      
+0000ab50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ab60: 2020 2020 2020 2273 6f75 7263 6522 0a20        "source". 
+0000ab70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ab80: 2020 2020 2020 205d 0a20 2020 2020 2020         ].       
+0000ab90: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0000aba0: 226e 6f74 6522 2069 6e20 7365 6c66 2e64  "note" in self.d
+0000abb0: 6174 615b 2263 6f6c 7265 765f 6d61 7374  ata["colrev_mast
+0000abc0: 6572 6461 7461 5f70 726f 7665 6e61 6e63  erdata_provenanc
+0000abd0: 6522 5d5b 6b65 795d 3a0a 2020 2020 2020  e"][key]:.      
+0000abe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000abf0: 2020 6e6f 7465 203d 2073 656c 662e 6461    note = self.da
+0000ac00: 7461 5b22 636f 6c72 6576 5f6d 6173 7465  ta["colrev_maste
+0000ac10: 7264 6174 615f 7072 6f76 656e 616e 6365  rdata_provenance
+0000ac20: 225d 5b6b 6579 5d5b 226e 6f74 6522 5d0a  "][key]["note"].
+0000ac30: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0000ac40: 2020 2020 2020 2020 2020 6966 2022 636f            if "co
+0000ac50: 6c72 6576 5f64 6174 615f 7072 6f76 656e  lrev_data_proven
+0000ac60: 616e 6365 2220 696e 2073 656c 662e 6461  ance" in self.da
+0000ac70: 7461 3a0a 2020 2020 2020 2020 2020 2020  ta:.            
+0000ac80: 2020 2020 6966 206b 6579 2069 6e20 7365      if key in se
+0000ac90: 6c66 2e64 6174 615b 2263 6f6c 7265 765f  lf.data["colrev_
+0000aca0: 6461 7461 5f70 726f 7665 6e61 6e63 6522  data_provenance"
+0000acb0: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
+0000acc0: 2020 2020 2020 2069 6620 2273 6f75 7263         if "sourc
+0000acd0: 6522 2069 6e20 7365 6c66 2e64 6174 615b  e" in self.data[
+0000ace0: 2263 6f6c 7265 765f 6461 7461 5f70 726f  "colrev_data_pro
+0000acf0: 7665 6e61 6e63 6522 5d5b 6b65 795d 3a0a  venance"][key]:.
+0000ad00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ad10: 2020 2020 2020 2020 736f 7572 6365 203d          source =
+0000ad20: 2073 656c 662e 6461 7461 5b22 636f 6c72   self.data["colr
+0000ad30: 6576 5f64 6174 615f 7072 6f76 656e 616e  ev_data_provenan
+0000ad40: 6365 225d 5b6b 6579 5d5b 2273 6f75 7263  ce"][key]["sourc
+0000ad50: 6522 5d0a 2020 2020 2020 2020 2020 2020  e"].            
+0000ad60: 2020 2020 2020 2020 6966 2022 6e6f 7465          if "note
+0000ad70: 2220 696e 2073 656c 662e 6461 7461 5b22  " in self.data["
+0000ad80: 636f 6c72 6576 5f64 6174 615f 7072 6f76  colrev_data_prov
+0000ad90: 656e 616e 6365 225d 5b6b 6579 5d3a 0a20  enance"][key]:. 
+0000ada0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000adb0: 2020 2020 2020 206e 6f74 6520 3d20 7365         note = se
+0000adc0: 6c66 2e64 6174 615b 2263 6f6c 7265 765f  lf.data["colrev_
+0000add0: 6461 7461 5f70 726f 7665 6e61 6e63 6522  data_provenance"
+0000ade0: 5d5b 6b65 795d 5b22 6e6f 7465 225d 0a0a  ][key]["note"]..
+0000adf0: 2020 2020 2020 2020 7265 7475 726e 207b          return {
+0000ae00: 2273 6f75 7263 6522 3a20 736f 7572 6365  "source": source
+0000ae10: 2c20 226e 6f74 6522 3a20 6e6f 7465 7d0a  , "note": note}.
+0000ae20: 0a20 2020 2064 6566 2072 656d 6f76 655f  .    def remove_
+0000ae30: 6d61 7374 6572 6461 7461 5f70 726f 7665  masterdata_prove
+0000ae40: 6e61 6e63 655f 6e6f 7465 2873 656c 662c  nance_note(self,
+0000ae50: 202a 2c20 6b65 793a 2073 7472 2c20 6e6f   *, key: str, no
+0000ae60: 7465 3a20 7374 7229 202d 3e20 4e6f 6e65  te: str) -> None
+0000ae70: 3a0a 2020 2020 2020 2020 2222 2252 656d  :.        """Rem
+0000ae80: 6f76 6520 6120 6d61 7374 6572 6461 7461  ove a masterdata
+0000ae90: 2070 726f 7665 6e61 6e63 6520 6e6f 7465   provenance note
+0000aea0: 2222 220a 2020 2020 2020 2020 6966 2022  """.        if "
+0000aeb0: 636f 6c72 6576 5f6d 6173 7465 7264 6174  colrev_masterdat
+0000aec0: 615f 7072 6f76 656e 616e 6365 2220 6e6f  a_provenance" no
+0000aed0: 7420 696e 2073 656c 662e 6461 7461 3a0a  t in self.data:.
+0000aee0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0000aef0: 726e 0a20 2020 2020 2020 2069 6620 6b65  rn.        if ke
+0000af00: 7920 6e6f 7420 696e 2073 656c 662e 6461  y not in self.da
+0000af10: 7461 5b22 636f 6c72 6576 5f6d 6173 7465  ta["colrev_maste
+0000af20: 7264 6174 615f 7072 6f76 656e 616e 6365  rdata_provenance
+0000af30: 225d 3a0a 2020 2020 2020 2020 2020 2020  "]:.            
+0000af40: 7265 7475 726e 0a20 2020 2020 2020 206e  return.        n
+0000af50: 6f74 6573 203d 2073 656c 662e 6461 7461  otes = self.data
+0000af60: 5b22 636f 6c72 6576 5f6d 6173 7465 7264  ["colrev_masterd
+0000af70: 6174 615f 7072 6f76 656e 616e 6365 225d  ata_provenance"]
+0000af80: 5b6b 6579 5d5b 226e 6f74 6522 5d2e 7370  [key]["note"].sp
+0000af90: 6c69 7428 222c 2229 0a20 2020 2020 2020  lit(",").       
+0000afa0: 2069 6620 6e6f 7465 206e 6f74 2069 6e20   if note not in 
+0000afb0: 6e6f 7465 733a 0a20 2020 2020 2020 2020  notes:.         
+0000afc0: 2020 2072 6574 7572 6e0a 2020 2020 2020     return.      
+0000afd0: 2020 7365 6c66 2e64 6174 615b 2263 6f6c    self.data["col
+0000afe0: 7265 765f 6d61 7374 6572 6461 7461 5f70  rev_masterdata_p
+0000aff0: 726f 7665 6e61 6e63 6522 5d5b 6b65 795d  rovenance"][key]
+0000b000: 5b22 6e6f 7465 225d 203d 2022 2c22 2e6a  ["note"] = ",".j
+0000b010: 6f69 6e28 0a20 2020 2020 2020 2020 2020  oin(.           
+0000b020: 206e 2066 6f72 206e 2069 6e20 6e6f 7465   n for n in note
+0000b030: 7320 6966 206e 2021 3d20 6e6f 7465 0a20  s if n != note. 
+0000b040: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
+0000b050: 6620 6164 645f 6d61 7374 6572 6461 7461  f add_masterdata
+0000b060: 5f70 726f 7665 6e61 6e63 655f 6e6f 7465  _provenance_note
+0000b070: 2873 656c 662c 202a 2c20 6b65 793a 2073  (self, *, key: s
+0000b080: 7472 2c20 6e6f 7465 3a20 7374 7229 202d  tr, note: str) -
+0000b090: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+0000b0a0: 2222 2241 6464 2061 206d 6173 7465 7264  """Add a masterd
+0000b0b0: 6174 6120 7072 6f76 656e 616e 6365 206e  ata provenance n
+0000b0c0: 6f74 6520 2862 6173 6564 206f 6e20 6120  ote (based on a 
+0000b0d0: 6b65 7929 2222 220a 2020 2020 2020 2020  key)""".        
+0000b0e0: 6966 2022 636f 6c72 6576 5f6d 6173 7465  if "colrev_maste
+0000b0f0: 7264 6174 615f 7072 6f76 656e 616e 6365  rdata_provenance
+0000b100: 2220 6e6f 7420 696e 2073 656c 662e 6461  " not in self.da
+0000b110: 7461 3a0a 2020 2020 2020 2020 2020 2020  ta:.            
+0000b120: 7365 6c66 2e64 6174 615b 2263 6f6c 7265  self.data["colre
+0000b130: 765f 6d61 7374 6572 6461 7461 5f70 726f  v_masterdata_pro
+0000b140: 7665 6e61 6e63 6522 5d20 3d20 7b7d 0a20  venance"] = {}. 
+0000b150: 2020 2020 2020 2069 6620 6b65 7920 696e         if key in
+0000b160: 2073 656c 662e 6461 7461 2e67 6574 2822   self.data.get("
+0000b170: 636f 6c72 6576 5f6d 6173 7465 7264 6174  colrev_masterdat
+0000b180: 615f 7072 6f76 656e 616e 6365 222c 207b  a_provenance", {
+0000b190: 7d29 3a0a 2020 2020 2020 2020 2020 2020  }):.            
+0000b1a0: 6966 2028 0a20 2020 2020 2020 2020 2020  if (.           
+0000b1b0: 2020 2020 2022 2220 3d3d 2073 656c 662e       "" == self.
+0000b1c0: 6461 7461 5b22 636f 6c72 6576 5f6d 6173  data["colrev_mas
+0000b1d0: 7465 7264 6174 615f 7072 6f76 656e 616e  terdata_provenan
+0000b1e0: 6365 225d 5b6b 6579 5d5b 226e 6f74 6522  ce"][key]["note"
+0000b1f0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+0000b200: 2020 6f72 2022 2220 3d3d 206e 6f74 650a    or "" == note.
+0000b210: 2020 2020 2020 2020 2020 2020 293a 0a20              ):. 
+0000b220: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000b230: 656c 662e 6461 7461 5b22 636f 6c72 6576  elf.data["colrev
+0000b240: 5f6d 6173 7465 7264 6174 615f 7072 6f76  _masterdata_prov
+0000b250: 656e 616e 6365 225d 5b6b 6579 5d5b 226e  enance"][key]["n
+0000b260: 6f74 6522 5d20 3d20 6e6f 7465 0a20 2020  ote"] = note.   
+0000b270: 2020 2020 2020 2020 2065 6c69 6620 6e6f           elif no
+0000b280: 7465 206e 6f74 2069 6e20 7365 6c66 2e64  te not in self.d
+0000b290: 6174 615b 2263 6f6c 7265 765f 6d61 7374  ata["colrev_mast
+0000b2a0: 6572 6461 7461 5f70 726f 7665 6e61 6e63  erdata_provenanc
+0000b2b0: 6522 5d5b 6b65 795d 5b0a 2020 2020 2020  e"][key][.      
+0000b2c0: 2020 2020 2020 2020 2020 226e 6f74 6522            "note"
+0000b2d0: 0a20 2020 2020 2020 2020 2020 205d 2e73  .            ].s
+0000b2e0: 706c 6974 2822 2c22 293a 0a20 2020 2020  plit(","):.     
+0000b2f0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000b300: 6461 7461 5b22 636f 6c72 6576 5f6d 6173  data["colrev_mas
+0000b310: 7465 7264 6174 615f 7072 6f76 656e 616e  terdata_provenan
+0000b320: 6365 225d 5b6b 6579 5d5b 226e 6f74 6522  ce"][key]["note"
+0000b330: 5d20 2b3d 2066 222c 7b6e 6f74 657d 220a  ] += f",{note}".
+0000b340: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0000b350: 2020 2020 2020 2020 2020 7365 6c66 2e64            self.d
+0000b360: 6174 615b 2263 6f6c 7265 765f 6d61 7374  ata["colrev_mast
+0000b370: 6572 6461 7461 5f70 726f 7665 6e61 6e63  erdata_provenanc
+0000b380: 6522 5d5b 6b65 795d 203d 207b 0a20 2020  e"][key] = {.   
+0000b390: 2020 2020 2020 2020 2020 2020 2022 736f               "so
+0000b3a0: 7572 6365 223a 2022 4f52 4947 494e 414c  urce": "ORIGINAL
+0000b3b0: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+0000b3c0: 2020 2022 6e6f 7465 223a 206e 6f74 652c     "note": note,
+0000b3d0: 0a20 2020 2020 2020 2020 2020 207d 0a0a  .            }..
+0000b3e0: 2020 2020 2020 2020 6578 6973 7469 6e67          existing
+0000b3f0: 5f6e 6f74 6520 3d20 7365 6c66 2e64 6174  _note = self.dat
+0000b400: 615b 2263 6f6c 7265 765f 6d61 7374 6572  a["colrev_master
+0000b410: 6461 7461 5f70 726f 7665 6e61 6e63 6522  data_provenance"
+0000b420: 5d5b 6b65 795d 5b22 6e6f 7465 225d 0a20  ][key]["note"]. 
+0000b430: 2020 2020 2020 2069 6620 2271 7561 6c69         if "quali
+0000b440: 7479 5f64 6566 6563 7422 2069 6e20 6578  ty_defect" in ex
+0000b450: 6973 7469 6e67 5f6e 6f74 6520 616e 6420  isting_note and 
+0000b460: 616e 7928 0a20 2020 2020 2020 2020 2020  any(.           
+0000b470: 2078 2069 6e20 6578 6973 7469 6e67 5f6e   x in existing_n
+0000b480: 6f74 6520 666f 7220 7820 696e 205b 226d  ote for x in ["m
+0000b490: 6973 7369 6e67 222c 2022 6469 7361 6772  issing", "disagr
+0000b4a0: 6565 6d65 6e74 225d 0a20 2020 2020 2020  eement"].       
+0000b4b0: 2029 3a0a 2020 2020 2020 2020 2020 2020   ):.            
+0000b4c0: 7365 6c66 2e64 6174 615b 2263 6f6c 7265  self.data["colre
+0000b4d0: 765f 6d61 7374 6572 6461 7461 5f70 726f  v_masterdata_pro
+0000b4e0: 7665 6e61 6e63 6522 5d5b 6b65 795d 5b22  venance"][key]["
+0000b4f0: 6e6f 7465 225d 203d 2028 0a20 2020 2020  note"] = (.     
+0000b500: 2020 2020 2020 2020 2020 2065 7869 7374             exist
+0000b510: 696e 675f 6e6f 7465 2e72 6570 6c61 6365  ing_note.replace
+0000b520: 2822 7175 616c 6974 795f 6465 6665 6374  ("quality_defect
+0000b530: 222c 2022 2229 2e72 7374 7269 7028 222c  ", "").rstrip(",
+0000b540: 2229 2e6c 7374 7269 7028 222c 2229 0a20  ").lstrip(","). 
+0000b550: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
+0000b560: 2020 6465 6620 6164 645f 6461 7461 5f70    def add_data_p
+0000b570: 726f 7665 6e61 6e63 655f 6e6f 7465 2873  rovenance_note(s
+0000b580: 656c 662c 202a 2c20 6b65 793a 2073 7472  elf, *, key: str
+0000b590: 2c20 6e6f 7465 3a20 7374 7229 202d 3e20  , note: str) -> 
+0000b5a0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
+0000b5b0: 2241 6464 2061 2064 6174 6120 7072 6f76  "Add a data prov
+0000b5c0: 656e 616e 6365 206e 6f74 6520 2862 6173  enance note (bas
+0000b5d0: 6564 206f 6e20 6120 6b65 7929 2222 220a  ed on a key)""".
+0000b5e0: 2020 2020 2020 2020 6966 2022 636f 6c72          if "colr
+0000b5f0: 6576 5f64 6174 615f 7072 6f76 656e 616e  ev_data_provenan
+0000b600: 6365 2220 6e6f 7420 696e 2073 656c 662e  ce" not in self.
+0000b610: 6461 7461 3a0a 2020 2020 2020 2020 2020  data:.          
+0000b620: 2020 7365 6c66 2e64 6174 615b 2263 6f6c    self.data["col
+0000b630: 7265 765f 6461 7461 5f70 726f 7665 6e61  rev_data_provena
+0000b640: 6e63 6522 5d20 3d20 7b7d 0a20 2020 2020  nce"] = {}.     
+0000b650: 2020 2069 6620 6b65 7920 696e 2073 656c     if key in sel
+0000b660: 662e 6461 7461 5b22 636f 6c72 6576 5f64  f.data["colrev_d
+0000b670: 6174 615f 7072 6f76 656e 616e 6365 225d  ata_provenance"]
+0000b680: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+0000b690: 2073 656c 662e 6461 7461 5b22 636f 6c72   self.data["colr
+0000b6a0: 6576 5f64 6174 615f 7072 6f76 656e 616e  ev_data_provenan
+0000b6b0: 6365 225d 5b6b 6579 5d5b 226e 6f74 6522  ce"][key]["note"
+0000b6c0: 5d20 3d3d 2022 223a 0a20 2020 2020 2020  ] == "":.       
+0000b6d0: 2020 2020 2020 2020 2073 656c 662e 6461           self.da
+0000b6e0: 7461 5b22 636f 6c72 6576 5f64 6174 615f  ta["colrev_data_
+0000b6f0: 7072 6f76 656e 616e 6365 225d 5b6b 6579  provenance"][key
+0000b700: 5d5b 226e 6f74 6522 5d20 3d20 6e6f 7465  ]["note"] = note
+0000b710: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
+0000b720: 6620 6e6f 7465 206e 6f74 2069 6e20 7365  f note not in se
+0000b730: 6c66 2e64 6174 615b 2263 6f6c 7265 765f  lf.data["colrev_
+0000b740: 6461 7461 5f70 726f 7665 6e61 6e63 6522  data_provenance"
+0000b750: 5d5b 6b65 795d 5b22 6e6f 7465 225d 2e73  ][key]["note"].s
+0000b760: 706c 6974 280a 2020 2020 2020 2020 2020  plit(.          
+0000b770: 2020 2020 2020 222c 220a 2020 2020 2020        ",".      
+0000b780: 2020 2020 2020 293a 0a20 2020 2020 2020        ):.       
+0000b790: 2020 2020 2020 2020 2073 656c 662e 6461           self.da
+0000b7a0: 7461 5b22 636f 6c72 6576 5f64 6174 615f  ta["colrev_data_
+0000b7b0: 7072 6f76 656e 616e 6365 225d 5b6b 6579  provenance"][key
+0000b7c0: 5d5b 226e 6f74 6522 5d20 2b3d 2066 222c  ]["note"] += f",
+0000b7d0: 7b6e 6f74 657d 220a 2020 2020 2020 2020  {note}".        
+0000b7e0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0000b7f0: 2020 7365 6c66 2e64 6174 615b 2263 6f6c    self.data["col
+0000b800: 7265 765f 6461 7461 5f70 726f 7665 6e61  rev_data_provena
+0000b810: 6e63 6522 5d5b 6b65 795d 203d 207b 0a20  nce"][key] = {. 
+0000b820: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0000b830: 736f 7572 6365 223a 2022 4f52 4947 494e  source": "ORIGIN
+0000b840: 414c 222c 0a20 2020 2020 2020 2020 2020  AL",.           
+0000b850: 2020 2020 2022 6e6f 7465 223a 206e 6f74       "note": not
+0000b860: 652c 0a20 2020 2020 2020 2020 2020 207d  e,.            }
+0000b870: 0a0a 2020 2020 6465 6620 6164 645f 6d61  ..    def add_ma
+0000b880: 7374 6572 6461 7461 5f70 726f 7665 6e61  sterdata_provena
+0000b890: 6e63 6528 0a20 2020 2020 2020 2073 656c  nce(.        sel
+0000b8a0: 662c 202a 2c20 6b65 793a 2073 7472 2c20  f, *, key: str, 
+0000b8b0: 736f 7572 6365 3a20 7374 722c 206e 6f74  source: str, not
+0000b8c0: 653a 2073 7472 203d 2022 220a 2020 2020  e: str = "".    
+0000b8d0: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+0000b8e0: 2020 2022 2222 4164 6420 6120 6d61 7374     """Add a mast
+0000b8f0: 6572 6461 7461 2070 726f 7665 6e61 6e63  erdata provenanc
+0000b900: 652c 2069 6e63 6c75 6469 6e67 2073 6f75  e, including sou
+0000b910: 7263 6520 616e 6420 6e6f 7465 2028 6261  rce and note (ba
+0000b920: 7365 6420 6f6e 2061 206b 6579 2922 2222  sed on a key)"""
+0000b930: 0a20 2020 2020 2020 2069 6620 2263 6f6c  .        if "col
+0000b940: 7265 765f 6d61 7374 6572 6461 7461 5f70  rev_masterdata_p
+0000b950: 726f 7665 6e61 6e63 6522 206e 6f74 2069  rovenance" not i
+0000b960: 6e20 7365 6c66 2e64 6174 613a 0a20 2020  n self.data:.   
+0000b970: 2020 2020 2020 2020 2073 656c 662e 6461           self.da
+0000b980: 7461 5b22 636f 6c72 6576 5f6d 6173 7465  ta["colrev_maste
+0000b990: 7264 6174 615f 7072 6f76 656e 616e 6365  rdata_provenance
+0000b9a0: 225d 203d 207b 7d0a 2020 2020 2020 2020  "] = {}.        
+0000b9b0: 6d64 5f70 5f64 6963 7420 3d20 7365 6c66  md_p_dict = self
+0000b9c0: 2e64 6174 615b 2263 6f6c 7265 765f 6d61  .data["colrev_ma
+0000b9d0: 7374 6572 6461 7461 5f70 726f 7665 6e61  sterdata_provena
+0000b9e0: 6e63 6522 5d0a 0a20 2020 2020 2020 2069  nce"]..        i
+0000b9f0: 6620 6b65 7920 696e 206d 645f 705f 6469  f key in md_p_di
+0000ba00: 6374 3a0a 2020 2020 2020 2020 2020 2020  ct:.            
+0000ba10: 6966 206d 645f 705f 6469 6374 5b6b 6579  if md_p_dict[key
+0000ba20: 5d5b 226e 6f74 6522 5d20 3d3d 2022 2220  ]["note"] == "" 
+0000ba30: 6f72 2022 2220 3d3d 206e 6f74 653a 0a20  or "" == note:. 
+0000ba40: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+0000ba50: 645f 705f 6469 6374 5b6b 6579 5d5b 226e  d_p_dict[key]["n
+0000ba60: 6f74 6522 5d20 3d20 6e6f 7465 0a20 2020  ote"] = note.   
+0000ba70: 2020 2020 2020 2020 2065 6c69 6620 226d           elif "m
+0000ba80: 6973 7369 6e67 2220 3d3d 206e 6f74 6520  issing" == note 
+0000ba90: 616e 6420 226e 6f74 2d6d 6973 7369 6e67  and "not-missing
+0000baa0: 2220 696e 206d 645f 705f 6469 6374 5b6b  " in md_p_dict[k
+0000bab0: 6579 5d5b 226e 6f74 6522 5d2e 7370 6c69  ey]["note"].spli
+0000bac0: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
+0000bad0: 2020 2022 2c22 0a20 2020 2020 2020 2020     ",".         
+0000bae0: 2020 2029 3a0a 2020 2020 2020 2020 2020     ):.          
+0000baf0: 2020 2020 2020 6d64 5f70 5f64 6963 745b        md_p_dict[
+0000bb00: 6b65 795d 5b22 6e6f 7465 225d 203d 2022  key]["note"] = "
+0000bb10: 6d69 7373 696e 6722 0a20 2020 2020 2020  missing".       
+0000bb20: 2020 2020 2065 6c69 6620 6e6f 7465 206e       elif note n
+0000bb30: 6f74 2069 6e20 6d64 5f70 5f64 6963 745b  ot in md_p_dict[
+0000bb40: 6b65 795d 5b22 6e6f 7465 225d 2e73 706c  key]["note"].spl
+0000bb50: 6974 2822 2c22 293a 0a20 2020 2020 2020  it(","):.       
+0000bb60: 2020 2020 2020 2020 206d 645f 705f 6469           md_p_di
+0000bb70: 6374 5b6b 6579 5d5b 226e 6f74 6522 5d20  ct[key]["note"] 
+0000bb80: 2b3d 2066 222c 7b6e 6f74 657d 220a 2020  += f",{note}".  
+0000bb90: 2020 2020 2020 2020 2020 6d64 5f70 5f64            md_p_d
+0000bba0: 6963 745b 6b65 795d 5b22 736f 7572 6365  ict[key]["source
+0000bbb0: 225d 203d 2073 6f75 7263 650a 2020 2020  "] = source.    
+0000bbc0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0000bbd0: 2020 2020 2020 6d64 5f70 5f64 6963 745b        md_p_dict[
+0000bbe0: 6b65 795d 203d 207b 2273 6f75 7263 6522  key] = {"source"
+0000bbf0: 3a20 736f 7572 6365 2c20 226e 6f74 6522  : source, "note"
+0000bc00: 3a20 6622 7b6e 6f74 657d 227d 0a0a 2020  : f"{note}"}..  
+0000bc10: 2020 6465 6620 6164 645f 7072 6f76 656e    def add_proven
+0000bc20: 616e 6365 5f61 6c6c 2873 656c 662c 202a  ance_all(self, *
+0000bc30: 2c20 736f 7572 6365 3a20 7374 7229 202d  , source: str) -
+0000bc40: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+0000bc50: 2222 2241 6464 2061 2064 6174 6120 7072  """Add a data pr
+0000bc60: 6f76 656e 616e 6365 2028 736f 7572 6365  ovenance (source
+0000bc70: 2920 746f 2061 6c6c 2066 6965 6c64 7322  ) to all fields"
+0000bc80: 2222 0a20 2020 2020 2020 2069 6620 2263  "".        if "c
+0000bc90: 6f6c 7265 765f 6d61 7374 6572 6461 7461  olrev_masterdata
+0000bca0: 5f70 726f 7665 6e61 6e63 6522 206e 6f74  _provenance" not
+0000bcb0: 2069 6e20 7365 6c66 2e64 6174 613a 0a20   in self.data:. 
+0000bcc0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000bcd0: 6461 7461 5b22 636f 6c72 6576 5f6d 6173  data["colrev_mas
+0000bce0: 7465 7264 6174 615f 7072 6f76 656e 616e  terdata_provenan
+0000bcf0: 6365 225d 203d 207b 7d0a 2020 2020 2020  ce"] = {}.      
+0000bd00: 2020 6966 2022 636f 6c72 6576 5f64 6174    if "colrev_dat
+0000bd10: 615f 7072 6f76 656e 616e 6365 2220 6e6f  a_provenance" no
+0000bd20: 7420 696e 2073 656c 662e 6461 7461 3a0a  t in self.data:.
+0000bd30: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000bd40: 2e64 6174 615b 2263 6f6c 7265 765f 6461  .data["colrev_da
+0000bd50: 7461 5f70 726f 7665 6e61 6e63 6522 5d20  ta_provenance"] 
+0000bd60: 3d20 7b7d 0a0a 2020 2020 2020 2020 6d64  = {}..        md
+0000bd70: 5f70 5f64 6963 7420 3d20 7365 6c66 2e64  _p_dict = self.d
+0000bd80: 6174 615b 2263 6f6c 7265 765f 6d61 7374  ata["colrev_mast
+0000bd90: 6572 6461 7461 5f70 726f 7665 6e61 6e63  erdata_provenanc
+0000bda0: 6522 5d0a 2020 2020 2020 2020 645f 705f  e"].        d_p_
+0000bdb0: 6469 6374 203d 2073 656c 662e 6461 7461  dict = self.data
+0000bdc0: 5b22 636f 6c72 6576 5f64 6174 615f 7072  ["colrev_data_pr
+0000bdd0: 6f76 656e 616e 6365 225d 0a20 2020 2020  ovenance"].     
+0000bde0: 2020 2066 6f72 206b 6579 2069 6e20 7365     for key in se
+0000bdf0: 6c66 2e64 6174 612e 6b65 7973 2829 3a0a  lf.data.keys():.
+0000be00: 2020 2020 2020 2020 2020 2020 6966 206b              if k
+0000be10: 6579 2069 6e20 5b0a 2020 2020 2020 2020  ey in [.        
+0000be20: 2020 2020 2020 2020 2245 4e54 5259 5459          "ENTRYTY
+0000be30: 5045 222c 0a20 2020 2020 2020 2020 2020  PE",.           
+0000be40: 2020 2020 2022 636f 6c72 6576 5f64 6174       "colrev_dat
+0000be50: 615f 7072 6f76 656e 616e 6365 222c 0a20  a_provenance",. 
+0000be60: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0000be70: 636f 6c72 6576 5f6d 6173 7465 7264 6174  colrev_masterdat
+0000be80: 615f 7072 6f76 656e 616e 6365 222c 0a20  a_provenance",. 
+0000be90: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0000bea0: 636f 6c72 6576 5f73 7461 7475 7322 2c0a  colrev_status",.
+0000beb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bec0: 2263 6f6c 7265 765f 6964 222c 0a20 2020  "colrev_id",.   
+0000bed0: 2020 2020 2020 2020 205d 3a0a 2020 2020           ]:.    
+0000bee0: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+0000bef0: 696e 7565 0a20 2020 2020 2020 2020 2020  inue.           
+0000bf00: 2069 6620 280a 2020 2020 2020 2020 2020   if (.          
+0000bf10: 2020 2020 2020 6b65 7920 696e 2073 656c        key in sel
+0000bf20: 662e 6964 656e 7469 6679 696e 675f 6669  f.identifying_fi
+0000bf30: 656c 645f 6b65 7973 0a20 2020 2020 2020  eld_keys.       
+0000bf40: 2020 2020 2020 2020 2061 6e64 2022 4355           and "CU
+0000bf50: 5241 5445 4422 206e 6f74 2069 6e20 7365  RATED" not in se
+0000bf60: 6c66 2e64 6174 615b 2263 6f6c 7265 765f  lf.data["colrev_
+0000bf70: 6d61 7374 6572 6461 7461 5f70 726f 7665  masterdata_prove
+0000bf80: 6e61 6e63 6522 5d0a 2020 2020 2020 2020  nance"].        
+0000bf90: 2020 2020 293a 0a20 2020 2020 2020 2020      ):.         
+0000bfa0: 2020 2020 2020 206d 645f 705f 6469 6374         md_p_dict
+0000bfb0: 5b6b 6579 5d20 3d20 7b22 736f 7572 6365  [key] = {"source
+0000bfc0: 223a 2073 6f75 7263 652c 2022 6e6f 7465  ": source, "note
+0000bfd0: 223a 2022 227d 0a20 2020 2020 2020 2020  ": ""}.         
+0000bfe0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0000bff0: 2020 2020 2020 2020 2064 5f70 5f64 6963           d_p_dic
+0000c000: 745b 6b65 795d 203d 207b 2273 6f75 7263  t[key] = {"sourc
+0000c010: 6522 3a20 736f 7572 6365 2c20 226e 6f74  e": source, "not
+0000c020: 6522 3a20 2222 7d0a 0a20 2020 2064 6566  e": ""}..    def
+0000c030: 2061 6464 5f64 6174 615f 7072 6f76 656e   add_data_proven
+0000c040: 616e 6365 2873 656c 662c 202a 2c20 6b65  ance(self, *, ke
+0000c050: 793a 2073 7472 2c20 736f 7572 6365 3a20  y: str, source: 
+0000c060: 7374 722c 206e 6f74 653a 2073 7472 203d  str, note: str =
+0000c070: 2022 2229 202d 3e20 4e6f 6e65 3a0a 2020   "") -> None:.  
+0000c080: 2020 2020 2020 2222 2241 6464 2061 2064        """Add a d
+0000c090: 6174 6120 7072 6f76 656e 616e 6365 2c20  ata provenance, 
+0000c0a0: 696e 636c 7564 696e 6720 736f 7572 6365  including source
+0000c0b0: 2061 6e64 206e 6f74 6520 2862 6173 6564   and note (based
+0000c0c0: 206f 6e20 6120 6b65 7929 2222 220a 2020   on a key)""".  
+0000c0d0: 2020 2020 2020 6966 2022 636f 6c72 6576        if "colrev
+0000c0e0: 5f64 6174 615f 7072 6f76 656e 616e 6365  _data_provenance
+0000c0f0: 2220 6e6f 7420 696e 2073 656c 662e 6461  " not in self.da
+0000c100: 7461 3a0a 2020 2020 2020 2020 2020 2020  ta:.            
+0000c110: 7365 6c66 2e64 6174 615b 2263 6f6c 7265  self.data["colre
+0000c120: 765f 6461 7461 5f70 726f 7665 6e61 6e63  v_data_provenanc
+0000c130: 6522 5d20 3d20 7b7d 0a20 2020 2020 2020  e"] = {}.       
+0000c140: 206d 645f 705f 6469 6374 203d 2073 656c   md_p_dict = sel
+0000c150: 662e 6461 7461 5b22 636f 6c72 6576 5f64  f.data["colrev_d
+0000c160: 6174 615f 7072 6f76 656e 616e 6365 225d  ata_provenance"]
+0000c170: 0a20 2020 2020 2020 2069 6620 6b65 7920  .        if key 
+0000c180: 696e 206d 645f 705f 6469 6374 3a0a 2020  in md_p_dict:.  
+0000c190: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+0000c1a0: 6520 213d 2022 223a 0a20 2020 2020 2020  e != "":.       
+0000c1b0: 2020 2020 2020 2020 206d 645f 705f 6469           md_p_di
+0000c1c0: 6374 5b6b 6579 5d5b 226e 6f74 6522 5d20  ct[key]["note"] 
+0000c1d0: 2b3d 2066 222c 7b6e 6f74 657d 220a 2020  += f",{note}".  
+0000c1e0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+0000c1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c200: 6d64 5f70 5f64 6963 745b 6b65 795d 5b22  md_p_dict[key]["
+0000c210: 6e6f 7465 225d 203d 2022 220a 2020 2020  note"] = "".    
+0000c220: 2020 2020 2020 2020 6d64 5f70 5f64 6963          md_p_dic
+0000c230: 745b 6b65 795d 5b22 736f 7572 6365 225d  t[key]["source"]
+0000c240: 203d 2073 6f75 7263 650a 2020 2020 2020   = source.      
+0000c250: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0000c260: 2020 2020 6d64 5f70 5f64 6963 745b 6b65      md_p_dict[ke
+0000c270: 795d 203d 207b 2273 6f75 7263 6522 3a20  y] = {"source": 
+0000c280: 736f 7572 6365 2c20 226e 6f74 6522 3a20  source, "note": 
+0000c290: 6622 7b6e 6f74 657d 227d 0a0a 2020 2020  f"{note}"}..    
+0000c2a0: 6465 6620 636f 6d70 6c65 7465 5f70 726f  def complete_pro
+0000c2b0: 7665 6e61 6e63 6528 7365 6c66 2c20 2a2c  venance(self, *,
+0000c2c0: 2073 6f75 7263 655f 696e 666f 3a20 7374   source_info: st
+0000c2d0: 7229 202d 3e20 626f 6f6c 3a0a 2020 2020  r) -> bool:.    
+0000c2e0: 2020 2020 2222 2243 6f6d 706c 6574 6520      """Complete 
+0000c2f0: 7072 6f76 656e 616e 6365 2069 6e66 6f72  provenance infor
+0000c300: 6d61 7469 6f6e 2066 6f72 2069 6e64 6578  mation for index
+0000c310: 696e 6722 2222 0a0a 2020 2020 2020 2020  ing"""..        
+0000c320: 666f 7220 6b65 7920 696e 206c 6973 7428  for key in list(
+0000c330: 7365 6c66 2e64 6174 612e 6b65 7973 2829  self.data.keys()
+0000c340: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
+0000c350: 6620 280a 2020 2020 2020 2020 2020 2020  f (.            
+0000c360: 2020 2020 6b65 790a 2020 2020 2020 2020      key.        
+0000c370: 2020 2020 2020 2020 696e 205b 0a20 2020          in [.   
+0000c380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c390: 2022 636f 6c72 6576 5f69 6422 2c0a 2020   "colrev_id",.  
+0000c3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c3b0: 2020 2245 4e54 5259 5459 5045 222c 0a20    "ENTRYTYPE",. 
+0000c3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c3d0: 2020 2022 4944 222c 0a20 2020 2020 2020     "ID",.       
+0000c3e0: 2020 2020 2020 2020 2020 2020 2022 6d65               "me
+0000c3f0: 7461 6461 7461 5f73 6f75 7263 655f 7265  tadata_source_re
+0000c400: 706f 7369 746f 7279 5f70 6174 6873 222c  pository_paths",
+0000c410: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c420: 2020 2020 2022 6c6f 6361 6c5f 6375 7261       "local_cura
+0000c430: 7465 645f 6d65 7461 6461 7461 222c 0a20  ted_metadata",. 
+0000c440: 2020 2020 2020 2020 2020 2020 2020 205d                 ]
+0000c450: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c460: 202b 2073 656c 662e 7072 6f76 656e 616e   + self.provenan
+0000c470: 6365 5f6b 6579 730a 2020 2020 2020 2020  ce_keys.        
+0000c480: 2020 2020 293a 0a20 2020 2020 2020 2020      ):.         
+0000c490: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
+0000c4a0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000c4b0: 6b65 7920 696e 2073 656c 662e 6964 656e  key in self.iden
+0000c4c0: 7469 6679 696e 675f 6669 656c 645f 6b65  tifying_field_ke
+0000c4d0: 7973 3a0a 2020 2020 2020 2020 2020 2020  ys:.            
+0000c4e0: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
+0000c4f0: 6d61 7374 6572 6461 7461 5f69 735f 6375  masterdata_is_cu
+0000c500: 7261 7465 6428 293a 0a20 2020 2020 2020  rated():.       
+0000c510: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0000c520: 662e 6164 645f 6d61 7374 6572 6461 7461  f.add_masterdata
+0000c530: 5f70 726f 7665 6e61 6e63 6528 6b65 793d  _provenance(key=
+0000c540: 6b65 792c 2073 6f75 7263 653d 736f 7572  key, source=sour
+0000c550: 6365 5f69 6e66 6f2c 206e 6f74 653d 2222  ce_info, note=""
+0000c560: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
+0000c570: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0000c580: 2020 2020 7365 6c66 2e61 6464 5f64 6174      self.add_dat
+0000c590: 615f 7072 6f76 656e 616e 6365 286b 6579  a_provenance(key
+0000c5a0: 3d6b 6579 2c20 736f 7572 6365 3d73 6f75  =key, source=sou
+0000c5b0: 7263 655f 696e 666f 2c20 6e6f 7465 3d22  rce_info, note="
+0000c5c0: 2229 0a0a 2020 2020 2020 2020 7265 7475  ")..        retu
+0000c5d0: 726e 2054 7275 650a 0a20 2020 2064 6566  rn True..    def
+0000c5e0: 2068 6173 5f71 7561 6c69 7479 5f64 6566   has_quality_def
+0000c5f0: 6563 7473 2873 656c 6629 202d 3e20 626f  ects(self) -> bo
+0000c600: 6f6c 3a0a 2020 2020 2020 2020 2222 2243  ol:.        """C
+0000c610: 6865 636b 2077 6865 7468 6572 2061 2072  heck whether a r
+0000c620: 6563 6f72 6420 6861 7320 7175 616c 6974  ecord has qualit
+0000c630: 7920 6465 6665 6374 7322 2222 0a20 2020  y defects""".   
+0000c640: 2020 2020 2072 6574 7572 6e20 616e 7928       return any(
+0000c650: 0a20 2020 2020 2020 2020 2020 2078 5b22  .            x["
+0000c660: 6e6f 7465 225d 2021 3d20 2222 0a20 2020  note"] != "".   
+0000c670: 2020 2020 2020 2020 2066 6f72 2078 2069           for x i
+0000c680: 6e20 7365 6c66 2e64 6174 612e 6765 7428  n self.data.get(
+0000c690: 2263 6f6c 7265 765f 6d61 7374 6572 6461  "colrev_masterda
+0000c6a0: 7461 5f70 726f 7665 6e61 6e63 6522 2c20  ta_provenance", 
+0000c6b0: 7b7d 292e 7661 6c75 6573 2829 0a20 2020  {}).values().   
+0000c6c0: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+0000c6d0: 616e 7928 7920 3d3d 2078 5b22 6e6f 7465  any(y == x["note
+0000c6e0: 225d 2066 6f72 2079 2069 6e20 5b22 6e6f  "] for y in ["no
+0000c6f0: 742d 6d69 7373 696e 6722 5d29 0a20 2020  t-missing"]).   
+0000c700: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
+0000c710: 6765 745f 636f 6e74 6169 6e65 725f 7469  get_container_ti
+0000c720: 746c 6528 7365 6c66 2920 2d3e 2073 7472  tle(self) -> str
+0000c730: 3a0a 2020 2020 2020 2020 2222 2247 6574  :.        """Get
+0000c740: 2074 6865 2072 6563 6f72 6427 7320 636f   the record's co
+0000c750: 6e74 6169 6e65 7220 7469 746c 6520 286a  ntainer title (j
+0000c760: 6f75 726e 616c 206e 616d 652c 2062 6f6f  ournal name, boo
+0000c770: 6b74 6974 6c65 2c20 6574 632e 2922 2222  ktitle, etc.)"""
+0000c780: 0a20 2020 2020 2020 2063 6f6e 7461 696e  .        contain
+0000c790: 6572 5f74 6974 6c65 203d 2022 4e41 220a  er_title = "NA".
+0000c7a0: 2020 2020 2020 2020 6966 2022 454e 5452          if "ENTR
+0000c7b0: 5954 5950 4522 206e 6f74 2069 6e20 7365  YTYPE" not in se
+0000c7c0: 6c66 2e64 6174 613a 0a20 2020 2020 2020  lf.data:.       
+0000c7d0: 2020 2020 2063 6f6e 7461 696e 6572 5f74       container_t
+0000c7e0: 6974 6c65 203d 2073 656c 662e 6461 7461  itle = self.data
+0000c7f0: 2e67 6574 2822 6a6f 7572 6e61 6c22 2c20  .get("journal", 
+0000c800: 7365 6c66 2e64 6174 612e 6765 7428 2262  self.data.get("b
+0000c810: 6f6f 6b74 6974 6c65 222c 2022 4e41 2229  ooktitle", "NA")
+0000c820: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
+0000c830: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+0000c840: 656c 662e 6461 7461 5b22 454e 5452 5954  elf.data["ENTRYT
+0000c850: 5950 4522 5d20 3d3d 2022 6172 7469 636c  YPE"] == "articl
+0000c860: 6522 3a0a 2020 2020 2020 2020 2020 2020  e":.            
+0000c870: 2020 2020 636f 6e74 6169 6e65 725f 7469      container_ti
+0000c880: 746c 6520 3d20 7365 6c66 2e64 6174 612e  tle = self.data.
+0000c890: 6765 7428 226a 6f75 726e 616c 222c 2022  get("journal", "
+0000c8a0: 4e41 2229 0a20 2020 2020 2020 2020 2020  NA").           
+0000c8b0: 2069 6620 7365 6c66 2e64 6174 615b 2245   if self.data["E
+0000c8c0: 4e54 5259 5459 5045 225d 203d 3d20 2269  NTRYTYPE"] == "i
+0000c8d0: 6e70 726f 6365 6564 696e 6773 223a 0a20  nproceedings":. 
+0000c8e0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0000c8f0: 6f6e 7461 696e 6572 5f74 6974 6c65 203d  ontainer_title =
+0000c900: 2073 656c 662e 6461 7461 2e67 6574 2822   self.data.get("
+0000c910: 626f 6f6b 7469 746c 6522 2c20 224e 4122  booktitle", "NA"
+0000c920: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+0000c930: 2073 656c 662e 6461 7461 5b22 454e 5452   self.data["ENTR
+0000c940: 5954 5950 4522 5d20 3d3d 2022 626f 6f6b  YTYPE"] == "book
+0000c950: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
+0000c960: 2020 2063 6f6e 7461 696e 6572 5f74 6974     container_tit
+0000c970: 6c65 203d 2073 656c 662e 6461 7461 2e67  le = self.data.g
+0000c980: 6574 2822 7469 746c 6522 2c20 224e 4122  et("title", "NA"
+0000c990: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+0000c9a0: 2073 656c 662e 6461 7461 5b22 454e 5452   self.data["ENTR
+0000c9b0: 5954 5950 4522 5d20 3d3d 2022 696e 626f  YTYPE"] == "inbo
+0000c9c0: 6f6b 223a 0a20 2020 2020 2020 2020 2020  ok":.           
+0000c9d0: 2020 2020 2063 6f6e 7461 696e 6572 5f74       container_t
+0000c9e0: 6974 6c65 203d 2073 656c 662e 6461 7461  itle = self.data
+0000c9f0: 2e67 6574 2822 626f 6f6b 7469 746c 6522  .get("booktitle"
+0000ca00: 2c20 224e 4122 290a 2020 2020 2020 2020  , "NA").        
+0000ca10: 7265 7475 726e 2063 6f6e 7461 696e 6572  return container
+0000ca20: 5f74 6974 6c65 0a0a 2020 2020 6465 6620  _title..    def 
+0000ca30: 6372 6561 7465 5f63 6f6c 7265 765f 6964  create_colrev_id
+0000ca40: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
+0000ca50: 2020 2020 2020 2020 2a2c 0a20 2020 2020          *,.     
+0000ca60: 2020 2061 7373 756d 655f 636f 6d70 6c65     assume_comple
+0000ca70: 7465 3a20 626f 6f6c 203d 2046 616c 7365  te: bool = False
+0000ca80: 2c0a 2020 2020 2920 2d3e 2073 7472 3a0a  ,.    ) -> str:.
+0000ca90: 2020 2020 2020 2020 2222 2252 6574 7572          """Retur
+0000caa0: 6e73 2074 6865 2063 6f6c 7265 765f 6964  ns the colrev_id
+0000cab0: 206f 6620 7468 6520 5265 636f 7264 2e22   of the Record."
+0000cac0: 2222 0a0a 2020 2020 2020 2020 7265 7475  ""..        retu
+0000cad0: 726e 2063 6f6c 7265 762e 716d 2e63 6f6c  rn colrev.qm.col
+0000cae0: 7265 765f 6964 2e63 7265 6174 655f 636f  rev_id.create_co
+0000caf0: 6c72 6576 5f69 6428 0a20 2020 2020 2020  lrev_id(.       
+0000cb00: 2020 2020 2072 6563 6f72 643d 7365 6c66       record=self
+0000cb10: 2c0a 2020 2020 2020 2020 2020 2020 6173  ,.            as
+0000cb20: 7375 6d65 5f63 6f6d 706c 6574 653d 6173  sume_complete=as
+0000cb30: 7375 6d65 5f63 6f6d 706c 6574 652c 0a20  sume_complete,. 
+0000cb40: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
+0000cb50: 6620 7072 6573 6372 6565 6e5f 6578 636c  f prescreen_excl
+0000cb60: 7564 6528 7365 6c66 2c20 2a2c 2072 6561  ude(self, *, rea
+0000cb70: 736f 6e3a 2073 7472 2c20 7072 696e 745f  son: str, print_
+0000cb80: 7761 726e 696e 673a 2062 6f6f 6c20 3d20  warning: bool = 
+0000cb90: 4661 6c73 6529 202d 3e20 4e6f 6e65 3a0a  False) -> None:.
+0000cba0: 2020 2020 2020 2020 2222 2250 7265 7363          """Presc
+0000cbb0: 7265 656e 2d65 7863 6c75 6465 2061 2072  reen-exclude a r
+0000cbc0: 6563 6f72 6422 2222 0a20 2020 2020 2020  ecord""".       
+0000cbd0: 2023 2057 6172 6e20 7768 656e 2073 6574   # Warn when set
+0000cbe0: 7469 6e67 2072 6576 5f73 796e 7468 6573  ting rev_synthes
+0000cbf0: 697a 6564 2f72 6576 5f69 6e63 6c75 6465  ized/rev_include
+0000cc00: 6420 746f 2070 7265 7363 7265 656e 5f65  d to prescreen_e
+0000cc10: 7863 6c75 6465 640a 2020 2020 2020 2020  xcluded.        
+0000cc20: 2320 4573 7065 6369 616c 6c79 2069 6e20  # Especially in 
+0000cc30: 6361 7365 7320 696e 2077 6869 6368 2074  cases in which t
+0000cc40: 6865 2070 7265 7363 7265 656e 2d65 7863  he prescreen-exc
+0000cc50: 6c75 7369 6f6e 2064 6563 6973 696f 6e0a  lusion decision.
+0000cc60: 2020 2020 2020 2020 2320 6973 2072 6576          # is rev
+0000cc70: 6973 6564 2028 652e 672e 2c20 6265 6361  ised (e.g., beca
+0000cc80: 7573 6520 6120 7061 7065 7220 7761 7320  use a paper was 
+0000cc90: 7265 7472 6163 7465 6429 0a20 2020 2020  retracted).     
+0000cca0: 2020 2023 2049 6e20 7468 6573 6520 6361     # In these ca
+0000ccb0: 7365 732c 2074 6865 2070 6170 6572 206d  ses, the paper m
+0000ccc0: 6179 2061 6c72 6561 6479 2062 6520 696e  ay already be in
+0000ccd0: 2074 6865 2064 6174 6120 6578 7472 6163   the data extrac
+0000cce0: 7469 6f6e 2f73 796e 7468 6573 6973 0a20  tion/synthesis. 
+0000ccf0: 2020 2020 2020 2069 6620 7365 6c66 2e64         if self.d
+0000cd00: 6174 612e 6765 7428 2263 6f6c 7265 765f  ata.get("colrev_
+0000cd10: 7374 6174 7573 222c 2022 4e41 2229 2069  status", "NA") i
+0000cd20: 6e20 5b0a 2020 2020 2020 2020 2020 2020  n [.            
+0000cd30: 5265 636f 7264 5374 6174 652e 7265 765f  RecordState.rev_
+0000cd40: 7379 6e74 6865 7369 7a65 642c 0a20 2020  synthesized,.   
+0000cd50: 2020 2020 2020 2020 2052 6563 6f72 6453           RecordS
+0000cd60: 7461 7465 2e72 6576 5f69 6e63 6c75 6465  tate.rev_include
+0000cd70: 642c 0a20 2020 2020 2020 205d 3a0a 2020  d,.        ]:.  
+0000cd80: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+0000cd90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000cda0: 2066 225c 6e7b 636f 6c6f 7273 2e52 4544   f"\n{colors.RED
+0000cdb0: 7d57 6172 6e69 6e67 3a20 7365 7474 696e  }Warning: settin
+0000cdc0: 6720 7061 7065 7220 746f 2070 7265 7363  g paper to presc
+0000cdd0: 7265 656e 5f65 7863 6c75 6465 642e 2050  reen_excluded. P
+0000cde0: 6c65 6173 6520 6368 6563 6b20 616e 6420  lease check and 
+0000cdf0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+0000ce00: 2020 6622 7265 6d6f 7665 2066 726f 6d20    f"remove from 
+0000ce10: 7379 6e74 6865 7369 733a 207b 7365 6c66  synthesis: {self
+0000ce20: 2e64 6174 615b 2749 4427 5d7d 7b63 6f6c  .data['ID']}{col
+0000ce30: 6f72 732e 454e 447d 5c6e 220a 2020 2020  ors.END}\n".    
+0000ce40: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+0000ce50: 2020 2073 656c 662e 7365 745f 7374 6174     self.set_stat
+0000ce60: 7573 2874 6172 6765 745f 7374 6174 653d  us(target_state=
+0000ce70: 5265 636f 7264 5374 6174 652e 7265 765f  RecordState.rev_
+0000ce80: 7072 6573 6372 6565 6e5f 6578 636c 7564  prescreen_exclud
+0000ce90: 6564 290a 0a20 2020 2020 2020 2069 6620  ed)..        if 
+0000cea0: 280a 2020 2020 2020 2020 2020 2020 2272  (.            "r
+0000ceb0: 6574 7261 6374 6564 2220 6e6f 7420 696e  etracted" not in
+0000cec0: 2073 656c 662e 6461 7461 2e67 6574 2822   self.data.get("
+0000ced0: 7072 6573 6372 6565 6e5f 6578 636c 7573  prescreen_exclus
+0000cee0: 696f 6e22 2c20 2222 290a 2020 2020 2020  ion", "").      
+0000cef0: 2020 2020 2020 616e 6420 2272 6574 7261        and "retra
+0000cf00: 6374 6564 2220 3d3d 2072 6561 736f 6e0a  cted" == reason.
+0000cf10: 2020 2020 2020 2020 2020 2020 616e 6420              and 
+0000cf20: 7072 696e 745f 7761 726e 696e 670a 2020  print_warning.  
+0000cf30: 2020 2020 2020 293a 0a20 2020 2020 2020        ):.       
+0000cf40: 2020 2020 2070 7269 6e74 280a 2020 2020       print(.    
+0000cf50: 2020 2020 2020 2020 2020 2020 6622 5c6e              f"\n
+0000cf60: 7b63 6f6c 6f72 732e 5245 447d 5061 7065  {colors.RED}Pape
+0000cf70: 7220 7265 7472 6163 7465 6420 616e 6420  r retracted and 
+0000cf80: 7072 6573 6372 6565 6e20 220a 2020 2020  prescreen ".    
+0000cf90: 2020 2020 2020 2020 2020 2020 6622 6578              f"ex
+0000cfa0: 636c 7564 6564 3a20 7b73 656c 662e 6461  cluded: {self.da
+0000cfb0: 7461 5b27 4944 275d 7d7b 636f 6c6f 7273  ta['ID']}{colors
+0000cfc0: 2e45 4e44 7d5c 6e22 0a20 2020 2020 2020  .END}\n".       
+0000cfd0: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+0000cfe0: 7365 6c66 2e64 6174 615b 2270 7265 7363  self.data["presc
+0000cff0: 7265 656e 5f65 7863 6c75 7369 6f6e 225d  reen_exclusion"]
+0000d000: 203d 2072 6561 736f 6e0a 0a20 2020 2020   = reason..     
+0000d010: 2020 2023 204e 6f74 653a 2077 6865 6e20     # Note: when 
+0000d020: 7265 636f 7264 7320 6172 6520 7072 6573  records are pres
+0000d030: 6372 6565 6e2d 6578 636c 7564 6564 2064  creen-excluded d
+0000d040: 7572 696e 6720 7072 6570 3a0a 2020 2020  uring prep:.    
+0000d050: 2020 2020 746f 5f64 726f 7020 3d20 5b5d      to_drop = []
+0000d060: 0a20 2020 2020 2020 2066 6f72 206b 6579  .        for key
+0000d070: 2c20 7661 6c75 6520 696e 2073 656c 662e  , value in self.
+0000d080: 6461 7461 2e69 7465 6d73 2829 3a0a 2020  data.items():.  
+0000d090: 2020 2020 2020 2020 2020 6966 2076 616c            if val
+0000d0a0: 7565 203d 3d20 2255 4e4b 4e4f 574e 223a  ue == "UNKNOWN":
+0000d0b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d0c0: 2074 6f5f 6472 6f70 2e61 7070 656e 6428   to_drop.append(
+0000d0d0: 6b65 7929 0a20 2020 2020 2020 2066 6f72  key).        for
+0000d0e0: 206b 6579 2069 6e20 746f 5f64 726f 703a   key in to_drop:
+0000d0f0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000d100: 662e 7265 6d6f 7665 5f66 6965 6c64 286b  f.remove_field(k
+0000d110: 6579 3d6b 6579 290a 0a20 2020 2064 6566  ey=key)..    def
+0000d120: 2065 7874 7261 6374 5f74 6578 745f 6279   extract_text_by
+0000d130: 5f70 6167 6528 0a20 2020 2020 2020 2073  _page(.        s
+0000d140: 656c 662c 202a 2c20 7061 6765 733a 204f  elf, *, pages: O
+0000d150: 7074 696f 6e61 6c5b 6c69 7374 5d20 3d20  ptional[list] = 
+0000d160: 4e6f 6e65 2c20 7072 6f6a 6563 745f 7061  None, project_pa
+0000d170: 7468 3a20 5061 7468 0a20 2020 2029 202d  th: Path.    ) -
+0000d180: 3e20 7374 723a 0a20 2020 2020 2020 2022  > str:.        "
+0000d190: 2222 4578 7472 6163 7420 7468 6520 7465  ""Extract the te
+0000d1a0: 7874 2066 726f 6d20 7468 6520 5044 4620  xt from the PDF 
+0000d1b0: 666f 7220 6120 6769 7665 6e20 6e75 6d62  for a given numb
+0000d1c0: 6572 206f 6620 7061 6765 7322 2222 0a20  er of pages""". 
+0000d1d0: 2020 2020 2020 2074 6578 745f 6c69 7374         text_list
+0000d1e0: 3a20 6c69 7374 203d 205b 5d0a 2020 2020  : list = [].    
+0000d1f0: 2020 2020 7064 665f 7061 7468 203d 2070      pdf_path = p
+0000d200: 726f 6a65 6374 5f70 6174 6820 2f20 5061  roject_path / Pa
+0000d210: 7468 2873 656c 662e 6461 7461 5b22 6669  th(self.data["fi
+0000d220: 6c65 225d 290a 0a20 2020 2020 2020 2023  le"])..        #
+0000d230: 2068 7474 7073 3a2f 2f73 7461 636b 6f76   https://stackov
+0000d240: 6572 666c 6f77 2e63 6f6d 2f71 7565 7374  erflow.com/quest
+0000d250: 696f 6e73 2f34 3934 3537 3434 332f 7079  ions/49457443/py
+0000d260: 7468 6f6e 2d70 6466 6d69 6e65 722d 636f  thon-pdfminer-co
+0000d270: 6e76 6572 7473 2d70 6466 2d66 696c 652d  nverts-pdf-file-
+0000d280: 696e 746f 2d6f 6e65 2d63 6875 6e6b 2d6f  into-one-chunk-o
+0000d290: 662d 7374 7269 6e67 2d77 6974 682d 6e6f  f-string-with-no
+0000d2a0: 2d73 7061 6365 732d 6265 7477 6565 0a20  -spaces-betwee. 
+0000d2b0: 2020 2020 2020 206c 6170 6172 616d 7320         laparams 
+0000d2c0: 3d20 7064 666d 696e 6572 2e6c 6179 6f75  = pdfminer.layou
+0000d2d0: 742e 4c41 5061 7261 6d73 2829 0a20 2020  t.LAParams().   
+0000d2e0: 2020 2020 2073 6574 6174 7472 286c 6170       setattr(lap
+0000d2f0: 6172 616d 732c 2022 616c 6c5f 7465 7874  arams, "all_text
+0000d300: 7322 2c20 5472 7565 290a 0a20 2020 2020  s", True)..     
+0000d310: 2020 2077 6974 6820 6f70 656e 2870 6466     with open(pdf
+0000d320: 5f70 6174 682c 2022 7262 2229 2061 7320  _path, "rb") as 
+0000d330: 7064 665f 6669 6c65 3a0a 2020 2020 2020  pdf_file:.      
+0000d340: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+0000d350: 2020 2020 2020 2020 2020 2066 6f72 2070             for p
+0000d360: 6167 6520 696e 2050 4446 5061 6765 2e67  age in PDFPage.g
+0000d370: 6574 5f70 6167 6573 280a 2020 2020 2020  et_pages(.      
+0000d380: 2020 2020 2020 2020 2020 2020 2020 7064                pd
+0000d390: 665f 6669 6c65 2c0a 2020 2020 2020 2020  f_file,.        
+0000d3a0: 2020 2020 2020 2020 2020 2020 7061 6765              page
+0000d3b0: 6e6f 733d 7061 6765 732c 2020 2320 6e6f  nos=pages,  # no
+0000d3c0: 7465 3a20 6d61 7962 6520 736b 6970 2070  te: maybe skip p
+0000d3d0: 6f74 656e 7469 616c 2063 6f76 6572 2070  otential cover p
+0000d3e0: 6167 6573 3f0a 2020 2020 2020 2020 2020  ages?.          
+0000d3f0: 2020 2020 2020 2020 2020 6361 6368 696e            cachin
+0000d400: 673d 5472 7565 2c0a 2020 2020 2020 2020  g=True,.        
+0000d410: 2020 2020 2020 2020 2020 2020 6368 6563              chec
+0000d420: 6b5f 6578 7472 6163 7461 626c 653d 5472  k_extractable=Tr
+0000d430: 7565 2c0a 2020 2020 2020 2020 2020 2020  ue,.            
+0000d440: 2020 2020 293a 0a20 2020 2020 2020 2020      ):.         
+0000d450: 2020 2020 2020 2020 2020 2072 6573 6f75             resou
+0000d460: 7263 655f 6d61 6e61 6765 7220 3d20 5044  rce_manager = PD
+0000d470: 4652 6573 6f75 7263 654d 616e 6167 6572  FResourceManager
+0000d480: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
+0000d490: 2020 2020 2020 2066 616b 655f 6669 6c65         fake_file
+0000d4a0: 5f68 616e 646c 6520 3d20 696f 2e53 7472  _handle = io.Str
+0000d4b0: 696e 6749 4f28 290a 2020 2020 2020 2020  ingIO().        
+0000d4c0: 2020 2020 2020 2020 2020 2020 636f 6e76              conv
+0000d4d0: 6572 7465 7220 3d20 5465 7874 436f 6e76  erter = TextConv
+0000d4e0: 6572 7465 7228 0a20 2020 2020 2020 2020  erter(.         
+0000d4f0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0000d500: 6573 6f75 7263 655f 6d61 6e61 6765 722c  esource_manager,
+0000d510: 2066 616b 655f 6669 6c65 5f68 616e 646c   fake_file_handl
+0000d520: 652c 206c 6170 6172 616d 733d 6c61 7061  e, laparams=lapa
+0000d530: 7261 6d73 0a20 2020 2020 2020 2020 2020  rams.           
+0000d540: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+0000d550: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0000d560: 6167 655f 696e 7465 7270 7265 7465 7220  age_interpreter 
+0000d570: 3d20 5044 4650 6167 6549 6e74 6572 7072  = PDFPageInterpr
+0000d580: 6574 6572 2872 6573 6f75 7263 655f 6d61  eter(resource_ma
+0000d590: 6e61 6765 722c 2063 6f6e 7665 7274 6572  nager, converter
+0000d5a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000d5b0: 2020 2020 2020 7061 6765 5f69 6e74 6572        page_inter
+0000d5c0: 7072 6574 6572 2e70 726f 6365 7373 5f70  preter.process_p
+0000d5d0: 6167 6528 7061 6765 290a 0a20 2020 2020  age(page)..     
+0000d5e0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0000d5f0: 6578 7420 3d20 6661 6b65 5f66 696c 655f  ext = fake_file_
+0000d600: 6861 6e64 6c65 2e67 6574 7661 6c75 6528  handle.getvalue(
+0000d610: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000d620: 2020 2020 2020 7465 7874 5f6c 6973 7420        text_list 
+0000d630: 2b3d 2074 6578 740a 0a20 2020 2020 2020  += text..       
+0000d640: 2020 2020 2020 2020 2020 2020 2023 2063               # c
+0000d650: 6c6f 7365 206f 7065 6e20 6861 6e64 6c65  lose open handle
+0000d660: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
+0000d670: 2020 2020 2020 636f 6e76 6572 7465 722e        converter.
+0000d680: 636c 6f73 6528 290a 2020 2020 2020 2020  close().        
+0000d690: 2020 2020 2020 2020 2020 2020 6661 6b65              fake
+0000d6a0: 5f66 696c 655f 6861 6e64 6c65 2e63 6c6f  _file_handle.clo
+0000d6b0: 7365 2829 0a20 2020 2020 2020 2020 2020  se().           
+0000d6c0: 2065 7863 6570 7420 2854 7970 6545 7272   except (TypeErr
+0000d6d0: 6f72 2c20 4b65 7945 7272 6f72 293a 2020  or, KeyError):  
+0000d6e0: 2320 7072 6167 6d61 3a20 6e6f 2063 6f76  # pragma: no cov
+0000d6f0: 6572 0a20 2020 2020 2020 2020 2020 2020  er.             
+0000d700: 2020 2070 6173 730a 2020 2020 2020 2020     pass.        
+0000d710: 7265 7475 726e 2022 222e 6a6f 696e 2874  return "".join(t
+0000d720: 6578 745f 6c69 7374 290a 0a20 2020 2064  ext_list)..    d
+0000d730: 6566 2073 6574 5f70 6167 6573 5f69 6e5f  ef set_pages_in_
+0000d740: 7064 6628 7365 6c66 2c20 2a2c 2070 726f  pdf(self, *, pro
+0000d750: 6a65 6374 5f70 6174 683a 2050 6174 6829  ject_path: Path)
+0000d760: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+0000d770: 2020 2222 2253 6574 2074 6865 2070 6167    """Set the pag
+0000d780: 6573 5f69 6e5f 6669 6c65 2066 6965 6c64  es_in_file field
+0000d790: 2062 6173 6564 206f 6e20 7468 6520 5044   based on the PD
+0000d7a0: 4622 2222 0a20 2020 2020 2020 2070 6466  F""".        pdf
+0000d7b0: 5f70 6174 6820 3d20 7072 6f6a 6563 745f  _path = project_
+0000d7c0: 7061 7468 202f 2050 6174 6828 7365 6c66  path / Path(self
+0000d7d0: 2e64 6174 615b 2266 696c 6522 5d29 0a20  .data["file"]). 
+0000d7e0: 2020 2020 2020 2077 6974 6820 6f70 656e         with open
+0000d7f0: 2870 6466 5f70 6174 682c 2022 7262 2229  (pdf_path, "rb")
+0000d800: 2061 7320 6669 6c65 3a0a 2020 2020 2020   as file:.      
+0000d810: 2020 2020 2020 7061 7273 6572 203d 2050        parser = P
+0000d820: 4446 5061 7273 6572 2866 696c 6529 0a20  DFParser(file). 
+0000d830: 2020 2020 2020 2020 2020 2064 6f63 756d             docum
+0000d840: 656e 7420 3d20 5044 4644 6f63 756d 656e  ent = PDFDocumen
+0000d850: 7428 7061 7273 6572 290a 2020 2020 2020  t(parser).      
+0000d860: 2020 2020 2020 7061 6765 735f 696e 5f66        pages_in_f
+0000d870: 696c 6520 3d20 7265 736f 6c76 6531 2864  ile = resolve1(d
+0000d880: 6f63 756d 656e 742e 6361 7461 6c6f 675b  ocument.catalog[
+0000d890: 2250 6167 6573 225d 295b 2243 6f75 6e74  "Pages"])["Count
+0000d8a0: 225d 0a20 2020 2020 2020 2073 656c 662e  "].        self.
+0000d8b0: 6461 7461 5b22 7061 6765 735f 696e 5f66  data["pages_in_f
+0000d8c0: 696c 6522 5d20 3d20 7061 6765 735f 696e  ile"] = pages_in
+0000d8d0: 5f66 696c 650a 0a20 2020 2064 6566 2073  _file..    def s
+0000d8e0: 6574 5f74 6578 745f 6672 6f6d 5f70 6466  et_text_from_pdf
+0000d8f0: 2873 656c 662c 202a 2c20 7072 6f6a 6563  (self, *, projec
+0000d900: 745f 7061 7468 3a20 5061 7468 2920 2d3e  t_path: Path) ->
+0000d910: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
+0000d920: 2222 5365 7420 7468 6520 7465 7874 5f66  ""Set the text_f
+0000d930: 726f 6d5f 7064 6620 6669 656c 6420 6261  rom_pdf field ba
+0000d940: 7365 6420 6f6e 2074 6865 2050 4446 2222  sed on the PDF""
+0000d950: 220a 2020 2020 2020 2020 7365 6c66 2e64  ".        self.d
+0000d960: 6174 615b 2274 6578 745f 6672 6f6d 5f70  ata["text_from_p
+0000d970: 6466 225d 203d 2022 220a 2020 2020 2020  df"] = "".      
+0000d980: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+0000d990: 2020 2073 656c 662e 7365 745f 7061 6765     self.set_page
+0000d9a0: 735f 696e 5f70 6466 2870 726f 6a65 6374  s_in_pdf(project
+0000d9b0: 5f70 6174 683d 7072 6f6a 6563 745f 7061  _path=project_pa
+0000d9c0: 7468 290a 2020 2020 2020 2020 2020 2020  th).            
+0000d9d0: 7465 7874 203d 2073 656c 662e 6578 7472  text = self.extr
+0000d9e0: 6163 745f 7465 7874 5f62 795f 7061 6765  act_text_by_page
+0000d9f0: 2870 6167 6573 3d5b 302c 2031 2c20 325d  (pages=[0, 1, 2]
+0000da00: 2c20 7072 6f6a 6563 745f 7061 7468 3d70  , project_path=p
+0000da10: 726f 6a65 6374 5f70 6174 6829 0a20 2020  roject_path).   
+0000da20: 2020 2020 2020 2020 2073 656c 662e 6461           self.da
+0000da30: 7461 5b22 7465 7874 5f66 726f 6d5f 7064  ta["text_from_pd
+0000da40: 6622 5d20 3d20 7465 7874 2e72 6570 6c61  f"] = text.repla
+0000da50: 6365 2822 5c6e 222c 2022 2022 292e 7265  ce("\n", " ").re
+0000da60: 706c 6163 6528 225c 7830 6322 2c20 2222  place("\x0c", ""
+0000da70: 290a 0a20 2020 2020 2020 2065 7863 6570  )..        excep
+0000da80: 7420 5044 4653 796e 7461 7845 7272 6f72  t PDFSyntaxError
+0000da90: 3a20 2023 2070 7261 676d 613a 206e 6f20  :  # pragma: no 
+0000daa0: 636f 7665 720a 2020 2020 2020 2020 2020  cover.          
+0000dab0: 2020 7365 6c66 2e61 6464 5f64 6174 615f    self.add_data_
+0000dac0: 7072 6f76 656e 616e 6365 5f6e 6f74 6528  provenance_note(
+0000dad0: 6b65 793d 2266 696c 6522 2c20 6e6f 7465  key="file", note
+0000dae0: 3d22 7064 665f 7265 6164 6572 5f65 7272  ="pdf_reader_err
+0000daf0: 6f72 2229 0a20 2020 2020 2020 2020 2020  or").           
+0000db00: 2073 656c 662e 6461 7461 2e75 7064 6174   self.data.updat
+0000db10: 6528 636f 6c72 6576 5f73 7461 7475 733d  e(colrev_status=
+0000db20: 5265 636f 7264 5374 6174 652e 7064 665f  RecordState.pdf_
+0000db30: 6e65 6564 735f 6d61 6e75 616c 5f70 7265  needs_manual_pre
+0000db40: 7061 7261 7469 6f6e 290a 2020 2020 2020  paration).      
+0000db50: 2020 6578 6365 7074 2050 4446 5465 7874    except PDFText
+0000db60: 4578 7472 6163 7469 6f6e 4e6f 7441 6c6c  ExtractionNotAll
+0000db70: 6f77 6564 3a20 2023 2070 7261 676d 613a  owed:  # pragma:
+0000db80: 206e 6f20 636f 7665 720a 2020 2020 2020   no cover.      
+0000db90: 2020 2020 2020 7365 6c66 2e61 6464 5f64        self.add_d
+0000dba0: 6174 615f 7072 6f76 656e 616e 6365 5f6e  ata_provenance_n
+0000dbb0: 6f74 6528 6b65 793d 2266 696c 6522 2c20  ote(key="file", 
+0000dbc0: 6e6f 7465 3d22 7064 665f 7072 6f74 6563  note="pdf_protec
+0000dbd0: 7465 6422 290a 2020 2020 2020 2020 2020  ted").          
+0000dbe0: 2020 7365 6c66 2e64 6174 612e 7570 6461    self.data.upda
+0000dbf0: 7465 2863 6f6c 7265 765f 7374 6174 7573  te(colrev_status
+0000dc00: 3d52 6563 6f72 6453 7461 7465 2e70 6466  =RecordState.pdf
+0000dc10: 5f6e 6565 6473 5f6d 616e 7561 6c5f 7072  _needs_manual_pr
+0000dc20: 6570 6172 6174 696f 6e29 0a0a 2020 2020  eparation)..    
+0000dc30: 6465 6620 6578 7472 6163 745f 7061 6765  def extract_page
+0000dc40: 7328 0a20 2020 2020 2020 2073 656c 662c  s(.        self,
+0000dc50: 202a 2c20 7061 6765 733a 206c 6973 742c   *, pages: list,
+0000dc60: 2070 726f 6a65 6374 5f70 6174 683a 2050   project_path: P
+0000dc70: 6174 682c 2073 6176 655f 746f 5f70 6174  ath, save_to_pat
+0000dc80: 683a 204f 7074 696f 6e61 6c5b 5061 7468  h: Optional[Path
+0000dc90: 5d20 3d20 4e6f 6e65 0a20 2020 2029 202d  ] = None.    ) -
+0000dca0: 3e20 4e6f 6e65 3a20 2023 2070 7261 676d  > None:  # pragm
+0000dcb0: 613a 206e 6f20 636f 7665 720a 2020 2020  a: no cover.    
+0000dcc0: 2020 2020 2222 2245 7874 7261 6374 2070      """Extract p
+0000dcd0: 6167 6573 2066 726f 6d20 7468 6520 5044  ages from the PD
+0000dce0: 4620 2873 6176 6569 6e67 2074 6865 6d20  F (saveing them 
+0000dcf0: 746f 2074 6865 2073 6176 655f 746f 5f70  to the save_to_p
+0000dd00: 6174 6829 2222 220a 2020 2020 2020 2020  ath)""".        
+0000dd10: 7064 665f 7061 7468 203d 2070 726f 6a65  pdf_path = proje
+0000dd20: 6374 5f70 6174 6820 2f20 5061 7468 2873  ct_path / Path(s
+0000dd30: 656c 662e 6461 7461 5b22 6669 6c65 225d  elf.data["file"]
+0000dd40: 290a 2020 2020 2020 2020 7064 665f 7265  ).        pdf_re
+0000dd50: 6164 6572 203d 2050 6466 4669 6c65 5265  ader = PdfFileRe
+0000dd60: 6164 6572 2873 7472 2870 6466 5f70 6174  ader(str(pdf_pat
+0000dd70: 6829 2c20 7374 7269 6374 3d46 616c 7365  h), strict=False
+0000dd80: 290a 2020 2020 2020 2020 7772 6974 6572  ).        writer
+0000dd90: 203d 2050 6466 4669 6c65 5772 6974 6572   = PdfFileWriter
+0000dda0: 2829 0a20 2020 2020 2020 2066 6f72 2069  ().        for i
+0000ddb0: 2069 6e20 7261 6e67 6528 302c 206c 656e   in range(0, len
+0000ddc0: 2870 6466 5f72 6561 6465 722e 7061 6765  (pdf_reader.page
+0000ddd0: 7329 293a 0a20 2020 2020 2020 2020 2020  s)):.           
+0000dde0: 2069 6620 6920 696e 2070 6167 6573 3a0a   if i in pages:.
+0000ddf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000de00: 636f 6e74 696e 7565 0a20 2020 2020 2020  continue.       
+0000de10: 2020 2020 2077 7269 7465 722e 6164 6450       writer.addP
+0000de20: 6167 6528 7064 665f 7265 6164 6572 2e67  age(pdf_reader.g
+0000de30: 6574 5061 6765 2869 2929 0a20 2020 2020  etPage(i)).     
+0000de40: 2020 2077 6974 6820 6f70 656e 2870 6466     with open(pdf
+0000de50: 5f70 6174 682c 2022 7762 2229 2061 7320  _path, "wb") as 
+0000de60: 6f75 7466 696c 653a 0a20 2020 2020 2020  outfile:.       
+0000de70: 2020 2020 2077 7269 7465 722e 7772 6974       writer.writ
+0000de80: 6528 6f75 7466 696c 6529 0a0a 2020 2020  e(outfile)..    
+0000de90: 2020 2020 6966 2073 6176 655f 746f 5f70      if save_to_p
+0000dea0: 6174 683a 0a20 2020 2020 2020 2020 2020  ath:.           
+0000deb0: 2077 7269 7465 725f 6370 203d 2050 6466   writer_cp = Pdf
+0000dec0: 4669 6c65 5772 6974 6572 2829 0a20 2020  FileWriter().   
+0000ded0: 2020 2020 2020 2020 2066 6f72 2070 6167           for pag
+0000dee0: 6520 696e 2070 6167 6573 3a0a 2020 2020  e in pages:.    
+0000def0: 2020 2020 2020 2020 2020 2020 7772 6974              writ
+0000df00: 6572 5f63 702e 6164 6450 6167 6528 7064  er_cp.addPage(pd
+0000df10: 665f 7265 6164 6572 2e67 6574 5061 6765  f_reader.getPage
+0000df20: 2870 6167 6529 290a 2020 2020 2020 2020  (page)).        
+0000df30: 2020 2020 6669 6c65 7061 7468 203d 2050      filepath = P
+0000df40: 6174 6828 7064 665f 7061 7468 290a 2020  ath(pdf_path).  
+0000df50: 2020 2020 2020 2020 2020 7769 7468 206f            with o
+0000df60: 7065 6e28 7361 7665 5f74 6f5f 7061 7468  pen(save_to_path
+0000df70: 202f 2066 696c 6570 6174 682e 6e61 6d65   / filepath.name
+0000df80: 2c20 2277 6222 2920 6173 206f 7574 6669  , "wb") as outfi
+0000df90: 6c65 3a0a 2020 2020 2020 2020 2020 2020  le:.            
+0000dfa0: 2020 2020 7772 6974 6572 5f63 702e 7772      writer_cp.wr
+0000dfb0: 6974 6528 6f75 7466 696c 6529 0a0a 2020  ite(outfile)..  
+0000dfc0: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
+0000dfd0: 2020 2064 6566 2067 6574 5f63 6f6c 7265     def get_colre
+0000dfe0: 765f 7064 665f 6964 280a 2020 2020 2020  v_pdf_id(.      
+0000dff0: 2020 636c 732c 0a20 2020 2020 2020 202a    cls,.        *
+0000e000: 2c0a 2020 2020 2020 2020 7064 665f 7061  ,.        pdf_pa
+0000e010: 7468 3a20 5061 7468 2c0a 2020 2020 2920  th: Path,.    ) 
+0000e020: 2d3e 2073 7472 3a20 2023 2070 7261 676d  -> str:  # pragm
+0000e030: 613a 206e 6f20 636f 7665 720a 2020 2020  a: no cover.    
+0000e040: 2020 2020 2222 2247 656e 6572 6174 6520      """Generate 
+0000e050: 7468 6520 636f 6c72 6576 5f70 6466 5f69  the colrev_pdf_i
+0000e060: 6422 2222 0a0a 2020 2020 2020 2020 7265  d"""..        re
+0000e070: 7475 726e 2063 6f6c 7265 762e 716d 2e63  turn colrev.qm.c
+0000e080: 6f6c 7265 765f 7064 665f 6964 2e63 7265  olrev_pdf_id.cre
+0000e090: 6174 655f 636f 6c72 6576 5f70 6466 5f69  ate_colrev_pdf_i
+0000e0a0: 6428 7064 665f 7061 7468 3d70 6466 5f70  d(pdf_path=pdf_p
+0000e0b0: 6174 6829 0a0a 2020 2020 6465 6620 6765  ath)..    def ge
+0000e0c0: 745f 746f 635f 6b65 7928 7365 6c66 2920  t_toc_key(self) 
+0000e0d0: 2d3e 2073 7472 3a0a 2020 2020 2020 2020  -> str:.        
+0000e0e0: 2222 2247 6574 2074 6865 2072 6563 6f72  """Get the recor
+0000e0f0: 6427 7320 746f 632d 6b65 7922 2222 0a0a  d's toc-key"""..
+0000e100: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+0000e110: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+0000e120: 2e64 6174 615b 2245 4e54 5259 5459 5045  .data["ENTRYTYPE
+0000e130: 225d 203d 3d20 2261 7274 6963 6c65 223a  "] == "article":
+0000e140: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e150: 2074 6f63 5f6b 6579 203d 2028 0a20 2020   toc_key = (.   
+0000e160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e170: 2073 656c 662e 6461 7461 5b22 6a6f 7572   self.data["jour
+0000e180: 6e61 6c22 5d0a 2020 2020 2020 2020 2020  nal"].          
+0000e190: 2020 2020 2020 2020 2020 2e72 6570 6c61            .repla
+0000e1a0: 6365 2822 2022 2c20 222d 2229 0a20 2020  ce(" ", "-").   
+0000e1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e1c0: 202e 7265 706c 6163 6528 225c 5c22 2c20   .replace("\\", 
+0000e1d0: 2222 290a 2020 2020 2020 2020 2020 2020  "").            
+0000e1e0: 2020 2020 2020 2020 2e72 6570 6c61 6365          .replace
+0000e1f0: 2822 2622 2c20 2261 6e64 2229 0a20 2020  ("&", "and").   
+0000e200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e210: 202e 6c6f 7765 7228 290a 2020 2020 2020   .lower().      
+0000e220: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+0000e230: 2020 2020 2020 2020 2020 2020 746f 635f              toc_
+0000e240: 6b65 7920 2b3d 2028 0a20 2020 2020 2020  key += (.       
+0000e250: 2020 2020 2020 2020 2020 2020 2066 227c               f"|
+0000e260: 7b73 656c 662e 6461 7461 5b27 766f 6c75  {self.data['volu
+0000e270: 6d65 275d 7d22 0a20 2020 2020 2020 2020  me']}".         
+0000e280: 2020 2020 2020 2020 2020 2069 6620 2822             if ("
+0000e290: 554e 4b4e 4f57 4e22 2021 3d20 7365 6c66  UNKNOWN" != self
+0000e2a0: 2e64 6174 612e 6765 7428 2276 6f6c 756d  .data.get("volum
+0000e2b0: 6522 2c20 2255 4e4b 4e4f 574e 2229 290a  e", "UNKNOWN")).
+0000e2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e2d0: 2020 2020 656c 7365 2022 7c2d 220a 2020      else "|-".  
+0000e2e0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+0000e2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e300: 746f 635f 6b65 7920 2b3d 2028 0a20 2020  toc_key += (.   
+0000e310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e320: 2066 227c 7b73 656c 662e 6461 7461 5b27   f"|{self.data['
+0000e330: 6e75 6d62 6572 275d 7d22 0a20 2020 2020  number']}".     
+0000e340: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000e350: 6620 2822 554e 4b4e 4f57 4e22 2021 3d20  f ("UNKNOWN" != 
+0000e360: 7365 6c66 2e64 6174 612e 6765 7428 226e  self.data.get("n
+0000e370: 756d 6265 7222 2c20 2255 4e4b 4e4f 574e  umber", "UNKNOWN
+0000e380: 2229 290a 2020 2020 2020 2020 2020 2020  ")).            
+0000e390: 2020 2020 2020 2020 656c 7365 2022 7c2d          else "|-
+0000e3a0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+0000e3b0: 2020 290a 0a20 2020 2020 2020 2020 2020    )..           
+0000e3c0: 2065 6c69 6620 7365 6c66 2e64 6174 615b   elif self.data[
+0000e3d0: 2245 4e54 5259 5459 5045 225d 203d 3d20  "ENTRYTYPE"] == 
+0000e3e0: 2269 6e70 726f 6365 6564 696e 6773 223a  "inproceedings":
+0000e3f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000e400: 2074 6f63 5f6b 6579 203d 2028 0a20 2020   toc_key = (.   
+0000e410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e420: 2073 656c 662e 6461 7461 5b22 626f 6f6b   self.data["book
+0000e430: 7469 746c 6522 5d0a 2020 2020 2020 2020  title"].        
+0000e440: 2020 2020 2020 2020 2020 2020 2e72 6570              .rep
+0000e450: 6c61 6365 2822 2022 2c20 222d 2229 0a20  lace(" ", "-"). 
+0000e460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e470: 2020 202e 7265 706c 6163 6528 225c 5c22     .replace("\\"
+0000e480: 2c20 2222 290a 2020 2020 2020 2020 2020  , "").          
+0000e490: 2020 2020 2020 2020 2020 2e72 6570 6c61            .repla
+0000e4a0: 6365 2822 2622 2c20 2261 6e64 2229 0a20  ce("&", "and"). 
+0000e4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e4c0: 2020 202e 6c6f 7765 7228 290a 2020 2020     .lower().    
+0000e4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e4e0: 2b20 6622 7c7b 7365 6c66 2e64 6174 612e  + f"|{self.data.
+0000e4f0: 6765 7428 2779 6561 7227 2c20 2727 297d  get('year', '')}
+0000e500: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+0000e510: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+0000e520: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0000e530: 2020 2020 2020 6d73 6720 3d20 280a 2020        msg = (.  
+0000e540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e550: 2020 6622 454e 5452 5954 5950 4520 7b73    f"ENTRYTYPE {s
+0000e560: 656c 662e 6461 7461 5b27 454e 5452 5954  elf.data['ENTRYT
+0000e570: 5950 4527 5d7d 2022 0a20 2020 2020 2020  YPE']} ".       
+0000e580: 2020 2020 2020 2020 2020 2020 202b 2066               + f
+0000e590: 2228 7b73 656c 662e 6461 7461 5b27 4944  "({self.data['ID
+0000e5a0: 275d 7d29 206e 6f74 2074 6f63 2d69 6465  ']}) not toc-ide
+0000e5b0: 6e74 6966 6961 626c 6522 0a20 2020 2020  ntifiable".     
+0000e5c0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+0000e5d0: 2020 2020 2020 2020 2020 2020 2072 6169               rai
+0000e5e0: 7365 2063 6f6c 7265 765f 6578 6365 7074  se colrev_except
+0000e5f0: 696f 6e73 2e4e 6f74 544f 4349 6465 6e74  ions.NotTOCIdent
+0000e600: 6966 6961 626c 6545 7863 6570 7469 6f6e  ifiableException
+0000e610: 286d 7367 290a 2020 2020 2020 2020 6578  (msg).        ex
+0000e620: 6365 7074 204b 6579 4572 726f 7220 6173  cept KeyError as
+0000e630: 2065 7863 3a0a 2020 2020 2020 2020 2020   exc:.          
+0000e640: 2020 7261 6973 6520 636f 6c72 6576 5f65    raise colrev_e
+0000e650: 7863 6570 7469 6f6e 732e 4e6f 7454 4f43  xceptions.NotTOC
+0000e660: 4964 656e 7469 6669 6162 6c65 4578 6365  IdentifiableExce
+0000e670: 7074 696f 6e28 0a20 2020 2020 2020 2020  ption(.         
+0000e680: 2020 2020 2020 2066 226d 6973 7369 6e67         f"missing
+0000e690: 206b 6579 207b 6578 637d 220a 2020 2020   key {exc}".    
+0000e6a0: 2020 2020 2020 2020 2920 6672 6f6d 2065          ) from e
+0000e6b0: 7863 0a0a 2020 2020 2020 2020 7265 7475  xc..        retu
+0000e6c0: 726e 2074 6f63 5f6b 6579 0a0a 2020 2020  rn toc_key..    
+0000e6d0: 6465 6620 7072 696e 745f 6369 7461 7469  def print_citati
+0000e6e0: 6f6e 5f66 6f72 6d61 7428 7365 6c66 2920  on_format(self) 
+0000e6f0: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
+0000e700: 2022 2222 5072 696e 7420 7468 6520 7265   """Print the re
+0000e710: 636f 7264 2061 7320 6120 6369 7461 7469  cord as a citati
+0000e720: 6f6e 2222 220a 2020 2020 2020 2020 666f  on""".        fo
+0000e730: 726d 6174 7465 645f 7265 6620 3d20 280a  rmatted_ref = (.
+0000e740: 2020 2020 2020 2020 2020 2020 6622 7b73              f"{s
+0000e750: 656c 662e 6461 7461 2e67 6574 2827 6175  elf.data.get('au
+0000e760: 7468 6f72 272c 2027 2729 7d20 287b 7365  thor', '')} ({se
+0000e770: 6c66 2e64 6174 612e 6765 7428 2779 6561  lf.data.get('yea
+0000e780: 7227 2c20 2727 297d 2920 220a 2020 2020  r', '')}) ".    
+0000e790: 2020 2020 2020 2020 2b20 6622 7b73 656c          + f"{sel
+0000e7a0: 662e 6461 7461 2e67 6574 2827 7469 746c  f.data.get('titl
+0000e7b0: 6527 2c20 2727 297d 2e20 220a 2020 2020  e', '')}. ".    
+0000e7c0: 2020 2020 2020 2020 2b20 6622 7b73 656c          + f"{sel
+0000e7d0: 662e 6461 7461 2e67 6574 2827 6a6f 7572  f.data.get('jour
+0000e7e0: 6e61 6c27 2c20 2727 297d 7b73 656c 662e  nal', '')}{self.
+0000e7f0: 6461 7461 2e67 6574 2827 626f 6f6b 7469  data.get('bookti
+0000e800: 746c 6527 2c20 2727 297d 2c20 220a 2020  tle', '')}, ".  
+0000e810: 2020 2020 2020 2020 2020 2b20 6622 7b73            + f"{s
+0000e820: 656c 662e 6461 7461 2e67 6574 2827 766f  elf.data.get('vo
+0000e830: 6c75 6d65 272c 2027 2729 7d20 287b 7365  lume', '')} ({se
+0000e840: 6c66 2e64 6174 612e 6765 7428 276e 756d  lf.data.get('num
+0000e850: 6265 7227 2c20 2727 297d 2922 0a20 2020  ber', '')})".   
+0000e860: 2020 2020 2029 0a20 2020 2020 2020 2070       ).        p
+0000e870: 7269 6e74 2866 6f72 6d61 7474 6564 5f72  rint(formatted_r
+0000e880: 6566 290a 0a20 2020 2064 6566 2067 6574  ef)..    def get
+0000e890: 5f74 6569 5f66 696c 656e 616d 6528 7365  _tei_filename(se
+0000e8a0: 6c66 2920 2d3e 2050 6174 683a 0a20 2020  lf) -> Path:.   
+0000e8b0: 2020 2020 2022 2222 4765 7420 7468 6520       """Get the 
+0000e8c0: 5445 4920 6669 6c65 6e61 6d65 2061 7373  TEI filename ass
+0000e8d0: 6f63 6961 7465 6420 7769 7468 2074 6865  ociated with the
+0000e8e0: 2066 696c 6520 2850 4446 2922 2222 0a20   file (PDF)""". 
+0000e8f0: 2020 2020 2020 2074 6569 5f66 696c 656e         tei_filen
+0000e900: 616d 6520 3d20 5061 7468 2866 272e 7465  ame = Path(f'.te
+0000e910: 692f 7b73 656c 662e 6461 7461 5b22 4944  i/{self.data["ID
+0000e920: 225d 7d2e 7465 692e 786d 6c27 290a 2020  "]}.tei.xml').  
+0000e930: 2020 2020 2020 6966 2022 6669 6c65 2220        if "file" 
+0000e940: 696e 2073 656c 662e 6461 7461 3a0a 2020  in self.data:.  
+0000e950: 2020 2020 2020 2020 2020 7465 695f 6669            tei_fi
+0000e960: 6c65 6e61 6d65 203d 2050 6174 6828 0a20  lename = Path(. 
+0000e970: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000e980: 656c 662e 6461 7461 5b22 6669 6c65 225d  elf.data["file"]
+0000e990: 2e72 6570 6c61 6365 2822 7064 6673 2f22  .replace("pdfs/"
+0000e9a0: 2c20 222e 7465 692f 2229 0a20 2020 2020  , ".tei/").     
+0000e9b0: 2020 2020 2020 2029 2e77 6974 685f 7375         ).with_su
+0000e9c0: 6666 6978 2822 2e74 6569 2e78 6d6c 2229  ffix(".tei.xml")
+0000e9d0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000e9e0: 7465 695f 6669 6c65 6e61 6d65 0a0a 2020  tei_filename..  
+0000e9f0: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
+0000ea00: 2020 2064 6566 2070 7269 6e74 5f64 6966     def print_dif
+0000ea10: 665f 7061 6972 2863 6c73 2c20 2a2c 2072  f_pair(cls, *, r
+0000ea20: 6563 6f72 645f 7061 6972 3a20 6c69 7374  ecord_pair: list
+0000ea30: 2c20 6b65 7973 3a20 6c69 7374 2920 2d3e  , keys: list) ->
+0000ea40: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
+0000ea50: 2222 5072 696e 7420 7468 6520 6469 6666  ""Print the diff
+0000ea60: 2062 6574 7765 656e 2074 776f 2072 6563   between two rec
+0000ea70: 6f72 6473 2222 220a 0a20 2020 2020 2020  ords"""..       
+0000ea80: 2064 6566 2070 7269 6e74 5f64 6966 6628   def print_diff(
+0000ea90: 6368 616e 6765 3a20 7475 706c 6529 202d  change: tuple) -
+0000eaa0: 3e20 7374 723a 0a20 2020 2020 2020 2020  > str:.         
+0000eab0: 2020 2064 6966 6620 3d20 6469 6666 6c69     diff = diffli
+0000eac0: 622e 4469 6666 6572 2829 0a20 2020 2020  b.Differ().     
+0000ead0: 2020 2020 2020 206c 6574 7465 7273 203d         letters =
+0000eae0: 206c 6973 7428 6469 6666 2e63 6f6d 7061   list(diff.compa
+0000eaf0: 7265 2863 6861 6e67 655b 315d 2c20 6368  re(change[1], ch
+0000eb00: 616e 6765 5b30 5d29 290a 2020 2020 2020  ange[0])).      
+0000eb10: 2020 2020 2020 666f 7220 692c 206c 6574        for i, let
+0000eb20: 7465 7220 696e 2065 6e75 6d65 7261 7465  ter in enumerate
+0000eb30: 286c 6574 7465 7273 293a 0a20 2020 2020  (letters):.     
+0000eb40: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
+0000eb50: 7474 6572 2e73 7461 7274 7377 6974 6828  tter.startswith(
+0000eb60: 2220 2022 293a 0a20 2020 2020 2020 2020  "  "):.         
+0000eb70: 2020 2020 2020 2020 2020 206c 6574 7465             lette
+0000eb80: 7273 5b69 5d20 3d20 6c65 7474 6572 735b  rs[i] = letters[
+0000eb90: 695d 5b2d 315d 0a20 2020 2020 2020 2020  i][-1].         
+0000eba0: 2020 2020 2020 2065 6c69 6620 6c65 7474         elif lett
+0000ebb0: 6572 2e73 7461 7274 7377 6974 6828 222b  er.startswith("+
+0000ebc0: 2022 293a 0a20 2020 2020 2020 2020 2020   "):.           
+0000ebd0: 2020 2020 2020 2020 206c 6574 7465 7273           letters
+0000ebe0: 5b69 5d20 3d20 6622 7b63 6f6c 6f72 732e  [i] = f"{colors.
+0000ebf0: 5245 447d 2220 2b20 6c65 7474 6572 735b  RED}" + letters[
+0000ec00: 695d 5b2d 315d 202b 2066 227b 636f 6c6f  i][-1] + f"{colo
+0000ec10: 7273 2e45 4e44 7d22 0a20 2020 2020 2020  rs.END}".       
+0000ec20: 2020 2020 2020 2020 2065 6c69 6620 6c65           elif le
+0000ec30: 7474 6572 2e73 7461 7274 7377 6974 6828  tter.startswith(
+0000ec40: 222d 2022 293a 0a20 2020 2020 2020 2020  "- "):.         
+0000ec50: 2020 2020 2020 2020 2020 206c 6574 7465             lette
+0000ec60: 7273 5b69 5d20 3d20 6622 7b63 6f6c 6f72  rs[i] = f"{color
+0000ec70: 732e 4752 4545 4e7d 2220 2b20 6c65 7474  s.GREEN}" + lett
+0000ec80: 6572 735b 695d 5b2d 315d 202b 2066 227b  ers[i][-1] + f"{
+0000ec90: 636f 6c6f 7273 2e45 4e44 7d22 0a20 2020  colors.END}".   
+0000eca0: 2020 2020 2020 2020 2072 6573 203d 2022           res = "
+0000ecb0: 222e 6a6f 696e 286c 6574 7465 7273 292e  ".join(letters).
+0000ecc0: 7265 706c 6163 6528 225c 6e22 2c20 2220  replace("\n", " 
+0000ecd0: 2229 0a20 2020 2020 2020 2020 2020 2072  ").            r
+0000ece0: 6574 7572 6e20 7265 730a 0a20 2020 2020  eturn res..     
+0000ecf0: 2020 2066 6f72 206b 6579 2069 6e20 6b65     for key in ke
+0000ed00: 7973 3a0a 2020 2020 2020 2020 2020 2020  ys:.            
+0000ed10: 7072 6576 5f76 616c 203d 2022 5f46 4952  prev_val = "_FIR
+0000ed20: 5354 5f56 414c 220a 2020 2020 2020 2020  ST_VAL".        
+0000ed30: 2020 2020 666f 7220 7265 6320 696e 2072      for rec in r
+0000ed40: 6563 6f72 645f 7061 6972 3a0a 2020 2020  ecord_pair:.    
+0000ed50: 2020 2020 2020 2020 2020 2020 6966 2070              if p
+0000ed60: 7265 765f 7661 6c20 3d3d 2072 6563 2e67  rev_val == rec.g
+0000ed70: 6574 286b 6579 2c20 2222 2920 6f72 2070  et(key, "") or p
+0000ed80: 7265 765f 7661 6c20 3d3d 2022 5f46 4952  rev_val == "_FIR
+0000ed90: 5354 5f56 414c 223a 0a20 2020 2020 2020  ST_VAL":.       
+0000eda0: 2020 2020 2020 2020 2020 2020 206c 696e               lin
+0000edb0: 6520 3d20 6622 7b72 6563 2e67 6574 286b  e = f"{rec.get(k
+0000edc0: 6579 2c20 2727 297d 220a 2020 2020 2020  ey, '')}".      
+0000edd0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+0000ede0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000edf0: 2020 2020 7369 6d69 6c61 7269 7479 203d      similarity =
+0000ee00: 2030 2e30 0a20 2020 2020 2020 2020 2020   0.0.           
+0000ee10: 2020 2020 2020 2020 2069 6620 280a 2020           if (.  
+0000ee20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ee30: 2020 2020 2020 7072 6576 5f76 616c 2069        prev_val i
+0000ee40: 7320 6e6f 7420 4e6f 6e65 0a20 2020 2020  s not None.     
+0000ee50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ee60: 2020 2061 6e64 2072 6563 2e67 6574 286b     and rec.get(k
+0000ee70: 6579 2c20 2222 2920 213d 2022 220a 2020  ey, "") != "".  
+0000ee80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ee90: 2020 2020 2020 616e 6420 7072 6576 5f76        and prev_v
+0000eea0: 616c 2021 3d20 2222 0a20 2020 2020 2020  al != "".       
+0000eeb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eec0: 2061 6e64 2072 6563 5b6b 6579 5d20 6973   and rec[key] is
+0000eed0: 206e 6f74 204e 6f6e 650a 2020 2020 2020   not None.      
+0000eee0: 2020 2020 2020 2020 2020 2020 2020 293a                ):
+0000eef0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ef00: 2020 2020 2020 2020 2073 696d 696c 6172           similar
+0000ef10: 6974 7920 3d20 6675 7a7a 2e70 6172 7469  ity = fuzz.parti
+0000ef20: 616c 5f72 6174 696f 2870 7265 765f 7661  al_ratio(prev_va
+0000ef30: 6c2c 2072 6563 5b6b 6579 5d29 202f 2031  l, rec[key]) / 1
+0000ef40: 3030 0a20 2020 2020 2020 2020 2020 2020  00.             
+0000ef50: 2020 2020 2020 2020 2020 2023 204e 6f74             # Not
+0000ef60: 6520 3a20 7468 6520 6675 7a7a 2e70 6172  e : the fuzz.par
+0000ef70: 7469 616c 5f72 6174 696f 2077 6f72 6b73  tial_ratio works
+0000ef80: 2062 6574 7465 7220 666f 7220 7061 7274   better for part
+0000ef90: 6961 6c20 7375 6273 7472 696e 6773 0a20  ial substrings. 
+0000efa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000efb0: 2020 2020 2020 2023 2066 726f 6d20 6469         # from di
+0000efc0: 6666 6c69 6220 696d 706f 7274 2053 6571  fflib import Seq
+0000efd0: 7565 6e63 654d 6174 6368 6572 0a20 2020  uenceMatcher.   
+0000efe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000eff0: 2020 2020 2023 2073 696d 696c 6172 6974       # similarit
+0000f000: 7920 3d20 5365 7175 656e 6365 4d61 7463  y = SequenceMatc
+0000f010: 6865 7228 4e6f 6e65 2c20 7072 6576 5f76  her(None, prev_v
+0000f020: 616c 2c20 7265 635b 6b65 795d 292e 7261  al, rec[key]).ra
+0000f030: 7469 6f28 290a 2020 2020 2020 2020 2020  tio().          
+0000f040: 2020 2020 2020 2020 2020 6966 2073 696d            if sim
+0000f050: 696c 6172 6974 7920 3c20 302e 3520 6f72  ilarity < 0.5 or
+0000f060: 206b 6579 2069 6e20 5b0a 2020 2020 2020   key in [.      
+0000f070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f080: 2020 2276 6f6c 756d 6522 2c0a 2020 2020    "volume",.    
+0000f090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f0a0: 2020 2020 226e 756d 6265 7222 2c0a 2020      "number",.  
+0000f0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f0c0: 2020 2020 2020 2279 6561 7222 2c0a 2020        "year",.  
+0000f0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f0e0: 2020 5d3a 0a20 2020 2020 2020 2020 2020    ]:.           
+0000f0f0: 2020 2020 2020 2020 2020 2020 206c 696e               lin
+0000f100: 6520 3d20 6622 7b63 6f6c 6f72 732e 5245  e = f"{colors.RE
+0000f110: 447d 7b72 6563 2e67 6574 286b 6579 2c20  D}{rec.get(key, 
+0000f120: 2727 297d 7b63 6f6c 6f72 732e 454e 447d  '')}{colors.END}
+0000f130: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+0000f140: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0000f150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f160: 2020 2020 6c69 6e65 203d 2070 7269 6e74      line = print
+0000f170: 5f64 6966 6628 2870 7265 765f 7661 6c2c  _diff((prev_val,
+0000f180: 2072 6563 2e67 6574 286b 6579 2c20 2222   rec.get(key, ""
+0000f190: 2929 290a 2020 2020 2020 2020 2020 2020  ))).            
+0000f1a0: 2020 2020 7072 696e 7428 6622 7b6b 6579      print(f"{key
+0000f1b0: 7d20 3a20 7b6c 696e 657d 2229 0a20 2020  } : {line}").   
+0000f1c0: 2020 2020 2020 2020 2020 2020 2070 7265               pre
+0000f1d0: 765f 7661 6c20 3d20 7265 632e 6765 7428  v_val = rec.get(
+0000f1e0: 6b65 792c 2022 2229 0a20 2020 2020 2020  key, "").       
+0000f1f0: 2020 2020 2070 7269 6e74 2829 0a0a 2020       print()..  
+0000f200: 2020 6465 6620 636c 6561 6e75 705f 7064    def cleanup_pd
+0000f210: 665f 7072 6f63 6573 7369 6e67 5f66 6965  f_processing_fie
+0000f220: 6c64 7328 7365 6c66 2920 2d3e 204e 6f6e  lds(self) -> Non
+0000f230: 653a 0a20 2020 2020 2020 2022 2222 436c  e:.        """Cl
+0000f240: 6561 6e75 7020 7468 6520 5044 4620 7072  eanup the PDF pr
+0000f250: 6f63 6573 7369 6e67 2066 6965 6c73 2028  ocessing fiels (
+0000f260: 7465 7874 5f66 726f 6d5f 7064 662c 2070  text_from_pdf, p
+0000f270: 6167 6573 5f69 6e5f 6669 6c65 2922 2222  ages_in_file)"""
+0000f280: 0a20 2020 2020 2020 2069 6620 2274 6578  .        if "tex
+0000f290: 745f 6672 6f6d 5f70 6466 2220 696e 2073  t_from_pdf" in s
+0000f2a0: 656c 662e 6461 7461 3a0a 2020 2020 2020  elf.data:.      
+0000f2b0: 2020 2020 2020 6465 6c20 7365 6c66 2e64        del self.d
+0000f2c0: 6174 615b 2274 6578 745f 6672 6f6d 5f70  ata["text_from_p
+0000f2d0: 6466 225d 0a20 2020 2020 2020 2069 6620  df"].        if 
+0000f2e0: 2270 6167 6573 5f69 6e5f 6669 6c65 2220  "pages_in_file" 
+0000f2f0: 696e 2073 656c 662e 6461 7461 3a0a 2020  in self.data:.  
+0000f300: 2020 2020 2020 2020 2020 6465 6c20 7365            del se
+0000f310: 6c66 2e64 6174 615b 2270 6167 6573 5f69  lf.data["pages_i
+0000f320: 6e5f 6669 6c65 225d 0a0a 2020 2020 6465  n_file"]..    de
+0000f330: 6620 7570 6461 7465 5f6d 6173 7465 7264  f update_masterd
+0000f340: 6174 615f 7072 6f76 656e 616e 6365 280a  ata_provenance(.
+0000f350: 2020 2020 2020 2020 7365 6c66 2c20 2a2c          self, *,
+0000f360: 2071 6d3a 2063 6f6c 7265 762e 716d 2e71   qm: colrev.qm.q
+0000f370: 7561 6c69 7479 5f6d 6f64 656c 2e51 7561  uality_model.Qua
+0000f380: 6c69 7479 4d6f 6465 6c2c 2073 6574 5f70  lityModel, set_p
+0000f390: 7265 7061 7265 643a 2062 6f6f 6c20 3d20  repared: bool = 
+0000f3a0: 4661 6c73 650a 2020 2020 2920 2d3e 204e  False.    ) -> N
+0000f3b0: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
+0000f3c0: 5570 6461 7465 2074 6865 206d 6173 7465  Update the maste
+0000f3d0: 7264 6174 6120 7072 6f76 656e 616e 6365  rdata provenance
+0000f3e0: 2222 220a 0a20 2020 2020 2020 2069 6620  """..        if 
+0000f3f0: 2263 6f6c 7265 765f 6d61 7374 6572 6461  "colrev_masterda
+0000f400: 7461 5f70 726f 7665 6e61 6e63 6522 206e  ta_provenance" n
+0000f410: 6f74 2069 6e20 7365 6c66 2e64 6174 613a  ot in self.data:
+0000f420: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000f430: 662e 6461 7461 5b22 636f 6c72 6576 5f6d  f.data["colrev_m
+0000f440: 6173 7465 7264 6174 615f 7072 6f76 656e  asterdata_proven
+0000f450: 616e 6365 225d 203d 207b 7d0a 0a20 2020  ance"] = {}..   
+0000f460: 2020 2020 2069 6620 7365 6c66 2e6d 6173       if self.mas
+0000f470: 7465 7264 6174 615f 6973 5f63 7572 6174  terdata_is_curat
+0000f480: 6564 2829 3a0a 2020 2020 2020 2020 2020  ed():.          
+0000f490: 2020 7265 7475 726e 0a0a 2020 2020 2020    return..      
+0000f4a0: 2020 2320 4170 706c 7920 7468 6520 6368    # Apply the ch
+0000f4b0: 6563 6b65 7273 2028 696e 636c 7564 696e  eckers (includin
+0000f4c0: 6720 6669 656c 6420 6b65 7920 7265 7175  g field key requ
+0000f4d0: 6972 656d 656e 7473 2065 7463 2e29 0a20  irements etc.). 
+0000f4e0: 2020 2020 2020 2071 6d2e 7275 6e28 7265         qm.run(re
+0000f4f0: 636f 7264 3d73 656c 6629 0a0a 2020 2020  cord=self)..    
+0000f500: 2020 2020 6966 2073 656c 662e 6861 735f      if self.has_
+0000f510: 7175 616c 6974 795f 6465 6665 6374 7328  quality_defects(
+0000f520: 293a 0a20 2020 2020 2020 2020 2020 2073  ):.            s
+0000f530: 656c 662e 7365 745f 7374 6174 7573 2874  elf.set_status(t
+0000f540: 6172 6765 745f 7374 6174 653d 5265 636f  arget_state=Reco
+0000f550: 7264 5374 6174 652e 6d64 5f6e 6565 6473  rdState.md_needs
+0000f560: 5f6d 616e 7561 6c5f 7072 6570 6172 6174  _manual_preparat
+0000f570: 696f 6e29 0a20 2020 2020 2020 2065 6c69  ion).        eli
+0000f580: 6620 7365 745f 7072 6570 6172 6564 3a0a  f set_prepared:.
+0000f590: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000f5a0: 2e73 6574 5f73 7461 7475 7328 7461 7267  .set_status(targ
+0000f5b0: 6574 5f73 7461 7465 3d52 6563 6f72 6453  et_state=RecordS
+0000f5c0: 7461 7465 2e6d 645f 7072 6570 6172 6564  tate.md_prepared
+0000f5d0: 290a 0a20 2020 2064 6566 2063 6865 636b  )..    def check
+0000f5e0: 5f70 6f74 656e 7469 616c 5f72 6574 7261  _potential_retra
+0000f5f0: 6374 7328 7365 6c66 2920 2d3e 2062 6f6f  cts(self) -> boo
+0000f600: 6c3a 0a20 2020 2020 2020 2022 2222 4368  l:.        """Ch
+0000f610: 6563 6b20 666f 7220 706f 7465 6e74 6961  eck for potentia
+0000f620: 6c20 7265 7472 6163 7473 2222 220a 2020  l retracts""".  
+0000f630: 2020 2020 2020 2320 4e6f 7465 203a 2077        # Note : w
+0000f640: 6520 7265 7472 6965 7665 6420 6d65 7461  e retrieved meta
+0000f650: 6461 7461 2069 6e20 6765 745f 6d61 7374  data in get_mast
+0000f660: 6572 6461 7461 5f66 726f 6d5f 6372 6f73  erdata_from_cros
+0000f670: 7372 6566 2829 0a20 2020 2020 2020 2069  sref().        i
+0000f680: 6620 7365 6c66 2e64 6174 612e 6765 7428  f self.data.get(
+0000f690: 2263 726f 7373 6d61 726b 222c 2022 2229  "crossmark", "")
+0000f6a0: 203d 3d20 2254 7275 6522 3a0a 2020 2020   == "True":.    
+0000f6b0: 2020 2020 2020 2020 7365 6c66 2e70 7265          self.pre
+0000f6c0: 7363 7265 656e 5f65 7863 6c75 6465 2872  screen_exclude(r
+0000f6d0: 6561 736f 6e3d 2272 6574 7261 6374 6564  eason="retracted
+0000f6e0: 222c 2070 7269 6e74 5f77 6172 6e69 6e67  ", print_warning
+0000f6f0: 3d54 7275 6529 0a20 2020 2020 2020 2020  =True).         
+0000f700: 2020 2073 656c 662e 7265 6d6f 7665 5f66     self.remove_f
+0000f710: 6965 6c64 286b 6579 3d22 6372 6f73 736d  ield(key="crossm
+0000f720: 6172 6b22 290a 2020 2020 2020 2020 2020  ark").          
+0000f730: 2020 7265 7475 726e 2054 7275 650a 2020    return True.  
+0000f740: 2020 2020 2020 6966 2073 656c 662e 6461        if self.da
+0000f750: 7461 2e67 6574 2822 7761 726e 696e 6722  ta.get("warning"
+0000f760: 2c20 2222 2920 3d3d 2022 5769 7468 6472  , "") == "Withdr
+0000f770: 6177 6e20 2861 6363 6f72 6469 6e67 2074  awn (according t
+0000f780: 6f20 4442 4c50 2922 3a0a 2020 2020 2020  o DBLP)":.      
+0000f790: 2020 2020 2020 7365 6c66 2e70 7265 7363        self.presc
+0000f7a0: 7265 656e 5f65 7863 6c75 6465 2872 6561  reen_exclude(rea
+0000f7b0: 736f 6e3d 2272 6574 7261 6374 6564 222c  son="retracted",
+0000f7c0: 2070 7269 6e74 5f77 6172 6e69 6e67 3d54   print_warning=T
+0000f7d0: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
+0000f7e0: 2073 656c 662e 7265 6d6f 7665 5f66 6965   self.remove_fie
+0000f7f0: 6c64 286b 6579 3d22 7761 726e 696e 6722  ld(key="warning"
+0000f800: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+0000f810: 7475 726e 2054 7275 650a 2020 2020 2020  turn True.      
+0000f820: 2020 7265 7475 726e 2046 616c 7365 0a0a    return False..
+0000f830: 2020 2020 6465 6620 7072 696e 745f 7072      def print_pr
+0000f840: 6573 6372 6565 6e5f 7265 636f 7264 2873  escreen_record(s
+0000f850: 656c 6629 202d 3e20 4e6f 6e65 3a0a 2020  elf) -> None:.  
+0000f860: 2020 2020 2020 2222 2250 7269 6e74 2074        """Print t
+0000f870: 6865 2072 6563 6f72 6420 666f 7220 7072  he record for pr
+0000f880: 6573 6372 6565 6e20 6f70 6572 6174 696f  escreen operatio
+0000f890: 6e73 2222 220a 0a20 2020 2020 2020 2072  ns"""..        r
+0000f8a0: 6574 5f73 7472 203d 2066 2220 2049 443a  et_str = f"  ID:
+0000f8b0: 207b 7365 6c66 2e64 6174 615b 2749 4427   {self.data['ID'
+0000f8c0: 5d7d 2028 7b73 656c 662e 6461 7461 5b27  ]} ({self.data['
+0000f8d0: 454e 5452 5954 5950 4527 5d7d 2922 0a20  ENTRYTYPE']})". 
+0000f8e0: 2020 2020 2020 2072 6574 5f73 7472 202b         ret_str +
+0000f8f0: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
+0000f900: 6622 5c6e 2020 7b63 6f6c 6f72 732e 4752  f"\n  {colors.GR
+0000f910: 4545 4e7d 7b73 656c 662e 6461 7461 2e67  EEN}{self.data.g
+0000f920: 6574 2827 7469 746c 6527 2c20 276e 6f20  et('title', 'no 
+0000f930: 7469 746c 6527 297d 7b63 6f6c 6f72 732e  title')}{colors.
+0000f940: 454e 447d 220a 2020 2020 2020 2020 2020  END}".          
+0000f950: 2020 6622 5c6e 2020 7b73 656c 662e 6461    f"\n  {self.da
+0000f960: 7461 2e67 6574 2827 6175 7468 6f72 272c  ta.get('author',
+0000f970: 2027 6e6f 2d61 7574 686f 7227 297d 220a   'no-author')}".
+0000f980: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+0000f990: 2020 6966 2073 656c 662e 6461 7461 5b22    if self.data["
+0000f9a0: 454e 5452 5954 5950 4522 5d20 3d3d 2022  ENTRYTYPE"] == "
+0000f9b0: 6172 7469 636c 6522 3a0a 2020 2020 2020  article":.      
+0000f9c0: 2020 2020 2020 7265 745f 7374 7220 2b3d        ret_str +=
+0000f9d0: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
+0000f9e0: 2020 2066 225c 6e20 207b 7365 6c66 2e64     f"\n  {self.d
+0000f9f0: 6174 612e 6765 7428 276a 6f75 726e 616c  ata.get('journal
+0000fa00: 272c 2027 6e6f 2d6a 6f75 726e 616c 2729  ', 'no-journal')
+0000fa10: 7d20 220a 2020 2020 2020 2020 2020 2020  } ".            
+0000fa20: 2020 2020 6622 287b 7365 6c66 2e64 6174      f"({self.dat
+0000fa30: 612e 6765 7428 2779 6561 7227 2c20 276e  a.get('year', 'n
+0000fa40: 6f2d 7965 6172 2729 7d29 2022 0a20 2020  o-year')}) ".   
+0000fa50: 2020 2020 2020 2020 2020 2020 2066 227b               f"{
+0000fa60: 7365 6c66 2e64 6174 612e 6765 7428 2776  self.data.get('v
+0000fa70: 6f6c 756d 6527 2c20 276e 6f2d 766f 6c75  olume', 'no-volu
+0000fa80: 6d65 2729 7d22 0a20 2020 2020 2020 2020  me')}".         
+0000fa90: 2020 2020 2020 2066 2228 7b73 656c 662e         f"({self.
+0000faa0: 6461 7461 2e67 6574 2827 6e75 6d62 6572  data.get('number
+0000fab0: 272c 2027 2729 7d29 220a 2020 2020 2020  ', '')})".      
+0000fac0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0000fad0: 656c 6966 2073 656c 662e 6461 7461 5b22  elif self.data["
+0000fae0: 454e 5452 5954 5950 4522 5d20 3d3d 2022  ENTRYTYPE"] == "
+0000faf0: 696e 7072 6f63 6565 6469 6e67 7322 3a0a  inproceedings":.
+0000fb00: 2020 2020 2020 2020 2020 2020 7265 745f              ret_
+0000fb10: 7374 7220 2b3d 2066 225c 6e20 207b 7365  str += f"\n  {se
+0000fb20: 6c66 2e64 6174 612e 6765 7428 2762 6f6f  lf.data.get('boo
+0000fb30: 6b74 6974 6c65 272c 2027 6e6f 2d62 6f6f  ktitle', 'no-boo
+0000fb40: 6b74 6974 6c65 2729 7d22 0a20 2020 2020  ktitle')}".     
+0000fb50: 2020 2069 6620 2261 6273 7472 6163 7422     if "abstract"
+0000fb60: 2069 6e20 7365 6c66 2e64 6174 613a 0a20   in self.data:. 
+0000fb70: 2020 2020 2020 2020 2020 206c 696e 6573             lines
+0000fb80: 203d 2074 6578 7477 7261 702e 7772 6170   = textwrap.wrap
+0000fb90: 2873 656c 662e 6461 7461 5b22 6162 7374  (self.data["abst
+0000fba0: 7261 6374 225d 2c20 3130 302c 2062 7265  ract"], 100, bre
+0000fbb0: 616b 5f6c 6f6e 675f 776f 7264 733d 4661  ak_long_words=Fa
+0000fbc0: 6c73 6529 0a20 2020 2020 2020 2020 2020  lse).           
+0000fbd0: 2069 6620 6c69 6e65 733a 0a20 2020 2020   if lines:.     
+0000fbe0: 2020 2020 2020 2020 2020 2072 6574 5f73             ret_s
+0000fbf0: 7472 202b 3d20 6622 5c6e 2020 4162 7374  tr += f"\n  Abst
+0000fc00: 7261 6374 3a20 7b6c 696e 6573 2e70 6f70  ract: {lines.pop
+0000fc10: 2830 297d 5c6e 220a 2020 2020 2020 2020  (0)}\n".        
+0000fc20: 2020 2020 2020 2020 7265 745f 7374 7220          ret_str 
+0000fc30: 2b3d 2022 5c6e 2020 222e 6a6f 696e 286c  += "\n  ".join(l
+0000fc40: 696e 6573 2920 2b20 2222 0a0a 2020 2020  ines) + ""..    
+0000fc50: 2020 2020 6966 2022 7572 6c22 2069 6e20      if "url" in 
+0000fc60: 7365 6c66 2e64 6174 613a 0a20 2020 2020  self.data:.     
+0000fc70: 2020 2020 2020 2072 6574 5f73 7472 202b         ret_str +
+0000fc80: 3d20 6622 5c6e 2020 7572 6c3a 207b 7365  = f"\n  url: {se
+0000fc90: 6c66 2e64 6174 615b 2775 726c 275d 7d22  lf.data['url']}"
+0000fca0: 0a0a 2020 2020 2020 2020 6966 2022 6669  ..        if "fi
+0000fcb0: 6c65 2220 696e 2073 656c 662e 6461 7461  le" in self.data
+0000fcc0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+0000fcd0: 745f 7374 7220 2b3d 2066 225c 6e20 2066  t_str += f"\n  f
+0000fce0: 696c 653a 207b 7365 6c66 2e64 6174 615b  ile: {self.data[
+0000fcf0: 2766 696c 6527 5d7d 220a 0a20 2020 2020  'file']}"..     
+0000fd00: 2020 2070 7269 6e74 2872 6574 5f73 7472     print(ret_str
+0000fd10: 290a 0a20 2020 2064 6566 2070 7269 6e74  )..    def print
+0000fd20: 5f70 6466 5f70 7265 705f 6d61 6e28 7365  _pdf_prep_man(se
+0000fd30: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
+0000fd40: 2020 2020 2022 2222 5072 696e 7420 7468       """Print th
+0000fd50: 6520 7265 636f 7264 2066 6f72 2070 6466  e record for pdf
+0000fd60: 2d70 7265 702d 6d61 6e20 6f70 6572 6174  -prep-man operat
+0000fd70: 696f 6e73 2222 220a 2020 2020 2020 2020  ions""".        
+0000fd80: 2320 7079 6c69 6e74 3a20 6469 7361 626c  # pylint: disabl
+0000fd90: 653d 746f 6f2d 6d61 6e79 2d62 7261 6e63  e=too-many-branc
+0000fda0: 6865 730a 2020 2020 2020 2020 7265 745f  hes.        ret_
+0000fdb0: 7374 7220 3d20 2222 0a20 2020 2020 2020  str = "".       
+0000fdc0: 2069 6620 2266 696c 6522 2069 6e20 7365   if "file" in se
+0000fdd0: 6c66 2e64 6174 613a 0a20 2020 2020 2020  lf.data:.       
+0000fde0: 2020 2020 2072 6574 5f73 7472 202b 3d20       ret_str += 
+0000fdf0: 6622 5c6e 6669 6c65 3a20 7b63 6f6c 6f72  f"\nfile: {color
+0000fe00: 732e 4f52 414e 4745 7d7b 7365 6c66 2e64  s.ORANGE}{self.d
+0000fe10: 6174 615b 2766 696c 6527 5d7d 7b63 6f6c  ata['file']}{col
+0000fe20: 6f72 732e 454e 447d 5c6e 5c6e 220a 0a20  ors.END}\n\n".. 
+0000fe30: 2020 2020 2020 2070 6466 5f70 7265 705f         pdf_prep_
+0000fe40: 6e6f 7465 203d 2073 656c 662e 6765 745f  note = self.get_
+0000fe50: 6669 656c 645f 7072 6f76 656e 616e 6365  field_provenance
+0000fe60: 286b 6579 3d22 6669 6c65 2229 0a0a 2020  (key="file")..  
+0000fe70: 2020 2020 2020 6966 2022 6175 7468 6f72        if "author
+0000fe80: 5f6e 6f74 5f69 6e5f 6669 7273 745f 7061  _not_in_first_pa
+0000fe90: 6765 7322 2069 6e20 7064 665f 7072 6570  ges" in pdf_prep
+0000fea0: 5f6e 6f74 655b 226e 6f74 6522 5d3a 0a20  _note["note"]:. 
+0000feb0: 2020 2020 2020 2020 2020 2072 6574 5f73             ret_s
+0000fec0: 7472 202b 3d20 280a 2020 2020 2020 2020  tr += (.        
+0000fed0: 2020 2020 2020 2020 6622 7b63 6f6c 6f72          f"{color
+0000fee0: 732e 5245 447d 7b73 656c 662e 6461 7461  s.RED}{self.data
+0000fef0: 2e67 6574 2827 6175 7468 6f72 272c 2027  .get('author', '
+0000ff00: 6e6f 2d61 7574 686f 7227 297d 7b63 6f6c  no-author')}{col
+0000ff10: 6f72 732e 454e 447d 5c6e 220a 2020 2020  ors.END}\n".    
+0000ff20: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+0000ff30: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0000ff40: 2020 2020 7265 745f 7374 7220 2b3d 2028      ret_str += (
+0000ff50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ff60: 2066 227b 636f 6c6f 7273 2e47 5245 454e   f"{colors.GREEN
+0000ff70: 7d7b 7365 6c66 2e64 6174 612e 6765 7428  }{self.data.get(
+0000ff80: 2761 7574 686f 7227 2c20 276e 6f2d 6175  'author', 'no-au
+0000ff90: 7468 6f72 2729 7d7b 636f 6c6f 7273 2e45  thor')}{colors.E
+0000ffa0: 4e44 7d5c 6e22 0a20 2020 2020 2020 2020  ND}\n".         
+0000ffb0: 2020 2029 0a0a 2020 2020 2020 2020 6966     )..        if
+0000ffc0: 2022 7469 746c 655f 6e6f 745f 696e 5f66   "title_not_in_f
+0000ffd0: 6972 7374 5f70 6167 6573 2220 696e 2070  irst_pages" in p
+0000ffe0: 6466 5f70 7265 705f 6e6f 7465 5b22 6e6f  df_prep_note["no
+0000fff0: 7465 225d 3a0a 2020 2020 2020 2020 2020  te"]:.          
+00010000: 2020 7265 745f 7374 7220 2b3d 2066 227b    ret_str += f"{
+00010010: 636f 6c6f 7273 2e52 4544 7d7b 7365 6c66  colors.RED}{self
+00010020: 2e64 6174 612e 6765 7428 2774 6974 6c65  .data.get('title
+00010030: 272c 2027 6e6f 2074 6974 6c65 2729 7d7b  ', 'no title')}{
+00010040: 636f 6c6f 7273 2e45 4e44 7d5c 6e22 0a20  colors.END}\n". 
+00010050: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00010060: 2020 2020 2020 2020 2072 6574 5f73 7472           ret_str
+00010070: 202b 3d20 280a 2020 2020 2020 2020 2020   += (.          
+00010080: 2020 2020 2020 6622 7b63 6f6c 6f72 732e        f"{colors.
+00010090: 4752 4545 4e7d 7b73 656c 662e 6461 7461  GREEN}{self.data
+000100a0: 2e67 6574 2827 7469 746c 6527 2c20 276e  .get('title', 'n
+000100b0: 6f20 7469 746c 6527 297d 7b63 6f6c 6f72  o title')}{color
+000100c0: 732e 454e 447d 5c6e 220a 2020 2020 2020  s.END}\n".      
+000100d0: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+000100e0: 2069 6620 7365 6c66 2e64 6174 615b 2245   if self.data["E
+000100f0: 4e54 5259 5459 5045 225d 203d 3d20 2261  NTRYTYPE"] == "a
+00010100: 7274 6963 6c65 223a 0a20 2020 2020 2020  rticle":.       
+00010110: 2020 2020 2072 6574 5f73 7472 202b 3d20       ret_str += 
+00010120: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00010130: 2020 6622 7b73 656c 662e 6461 7461 2e67    f"{self.data.g
+00010140: 6574 2827 6a6f 7572 6e61 6c27 2c20 276e  et('journal', 'n
+00010150: 6f2d 6a6f 7572 6e61 6c27 297d 2022 0a20  o-journal')} ". 
+00010160: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00010170: 2228 7b73 656c 662e 6461 7461 2e67 6574  "({self.data.get
+00010180: 2827 7965 6172 272c 2027 6e6f 2d79 6561  ('year', 'no-yea
+00010190: 7227 297d 2920 220a 2020 2020 2020 2020  r')}) ".        
+000101a0: 2020 2020 2020 2020 6622 7b73 656c 662e          f"{self.
+000101b0: 6461 7461 2e67 6574 2827 766f 6c75 6d65  data.get('volume
+000101c0: 272c 2027 6e6f 2d76 6f6c 756d 6527 297d  ', 'no-volume')}
+000101d0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+000101e0: 2020 6622 287b 7365 6c66 2e64 6174 612e    f"({self.data.
+000101f0: 6765 7428 276e 756d 6265 7227 2c20 2727  get('number', ''
+00010200: 297d 2922 0a20 2020 2020 2020 2020 2020  )})".           
+00010210: 2029 0a20 2020 2020 2020 2020 2020 2069   ).            i
+00010220: 6620 2270 6167 6573 2220 696e 2073 656c  f "pages" in sel
+00010230: 662e 6461 7461 3a0a 2020 2020 2020 2020  f.data:.        
+00010240: 2020 2020 2020 2020 6966 2022 6e72 5f70          if "nr_p
+00010250: 6167 6573 5f6e 6f74 5f6d 6174 6368 696e  ages_not_matchin
+00010260: 6722 2069 6e20 7064 665f 7072 6570 5f6e  g" in pdf_prep_n
+00010270: 6f74 655b 226e 6f74 6522 5d3a 0a20 2020  ote["note"]:.   
+00010280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010290: 2072 6574 5f73 7472 202b 3d20 6622 2c20   ret_str += f", 
+000102a0: 7b63 6f6c 6f72 732e 5245 447d 7070 2e7b  {colors.RED}pp.{
+000102b0: 7365 6c66 2e64 6174 615b 2770 6167 6573  self.data['pages
+000102c0: 275d 7d7b 636f 6c6f 7273 2e45 4e44 7d5c  ']}{colors.END}\
+000102d0: 6e22 0a20 2020 2020 2020 2020 2020 2020  n".             
+000102e0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+000102f0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+00010300: 5f73 7472 202b 3d20 6622 2c20 7070 2e7b  _str += f", pp.{
+00010310: 636f 6c6f 7273 2e47 5245 454e 7d7b 7365  colors.GREEN}{se
+00010320: 6c66 2e64 6174 615b 2770 6167 6573 275d  lf.data['pages']
+00010330: 7d7b 636f 6c6f 7273 2e45 4e44 7d5c 6e22  }{colors.END}\n"
+00010340: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+00010350: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00010360: 2020 2072 6574 5f73 7472 202b 3d20 225c     ret_str += "\
+00010370: 6e22 0a20 2020 2020 2020 2065 6c69 6620  n".        elif 
+00010380: 7365 6c66 2e64 6174 615b 2245 4e54 5259  self.data["ENTRY
+00010390: 5459 5045 225d 203d 3d20 2269 6e70 726f  TYPE"] == "inpro
+000103a0: 6365 6564 696e 6773 223a 0a20 2020 2020  ceedings":.     
+000103b0: 2020 2020 2020 2072 6574 5f73 7472 202b         ret_str +
+000103c0: 3d20 6622 7b73 656c 662e 6461 7461 2e67  = f"{self.data.g
+000103d0: 6574 2827 626f 6f6b 7469 746c 6527 2c20  et('booktitle', 
+000103e0: 276e 6f2d 626f 6f6b 7469 746c 6527 297d  'no-booktitle')}
+000103f0: 5c6e 220a 2020 2020 2020 2020 6966 2022  \n".        if "
+00010400: 6162 7374 7261 6374 2220 696e 2073 656c  abstract" in sel
+00010410: 662e 6461 7461 3a0a 2020 2020 2020 2020  f.data:.        
+00010420: 2020 2020 6c69 6e65 7320 3d20 7465 7874      lines = text
+00010430: 7772 6170 2e77 7261 7028 7365 6c66 2e64  wrap.wrap(self.d
+00010440: 6174 615b 2261 6273 7472 6163 7422 5d2c  ata["abstract"],
+00010450: 2031 3030 2c20 6272 6561 6b5f 6c6f 6e67   100, break_long
+00010460: 5f77 6f72 6473 3d46 616c 7365 290a 2020  _words=False).  
+00010470: 2020 2020 2020 2020 2020 7265 745f 7374            ret_st
+00010480: 7220 2b3d 2066 225c 6e41 6273 7472 6163  r += f"\nAbstrac
+00010490: 743a 207b 6c69 6e65 732e 706f 7028 3029  t: {lines.pop(0)
+000104a0: 7d5c 6e22 0a20 2020 2020 2020 2020 2020  }\n".           
+000104b0: 2072 6574 5f73 7472 202b 3d20 225c 6e22   ret_str += "\n"
+000104c0: 2e6a 6f69 6e28 6c69 6e65 7329 202b 2022  .join(lines) + "
+000104d0: 5c6e 220a 0a20 2020 2020 2020 2069 6620  \n"..        if 
+000104e0: 2275 726c 2220 696e 2073 656c 662e 6461  "url" in self.da
+000104f0: 7461 3a0a 2020 2020 2020 2020 2020 2020  ta:.            
+00010500: 7265 745f 7374 7220 2b3d 2066 225c 6e75  ret_str += f"\nu
+00010510: 726c 3a20 7b73 656c 662e 6461 7461 5b27  rl: {self.data['
+00010520: 7572 6c27 5d7d 5c6e 220a 0a20 2020 2020  url']}\n"..     
+00010530: 2020 2070 7269 6e74 2872 6574 5f73 7472     print(ret_str
+00010540: 290a 0a0a 636c 6173 7320 5072 6570 5265  )...class PrepRe
+00010550: 636f 7264 2852 6563 6f72 6429 3a0a 2020  cord(Record):.  
+00010560: 2020 2222 2254 6865 2050 7265 7052 6563    """The PrepRec
+00010570: 6f72 6420 636c 6173 7320 7072 6f76 6964  ord class provid
+00010580: 6573 2061 2072 616e 6765 206f 6620 636f  es a range of co
+00010590: 6e76 656e 6965 6e63 6520 6675 6e63 7469  nvenience functi
+000105a0: 6f6e 7320 666f 7220 7265 636f 7264 2070  ons for record p
+000105b0: 7265 7061 7261 7469 6f6e 2222 220a 0a20  reparation""".. 
+000105c0: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
+000105d0: 2020 2020 6465 6620 666f 726d 6174 5f61      def format_a
+000105e0: 7574 686f 725f 6669 656c 6428 636c 732c  uthor_field(cls,
+000105f0: 202a 2c20 696e 7075 745f 7374 7269 6e67   *, input_string
+00010600: 3a20 7374 7229 202d 3e20 7374 723a 0a20  : str) -> str:. 
+00010610: 2020 2020 2020 2022 2222 466f 726d 6174         """Format
+00010620: 2074 6865 2061 7574 686f 7220 6669 656c   the author fiel
+00010630: 6420 2872 6563 6f67 6e69 7a69 6e67 2066  d (recognizing f
+00010640: 6972 7374 2f6c 6173 7420 6e61 6d65 7320  irst/last names 
+00010650: 6261 7365 6420 6f6e 2048 756d 616e 4e61  based on HumanNa
+00010660: 6d65 2070 6172 7365 7229 2222 220a 0a20  me parser)""".. 
+00010670: 2020 2020 2020 2064 6566 206d 6f73 746c         def mostl
+00010680: 795f 7570 7065 725f 6361 7365 2869 6e70  y_upper_case(inp
+00010690: 7574 5f73 7472 696e 673a 2073 7472 2920  ut_string: str) 
+000106a0: 2d3e 2062 6f6f 6c3a 0a20 2020 2020 2020  -> bool:.       
+000106b0: 2020 2020 2069 6620 6e6f 7420 7265 2e6d       if not re.m
+000106c0: 6174 6368 2872 225b 612d 7a41 2d5a 5d2b  atch(r"[a-zA-Z]+
+000106d0: 222c 2069 6e70 7574 5f73 7472 696e 6729  ", input_string)
+000106e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000106f0: 2020 7265 7475 726e 2046 616c 7365 0a20    return False. 
+00010700: 2020 2020 2020 2020 2020 2069 6e70 7574             input
+00010710: 5f73 7472 696e 6720 3d20 696e 7075 745f  _string = input_
+00010720: 7374 7269 6e67 2e72 6570 6c61 6365 2822  string.replace("
+00010730: 2e22 2c20 2222 292e 7265 706c 6163 6528  .", "").replace(
+00010740: 222c 222c 2022 2229 0a20 2020 2020 2020  ",", "").       
+00010750: 2020 2020 2077 6f72 6473 203d 2069 6e70       words = inp
+00010760: 7574 5f73 7472 696e 672e 7370 6c69 7428  ut_string.split(
+00010770: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+00010780: 7475 726e 2073 756d 2877 6f72 642e 6973  turn sum(word.is
+00010790: 7570 7065 7228 2920 666f 7220 776f 7264  upper() for word
+000107a0: 2069 6e20 776f 7264 7329 202f 206c 656e   in words) / len
+000107b0: 2877 6f72 6473 2920 3e20 302e 380a 0a20  (words) > 0.8.. 
+000107c0: 2020 2020 2020 2069 6e70 7574 5f73 7472         input_str
+000107d0: 696e 6720 3d20 696e 7075 745f 7374 7269  ing = input_stri
+000107e0: 6e67 2e72 6570 6c61 6365 2822 5c6e 222c  ng.replace("\n",
+000107f0: 2022 2022 290a 2020 2020 2020 2020 2320   " ").        # 
+00010800: 4442 4c50 2061 7070 656e 6473 2069 6465  DBLP appends ide
+00010810: 6e74 6966 6965 7273 2074 6f20 6e6f 6e2d  ntifiers to non-
+00010820: 756e 6971 7565 2061 7574 686f 7273 0a20  unique authors. 
+00010830: 2020 2020 2020 2069 6e70 7574 5f73 7472         input_str
+00010840: 696e 6720 3d20 7374 7228 7265 2e73 7562  ing = str(re.sub
+00010850: 2872 225b 302d 395d 7b34 7d22 2c20 2222  (r"[0-9]{4}", ""
+00010860: 2c20 696e 7075 745f 7374 7269 6e67 2929  , input_string))
+00010870: 0a0a 2020 2020 2020 2020 6966 2022 2061  ..        if " a
+00010880: 6e64 2022 2069 6e20 696e 7075 745f 7374  nd " in input_st
+00010890: 7269 6e67 3a0a 2020 2020 2020 2020 2020  ring:.          
+000108a0: 2020 6e61 6d65 7320 3d20 696e 7075 745f    names = input_
+000108b0: 7374 7269 6e67 2e73 706c 6974 2822 2061  string.split(" a
+000108c0: 6e64 2022 290a 2020 2020 2020 2020 656c  nd ").        el
+000108d0: 6966 2069 6e70 7574 5f73 7472 696e 672e  if input_string.
+000108e0: 636f 756e 7428 222c 2229 203e 2031 3a0a  count(",") > 1:.
+000108f0: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
+00010900: 7320 3d20 696e 7075 745f 7374 7269 6e67  s = input_string
+00010910: 2e73 706c 6974 2822 2c20 2229 0a20 2020  .split(", ").   
+00010920: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00010930: 2020 2020 2020 206e 616d 6573 203d 205b         names = [
+00010940: 696e 7075 745f 7374 7269 6e67 5d0a 2020  input_string].  
+00010950: 2020 2020 2020 6175 7468 6f72 5f73 7472        author_str
+00010960: 696e 6720 3d20 2222 0a20 2020 2020 2020  ing = "".       
+00010970: 2066 6f72 206e 616d 6520 696e 206e 616d   for name in nam
+00010980: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+00010990: 2320 4e6f 7465 3a20 6874 7470 733a 2f2f  # Note: https://
+000109a0: 6769 7468 7562 2e63 6f6d 2f64 6572 656b  github.com/derek
+000109b0: 3733 2f70 7974 686f 6e2d 6e61 6d65 7061  73/python-namepa
+000109c0: 7273 6572 0a20 2020 2020 2020 2020 2020  rser.           
+000109d0: 2023 2069 7320 7665 7279 2065 6666 6563   # is very effec
+000109e0: 7469 7665 2028 6d61 7962 6520 6e6f 7420  tive (maybe not 
+000109f0: 7065 7266 6563 7429 0a0a 2020 2020 2020  perfect)..      
+00010a00: 2020 2020 2020 7061 7273 6564 5f6e 616d        parsed_nam
+00010a10: 6520 3d20 4875 6d61 6e4e 616d 6528 6e61  e = HumanName(na
+00010a20: 6d65 290a 2020 2020 2020 2020 2020 2020  me).            
+00010a30: 6966 206d 6f73 746c 795f 7570 7065 725f  if mostly_upper_
+00010a40: 6361 7365 2869 6e70 7574 5f73 7472 696e  case(input_strin
+00010a50: 672e 7265 706c 6163 6528 2220 616e 6420  g.replace(" and 
+00010a60: 222c 2022 2229 2e72 6570 6c61 6365 2822  ", "").replace("
+00010a70: 4a72 222c 2022 2229 293a 0a20 2020 2020  Jr", "")):.     
+00010a80: 2020 2020 2020 2020 2020 2070 6172 7365             parse
+00010a90: 645f 6e61 6d65 2e63 6170 6974 616c 697a  d_name.capitaliz
+00010aa0: 6528 666f 7263 653d 5472 7565 290a 0a20  e(force=True).. 
+00010ab0: 2020 2020 2020 2020 2020 2023 2046 6978             # Fix
+00010ac0: 2074 7970 6963 616c 2070 6172 7365 7220   typical parser 
+00010ad0: 6572 726f 720a 2020 2020 2020 2020 2020  error.          
+00010ae0: 2020 6966 2070 6172 7365 645f 6e61 6d65    if parsed_name
+00010af0: 2e6c 6173 7420 3d3d 2022 2220 616e 6420  .last == "" and 
+00010b00: 7061 7273 6564 5f6e 616d 652e 7469 746c  parsed_name.titl
+00010b10: 6520 213d 2022 223a 0a20 2020 2020 2020  e != "":.       
+00010b20: 2020 2020 2020 2020 2070 6172 7365 645f           parsed_
+00010b30: 6e61 6d65 2e6c 6173 7420 3d20 7061 7273  name.last = pars
+00010b40: 6564 5f6e 616d 652e 7469 746c 650a 0a20  ed_name.title.. 
+00010b50: 2020 2020 2020 2020 2020 2023 2070 796c             # pyl
+00010b60: 696e 743a 2064 6973 6162 6c65 3d63 6861  int: disable=cha
+00010b70: 696e 6564 2d63 6f6d 7061 7269 736f 6e0a  ined-comparison.
+00010b80: 2020 2020 2020 2020 2020 2020 2320 4669              # Fi
+00010b90: 783a 2077 6865 6e20 6669 7273 7420 6e61  x: when first na
+00010ba0: 6d65 7320 6172 6520 6162 6272 6576 6961  mes are abbrevia
+00010bb0: 7465 642c 206e 616d 6570 6172 7365 7220  ted, nameparser 
+00010bc0: 6372 6561 7465 7320 6572 726f 7273 3a0a  creates errors:.
+00010bd0: 2020 2020 2020 2020 2020 2020 6966 2028              if (
+00010be0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010bf0: 206c 656e 2870 6172 7365 645f 6e61 6d65   len(parsed_name
+00010c00: 2e6c 6173 7429 203c 3d20 330a 2020 2020  .last) <= 3.    
+00010c10: 2020 2020 2020 2020 2020 2020 616e 6420              and 
+00010c20: 7061 7273 6564 5f6e 616d 652e 6c61 7374  parsed_name.last
+00010c30: 2e69 7375 7070 6572 2829 0a20 2020 2020  .isupper().     
+00010c40: 2020 2020 2020 2020 2020 2061 6e64 206c             and l
+00010c50: 656e 2870 6172 7365 645f 6e61 6d65 2e66  en(parsed_name.f
+00010c60: 6972 7374 2920 3e20 330a 2020 2020 2020  irst) > 3.      
+00010c70: 2020 2020 2020 2020 2020 616e 6420 6e6f            and no
+00010c80: 7420 7061 7273 6564 5f6e 616d 652e 6669  t parsed_name.fi
+00010c90: 7273 742e 6973 7570 7065 7228 290a 2020  rst.isupper().  
+00010ca0: 2020 2020 2020 2020 2020 293a 0a20 2020            ):.   
+00010cb0: 2020 2020 2020 2020 2020 2020 2023 2069               # i
+00010cc0: 6e20 7468 6573 6520 6361 7365 6573 2c20  n these casees, 
+00010cd0: 6669 7273 7420 616e 6420 6c61 7374 206e  first and last n
+00010ce0: 616d 6573 2061 7265 2063 6f6e 6675 7365  ames are confuse
+00010cf0: 640a 2020 2020 2020 2020 2020 2020 2020  d.              
+00010d00: 2020 6175 7468 6f72 5f6e 616d 655f 7374    author_name_st
+00010d10: 7269 6e67 203d 2070 6172 7365 645f 6e61  ring = parsed_na
+00010d20: 6d65 2e66 6972 7374 202b 2022 2c20 2220  me.first + ", " 
+00010d30: 2b20 7061 7273 6564 5f6e 616d 652e 6c61  + parsed_name.la
+00010d40: 7374 0a20 2020 2020 2020 2020 2020 2065  st.            e
+00010d50: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00010d60: 2020 2020 2070 6172 7365 645f 6e61 6d65       parsed_name
+00010d70: 2e73 7472 696e 675f 666f 726d 6174 203d  .string_format =
+00010d80: 2022 7b6c 6173 747d 207b 7375 6666 6978   "{last} {suffix
+00010d90: 7d2c 207b 6669 7273 747d 207b 6d69 6464  }, {first} {midd
+00010da0: 6c65 7d22 0a20 2020 2020 2020 2020 2020  le}".           
+00010db0: 2020 2020 2023 2027 7b6c 6173 747d 207b       # '{last} {
+00010dc0: 7375 6666 6978 7d2c 207b 6669 7273 747d  suffix}, {first}
+00010dd0: 2028 7b6e 6963 6b6e 616d 657d 2920 7b6d   ({nickname}) {m
+00010de0: 6964 646c 657d 270a 2020 2020 2020 2020  iddle}'.        
+00010df0: 2020 2020 2020 2020 6175 7468 6f72 5f6e          author_n
+00010e00: 616d 655f 7374 7269 6e67 203d 2073 7472  ame_string = str
+00010e10: 2870 6172 7365 645f 6e61 6d65 292e 7265  (parsed_name).re
+00010e20: 706c 6163 6528 2220 2c20 222c 2022 2c20  place(" , ", ", 
+00010e30: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+00010e40: 2020 2023 204e 6f74 653a 2074 6865 7265     # Note: there
+00010e50: 2061 7265 2065 7272 6f72 7320 666f 7220   are errors for 
+00010e60: 7468 6520 666f 6c6c 6f77 696e 6720 6175  the following au
+00010e70: 7468 6f72 3a0a 2020 2020 2020 2020 2020  thor:.          
+00010e80: 2020 2020 2020 2320 4a52 2043 726f 6d77        # JR Cromw
+00010e90: 656c 6c20 616e 6420 484b 2047 6172 646e  ell and HK Gardn
+00010ea0: 6572 0a20 2020 2020 2020 2020 2020 2020  er.             
+00010eb0: 2020 2023 2054 6865 204a 5220 6973 2070     # The JR is p
+00010ec0: 726f 6261 626c 7920 7265 636f 676e 697a  robably recogniz
+00010ed0: 6564 2061 7320 4a75 6e69 6f72 2e0a 2020  ed as Junior..  
+00010ee0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00010ef0: 4368 6563 6b20 7768 6574 6865 7220 7468  Check whether th
+00010f00: 6973 2069 7320 6669 7865 6420 696e 2074  is is fixed in t
+00010f10: 6865 2047 726f 6269 6420 6e61 6d65 2070  he Grobid name p
+00010f20: 6172 7365 720a 0a20 2020 2020 2020 2020  arser..         
+00010f30: 2020 2069 6620 6175 7468 6f72 5f73 7472     if author_str
+00010f40: 696e 6720 3d3d 2022 223a 0a20 2020 2020  ing == "":.     
+00010f50: 2020 2020 2020 2020 2020 2061 7574 686f             autho
+00010f60: 725f 7374 7269 6e67 203d 2061 7574 686f  r_string = autho
+00010f70: 725f 6e61 6d65 5f73 7472 696e 670a 2020  r_name_string.  
+00010f80: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00010f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010fa0: 6175 7468 6f72 5f73 7472 696e 6720 3d20  author_string = 
+00010fb0: 6175 7468 6f72 5f73 7472 696e 6720 2b20  author_string + 
+00010fc0: 2220 616e 6420 2220 2b20 6175 7468 6f72  " and " + author
+00010fd0: 5f6e 616d 655f 7374 7269 6e67 0a0a 2020  _name_string..  
+00010fe0: 2020 2020 2020 7265 7475 726e 2061 7574        return aut
+00010ff0: 686f 725f 7374 7269 6e67 0a0a 2020 2020  hor_string..    
+00011000: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
+00011010: 2064 6566 205f 5f66 6f72 6d61 745f 6175   def __format_au
+00011020: 7468 6f72 735f 7374 7269 6e67 5f66 6f72  thors_string_for
+00011030: 5f63 6f6d 7061 7269 736f 6e28 636c 732c  _comparison(cls,
+00011040: 202a 2c20 7265 636f 7264 3a20 5265 636f   *, record: Reco
+00011050: 7264 2920 2d3e 204e 6f6e 653a 0a20 2020  rd) -> None:.   
+00011060: 2020 2020 2069 6620 2261 7574 686f 7222       if "author"
+00011070: 206e 6f74 2069 6e20 7265 636f 7264 2e64   not in record.d
+00011080: 6174 613a 0a20 2020 2020 2020 2020 2020  ata:.           
+00011090: 2072 6574 7572 6e0a 2020 2020 2020 2020   return.        
+000110a0: 6175 7468 6f72 7320 3d20 7265 636f 7264  authors = record
+000110b0: 2e64 6174 615b 2261 7574 686f 7222 5d0a  .data["author"].
+000110c0: 2020 2020 2020 2020 6175 7468 6f72 7320          authors 
+000110d0: 3d20 7374 7228 6175 7468 6f72 7329 2e6c  = str(authors).l
+000110e0: 6f77 6572 2829 0a20 2020 2020 2020 2061  ower().        a
+000110f0: 7574 686f 7273 5f73 7472 696e 6720 3d20  uthors_string = 
+00011100: 2222 0a20 2020 2020 2020 2061 7574 686f  "".        autho
+00011110: 7273 203d 2063 6f6c 7265 762e 656e 762e  rs = colrev.env.
+00011120: 7574 696c 732e 7265 6d6f 7665 5f61 6363  utils.remove_acc
+00011130: 656e 7473 2869 6e70 7574 5f73 7472 3d61  ents(input_str=a
+00011140: 7574 686f 7273 290a 0a20 2020 2020 2020  uthors)..       
+00011150: 2023 2061 6262 7265 7669 6174 6520 6669   # abbreviate fi
+00011160: 7273 7420 6e61 6d65 730a 2020 2020 2020  rst names.      
+00011170: 2020 2320 2257 6562 7374 6572 2c20 4a61    # "Webster, Ja
+00011180: 6e65 2220 2d3e 2022 5765 6273 7465 722c  ne" -> "Webster,
+00011190: 204a 220a 2020 2020 2020 2020 2320 616c   J".        # al
+000111a0: 736f 2072 656d 6f76 6520 616c 6c20 7370  so remove all sp
+000111b0: 6563 6961 6c20 6368 6172 6163 7465 7273  ecial characters
+000111c0: 2061 6e64 2064 6f20 6e6f 7420 696e 636c   and do not incl
+000111d0: 7564 6520 7365 7061 7261 746f 7273 2028  ude separators (
+000111e0: 616e 6429 0a20 2020 2020 2020 2066 6f72  and).        for
+000111f0: 2061 7574 686f 7220 696e 2061 7574 686f   author in autho
+00011200: 7273 2e73 706c 6974 2822 2061 6e64 2022  rs.split(" and "
+00011210: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
+00011220: 6620 222c 2220 696e 2061 7574 686f 723a  f "," in author:
+00011230: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011240: 206c 6173 745f 6e61 6d65 7320 3d20 5b0a   last_names = [.
+00011250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011260: 2020 2020 776f 7264 5b30 5d20 666f 7220      word[0] for 
+00011270: 776f 7264 2069 6e20 6175 7468 6f72 2e73  word in author.s
+00011280: 706c 6974 2822 2c22 295b 315d 2e73 706c  plit(",")[1].spl
+00011290: 6974 2822 2022 2920 6966 206c 656e 2877  it(" ") if len(w
+000112a0: 6f72 6429 203e 2030 0a20 2020 2020 2020  ord) > 0.       
+000112b0: 2020 2020 2020 2020 205d 0a20 2020 2020           ].     
+000112c0: 2020 2020 2020 2020 2020 2061 7574 686f             autho
+000112d0: 7273 5f73 7472 696e 6720 3d20 280a 2020  rs_string = (.  
+000112e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000112f0: 2020 6175 7468 6f72 735f 7374 7269 6e67    authors_string
+00011300: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011310: 2020 2020 202b 2061 7574 686f 722e 7370       + author.sp
+00011320: 6c69 7428 222c 2229 5b30 5d0a 2020 2020  lit(",")[0].    
+00011330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011340: 2b20 2220 220a 2020 2020 2020 2020 2020  + " ".          
+00011350: 2020 2020 2020 2020 2020 2b20 2220 222e            + " ".
+00011360: 6a6f 696e 286c 6173 745f 6e61 6d65 7329  join(last_names)
+00011370: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011380: 2020 2020 202b 2022 2022 0a20 2020 2020       + " ".     
+00011390: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+000113a0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+000113b0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+000113c0: 7574 686f 7273 5f73 7472 696e 6720 3d20  uthors_string = 
+000113d0: 6175 7468 6f72 735f 7374 7269 6e67 202b  authors_string +
+000113e0: 2061 7574 686f 7220 2b20 2220 220a 2020   author + " ".  
+000113f0: 2020 2020 2020 6175 7468 6f72 735f 7374        authors_st
+00011400: 7269 6e67 203d 2072 652e 7375 6228 7222  ring = re.sub(r"
+00011410: 5b5e 412d 5a61 2d7a 302d 392c 205d 2b22  [^A-Za-z0-9, ]+"
+00011420: 2c20 2222 2c20 6175 7468 6f72 735f 7374  , "", authors_st
+00011430: 7269 6e67 2e72 7374 7269 7028 2929 0a20  ring.rstrip()). 
+00011440: 2020 2020 2020 2072 6563 6f72 642e 6461         record.da
+00011450: 7461 5b22 6175 7468 6f72 225d 203d 2061  ta["author"] = a
+00011460: 7574 686f 7273 5f73 7472 696e 670a 0a20  uthors_string.. 
+00011470: 2020 2064 6566 2063 6f6e 7461 696e 6572     def container
+00011480: 5f69 735f 6162 6272 6576 6961 7465 6428  _is_abbreviated(
+00011490: 7365 6c66 2920 2d3e 2062 6f6f 6c3a 0a20  self) -> bool:. 
+000114a0: 2020 2020 2020 2022 2222 4368 6563 6b20         """Check 
+000114b0: 7768 6574 6865 7220 7468 6520 636f 6e74  whether the cont
+000114c0: 6169 6e65 7220 7469 746c 6520 6973 2061  ainer title is a
+000114d0: 6262 7265 7669 6174 6564 2222 220a 2020  bbreviated""".  
+000114e0: 2020 2020 2020 6966 2022 6a6f 7572 6e61        if "journa
+000114f0: 6c22 2069 6e20 7365 6c66 2e64 6174 613a  l" in self.data:
+00011500: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00011510: 7365 6c66 2e64 6174 615b 226a 6f75 726e  self.data["journ
+00011520: 616c 225d 2e63 6f75 6e74 2822 2e22 2920  al"].count(".") 
+00011530: 3e20 323a 0a20 2020 2020 2020 2020 2020  > 2:.           
+00011540: 2020 2020 2072 6574 7572 6e20 5472 7565       return True
+00011550: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00011560: 7365 6c66 2e64 6174 615b 226a 6f75 726e  self.data["journ
+00011570: 616c 225d 2e69 7375 7070 6572 2829 3a0a  al"].isupper():.
+00011580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011590: 7265 7475 726e 2054 7275 650a 2020 2020  return True.    
+000115a0: 2020 2020 6966 2022 626f 6f6b 7469 746c      if "booktitl
+000115b0: 6522 2069 6e20 7365 6c66 2e64 6174 613a  e" in self.data:
+000115c0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000115d0: 7365 6c66 2e64 6174 615b 2262 6f6f 6b74  self.data["bookt
+000115e0: 6974 6c65 225d 2e63 6f75 6e74 2822 2e22  itle"].count("."
+000115f0: 2920 3e20 323a 0a20 2020 2020 2020 2020  ) > 2:.         
+00011600: 2020 2020 2020 2072 6574 7572 6e20 5472         return Tr
+00011610: 7565 0a20 2020 2020 2020 2020 2020 2069  ue.            i
+00011620: 6620 7365 6c66 2e64 6174 615b 2262 6f6f  f self.data["boo
+00011630: 6b74 6974 6c65 225d 2e69 7375 7070 6572  ktitle"].isupper
+00011640: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+00011650: 2020 2020 7265 7475 726e 2054 7275 650a      return True.
+00011660: 2020 2020 2020 2020 2320 6164 6420 6865          # add he
+00011670: 7572 6973 7469 6373 3f20 2865 2e67 2e2c  uristics? (e.g.,
+00011680: 2048 6177 6169 6920 496e 7420 436f 6e66   Hawaii Int Conf
+00011690: 2053 7973 7420 5363 6929 0a20 2020 2020   Syst Sci).     
+000116a0: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
+000116b0: 0a20 2020 2040 636c 6173 736d 6574 686f  .    @classmetho
+000116c0: 640a 2020 2020 6465 6620 5f5f 6162 6272  d.    def __abbr
+000116d0: 6576 6961 7465 5f63 6f6e 7461 696e 6572  eviate_container
+000116e0: 5f74 6974 6c65 7328 0a20 2020 2020 2020  _titles(.       
+000116f0: 2063 6c73 2c0a 2020 2020 2020 2020 2a2c   cls,.        *,
+00011700: 0a20 2020 2020 2020 2072 6563 6f72 643a  .        record:
+00011710: 2063 6f6c 7265 762e 7265 636f 7264 2e50   colrev.record.P
+00011720: 7265 7052 6563 6f72 642c 0a20 2020 2020  repRecord,.     
+00011730: 2020 2072 6574 7269 6576 6564 5f72 6563     retrieved_rec
+00011740: 6f72 643a 2063 6f6c 7265 762e 7265 636f  ord: colrev.reco
+00011750: 7264 2e50 7265 7052 6563 6f72 642c 0a20  rd.PrepRecord,. 
+00011760: 2020 2029 202d 3e20 4e6f 6e65 3a0a 2020     ) -> None:.  
+00011770: 2020 2020 2020 6465 6620 6162 6272 6576        def abbrev
+00011780: 6961 7465 5f63 6f6e 7461 696e 6572 282a  iate_container(*
+00011790: 2c20 7265 636f 7264 3a20 636f 6c72 6576  , record: colrev
+000117a0: 2e72 6563 6f72 642e 5265 636f 7264 2c20  .record.Record, 
+000117b0: 6d69 6e5f 6c65 6e3a 2069 6e74 2920 2d3e  min_len: int) ->
+000117c0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+000117d0: 2020 2069 6620 226a 6f75 726e 616c 2220     if "journal" 
+000117e0: 696e 2072 6563 6f72 642e 6461 7461 3a0a  in record.data:.
 000117f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011800: 206c 656e 2878 2920 666f 7220 7820 696e   len(x) for x in
-00011810: 2072 6563 6f72 642e 6461 7461 5b22 626f   record.data["bo
-00011820: 6f6b 7469 746c 6522 5d2e 7265 706c 6163  oktitle"].replac
-00011830: 6528 222e 222c 2022 2229 2e73 706c 6974  e(".", "").split
-00011840: 2822 2022 290a 2020 2020 2020 2020 2020  (" ").          
-00011850: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00011860: 2020 2020 7265 7475 726e 206d 696e 5f6c      return min_l
-00011870: 656e 0a0a 2020 2020 2020 2020 6966 2072  en..        if r
-00011880: 6563 6f72 642e 636f 6e74 6169 6e65 725f  ecord.container_
-00011890: 6973 5f61 6262 7265 7669 6174 6564 2829  is_abbreviated()
-000118a0: 3a0a 2020 2020 2020 2020 2020 2020 6d69  :.            mi
-000118b0: 6e5f 6c65 6e20 3d20 6765 745f 6162 6272  n_len = get_abbr
-000118c0: 6576 5f63 6f6e 7461 696e 6572 5f6d 696e  ev_container_min
-000118d0: 5f6c 656e 2872 6563 6f72 643d 7265 636f  _len(record=reco
-000118e0: 7264 290a 2020 2020 2020 2020 2020 2020  rd).            
-000118f0: 6162 6272 6576 6961 7465 5f63 6f6e 7461  abbreviate_conta
-00011900: 696e 6572 2872 6563 6f72 643d 7265 7472  iner(record=retr
-00011910: 6965 7665 645f 7265 636f 7264 2c20 6d69  ieved_record, mi
-00011920: 6e5f 6c65 6e3d 6d69 6e5f 6c65 6e29 0a20  n_len=min_len). 
-00011930: 2020 2020 2020 2020 2020 2061 6262 7265             abbre
-00011940: 7669 6174 655f 636f 6e74 6169 6e65 7228  viate_container(
-00011950: 7265 636f 7264 3d72 6563 6f72 642c 206d  record=record, m
-00011960: 696e 5f6c 656e 3d6d 696e 5f6c 656e 290a  in_len=min_len).
-00011970: 2020 2020 2020 2020 6966 2072 6574 7269          if retri
-00011980: 6576 6564 5f72 6563 6f72 642e 636f 6e74  eved_record.cont
-00011990: 6169 6e65 725f 6973 5f61 6262 7265 7669  ainer_is_abbrevi
-000119a0: 6174 6564 2829 3a0a 2020 2020 2020 2020  ated():.        
-000119b0: 2020 2020 6d69 6e5f 6c65 6e20 3d20 6765      min_len = ge
-000119c0: 745f 6162 6272 6576 5f63 6f6e 7461 696e  t_abbrev_contain
-000119d0: 6572 5f6d 696e 5f6c 656e 2872 6563 6f72  er_min_len(recor
-000119e0: 643d 7265 7472 6965 7665 645f 7265 636f  d=retrieved_reco
-000119f0: 7264 290a 2020 2020 2020 2020 2020 2020  rd).            
-00011a00: 6162 6272 6576 6961 7465 5f63 6f6e 7461  abbreviate_conta
-00011a10: 696e 6572 2872 6563 6f72 643d 7265 636f  iner(record=reco
-00011a20: 7264 2c20 6d69 6e5f 6c65 6e3d 6d69 6e5f  rd, min_len=min_
-00011a30: 6c65 6e29 0a20 2020 2020 2020 2020 2020  len).           
-00011a40: 2061 6262 7265 7669 6174 655f 636f 6e74   abbreviate_cont
-00011a50: 6169 6e65 7228 7265 636f 7264 3d72 6574  ainer(record=ret
-00011a60: 7269 6576 6564 5f72 6563 6f72 642c 206d  rieved_record, m
-00011a70: 696e 5f6c 656e 3d6d 696e 5f6c 656e 290a  in_len=min_len).
-00011a80: 0a20 2020 2040 636c 6173 736d 6574 686f  .    @classmetho
-00011a90: 640a 2020 2020 6465 6620 5f5f 7072 6570  d.    def __prep
-00011aa0: 5f72 6563 6f72 6473 5f66 6f72 5f73 696d  _records_for_sim
-00011ab0: 696c 6172 6974 7928 0a20 2020 2020 2020  ilarity(.       
-00011ac0: 2063 6c73 2c0a 2020 2020 2020 2020 2a2c   cls,.        *,
-00011ad0: 0a20 2020 2020 2020 2072 6563 6f72 643a  .        record:
-00011ae0: 2063 6f6c 7265 762e 7265 636f 7264 2e50   colrev.record.P
-00011af0: 7265 7052 6563 6f72 642c 0a20 2020 2020  repRecord,.     
-00011b00: 2020 2072 6574 7269 6576 6564 5f72 6563     retrieved_rec
-00011b10: 6f72 643a 2063 6f6c 7265 762e 7265 636f  ord: colrev.reco
-00011b20: 7264 2e50 7265 7052 6563 6f72 642c 0a20  rd.PrepRecord,. 
-00011b30: 2020 2029 202d 3e20 4e6f 6e65 3a0a 2020     ) -> None:.  
-00011b40: 2020 2020 2020 636c 732e 5f5f 6162 6272        cls.__abbr
-00011b50: 6576 6961 7465 5f63 6f6e 7461 696e 6572  eviate_container
-00011b60: 5f74 6974 6c65 7328 0a20 2020 2020 2020  _titles(.       
-00011b70: 2020 2020 2072 6563 6f72 643d 7265 636f       record=reco
-00011b80: 7264 2c20 7265 7472 6965 7665 645f 7265  rd, retrieved_re
-00011b90: 636f 7264 3d72 6574 7269 6576 6564 5f72  cord=retrieved_r
-00011ba0: 6563 6f72 640a 2020 2020 2020 2020 290a  ecord.        ).
-00011bb0: 0a20 2020 2020 2020 2069 6620 2274 6974  .        if "tit
-00011bc0: 6c65 2220 696e 2072 6563 6f72 642e 6461  le" in record.da
-00011bd0: 7461 3a0a 2020 2020 2020 2020 2020 2020  ta:.            
-00011be0: 7265 636f 7264 2e64 6174 615b 2274 6974  record.data["tit
-00011bf0: 6c65 225d 203d 2072 6563 6f72 642e 6461  le"] = record.da
-00011c00: 7461 5b22 7469 746c 6522 5d5b 3a39 305d  ta["title"][:90]
-00011c10: 0a20 2020 2020 2020 2069 6620 2274 6974  .        if "tit
-00011c20: 6c65 2220 696e 2072 6574 7269 6576 6564  le" in retrieved
-00011c30: 5f72 6563 6f72 642e 6461 7461 3a0a 2020  _record.data:.  
-00011c40: 2020 2020 2020 2020 2020 7265 7472 6965            retrie
-00011c50: 7665 645f 7265 636f 7264 2e64 6174 615b  ved_record.data[
-00011c60: 2274 6974 6c65 225d 203d 2072 6574 7269  "title"] = retri
-00011c70: 6576 6564 5f72 6563 6f72 642e 6461 7461  eved_record.data
-00011c80: 5b22 7469 746c 6522 5d5b 3a39 305d 0a0a  ["title"][:90]..
-00011c90: 2020 2020 2020 2020 6966 2022 6175 7468          if "auth
-00011ca0: 6f72 2220 696e 2072 6563 6f72 642e 6461  or" in record.da
-00011cb0: 7461 3a0a 2020 2020 2020 2020 2020 2020  ta:.            
-00011cc0: 636c 732e 5f5f 666f 726d 6174 5f61 7574  cls.__format_aut
-00011cd0: 686f 7273 5f73 7472 696e 675f 666f 725f  hors_string_for_
-00011ce0: 636f 6d70 6172 6973 6f6e 2872 6563 6f72  comparison(recor
-00011cf0: 643d 7265 636f 7264 290a 2020 2020 2020  d=record).      
-00011d00: 2020 2020 2020 7265 636f 7264 2e64 6174        record.dat
-00011d10: 615b 2261 7574 686f 7222 5d20 3d20 7265  a["author"] = re
-00011d20: 636f 7264 2e64 6174 615b 2261 7574 686f  cord.data["autho
-00011d30: 7222 5d5b 3a34 355d 0a20 2020 2020 2020  r"][:45].       
-00011d40: 2069 6620 2261 7574 686f 7222 2069 6e20   if "author" in 
-00011d50: 7265 7472 6965 7665 645f 7265 636f 7264  retrieved_record
-00011d60: 2e64 6174 613a 0a20 2020 2020 2020 2020  .data:.         
-00011d70: 2020 2063 6c73 2e5f 5f66 6f72 6d61 745f     cls.__format_
-00011d80: 6175 7468 6f72 735f 7374 7269 6e67 5f66  authors_string_f
-00011d90: 6f72 5f63 6f6d 7061 7269 736f 6e28 7265  or_comparison(re
-00011da0: 636f 7264 3d72 6574 7269 6576 6564 5f72  cord=retrieved_r
-00011db0: 6563 6f72 6429 0a20 2020 2020 2020 2020  ecord).         
-00011dc0: 2020 2072 6574 7269 6576 6564 5f72 6563     retrieved_rec
-00011dd0: 6f72 642e 6461 7461 5b22 6175 7468 6f72  ord.data["author
-00011de0: 225d 203d 2072 6574 7269 6576 6564 5f72  "] = retrieved_r
-00011df0: 6563 6f72 642e 6461 7461 5b22 6175 7468  ecord.data["auth
-00011e00: 6f72 225d 5b3a 3435 5d0a 2020 2020 2020  or"][:45].      
-00011e10: 2020 6966 206e 6f74 2028 2276 6f6c 756d    if not ("volum
-00011e20: 6522 2069 6e20 7265 636f 7264 2e64 6174  e" in record.dat
-00011e30: 6120 616e 6420 2276 6f6c 756d 6522 2069  a and "volume" i
-00011e40: 6e20 7265 7472 6965 7665 645f 7265 636f  n retrieved_reco
-00011e50: 7264 2e64 6174 6129 3a0a 2020 2020 2020  rd.data):.      
-00011e60: 2020 2020 2020 7265 636f 7264 2e64 6174        record.dat
-00011e70: 615b 2276 6f6c 756d 6522 5d20 3d20 226e  a["volume"] = "n
-00011e80: 616e 220a 2020 2020 2020 2020 2020 2020  an".            
-00011e90: 7265 7472 6965 7665 645f 7265 636f 7264  retrieved_record
-00011ea0: 2e64 6174 615b 2276 6f6c 756d 6522 5d20  .data["volume"] 
-00011eb0: 3d20 226e 616e 220a 2020 2020 2020 2020  = "nan".        
-00011ec0: 6966 206e 6f74 2028 226e 756d 6265 7222  if not ("number"
-00011ed0: 2069 6e20 7265 636f 7264 2e64 6174 6120   in record.data 
-00011ee0: 616e 6420 226e 756d 6265 7222 2069 6e20  and "number" in 
-00011ef0: 7265 7472 6965 7665 645f 7265 636f 7264  retrieved_record
-00011f00: 2e64 6174 6129 3a0a 2020 2020 2020 2020  .data):.        
-00011f10: 2020 2020 7265 636f 7264 2e64 6174 615b      record.data[
-00011f20: 226e 756d 6265 7222 5d20 3d20 226e 616e  "number"] = "nan
-00011f30: 220a 2020 2020 2020 2020 2020 2020 7265  ".            re
-00011f40: 7472 6965 7665 645f 7265 636f 7264 2e64  trieved_record.d
-00011f50: 6174 615b 226e 756d 6265 7222 5d20 3d20  ata["number"] = 
-00011f60: 226e 616e 220a 2020 2020 2020 2020 6966  "nan".        if
-00011f70: 206e 6f74 2028 2270 6167 6573 2220 696e   not ("pages" in
-00011f80: 2072 6563 6f72 642e 6461 7461 2061 6e64   record.data and
-00011f90: 2022 7061 6765 7322 2069 6e20 7265 7472   "pages" in retr
-00011fa0: 6965 7665 645f 7265 636f 7264 2e64 6174  ieved_record.dat
-00011fb0: 6129 3a0a 2020 2020 2020 2020 2020 2020  a):.            
-00011fc0: 7265 636f 7264 2e64 6174 615b 2270 6167  record.data["pag
-00011fd0: 6573 225d 203d 2022 6e61 6e22 0a20 2020  es"] = "nan".   
-00011fe0: 2020 2020 2020 2020 2072 6574 7269 6576           retriev
-00011ff0: 6564 5f72 6563 6f72 642e 6461 7461 5b22  ed_record.data["
-00012000: 7061 6765 7322 5d20 3d20 226e 616e 220a  pages"] = "nan".
-00012010: 2020 2020 2020 2020 2320 536f 6d65 7469          # Someti
-00012020: 6d65 732c 2074 6865 206e 756d 6265 7220  mes, the number 
-00012030: 6f66 2070 6167 6573 2069 7320 7072 6f76  of pages is prov
-00012040: 6964 6564 2028 6e6f 7420 7468 6520 7261  ided (not the ra
-00012050: 6e67 6529 0a20 2020 2020 2020 2065 6c69  nge).        eli
-00012060: 6620 6e6f 7420 280a 2020 2020 2020 2020  f not (.        
-00012070: 2020 2020 222d 2d22 2069 6e20 7265 636f      "--" in reco
-00012080: 7264 2e64 6174 615b 2270 6167 6573 225d  rd.data["pages"]
-00012090: 2061 6e64 2022 2d2d 2220 696e 2072 6574   and "--" in ret
-000120a0: 7269 6576 6564 5f72 6563 6f72 642e 6461  rieved_record.da
-000120b0: 7461 5b22 7061 6765 7322 5d0a 2020 2020  ta["pages"].    
-000120c0: 2020 2020 293a 0a20 2020 2020 2020 2020      ):.         
-000120d0: 2020 2072 6563 6f72 642e 6461 7461 5b22     record.data["
-000120e0: 7061 6765 7322 5d20 3d20 226e 616e 220a  pages"] = "nan".
-000120f0: 2020 2020 2020 2020 2020 2020 7265 7472              retr
-00012100: 6965 7665 645f 7265 636f 7264 2e64 6174  ieved_record.dat
-00012110: 615b 2270 6167 6573 225d 203d 2022 6e61  a["pages"] = "na
-00012120: 6e22 0a0a 2020 2020 2020 2020 6966 2022  n"..        if "
-00012130: 7965 6172 2220 696e 2072 6563 6f72 642e  year" in record.
-00012140: 6461 7461 2061 6e64 2022 7965 6172 2220  data and "year" 
-00012150: 696e 2072 6574 7269 6576 6564 5f72 6563  in retrieved_rec
-00012160: 6f72 642e 6461 7461 3a0a 2020 2020 2020  ord.data:.      
-00012170: 2020 2020 2020 6966 2072 6563 6f72 642e        if record.
-00012180: 6461 7461 5b22 7965 6172 225d 203d 3d20  data["year"] == 
-00012190: 2266 6f72 7468 636f 6d69 6e67 223a 0a20  "forthcoming":. 
-000121a0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-000121b0: 6563 6f72 642e 6461 7461 5b22 7965 6172  ecord.data["year
-000121c0: 225d 203d 2072 6574 7269 6576 6564 5f72  "] = retrieved_r
-000121d0: 6563 6f72 642e 6461 7461 5b22 7965 6172  ecord.data["year
-000121e0: 225d 0a20 2020 2020 2020 2020 2020 2069  "].            i
-000121f0: 6620 7265 7472 6965 7665 645f 7265 636f  f retrieved_reco
-00012200: 7264 2e64 6174 615b 2279 6561 7222 5d20  rd.data["year"] 
-00012210: 3d3d 2022 666f 7274 6863 6f6d 696e 6722  == "forthcoming"
-00012220: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00012230: 2020 7265 7472 6965 7665 645f 7265 636f    retrieved_reco
-00012240: 7264 2e64 6174 615b 2279 6561 7222 5d20  rd.data["year"] 
-00012250: 3d20 7265 636f 7264 2e64 6174 615b 2279  = record.data["y
-00012260: 6561 7222 5d0a 0a20 2020 2040 636c 6173  ear"]..    @clas
-00012270: 736d 6574 686f 640a 2020 2020 6465 6620  smethod.    def 
-00012280: 6765 745f 7265 7472 6965 7661 6c5f 7369  get_retrieval_si
-00012290: 6d69 6c61 7269 7479 280a 2020 2020 2020  milarity(.      
-000122a0: 2020 636c 732c 0a20 2020 2020 2020 202a    cls,.        *
-000122b0: 2c0a 2020 2020 2020 2020 7265 636f 7264  ,.        record
-000122c0: 5f6f 7269 6769 6e61 6c3a 2052 6563 6f72  _original: Recor
-000122d0: 642c 0a20 2020 2020 2020 2072 6574 7269  d,.        retri
-000122e0: 6576 6564 5f72 6563 6f72 645f 6f72 6967  eved_record_orig
-000122f0: 696e 616c 3a20 5265 636f 7264 2c0a 2020  inal: Record,.  
-00012300: 2020 2020 2020 7361 6d65 5f72 6563 6f72        same_recor
-00012310: 645f 7479 7065 5f72 6571 7569 7265 643a  d_type_required:
-00012320: 2062 6f6f 6c20 3d20 5472 7565 2c0a 2020   bool = True,.  
-00012330: 2020 2920 2d3e 2066 6c6f 6174 3a0a 2020    ) -> float:.  
-00012340: 2020 2020 2020 2222 2247 6574 2074 6865        """Get the
-00012350: 2072 6574 7269 6576 616c 2073 696d 696c   retrieval simil
-00012360: 6172 6974 7920 6265 7477 6565 6e20 7468  arity between th
-00012370: 6520 7265 636f 7264 2061 6e64 2061 2072  e record and a r
-00012380: 6574 7269 6576 6564 2072 6563 6f72 6422  etrieved record"
-00012390: 2222 0a0a 2020 2020 2020 2020 6966 2073  ""..        if s
-000123a0: 616d 655f 7265 636f 7264 5f74 7970 655f  ame_record_type_
-000123b0: 7265 7175 6972 6564 3a0a 2020 2020 2020  required:.      
-000123c0: 2020 2020 2020 6966 2072 6563 6f72 645f        if record_
-000123d0: 6f72 6967 696e 616c 2e64 6174 612e 6765  original.data.ge
-000123e0: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
-000123f0: 2020 2022 454e 5452 5954 5950 4522 2c20     "ENTRYTYPE", 
-00012400: 2261 220a 2020 2020 2020 2020 2020 2020  "a".            
-00012410: 2920 213d 2072 6574 7269 6576 6564 5f72  ) != retrieved_r
-00012420: 6563 6f72 645f 6f72 6967 696e 616c 2e64  ecord_original.d
-00012430: 6174 612e 6765 7428 2245 4e54 5259 5459  ata.get("ENTRYTY
-00012440: 5045 222c 2022 6222 293a 0a20 2020 2020  PE", "b"):.     
-00012450: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00012460: 6e20 302e 300a 0a20 2020 2020 2020 2072  n 0.0..        r
-00012470: 6563 6f72 6420 3d20 7265 636f 7264 5f6f  ecord = record_o
-00012480: 7269 6769 6e61 6c2e 636f 7079 5f70 7265  riginal.copy_pre
-00012490: 705f 7265 6328 290a 2020 2020 2020 2020  p_rec().        
-000124a0: 7265 7472 6965 7665 645f 7265 636f 7264  retrieved_record
-000124b0: 203d 2072 6574 7269 6576 6564 5f72 6563   = retrieved_rec
-000124c0: 6f72 645f 6f72 6967 696e 616c 2e63 6f70  ord_original.cop
-000124d0: 795f 7072 6570 5f72 6563 2829 0a0a 2020  y_prep_rec()..  
-000124e0: 2020 2020 2020 636c 732e 5f5f 7072 6570        cls.__prep
-000124f0: 5f72 6563 6f72 6473 5f66 6f72 5f73 696d  _records_for_sim
-00012500: 696c 6172 6974 7928 0a20 2020 2020 2020  ilarity(.       
-00012510: 2020 2020 2072 6563 6f72 643d 7265 636f       record=reco
-00012520: 7264 2c20 7265 7472 6965 7665 645f 7265  rd, retrieved_re
-00012530: 636f 7264 3d72 6574 7269 6576 6564 5f72  cord=retrieved_r
-00012540: 6563 6f72 640a 2020 2020 2020 2020 290a  ecord.        ).
-00012550: 0a20 2020 2020 2020 2069 6620 2265 6469  .        if "edi
-00012560: 746f 7269 616c 2220 696e 2072 6563 6f72  torial" in recor
-00012570: 642e 6461 7461 2e67 6574 2822 7469 746c  d.data.get("titl
-00012580: 6522 2c20 224e 4122 292e 6c6f 7765 7228  e", "NA").lower(
-00012590: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
-000125a0: 6620 6e6f 7420 616c 6c28 7820 696e 2072  f not all(x in r
-000125b0: 6563 6f72 642e 6461 7461 2066 6f72 2078  ecord.data for x
-000125c0: 2069 6e20 5b22 766f 6c75 6d65 222c 2022   in ["volume", "
-000125d0: 6e75 6d62 6572 225d 293a 0a20 2020 2020  number"]):.     
-000125e0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-000125f0: 6e20 302e 300a 0a20 2020 2020 2020 2073  n 0.0..        s
-00012600: 696d 696c 6172 6974 7920 3d20 5265 636f  imilarity = Reco
-00012610: 7264 2e67 6574 5f72 6563 6f72 645f 7369  rd.get_record_si
-00012620: 6d69 6c61 7269 7479 280a 2020 2020 2020  milarity(.      
-00012630: 2020 2020 2020 7265 636f 7264 5f61 3d72        record_a=r
-00012640: 6563 6f72 642c 2072 6563 6f72 645f 623d  ecord, record_b=
-00012650: 7265 7472 6965 7665 645f 7265 636f 7264  retrieved_record
-00012660: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
-00012670: 2020 2072 6574 7572 6e20 7369 6d69 6c61     return simila
-00012680: 7269 7479 0a0a 2020 2020 6465 6620 666f  rity..    def fo
-00012690: 726d 6174 5f69 665f 6d6f 7374 6c79 5f75  rmat_if_mostly_u
-000126a0: 7070 6572 2873 656c 662c 202a 2c20 6b65  pper(self, *, ke
-000126b0: 793a 2073 7472 2c20 6361 7365 3a20 7374  y: str, case: st
-000126c0: 7220 3d20 2273 656e 7465 6e63 6522 2920  r = "sentence") 
-000126d0: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
-000126e0: 2022 2222 466f 726d 6174 2074 6865 2066   """Format the f
-000126f0: 6965 6c64 2069 6620 6974 2069 7320 6d6f  ield if it is mo
-00012700: 7374 6c79 2069 6e20 7570 7065 7220 6361  stly in upper ca
-00012710: 7365 2222 220a 0a20 2020 2020 2020 2069  se"""..        i
-00012720: 6620 6b65 7920 6e6f 7420 696e 2073 656c  f key not in sel
-00012730: 662e 6461 7461 206f 7220 7365 6c66 2e64  f.data or self.d
-00012740: 6174 615b 6b65 795d 203d 3d20 2255 4e4b  ata[key] == "UNK
-00012750: 4e4f 574e 223a 0a20 2020 2020 2020 2020  NOWN":.         
-00012760: 2020 2072 6574 7572 6e0a 0a20 2020 2020     return..     
-00012770: 2020 2069 6620 636f 6c72 6576 2e65 6e76     if colrev.env
-00012780: 2e75 7469 6c73 2e70 6572 6365 6e74 5f75  .utils.percent_u
-00012790: 7070 6572 5f63 6861 7273 2873 656c 662e  pper_chars(self.
-000127a0: 6461 7461 5b6b 6579 5d29 203c 2030 2e36  data[key]) < 0.6
-000127b0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-000127c0: 7475 726e 0a0a 2020 2020 2020 2020 2320  turn..        # 
-000127d0: 4e6f 7465 3a20 7468 6520 7472 7565 6361  Note: the trueca
-000127e0: 7365 2070 6163 6b61 6765 2069 7320 6e6f  se package is no
-000127f0: 7420 7665 7279 2072 656c 6961 626c 6520  t very reliable 
-00012800: 2879 6574 290a 0a20 2020 2020 2020 2073  (yet)..        s
-00012810: 656c 662e 6461 7461 5b6b 6579 5d20 3d20  elf.data[key] = 
-00012820: 7365 6c66 2e64 6174 615b 6b65 795d 2e72  self.data[key].r
-00012830: 6570 6c61 6365 2822 5c6e 222c 2022 2022  eplace("\n", " "
-00012840: 290a 0a20 2020 2020 2020 2069 6620 6361  )..        if ca
-00012850: 7365 203d 3d20 2273 656e 7465 6e63 6522  se == "sentence"
-00012860: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-00012870: 6c66 2e64 6174 615b 6b65 795d 203d 2073  lf.data[key] = s
-00012880: 656c 662e 6461 7461 5b6b 6579 5d2e 6361  elf.data[key].ca
-00012890: 7069 7461 6c69 7a65 2829 0a20 2020 2020  pitalize().     
-000128a0: 2020 2065 6c69 6620 6361 7365 203d 3d20     elif case == 
-000128b0: 2274 6974 6c65 223a 0a20 2020 2020 2020  "title":.       
-000128c0: 2020 2020 2073 656c 662e 6461 7461 5b6b       self.data[k
-000128d0: 6579 5d20 3d20 7365 6c66 2e64 6174 615b  ey] = self.data[
-000128e0: 6b65 795d 2e74 6974 6c65 2829 0a20 2020  key].title().   
-000128f0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00012900: 2020 2020 2020 2072 6169 7365 2063 6f6c         raise col
-00012910: 7265 765f 6578 6365 7074 696f 6e73 2e50  rev_exceptions.P
-00012920: 6172 616d 6574 6572 4572 726f 7228 0a20  arameterError(. 
-00012930: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00012940: 6172 616d 6574 6572 3d22 6361 7365 222c  arameter="case",
-00012950: 2076 616c 7565 3d63 6173 652c 206f 7074   value=case, opt
-00012960: 696f 6e73 3d5b 2273 656e 7465 6e63 6522  ions=["sentence"
-00012970: 2c20 2274 6974 6c65 225d 0a20 2020 2020  , "title"].     
-00012980: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-00012990: 2020 7365 6c66 2e64 6174 615b 6b65 795d    self.data[key]
-000129a0: 203d 2070 7265 705f 7574 696c 732e 6361   = prep_utils.ca
-000129b0: 7069 7461 6c69 7a65 5f65 6e74 6974 6965  pitalize_entitie
-000129c0: 7328 7365 6c66 2e64 6174 615b 6b65 795d  s(self.data[key]
-000129d0: 290a 0a20 2020 2020 2020 2069 6620 6b65  )..        if ke
-000129e0: 7920 696e 2073 656c 662e 6461 7461 2e67  y in self.data.g
-000129f0: 6574 2822 636f 6c72 6576 5f6d 6173 7465  et("colrev_maste
-00012a00: 7264 6174 615f 7072 6f76 656e 616e 6365  rdata_provenance
-00012a10: 222c 207b 7d29 3a0a 2020 2020 2020 2020  ", {}):.        
-00012a20: 2020 2020 6e6f 7465 203d 2073 656c 662e      note = self.
-00012a30: 6461 7461 5b22 636f 6c72 6576 5f6d 6173  data["colrev_mas
-00012a40: 7465 7264 6174 615f 7072 6f76 656e 616e  terdata_provenan
-00012a50: 6365 225d 5b6b 6579 5d5b 226e 6f74 6522  ce"][key]["note"
-00012a60: 5d0a 2020 2020 2020 2020 2020 2020 6966  ].            if
-00012a70: 2022 7175 616c 6974 795f 6465 6665 6374   "quality_defect
-00012a80: 2220 696e 206e 6f74 653a 0a20 2020 2020  " in note:.     
-00012a90: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00012aa0: 6461 7461 5b22 636f 6c72 6576 5f6d 6173  data["colrev_mas
-00012ab0: 7465 7264 6174 615f 7072 6f76 656e 616e  terdata_provenan
-00012ac0: 6365 225d 5b6b 6579 5d5b 226e 6f74 6522  ce"][key]["note"
-00012ad0: 5d20 3d20 6e6f 7465 2e72 6570 6c61 6365  ] = note.replace
-00012ae0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00012af0: 2020 2020 2020 2271 7561 6c69 7479 5f64        "quality_d
-00012b00: 6566 6563 7422 2c20 2222 0a20 2020 2020  efect", "".     
-00012b10: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
-00012b20: 2020 6465 6620 7265 6e61 6d65 5f66 6965    def rename_fie
-00012b30: 6c64 735f 6261 7365 645f 6f6e 5f6d 6170  lds_based_on_map
-00012b40: 7069 6e67 2873 656c 662c 202a 2c20 6d61  ping(self, *, ma
-00012b50: 7070 696e 673a 2064 6963 7429 202d 3e20  pping: dict) -> 
-00012b60: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
-00012b70: 2243 6f6e 7665 6e69 656e 6365 2066 756e  "Convenience fun
-00012b80: 6374 696f 6e20 666f 7220 7468 6520 7072  ction for the pr
-00012b90: 6570 2073 6372 6970 7473 2028 746f 2072  ep scripts (to r
-00012ba0: 656e 616d 6520 6669 656c 6473 2922 2222  ename fields)"""
-00012bb0: 0a0a 2020 2020 2020 2020 6d61 7070 696e  ..        mappin
-00012bc0: 6720 3d20 7b6b 2e6c 6f77 6572 2829 3a20  g = {k.lower(): 
-00012bd0: 762e 6c6f 7765 7228 2920 666f 7220 6b2c  v.lower() for k,
-00012be0: 2076 2069 6e20 6d61 7070 696e 672e 6974   v in mapping.it
-00012bf0: 656d 7328 297d 0a20 2020 2020 2020 2070  ems()}.        p
-00012c00: 7269 6f72 5f6b 6579 7320 3d20 6c69 7374  rior_keys = list
-00012c10: 2873 656c 662e 6461 7461 2e6b 6579 7328  (self.data.keys(
-00012c20: 2929 0a20 2020 2020 2020 2023 204e 6f74  )).        # Not
-00012c30: 6520 3a20 7761 726e 696e 673a 2064 6f20  e : warning: do 
-00012c40: 6e6f 7420 6372 6561 7465 2061 206e 6577  not create a new
-00012c50: 2064 6963 742e 0a20 2020 2020 2020 2066   dict..        f
-00012c60: 6f72 206b 6579 2069 6e20 7072 696f 725f  or key in prior_
-00012c70: 6b65 7973 3a0a 2020 2020 2020 2020 2020  keys:.          
-00012c80: 2020 6966 206b 6579 2e6c 6f77 6572 2829    if key.lower()
-00012c90: 2069 6e20 6d61 7070 696e 673a 0a20 2020   in mapping:.   
-00012ca0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00012cb0: 662e 7265 6e61 6d65 5f66 6965 6c64 286b  f.rename_field(k
-00012cc0: 6579 3d6b 6579 2c20 6e65 775f 6b65 793d  ey=key, new_key=
-00012cd0: 6d61 7070 696e 675b 6b65 792e 6c6f 7765  mapping[key.lowe
-00012ce0: 7228 295d 290a 0a20 2020 2064 6566 2075  r()])..    def u
-00012cf0: 6e69 6679 5f70 6167 6573 5f66 6965 6c64  nify_pages_field
-00012d00: 2873 656c 6629 202d 3e20 4e6f 6e65 3a0a  (self) -> None:.
-00012d10: 2020 2020 2020 2020 2222 2255 6e69 6679          """Unify
-00012d20: 2074 6865 2066 6f72 6d61 7420 6f66 2074   the format of t
-00012d30: 6865 2070 6167 6520 6669 656c 6422 2222  he page field"""
-00012d40: 0a20 2020 2020 2020 2069 6620 2270 6167  .        if "pag
-00012d50: 6573 2220 6e6f 7420 696e 2073 656c 662e  es" not in self.
-00012d60: 6461 7461 3a0a 2020 2020 2020 2020 2020  data:.          
-00012d70: 2020 7265 7475 726e 0a20 2020 2020 2020    return.       
-00012d80: 2069 6620 6e6f 7420 6973 696e 7374 616e   if not isinstan
-00012d90: 6365 2873 656c 662e 6461 7461 5b22 7061  ce(self.data["pa
-00012da0: 6765 7322 5d2c 2073 7472 293a 0a20 2020  ges"], str):.   
-00012db0: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
-00012dc0: 2020 2020 2020 2020 6966 2031 203d 3d20          if 1 == 
-00012dd0: 7365 6c66 2e64 6174 615b 2270 6167 6573  self.data["pages
-00012de0: 225d 2e63 6f75 6e74 2822 2d22 293a 0a20  "].count("-"):. 
-00012df0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00012e00: 6461 7461 5b22 7061 6765 7322 5d20 3d20  data["pages"] = 
-00012e10: 7365 6c66 2e64 6174 615b 2270 6167 6573  self.data["pages
-00012e20: 225d 2e72 6570 6c61 6365 2822 2d22 2c20  "].replace("-", 
-00012e30: 222d 2d22 290a 2020 2020 2020 2020 7365  "--").        se
-00012e40: 6c66 2e64 6174 615b 2270 6167 6573 225d  lf.data["pages"]
-00012e50: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
-00012e60: 2073 656c 662e 6461 7461 5b22 7061 6765   self.data["page
-00012e70: 7322 5d0a 2020 2020 2020 2020 2020 2020  s"].            
-00012e80: 2e72 6570 6c61 6365 2822 e280 9322 2c20  .replace("...", 
-00012e90: 222d 2d22 290a 2020 2020 2020 2020 2020  "--").          
-00012ea0: 2020 2e72 6570 6c61 6365 2822 2d2d 2d2d    .replace("----
-00012eb0: 222c 2022 2d2d 2229 0a20 2020 2020 2020  ", "--").       
-00012ec0: 2020 2020 202e 7265 706c 6163 6528 2220       .replace(" 
-00012ed0: 2d2d 2022 2c20 222d 2d22 290a 2020 2020  -- ", "--").    
-00012ee0: 2020 2020 2020 2020 2e72 7374 7269 7028          .rstrip(
-00012ef0: 222e 2229 0a20 2020 2020 2020 2029 0a20  ".").        ). 
-00012f00: 2020 2020 2020 2069 6620 7265 2e6d 6174         if re.mat
-00012f10: 6368 2872 225e 5c64 2b5c 2d5c 2d5c 642b  ch(r"^\d+\-\-\d+
-00012f20: 2422 2c20 7365 6c66 2e64 6174 615b 2270  $", self.data["p
-00012f30: 6167 6573 225d 293a 0a20 2020 2020 2020  ages"]):.       
-00012f40: 2020 2020 2066 726f 6d5f 7061 6765 2c20       from_page, 
-00012f50: 746f 5f70 6167 6520 3d20 7265 2e66 696e  to_page = re.fin
-00012f60: 6461 6c6c 2872 2228 5c64 2b29 222c 2073  dall(r"(\d+)", s
-00012f70: 656c 662e 6461 7461 5b22 7061 6765 7322  elf.data["pages"
-00012f80: 5d29 0a20 2020 2020 2020 2020 2020 2069  ]).            i
-00012f90: 6620 696e 7428 6672 6f6d 5f70 6167 6529  f int(from_page)
-00012fa0: 203e 2069 6e74 2874 6f5f 7061 6765 2920   > int(to_page) 
-00012fb0: 616e 6420 6c65 6e28 6672 6f6d 5f70 6167  and len(from_pag
-00012fc0: 6529 203e 206c 656e 2874 6f5f 7061 6765  e) > len(to_page
-00012fd0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00012fe0: 2020 2073 656c 662e 6461 7461 5b0a 2020     self.data[.  
-00012ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013000: 2020 2270 6167 6573 220a 2020 2020 2020    "pages".      
-00013010: 2020 2020 2020 2020 2020 5d20 3d20 6622            ] = f"
-00013020: 7b66 726f 6d5f 7061 6765 7d2d 2d7b 6672  {from_page}--{fr
-00013030: 6f6d 5f70 6167 655b 3a2d 6c65 6e28 746f  om_page[:-len(to
-00013040: 5f70 6167 6529 5d7d 7b74 6f5f 7061 6765  _page)]}{to_page
-00013050: 7d22 0a0a 2020 2020 6465 6620 7072 6570  }"..    def prep
-00013060: 6172 6174 696f 6e5f 7361 7665 5f63 6f6e  aration_save_con
-00013070: 6469 7469 6f6e 2873 656c 6629 202d 3e20  dition(self) -> 
-00013080: 626f 6f6c 3a0a 2020 2020 2020 2020 2222  bool:.        ""
-00013090: 2243 6865 636b 2077 6865 7468 6572 2074  "Check whether t
-000130a0: 6865 2073 6176 6520 636f 6e64 6974 696f  he save conditio
-000130b0: 6e20 666f 7220 7468 6520 7072 6570 206f  n for the prep o
-000130c0: 7065 7261 7469 6f6e 2069 7320 6769 7665  peration is give
-000130d0: 6e22 2222 0a0a 2020 2020 2020 2020 6966  n"""..        if
-000130e0: 2073 656c 662e 6461 7461 2e67 6574 2822   self.data.get("
-000130f0: 636f 6c72 6576 5f73 7461 7475 7322 2c20  colrev_status", 
-00013100: 224e 4122 2920 696e 205b 0a20 2020 2020  "NA") in [.     
-00013110: 2020 2020 2020 2052 6563 6f72 6453 7461         RecordSta
-00013120: 7465 2e72 6576 5f70 7265 7363 7265 656e  te.rev_prescreen
-00013130: 5f65 7863 6c75 6465 642c 0a20 2020 2020  _excluded,.     
-00013140: 2020 2020 2020 2052 6563 6f72 6453 7461         RecordSta
-00013150: 7465 2e6d 645f 7072 6570 6172 6564 2c0a  te.md_prepared,.
-00013160: 2020 2020 2020 2020 5d3a 0a20 2020 2020          ]:.     
-00013170: 2020 2020 2020 2072 6574 7572 6e20 5472         return Tr
-00013180: 7565 0a0a 2020 2020 2020 2020 6966 2061  ue..        if a
-00013190: 6e79 280a 2020 2020 2020 2020 2020 2020  ny(.            
-000131a0: 2264 6973 6167 7265 656d 656e 7420 7769  "disagreement wi
-000131b0: 7468 2022 2069 6e20 785b 226e 6f74 6522  th " in x["note"
-000131c0: 5d0a 2020 2020 2020 2020 2020 2020 666f  ].            fo
-000131d0: 7220 7820 696e 2073 656c 662e 6461 7461  r x in self.data
-000131e0: 2e67 6574 2822 636f 6c72 6576 5f6d 6173  .get("colrev_mas
-000131f0: 7465 7264 6174 615f 7072 6f76 656e 616e  terdata_provenan
-00013200: 6365 222c 207b 7d29 2e76 616c 7565 7328  ce", {}).values(
-00013210: 290a 2020 2020 2020 2020 2920 6f72 2061  ).        ) or a
-00013220: 6e79 280a 2020 2020 2020 2020 2020 2020  ny(.            
-00013230: 2272 6563 6f72 645f 6e6f 745f 696e 5f74  "record_not_in_t
-00013240: 6f63 2220 696e 2078 5b22 6e6f 7465 225d  oc" in x["note"]
-00013250: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-00013260: 2078 2069 6e20 7365 6c66 2e64 6174 612e   x in self.data.
-00013270: 6765 7428 2263 6f6c 7265 765f 6d61 7374  get("colrev_mast
-00013280: 6572 6461 7461 5f70 726f 7665 6e61 6e63  erdata_provenanc
-00013290: 6522 2c20 7b7d 292e 7661 6c75 6573 2829  e", {}).values()
-000132a0: 0a20 2020 2020 2020 2029 3a0a 2020 2020  .        ):.    
-000132b0: 2020 2020 2020 2020 7265 7475 726e 2054          return T
-000132c0: 7275 650a 0a20 2020 2020 2020 2072 6574  rue..        ret
-000132d0: 7572 6e20 4661 6c73 650a 0a20 2020 2064  urn False..    d
-000132e0: 6566 2070 7265 7061 7261 7469 6f6e 5f62  ef preparation_b
-000132f0: 7265 616b 5f63 6f6e 6469 7469 6f6e 2873  reak_condition(s
-00013300: 656c 6629 202d 3e20 626f 6f6c 3a0a 2020  elf) -> bool:.  
-00013310: 2020 2020 2020 2222 2243 6865 636b 2077        """Check w
-00013320: 6865 7468 6572 2074 6865 2062 7265 616b  hether the break
-00013330: 2063 6f6e 6469 7469 6f6e 2066 6f72 2074   condition for t
-00013340: 6865 2070 7265 7020 6f70 6572 6174 696f  he prep operatio
-00013350: 6e20 6973 2067 6976 656e 2222 220a 2020  n is given""".  
-00013360: 2020 2020 2020 6966 2061 6e79 280a 2020        if any(.  
-00013370: 2020 2020 2020 2020 2020 2264 6973 6167            "disag
-00013380: 7265 656d 656e 7420 7769 7468 2022 2069  reement with " i
-00013390: 6e20 785b 226e 6f74 6522 5d0a 2020 2020  n x["note"].    
-000133a0: 2020 2020 2020 2020 666f 7220 7820 696e          for x in
-000133b0: 2073 656c 662e 6461 7461 2e67 6574 2822   self.data.get("
-000133c0: 636f 6c72 6576 5f6d 6173 7465 7264 6174  colrev_masterdat
-000133d0: 615f 7072 6f76 656e 616e 6365 222c 207b  a_provenance", {
-000133e0: 7d29 2e76 616c 7565 7328 290a 2020 2020  }).values().    
-000133f0: 2020 2020 2920 6f72 2061 6e79 280a 2020      ) or any(.  
-00013400: 2020 2020 2020 2020 2020 2272 6563 6f72            "recor
-00013410: 645f 6e6f 745f 696e 5f74 6f63 2220 696e  d_not_in_toc" in
-00013420: 2078 5b22 6e6f 7465 225d 0a20 2020 2020   x["note"].     
-00013430: 2020 2020 2020 2066 6f72 2078 2069 6e20         for x in 
-00013440: 7365 6c66 2e64 6174 612e 6765 7428 2263  self.data.get("c
-00013450: 6f6c 7265 765f 6d61 7374 6572 6461 7461  olrev_masterdata
-00013460: 5f70 726f 7665 6e61 6e63 6522 2c20 7b7d  _provenance", {}
-00013470: 292e 7661 6c75 6573 2829 0a20 2020 2020  ).values().     
-00013480: 2020 2029 3a0a 2020 2020 2020 2020 2020     ):.          
-00013490: 2020 7265 7475 726e 2054 7275 650a 0a20    return True.. 
-000134a0: 2020 2020 2020 2069 6620 7365 6c66 2e64         if self.d
-000134b0: 6174 612e 6765 7428 2263 6f6c 7265 765f  ata.get("colrev_
-000134c0: 7374 6174 7573 222c 2022 4e41 2229 2069  status", "NA") i
-000134d0: 6e20 5b0a 2020 2020 2020 2020 2020 2020  n [.            
-000134e0: 5265 636f 7264 5374 6174 652e 7265 765f  RecordState.rev_
-000134f0: 7072 6573 6372 6565 6e5f 6578 636c 7564  prescreen_exclud
-00013500: 6564 2c0a 2020 2020 2020 2020 5d3a 0a20  ed,.        ]:. 
-00013510: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00013520: 6e20 5472 7565 0a20 2020 2020 2020 2072  n True.        r
-00013530: 6574 7572 6e20 4661 6c73 650a 0a20 2020  eturn False..   
-00013540: 2064 6566 2073 7461 7475 735f 746f 5f70   def status_to_p
-00013550: 7265 7061 7265 2873 656c 6629 202d 3e20  repare(self) -> 
-00013560: 626f 6f6c 3a0a 2020 2020 2020 2020 2222  bool:.        ""
-00013570: 2243 6865 636b 2077 6865 7468 6572 2074  "Check whether t
-00013580: 6865 2072 6563 6f72 6420 6e65 6564 7320  he record needs 
-00013590: 746f 2062 6520 7072 6570 6172 6564 2222  to be prepared""
-000135a0: 220a 2020 2020 2020 2020 7265 7475 726e  ".        return
-000135b0: 2073 656c 662e 6461 7461 2e67 6574 2822   self.data.get("
-000135c0: 636f 6c72 6576 5f73 7461 7475 7322 2c20  colrev_status", 
-000135d0: 224e 4122 2920 696e 205b 0a20 2020 2020  "NA") in [.     
-000135e0: 2020 2020 2020 2052 6563 6f72 6453 7461         RecordSta
-000135f0: 7465 2e6d 645f 6e65 6564 735f 6d61 6e75  te.md_needs_manu
-00013600: 616c 5f70 7265 7061 7261 7469 6f6e 2c0a  al_preparation,.
-00013610: 2020 2020 2020 2020 2020 2020 5265 636f              Reco
-00013620: 7264 5374 6174 652e 6d64 5f69 6d70 6f72  rdState.md_impor
-00013630: 7465 642c 0a20 2020 2020 2020 2020 2020  ted,.           
-00013640: 2052 6563 6f72 6453 7461 7465 2e6d 645f   RecordState.md_
-00013650: 7072 6570 6172 6564 2c0a 2020 2020 2020  prepared,.      
-00013660: 2020 5d0a 0a20 2020 2064 6566 2075 7064    ]..    def upd
-00013670: 6174 655f 6d65 7461 6461 7461 5f73 7461  ate_metadata_sta
-00013680: 7475 7328 0a20 2020 2020 2020 2073 656c  tus(.        sel
-00013690: 662c 0a20 2020 2029 202d 3e20 4e6f 6e65  f,.    ) -> None
-000136a0: 3a0a 2020 2020 2020 2020 2222 2255 7064  :.        """Upd
-000136b0: 6174 6520 7468 6520 6d65 7461 6461 7461  ate the metadata
-000136c0: 2073 7461 7475 7320 2872 6574 7261 6374   status (retract
-000136d0: 732c 2069 6e63 6f6d 706c 6574 656e 6573  s, incompletenes
-000136e0: 732c 2069 6e63 6f6e 7369 7374 656e 6369  s, inconsistenci
-000136f0: 6573 2c20 6574 632e 290a 2020 2020 2020  es, etc.).      
-00013700: 2020 616e 6420 7365 7474 696e 6720 7468    and setting th
-00013710: 6520 7374 6174 7573 2061 6363 6f72 6469  e status accordi
-00013720: 6e67 6c79 2222 220a 0a20 2020 2020 2020  ngly"""..       
-00013730: 2073 656c 662e 6368 6563 6b5f 706f 7465   self.check_pote
-00013740: 6e74 6961 6c5f 7265 7472 6163 7473 2829  ntial_retracts()
-00013750: 0a0a 2020 2020 2020 2020 6966 2028 0a20  ..        if (. 
-00013760: 2020 2020 2020 2020 2020 2063 6f6c 7265             colre
-00013770: 762e 7265 636f 7264 2e52 6563 6f72 6453  v.record.RecordS
-00013780: 7461 7465 2e72 6576 5f70 7265 7363 7265  tate.rev_prescre
-00013790: 656e 5f65 7863 6c75 6465 640a 2020 2020  en_excluded.    
-000137a0: 2020 2020 2020 2020 3d3d 2073 656c 662e          == self.
-000137b0: 6461 7461 5b22 636f 6c72 6576 5f73 7461  data["colrev_sta
-000137c0: 7475 7322 5d0a 2020 2020 2020 2020 293a  tus"].        ):
-000137d0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-000137e0: 7572 6e0a 0a20 2020 2020 2020 2069 6620  urn..        if 
-000137f0: 7365 6c66 2e6d 6173 7465 7264 6174 615f  self.masterdata_
-00013800: 6973 5f63 7572 6174 6564 2829 3a0a 2020  is_curated():.  
-00013810: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
-00013820: 6574 5f73 7461 7475 7328 7461 7267 6574  et_status(target
-00013830: 5f73 7461 7465 3d52 6563 6f72 6453 7461  _state=RecordSta
-00013840: 7465 2e6d 645f 7072 6570 6172 6564 290a  te.md_prepared).
-00013850: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00013860: 726e 0a0a 2020 2020 2020 2020 6966 2073  rn..        if s
-00013870: 656c 662e 6861 735f 7175 616c 6974 795f  elf.has_quality_
-00013880: 6465 6665 6374 7328 293a 0a20 2020 2020  defects():.     
-00013890: 2020 2020 2020 2073 656c 662e 7365 745f         self.set_
-000138a0: 7374 6174 7573 2874 6172 6765 745f 7374  status(target_st
-000138b0: 6174 653d 5265 636f 7264 5374 6174 652e  ate=RecordState.
-000138c0: 6d64 5f6e 6565 6473 5f6d 616e 7561 6c5f  md_needs_manual_
-000138d0: 7072 6570 6172 6174 696f 6e29 0a20 2020  preparation).   
-000138e0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-000138f0: 2020 2020 2020 2073 656c 662e 7365 745f         self.set_
-00013900: 7374 6174 7573 2874 6172 6765 745f 7374  status(target_st
-00013910: 6174 653d 5265 636f 7264 5374 6174 652e  ate=RecordState.
-00013920: 6d64 5f70 7265 7061 7265 6429 0a0a 0a63  md_prepared)...c
-00013930: 6c61 7373 2052 6563 6f72 6453 7461 7465  lass RecordState
-00013940: 2845 6e75 6d29 3a0a 2020 2020 2222 2254  (Enum):.    """T
-00013950: 6865 2070 6f73 7369 626c 6520 5265 636f  he possible Reco
-00013960: 7264 5374 6174 6573 2073 746f 7265 6420  rdStates stored 
-00013970: 696e 2074 6865 2063 6f6c 7265 765f 7374  in the colrev_st
-00013980: 6174 7573 2066 6965 6c64 0a20 2020 2028  atus field.    (
-00013990: 636f 7272 6573 706f 6e64 696e 6720 746f  corresponding to
-000139a0: 2074 6865 2052 6563 6f72 6453 7461 7465   the RecordState
-000139b0: 4d6f 6465 6c29 2222 220a 0a20 2020 2023  Model)"""..    #
-000139c0: 2070 796c 696e 743a 2064 6973 6162 6c65   pylint: disable
-000139d0: 3d69 6e76 616c 6964 2d6e 616d 650a 0a20  =invalid-name.. 
-000139e0: 2020 2023 2077 6974 686f 7574 2074 6865     # without the
-000139f0: 206d 645f 7265 7472 6965 7665 6420 7374   md_retrieved st
-00013a00: 6174 652c 2077 6520 636f 756c 6420 6e6f  ate, we could no
-00013a10: 7420 6469 7370 6c61 7920 7468 6520 6c6f  t display the lo
-00013a20: 6164 2074 7261 6e73 6974 696f 6e0a 2020  ad transition.  
-00013a30: 2020 6d64 5f72 6574 7269 6576 6564 203d    md_retrieved =
-00013a40: 2031 0a20 2020 2022 2222 5265 636f 7264   1.    """Record
-00013a50: 2069 7320 7265 7472 6965 7665 6420 616e   is retrieved an
-00013a60: 6420 7374 6f72 6564 2069 6e20 7468 6520  d stored in the 
-00013a70: 2e2f 7365 6172 6368 2064 6972 6563 746f  ./search directo
-00013a80: 7279 2222 220a 2020 2020 6d64 5f69 6d70  ry""".    md_imp
-00013a90: 6f72 7465 6420 3d20 320a 2020 2020 2222  orted = 2.    ""
-00013aa0: 2252 6563 6f72 6420 6973 2069 6d70 6f72  "Record is impor
-00013ab0: 7465 6420 696e 746f 2074 6865 2052 4543  ted into the REC
-00013ac0: 4f52 4453 5f46 494c 4522 2222 0a20 2020  ORDS_FILE""".   
-00013ad0: 206d 645f 6e65 6564 735f 6d61 6e75 616c   md_needs_manual
-00013ae0: 5f70 7265 7061 7261 7469 6f6e 203d 2033  _preparation = 3
-00013af0: 0a20 2020 2022 2222 5265 636f 7264 2072  .    """Record r
-00013b00: 6571 7569 7265 7320 6d61 6e75 616c 2070  equires manual p
-00013b10: 7265 7061 7261 7469 6f6e 0a20 2020 2028  reparation.    (
-00013b20: 636f 6c72 6576 5f6d 6173 7465 7264 6174  colrev_masterdat
-00013b30: 615f 7072 6f76 656e 616e 6365 2070 726f  a_provenance pro
-00013b40: 7669 6465 7320 6869 6e74 7329 2222 220a  vides hints)""".
-00013b50: 2020 2020 6d64 5f70 7265 7061 7265 6420      md_prepared 
-00013b60: 3d20 340a 2020 2020 2222 2252 6563 6f72  = 4.    """Recor
-00013b70: 6420 6973 2070 7265 7061 7265 6420 286e  d is prepared (n
-00013b80: 6f20 6d69 7373 696e 6720 6f72 2069 6e63  o missing or inc
-00013b90: 6f6d 706c 6574 6520 6669 656c 6473 2c20  omplete fields, 
-00013ba0: 696e 636f 6e73 6973 7465 6e63 6965 7320  inconsistencies 
-00013bb0: 6368 6563 6b65 6429 2222 220a 2020 2020  checked)""".    
-00013bc0: 6d64 5f70 726f 6365 7373 6564 203d 2035  md_processed = 5
-00013bd0: 0a20 2020 2022 2222 5265 636f 7264 2068  .    """Record h
-00013be0: 6173 2062 6565 6e20 6368 6563 6b65 6420  as been checked 
-00013bf0: 666f 7220 6475 706c 6963 6174 6520 6173  for duplicate as
-00013c00: 736f 6369 6174 696f 6e73 0a20 2020 2077  sociations.    w
-00013c10: 6974 6820 616e 7920 7265 636f 7264 2069  ith any record i
-00013c20: 6e20 5265 636f 7264 5374 6174 6520 6d64  n RecordState md
-00013c30: 5f70 726f 6365 7373 6564 206f 7220 6c61  _processed or la
-00013c40: 7465 7222 2222 0a20 2020 2072 6576 5f70  ter""".    rev_p
-00013c50: 7265 7363 7265 656e 5f65 7863 6c75 6465  rescreen_exclude
-00013c60: 6420 3d20 360a 2020 2020 2222 2252 6563  d = 6.    """Rec
-00013c70: 6f72 6420 7761 7320 6578 636c 7564 6564  ord was excluded
-00013c80: 2069 6e20 7468 6520 7072 6573 6372 6565   in the prescree
-00013c90: 6e20 2862 6173 6564 206f 6e20 7469 746c  n (based on titl
-00013ca0: 6573 2f61 6273 7472 6163 7473 2922 2222  es/abstracts)"""
-00013cb0: 0a20 2020 2072 6576 5f70 7265 7363 7265  .    rev_prescre
-00013cc0: 656e 5f69 6e63 6c75 6465 6420 3d20 370a  en_included = 7.
-00013cd0: 2020 2020 2222 2252 6563 6f72 6420 7761      """Record wa
-00013ce0: 7320 696e 636c 7564 6564 2069 6e20 7468  s included in th
-00013cf0: 6520 7072 6573 6372 6565 6e20 2862 6173  e prescreen (bas
-00013d00: 6564 206f 6e20 7469 746c 6573 2f61 6273  ed on titles/abs
-00013d10: 7472 6163 7473 2922 2222 0a20 2020 2070  tracts)""".    p
-00013d20: 6466 5f6e 6565 6473 5f6d 616e 7561 6c5f  df_needs_manual_
-00013d30: 7265 7472 6965 7661 6c20 3d20 380a 2020  retrieval = 8.  
-00013d40: 2020 2222 2252 6563 6f72 6420 6d61 726b    """Record mark
-00013d50: 6564 2066 6f72 206d 616e 7561 6c20 5044  ed for manual PD
-00013d60: 4620 7265 7472 6965 7661 6c22 2222 0a20  F retrieval""". 
-00013d70: 2020 2070 6466 5f69 6d70 6f72 7465 6420     pdf_imported 
-00013d80: 3d20 390a 2020 2020 2222 2250 4446 2069  = 9.    """PDF i
-00013d90: 6d70 6f72 7465 6420 616e 6420 6d61 726b  mported and mark
-00013da0: 6564 2066 6f72 2070 7265 7061 7261 7469  ed for preparati
-00013db0: 6f6e 2222 220a 2020 2020 7064 665f 6e6f  on""".    pdf_no
-00013dc0: 745f 6176 6169 6c61 626c 6520 3d20 3130  t_available = 10
-00013dd0: 0a20 2020 2022 2222 5044 4620 6973 206e  .    """PDF is n
-00013de0: 6f74 2061 7661 696c 6162 6c65 2222 220a  ot available""".
-00013df0: 2020 2020 7064 665f 6e65 6564 735f 6d61      pdf_needs_ma
-00013e00: 6e75 616c 5f70 7265 7061 7261 7469 6f6e  nual_preparation
-00013e10: 203d 2031 310a 2020 2020 2222 2250 4446   = 11.    """PDF
-00013e20: 206d 6172 6b65 6420 666f 7220 6d61 6e75   marked for manu
-00013e30: 616c 2070 7265 7061 7261 7469 6f6e 2222  al preparation""
-00013e40: 220a 2020 2020 7064 665f 7072 6570 6172  ".    pdf_prepar
-00013e50: 6564 203d 2031 320a 2020 2020 2222 2250  ed = 12.    """P
-00013e60: 4446 2070 7265 7061 7265 6422 2222 0a20  DF prepared""". 
-00013e70: 2020 2072 6576 5f65 7863 6c75 6465 6420     rev_excluded 
-00013e80: 3d20 3133 0a20 2020 2022 2222 5265 636f  = 13.    """Reco
-00013e90: 7264 2065 7863 6c75 6465 6420 696e 2073  rd excluded in s
-00013ea0: 6372 6565 6e20 2866 756c 6c2d 7465 7874  creen (full-text
-00013eb0: 2922 2222 0a20 2020 2072 6576 5f69 6e63  )""".    rev_inc
-00013ec0: 6c75 6465 6420 3d20 3134 0a20 2020 2022  luded = 14.    "
-00013ed0: 2222 5265 636f 7264 2069 6e63 6c75 6465  ""Record include
-00013ee0: 6420 696e 2073 6372 6565 6e20 2866 756c  d in screen (ful
-00013ef0: 6c2d 7465 7874 2922 2222 0a20 2020 2072  l-text)""".    r
-00013f00: 6576 5f73 796e 7468 6573 697a 6564 203d  ev_synthesized =
-00013f10: 2031 350a 2020 2020 2222 2252 6563 6f72   15.    """Recor
-00013f20: 6420 7379 6e74 6865 7369 7a65 6422 2222  d synthesized"""
-00013f30: 0a20 2020 2023 204e 6f74 6520 3a20 5442  .    # Note : TB
-00013f40: 443a 2072 6576 5f63 6f64 6564 0a0a 2020  D: rev_coded..  
-00013f50: 2020 6465 6620 5f5f 7374 725f 5f28 7365    def __str__(se
-00013f60: 6c66 2920 2d3e 2073 7472 3a0a 2020 2020  lf) -> str:.    
-00013f70: 2020 2020 7265 7475 726e 2066 227b 7365      return f"{se
-00013f80: 6c66 2e6e 616d 657d 220a 0a20 2020 2064  lf.name}"..    d
-00013f90: 6566 205f 5f6c 745f 5f28 7365 6c66 2c20  ef __lt__(self, 
-00013fa0: 6f74 6865 7229 202d 3e20 626f 6f6c 3a20  other) -> bool: 
-00013fb0: 2023 2074 7970 653a 2069 676e 6f72 650a   # type: ignore.
-00013fc0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00013fd0: 5f5f 636c 6173 735f 5f20 3d3d 2052 6563  __class__ == Rec
-00013fe0: 6f72 6453 7461 7465 2061 6e64 206f 7468  ordState and oth
-00013ff0: 6572 2e5f 5f63 6c61 7373 5f5f 203d 3d20  er.__class__ == 
-00014000: 5265 636f 7264 5374 6174 653a 0a20 2020  RecordState:.   
-00014010: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00014020: 7365 6c66 2e76 616c 7565 203c 206f 7468  self.value < oth
-00014030: 6572 2e76 616c 7565 0a20 2020 2020 2020  er.value.       
-00014040: 2072 6169 7365 204e 6f74 496d 706c 656d   raise NotImplem
-00014050: 656e 7465 6445 7272 6f72 0a0a 2020 2020  entedError..    
-00014060: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
-00014070: 2064 6566 2067 6574 5f6e 6f6e 5f70 726f   def get_non_pro
-00014080: 6365 7373 6564 5f73 7461 7465 7328 636c  cessed_states(cl
-00014090: 7329 202d 3e20 6c69 7374 3a0a 2020 2020  s) -> list:.    
-000140a0: 2020 2020 2222 2247 6574 2074 6865 2073      """Get the s
-000140b0: 7461 7465 7320 7468 6174 2063 6f72 7265  tates that corre
-000140c0: 7370 6f6e 6420 746f 206e 6f74 2d79 6574  spond to not-yet
-000140d0: 2d70 726f 6365 7373 6564 2222 220a 2020  -processed""".  
-000140e0: 2020 2020 2020 7265 7475 726e 205b 0a20        return [. 
-000140f0: 2020 2020 2020 2020 2020 2063 6f6c 7265             colre
-00014100: 762e 7265 636f 7264 2e52 6563 6f72 6453  v.record.RecordS
-00014110: 7461 7465 2e6d 645f 7265 7472 6965 7665  tate.md_retrieve
-00014120: 642c 0a20 2020 2020 2020 2020 2020 2063  d,.            c
-00014130: 6f6c 7265 762e 7265 636f 7264 2e52 6563  olrev.record.Rec
-00014140: 6f72 6453 7461 7465 2e6d 645f 696d 706f  ordState.md_impo
-00014150: 7274 6564 2c0a 2020 2020 2020 2020 2020  rted,.          
-00014160: 2020 636f 6c72 6576 2e72 6563 6f72 642e    colrev.record.
-00014170: 5265 636f 7264 5374 6174 652e 6d64 5f70  RecordState.md_p
-00014180: 7265 7061 7265 642c 0a20 2020 2020 2020  repared,.       
-00014190: 2020 2020 2063 6f6c 7265 762e 7265 636f       colrev.reco
-000141a0: 7264 2e52 6563 6f72 6453 7461 7465 2e6d  rd.RecordState.m
-000141b0: 645f 6e65 6564 735f 6d61 6e75 616c 5f70  d_needs_manual_p
-000141c0: 7265 7061 7261 7469 6f6e 2c0a 2020 2020  reparation,.    
-000141d0: 2020 2020 5d0a 0a20 2020 2040 636c 6173      ]..    @clas
-000141e0: 736d 6574 686f 640a 2020 2020 6465 6620  smethod.    def 
-000141f0: 6765 745f 706f 7374 5f78 5f73 7461 7465  get_post_x_state
-00014200: 7328 636c 732c 202a 2c20 7374 6174 653a  s(cls, *, state:
-00014210: 2052 6563 6f72 6453 7461 7465 2920 2d3e   RecordState) ->
-00014220: 2074 7970 696e 672e 5365 745b 5265 636f   typing.Set[Reco
-00014230: 7264 5374 6174 655d 3a0a 2020 2020 2020  rdState]:.      
-00014240: 2020 2222 2247 6574 2074 6865 2073 7461    """Get the sta
-00014250: 7465 7320 6166 7465 7220 7374 6174 6520  tes after state 
-00014260: 7820 2870 6173 7365 6420 6173 2061 2070  x (passed as a p
-00014270: 6172 616d 6574 6572 2922 2222 0a20 2020  arameter)""".   
-00014280: 2020 2020 2069 6620 7374 6174 6520 3d3d       if state ==
-00014290: 2052 6563 6f72 6453 7461 7465 2e6d 645f   RecordState.md_
-000142a0: 7072 6570 6172 6564 3a0a 2020 2020 2020  prepared:.      
-000142b0: 2020 2020 2020 7265 7475 726e 207b 0a20        return {. 
-000142c0: 2020 2020 2020 2020 2020 2020 2020 2052                 R
-000142d0: 6563 6f72 6453 7461 7465 2e6d 645f 7072  ecordState.md_pr
-000142e0: 6570 6172 6564 2c0a 2020 2020 2020 2020  epared,.        
-000142f0: 2020 2020 2020 2020 5265 636f 7264 5374          RecordSt
-00014300: 6174 652e 6d64 5f70 726f 6365 7373 6564  ate.md_processed
-00014310: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00014320: 2020 5265 636f 7264 5374 6174 652e 7265    RecordState.re
-00014330: 765f 7072 6573 6372 6565 6e5f 696e 636c  v_prescreen_incl
-00014340: 7564 6564 2c0a 2020 2020 2020 2020 2020  uded,.          
-00014350: 2020 2020 2020 5265 636f 7264 5374 6174        RecordStat
-00014360: 652e 7265 765f 7072 6573 6372 6565 6e5f  e.rev_prescreen_
-00014370: 6578 636c 7564 6564 2c0a 2020 2020 2020  excluded,.      
-00014380: 2020 2020 2020 2020 2020 5265 636f 7264            Record
-00014390: 5374 6174 652e 7064 665f 6e65 6564 735f  State.pdf_needs_
-000143a0: 6d61 6e75 616c 5f72 6574 7269 6576 616c  manual_retrieval
-000143b0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000143c0: 2020 5265 636f 7264 5374 6174 652e 7064    RecordState.pd
-000143d0: 665f 696d 706f 7274 6564 2c0a 2020 2020  f_imported,.    
-000143e0: 2020 2020 2020 2020 2020 2020 5265 636f              Reco
-000143f0: 7264 5374 6174 652e 7064 665f 6e6f 745f  rdState.pdf_not_
-00014400: 6176 6169 6c61 626c 652c 0a20 2020 2020  available,.     
-00014410: 2020 2020 2020 2020 2020 2052 6563 6f72             Recor
-00014420: 6453 7461 7465 2e70 6466 5f6e 6565 6473  dState.pdf_needs
-00014430: 5f6d 616e 7561 6c5f 7072 6570 6172 6174  _manual_preparat
-00014440: 696f 6e2c 0a20 2020 2020 2020 2020 2020  ion,.           
-00014450: 2020 2020 2052 6563 6f72 6453 7461 7465       RecordState
-00014460: 2e70 6466 5f70 7265 7061 7265 642c 0a20  .pdf_prepared,. 
-00014470: 2020 2020 2020 2020 2020 2020 2020 2052                 R
-00014480: 6563 6f72 6453 7461 7465 2e72 6576 5f65  ecordState.rev_e
-00014490: 7863 6c75 6465 642c 0a20 2020 2020 2020  xcluded,.       
-000144a0: 2020 2020 2020 2020 2052 6563 6f72 6453           RecordS
-000144b0: 7461 7465 2e72 6576 5f69 6e63 6c75 6465  tate.rev_include
-000144c0: 642c 0a20 2020 2020 2020 2020 2020 2020  d,.             
-000144d0: 2020 2052 6563 6f72 6453 7461 7465 2e72     RecordState.r
-000144e0: 6576 5f73 796e 7468 6573 697a 6564 2c0a  ev_synthesized,.
-000144f0: 2020 2020 2020 2020 2020 2020 7d0a 2020              }.  
-00014500: 2020 2020 2020 6966 2073 7461 7465 203d        if state =
-00014510: 3d20 5265 636f 7264 5374 6174 652e 6d64  = RecordState.md
-00014520: 5f70 726f 6365 7373 6564 3a0a 2020 2020  _processed:.    
-00014530: 2020 2020 2020 2020 7265 7475 726e 207b          return {
-00014540: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014550: 2052 6563 6f72 6453 7461 7465 2e6d 645f   RecordState.md_
-00014560: 7072 6f63 6573 7365 642c 0a20 2020 2020  processed,.     
-00014570: 2020 2020 2020 2020 2020 2052 6563 6f72             Recor
-00014580: 6453 7461 7465 2e72 6576 5f70 7265 7363  dState.rev_presc
-00014590: 7265 656e 5f69 6e63 6c75 6465 642c 0a20  reen_included,. 
-000145a0: 2020 2020 2020 2020 2020 2020 2020 2052                 R
-000145b0: 6563 6f72 6453 7461 7465 2e72 6576 5f70  ecordState.rev_p
-000145c0: 7265 7363 7265 656e 5f65 7863 6c75 6465  rescreen_exclude
-000145d0: 642c 0a20 2020 2020 2020 2020 2020 2020  d,.             
-000145e0: 2020 2052 6563 6f72 6453 7461 7465 2e70     RecordState.p
-000145f0: 6466 5f6e 6565 6473 5f6d 616e 7561 6c5f  df_needs_manual_
-00014600: 7265 7472 6965 7661 6c2c 0a20 2020 2020  retrieval,.     
-00014610: 2020 2020 2020 2020 2020 2052 6563 6f72             Recor
-00014620: 6453 7461 7465 2e70 6466 5f69 6d70 6f72  dState.pdf_impor
-00014630: 7465 642c 0a20 2020 2020 2020 2020 2020  ted,.           
-00014640: 2020 2020 2052 6563 6f72 6453 7461 7465       RecordState
-00014650: 2e70 6466 5f6e 6f74 5f61 7661 696c 6162  .pdf_not_availab
-00014660: 6c65 2c0a 2020 2020 2020 2020 2020 2020  le,.            
-00014670: 2020 2020 5265 636f 7264 5374 6174 652e      RecordState.
-00014680: 7064 665f 6e65 6564 735f 6d61 6e75 616c  pdf_needs_manual
-00014690: 5f70 7265 7061 7261 7469 6f6e 2c0a 2020  _preparation,.  
-000146a0: 2020 2020 2020 2020 2020 2020 2020 5265                Re
-000146b0: 636f 7264 5374 6174 652e 7064 665f 7072  cordState.pdf_pr
-000146c0: 6570 6172 6564 2c0a 2020 2020 2020 2020  epared,.        
-000146d0: 2020 2020 2020 2020 5265 636f 7264 5374          RecordSt
-000146e0: 6174 652e 7265 765f 6578 636c 7564 6564  ate.rev_excluded
-000146f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00014700: 2020 5265 636f 7264 5374 6174 652e 7265    RecordState.re
-00014710: 765f 696e 636c 7564 6564 2c0a 2020 2020  v_included,.    
-00014720: 2020 2020 2020 2020 2020 2020 5265 636f              Reco
-00014730: 7264 5374 6174 652e 7265 765f 7379 6e74  rdState.rev_synt
-00014740: 6865 7369 7a65 642c 0a20 2020 2020 2020  hesized,.       
-00014750: 2020 2020 207d 0a20 2020 2020 2020 2069       }.        i
-00014760: 6620 7374 6174 6520 3d3d 2052 6563 6f72  f state == Recor
-00014770: 6453 7461 7465 2e72 6576 5f70 7265 7363  dState.rev_presc
-00014780: 7265 656e 5f69 6e63 6c75 6465 643a 0a20  reen_included:. 
-00014790: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-000147a0: 6e20 7b0a 2020 2020 2020 2020 2020 2020  n {.            
-000147b0: 2020 2020 5265 636f 7264 5374 6174 652e      RecordState.
-000147c0: 7265 765f 7072 6573 6372 6565 6e5f 696e  rev_prescreen_in
-000147d0: 636c 7564 6564 2c0a 2020 2020 2020 2020  cluded,.        
-000147e0: 2020 2020 2020 2020 5265 636f 7264 5374          RecordSt
-000147f0: 6174 652e 7265 765f 7072 6573 6372 6565  ate.rev_prescree
-00014800: 6e5f 6578 636c 7564 6564 2c0a 2020 2020  n_excluded,.    
-00014810: 2020 2020 2020 2020 2020 2020 5265 636f              Reco
-00014820: 7264 5374 6174 652e 7064 665f 6e65 6564  rdState.pdf_need
-00014830: 735f 6d61 6e75 616c 5f72 6574 7269 6576  s_manual_retriev
-00014840: 616c 2c0a 2020 2020 2020 2020 2020 2020  al,.            
-00014850: 2020 2020 5265 636f 7264 5374 6174 652e      RecordState.
-00014860: 7064 665f 696d 706f 7274 6564 2c0a 2020  pdf_imported,.  
-00014870: 2020 2020 2020 2020 2020 2020 2020 5265                Re
-00014880: 636f 7264 5374 6174 652e 7064 665f 6e6f  cordState.pdf_no
-00014890: 745f 6176 6169 6c61 626c 652c 0a20 2020  t_available,.   
-000148a0: 2020 2020 2020 2020 2020 2020 2052 6563               Rec
-000148b0: 6f72 6453 7461 7465 2e70 6466 5f6e 6565  ordState.pdf_nee
-000148c0: 6473 5f6d 616e 7561 6c5f 7072 6570 6172  ds_manual_prepar
-000148d0: 6174 696f 6e2c 0a20 2020 2020 2020 2020  ation,.         
-000148e0: 2020 2020 2020 2052 6563 6f72 6453 7461         RecordSta
-000148f0: 7465 2e70 6466 5f70 7265 7061 7265 642c  te.pdf_prepared,
-00014900: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014910: 2052 6563 6f72 6453 7461 7465 2e72 6576   RecordState.rev
-00014920: 5f65 7863 6c75 6465 642c 0a20 2020 2020  _excluded,.     
-00014930: 2020 2020 2020 2020 2020 2052 6563 6f72             Recor
-00014940: 6453 7461 7465 2e72 6576 5f69 6e63 6c75  dState.rev_inclu
-00014950: 6465 642c 0a20 2020 2020 2020 2020 2020  ded,.           
-00014960: 2020 2020 2052 6563 6f72 6453 7461 7465       RecordState
-00014970: 2e72 6576 5f73 796e 7468 6573 697a 6564  .rev_synthesized
-00014980: 2c0a 2020 2020 2020 2020 2020 2020 7d0a  ,.            }.
-00014990: 2020 2020 2020 2020 6966 2073 7461 7465          if state
-000149a0: 203d 3d20 5265 636f 7264 5374 6174 652e   == RecordState.
-000149b0: 7064 665f 7072 6570 6172 6564 3a0a 2020  pdf_prepared:.  
-000149c0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-000149d0: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
-000149e0: 2020 2052 6563 6f72 6453 7461 7465 2e70     RecordState.p
-000149f0: 6466 5f70 7265 7061 7265 642c 0a20 2020  df_prepared,.   
-00014a00: 2020 2020 2020 2020 2020 2020 2052 6563               Rec
-00014a10: 6f72 6453 7461 7465 2e72 6576 5f65 7863  ordState.rev_exc
-00014a20: 6c75 6465 642c 0a20 2020 2020 2020 2020  luded,.         
-00014a30: 2020 2020 2020 2052 6563 6f72 6453 7461         RecordSta
-00014a40: 7465 2e72 6576 5f69 6e63 6c75 6465 642c  te.rev_included,
-00014a50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014a60: 2052 6563 6f72 6453 7461 7465 2e72 6576   RecordState.rev
-00014a70: 5f73 796e 7468 6573 697a 6564 2c0a 2020  _synthesized,.  
-00014a80: 2020 2020 2020 2020 2020 7d0a 0a20 2020            }..   
-00014a90: 2020 2020 2069 6620 7374 6174 6520 3d3d       if state ==
-00014aa0: 2052 6563 6f72 6453 7461 7465 2e72 6576   RecordState.rev
-00014ab0: 5f69 6e63 6c75 6465 643a 0a20 2020 2020  _included:.     
-00014ac0: 2020 2020 2020 2072 6574 7572 6e20 7b0a         return {.
-00014ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014ae0: 5265 636f 7264 5374 6174 652e 7265 765f  RecordState.rev_
-00014af0: 6578 636c 7564 6564 2c0a 2020 2020 2020  excluded,.      
-00014b00: 2020 2020 2020 2020 2020 5265 636f 7264            Record
-00014b10: 5374 6174 652e 7265 765f 696e 636c 7564  State.rev_includ
-00014b20: 6564 2c0a 2020 2020 2020 2020 2020 2020  ed,.            
-00014b30: 2020 2020 5265 636f 7264 5374 6174 652e      RecordState.
-00014b40: 7265 765f 7379 6e74 6865 7369 7a65 642c  rev_synthesized,
-00014b50: 0a20 2020 2020 2020 2020 2020 207d 0a0a  .            }..
-00014b60: 2020 2020 2020 2020 2320 7079 6c69 6e74          # pylint
-00014b70: 3a20 6469 7361 626c 653d 6e6f 2d6d 656d  : disable=no-mem
-00014b80: 6265 720a 2020 2020 2020 2020 7261 6973  ber.        rais
-00014b90: 6520 636f 6c72 6576 5f65 7863 6570 7469  e colrev_excepti
-00014ba0: 6f6e 732e 5061 7261 6d65 7465 7245 7272  ons.ParameterErr
-00014bb0: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
-00014bc0: 7061 7261 6d65 7465 723d 2273 7461 7465  parameter="state
-00014bd0: 222c 2076 616c 7565 3d22 7374 6174 6522  ", value="state"
-00014be0: 2c20 6f70 7469 6f6e 733d 636c 732e 5f6d  , options=cls._m
-00014bf0: 656d 6265 725f 6e61 6d65 735f 0a20 2020  ember_names_.   
-00014c00: 2020 2020 2029 0a0a 0a6e 6f6e 5f70 726f       )...non_pro
-00014c10: 6365 7373 696e 675f 7472 616e 7369 7469  cessing_transiti
-00014c20: 6f6e 7320 3d20 5b0a 2020 2020 5b0a 2020  ons = [.    [.  
-00014c30: 2020 2020 2020 7b0a 2020 2020 2020 2020        {.        
-00014c40: 2020 2020 2274 7269 6767 6572 223a 2022      "trigger": "
-00014c50: 666f 726d 6174 222c 0a20 2020 2020 2020  format",.       
-00014c60: 2020 2020 2022 736f 7572 6365 223a 2073       "source": s
-00014c70: 7461 7465 2c0a 2020 2020 2020 2020 2020  tate,.          
-00014c80: 2020 2264 6573 7422 3a20 7374 6174 652c    "dest": state,
-00014c90: 0a20 2020 2020 2020 207d 2c0a 2020 2020  .        },.    
-00014ca0: 2020 2020 7b0a 2020 2020 2020 2020 2020      {.          
-00014cb0: 2020 2274 7269 6767 6572 223a 2022 6578    "trigger": "ex
-00014cc0: 706c 6f72 6522 2c0a 2020 2020 2020 2020  plore",.        
-00014cd0: 2020 2020 2273 6f75 7263 6522 3a20 7374      "source": st
-00014ce0: 6174 652c 0a20 2020 2020 2020 2020 2020  ate,.           
-00014cf0: 2022 6465 7374 223a 2073 7461 7465 2c0a   "dest": state,.
-00014d00: 2020 2020 2020 2020 7d2c 0a20 2020 2020          },.     
-00014d10: 2020 207b 0a20 2020 2020 2020 2020 2020     {.           
-00014d20: 2022 7472 6967 6765 7222 3a20 2263 6865   "trigger": "che
-00014d30: 636b 222c 0a20 2020 2020 2020 2020 2020  ck",.           
-00014d40: 2022 736f 7572 6365 223a 2073 7461 7465   "source": state
-00014d50: 2c0a 2020 2020 2020 2020 2020 2020 2264  ,.            "d
-00014d60: 6573 7422 3a20 7374 6174 652c 0a20 2020  est": state,.   
-00014d70: 2020 2020 207d 2c0a 2020 2020 5d0a 2020       },.    ].  
-00014d80: 2020 666f 7220 7374 6174 6520 696e 206c    for state in l
-00014d90: 6973 7428 5265 636f 7264 5374 6174 6529  ist(RecordState)
-00014da0: 0a5d 0a0a 0a63 6c61 7373 2052 6563 6f72  .]...class Recor
-00014db0: 6453 7461 7465 4d6f 6465 6c3a 0a20 2020  dStateModel:.   
-00014dc0: 2022 2222 5468 6520 5265 636f 7264 5374   """The RecordSt
-00014dd0: 6174 654d 6f64 656c 2064 6573 6372 6962  ateModel describ
-00014de0: 6573 2074 7261 6e73 6974 696f 6e73 2062  es transitions b
-00014df0: 6574 7765 656e 2052 6563 6f72 6453 7461  etween RecordSta
-00014e00: 7465 7322 2222 0a0a 2020 2020 7472 616e  tes"""..    tran
-00014e10: 7369 7469 6f6e 7320 3d20 5b0a 2020 2020  sitions = [.    
-00014e20: 2020 2020 7b0a 2020 2020 2020 2020 2020      {.          
-00014e30: 2020 2274 7269 6767 6572 223a 2022 6c6f    "trigger": "lo
-00014e40: 6164 222c 0a20 2020 2020 2020 2020 2020  ad",.           
-00014e50: 2022 736f 7572 6365 223a 2052 6563 6f72   "source": Recor
-00014e60: 6453 7461 7465 2e6d 645f 7265 7472 6965  dState.md_retrie
-00014e70: 7665 642c 0a20 2020 2020 2020 2020 2020  ved,.           
-00014e80: 2022 6465 7374 223a 2052 6563 6f72 6453   "dest": RecordS
-00014e90: 7461 7465 2e6d 645f 696d 706f 7274 6564  tate.md_imported
-00014ea0: 2c0a 2020 2020 2020 2020 7d2c 0a20 2020  ,.        },.   
-00014eb0: 2020 2020 207b 0a20 2020 2020 2020 2020       {.         
-00014ec0: 2020 2022 7472 6967 6765 7222 3a20 2270     "trigger": "p
-00014ed0: 7265 7022 2c0a 2020 2020 2020 2020 2020  rep",.          
-00014ee0: 2020 2273 6f75 7263 6522 3a20 5265 636f    "source": Reco
-00014ef0: 7264 5374 6174 652e 6d64 5f69 6d70 6f72  rdState.md_impor
-00014f00: 7465 642c 0a20 2020 2020 2020 2020 2020  ted,.           
-00014f10: 2022 6465 7374 223a 2052 6563 6f72 6453   "dest": RecordS
-00014f20: 7461 7465 2e6d 645f 6e65 6564 735f 6d61  tate.md_needs_ma
-00014f30: 6e75 616c 5f70 7265 7061 7261 7469 6f6e  nual_preparation
-00014f40: 2c0a 2020 2020 2020 2020 7d2c 0a20 2020  ,.        },.   
-00014f50: 2020 2020 207b 0a20 2020 2020 2020 2020       {.         
-00014f60: 2020 2022 7472 6967 6765 7222 3a20 2270     "trigger": "p
-00014f70: 7265 7022 2c0a 2020 2020 2020 2020 2020  rep",.          
-00014f80: 2020 2273 6f75 7263 6522 3a20 5265 636f    "source": Reco
-00014f90: 7264 5374 6174 652e 6d64 5f69 6d70 6f72  rdState.md_impor
-00014fa0: 7465 642c 0a20 2020 2020 2020 2020 2020  ted,.           
-00014fb0: 2022 6465 7374 223a 2052 6563 6f72 6453   "dest": RecordS
-00014fc0: 7461 7465 2e6d 645f 7072 6570 6172 6564  tate.md_prepared
-00014fd0: 2c0a 2020 2020 2020 2020 7d2c 0a20 2020  ,.        },.   
-00014fe0: 2020 2020 207b 0a20 2020 2020 2020 2020       {.         
-00014ff0: 2020 2022 7472 6967 6765 7222 3a20 2270     "trigger": "p
-00015000: 7265 705f 6d61 6e22 2c0a 2020 2020 2020  rep_man",.      
-00015010: 2020 2020 2020 2273 6f75 7263 6522 3a20        "source": 
-00015020: 5265 636f 7264 5374 6174 652e 6d64 5f6e  RecordState.md_n
-00015030: 6565 6473 5f6d 616e 7561 6c5f 7072 6570  eeds_manual_prep
-00015040: 6172 6174 696f 6e2c 0a20 2020 2020 2020  aration,.       
-00015050: 2020 2020 2022 6465 7374 223a 2052 6563       "dest": Rec
-00015060: 6f72 6453 7461 7465 2e6d 645f 7072 6570  ordState.md_prep
-00015070: 6172 6564 2c0a 2020 2020 2020 2020 7d2c  ared,.        },
-00015080: 0a20 2020 2020 2020 207b 0a20 2020 2020  .        {.     
-00015090: 2020 2020 2020 2022 7472 6967 6765 7222         "trigger"
-000150a0: 3a20 2264 6564 7570 6522 2c0a 2020 2020  : "dedupe",.    
-000150b0: 2020 2020 2020 2020 2273 6f75 7263 6522          "source"
-000150c0: 3a20 5265 636f 7264 5374 6174 652e 6d64  : RecordState.md
-000150d0: 5f70 7265 7061 7265 642c 0a20 2020 2020  _prepared,.     
-000150e0: 2020 2020 2020 2022 6465 7374 223a 2052         "dest": R
-000150f0: 6563 6f72 6453 7461 7465 2e6d 645f 7072  ecordState.md_pr
-00015100: 6f63 6573 7365 642c 0a20 2020 2020 2020  ocessed,.       
-00015110: 207d 2c0a 2020 2020 2020 2020 7b0a 2020   },.        {.  
-00015120: 2020 2020 2020 2020 2020 2274 7269 6767            "trigg
-00015130: 6572 223a 2022 7072 6573 6372 6565 6e22  er": "prescreen"
-00015140: 2c0a 2020 2020 2020 2020 2020 2020 2273  ,.            "s
-00015150: 6f75 7263 6522 3a20 5265 636f 7264 5374  ource": RecordSt
-00015160: 6174 652e 6d64 5f70 726f 6365 7373 6564  ate.md_processed
-00015170: 2c0a 2020 2020 2020 2020 2020 2020 2264  ,.            "d
-00015180: 6573 7422 3a20 5265 636f 7264 5374 6174  est": RecordStat
-00015190: 652e 7265 765f 7072 6573 6372 6565 6e5f  e.rev_prescreen_
-000151a0: 6578 636c 7564 6564 2c0a 2020 2020 2020  excluded,.      
-000151b0: 2020 7d2c 0a20 2020 2020 2020 207b 0a20    },.        {. 
-000151c0: 2020 2020 2020 2020 2020 2022 7472 6967             "trig
-000151d0: 6765 7222 3a20 2270 7265 7363 7265 656e  ger": "prescreen
-000151e0: 222c 0a20 2020 2020 2020 2020 2020 2022  ",.            "
-000151f0: 736f 7572 6365 223a 2052 6563 6f72 6453  source": RecordS
-00015200: 7461 7465 2e6d 645f 7072 6f63 6573 7365  tate.md_processe
-00015210: 642c 0a20 2020 2020 2020 2020 2020 2022  d,.            "
-00015220: 6465 7374 223a 2052 6563 6f72 6453 7461  dest": RecordSta
-00015230: 7465 2e72 6576 5f70 7265 7363 7265 656e  te.rev_prescreen
-00015240: 5f69 6e63 6c75 6465 642c 0a20 2020 2020  _included,.     
-00015250: 2020 207d 2c0a 2020 2020 2020 2020 7b0a     },.        {.
-00015260: 2020 2020 2020 2020 2020 2020 2274 7269              "tri
-00015270: 6767 6572 223a 2022 7064 665f 6765 7422  gger": "pdf_get"
-00015280: 2c0a 2020 2020 2020 2020 2020 2020 2273  ,.            "s
-00015290: 6f75 7263 6522 3a20 5265 636f 7264 5374  ource": RecordSt
-000152a0: 6174 652e 7265 765f 7072 6573 6372 6565  ate.rev_prescree
-000152b0: 6e5f 696e 636c 7564 6564 2c0a 2020 2020  n_included,.    
-000152c0: 2020 2020 2020 2020 2264 6573 7422 3a20          "dest": 
-000152d0: 5265 636f 7264 5374 6174 652e 7064 665f  RecordState.pdf_
-000152e0: 696d 706f 7274 6564 2c0a 2020 2020 2020  imported,.      
-000152f0: 2020 7d2c 0a20 2020 2020 2020 207b 0a20    },.        {. 
-00015300: 2020 2020 2020 2020 2020 2022 7472 6967             "trig
-00015310: 6765 7222 3a20 2270 6466 5f67 6574 222c  ger": "pdf_get",
-00015320: 0a20 2020 2020 2020 2020 2020 2022 736f  .            "so
-00015330: 7572 6365 223a 2052 6563 6f72 6453 7461  urce": RecordSta
-00015340: 7465 2e72 6576 5f70 7265 7363 7265 656e  te.rev_prescreen
-00015350: 5f69 6e63 6c75 6465 642c 0a20 2020 2020  _included,.     
-00015360: 2020 2020 2020 2022 6465 7374 223a 2052         "dest": R
-00015370: 6563 6f72 6453 7461 7465 2e70 6466 5f6e  ecordState.pdf_n
-00015380: 6565 6473 5f6d 616e 7561 6c5f 7265 7472  eeds_manual_retr
-00015390: 6965 7661 6c2c 0a20 2020 2020 2020 207d  ieval,.        }
-000153a0: 2c0a 2020 2020 2020 2020 7b0a 2020 2020  ,.        {.    
-000153b0: 2020 2020 2020 2020 2274 7269 6767 6572          "trigger
-000153c0: 223a 2022 7064 665f 6765 745f 6d61 6e22  ": "pdf_get_man"
-000153d0: 2c0a 2020 2020 2020 2020 2020 2020 2273  ,.            "s
-000153e0: 6f75 7263 6522 3a20 5265 636f 7264 5374  ource": RecordSt
-000153f0: 6174 652e 7064 665f 6e65 6564 735f 6d61  ate.pdf_needs_ma
-00015400: 6e75 616c 5f72 6574 7269 6576 616c 2c0a  nual_retrieval,.
-00015410: 2020 2020 2020 2020 2020 2020 2264 6573              "des
-00015420: 7422 3a20 5265 636f 7264 5374 6174 652e  t": RecordState.
-00015430: 7064 665f 6e6f 745f 6176 6169 6c61 626c  pdf_not_availabl
-00015440: 652c 0a20 2020 2020 2020 207d 2c0a 2020  e,.        },.  
-00015450: 2020 2020 2020 7b0a 2020 2020 2020 2020        {.        
-00015460: 2020 2020 2274 7269 6767 6572 223a 2022      "trigger": "
-00015470: 7064 665f 6765 745f 6d61 6e22 2c0a 2020  pdf_get_man",.  
+00011800: 7265 636f 7264 2e64 6174 615b 226a 6f75  record.data["jou
+00011810: 726e 616c 225d 203d 2022 2022 2e6a 6f69  rnal"] = " ".joi
+00011820: 6e28 0a20 2020 2020 2020 2020 2020 2020  n(.             
+00011830: 2020 2020 2020 205b 785b 3a6d 696e 5f6c         [x[:min_l
+00011840: 656e 5d20 666f 7220 7820 696e 2072 6563  en] for x in rec
+00011850: 6f72 642e 6461 7461 5b22 6a6f 7572 6e61  ord.data["journa
+00011860: 6c22 5d2e 7370 6c69 7428 2220 2229 5d0a  l"].split(" ")].
+00011870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011880: 290a 0a20 2020 2020 2020 2064 6566 2067  )..        def g
+00011890: 6574 5f61 6262 7265 765f 636f 6e74 6169  et_abbrev_contai
+000118a0: 6e65 725f 6d69 6e5f 6c65 6e28 2a2c 2072  ner_min_len(*, r
+000118b0: 6563 6f72 643a 2063 6f6c 7265 762e 7265  ecord: colrev.re
+000118c0: 636f 7264 2e52 6563 6f72 6429 202d 3e20  cord.Record) -> 
+000118d0: 696e 743a 0a20 2020 2020 2020 2020 2020  int:.           
+000118e0: 206d 696e 5f6c 656e 203d 202d 310a 2020   min_len = -1.  
+000118f0: 2020 2020 2020 2020 2020 6966 2022 6a6f            if "jo
+00011900: 7572 6e61 6c22 2069 6e20 7265 636f 7264  urnal" in record
+00011910: 2e64 6174 613a 0a20 2020 2020 2020 2020  .data:.         
+00011920: 2020 2020 2020 206d 696e 5f6c 656e 203d         min_len =
+00011930: 206d 696e 280a 2020 2020 2020 2020 2020   min(.          
+00011940: 2020 2020 2020 2020 2020 6c65 6e28 7829            len(x)
+00011950: 2066 6f72 2078 2069 6e20 7265 636f 7264   for x in record
+00011960: 2e64 6174 615b 226a 6f75 726e 616c 225d  .data["journal"]
+00011970: 2e72 6570 6c61 6365 2822 2e22 2c20 2222  .replace(".", ""
+00011980: 292e 7370 6c69 7428 2220 2229 0a20 2020  ).split(" ").   
+00011990: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
+000119a0: 2020 2020 2020 2020 2020 2069 6620 2262             if "b
+000119b0: 6f6f 6b74 6974 6c65 2220 696e 2072 6563  ooktitle" in rec
+000119c0: 6f72 642e 6461 7461 3a0a 2020 2020 2020  ord.data:.      
+000119d0: 2020 2020 2020 2020 2020 6d69 6e5f 6c65            min_le
+000119e0: 6e20 3d20 6d69 6e28 0a20 2020 2020 2020  n = min(.       
+000119f0: 2020 2020 2020 2020 2020 2020 206c 656e               len
+00011a00: 2878 2920 666f 7220 7820 696e 2072 6563  (x) for x in rec
+00011a10: 6f72 642e 6461 7461 5b22 626f 6f6b 7469  ord.data["bookti
+00011a20: 746c 6522 5d2e 7265 706c 6163 6528 222e  tle"].replace(".
+00011a30: 222c 2022 2229 2e73 706c 6974 2822 2022  ", "").split(" "
+00011a40: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00011a50: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+00011a60: 7265 7475 726e 206d 696e 5f6c 656e 0a0a  return min_len..
+00011a70: 2020 2020 2020 2020 6966 2072 6563 6f72          if recor
+00011a80: 642e 636f 6e74 6169 6e65 725f 6973 5f61  d.container_is_a
+00011a90: 6262 7265 7669 6174 6564 2829 3a0a 2020  bbreviated():.  
+00011aa0: 2020 2020 2020 2020 2020 6d69 6e5f 6c65            min_le
+00011ab0: 6e20 3d20 6765 745f 6162 6272 6576 5f63  n = get_abbrev_c
+00011ac0: 6f6e 7461 696e 6572 5f6d 696e 5f6c 656e  ontainer_min_len
+00011ad0: 2872 6563 6f72 643d 7265 636f 7264 290a  (record=record).
+00011ae0: 2020 2020 2020 2020 2020 2020 6162 6272              abbr
+00011af0: 6576 6961 7465 5f63 6f6e 7461 696e 6572  eviate_container
+00011b00: 2872 6563 6f72 643d 7265 7472 6965 7665  (record=retrieve
+00011b10: 645f 7265 636f 7264 2c20 6d69 6e5f 6c65  d_record, min_le
+00011b20: 6e3d 6d69 6e5f 6c65 6e29 0a20 2020 2020  n=min_len).     
+00011b30: 2020 2020 2020 2061 6262 7265 7669 6174         abbreviat
+00011b40: 655f 636f 6e74 6169 6e65 7228 7265 636f  e_container(reco
+00011b50: 7264 3d72 6563 6f72 642c 206d 696e 5f6c  rd=record, min_l
+00011b60: 656e 3d6d 696e 5f6c 656e 290a 2020 2020  en=min_len).    
+00011b70: 2020 2020 6966 2072 6574 7269 6576 6564      if retrieved
+00011b80: 5f72 6563 6f72 642e 636f 6e74 6169 6e65  _record.containe
+00011b90: 725f 6973 5f61 6262 7265 7669 6174 6564  r_is_abbreviated
+00011ba0: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+00011bb0: 6d69 6e5f 6c65 6e20 3d20 6765 745f 6162  min_len = get_ab
+00011bc0: 6272 6576 5f63 6f6e 7461 696e 6572 5f6d  brev_container_m
+00011bd0: 696e 5f6c 656e 2872 6563 6f72 643d 7265  in_len(record=re
+00011be0: 7472 6965 7665 645f 7265 636f 7264 290a  trieved_record).
+00011bf0: 2020 2020 2020 2020 2020 2020 6162 6272              abbr
+00011c00: 6576 6961 7465 5f63 6f6e 7461 696e 6572  eviate_container
+00011c10: 2872 6563 6f72 643d 7265 636f 7264 2c20  (record=record, 
+00011c20: 6d69 6e5f 6c65 6e3d 6d69 6e5f 6c65 6e29  min_len=min_len)
+00011c30: 0a20 2020 2020 2020 2020 2020 2061 6262  .            abb
+00011c40: 7265 7669 6174 655f 636f 6e74 6169 6e65  reviate_containe
+00011c50: 7228 7265 636f 7264 3d72 6574 7269 6576  r(record=retriev
+00011c60: 6564 5f72 6563 6f72 642c 206d 696e 5f6c  ed_record, min_l
+00011c70: 656e 3d6d 696e 5f6c 656e 290a 0a20 2020  en=min_len)..   
+00011c80: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
+00011c90: 2020 6465 6620 5f5f 7072 6570 5f72 6563    def __prep_rec
+00011ca0: 6f72 6473 5f66 6f72 5f73 696d 696c 6172  ords_for_similar
+00011cb0: 6974 7928 0a20 2020 2020 2020 2063 6c73  ity(.        cls
+00011cc0: 2c0a 2020 2020 2020 2020 2a2c 0a20 2020  ,.        *,.   
+00011cd0: 2020 2020 2072 6563 6f72 643a 2063 6f6c       record: col
+00011ce0: 7265 762e 7265 636f 7264 2e50 7265 7052  rev.record.PrepR
+00011cf0: 6563 6f72 642c 0a20 2020 2020 2020 2072  ecord,.        r
+00011d00: 6574 7269 6576 6564 5f72 6563 6f72 643a  etrieved_record:
+00011d10: 2063 6f6c 7265 762e 7265 636f 7264 2e50   colrev.record.P
+00011d20: 7265 7052 6563 6f72 642c 0a20 2020 2029  repRecord,.    )
+00011d30: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+00011d40: 2020 636c 732e 5f5f 6162 6272 6576 6961    cls.__abbrevia
+00011d50: 7465 5f63 6f6e 7461 696e 6572 5f74 6974  te_container_tit
+00011d60: 6c65 7328 0a20 2020 2020 2020 2020 2020  les(.           
+00011d70: 2072 6563 6f72 643d 7265 636f 7264 2c20   record=record, 
+00011d80: 7265 7472 6965 7665 645f 7265 636f 7264  retrieved_record
+00011d90: 3d72 6574 7269 6576 6564 5f72 6563 6f72  =retrieved_recor
+00011da0: 640a 2020 2020 2020 2020 290a 0a20 2020  d.        )..   
+00011db0: 2020 2020 2069 6620 2274 6974 6c65 2220       if "title" 
+00011dc0: 696e 2072 6563 6f72 642e 6461 7461 3a0a  in record.data:.
+00011dd0: 2020 2020 2020 2020 2020 2020 7265 636f              reco
+00011de0: 7264 2e64 6174 615b 2274 6974 6c65 225d  rd.data["title"]
+00011df0: 203d 2072 6563 6f72 642e 6461 7461 5b22   = record.data["
+00011e00: 7469 746c 6522 5d5b 3a39 305d 0a20 2020  title"][:90].   
+00011e10: 2020 2020 2069 6620 2274 6974 6c65 2220       if "title" 
+00011e20: 696e 2072 6574 7269 6576 6564 5f72 6563  in retrieved_rec
+00011e30: 6f72 642e 6461 7461 3a0a 2020 2020 2020  ord.data:.      
+00011e40: 2020 2020 2020 7265 7472 6965 7665 645f        retrieved_
+00011e50: 7265 636f 7264 2e64 6174 615b 2274 6974  record.data["tit
+00011e60: 6c65 225d 203d 2072 6574 7269 6576 6564  le"] = retrieved
+00011e70: 5f72 6563 6f72 642e 6461 7461 5b22 7469  _record.data["ti
+00011e80: 746c 6522 5d5b 3a39 305d 0a0a 2020 2020  tle"][:90]..    
+00011e90: 2020 2020 6966 2022 6175 7468 6f72 2220      if "author" 
+00011ea0: 696e 2072 6563 6f72 642e 6461 7461 3a0a  in record.data:.
+00011eb0: 2020 2020 2020 2020 2020 2020 636c 732e              cls.
+00011ec0: 5f5f 666f 726d 6174 5f61 7574 686f 7273  __format_authors
+00011ed0: 5f73 7472 696e 675f 666f 725f 636f 6d70  _string_for_comp
+00011ee0: 6172 6973 6f6e 2872 6563 6f72 643d 7265  arison(record=re
+00011ef0: 636f 7264 290a 2020 2020 2020 2020 2020  cord).          
+00011f00: 2020 7265 636f 7264 2e64 6174 615b 2261    record.data["a
+00011f10: 7574 686f 7222 5d20 3d20 7265 636f 7264  uthor"] = record
+00011f20: 2e64 6174 615b 2261 7574 686f 7222 5d5b  .data["author"][
+00011f30: 3a34 355d 0a20 2020 2020 2020 2069 6620  :45].        if 
+00011f40: 2261 7574 686f 7222 2069 6e20 7265 7472  "author" in retr
+00011f50: 6965 7665 645f 7265 636f 7264 2e64 6174  ieved_record.dat
+00011f60: 613a 0a20 2020 2020 2020 2020 2020 2063  a:.            c
+00011f70: 6c73 2e5f 5f66 6f72 6d61 745f 6175 7468  ls.__format_auth
+00011f80: 6f72 735f 7374 7269 6e67 5f66 6f72 5f63  ors_string_for_c
+00011f90: 6f6d 7061 7269 736f 6e28 7265 636f 7264  omparison(record
+00011fa0: 3d72 6574 7269 6576 6564 5f72 6563 6f72  =retrieved_recor
+00011fb0: 6429 0a20 2020 2020 2020 2020 2020 2072  d).            r
+00011fc0: 6574 7269 6576 6564 5f72 6563 6f72 642e  etrieved_record.
+00011fd0: 6461 7461 5b22 6175 7468 6f72 225d 203d  data["author"] =
+00011fe0: 2072 6574 7269 6576 6564 5f72 6563 6f72   retrieved_recor
+00011ff0: 642e 6461 7461 5b22 6175 7468 6f72 225d  d.data["author"]
+00012000: 5b3a 3435 5d0a 2020 2020 2020 2020 6966  [:45].        if
+00012010: 206e 6f74 2028 2276 6f6c 756d 6522 2069   not ("volume" i
+00012020: 6e20 7265 636f 7264 2e64 6174 6120 616e  n record.data an
+00012030: 6420 2276 6f6c 756d 6522 2069 6e20 7265  d "volume" in re
+00012040: 7472 6965 7665 645f 7265 636f 7264 2e64  trieved_record.d
+00012050: 6174 6129 3a0a 2020 2020 2020 2020 2020  ata):.          
+00012060: 2020 7265 636f 7264 2e64 6174 615b 2276    record.data["v
+00012070: 6f6c 756d 6522 5d20 3d20 226e 616e 220a  olume"] = "nan".
+00012080: 2020 2020 2020 2020 2020 2020 7265 7472              retr
+00012090: 6965 7665 645f 7265 636f 7264 2e64 6174  ieved_record.dat
+000120a0: 615b 2276 6f6c 756d 6522 5d20 3d20 226e  a["volume"] = "n
+000120b0: 616e 220a 2020 2020 2020 2020 6966 206e  an".        if n
+000120c0: 6f74 2028 226e 756d 6265 7222 2069 6e20  ot ("number" in 
+000120d0: 7265 636f 7264 2e64 6174 6120 616e 6420  record.data and 
+000120e0: 226e 756d 6265 7222 2069 6e20 7265 7472  "number" in retr
+000120f0: 6965 7665 645f 7265 636f 7264 2e64 6174  ieved_record.dat
+00012100: 6129 3a0a 2020 2020 2020 2020 2020 2020  a):.            
+00012110: 7265 636f 7264 2e64 6174 615b 226e 756d  record.data["num
+00012120: 6265 7222 5d20 3d20 226e 616e 220a 2020  ber"] = "nan".  
+00012130: 2020 2020 2020 2020 2020 7265 7472 6965            retrie
+00012140: 7665 645f 7265 636f 7264 2e64 6174 615b  ved_record.data[
+00012150: 226e 756d 6265 7222 5d20 3d20 226e 616e  "number"] = "nan
+00012160: 220a 2020 2020 2020 2020 6966 206e 6f74  ".        if not
+00012170: 2028 2270 6167 6573 2220 696e 2072 6563   ("pages" in rec
+00012180: 6f72 642e 6461 7461 2061 6e64 2022 7061  ord.data and "pa
+00012190: 6765 7322 2069 6e20 7265 7472 6965 7665  ges" in retrieve
+000121a0: 645f 7265 636f 7264 2e64 6174 6129 3a0a  d_record.data):.
+000121b0: 2020 2020 2020 2020 2020 2020 7265 636f              reco
+000121c0: 7264 2e64 6174 615b 2270 6167 6573 225d  rd.data["pages"]
+000121d0: 203d 2022 6e61 6e22 0a20 2020 2020 2020   = "nan".       
+000121e0: 2020 2020 2072 6574 7269 6576 6564 5f72       retrieved_r
+000121f0: 6563 6f72 642e 6461 7461 5b22 7061 6765  ecord.data["page
+00012200: 7322 5d20 3d20 226e 616e 220a 2020 2020  s"] = "nan".    
+00012210: 2020 2020 2320 536f 6d65 7469 6d65 732c      # Sometimes,
+00012220: 2074 6865 206e 756d 6265 7220 6f66 2070   the number of p
+00012230: 6167 6573 2069 7320 7072 6f76 6964 6564  ages is provided
+00012240: 2028 6e6f 7420 7468 6520 7261 6e67 6529   (not the range)
+00012250: 0a20 2020 2020 2020 2065 6c69 6620 6e6f  .        elif no
+00012260: 7420 280a 2020 2020 2020 2020 2020 2020  t (.            
+00012270: 222d 2d22 2069 6e20 7265 636f 7264 2e64  "--" in record.d
+00012280: 6174 615b 2270 6167 6573 225d 2061 6e64  ata["pages"] and
+00012290: 2022 2d2d 2220 696e 2072 6574 7269 6576   "--" in retriev
+000122a0: 6564 5f72 6563 6f72 642e 6461 7461 5b22  ed_record.data["
+000122b0: 7061 6765 7322 5d0a 2020 2020 2020 2020  pages"].        
+000122c0: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
+000122d0: 6563 6f72 642e 6461 7461 5b22 7061 6765  ecord.data["page
+000122e0: 7322 5d20 3d20 226e 616e 220a 2020 2020  s"] = "nan".    
+000122f0: 2020 2020 2020 2020 7265 7472 6965 7665          retrieve
+00012300: 645f 7265 636f 7264 2e64 6174 615b 2270  d_record.data["p
+00012310: 6167 6573 225d 203d 2022 6e61 6e22 0a0a  ages"] = "nan"..
+00012320: 2020 2020 2020 2020 6966 2022 7965 6172          if "year
+00012330: 2220 696e 2072 6563 6f72 642e 6461 7461  " in record.data
+00012340: 2061 6e64 2022 7965 6172 2220 696e 2072   and "year" in r
+00012350: 6574 7269 6576 6564 5f72 6563 6f72 642e  etrieved_record.
+00012360: 6461 7461 3a0a 2020 2020 2020 2020 2020  data:.          
+00012370: 2020 6966 2072 6563 6f72 642e 6461 7461    if record.data
+00012380: 5b22 7965 6172 225d 203d 3d20 2266 6f72  ["year"] == "for
+00012390: 7468 636f 6d69 6e67 223a 0a20 2020 2020  thcoming":.     
+000123a0: 2020 2020 2020 2020 2020 2072 6563 6f72             recor
+000123b0: 642e 6461 7461 5b22 7965 6172 225d 203d  d.data["year"] =
+000123c0: 2072 6574 7269 6576 6564 5f72 6563 6f72   retrieved_recor
+000123d0: 642e 6461 7461 5b22 7965 6172 225d 0a20  d.data["year"]. 
+000123e0: 2020 2020 2020 2020 2020 2069 6620 7265             if re
+000123f0: 7472 6965 7665 645f 7265 636f 7264 2e64  trieved_record.d
+00012400: 6174 615b 2279 6561 7222 5d20 3d3d 2022  ata["year"] == "
+00012410: 666f 7274 6863 6f6d 696e 6722 3a0a 2020  forthcoming":.  
+00012420: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00012430: 7472 6965 7665 645f 7265 636f 7264 2e64  trieved_record.d
+00012440: 6174 615b 2279 6561 7222 5d20 3d20 7265  ata["year"] = re
+00012450: 636f 7264 2e64 6174 615b 2279 6561 7222  cord.data["year"
+00012460: 5d0a 0a20 2020 2040 636c 6173 736d 6574  ]..    @classmet
+00012470: 686f 640a 2020 2020 6465 6620 6765 745f  hod.    def get_
+00012480: 7265 7472 6965 7661 6c5f 7369 6d69 6c61  retrieval_simila
+00012490: 7269 7479 280a 2020 2020 2020 2020 636c  rity(.        cl
+000124a0: 732c 0a20 2020 2020 2020 202a 2c0a 2020  s,.        *,.  
+000124b0: 2020 2020 2020 7265 636f 7264 5f6f 7269        record_ori
+000124c0: 6769 6e61 6c3a 2052 6563 6f72 642c 0a20  ginal: Record,. 
+000124d0: 2020 2020 2020 2072 6574 7269 6576 6564         retrieved
+000124e0: 5f72 6563 6f72 645f 6f72 6967 696e 616c  _record_original
+000124f0: 3a20 5265 636f 7264 2c0a 2020 2020 2020  : Record,.      
+00012500: 2020 7361 6d65 5f72 6563 6f72 645f 7479    same_record_ty
+00012510: 7065 5f72 6571 7569 7265 643a 2062 6f6f  pe_required: boo
+00012520: 6c20 3d20 5472 7565 2c0a 2020 2020 2920  l = True,.    ) 
+00012530: 2d3e 2066 6c6f 6174 3a0a 2020 2020 2020  -> float:.      
+00012540: 2020 2222 2247 6574 2074 6865 2072 6574    """Get the ret
+00012550: 7269 6576 616c 2073 696d 696c 6172 6974  rieval similarit
+00012560: 7920 6265 7477 6565 6e20 7468 6520 7265  y between the re
+00012570: 636f 7264 2061 6e64 2061 2072 6574 7269  cord and a retri
+00012580: 6576 6564 2072 6563 6f72 6422 2222 0a0a  eved record"""..
+00012590: 2020 2020 2020 2020 6966 2073 616d 655f          if same_
+000125a0: 7265 636f 7264 5f74 7970 655f 7265 7175  record_type_requ
+000125b0: 6972 6564 3a0a 2020 2020 2020 2020 2020  ired:.          
+000125c0: 2020 6966 2072 6563 6f72 645f 6f72 6967    if record_orig
+000125d0: 696e 616c 2e64 6174 612e 6765 7428 0a20  inal.data.get(. 
+000125e0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+000125f0: 454e 5452 5954 5950 4522 2c20 2261 220a  ENTRYTYPE", "a".
+00012600: 2020 2020 2020 2020 2020 2020 2920 213d              ) !=
+00012610: 2072 6574 7269 6576 6564 5f72 6563 6f72   retrieved_recor
+00012620: 645f 6f72 6967 696e 616c 2e64 6174 612e  d_original.data.
+00012630: 6765 7428 2245 4e54 5259 5459 5045 222c  get("ENTRYTYPE",
+00012640: 2022 6222 293a 0a20 2020 2020 2020 2020   "b"):.         
+00012650: 2020 2020 2020 2072 6574 7572 6e20 302e         return 0.
+00012660: 300a 0a20 2020 2020 2020 2072 6563 6f72  0..        recor
+00012670: 6420 3d20 7265 636f 7264 5f6f 7269 6769  d = record_origi
+00012680: 6e61 6c2e 636f 7079 5f70 7265 705f 7265  nal.copy_prep_re
+00012690: 6328 290a 2020 2020 2020 2020 7265 7472  c().        retr
+000126a0: 6965 7665 645f 7265 636f 7264 203d 2072  ieved_record = r
+000126b0: 6574 7269 6576 6564 5f72 6563 6f72 645f  etrieved_record_
+000126c0: 6f72 6967 696e 616c 2e63 6f70 795f 7072  original.copy_pr
+000126d0: 6570 5f72 6563 2829 0a0a 2020 2020 2020  ep_rec()..      
+000126e0: 2020 636c 732e 5f5f 7072 6570 5f72 6563    cls.__prep_rec
+000126f0: 6f72 6473 5f66 6f72 5f73 696d 696c 6172  ords_for_similar
+00012700: 6974 7928 0a20 2020 2020 2020 2020 2020  ity(.           
+00012710: 2072 6563 6f72 643d 7265 636f 7264 2c20   record=record, 
+00012720: 7265 7472 6965 7665 645f 7265 636f 7264  retrieved_record
+00012730: 3d72 6574 7269 6576 6564 5f72 6563 6f72  =retrieved_recor
+00012740: 640a 2020 2020 2020 2020 290a 0a20 2020  d.        )..   
+00012750: 2020 2020 2069 6620 2265 6469 746f 7269       if "editori
+00012760: 616c 2220 696e 2072 6563 6f72 642e 6461  al" in record.da
+00012770: 7461 2e67 6574 2822 7469 746c 6522 2c20  ta.get("title", 
+00012780: 224e 4122 292e 6c6f 7765 7228 293a 0a20  "NA").lower():. 
+00012790: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+000127a0: 7420 616c 6c28 7820 696e 2072 6563 6f72  t all(x in recor
+000127b0: 642e 6461 7461 2066 6f72 2078 2069 6e20  d.data for x in 
+000127c0: 5b22 766f 6c75 6d65 222c 2022 6e75 6d62  ["volume", "numb
+000127d0: 6572 225d 293a 0a20 2020 2020 2020 2020  er"]):.         
+000127e0: 2020 2020 2020 2072 6574 7572 6e20 302e         return 0.
+000127f0: 300a 0a20 2020 2020 2020 2073 696d 696c  0..        simil
+00012800: 6172 6974 7920 3d20 5265 636f 7264 2e67  arity = Record.g
+00012810: 6574 5f72 6563 6f72 645f 7369 6d69 6c61  et_record_simila
+00012820: 7269 7479 280a 2020 2020 2020 2020 2020  rity(.          
+00012830: 2020 7265 636f 7264 5f61 3d72 6563 6f72    record_a=recor
+00012840: 642c 2072 6563 6f72 645f 623d 7265 7472  d, record_b=retr
+00012850: 6965 7665 645f 7265 636f 7264 0a20 2020  ieved_record.   
+00012860: 2020 2020 2029 0a20 2020 2020 2020 2072       ).        r
+00012870: 6574 7572 6e20 7369 6d69 6c61 7269 7479  eturn similarity
+00012880: 0a0a 2020 2020 6465 6620 666f 726d 6174  ..    def format
+00012890: 5f69 665f 6d6f 7374 6c79 5f75 7070 6572  _if_mostly_upper
+000128a0: 2873 656c 662c 202a 2c20 6b65 793a 2073  (self, *, key: s
+000128b0: 7472 2c20 6361 7365 3a20 7374 7220 3d20  tr, case: str = 
+000128c0: 2273 656e 7465 6e63 6522 2920 2d3e 204e  "sentence") -> N
+000128d0: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
+000128e0: 466f 726d 6174 2074 6865 2066 6965 6c64  Format the field
+000128f0: 2069 6620 6974 2069 7320 6d6f 7374 6c79   if it is mostly
+00012900: 2069 6e20 7570 7065 7220 6361 7365 2222   in upper case""
+00012910: 220a 0a20 2020 2020 2020 2069 6620 6b65  "..        if ke
+00012920: 7920 6e6f 7420 696e 2073 656c 662e 6461  y not in self.da
+00012930: 7461 206f 7220 7365 6c66 2e64 6174 615b  ta or self.data[
+00012940: 6b65 795d 203d 3d20 2255 4e4b 4e4f 574e  key] == "UNKNOWN
+00012950: 223a 0a20 2020 2020 2020 2020 2020 2072  ":.            r
+00012960: 6574 7572 6e0a 0a20 2020 2020 2020 2069  eturn..        i
+00012970: 6620 636f 6c72 6576 2e65 6e76 2e75 7469  f colrev.env.uti
+00012980: 6c73 2e70 6572 6365 6e74 5f75 7070 6572  ls.percent_upper
+00012990: 5f63 6861 7273 2873 656c 662e 6461 7461  _chars(self.data
+000129a0: 5b6b 6579 5d29 203c 2030 2e36 3a0a 2020  [key]) < 0.6:.  
+000129b0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+000129c0: 0a0a 2020 2020 2020 2020 2320 4e6f 7465  ..        # Note
+000129d0: 3a20 7468 6520 7472 7565 6361 7365 2070  : the truecase p
+000129e0: 6163 6b61 6765 2069 7320 6e6f 7420 7665  ackage is not ve
+000129f0: 7279 2072 656c 6961 626c 6520 2879 6574  ry reliable (yet
+00012a00: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+00012a10: 6461 7461 5b6b 6579 5d20 3d20 7365 6c66  data[key] = self
+00012a20: 2e64 6174 615b 6b65 795d 2e72 6570 6c61  .data[key].repla
+00012a30: 6365 2822 5c6e 222c 2022 2022 290a 0a20  ce("\n", " ").. 
+00012a40: 2020 2020 2020 2069 6620 6361 7365 203d         if case =
+00012a50: 3d20 2273 656e 7465 6e63 6522 3a0a 2020  = "sentence":.  
+00012a60: 2020 2020 2020 2020 2020 7365 6c66 2e64            self.d
+00012a70: 6174 615b 6b65 795d 203d 2073 656c 662e  ata[key] = self.
+00012a80: 6461 7461 5b6b 6579 5d2e 6361 7069 7461  data[key].capita
+00012a90: 6c69 7a65 2829 0a20 2020 2020 2020 2065  lize().        e
+00012aa0: 6c69 6620 6361 7365 203d 3d20 2274 6974  lif case == "tit
+00012ab0: 6c65 223a 0a20 2020 2020 2020 2020 2020  le":.           
+00012ac0: 2073 656c 662e 6461 7461 5b6b 6579 5d20   self.data[key] 
+00012ad0: 3d20 7365 6c66 2e64 6174 615b 6b65 795d  = self.data[key]
+00012ae0: 2e74 6974 6c65 2829 0a20 2020 2020 2020  .title().       
+00012af0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00012b00: 2020 2072 6169 7365 2063 6f6c 7265 765f     raise colrev_
+00012b10: 6578 6365 7074 696f 6e73 2e50 6172 616d  exceptions.Param
+00012b20: 6574 6572 4572 726f 7228 0a20 2020 2020  eterError(.     
+00012b30: 2020 2020 2020 2020 2020 2070 6172 616d             param
+00012b40: 6574 6572 3d22 6361 7365 222c 2076 616c  eter="case", val
+00012b50: 7565 3d63 6173 652c 206f 7074 696f 6e73  ue=case, options
+00012b60: 3d5b 2273 656e 7465 6e63 6522 2c20 2274  =["sentence", "t
+00012b70: 6974 6c65 225d 0a20 2020 2020 2020 2020  itle"].         
+00012b80: 2020 2029 0a0a 2020 2020 2020 2020 7365     )..        se
+00012b90: 6c66 2e64 6174 615b 6b65 795d 203d 2070  lf.data[key] = p
+00012ba0: 7265 705f 7574 696c 732e 6361 7069 7461  rep_utils.capita
+00012bb0: 6c69 7a65 5f65 6e74 6974 6965 7328 7365  lize_entities(se
+00012bc0: 6c66 2e64 6174 615b 6b65 795d 290a 0a20  lf.data[key]).. 
+00012bd0: 2020 2020 2020 2069 6620 6b65 7920 696e         if key in
+00012be0: 2073 656c 662e 6461 7461 2e67 6574 2822   self.data.get("
+00012bf0: 636f 6c72 6576 5f6d 6173 7465 7264 6174  colrev_masterdat
+00012c00: 615f 7072 6f76 656e 616e 6365 222c 207b  a_provenance", {
+00012c10: 7d29 3a0a 2020 2020 2020 2020 2020 2020  }):.            
+00012c20: 6e6f 7465 203d 2073 656c 662e 6461 7461  note = self.data
+00012c30: 5b22 636f 6c72 6576 5f6d 6173 7465 7264  ["colrev_masterd
+00012c40: 6174 615f 7072 6f76 656e 616e 6365 225d  ata_provenance"]
+00012c50: 5b6b 6579 5d5b 226e 6f74 6522 5d0a 2020  [key]["note"].  
+00012c60: 2020 2020 2020 2020 2020 6966 2022 7175            if "qu
+00012c70: 616c 6974 795f 6465 6665 6374 2220 696e  ality_defect" in
+00012c80: 206e 6f74 653a 0a20 2020 2020 2020 2020   note:.         
+00012c90: 2020 2020 2020 2073 656c 662e 6461 7461         self.data
+00012ca0: 5b22 636f 6c72 6576 5f6d 6173 7465 7264  ["colrev_masterd
+00012cb0: 6174 615f 7072 6f76 656e 616e 6365 225d  ata_provenance"]
+00012cc0: 5b6b 6579 5d5b 226e 6f74 6522 5d20 3d20  [key]["note"] = 
+00012cd0: 6e6f 7465 2e72 6570 6c61 6365 280a 2020  note.replace(.  
+00012ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012cf0: 2020 2271 7561 6c69 7479 5f64 6566 6563    "quality_defec
+00012d00: 7422 2c20 2222 0a20 2020 2020 2020 2020  t", "".         
+00012d10: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
+00012d20: 6620 7265 6e61 6d65 5f66 6965 6c64 735f  f rename_fields_
+00012d30: 6261 7365 645f 6f6e 5f6d 6170 7069 6e67  based_on_mapping
+00012d40: 2873 656c 662c 202a 2c20 6d61 7070 696e  (self, *, mappin
+00012d50: 673a 2064 6963 7429 202d 3e20 4e6f 6e65  g: dict) -> None
+00012d60: 3a0a 2020 2020 2020 2020 2222 2243 6f6e  :.        """Con
+00012d70: 7665 6e69 656e 6365 2066 756e 6374 696f  venience functio
+00012d80: 6e20 666f 7220 7468 6520 7072 6570 2073  n for the prep s
+00012d90: 6372 6970 7473 2028 746f 2072 656e 616d  cripts (to renam
+00012da0: 6520 6669 656c 6473 2922 2222 0a0a 2020  e fields)"""..  
+00012db0: 2020 2020 2020 6d61 7070 696e 6720 3d20        mapping = 
+00012dc0: 7b6b 2e6c 6f77 6572 2829 3a20 762e 6c6f  {k.lower(): v.lo
+00012dd0: 7765 7228 2920 666f 7220 6b2c 2076 2069  wer() for k, v i
+00012de0: 6e20 6d61 7070 696e 672e 6974 656d 7328  n mapping.items(
+00012df0: 297d 0a20 2020 2020 2020 2070 7269 6f72  )}.        prior
+00012e00: 5f6b 6579 7320 3d20 6c69 7374 2873 656c  _keys = list(sel
+00012e10: 662e 6461 7461 2e6b 6579 7328 2929 0a20  f.data.keys()). 
+00012e20: 2020 2020 2020 2023 204e 6f74 6520 3a20         # Note : 
+00012e30: 7761 726e 696e 673a 2064 6f20 6e6f 7420  warning: do not 
+00012e40: 6372 6561 7465 2061 206e 6577 2064 6963  create a new dic
+00012e50: 742e 0a20 2020 2020 2020 2066 6f72 206b  t..        for k
+00012e60: 6579 2069 6e20 7072 696f 725f 6b65 7973  ey in prior_keys
+00012e70: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+00012e80: 206b 6579 2e6c 6f77 6572 2829 2069 6e20   key.lower() in 
+00012e90: 6d61 7070 696e 673a 0a20 2020 2020 2020  mapping:.       
+00012ea0: 2020 2020 2020 2020 2073 656c 662e 7265           self.re
+00012eb0: 6e61 6d65 5f66 6965 6c64 286b 6579 3d6b  name_field(key=k
+00012ec0: 6579 2c20 6e65 775f 6b65 793d 6d61 7070  ey, new_key=mapp
+00012ed0: 696e 675b 6b65 792e 6c6f 7765 7228 295d  ing[key.lower()]
+00012ee0: 290a 0a20 2020 2064 6566 2075 6e69 6679  )..    def unify
+00012ef0: 5f70 6167 6573 5f66 6965 6c64 2873 656c  _pages_field(sel
+00012f00: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
+00012f10: 2020 2020 2222 2255 6e69 6679 2074 6865      """Unify the
+00012f20: 2066 6f72 6d61 7420 6f66 2074 6865 2070   format of the p
+00012f30: 6167 6520 6669 656c 6422 2222 0a20 2020  age field""".   
+00012f40: 2020 2020 2069 6620 2270 6167 6573 2220       if "pages" 
+00012f50: 6e6f 7420 696e 2073 656c 662e 6461 7461  not in self.data
+00012f60: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00012f70: 7475 726e 0a20 2020 2020 2020 2069 6620  turn.        if 
+00012f80: 6e6f 7420 6973 696e 7374 616e 6365 2873  not isinstance(s
+00012f90: 656c 662e 6461 7461 5b22 7061 6765 7322  elf.data["pages"
+00012fa0: 5d2c 2073 7472 293a 0a20 2020 2020 2020  ], str):.       
+00012fb0: 2020 2020 2072 6574 7572 6e0a 2020 2020       return.    
+00012fc0: 2020 2020 6966 2031 203d 3d20 7365 6c66      if 1 == self
+00012fd0: 2e64 6174 615b 2270 6167 6573 225d 2e63  .data["pages"].c
+00012fe0: 6f75 6e74 2822 2d22 293a 0a20 2020 2020  ount("-"):.     
+00012ff0: 2020 2020 2020 2073 656c 662e 6461 7461         self.data
+00013000: 5b22 7061 6765 7322 5d20 3d20 7365 6c66  ["pages"] = self
+00013010: 2e64 6174 615b 2270 6167 6573 225d 2e72  .data["pages"].r
+00013020: 6570 6c61 6365 2822 2d22 2c20 222d 2d22  eplace("-", "--"
+00013030: 290a 2020 2020 2020 2020 7365 6c66 2e64  ).        self.d
+00013040: 6174 615b 2270 6167 6573 225d 203d 2028  ata["pages"] = (
+00013050: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00013060: 662e 6461 7461 5b22 7061 6765 7322 5d0a  f.data["pages"].
+00013070: 2020 2020 2020 2020 2020 2020 2e72 6570              .rep
+00013080: 6c61 6365 2822 e280 9322 2c20 222d 2d22  lace("...", "--"
+00013090: 290a 2020 2020 2020 2020 2020 2020 2e72  ).            .r
+000130a0: 6570 6c61 6365 2822 2d2d 2d2d 222c 2022  eplace("----", "
+000130b0: 2d2d 2229 0a20 2020 2020 2020 2020 2020  --").           
+000130c0: 202e 7265 706c 6163 6528 2220 2d2d 2022   .replace(" -- "
+000130d0: 2c20 222d 2d22 290a 2020 2020 2020 2020  , "--").        
+000130e0: 2020 2020 2e72 7374 7269 7028 222e 2229      .rstrip(".")
+000130f0: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
+00013100: 2020 2069 6620 7265 2e6d 6174 6368 2872     if re.match(r
+00013110: 225e 5c64 2b5c 2d5c 2d5c 642b 2422 2c20  "^\d+\-\-\d+$", 
+00013120: 7365 6c66 2e64 6174 615b 2270 6167 6573  self.data["pages
+00013130: 225d 293a 0a20 2020 2020 2020 2020 2020  "]):.           
+00013140: 2066 726f 6d5f 7061 6765 2c20 746f 5f70   from_page, to_p
+00013150: 6167 6520 3d20 7265 2e66 696e 6461 6c6c  age = re.findall
+00013160: 2872 2228 5c64 2b29 222c 2073 656c 662e  (r"(\d+)", self.
+00013170: 6461 7461 5b22 7061 6765 7322 5d29 0a20  data["pages"]). 
+00013180: 2020 2020 2020 2020 2020 2069 6620 696e             if in
+00013190: 7428 6672 6f6d 5f70 6167 6529 203e 2069  t(from_page) > i
+000131a0: 6e74 2874 6f5f 7061 6765 2920 616e 6420  nt(to_page) and 
+000131b0: 6c65 6e28 6672 6f6d 5f70 6167 6529 203e  len(from_page) >
+000131c0: 206c 656e 2874 6f5f 7061 6765 293a 0a20   len(to_page):. 
+000131d0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000131e0: 656c 662e 6461 7461 5b0a 2020 2020 2020  elf.data[.      
+000131f0: 2020 2020 2020 2020 2020 2020 2020 2270                "p
+00013200: 6167 6573 220a 2020 2020 2020 2020 2020  ages".          
+00013210: 2020 2020 2020 5d20 3d20 6622 7b66 726f        ] = f"{fro
+00013220: 6d5f 7061 6765 7d2d 2d7b 6672 6f6d 5f70  m_page}--{from_p
+00013230: 6167 655b 3a2d 6c65 6e28 746f 5f70 6167  age[:-len(to_pag
+00013240: 6529 5d7d 7b74 6f5f 7061 6765 7d22 0a0a  e)]}{to_page}"..
+00013250: 2020 2020 6465 6620 7072 6570 6172 6174      def preparat
+00013260: 696f 6e5f 7361 7665 5f63 6f6e 6469 7469  ion_save_conditi
+00013270: 6f6e 2873 656c 6629 202d 3e20 626f 6f6c  on(self) -> bool
+00013280: 3a0a 2020 2020 2020 2020 2222 2243 6865  :.        """Che
+00013290: 636b 2077 6865 7468 6572 2074 6865 2073  ck whether the s
+000132a0: 6176 6520 636f 6e64 6974 696f 6e20 666f  ave condition fo
+000132b0: 7220 7468 6520 7072 6570 206f 7065 7261  r the prep opera
+000132c0: 7469 6f6e 2069 7320 6769 7665 6e22 2222  tion is given"""
+000132d0: 0a0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
+000132e0: 662e 6461 7461 2e67 6574 2822 636f 6c72  f.data.get("colr
+000132f0: 6576 5f73 7461 7475 7322 2c20 224e 4122  ev_status", "NA"
+00013300: 2920 696e 205b 0a20 2020 2020 2020 2020  ) in [.         
+00013310: 2020 2052 6563 6f72 6453 7461 7465 2e72     RecordState.r
+00013320: 6576 5f70 7265 7363 7265 656e 5f65 7863  ev_prescreen_exc
+00013330: 6c75 6465 642c 0a20 2020 2020 2020 2020  luded,.         
+00013340: 2020 2052 6563 6f72 6453 7461 7465 2e6d     RecordState.m
+00013350: 645f 7072 6570 6172 6564 2c0a 2020 2020  d_prepared,.    
+00013360: 2020 2020 5d3a 0a20 2020 2020 2020 2020      ]:.         
+00013370: 2020 2072 6574 7572 6e20 5472 7565 0a0a     return True..
+00013380: 2020 2020 2020 2020 6966 2061 6e79 280a          if any(.
+00013390: 2020 2020 2020 2020 2020 2020 2264 6973              "dis
+000133a0: 6167 7265 656d 656e 7420 7769 7468 2022  agreement with "
+000133b0: 2069 6e20 785b 226e 6f74 6522 5d0a 2020   in x["note"].  
+000133c0: 2020 2020 2020 2020 2020 666f 7220 7820            for x 
+000133d0: 696e 2073 656c 662e 6461 7461 2e67 6574  in self.data.get
+000133e0: 2822 636f 6c72 6576 5f6d 6173 7465 7264  ("colrev_masterd
+000133f0: 6174 615f 7072 6f76 656e 616e 6365 222c  ata_provenance",
+00013400: 207b 7d29 2e76 616c 7565 7328 290a 2020   {}).values().  
+00013410: 2020 2020 2020 2920 6f72 2061 6e79 280a        ) or any(.
+00013420: 2020 2020 2020 2020 2020 2020 2272 6563              "rec
+00013430: 6f72 645f 6e6f 745f 696e 5f74 6f63 2220  ord_not_in_toc" 
+00013440: 696e 2078 5b22 6e6f 7465 225d 0a20 2020  in x["note"].   
+00013450: 2020 2020 2020 2020 2066 6f72 2078 2069           for x i
+00013460: 6e20 7365 6c66 2e64 6174 612e 6765 7428  n self.data.get(
+00013470: 2263 6f6c 7265 765f 6d61 7374 6572 6461  "colrev_masterda
+00013480: 7461 5f70 726f 7665 6e61 6e63 6522 2c20  ta_provenance", 
+00013490: 7b7d 292e 7661 6c75 6573 2829 0a20 2020  {}).values().   
+000134a0: 2020 2020 2029 3a0a 2020 2020 2020 2020       ):.        
+000134b0: 2020 2020 7265 7475 726e 2054 7275 650a      return True.
+000134c0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000134d0: 4661 6c73 650a 0a20 2020 2064 6566 2070  False..    def p
+000134e0: 7265 7061 7261 7469 6f6e 5f62 7265 616b  reparation_break
+000134f0: 5f63 6f6e 6469 7469 6f6e 2873 656c 6629  _condition(self)
+00013500: 202d 3e20 626f 6f6c 3a0a 2020 2020 2020   -> bool:.      
+00013510: 2020 2222 2243 6865 636b 2077 6865 7468    """Check wheth
+00013520: 6572 2074 6865 2062 7265 616b 2063 6f6e  er the break con
+00013530: 6469 7469 6f6e 2066 6f72 2074 6865 2070  dition for the p
+00013540: 7265 7020 6f70 6572 6174 696f 6e20 6973  rep operation is
+00013550: 2067 6976 656e 2222 220a 2020 2020 2020   given""".      
+00013560: 2020 6966 2061 6e79 280a 2020 2020 2020    if any(.      
+00013570: 2020 2020 2020 2264 6973 6167 7265 656d        "disagreem
+00013580: 656e 7420 7769 7468 2022 2069 6e20 785b  ent with " in x[
+00013590: 226e 6f74 6522 5d0a 2020 2020 2020 2020  "note"].        
+000135a0: 2020 2020 666f 7220 7820 696e 2073 656c      for x in sel
+000135b0: 662e 6461 7461 2e67 6574 2822 636f 6c72  f.data.get("colr
+000135c0: 6576 5f6d 6173 7465 7264 6174 615f 7072  ev_masterdata_pr
+000135d0: 6f76 656e 616e 6365 222c 207b 7d29 2e76  ovenance", {}).v
+000135e0: 616c 7565 7328 290a 2020 2020 2020 2020  alues().        
+000135f0: 2920 6f72 2061 6e79 280a 2020 2020 2020  ) or any(.      
+00013600: 2020 2020 2020 2272 6563 6f72 645f 6e6f        "record_no
+00013610: 745f 696e 5f74 6f63 2220 696e 2078 5b22  t_in_toc" in x["
+00013620: 6e6f 7465 225d 0a20 2020 2020 2020 2020  note"].         
+00013630: 2020 2066 6f72 2078 2069 6e20 7365 6c66     for x in self
+00013640: 2e64 6174 612e 6765 7428 2263 6f6c 7265  .data.get("colre
+00013650: 765f 6d61 7374 6572 6461 7461 5f70 726f  v_masterdata_pro
+00013660: 7665 6e61 6e63 6522 2c20 7b7d 292e 7661  venance", {}).va
+00013670: 6c75 6573 2829 0a20 2020 2020 2020 2029  lues().        )
+00013680: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00013690: 7475 726e 2054 7275 650a 0a20 2020 2020  turn True..     
+000136a0: 2020 2069 6620 7365 6c66 2e64 6174 612e     if self.data.
+000136b0: 6765 7428 2263 6f6c 7265 765f 7374 6174  get("colrev_stat
+000136c0: 7573 222c 2022 4e41 2229 2069 6e20 5b0a  us", "NA") in [.
+000136d0: 2020 2020 2020 2020 2020 2020 5265 636f              Reco
+000136e0: 7264 5374 6174 652e 7265 765f 7072 6573  rdState.rev_pres
+000136f0: 6372 6565 6e5f 6578 636c 7564 6564 2c0a  creen_excluded,.
+00013700: 2020 2020 2020 2020 5d3a 0a20 2020 2020          ]:.     
+00013710: 2020 2020 2020 2072 6574 7572 6e20 5472         return Tr
+00013720: 7565 0a20 2020 2020 2020 2072 6574 7572  ue.        retur
+00013730: 6e20 4661 6c73 650a 0a20 2020 2064 6566  n False..    def
+00013740: 2073 7461 7475 735f 746f 5f70 7265 7061   status_to_prepa
+00013750: 7265 2873 656c 6629 202d 3e20 626f 6f6c  re(self) -> bool
+00013760: 3a0a 2020 2020 2020 2020 2222 2243 6865  :.        """Che
+00013770: 636b 2077 6865 7468 6572 2074 6865 2072  ck whether the r
+00013780: 6563 6f72 6420 6e65 6564 7320 746f 2062  ecord needs to b
+00013790: 6520 7072 6570 6172 6564 2222 220a 2020  e prepared""".  
+000137a0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+000137b0: 662e 6461 7461 2e67 6574 2822 636f 6c72  f.data.get("colr
+000137c0: 6576 5f73 7461 7475 7322 2c20 224e 4122  ev_status", "NA"
+000137d0: 2920 696e 205b 0a20 2020 2020 2020 2020  ) in [.         
+000137e0: 2020 2052 6563 6f72 6453 7461 7465 2e6d     RecordState.m
+000137f0: 645f 6e65 6564 735f 6d61 6e75 616c 5f70  d_needs_manual_p
+00013800: 7265 7061 7261 7469 6f6e 2c0a 2020 2020  reparation,.    
+00013810: 2020 2020 2020 2020 5265 636f 7264 5374          RecordSt
+00013820: 6174 652e 6d64 5f69 6d70 6f72 7465 642c  ate.md_imported,
+00013830: 0a20 2020 2020 2020 2020 2020 2052 6563  .            Rec
+00013840: 6f72 6453 7461 7465 2e6d 645f 7072 6570  ordState.md_prep
+00013850: 6172 6564 2c0a 2020 2020 2020 2020 5d0a  ared,.        ].
+00013860: 0a20 2020 2064 6566 2075 7064 6174 655f  .    def update_
+00013870: 6d65 7461 6461 7461 5f73 7461 7475 7328  metadata_status(
+00013880: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
+00013890: 2020 2029 202d 3e20 4e6f 6e65 3a0a 2020     ) -> None:.  
+000138a0: 2020 2020 2020 2222 2255 7064 6174 6520        """Update 
+000138b0: 7468 6520 6d65 7461 6461 7461 2073 7461  the metadata sta
+000138c0: 7475 7320 2872 6574 7261 6374 732c 2069  tus (retracts, i
+000138d0: 6e63 6f6d 706c 6574 656e 6573 732c 2069  ncompleteness, i
+000138e0: 6e63 6f6e 7369 7374 656e 6369 6573 2c20  nconsistencies, 
+000138f0: 6574 632e 290a 2020 2020 2020 2020 616e  etc.).        an
+00013900: 6420 7365 7474 696e 6720 7468 6520 7374  d setting the st
+00013910: 6174 7573 2061 6363 6f72 6469 6e67 6c79  atus accordingly
+00013920: 2222 220a 0a20 2020 2020 2020 2073 656c  """..        sel
+00013930: 662e 6368 6563 6b5f 706f 7465 6e74 6961  f.check_potentia
+00013940: 6c5f 7265 7472 6163 7473 2829 0a0a 2020  l_retracts()..  
+00013950: 2020 2020 2020 6966 2028 0a20 2020 2020        if (.     
+00013960: 2020 2020 2020 2063 6f6c 7265 762e 7265         colrev.re
+00013970: 636f 7264 2e52 6563 6f72 6453 7461 7465  cord.RecordState
+00013980: 2e72 6576 5f70 7265 7363 7265 656e 5f65  .rev_prescreen_e
+00013990: 7863 6c75 6465 640a 2020 2020 2020 2020  xcluded.        
+000139a0: 2020 2020 3d3d 2073 656c 662e 6461 7461      == self.data
+000139b0: 5b22 636f 6c72 6576 5f73 7461 7475 7322  ["colrev_status"
+000139c0: 5d0a 2020 2020 2020 2020 293a 0a20 2020  ].        ):.   
+000139d0: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
+000139e0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+000139f0: 2e6d 6173 7465 7264 6174 615f 6973 5f63  .masterdata_is_c
+00013a00: 7572 6174 6564 2829 3a0a 2020 2020 2020  urated():.      
+00013a10: 2020 2020 2020 7365 6c66 2e73 6574 5f73        self.set_s
+00013a20: 7461 7475 7328 7461 7267 6574 5f73 7461  tatus(target_sta
+00013a30: 7465 3d52 6563 6f72 6453 7461 7465 2e6d  te=RecordState.m
+00013a40: 645f 7072 6570 6172 6564 290a 2020 2020  d_prepared).    
+00013a50: 2020 2020 2020 2020 7265 7475 726e 0a0a          return..
+00013a60: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00013a70: 6861 735f 7175 616c 6974 795f 6465 6665  has_quality_defe
+00013a80: 6374 7328 293a 0a20 2020 2020 2020 2020  cts():.         
+00013a90: 2020 2073 656c 662e 7365 745f 7374 6174     self.set_stat
+00013aa0: 7573 2874 6172 6765 745f 7374 6174 653d  us(target_state=
+00013ab0: 5265 636f 7264 5374 6174 652e 6d64 5f6e  RecordState.md_n
+00013ac0: 6565 6473 5f6d 616e 7561 6c5f 7072 6570  eeds_manual_prep
+00013ad0: 6172 6174 696f 6e29 0a20 2020 2020 2020  aration).       
+00013ae0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00013af0: 2020 2073 656c 662e 7365 745f 7374 6174     self.set_stat
+00013b00: 7573 2874 6172 6765 745f 7374 6174 653d  us(target_state=
+00013b10: 5265 636f 7264 5374 6174 652e 6d64 5f70  RecordState.md_p
+00013b20: 7265 7061 7265 6429 0a0a 0a63 6c61 7373  repared)...class
+00013b30: 2052 6563 6f72 6453 7461 7465 2845 6e75   RecordState(Enu
+00013b40: 6d29 3a0a 2020 2020 2222 2254 6865 2070  m):.    """The p
+00013b50: 6f73 7369 626c 6520 5265 636f 7264 5374  ossible RecordSt
+00013b60: 6174 6573 2073 746f 7265 6420 696e 2074  ates stored in t
+00013b70: 6865 2063 6f6c 7265 765f 7374 6174 7573  he colrev_status
+00013b80: 2066 6965 6c64 0a20 2020 2028 636f 7272   field.    (corr
+00013b90: 6573 706f 6e64 696e 6720 746f 2074 6865  esponding to the
+00013ba0: 2052 6563 6f72 6453 7461 7465 4d6f 6465   RecordStateMode
+00013bb0: 6c29 2222 220a 0a20 2020 2023 2070 796c  l)"""..    # pyl
+00013bc0: 696e 743a 2064 6973 6162 6c65 3d69 6e76  int: disable=inv
+00013bd0: 616c 6964 2d6e 616d 650a 0a20 2020 2023  alid-name..    #
+00013be0: 2077 6974 686f 7574 2074 6865 206d 645f   without the md_
+00013bf0: 7265 7472 6965 7665 6420 7374 6174 652c  retrieved state,
+00013c00: 2077 6520 636f 756c 6420 6e6f 7420 6469   we could not di
+00013c10: 7370 6c61 7920 7468 6520 6c6f 6164 2074  splay the load t
+00013c20: 7261 6e73 6974 696f 6e0a 2020 2020 6d64  ransition.    md
+00013c30: 5f72 6574 7269 6576 6564 203d 2031 0a20  _retrieved = 1. 
+00013c40: 2020 2022 2222 5265 636f 7264 2069 7320     """Record is 
+00013c50: 7265 7472 6965 7665 6420 616e 6420 7374  retrieved and st
+00013c60: 6f72 6564 2069 6e20 7468 6520 2e2f 7365  ored in the ./se
+00013c70: 6172 6368 2064 6972 6563 746f 7279 2222  arch directory""
+00013c80: 220a 2020 2020 6d64 5f69 6d70 6f72 7465  ".    md_importe
+00013c90: 6420 3d20 320a 2020 2020 2222 2252 6563  d = 2.    """Rec
+00013ca0: 6f72 6420 6973 2069 6d70 6f72 7465 6420  ord is imported 
+00013cb0: 696e 746f 2074 6865 2052 4543 4f52 4453  into the RECORDS
+00013cc0: 5f46 494c 4522 2222 0a20 2020 206d 645f  _FILE""".    md_
+00013cd0: 6e65 6564 735f 6d61 6e75 616c 5f70 7265  needs_manual_pre
+00013ce0: 7061 7261 7469 6f6e 203d 2033 0a20 2020  paration = 3.   
+00013cf0: 2022 2222 5265 636f 7264 2072 6571 7569   """Record requi
+00013d00: 7265 7320 6d61 6e75 616c 2070 7265 7061  res manual prepa
+00013d10: 7261 7469 6f6e 0a20 2020 2028 636f 6c72  ration.    (colr
+00013d20: 6576 5f6d 6173 7465 7264 6174 615f 7072  ev_masterdata_pr
+00013d30: 6f76 656e 616e 6365 2070 726f 7669 6465  ovenance provide
+00013d40: 7320 6869 6e74 7329 2222 220a 2020 2020  s hints)""".    
+00013d50: 6d64 5f70 7265 7061 7265 6420 3d20 340a  md_prepared = 4.
+00013d60: 2020 2020 2222 2252 6563 6f72 6420 6973      """Record is
+00013d70: 2070 7265 7061 7265 6420 286e 6f20 6d69   prepared (no mi
+00013d80: 7373 696e 6720 6f72 2069 6e63 6f6d 706c  ssing or incompl
+00013d90: 6574 6520 6669 656c 6473 2c20 696e 636f  ete fields, inco
+00013da0: 6e73 6973 7465 6e63 6965 7320 6368 6563  nsistencies chec
+00013db0: 6b65 6429 2222 220a 2020 2020 6d64 5f70  ked)""".    md_p
+00013dc0: 726f 6365 7373 6564 203d 2035 0a20 2020  rocessed = 5.   
+00013dd0: 2022 2222 5265 636f 7264 2068 6173 2062   """Record has b
+00013de0: 6565 6e20 6368 6563 6b65 6420 666f 7220  een checked for 
+00013df0: 6475 706c 6963 6174 6520 6173 736f 6369  duplicate associ
+00013e00: 6174 696f 6e73 0a20 2020 2077 6974 6820  ations.    with 
+00013e10: 616e 7920 7265 636f 7264 2069 6e20 5265  any record in Re
+00013e20: 636f 7264 5374 6174 6520 6d64 5f70 726f  cordState md_pro
+00013e30: 6365 7373 6564 206f 7220 6c61 7465 7222  cessed or later"
+00013e40: 2222 0a20 2020 2072 6576 5f70 7265 7363  "".    rev_presc
+00013e50: 7265 656e 5f65 7863 6c75 6465 6420 3d20  reen_excluded = 
+00013e60: 360a 2020 2020 2222 2252 6563 6f72 6420  6.    """Record 
+00013e70: 7761 7320 6578 636c 7564 6564 2069 6e20  was excluded in 
+00013e80: 7468 6520 7072 6573 6372 6565 6e20 2862  the prescreen (b
+00013e90: 6173 6564 206f 6e20 7469 746c 6573 2f61  ased on titles/a
+00013ea0: 6273 7472 6163 7473 2922 2222 0a20 2020  bstracts)""".   
+00013eb0: 2072 6576 5f70 7265 7363 7265 656e 5f69   rev_prescreen_i
+00013ec0: 6e63 6c75 6465 6420 3d20 370a 2020 2020  ncluded = 7.    
+00013ed0: 2222 2252 6563 6f72 6420 7761 7320 696e  """Record was in
+00013ee0: 636c 7564 6564 2069 6e20 7468 6520 7072  cluded in the pr
+00013ef0: 6573 6372 6565 6e20 2862 6173 6564 206f  escreen (based o
+00013f00: 6e20 7469 746c 6573 2f61 6273 7472 6163  n titles/abstrac
+00013f10: 7473 2922 2222 0a20 2020 2070 6466 5f6e  ts)""".    pdf_n
+00013f20: 6565 6473 5f6d 616e 7561 6c5f 7265 7472  eeds_manual_retr
+00013f30: 6965 7661 6c20 3d20 380a 2020 2020 2222  ieval = 8.    ""
+00013f40: 2252 6563 6f72 6420 6d61 726b 6564 2066  "Record marked f
+00013f50: 6f72 206d 616e 7561 6c20 5044 4620 7265  or manual PDF re
+00013f60: 7472 6965 7661 6c22 2222 0a20 2020 2070  trieval""".    p
+00013f70: 6466 5f69 6d70 6f72 7465 6420 3d20 390a  df_imported = 9.
+00013f80: 2020 2020 2222 2250 4446 2069 6d70 6f72      """PDF impor
+00013f90: 7465 6420 616e 6420 6d61 726b 6564 2066  ted and marked f
+00013fa0: 6f72 2070 7265 7061 7261 7469 6f6e 2222  or preparation""
+00013fb0: 220a 2020 2020 7064 665f 6e6f 745f 6176  ".    pdf_not_av
+00013fc0: 6169 6c61 626c 6520 3d20 3130 0a20 2020  ailable = 10.   
+00013fd0: 2022 2222 5044 4620 6973 206e 6f74 2061   """PDF is not a
+00013fe0: 7661 696c 6162 6c65 2222 220a 2020 2020  vailable""".    
+00013ff0: 7064 665f 6e65 6564 735f 6d61 6e75 616c  pdf_needs_manual
+00014000: 5f70 7265 7061 7261 7469 6f6e 203d 2031  _preparation = 1
+00014010: 310a 2020 2020 2222 2250 4446 206d 6172  1.    """PDF mar
+00014020: 6b65 6420 666f 7220 6d61 6e75 616c 2070  ked for manual p
+00014030: 7265 7061 7261 7469 6f6e 2222 220a 2020  reparation""".  
+00014040: 2020 7064 665f 7072 6570 6172 6564 203d    pdf_prepared =
+00014050: 2031 320a 2020 2020 2222 2250 4446 2070   12.    """PDF p
+00014060: 7265 7061 7265 6422 2222 0a20 2020 2072  repared""".    r
+00014070: 6576 5f65 7863 6c75 6465 6420 3d20 3133  ev_excluded = 13
+00014080: 0a20 2020 2022 2222 5265 636f 7264 2065  .    """Record e
+00014090: 7863 6c75 6465 6420 696e 2073 6372 6565  xcluded in scree
+000140a0: 6e20 2866 756c 6c2d 7465 7874 2922 2222  n (full-text)"""
+000140b0: 0a20 2020 2072 6576 5f69 6e63 6c75 6465  .    rev_include
+000140c0: 6420 3d20 3134 0a20 2020 2022 2222 5265  d = 14.    """Re
+000140d0: 636f 7264 2069 6e63 6c75 6465 6420 696e  cord included in
+000140e0: 2073 6372 6565 6e20 2866 756c 6c2d 7465   screen (full-te
+000140f0: 7874 2922 2222 0a20 2020 2072 6576 5f73  xt)""".    rev_s
+00014100: 796e 7468 6573 697a 6564 203d 2031 350a  ynthesized = 15.
+00014110: 2020 2020 2222 2252 6563 6f72 6420 7379      """Record sy
+00014120: 6e74 6865 7369 7a65 6422 2222 0a20 2020  nthesized""".   
+00014130: 2023 204e 6f74 6520 3a20 5442 443a 2072   # Note : TBD: r
+00014140: 6576 5f63 6f64 6564 0a0a 2020 2020 6465  ev_coded..    de
+00014150: 6620 5f5f 7374 725f 5f28 7365 6c66 2920  f __str__(self) 
+00014160: 2d3e 2073 7472 3a0a 2020 2020 2020 2020  -> str:.        
+00014170: 7265 7475 726e 2066 227b 7365 6c66 2e6e  return f"{self.n
+00014180: 616d 657d 220a 0a20 2020 2064 6566 205f  ame}"..    def _
+00014190: 5f6c 745f 5f28 7365 6c66 2c20 6f74 6865  _lt__(self, othe
+000141a0: 7229 202d 3e20 626f 6f6c 3a20 2023 2074  r) -> bool:  # t
+000141b0: 7970 653a 2069 676e 6f72 650a 2020 2020  ype: ignore.    
+000141c0: 2020 2020 6966 2073 656c 662e 5f5f 636c      if self.__cl
+000141d0: 6173 735f 5f20 3d3d 2052 6563 6f72 6453  ass__ == RecordS
+000141e0: 7461 7465 2061 6e64 206f 7468 6572 2e5f  tate and other._
+000141f0: 5f63 6c61 7373 5f5f 203d 3d20 5265 636f  _class__ == Reco
+00014200: 7264 5374 6174 653a 0a20 2020 2020 2020  rdState:.       
+00014210: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00014220: 2e76 616c 7565 203c 206f 7468 6572 2e76  .value < other.v
+00014230: 616c 7565 0a20 2020 2020 2020 2072 6169  alue.        rai
+00014240: 7365 204e 6f74 496d 706c 656d 656e 7465  se NotImplemente
+00014250: 6445 7272 6f72 0a0a 2020 2020 4063 6c61  dError..    @cla
+00014260: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
+00014270: 2067 6574 5f6e 6f6e 5f70 726f 6365 7373   get_non_process
+00014280: 6564 5f73 7461 7465 7328 636c 7329 202d  ed_states(cls) -
+00014290: 3e20 6c69 7374 3a0a 2020 2020 2020 2020  > list:.        
+000142a0: 2222 2247 6574 2074 6865 2073 7461 7465  """Get the state
+000142b0: 7320 7468 6174 2063 6f72 7265 7370 6f6e  s that correspon
+000142c0: 6420 746f 206e 6f74 2d79 6574 2d70 726f  d to not-yet-pro
+000142d0: 6365 7373 6564 2222 220a 2020 2020 2020  cessed""".      
+000142e0: 2020 7265 7475 726e 205b 0a20 2020 2020    return [.     
+000142f0: 2020 2020 2020 2063 6f6c 7265 762e 7265         colrev.re
+00014300: 636f 7264 2e52 6563 6f72 6453 7461 7465  cord.RecordState
+00014310: 2e6d 645f 7265 7472 6965 7665 642c 0a20  .md_retrieved,. 
+00014320: 2020 2020 2020 2020 2020 2063 6f6c 7265             colre
+00014330: 762e 7265 636f 7264 2e52 6563 6f72 6453  v.record.RecordS
+00014340: 7461 7465 2e6d 645f 696d 706f 7274 6564  tate.md_imported
+00014350: 2c0a 2020 2020 2020 2020 2020 2020 636f  ,.            co
+00014360: 6c72 6576 2e72 6563 6f72 642e 5265 636f  lrev.record.Reco
+00014370: 7264 5374 6174 652e 6d64 5f70 7265 7061  rdState.md_prepa
+00014380: 7265 642c 0a20 2020 2020 2020 2020 2020  red,.           
+00014390: 2063 6f6c 7265 762e 7265 636f 7264 2e52   colrev.record.R
+000143a0: 6563 6f72 6453 7461 7465 2e6d 645f 6e65  ecordState.md_ne
+000143b0: 6564 735f 6d61 6e75 616c 5f70 7265 7061  eds_manual_prepa
+000143c0: 7261 7469 6f6e 2c0a 2020 2020 2020 2020  ration,.        
+000143d0: 5d0a 0a20 2020 2040 636c 6173 736d 6574  ]..    @classmet
+000143e0: 686f 640a 2020 2020 6465 6620 6765 745f  hod.    def get_
+000143f0: 706f 7374 5f78 5f73 7461 7465 7328 636c  post_x_states(cl
+00014400: 732c 202a 2c20 7374 6174 653a 2052 6563  s, *, state: Rec
+00014410: 6f72 6453 7461 7465 2920 2d3e 2074 7970  ordState) -> typ
+00014420: 696e 672e 5365 745b 5265 636f 7264 5374  ing.Set[RecordSt
+00014430: 6174 655d 3a0a 2020 2020 2020 2020 2222  ate]:.        ""
+00014440: 2247 6574 2074 6865 2073 7461 7465 7320  "Get the states 
+00014450: 6166 7465 7220 7374 6174 6520 7820 2870  after state x (p
+00014460: 6173 7365 6420 6173 2061 2070 6172 616d  assed as a param
+00014470: 6574 6572 2922 2222 0a20 2020 2020 2020  eter)""".       
+00014480: 2069 6620 7374 6174 6520 3d3d 2052 6563   if state == Rec
+00014490: 6f72 6453 7461 7465 2e6d 645f 7072 6570  ordState.md_prep
+000144a0: 6172 6564 3a0a 2020 2020 2020 2020 2020  ared:.          
+000144b0: 2020 7265 7475 726e 207b 0a20 2020 2020    return {.     
+000144c0: 2020 2020 2020 2020 2020 2052 6563 6f72             Recor
+000144d0: 6453 7461 7465 2e6d 645f 7072 6570 6172  dState.md_prepar
+000144e0: 6564 2c0a 2020 2020 2020 2020 2020 2020  ed,.            
+000144f0: 2020 2020 5265 636f 7264 5374 6174 652e      RecordState.
+00014500: 6d64 5f70 726f 6365 7373 6564 2c0a 2020  md_processed,.  
+00014510: 2020 2020 2020 2020 2020 2020 2020 5265                Re
+00014520: 636f 7264 5374 6174 652e 7265 765f 7072  cordState.rev_pr
+00014530: 6573 6372 6565 6e5f 696e 636c 7564 6564  escreen_included
+00014540: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00014550: 2020 5265 636f 7264 5374 6174 652e 7265    RecordState.re
+00014560: 765f 7072 6573 6372 6565 6e5f 6578 636c  v_prescreen_excl
+00014570: 7564 6564 2c0a 2020 2020 2020 2020 2020  uded,.          
+00014580: 2020 2020 2020 5265 636f 7264 5374 6174        RecordStat
+00014590: 652e 7064 665f 6e65 6564 735f 6d61 6e75  e.pdf_needs_manu
+000145a0: 616c 5f72 6574 7269 6576 616c 2c0a 2020  al_retrieval,.  
+000145b0: 2020 2020 2020 2020 2020 2020 2020 5265                Re
+000145c0: 636f 7264 5374 6174 652e 7064 665f 696d  cordState.pdf_im
+000145d0: 706f 7274 6564 2c0a 2020 2020 2020 2020  ported,.        
+000145e0: 2020 2020 2020 2020 5265 636f 7264 5374          RecordSt
+000145f0: 6174 652e 7064 665f 6e6f 745f 6176 6169  ate.pdf_not_avai
+00014600: 6c61 626c 652c 0a20 2020 2020 2020 2020  lable,.         
+00014610: 2020 2020 2020 2052 6563 6f72 6453 7461         RecordSta
+00014620: 7465 2e70 6466 5f6e 6565 6473 5f6d 616e  te.pdf_needs_man
+00014630: 7561 6c5f 7072 6570 6172 6174 696f 6e2c  ual_preparation,
+00014640: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014650: 2052 6563 6f72 6453 7461 7465 2e70 6466   RecordState.pdf
+00014660: 5f70 7265 7061 7265 642c 0a20 2020 2020  _prepared,.     
+00014670: 2020 2020 2020 2020 2020 2052 6563 6f72             Recor
+00014680: 6453 7461 7465 2e72 6576 5f65 7863 6c75  dState.rev_exclu
+00014690: 6465 642c 0a20 2020 2020 2020 2020 2020  ded,.           
+000146a0: 2020 2020 2052 6563 6f72 6453 7461 7465       RecordState
+000146b0: 2e72 6576 5f69 6e63 6c75 6465 642c 0a20  .rev_included,. 
+000146c0: 2020 2020 2020 2020 2020 2020 2020 2052                 R
+000146d0: 6563 6f72 6453 7461 7465 2e72 6576 5f73  ecordState.rev_s
+000146e0: 796e 7468 6573 697a 6564 2c0a 2020 2020  ynthesized,.    
+000146f0: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
+00014700: 2020 6966 2073 7461 7465 203d 3d20 5265    if state == Re
+00014710: 636f 7264 5374 6174 652e 6d64 5f70 726f  cordState.md_pro
+00014720: 6365 7373 6564 3a0a 2020 2020 2020 2020  cessed:.        
+00014730: 2020 2020 7265 7475 726e 207b 0a20 2020      return {.   
+00014740: 2020 2020 2020 2020 2020 2020 2052 6563               Rec
+00014750: 6f72 6453 7461 7465 2e6d 645f 7072 6f63  ordState.md_proc
+00014760: 6573 7365 642c 0a20 2020 2020 2020 2020  essed,.         
+00014770: 2020 2020 2020 2052 6563 6f72 6453 7461         RecordSta
+00014780: 7465 2e72 6576 5f70 7265 7363 7265 656e  te.rev_prescreen
+00014790: 5f69 6e63 6c75 6465 642c 0a20 2020 2020  _included,.     
+000147a0: 2020 2020 2020 2020 2020 2052 6563 6f72             Recor
+000147b0: 6453 7461 7465 2e72 6576 5f70 7265 7363  dState.rev_presc
+000147c0: 7265 656e 5f65 7863 6c75 6465 642c 0a20  reen_excluded,. 
+000147d0: 2020 2020 2020 2020 2020 2020 2020 2052                 R
+000147e0: 6563 6f72 6453 7461 7465 2e70 6466 5f6e  ecordState.pdf_n
+000147f0: 6565 6473 5f6d 616e 7561 6c5f 7265 7472  eeds_manual_retr
+00014800: 6965 7661 6c2c 0a20 2020 2020 2020 2020  ieval,.         
+00014810: 2020 2020 2020 2052 6563 6f72 6453 7461         RecordSta
+00014820: 7465 2e70 6466 5f69 6d70 6f72 7465 642c  te.pdf_imported,
+00014830: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014840: 2052 6563 6f72 6453 7461 7465 2e70 6466   RecordState.pdf
+00014850: 5f6e 6f74 5f61 7661 696c 6162 6c65 2c0a  _not_available,.
+00014860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014870: 5265 636f 7264 5374 6174 652e 7064 665f  RecordState.pdf_
+00014880: 6e65 6564 735f 6d61 6e75 616c 5f70 7265  needs_manual_pre
+00014890: 7061 7261 7469 6f6e 2c0a 2020 2020 2020  paration,.      
+000148a0: 2020 2020 2020 2020 2020 5265 636f 7264            Record
+000148b0: 5374 6174 652e 7064 665f 7072 6570 6172  State.pdf_prepar
+000148c0: 6564 2c0a 2020 2020 2020 2020 2020 2020  ed,.            
+000148d0: 2020 2020 5265 636f 7264 5374 6174 652e      RecordState.
+000148e0: 7265 765f 6578 636c 7564 6564 2c0a 2020  rev_excluded,.  
+000148f0: 2020 2020 2020 2020 2020 2020 2020 5265                Re
+00014900: 636f 7264 5374 6174 652e 7265 765f 696e  cordState.rev_in
+00014910: 636c 7564 6564 2c0a 2020 2020 2020 2020  cluded,.        
+00014920: 2020 2020 2020 2020 5265 636f 7264 5374          RecordSt
+00014930: 6174 652e 7265 765f 7379 6e74 6865 7369  ate.rev_synthesi
+00014940: 7a65 642c 0a20 2020 2020 2020 2020 2020  zed,.           
+00014950: 207d 0a20 2020 2020 2020 2069 6620 7374   }.        if st
+00014960: 6174 6520 3d3d 2052 6563 6f72 6453 7461  ate == RecordSta
+00014970: 7465 2e72 6576 5f70 7265 7363 7265 656e  te.rev_prescreen
+00014980: 5f69 6e63 6c75 6465 643a 0a20 2020 2020  _included:.     
+00014990: 2020 2020 2020 2072 6574 7572 6e20 7b0a         return {.
+000149a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000149b0: 5265 636f 7264 5374 6174 652e 7265 765f  RecordState.rev_
+000149c0: 7072 6573 6372 6565 6e5f 696e 636c 7564  prescreen_includ
+000149d0: 6564 2c0a 2020 2020 2020 2020 2020 2020  ed,.            
+000149e0: 2020 2020 5265 636f 7264 5374 6174 652e      RecordState.
+000149f0: 7265 765f 7072 6573 6372 6565 6e5f 6578  rev_prescreen_ex
+00014a00: 636c 7564 6564 2c0a 2020 2020 2020 2020  cluded,.        
+00014a10: 2020 2020 2020 2020 5265 636f 7264 5374          RecordSt
+00014a20: 6174 652e 7064 665f 6e65 6564 735f 6d61  ate.pdf_needs_ma
+00014a30: 6e75 616c 5f72 6574 7269 6576 616c 2c0a  nual_retrieval,.
+00014a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014a50: 5265 636f 7264 5374 6174 652e 7064 665f  RecordState.pdf_
+00014a60: 696d 706f 7274 6564 2c0a 2020 2020 2020  imported,.      
+00014a70: 2020 2020 2020 2020 2020 5265 636f 7264            Record
+00014a80: 5374 6174 652e 7064 665f 6e6f 745f 6176  State.pdf_not_av
+00014a90: 6169 6c61 626c 652c 0a20 2020 2020 2020  ailable,.       
+00014aa0: 2020 2020 2020 2020 2052 6563 6f72 6453           RecordS
+00014ab0: 7461 7465 2e70 6466 5f6e 6565 6473 5f6d  tate.pdf_needs_m
+00014ac0: 616e 7561 6c5f 7072 6570 6172 6174 696f  anual_preparatio
+00014ad0: 6e2c 0a20 2020 2020 2020 2020 2020 2020  n,.             
+00014ae0: 2020 2052 6563 6f72 6453 7461 7465 2e70     RecordState.p
+00014af0: 6466 5f70 7265 7061 7265 642c 0a20 2020  df_prepared,.   
+00014b00: 2020 2020 2020 2020 2020 2020 2052 6563               Rec
+00014b10: 6f72 6453 7461 7465 2e72 6576 5f65 7863  ordState.rev_exc
+00014b20: 6c75 6465 642c 0a20 2020 2020 2020 2020  luded,.         
+00014b30: 2020 2020 2020 2052 6563 6f72 6453 7461         RecordSta
+00014b40: 7465 2e72 6576 5f69 6e63 6c75 6465 642c  te.rev_included,
+00014b50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014b60: 2052 6563 6f72 6453 7461 7465 2e72 6576   RecordState.rev
+00014b70: 5f73 796e 7468 6573 697a 6564 2c0a 2020  _synthesized,.  
+00014b80: 2020 2020 2020 2020 2020 7d0a 2020 2020            }.    
+00014b90: 2020 2020 6966 2073 7461 7465 203d 3d20      if state == 
+00014ba0: 5265 636f 7264 5374 6174 652e 7064 665f  RecordState.pdf_
+00014bb0: 7072 6570 6172 6564 3a0a 2020 2020 2020  prepared:.      
+00014bc0: 2020 2020 2020 7265 7475 726e 207b 0a20        return {. 
+00014bd0: 2020 2020 2020 2020 2020 2020 2020 2052                 R
+00014be0: 6563 6f72 6453 7461 7465 2e70 6466 5f70  ecordState.pdf_p
+00014bf0: 7265 7061 7265 642c 0a20 2020 2020 2020  repared,.       
+00014c00: 2020 2020 2020 2020 2052 6563 6f72 6453           RecordS
+00014c10: 7461 7465 2e72 6576 5f65 7863 6c75 6465  tate.rev_exclude
+00014c20: 642c 0a20 2020 2020 2020 2020 2020 2020  d,.             
+00014c30: 2020 2052 6563 6f72 6453 7461 7465 2e72     RecordState.r
+00014c40: 6576 5f69 6e63 6c75 6465 642c 0a20 2020  ev_included,.   
+00014c50: 2020 2020 2020 2020 2020 2020 2052 6563               Rec
+00014c60: 6f72 6453 7461 7465 2e72 6576 5f73 796e  ordState.rev_syn
+00014c70: 7468 6573 697a 6564 2c0a 2020 2020 2020  thesized,.      
+00014c80: 2020 2020 2020 7d0a 0a20 2020 2020 2020        }..       
+00014c90: 2069 6620 7374 6174 6520 3d3d 2052 6563   if state == Rec
+00014ca0: 6f72 6453 7461 7465 2e72 6576 5f69 6e63  ordState.rev_inc
+00014cb0: 6c75 6465 643a 0a20 2020 2020 2020 2020  luded:.         
+00014cc0: 2020 2072 6574 7572 6e20 7b0a 2020 2020     return {.    
+00014cd0: 2020 2020 2020 2020 2020 2020 5265 636f              Reco
+00014ce0: 7264 5374 6174 652e 7265 765f 6578 636c  rdState.rev_excl
+00014cf0: 7564 6564 2c0a 2020 2020 2020 2020 2020  uded,.          
+00014d00: 2020 2020 2020 5265 636f 7264 5374 6174        RecordStat
+00014d10: 652e 7265 765f 696e 636c 7564 6564 2c0a  e.rev_included,.
+00014d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014d30: 5265 636f 7264 5374 6174 652e 7265 765f  RecordState.rev_
+00014d40: 7379 6e74 6865 7369 7a65 642c 0a20 2020  synthesized,.   
+00014d50: 2020 2020 2020 2020 207d 0a0a 2020 2020           }..    
+00014d60: 2020 2020 2320 7079 6c69 6e74 3a20 6469      # pylint: di
+00014d70: 7361 626c 653d 6e6f 2d6d 656d 6265 720a  sable=no-member.
+00014d80: 2020 2020 2020 2020 7261 6973 6520 636f          raise co
+00014d90: 6c72 6576 5f65 7863 6570 7469 6f6e 732e  lrev_exceptions.
+00014da0: 5061 7261 6d65 7465 7245 7272 6f72 280a  ParameterError(.
+00014db0: 2020 2020 2020 2020 2020 2020 7061 7261              para
+00014dc0: 6d65 7465 723d 2273 7461 7465 222c 2076  meter="state", v
+00014dd0: 616c 7565 3d22 7374 6174 6522 2c20 6f70  alue="state", op
+00014de0: 7469 6f6e 733d 636c 732e 5f6d 656d 6265  tions=cls._membe
+00014df0: 725f 6e61 6d65 735f 0a20 2020 2020 2020  r_names_.       
+00014e00: 2029 0a0a 0a6e 6f6e 5f70 726f 6365 7373   )...non_process
+00014e10: 696e 675f 7472 616e 7369 7469 6f6e 7320  ing_transitions 
+00014e20: 3d20 5b0a 2020 2020 5b0a 2020 2020 2020  = [.    [.      
+00014e30: 2020 7b0a 2020 2020 2020 2020 2020 2020    {.            
+00014e40: 2274 7269 6767 6572 223a 2022 666f 726d  "trigger": "form
+00014e50: 6174 222c 0a20 2020 2020 2020 2020 2020  at",.           
+00014e60: 2022 736f 7572 6365 223a 2073 7461 7465   "source": state
+00014e70: 2c0a 2020 2020 2020 2020 2020 2020 2264  ,.            "d
+00014e80: 6573 7422 3a20 7374 6174 652c 0a20 2020  est": state,.   
+00014e90: 2020 2020 207d 2c0a 2020 2020 2020 2020       },.        
+00014ea0: 7b0a 2020 2020 2020 2020 2020 2020 2274  {.            "t
+00014eb0: 7269 6767 6572 223a 2022 6578 706c 6f72  rigger": "explor
+00014ec0: 6522 2c0a 2020 2020 2020 2020 2020 2020  e",.            
+00014ed0: 2273 6f75 7263 6522 3a20 7374 6174 652c  "source": state,
+00014ee0: 0a20 2020 2020 2020 2020 2020 2022 6465  .            "de
+00014ef0: 7374 223a 2073 7461 7465 2c0a 2020 2020  st": state,.    
+00014f00: 2020 2020 7d2c 0a20 2020 2020 2020 207b      },.        {
+00014f10: 0a20 2020 2020 2020 2020 2020 2022 7472  .            "tr
+00014f20: 6967 6765 7222 3a20 2263 6865 636b 222c  igger": "check",
+00014f30: 0a20 2020 2020 2020 2020 2020 2022 736f  .            "so
+00014f40: 7572 6365 223a 2073 7461 7465 2c0a 2020  urce": state,.  
+00014f50: 2020 2020 2020 2020 2020 2264 6573 7422            "dest"
+00014f60: 3a20 7374 6174 652c 0a20 2020 2020 2020  : state,.       
+00014f70: 207d 2c0a 2020 2020 5d0a 2020 2020 666f   },.    ].    fo
+00014f80: 7220 7374 6174 6520 696e 206c 6973 7428  r state in list(
+00014f90: 5265 636f 7264 5374 6174 6529 0a5d 0a0a  RecordState).]..
+00014fa0: 0a63 6c61 7373 2052 6563 6f72 6453 7461  .class RecordSta
+00014fb0: 7465 4d6f 6465 6c3a 0a20 2020 2022 2222  teModel:.    """
+00014fc0: 5468 6520 5265 636f 7264 5374 6174 654d  The RecordStateM
+00014fd0: 6f64 656c 2064 6573 6372 6962 6573 2074  odel describes t
+00014fe0: 7261 6e73 6974 696f 6e73 2062 6574 7765  ransitions betwe
+00014ff0: 656e 2052 6563 6f72 6453 7461 7465 7322  en RecordStates"
+00015000: 2222 0a0a 2020 2020 7472 616e 7369 7469  ""..    transiti
+00015010: 6f6e 7320 3d20 5b0a 2020 2020 2020 2020  ons = [.        
+00015020: 7b0a 2020 2020 2020 2020 2020 2020 2274  {.            "t
+00015030: 7269 6767 6572 223a 2022 6c6f 6164 222c  rigger": "load",
+00015040: 0a20 2020 2020 2020 2020 2020 2022 736f  .            "so
+00015050: 7572 6365 223a 2052 6563 6f72 6453 7461  urce": RecordSta
+00015060: 7465 2e6d 645f 7265 7472 6965 7665 642c  te.md_retrieved,
+00015070: 0a20 2020 2020 2020 2020 2020 2022 6465  .            "de
+00015080: 7374 223a 2052 6563 6f72 6453 7461 7465  st": RecordState
+00015090: 2e6d 645f 696d 706f 7274 6564 2c0a 2020  .md_imported,.  
+000150a0: 2020 2020 2020 7d2c 0a20 2020 2020 2020        },.       
+000150b0: 207b 0a20 2020 2020 2020 2020 2020 2022   {.            "
+000150c0: 7472 6967 6765 7222 3a20 2270 7265 7022  trigger": "prep"
+000150d0: 2c0a 2020 2020 2020 2020 2020 2020 2273  ,.            "s
+000150e0: 6f75 7263 6522 3a20 5265 636f 7264 5374  ource": RecordSt
+000150f0: 6174 652e 6d64 5f69 6d70 6f72 7465 642c  ate.md_imported,
+00015100: 0a20 2020 2020 2020 2020 2020 2022 6465  .            "de
+00015110: 7374 223a 2052 6563 6f72 6453 7461 7465  st": RecordState
+00015120: 2e6d 645f 6e65 6564 735f 6d61 6e75 616c  .md_needs_manual
+00015130: 5f70 7265 7061 7261 7469 6f6e 2c0a 2020  _preparation,.  
+00015140: 2020 2020 2020 7d2c 0a20 2020 2020 2020        },.       
+00015150: 207b 0a20 2020 2020 2020 2020 2020 2022   {.            "
+00015160: 7472 6967 6765 7222 3a20 2270 7265 7022  trigger": "prep"
+00015170: 2c0a 2020 2020 2020 2020 2020 2020 2273  ,.            "s
+00015180: 6f75 7263 6522 3a20 5265 636f 7264 5374  ource": RecordSt
+00015190: 6174 652e 6d64 5f69 6d70 6f72 7465 642c  ate.md_imported,
+000151a0: 0a20 2020 2020 2020 2020 2020 2022 6465  .            "de
+000151b0: 7374 223a 2052 6563 6f72 6453 7461 7465  st": RecordState
+000151c0: 2e6d 645f 7072 6570 6172 6564 2c0a 2020  .md_prepared,.  
+000151d0: 2020 2020 2020 7d2c 0a20 2020 2020 2020        },.       
+000151e0: 207b 0a20 2020 2020 2020 2020 2020 2022   {.            "
+000151f0: 7472 6967 6765 7222 3a20 2270 7265 705f  trigger": "prep_
+00015200: 6d61 6e22 2c0a 2020 2020 2020 2020 2020  man",.          
+00015210: 2020 2273 6f75 7263 6522 3a20 5265 636f    "source": Reco
+00015220: 7264 5374 6174 652e 6d64 5f6e 6565 6473  rdState.md_needs
+00015230: 5f6d 616e 7561 6c5f 7072 6570 6172 6174  _manual_preparat
+00015240: 696f 6e2c 0a20 2020 2020 2020 2020 2020  ion,.           
+00015250: 2022 6465 7374 223a 2052 6563 6f72 6453   "dest": RecordS
+00015260: 7461 7465 2e6d 645f 7072 6570 6172 6564  tate.md_prepared
+00015270: 2c0a 2020 2020 2020 2020 7d2c 0a20 2020  ,.        },.   
+00015280: 2020 2020 207b 0a20 2020 2020 2020 2020       {.         
+00015290: 2020 2022 7472 6967 6765 7222 3a20 2264     "trigger": "d
+000152a0: 6564 7570 6522 2c0a 2020 2020 2020 2020  edupe",.        
+000152b0: 2020 2020 2273 6f75 7263 6522 3a20 5265      "source": Re
+000152c0: 636f 7264 5374 6174 652e 6d64 5f70 7265  cordState.md_pre
+000152d0: 7061 7265 642c 0a20 2020 2020 2020 2020  pared,.         
+000152e0: 2020 2022 6465 7374 223a 2052 6563 6f72     "dest": Recor
+000152f0: 6453 7461 7465 2e6d 645f 7072 6f63 6573  dState.md_proces
+00015300: 7365 642c 0a20 2020 2020 2020 207d 2c0a  sed,.        },.
+00015310: 2020 2020 2020 2020 7b0a 2020 2020 2020          {.      
+00015320: 2020 2020 2020 2274 7269 6767 6572 223a        "trigger":
+00015330: 2022 7072 6573 6372 6565 6e22 2c0a 2020   "prescreen",.  
+00015340: 2020 2020 2020 2020 2020 2273 6f75 7263            "sourc
+00015350: 6522 3a20 5265 636f 7264 5374 6174 652e  e": RecordState.
+00015360: 6d64 5f70 726f 6365 7373 6564 2c0a 2020  md_processed,.  
+00015370: 2020 2020 2020 2020 2020 2264 6573 7422            "dest"
+00015380: 3a20 5265 636f 7264 5374 6174 652e 7265  : RecordState.re
+00015390: 765f 7072 6573 6372 6565 6e5f 6578 636c  v_prescreen_excl
+000153a0: 7564 6564 2c0a 2020 2020 2020 2020 7d2c  uded,.        },
+000153b0: 0a20 2020 2020 2020 207b 0a20 2020 2020  .        {.     
+000153c0: 2020 2020 2020 2022 7472 6967 6765 7222         "trigger"
+000153d0: 3a20 2270 7265 7363 7265 656e 222c 0a20  : "prescreen",. 
+000153e0: 2020 2020 2020 2020 2020 2022 736f 7572             "sour
+000153f0: 6365 223a 2052 6563 6f72 6453 7461 7465  ce": RecordState
+00015400: 2e6d 645f 7072 6f63 6573 7365 642c 0a20  .md_processed,. 
+00015410: 2020 2020 2020 2020 2020 2022 6465 7374             "dest
+00015420: 223a 2052 6563 6f72 6453 7461 7465 2e72  ": RecordState.r
+00015430: 6576 5f70 7265 7363 7265 656e 5f69 6e63  ev_prescreen_inc
+00015440: 6c75 6465 642c 0a20 2020 2020 2020 207d  luded,.        }
+00015450: 2c0a 2020 2020 2020 2020 7b0a 2020 2020  ,.        {.    
+00015460: 2020 2020 2020 2020 2274 7269 6767 6572          "trigger
+00015470: 223a 2022 7064 665f 6765 7422 2c0a 2020  ": "pdf_get",.  
 00015480: 2020 2020 2020 2020 2020 2273 6f75 7263            "sourc
 00015490: 6522 3a20 5265 636f 7264 5374 6174 652e  e": RecordState.
-000154a0: 7064 665f 6e65 6564 735f 6d61 6e75 616c  pdf_needs_manual
-000154b0: 5f72 6574 7269 6576 616c 2c0a 2020 2020  _retrieval,.    
-000154c0: 2020 2020 2020 2020 2264 6573 7422 3a20          "dest": 
-000154d0: 5265 636f 7264 5374 6174 652e 7064 665f  RecordState.pdf_
-000154e0: 696d 706f 7274 6564 2c0a 2020 2020 2020  imported,.      
-000154f0: 2020 7d2c 0a20 2020 2020 2020 207b 0a20    },.        {. 
-00015500: 2020 2020 2020 2020 2020 2022 7472 6967             "trig
-00015510: 6765 7222 3a20 2270 6466 5f70 7265 7022  ger": "pdf_prep"
-00015520: 2c0a 2020 2020 2020 2020 2020 2020 2273  ,.            "s
-00015530: 6f75 7263 6522 3a20 5265 636f 7264 5374  ource": RecordSt
-00015540: 6174 652e 7064 665f 696d 706f 7274 6564  ate.pdf_imported
-00015550: 2c0a 2020 2020 2020 2020 2020 2020 2264  ,.            "d
-00015560: 6573 7422 3a20 5265 636f 7264 5374 6174  est": RecordStat
-00015570: 652e 7064 665f 6e65 6564 735f 6d61 6e75  e.pdf_needs_manu
-00015580: 616c 5f70 7265 7061 7261 7469 6f6e 2c0a  al_preparation,.
-00015590: 2020 2020 2020 2020 7d2c 0a20 2020 2020          },.     
-000155a0: 2020 207b 0a20 2020 2020 2020 2020 2020     {.           
-000155b0: 2022 7472 6967 6765 7222 3a20 2270 6466   "trigger": "pdf
-000155c0: 5f70 7265 7022 2c0a 2020 2020 2020 2020  _prep",.        
-000155d0: 2020 2020 2273 6f75 7263 6522 3a20 5265      "source": Re
-000155e0: 636f 7264 5374 6174 652e 7064 665f 696d  cordState.pdf_im
-000155f0: 706f 7274 6564 2c0a 2020 2020 2020 2020  ported,.        
-00015600: 2020 2020 2264 6573 7422 3a20 5265 636f      "dest": Reco
-00015610: 7264 5374 6174 652e 7064 665f 7072 6570  rdState.pdf_prep
-00015620: 6172 6564 2c0a 2020 2020 2020 2020 7d2c  ared,.        },
-00015630: 0a20 2020 2020 2020 207b 0a20 2020 2020  .        {.     
-00015640: 2020 2020 2020 2022 7472 6967 6765 7222         "trigger"
-00015650: 3a20 2270 6466 5f70 7265 705f 6d61 6e22  : "pdf_prep_man"
-00015660: 2c0a 2020 2020 2020 2020 2020 2020 2273  ,.            "s
-00015670: 6f75 7263 6522 3a20 5265 636f 7264 5374  ource": RecordSt
-00015680: 6174 652e 7064 665f 6e65 6564 735f 6d61  ate.pdf_needs_ma
-00015690: 6e75 616c 5f70 7265 7061 7261 7469 6f6e  nual_preparation
-000156a0: 2c0a 2020 2020 2020 2020 2020 2020 2264  ,.            "d
-000156b0: 6573 7422 3a20 5265 636f 7264 5374 6174  est": RecordStat
-000156c0: 652e 7064 665f 7072 6570 6172 6564 2c0a  e.pdf_prepared,.
-000156d0: 2020 2020 2020 2020 7d2c 0a20 2020 2020          },.     
-000156e0: 2020 207b 0a20 2020 2020 2020 2020 2020     {.           
-000156f0: 2022 7472 6967 6765 7222 3a20 2273 6372   "trigger": "scr
-00015700: 6565 6e22 2c0a 2020 2020 2020 2020 2020  een",.          
-00015710: 2020 2273 6f75 7263 6522 3a20 5265 636f    "source": Reco
-00015720: 7264 5374 6174 652e 7064 665f 7072 6570  rdState.pdf_prep
-00015730: 6172 6564 2c0a 2020 2020 2020 2020 2020  ared,.          
-00015740: 2020 2264 6573 7422 3a20 5265 636f 7264    "dest": Record
-00015750: 5374 6174 652e 7265 765f 6578 636c 7564  State.rev_exclud
-00015760: 6564 2c0a 2020 2020 2020 2020 7d2c 0a20  ed,.        },. 
-00015770: 2020 2020 2020 207b 0a20 2020 2020 2020         {.       
-00015780: 2020 2020 2022 7472 6967 6765 7222 3a20       "trigger": 
-00015790: 2273 6372 6565 6e22 2c0a 2020 2020 2020  "screen",.      
-000157a0: 2020 2020 2020 2273 6f75 7263 6522 3a20        "source": 
-000157b0: 5265 636f 7264 5374 6174 652e 7064 665f  RecordState.pdf_
-000157c0: 7072 6570 6172 6564 2c0a 2020 2020 2020  prepared,.      
-000157d0: 2020 2020 2020 2264 6573 7422 3a20 5265        "dest": Re
-000157e0: 636f 7264 5374 6174 652e 7265 765f 696e  cordState.rev_in
-000157f0: 636c 7564 6564 2c0a 2020 2020 2020 2020  cluded,.        
-00015800: 7d2c 0a20 2020 2020 2020 207b 0a20 2020  },.        {.   
-00015810: 2020 2020 2020 2020 2022 7472 6967 6765           "trigge
-00015820: 7222 3a20 2264 6174 6122 2c0a 2020 2020  r": "data",.    
-00015830: 2020 2020 2020 2020 2273 6f75 7263 6522          "source"
-00015840: 3a20 5265 636f 7264 5374 6174 652e 7265  : RecordState.re
-00015850: 765f 696e 636c 7564 6564 2c0a 2020 2020  v_included,.    
-00015860: 2020 2020 2020 2020 2264 6573 7422 3a20          "dest": 
-00015870: 5265 636f 7264 5374 6174 652e 7265 765f  RecordState.rev_
-00015880: 7379 6e74 6865 7369 7a65 642c 0a20 2020  synthesized,.   
-00015890: 2020 2020 207d 2c0a 2020 2020 5d0a 0a20       },.    ].. 
-000158a0: 2020 2074 7261 6e73 6974 696f 6e73 5f6e     transitions_n
-000158b0: 6f6e 5f70 726f 6365 7373 696e 6720 3d20  on_processing = 
-000158c0: 5b0a 2020 2020 2020 2020 6974 656d 2066  [.        item f
-000158d0: 6f72 2073 7562 6c69 7374 2069 6e20 6e6f  or sublist in no
-000158e0: 6e5f 7072 6f63 6573 7369 6e67 5f74 7261  n_processing_tra
-000158f0: 6e73 6974 696f 6e73 2066 6f72 2069 7465  nsitions for ite
-00015900: 6d20 696e 2073 7562 6c69 7374 0a20 2020  m in sublist.   
-00015910: 205d 0a0a 2020 2020 2320 6672 6f6d 2074   ]..    # from t
-00015920: 7261 6e73 6974 696f 6e73 2069 6d70 6f72  ransitions impor
-00015930: 7420 4d61 6368 696e 650a 2020 2020 2320  t Machine.    # 
-00015940: 6465 6620 5f5f 696e 6974 5f5f 280a 2020  def __init__(.  
-00015950: 2020 2320 2020 2020 7365 6c66 2c0a 2020    #     self,.  
-00015960: 2020 2320 2020 2020 2a2c 0a20 2020 2023    #     *,.    #
-00015970: 2020 2020 2073 7461 7465 3a20 5265 636f       state: Reco
-00015980: 7264 5374 6174 652c 0a20 2020 2023 2029  rdState,.    # )
-00015990: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2320   -> None:.    # 
-000159a0: 2020 2020 7365 6c66 2e73 7461 7465 203d      self.state =
-000159b0: 2073 7461 7465 0a0a 2020 2020 2320 2020   state..    #   
-000159c0: 2020 7365 6c66 2e6d 6163 6869 6e65 203d    self.machine =
-000159d0: 204d 6163 6869 6e65 280a 2020 2020 2320   Machine(.    # 
-000159e0: 2020 2020 2020 2020 6d6f 6465 6c3d 7365          model=se
-000159f0: 6c66 2c0a 2020 2020 2320 2020 2020 2020  lf,.    #       
-00015a00: 2020 7374 6174 6573 3d52 6563 6f72 6453    states=RecordS
-00015a10: 7461 7465 2c0a 2020 2020 2320 2020 2020  tate,.    #     
-00015a20: 2020 2020 7472 616e 7369 7469 6f6e 733d      transitions=
-00015a30: 7365 6c66 2e74 7261 6e73 6974 696f 6e73  self.transitions
-00015a40: 202b 2073 656c 662e 7472 616e 7369 7469   + self.transiti
-00015a50: 6f6e 735f 6e6f 6e5f 7072 6f63 6573 7369  ons_non_processi
-00015a60: 6e67 2c0a 2020 2020 2320 2020 2020 2020  ng,.    #       
-00015a70: 2020 696e 6974 6961 6c3d 7365 6c66 2e73    initial=self.s
-00015a80: 7461 7465 2c0a 2020 2020 2320 2020 2020  tate,.    #     
-00015a90: 290a 0a20 2020 2040 636c 6173 736d 6574  )..    @classmet
-00015aa0: 686f 640a 2020 2020 6465 6620 6765 745f  hod.    def get_
-00015ab0: 7661 6c69 645f 7472 616e 7369 7469 6f6e  valid_transition
-00015ac0: 7328 636c 732c 202a 2c20 7374 6174 653a  s(cls, *, state:
-00015ad0: 2052 6563 6f72 6453 7461 7465 2920 2d3e   RecordState) ->
-00015ae0: 2073 6574 3a0a 2020 2020 2020 2020 2222   set:.        ""
-00015af0: 2247 6574 2074 6865 206c 6973 7420 6f66  "Get the list of
-00015b00: 2076 616c 6964 2074 7261 6e73 6974 696f   valid transitio
-00015b10: 6e73 2222 220a 2020 2020 2020 2020 6c6f  ns""".        lo
-00015b20: 6767 696e 672e 6765 744c 6f67 6765 7228  gging.getLogger(
-00015b30: 2274 7261 6e73 6974 696f 6e73 2229 2e73  "transitions").s
-00015b40: 6574 4c65 7665 6c28 6c6f 6767 696e 672e  etLevel(logging.
-00015b50: 5741 524e 494e 4729 0a20 2020 2020 2020  WARNING).       
-00015b60: 2072 6574 7572 6e20 7365 7428 7b78 5b22   return set({x["
-00015b70: 7472 6967 6765 7222 5d20 666f 7220 7820  trigger"] for x 
-00015b80: 696e 2063 6c73 2e74 7261 6e73 6974 696f  in cls.transitio
-00015b90: 6e73 2069 6620 785b 2273 6f75 7263 6522  ns if x["source"
-00015ba0: 5d20 3d3d 2073 7461 7465 7d29 0a0a 2020  ] == state})..  
-00015bb0: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
-00015bc0: 2020 2064 6566 2067 6574 5f70 7265 6365     def get_prece
-00015bd0: 6469 6e67 5f73 7461 7465 7328 636c 732c  ding_states(cls,
-00015be0: 202a 2c20 7374 6174 653a 2052 6563 6f72   *, state: Recor
-00015bf0: 6453 7461 7465 2920 2d3e 2073 6574 3a0a  dState) -> set:.
-00015c00: 2020 2020 2020 2020 2222 2247 6574 2074          """Get t
-00015c10: 6865 2073 7461 7465 7320 7072 6563 6564  he states preced
-00015c20: 696e 6720 7468 6520 7374 6174 6520 7468  ing the state th
-00015c30: 6174 2069 7320 6769 7665 6e20 6173 2061  at is given as a
-00015c40: 2070 6172 616d 6574 6572 2222 220a 0a20   parameter""".. 
-00015c50: 2020 2020 2020 206c 6f67 6769 6e67 2e67         logging.g
-00015c60: 6574 4c6f 6767 6572 2822 7472 616e 7369  etLogger("transi
-00015c70: 7469 6f6e 7322 292e 7365 744c 6576 656c  tions").setLevel
-00015c80: 286c 6f67 6769 6e67 2e57 4152 4e49 4e47  (logging.WARNING
-00015c90: 290a 2020 2020 2020 2020 7072 6563 6564  ).        preced
-00015ca0: 696e 675f 7374 6174 6573 3a20 7365 745b  ing_states: set[
-00015cb0: 5265 636f 7264 5374 6174 655d 203d 2073  RecordState] = s
-00015cc0: 6574 2829 0a20 2020 2020 2020 2061 6464  et().        add
-00015cd0: 6564 203d 2054 7275 650a 2020 2020 2020  ed = True.      
-00015ce0: 2020 7768 696c 6520 6164 6465 643a 0a20    while added:. 
-00015cf0: 2020 2020 2020 2020 2020 2070 7265 6365             prece
-00015d00: 6469 6e67 5f73 7461 7465 735f 7369 7a65  ding_states_size
-00015d10: 203d 206c 656e 2870 7265 6365 6469 6e67   = len(preceding
-00015d20: 5f73 7461 7465 7329 0a20 2020 2020 2020  _states).       
-00015d30: 2020 2020 2066 6f72 2074 7261 6e73 6974       for transit
-00015d40: 696f 6e20 696e 2052 6563 6f72 6453 7461  ion in RecordSta
-00015d50: 7465 4d6f 6465 6c2e 7472 616e 7369 7469  teModel.transiti
-00015d60: 6f6e 733a 0a20 2020 2020 2020 2020 2020  ons:.           
-00015d70: 2020 2020 2069 6620 280a 2020 2020 2020       if (.      
-00015d80: 2020 2020 2020 2020 2020 2020 2020 7472                tr
-00015d90: 616e 7369 7469 6f6e 5b22 6465 7374 225d  ansition["dest"]
-00015da0: 2069 6e20 7072 6563 6564 696e 675f 7374   in preceding_st
-00015db0: 6174 6573 0a20 2020 2020 2020 2020 2020  ates.           
-00015dc0: 2020 2020 2020 2020 206f 7220 7374 6174           or stat
-00015dd0: 6520 3d3d 2074 7261 6e73 6974 696f 6e5b  e == transition[
-00015de0: 2264 6573 7422 5d0a 2020 2020 2020 2020  "dest"].        
-00015df0: 2020 2020 2020 2020 293a 0a20 2020 2020          ):.     
-00015e00: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00015e10: 7265 6365 6469 6e67 5f73 7461 7465 732e  receding_states.
-00015e20: 6164 6428 7472 616e 7369 7469 6f6e 5b22  add(transition["
-00015e30: 736f 7572 6365 225d 2920 2023 2074 7970  source"])  # typ
-00015e40: 653a 2069 676e 6f72 650a 2020 2020 2020  e: ignore.      
-00015e50: 2020 2020 2020 6966 2070 7265 6365 6469        if precedi
-00015e60: 6e67 5f73 7461 7465 735f 7369 7a65 203d  ng_states_size =
-00015e70: 3d20 6c65 6e28 7072 6563 6564 696e 675f  = len(preceding_
-00015e80: 7374 6174 6573 293a 0a20 2020 2020 2020  states):.       
-00015e90: 2020 2020 2020 2020 2061 6464 6564 203d           added =
-00015ea0: 2046 616c 7365 0a20 2020 2020 2020 2072   False.        r
-00015eb0: 6574 7572 6e20 7072 6563 6564 696e 675f  eturn preceding_
-00015ec0: 7374 6174 6573 0a0a 2020 2020 4063 6c61  states..    @cla
-00015ed0: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
-00015ee0: 2063 6865 636b 5f6f 7065 7261 7469 6f6e   check_operation
-00015ef0: 5f70 7265 636f 6e64 6974 696f 6e28 0a20  _precondition(. 
-00015f00: 2020 2020 2020 2063 6c73 2c20 2a2c 206f         cls, *, o
-00015f10: 7065 7261 7469 6f6e 3a20 636f 6c72 6576  peration: colrev
-00015f20: 2e6f 7065 7261 7469 6f6e 2e4f 7065 7261  .operation.Opera
-00015f30: 7469 6f6e 0a20 2020 2029 202d 3e20 4e6f  tion.    ) -> No
-00015f40: 6e65 3a0a 2020 2020 2020 2020 2222 2243  ne:.        """C
-00015f50: 6865 636b 2074 6865 2070 7265 636f 6e64  heck the precond
-00015f60: 6974 696f 6e73 2066 6f72 2061 6e20 6f70  itions for an op
-00015f70: 6572 6174 696f 6e22 2222 0a0a 2020 2020  eration"""..    
-00015f80: 2020 2020 6465 6620 6765 745f 7374 6174      def get_stat
-00015f90: 6573 5f73 6574 2829 202d 3e20 7365 743a  es_set() -> set:
-00015fa0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00015fb0: 6e6f 7420 6f70 6572 6174 696f 6e2e 7265  not operation.re
-00015fc0: 7669 6577 5f6d 616e 6167 6572 2e64 6174  view_manager.dat
-00015fd0: 6173 6574 2e72 6563 6f72 6473 5f66 696c  aset.records_fil
-00015fe0: 652e 6973 5f66 696c 6528 293a 0a20 2020  e.is_file():.   
-00015ff0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-00016000: 7572 6e20 7365 7428 290a 2020 2020 2020  urn set().      
-00016010: 2020 2020 2020 7265 636f 7264 735f 6865        records_he
-00016020: 6164 6572 7320 3d20 6f70 6572 6174 696f  aders = operatio
-00016030: 6e2e 7265 7669 6577 5f6d 616e 6167 6572  n.review_manager
-00016040: 2e64 6174 6173 6574 2e6c 6f61 645f 7265  .dataset.load_re
-00016050: 636f 7264 735f 6469 6374 280a 2020 2020  cords_dict(.    
-00016060: 2020 2020 2020 2020 2020 2020 6865 6164              head
-00016070: 6572 5f6f 6e6c 793d 5472 7565 0a20 2020  er_only=True.   
-00016080: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00016090: 2020 2020 2020 2072 6563 6f72 645f 6865         record_he
-000160a0: 6164 6572 5f6c 6973 7420 3d20 6c69 7374  ader_list = list
-000160b0: 2872 6563 6f72 6473 5f68 6561 6465 7273  (records_headers
-000160c0: 2e76 616c 7565 7328 2929 0a0a 2020 2020  .values())..    
-000160d0: 2020 2020 2020 2020 7265 7475 726e 207b          return {
-000160e0: 656c 5b22 636f 6c72 6576 5f73 7461 7475  el["colrev_statu
-000160f0: 7322 5d20 666f 7220 656c 2069 6e20 7265  s"] for el in re
-00016100: 636f 7264 5f68 6561 6465 725f 6c69 7374  cord_header_list
-00016110: 7d0a 0a20 2020 2020 2020 2069 6620 6f70  }..        if op
-00016120: 6572 6174 696f 6e2e 7265 7669 6577 5f6d  eration.review_m
-00016130: 616e 6167 6572 2e73 6574 7469 6e67 732e  anager.settings.
-00016140: 7072 6f6a 6563 742e 6465 6c61 795f 6175  project.delay_au
-00016150: 746f 6d61 7465 645f 7072 6f63 6573 7369  tomated_processi
-00016160: 6e67 3a0a 2020 2020 2020 2020 2020 2020  ng:.            
-00016170: 7374 6172 745f 7374 6174 6573 3a20 6c69  start_states: li
-00016180: 7374 5b73 7472 5d20 3d20 5b0a 2020 2020  st[str] = [.    
-00016190: 2020 2020 2020 2020 2020 2020 7374 7228              str(
-000161a0: 785b 2273 6f75 7263 6522 5d29 0a20 2020  x["source"]).   
-000161b0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-000161c0: 2078 2069 6e20 636f 6c72 6576 2e72 6563   x in colrev.rec
-000161d0: 6f72 642e 5265 636f 7264 5374 6174 654d  ord.RecordStateM
-000161e0: 6f64 656c 2e74 7261 6e73 6974 696f 6e73  odel.transitions
-000161f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016200: 2069 6620 7374 7228 6f70 6572 6174 696f   if str(operatio
-00016210: 6e2e 7479 7065 2920 3d3d 2078 5b22 7472  n.type) == x["tr
-00016220: 6967 6765 7222 5d0a 2020 2020 2020 2020  igger"].        
-00016230: 2020 2020 5d0a 2020 2020 2020 2020 2020      ].          
-00016240: 2020 7374 6174 6520 3d20 636f 6c72 6576    state = colrev
-00016250: 2e72 6563 6f72 642e 5265 636f 7264 5374  .record.RecordSt
-00016260: 6174 655b 7374 6172 745f 7374 6174 6573  ate[start_states
-00016270: 5b30 5d5d 0a0a 2020 2020 2020 2020 2020  [0]]..          
-00016280: 2020 6375 725f 7374 6174 655f 6c69 7374    cur_state_list
-00016290: 203d 2067 6574 5f73 7461 7465 735f 7365   = get_states_se
-000162a0: 7428 290a 2020 2020 2020 2020 2020 2020  t().            
-000162b0: 2320 7365 6c66 2e72 6576 6965 775f 6d61  # self.review_ma
-000162c0: 6e61 6765 722e 6c6f 6767 6572 2e64 6562  nager.logger.deb
-000162d0: 7567 2866 2263 7572 5f73 7461 7465 5f6c  ug(f"cur_state_l
-000162e0: 6973 743a 207b 6375 725f 7374 6174 655f  ist: {cur_state_
-000162f0: 6c69 7374 7d22 290a 2020 2020 2020 2020  list}").        
-00016300: 2020 2020 2320 7365 6c66 2e72 6576 6965      # self.revie
-00016310: 775f 6d61 6e61 6765 722e 6c6f 6767 6572  w_manager.logger
-00016320: 2e64 6562 7567 2866 2270 7265 636f 6e64  .debug(f"precond
-00016330: 6974 696f 6e3a 207b 7365 6c66 2e73 7461  ition: {self.sta
-00016340: 7465 7d22 290a 2020 2020 2020 2020 2020  te}").          
-00016350: 2020 7265 7175 6972 6564 5f61 6273 656e    required_absen
-00016360: 7420 3d20 636c 732e 6765 745f 7072 6563  t = cls.get_prec
-00016370: 6564 696e 675f 7374 6174 6573 2873 7461  eding_states(sta
-00016380: 7465 3d73 7461 7465 290a 2020 2020 2020  te=state).      
-00016390: 2020 2020 2020 2320 7365 6c66 2e72 6576        # self.rev
-000163a0: 6965 775f 6d61 6e61 6765 722e 6c6f 6767  iew_manager.logg
-000163b0: 6572 2e64 6562 7567 2866 2272 6571 7569  er.debug(f"requi
-000163c0: 7265 645f 6162 7365 6e74 3a20 7b72 6571  red_absent: {req
-000163d0: 7569 7265 645f 6162 7365 6e74 7d22 290a  uired_absent}").
-000163e0: 2020 2020 2020 2020 2020 2020 696e 7465              inte
-000163f0: 7273 6563 7469 6f6e 203d 2063 7572 5f73  rsection = cur_s
-00016400: 7461 7465 5f6c 6973 742e 696e 7465 7273  tate_list.inters
-00016410: 6563 7469 6f6e 2872 6571 7569 7265 645f  ection(required_
-00016420: 6162 7365 6e74 290a 2020 2020 2020 2020  absent).        
-00016430: 2020 2020 6966 2028 0a20 2020 2020 2020      if (.       
-00016440: 2020 2020 2020 2020 206c 656e 2863 7572           len(cur
-00016450: 5f73 7461 7465 5f6c 6973 7429 203d 3d20  _state_list) == 
-00016460: 300a 2020 2020 2020 2020 2020 2020 2020  0.              
-00016470: 2020 616e 6420 6e6f 7420 6f70 6572 6174    and not operat
-00016480: 696f 6e2e 7479 7065 2e6e 616d 6520 3d3d  ion.type.name ==
-00016490: 2022 6c6f 6164 2220 2023 2074 7970 653a   "load"  # type:
-000164a0: 2069 676e 6f72 650a 2020 2020 2020 2020   ignore.        
-000164b0: 2020 2020 293a 0a20 2020 2020 2020 2020      ):.         
-000164c0: 2020 2020 2020 2072 6169 7365 2063 6f6c         raise col
-000164d0: 7265 765f 6578 6365 7074 696f 6e73 2e4e  rev_exceptions.N
-000164e0: 6f52 6563 6f72 6473 4572 726f 7228 290a  oRecordsError().
-000164f0: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-00016500: 656e 2869 6e74 6572 7365 6374 696f 6e29  en(intersection)
-00016510: 2021 3d20 303a 0a20 2020 2020 2020 2020   != 0:.         
-00016520: 2020 2020 2020 2072 6169 7365 2063 6f6c         raise col
-00016530: 7265 765f 6578 6365 7074 696f 6e73 2e50  rev_exceptions.P
-00016540: 726f 6365 7373 4f72 6465 7256 696f 6c61  rocessOrderViola
-00016550: 7469 6f6e 280a 2020 2020 2020 2020 2020  tion(.          
-00016560: 2020 2020 2020 2020 2020 6f70 6572 6174            operat
-00016570: 696f 6e2e 7479 7065 2e6e 616d 652c 2073  ion.type.name, s
-00016580: 7472 2873 7461 7465 292c 206c 6973 7428  tr(state), list(
-00016590: 696e 7465 7273 6563 7469 6f6e 290a 2020  intersection).  
-000165a0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+000154a0: 7265 765f 7072 6573 6372 6565 6e5f 696e  rev_prescreen_in
+000154b0: 636c 7564 6564 2c0a 2020 2020 2020 2020  cluded,.        
+000154c0: 2020 2020 2264 6573 7422 3a20 5265 636f      "dest": Reco
+000154d0: 7264 5374 6174 652e 7064 665f 696d 706f  rdState.pdf_impo
+000154e0: 7274 6564 2c0a 2020 2020 2020 2020 7d2c  rted,.        },
+000154f0: 0a20 2020 2020 2020 207b 0a20 2020 2020  .        {.     
+00015500: 2020 2020 2020 2022 7472 6967 6765 7222         "trigger"
+00015510: 3a20 2270 6466 5f67 6574 222c 0a20 2020  : "pdf_get",.   
+00015520: 2020 2020 2020 2020 2022 736f 7572 6365           "source
+00015530: 223a 2052 6563 6f72 6453 7461 7465 2e72  ": RecordState.r
+00015540: 6576 5f70 7265 7363 7265 656e 5f69 6e63  ev_prescreen_inc
+00015550: 6c75 6465 642c 0a20 2020 2020 2020 2020  luded,.         
+00015560: 2020 2022 6465 7374 223a 2052 6563 6f72     "dest": Recor
+00015570: 6453 7461 7465 2e70 6466 5f6e 6565 6473  dState.pdf_needs
+00015580: 5f6d 616e 7561 6c5f 7265 7472 6965 7661  _manual_retrieva
+00015590: 6c2c 0a20 2020 2020 2020 207d 2c0a 2020  l,.        },.  
+000155a0: 2020 2020 2020 7b0a 2020 2020 2020 2020        {.        
+000155b0: 2020 2020 2274 7269 6767 6572 223a 2022      "trigger": "
+000155c0: 7064 665f 6765 745f 6d61 6e22 2c0a 2020  pdf_get_man",.  
+000155d0: 2020 2020 2020 2020 2020 2273 6f75 7263            "sourc
+000155e0: 6522 3a20 5265 636f 7264 5374 6174 652e  e": RecordState.
+000155f0: 7064 665f 6e65 6564 735f 6d61 6e75 616c  pdf_needs_manual
+00015600: 5f72 6574 7269 6576 616c 2c0a 2020 2020  _retrieval,.    
+00015610: 2020 2020 2020 2020 2264 6573 7422 3a20          "dest": 
+00015620: 5265 636f 7264 5374 6174 652e 7064 665f  RecordState.pdf_
+00015630: 6e6f 745f 6176 6169 6c61 626c 652c 0a20  not_available,. 
+00015640: 2020 2020 2020 207d 2c0a 2020 2020 2020         },.      
+00015650: 2020 7b0a 2020 2020 2020 2020 2020 2020    {.            
+00015660: 2274 7269 6767 6572 223a 2022 7064 665f  "trigger": "pdf_
+00015670: 6765 745f 6d61 6e22 2c0a 2020 2020 2020  get_man",.      
+00015680: 2020 2020 2020 2273 6f75 7263 6522 3a20        "source": 
+00015690: 5265 636f 7264 5374 6174 652e 7064 665f  RecordState.pdf_
+000156a0: 6e65 6564 735f 6d61 6e75 616c 5f72 6574  needs_manual_ret
+000156b0: 7269 6576 616c 2c0a 2020 2020 2020 2020  rieval,.        
+000156c0: 2020 2020 2264 6573 7422 3a20 5265 636f      "dest": Reco
+000156d0: 7264 5374 6174 652e 7064 665f 696d 706f  rdState.pdf_impo
+000156e0: 7274 6564 2c0a 2020 2020 2020 2020 7d2c  rted,.        },
+000156f0: 0a20 2020 2020 2020 207b 0a20 2020 2020  .        {.     
+00015700: 2020 2020 2020 2022 7472 6967 6765 7222         "trigger"
+00015710: 3a20 2270 6466 5f70 7265 7022 2c0a 2020  : "pdf_prep",.  
+00015720: 2020 2020 2020 2020 2020 2273 6f75 7263            "sourc
+00015730: 6522 3a20 5265 636f 7264 5374 6174 652e  e": RecordState.
+00015740: 7064 665f 696d 706f 7274 6564 2c0a 2020  pdf_imported,.  
+00015750: 2020 2020 2020 2020 2020 2264 6573 7422            "dest"
+00015760: 3a20 5265 636f 7264 5374 6174 652e 7064  : RecordState.pd
+00015770: 665f 6e65 6564 735f 6d61 6e75 616c 5f70  f_needs_manual_p
+00015780: 7265 7061 7261 7469 6f6e 2c0a 2020 2020  reparation,.    
+00015790: 2020 2020 7d2c 0a20 2020 2020 2020 207b      },.        {
+000157a0: 0a20 2020 2020 2020 2020 2020 2022 7472  .            "tr
+000157b0: 6967 6765 7222 3a20 2270 6466 5f70 7265  igger": "pdf_pre
+000157c0: 7022 2c0a 2020 2020 2020 2020 2020 2020  p",.            
+000157d0: 2273 6f75 7263 6522 3a20 5265 636f 7264  "source": Record
+000157e0: 5374 6174 652e 7064 665f 696d 706f 7274  State.pdf_import
+000157f0: 6564 2c0a 2020 2020 2020 2020 2020 2020  ed,.            
+00015800: 2264 6573 7422 3a20 5265 636f 7264 5374  "dest": RecordSt
+00015810: 6174 652e 7064 665f 7072 6570 6172 6564  ate.pdf_prepared
+00015820: 2c0a 2020 2020 2020 2020 7d2c 0a20 2020  ,.        },.   
+00015830: 2020 2020 207b 0a20 2020 2020 2020 2020       {.         
+00015840: 2020 2022 7472 6967 6765 7222 3a20 2270     "trigger": "p
+00015850: 6466 5f70 7265 705f 6d61 6e22 2c0a 2020  df_prep_man",.  
+00015860: 2020 2020 2020 2020 2020 2273 6f75 7263            "sourc
+00015870: 6522 3a20 5265 636f 7264 5374 6174 652e  e": RecordState.
+00015880: 7064 665f 6e65 6564 735f 6d61 6e75 616c  pdf_needs_manual
+00015890: 5f70 7265 7061 7261 7469 6f6e 2c0a 2020  _preparation,.  
+000158a0: 2020 2020 2020 2020 2020 2264 6573 7422            "dest"
+000158b0: 3a20 5265 636f 7264 5374 6174 652e 7064  : RecordState.pd
+000158c0: 665f 7072 6570 6172 6564 2c0a 2020 2020  f_prepared,.    
+000158d0: 2020 2020 7d2c 0a20 2020 2020 2020 207b      },.        {
+000158e0: 0a20 2020 2020 2020 2020 2020 2022 7472  .            "tr
+000158f0: 6967 6765 7222 3a20 2273 6372 6565 6e22  igger": "screen"
+00015900: 2c0a 2020 2020 2020 2020 2020 2020 2273  ,.            "s
+00015910: 6f75 7263 6522 3a20 5265 636f 7264 5374  ource": RecordSt
+00015920: 6174 652e 7064 665f 7072 6570 6172 6564  ate.pdf_prepared
+00015930: 2c0a 2020 2020 2020 2020 2020 2020 2264  ,.            "d
+00015940: 6573 7422 3a20 5265 636f 7264 5374 6174  est": RecordStat
+00015950: 652e 7265 765f 6578 636c 7564 6564 2c0a  e.rev_excluded,.
+00015960: 2020 2020 2020 2020 7d2c 0a20 2020 2020          },.     
+00015970: 2020 207b 0a20 2020 2020 2020 2020 2020     {.           
+00015980: 2022 7472 6967 6765 7222 3a20 2273 6372   "trigger": "scr
+00015990: 6565 6e22 2c0a 2020 2020 2020 2020 2020  een",.          
+000159a0: 2020 2273 6f75 7263 6522 3a20 5265 636f    "source": Reco
+000159b0: 7264 5374 6174 652e 7064 665f 7072 6570  rdState.pdf_prep
+000159c0: 6172 6564 2c0a 2020 2020 2020 2020 2020  ared,.          
+000159d0: 2020 2264 6573 7422 3a20 5265 636f 7264    "dest": Record
+000159e0: 5374 6174 652e 7265 765f 696e 636c 7564  State.rev_includ
+000159f0: 6564 2c0a 2020 2020 2020 2020 7d2c 0a20  ed,.        },. 
+00015a00: 2020 2020 2020 207b 0a20 2020 2020 2020         {.       
+00015a10: 2020 2020 2022 7472 6967 6765 7222 3a20       "trigger": 
+00015a20: 2264 6174 6122 2c0a 2020 2020 2020 2020  "data",.        
+00015a30: 2020 2020 2273 6f75 7263 6522 3a20 5265      "source": Re
+00015a40: 636f 7264 5374 6174 652e 7265 765f 696e  cordState.rev_in
+00015a50: 636c 7564 6564 2c0a 2020 2020 2020 2020  cluded,.        
+00015a60: 2020 2020 2264 6573 7422 3a20 5265 636f      "dest": Reco
+00015a70: 7264 5374 6174 652e 7265 765f 7379 6e74  rdState.rev_synt
+00015a80: 6865 7369 7a65 642c 0a20 2020 2020 2020  hesized,.       
+00015a90: 207d 2c0a 2020 2020 5d0a 0a20 2020 2074   },.    ]..    t
+00015aa0: 7261 6e73 6974 696f 6e73 5f6e 6f6e 5f70  ransitions_non_p
+00015ab0: 726f 6365 7373 696e 6720 3d20 5b0a 2020  rocessing = [.  
+00015ac0: 2020 2020 2020 6974 656d 2066 6f72 2073        item for s
+00015ad0: 7562 6c69 7374 2069 6e20 6e6f 6e5f 7072  ublist in non_pr
+00015ae0: 6f63 6573 7369 6e67 5f74 7261 6e73 6974  ocessing_transit
+00015af0: 696f 6e73 2066 6f72 2069 7465 6d20 696e  ions for item in
+00015b00: 2073 7562 6c69 7374 0a20 2020 205d 0a0a   sublist.    ]..
+00015b10: 2020 2020 2320 6672 6f6d 2074 7261 6e73      # from trans
+00015b20: 6974 696f 6e73 2069 6d70 6f72 7420 4d61  itions import Ma
+00015b30: 6368 696e 650a 2020 2020 2320 6465 6620  chine.    # def 
+00015b40: 5f5f 696e 6974 5f5f 280a 2020 2020 2320  __init__(.    # 
+00015b50: 2020 2020 7365 6c66 2c0a 2020 2020 2320      self,.    # 
+00015b60: 2020 2020 2a2c 0a20 2020 2023 2020 2020      *,.    #    
+00015b70: 2073 7461 7465 3a20 5265 636f 7264 5374   state: RecordSt
+00015b80: 6174 652c 0a20 2020 2023 2029 202d 3e20  ate,.    # ) -> 
+00015b90: 4e6f 6e65 3a0a 2020 2020 2320 2020 2020  None:.    #     
+00015ba0: 7365 6c66 2e73 7461 7465 203d 2073 7461  self.state = sta
+00015bb0: 7465 0a0a 2020 2020 2320 2020 2020 7365  te..    #     se
+00015bc0: 6c66 2e6d 6163 6869 6e65 203d 204d 6163  lf.machine = Mac
+00015bd0: 6869 6e65 280a 2020 2020 2320 2020 2020  hine(.    #     
+00015be0: 2020 2020 6d6f 6465 6c3d 7365 6c66 2c0a      model=self,.
+00015bf0: 2020 2020 2320 2020 2020 2020 2020 7374      #         st
+00015c00: 6174 6573 3d52 6563 6f72 6453 7461 7465  ates=RecordState
+00015c10: 2c0a 2020 2020 2320 2020 2020 2020 2020  ,.    #         
+00015c20: 7472 616e 7369 7469 6f6e 733d 7365 6c66  transitions=self
+00015c30: 2e74 7261 6e73 6974 696f 6e73 202b 2073  .transitions + s
+00015c40: 656c 662e 7472 616e 7369 7469 6f6e 735f  elf.transitions_
+00015c50: 6e6f 6e5f 7072 6f63 6573 7369 6e67 2c0a  non_processing,.
+00015c60: 2020 2020 2320 2020 2020 2020 2020 696e      #         in
+00015c70: 6974 6961 6c3d 7365 6c66 2e73 7461 7465  itial=self.state
+00015c80: 2c0a 2020 2020 2320 2020 2020 290a 0a20  ,.    #     ).. 
+00015c90: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
+00015ca0: 2020 2020 6465 6620 6765 745f 7661 6c69      def get_vali
+00015cb0: 645f 7472 616e 7369 7469 6f6e 7328 636c  d_transitions(cl
+00015cc0: 732c 202a 2c20 7374 6174 653a 2052 6563  s, *, state: Rec
+00015cd0: 6f72 6453 7461 7465 2920 2d3e 2073 6574  ordState) -> set
+00015ce0: 3a0a 2020 2020 2020 2020 2222 2247 6574  :.        """Get
+00015cf0: 2074 6865 206c 6973 7420 6f66 2076 616c   the list of val
+00015d00: 6964 2074 7261 6e73 6974 696f 6e73 2222  id transitions""
+00015d10: 220a 2020 2020 2020 2020 6c6f 6767 696e  ".        loggin
+00015d20: 672e 6765 744c 6f67 6765 7228 2274 7261  g.getLogger("tra
+00015d30: 6e73 6974 696f 6e73 2229 2e73 6574 4c65  nsitions").setLe
+00015d40: 7665 6c28 6c6f 6767 696e 672e 5741 524e  vel(logging.WARN
+00015d50: 494e 4729 0a20 2020 2020 2020 2072 6574  ING).        ret
+00015d60: 7572 6e20 7365 7428 7b78 5b22 7472 6967  urn set({x["trig
+00015d70: 6765 7222 5d20 666f 7220 7820 696e 2063  ger"] for x in c
+00015d80: 6c73 2e74 7261 6e73 6974 696f 6e73 2069  ls.transitions i
+00015d90: 6620 785b 2273 6f75 7263 6522 5d20 3d3d  f x["source"] ==
+00015da0: 2073 7461 7465 7d29 0a0a 2020 2020 4063   state})..    @c
+00015db0: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
+00015dc0: 6566 2067 6574 5f70 7265 6365 6469 6e67  ef get_preceding
+00015dd0: 5f73 7461 7465 7328 636c 732c 202a 2c20  _states(cls, *, 
+00015de0: 7374 6174 653a 2052 6563 6f72 6453 7461  state: RecordSta
+00015df0: 7465 2920 2d3e 2073 6574 3a0a 2020 2020  te) -> set:.    
+00015e00: 2020 2020 2222 2247 6574 2074 6865 2073      """Get the s
+00015e10: 7461 7465 7320 7072 6563 6564 696e 6720  tates preceding 
+00015e20: 7468 6520 7374 6174 6520 7468 6174 2069  the state that i
+00015e30: 7320 6769 7665 6e20 6173 2061 2070 6172  s given as a par
+00015e40: 616d 6574 6572 2222 220a 0a20 2020 2020  ameter"""..     
+00015e50: 2020 206c 6f67 6769 6e67 2e67 6574 4c6f     logging.getLo
+00015e60: 6767 6572 2822 7472 616e 7369 7469 6f6e  gger("transition
+00015e70: 7322 292e 7365 744c 6576 656c 286c 6f67  s").setLevel(log
+00015e80: 6769 6e67 2e57 4152 4e49 4e47 290a 2020  ging.WARNING).  
+00015e90: 2020 2020 2020 7072 6563 6564 696e 675f        preceding_
+00015ea0: 7374 6174 6573 3a20 7365 745b 5265 636f  states: set[Reco
+00015eb0: 7264 5374 6174 655d 203d 2073 6574 2829  rdState] = set()
+00015ec0: 0a20 2020 2020 2020 2061 6464 6564 203d  .        added =
+00015ed0: 2054 7275 650a 2020 2020 2020 2020 7768   True.        wh
+00015ee0: 696c 6520 6164 6465 643a 0a20 2020 2020  ile added:.     
+00015ef0: 2020 2020 2020 2070 7265 6365 6469 6e67         preceding
+00015f00: 5f73 7461 7465 735f 7369 7a65 203d 206c  _states_size = l
+00015f10: 656e 2870 7265 6365 6469 6e67 5f73 7461  en(preceding_sta
+00015f20: 7465 7329 0a20 2020 2020 2020 2020 2020  tes).           
+00015f30: 2066 6f72 2074 7261 6e73 6974 696f 6e20   for transition 
+00015f40: 696e 2052 6563 6f72 6453 7461 7465 4d6f  in RecordStateMo
+00015f50: 6465 6c2e 7472 616e 7369 7469 6f6e 733a  del.transitions:
+00015f60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015f70: 2069 6620 280a 2020 2020 2020 2020 2020   if (.          
+00015f80: 2020 2020 2020 2020 2020 7472 616e 7369            transi
+00015f90: 7469 6f6e 5b22 6465 7374 225d 2069 6e20  tion["dest"] in 
+00015fa0: 7072 6563 6564 696e 675f 7374 6174 6573  preceding_states
+00015fb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015fc0: 2020 2020 206f 7220 7374 6174 6520 3d3d       or state ==
+00015fd0: 2074 7261 6e73 6974 696f 6e5b 2264 6573   transition["des
+00015fe0: 7422 5d0a 2020 2020 2020 2020 2020 2020  t"].            
+00015ff0: 2020 2020 293a 0a20 2020 2020 2020 2020      ):.         
+00016000: 2020 2020 2020 2020 2020 2070 7265 6365             prece
+00016010: 6469 6e67 5f73 7461 7465 732e 6164 6428  ding_states.add(
+00016020: 7472 616e 7369 7469 6f6e 5b22 736f 7572  transition["sour
+00016030: 6365 225d 2920 2023 2074 7970 653a 2069  ce"])  # type: i
+00016040: 676e 6f72 650a 2020 2020 2020 2020 2020  gnore.          
+00016050: 2020 6966 2070 7265 6365 6469 6e67 5f73    if preceding_s
+00016060: 7461 7465 735f 7369 7a65 203d 3d20 6c65  tates_size == le
+00016070: 6e28 7072 6563 6564 696e 675f 7374 6174  n(preceding_stat
+00016080: 6573 293a 0a20 2020 2020 2020 2020 2020  es):.           
+00016090: 2020 2020 2061 6464 6564 203d 2046 616c       added = Fal
+000160a0: 7365 0a20 2020 2020 2020 2072 6574 7572  se.        retur
+000160b0: 6e20 7072 6563 6564 696e 675f 7374 6174  n preceding_stat
+000160c0: 6573 0a0a 2020 2020 4063 6c61 7373 6d65  es..    @classme
+000160d0: 7468 6f64 0a20 2020 2064 6566 2063 6865  thod.    def che
+000160e0: 636b 5f6f 7065 7261 7469 6f6e 5f70 7265  ck_operation_pre
+000160f0: 636f 6e64 6974 696f 6e28 0a20 2020 2020  condition(.     
+00016100: 2020 2063 6c73 2c20 2a2c 206f 7065 7261     cls, *, opera
+00016110: 7469 6f6e 3a20 636f 6c72 6576 2e6f 7065  tion: colrev.ope
+00016120: 7261 7469 6f6e 2e4f 7065 7261 7469 6f6e  ration.Operation
+00016130: 0a20 2020 2029 202d 3e20 4e6f 6e65 3a0a  .    ) -> None:.
+00016140: 2020 2020 2020 2020 2222 2243 6865 636b          """Check
+00016150: 2074 6865 2070 7265 636f 6e64 6974 696f   the preconditio
+00016160: 6e73 2066 6f72 2061 6e20 6f70 6572 6174  ns for an operat
+00016170: 696f 6e22 2222 0a0a 2020 2020 2020 2020  ion"""..        
+00016180: 6465 6620 6765 745f 7374 6174 6573 5f73  def get_states_s
+00016190: 6574 2829 202d 3e20 7365 743a 0a20 2020  et() -> set:.   
+000161a0: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+000161b0: 6f70 6572 6174 696f 6e2e 7265 7669 6577  operation.review
+000161c0: 5f6d 616e 6167 6572 2e64 6174 6173 6574  _manager.dataset
+000161d0: 2e72 6563 6f72 6473 5f66 696c 652e 6973  .records_file.is
+000161e0: 5f66 696c 6528 293a 0a20 2020 2020 2020  _file():.       
+000161f0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00016200: 7365 7428 290a 2020 2020 2020 2020 2020  set().          
+00016210: 2020 7265 636f 7264 735f 6865 6164 6572    records_header
+00016220: 7320 3d20 6f70 6572 6174 696f 6e2e 7265  s = operation.re
+00016230: 7669 6577 5f6d 616e 6167 6572 2e64 6174  view_manager.dat
+00016240: 6173 6574 2e6c 6f61 645f 7265 636f 7264  aset.load_record
+00016250: 735f 6469 6374 280a 2020 2020 2020 2020  s_dict(.        
+00016260: 2020 2020 2020 2020 6865 6164 6572 5f6f          header_o
+00016270: 6e6c 793d 5472 7565 0a20 2020 2020 2020  nly=True.       
+00016280: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+00016290: 2020 2072 6563 6f72 645f 6865 6164 6572     record_header
+000162a0: 5f6c 6973 7420 3d20 6c69 7374 2872 6563  _list = list(rec
+000162b0: 6f72 6473 5f68 6561 6465 7273 2e76 616c  ords_headers.val
+000162c0: 7565 7328 2929 0a0a 2020 2020 2020 2020  ues())..        
+000162d0: 2020 2020 7265 7475 726e 207b 656c 5b22      return {el["
+000162e0: 636f 6c72 6576 5f73 7461 7475 7322 5d20  colrev_status"] 
+000162f0: 666f 7220 656c 2069 6e20 7265 636f 7264  for el in record
+00016300: 5f68 6561 6465 725f 6c69 7374 7d0a 0a20  _header_list}.. 
+00016310: 2020 2020 2020 2069 6620 6f70 6572 6174         if operat
+00016320: 696f 6e2e 7265 7669 6577 5f6d 616e 6167  ion.review_manag
+00016330: 6572 2e73 6574 7469 6e67 732e 7072 6f6a  er.settings.proj
+00016340: 6563 742e 6465 6c61 795f 6175 746f 6d61  ect.delay_automa
+00016350: 7465 645f 7072 6f63 6573 7369 6e67 3a0a  ted_processing:.
+00016360: 2020 2020 2020 2020 2020 2020 7374 6172              star
+00016370: 745f 7374 6174 6573 3a20 6c69 7374 5b73  t_states: list[s
+00016380: 7472 5d20 3d20 5b0a 2020 2020 2020 2020  tr] = [.        
+00016390: 2020 2020 2020 2020 7374 7228 785b 2273          str(x["s
+000163a0: 6f75 7263 6522 5d29 0a20 2020 2020 2020  ource"]).       
+000163b0: 2020 2020 2020 2020 2066 6f72 2078 2069           for x i
+000163c0: 6e20 636f 6c72 6576 2e72 6563 6f72 642e  n colrev.record.
+000163d0: 5265 636f 7264 5374 6174 654d 6f64 656c  RecordStateModel
+000163e0: 2e74 7261 6e73 6974 696f 6e73 0a20 2020  .transitions.   
+000163f0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00016400: 7374 7228 6f70 6572 6174 696f 6e2e 7479  str(operation.ty
+00016410: 7065 2920 3d3d 2078 5b22 7472 6967 6765  pe) == x["trigge
+00016420: 7222 5d0a 2020 2020 2020 2020 2020 2020  r"].            
+00016430: 5d0a 2020 2020 2020 2020 2020 2020 7374  ].            st
+00016440: 6174 6520 3d20 636f 6c72 6576 2e72 6563  ate = colrev.rec
+00016450: 6f72 642e 5265 636f 7264 5374 6174 655b  ord.RecordState[
+00016460: 7374 6172 745f 7374 6174 6573 5b30 5d5d  start_states[0]]
+00016470: 0a0a 2020 2020 2020 2020 2020 2020 6375  ..            cu
+00016480: 725f 7374 6174 655f 6c69 7374 203d 2067  r_state_list = g
+00016490: 6574 5f73 7461 7465 735f 7365 7428 290a  et_states_set().
+000164a0: 2020 2020 2020 2020 2020 2020 2320 7365              # se
+000164b0: 6c66 2e72 6576 6965 775f 6d61 6e61 6765  lf.review_manage
+000164c0: 722e 6c6f 6767 6572 2e64 6562 7567 2866  r.logger.debug(f
+000164d0: 2263 7572 5f73 7461 7465 5f6c 6973 743a  "cur_state_list:
+000164e0: 207b 6375 725f 7374 6174 655f 6c69 7374   {cur_state_list
+000164f0: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
+00016500: 2320 7365 6c66 2e72 6576 6965 775f 6d61  # self.review_ma
+00016510: 6e61 6765 722e 6c6f 6767 6572 2e64 6562  nager.logger.deb
+00016520: 7567 2866 2270 7265 636f 6e64 6974 696f  ug(f"preconditio
+00016530: 6e3a 207b 7365 6c66 2e73 7461 7465 7d22  n: {self.state}"
+00016540: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+00016550: 7175 6972 6564 5f61 6273 656e 7420 3d20  quired_absent = 
+00016560: 636c 732e 6765 745f 7072 6563 6564 696e  cls.get_precedin
+00016570: 675f 7374 6174 6573 2873 7461 7465 3d73  g_states(state=s
+00016580: 7461 7465 290a 2020 2020 2020 2020 2020  tate).          
+00016590: 2020 2320 7365 6c66 2e72 6576 6965 775f    # self.review_
+000165a0: 6d61 6e61 6765 722e 6c6f 6767 6572 2e64  manager.logger.d
+000165b0: 6562 7567 2866 2272 6571 7569 7265 645f  ebug(f"required_
+000165c0: 6162 7365 6e74 3a20 7b72 6571 7569 7265  absent: {require
+000165d0: 645f 6162 7365 6e74 7d22 290a 2020 2020  d_absent}").    
+000165e0: 2020 2020 2020 2020 696e 7465 7273 6563          intersec
+000165f0: 7469 6f6e 203d 2063 7572 5f73 7461 7465  tion = cur_state
+00016600: 5f6c 6973 742e 696e 7465 7273 6563 7469  _list.intersecti
+00016610: 6f6e 2872 6571 7569 7265 645f 6162 7365  on(required_abse
+00016620: 6e74 290a 2020 2020 2020 2020 2020 2020  nt).            
+00016630: 6966 2028 0a20 2020 2020 2020 2020 2020  if (.           
+00016640: 2020 2020 206c 656e 2863 7572 5f73 7461       len(cur_sta
+00016650: 7465 5f6c 6973 7429 203d 3d20 300a 2020  te_list) == 0.  
+00016660: 2020 2020 2020 2020 2020 2020 2020 616e                an
+00016670: 6420 6e6f 7420 6f70 6572 6174 696f 6e2e  d not operation.
+00016680: 7479 7065 2e6e 616d 6520 3d3d 2022 6c6f  type.name == "lo
+00016690: 6164 2220 2023 2074 7970 653a 2069 676e  ad"  # type: ign
+000166a0: 6f72 650a 2020 2020 2020 2020 2020 2020  ore.            
+000166b0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+000166c0: 2020 2072 6169 7365 2063 6f6c 7265 765f     raise colrev_
+000166d0: 6578 6365 7074 696f 6e73 2e4e 6f52 6563  exceptions.NoRec
+000166e0: 6f72 6473 4572 726f 7228 290a 2020 2020  ordsError().    
+000166f0: 2020 2020 2020 2020 6966 206c 656e 2869          if len(i
+00016700: 6e74 6572 7365 6374 696f 6e29 2021 3d20  ntersection) != 
+00016710: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
+00016720: 2020 2072 6169 7365 2063 6f6c 7265 765f     raise colrev_
+00016730: 6578 6365 7074 696f 6e73 2e50 726f 6365  exceptions.Proce
+00016740: 7373 4f72 6465 7256 696f 6c61 7469 6f6e  ssOrderViolation
+00016750: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00016760: 2020 2020 2020 6f70 6572 6174 696f 6e2e        operation.
+00016770: 7479 7065 2e6e 616d 652c 2073 7472 2873  type.name, str(s
+00016780: 7461 7465 292c 206c 6973 7428 696e 7465  tate), list(inte
+00016790: 7273 6563 7469 6f6e 290a 2020 2020 2020  rsection).      
+000167a0: 2020 2020 2020 2020 2020 290a                      ).
```

### Comparing `colrev-0.9.2/colrev/review_manager.py` & `colrev-0.9.3/colrev/review_manager.py`

 * *Files 1% similar despite different names*

```diff
@@ -59,14 +59,16 @@
 
     dataset: colrev.dataset.Dataset
     """The review dataset object"""
 
     path: Path
     """Path of the project repository"""
 
+    shell_mode = False
+
     def __init__(
         self,
         *,
         path_str: Optional[str] = None,
         force_mode: bool = False,
         verbose_mode: bool = False,
         debug_mode: bool = False,
@@ -694,21 +696,14 @@
     def get_pull_operation(self) -> colrev.ops.pull.Pull:
         """Get a pull operation object"""
 
         import colrev.ops.pull
 
         return colrev.ops.pull.Pull(review_manager=self)
 
-    def get_service_operation(self) -> colrev.service.Service:
-        """Get a service operation object"""
-
-        import colrev.service
-
-        return colrev.service.Service(review_manager=self)
-
     def get_search_sources(self) -> colrev.ops.search_sources.SearchSources:
         """Get a SearchSources object"""
 
         import colrev.ops.search_sources
 
         return colrev.ops.search_sources.SearchSources(review_manager=self)
```

### Comparing `colrev-0.9.2/colrev/settings.py` & `colrev-0.9.3/colrev/settings.py`

 * *Files 2% similar despite different names*

```diff
@@ -156,25 +156,36 @@
 
 
 @dataclass
 class SearchSource(JsonSchemaMixin):
     """Search source settings"""
 
     # pylint: disable=too-many-instance-attributes
-
     endpoint: str
     filename: Path
     search_type: SearchType
     search_parameters: dict
     comment: typing.Optional[str]
 
-    def get_corresponding_bib_file(self) -> Path:
-        """Get the corresponding bib file"""
-
-        return self.filename.with_suffix(".bib")
+    def __init__(
+        self,
+        *,
+        endpoint: str,
+        filename: Path,
+        search_type: SearchType,
+        search_parameters: dict,
+        comment: typing.Optional[str],
+    ) -> None:
+        self.endpoint = endpoint
+        assert filename.parent.name == "search"
+        assert filename.parent.parent.name == "data"
+        self.filename = filename
+        self.search_type = search_type
+        self.search_parameters = search_parameters
+        self.comment = comment
 
     def setup_for_load(
         self,
         *,
         source_records_list: typing.List[typing.Dict],
         imported_origins: typing.List[str],
     ) -> None:
@@ -187,16 +198,17 @@
         self.to_import = len(source_records_list)
         self.imported_origins: typing.List[str] = imported_origins
         self.len_before = len(imported_origins)
         self.source_records_list: typing.List[typing.Dict] = source_records_list
 
     def get_origin_prefix(self) -> str:
         """Get the corresponding origin prefix"""
+        assert not any(x in str(self.filename.name) for x in [";", "/"])
         return (
-            str(self.get_corresponding_bib_file().name)
+            str(self.filename.name)
             .replace(str(colrev.review_manager.ReviewManager.SEARCHDIR_RELATIVE), "")
             .lstrip("/")
         )
 
     def is_md_source(self) -> bool:
         """Check whether the source is a metadata source (for preparation)"""
```

### Comparing `colrev-0.9.2/colrev/template/custom_scripts/custom_data_script.py` & `colrev-0.9.3/colrev/template/custom_scripts/custom_data_script.py`

 * *Files 20% similar despite different names*

```diff
@@ -23,23 +23,17 @@
         self,
         *,
         data_operation: colrev.ops.data.Data,  # pylint: disable=unused-argument
         settings: dict,
     ) -> None:
         self.settings = from_dict(data_class=self.settings_class, data=settings)
 
-    def get_default_setup(self) -> dict:
-        """Get the default setup for the custom data script"""
-
-        custom_endpoint_details = {
-            "endpoint": "CustomDataFormat",
-            "custom_data_format_version": "0.1",
-            "config": {},
-        }
-        return custom_endpoint_details
+    @classmethod
+    def add_endpoint(cls, operation: colrev.ops.data.Data, params: str) -> None:
+        """Add as an endpoint"""
 
     def update_data(
         self,
         data_operation: colrev.ops.data.Data,  # pylint: disable=unused-argument
         records: dict,  # pylint: disable=unused-argument
         synthesized_record_status_matrix: dict,  # pylint: disable=unused-argument
     ) -> None:
```

### Comparing `colrev-0.9.2/colrev/template/custom_scripts/custom_pdf_get_script.py` & `colrev-0.9.3/colrev/template/custom_scripts/custom_pdf_get_script.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/template/custom_scripts/custom_pdf_prep_script.py` & `colrev-0.9.3/colrev/template/custom_scripts/custom_pdf_prep_script.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/template/custom_scripts/custom_prep_script.py` & `colrev-0.9.3/colrev/template/custom_scripts/custom_prep_script.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/template/custom_scripts/custom_prescreen_script.py` & `colrev-0.9.3/colrev/template/custom_scripts/custom_prescreen_script.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/template/custom_scripts/custom_screen_script.py` & `colrev-0.9.3/colrev/template/custom_scripts/custom_screen_script.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/template/custom_scripts/custom_search_source_script.py` & `colrev-0.9.3/colrev/template/custom_scripts/custom_search_source_script.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/template/example/30_example_records.bib` & `colrev-0.9.3/colrev/template/example/30_example_records.bib`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/template/github_pages/index.html` & `colrev-0.9.3/colrev/template/github_pages/index.html`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/template/init/LICENSE-CC-BY-4.0.txt` & `colrev-0.9.3/colrev/template/init/LICENSE-CC-BY-4.0.txt`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/template/init/colrev_update.yml` & `colrev-0.9.3/colrev/template/init/colrev_update.yml`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/template/init/colrev_update_curation.yml` & `colrev-0.9.3/colrev/template/init/colrev_update_curation.yml`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/template/init/pre-commit-config.yaml` & `colrev-0.9.3/colrev/template/init/pre-commit-config.yaml`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/template/init/settings.json` & `colrev-0.9.3/colrev/template/init/settings.json`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/template/ops/commit_report_details.txt` & `colrev-0.9.3/colrev/template/ops/commit_report_details.txt`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/template/ops/journal_rankings.csv` & `colrev-0.9.3/colrev/template/ops/journal_rankings.csv`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/template/ops/prep_man_curation.ipynb` & `colrev-0.9.3/colrev/template/ops/prep_man_curation.ipynb`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/template/ops/status.txt` & `colrev-0.9.3/colrev/template/ops/status.txt`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/template/package_endpoints.json` & `colrev-0.9.3/colrev/template/package_endpoints.json`

 * *Files 2% similar despite different names*

#### Pretty-printed

 * *Similarity: 0.9551504629629631%*

 * *Differences: {"'data'": "{0: {'short_description': 'Export the sample references in Endpoint format "*

 * *           '(`instructions '*

 * *           "<https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/data/bibliography_export.md>`__)'}, "*

 * *           "1: {'short_description': 'CoLRev Curation (`instructions "*

 * *           "<https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/data/colrev_curation.md>`__)'}, "*

 * *           "2: {'short_description': 'Export the literature review into a G []*

```diff
@@ -1,794 +1,802 @@
 {
     "data": [
         {
             "ci_supported": false,
             "endpoint": "colrev.ops.built_in.data.bibliography_export.BibliographyExport",
             "package_endpoint_identifier": "colrev.bibliography_export",
-            "short_description": "Export the sample references in Endpoint format (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/data/bibliography_export.md>`_)",
+            "short_description": "Export the sample references in Endpoint format (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/data/bibliography_export.md>`__)",
             "status": "|MATURING|",
             "status_linked": "|MATURING|"
         },
         {
             "ci_supported": true,
             "endpoint": "colrev.ops.built_in.data.colrev_curation.ColrevCuration",
             "package_endpoint_identifier": "colrev.colrev_curation",
-            "short_description": "CoLRev Curation (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/data/colrev_curation.md>`_)",
+            "short_description": "CoLRev Curation (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/data/colrev_curation.md>`__)",
             "status": "|MATURING|",
             "status_linked": "|MATURING|"
         },
         {
             "ci_supported": false,
             "endpoint": "colrev.ops.built_in.data.github_pages.GithubPages",
             "package_endpoint_identifier": "colrev.github_pages",
-            "short_description": "Export the literature review into a Github Page (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/data/github_pages.md>`_)",
+            "short_description": "Export the literature review into a Github Page (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/data/github_pages.md>`__)",
             "status": "|MATURING|",
             "status_linked": "|MATURING|"
         },
         {
             "ci_supported": false,
             "endpoint": "colrev.ops.built_in.data.obsidian.Obsidian",
             "package_endpoint_identifier": "colrev.obsidian",
-            "short_description": "Export the sample into an Obsidian database (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/data/obsidian.md>`_)",
+            "short_description": "Export the sample into an Obsidian database (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/data/obsidian.md>`__)",
             "status": "|EXPERIMENTAL|",
             "status_linked": "|EXPERIMENTAL|"
         },
         {
             "ci_supported": false,
             "endpoint": "colrev.ops.built_in.data.paper_md.PaperMarkdown",
             "package_endpoint_identifier": "colrev.paper_md",
-            "short_description": "Synthesize the literature in a markdown paper (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/data/paper_md.md>`_)",
+            "short_description": "Synthesize the literature in a markdown paper (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/data/paper_md.md>`__)",
             "status": "|MATURING|",
             "status_linked": "|MATURING|"
         },
         {
             "ci_supported": false,
             "endpoint": "colrev.ops.built_in.data.prisma.PRISMA",
             "package_endpoint_identifier": "colrev.prisma",
-            "short_description": "Create a PRISMA diagram (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/data/prisma.md>`_)",
+            "short_description": "Create a PRISMA diagram (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/data/prisma.md>`__)",
             "status": "|EXPERIMENTAL|",
             "status_linked": "|EXPERIMENTAL|"
         },
         {
             "ci_supported": false,
             "endpoint": "colrev.ops.built_in.data.structured.StructuredData",
             "package_endpoint_identifier": "colrev.structured",
-            "short_description": "Summarize the literature in a structured data extraction (a table) (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/data/structured.md>`_)",
+            "short_description": "Summarize the literature in a structured data extraction (a table) (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/data/structured.md>`__)",
             "status": "|EXPERIMENTAL|",
             "status_linked": "|EXPERIMENTAL|"
         }
     ],
     "dedupe": [
         {
             "ci_supported": false,
             "endpoint": "colrev.ops.built_in.dedupe.active_learning_dedup_io.ActiveLearningDedupeAutomated",
             "package_endpoint_identifier": "colrev.active_learning_automated",
-            "short_description": "Applies trained (active learning) model (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/dedupe/active_learning_dedup_io.md>`_)",
+            "short_description": "Applies trained (active learning) model (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/dedupe/active_learning_dedup_io.md>`__)",
             "status": "|EXPERIMENTAL|",
             "status_linked": "|EXPERIMENTAL|"
         },
         {
             "ci_supported": false,
             "endpoint": "colrev.ops.built_in.dedupe.active_learning_dedup_io.ActiveLearningDedupeTraining",
             "package_endpoint_identifier": "colrev.active_learning_training",
-            "short_description": "Active learning: training phase (minimum sample size of 50 required) (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/dedupe/active_learning_dedup_io.md>`_)",
+            "short_description": "Active learning: training phase (minimum sample size of 50 required) (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/dedupe/active_learning_dedup_io.md>`__)",
             "status": "|EXPERIMENTAL|",
             "status_linked": "|EXPERIMENTAL|"
         },
         {
             "ci_supported": true,
             "endpoint": "colrev.ops.built_in.dedupe.curation_dedupe.CurationDedupe",
             "package_endpoint_identifier": "colrev.curation_full_outlet_dedupe",
-            "short_description": "Deduplication endpoint for curations with full journals/proceedings (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/dedupe/curation_dedupe.md>`_)",
+            "short_description": "Deduplication endpoint for curations with full journals/proceedings (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/dedupe/curation_dedupe.md>`__)",
             "status": "|EXPERIMENTAL|",
             "status_linked": "|EXPERIMENTAL|"
         },
         {
             "ci_supported": false,
             "endpoint": "colrev.ops.built_in.dedupe.curation_missing_dedupe.CurationMissingDedupe",
             "package_endpoint_identifier": "colrev.curation_missing_dedupe",
-            "short_description": "Deduplication of remaining records in a curated metadata repository (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/dedupe/curation_missing_dedupe.md>`_)",
+            "short_description": "Deduplication of remaining records in a curated metadata repository (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/dedupe/curation_missing_dedupe.md>`__)",
             "status": "|EXPERIMENTAL|",
             "status_linked": "|EXPERIMENTAL|"
         },
         {
             "ci_supported": true,
             "endpoint": "colrev.ops.built_in.dedupe.simple_dedupe.SimpleDedupe",
             "package_endpoint_identifier": "colrev.simple_dedupe",
-            "short_description": "Simple duplicate identification (for small sample sizes) (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/dedupe/simple_dedupe.md>`_)",
+            "short_description": "Simple duplicate identification (for small sample sizes) (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/dedupe/simple_dedupe.md>`__)",
             "status": "|MATURING|",
             "status_linked": "|MATURING|"
         }
     ],
     "pdf_get": [
         {
             "ci_supported": false,
             "endpoint": "colrev.ops.built_in.pdf_get.local_index_pdf_get.LocalIndexPDFGet",
             "package_endpoint_identifier": "colrev.local_index",
-            "short_description": "Get PDFs from LocalIndex (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/pdf_get/local_index_pdf_get.md>`_)",
+            "short_description": "Get PDFs from LocalIndex (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/pdf_get/local_index_pdf_get.md>`__)",
             "status": "|MATURING|",
             "status_linked": "|MATURING|"
         },
         {
             "ci_supported": false,
             "endpoint": "colrev.ops.built_in.pdf_get.unpaywall.Unpaywall",
             "package_endpoint_identifier": "colrev.unpaywall",
-            "short_description": "Get PDFs from unpaywall.org (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/pdf_get/unpaywall.md>`_)",
+            "short_description": "Get PDFs from unpaywall.org (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/pdf_get/unpaywall.md>`__)",
             "status": "|MATURING|",
             "status_linked": "|MATURING|"
         },
         {
             "ci_supported": false,
             "endpoint": "colrev.ops.built_in.pdf_get.website_screenshot.WebsiteScreenshot",
             "package_endpoint_identifier": "colrev.website_screenshot",
-            "short_description": "Get PDFs from website screenshot (for \"online\" ENTRYTYPES) (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/pdf_get/website_screenshot.md>`_)",
+            "short_description": "Get PDFs from website screenshot (for \"online\" ENTRYTYPES) (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/pdf_get/website_screenshot.md>`__)",
             "status": "|EXPERIMENTAL|",
             "status_linked": "|EXPERIMENTAL|"
         }
     ],
     "pdf_get_man": [
         {
             "ci_supported": false,
             "endpoint": "colrev.ops.built_in.pdf_get_man.pdf_get_man_cli.CoLRevCLIPDFGetMan",
             "package_endpoint_identifier": "colrev.colrev_cli_pdf_get_man",
-            "short_description": "Get PDFs manually based on a CLI (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/pdf_get_man/pdf_get_man_cli.md>`_)",
+            "short_description": "Get PDFs manually based on a CLI (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/pdf_get_man/pdf_get_man_cli.md>`__)",
             "status": "|MATURING|",
             "status_linked": "|MATURING|"
         }
     ],
     "pdf_prep": [
         {
             "ci_supported": false,
             "endpoint": "colrev.ops.built_in.pdf_prep.tei_prep.TEIPDFPrep",
             "package_endpoint_identifier": "colrev.create_tei",
-            "short_description": "Prepare PDFs by creating an annotated TEI document (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/pdf_prep/tei_prep.md>`_)",
+            "short_description": "Prepare PDFs by creating an annotated TEI document (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/pdf_prep/tei_prep.md>`__)",
             "status": "|MATURING|",
             "status_linked": "|MATURING|"
         },
         {
             "ci_supported": false,
             "endpoint": "colrev.ops.built_in.pdf_prep.check_ocr.PDFCheckOCR",
             "package_endpoint_identifier": "colrev.pdf_check_ocr",
-            "short_description": "Prepare PDFs by checking and applying OCR (if necessary) based on OCRmyPDF (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/pdf_prep/check_ocr.md>`_)",
+            "short_description": "Prepare PDFs by checking and applying OCR (if necessary) based on OCRmyPDF (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/pdf_prep/check_ocr.md>`__)",
             "status": "|MATURING|",
             "status_linked": "|MATURING|"
         },
         {
             "ci_supported": false,
             "endpoint": "colrev.ops.built_in.pdf_prep.cover_page.PDFCoverPage",
             "package_endpoint_identifier": "colrev.remove_coverpage",
-            "short_description": "Prepare PDFs by removing unnecessary cover pages (e.g. researchgate, publishers) (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/pdf_prep/cover_page.md>`_)",
+            "short_description": "Prepare PDFs by removing unnecessary cover pages (e.g. researchgate, publishers) (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/pdf_prep/cover_page.md>`__)",
             "status": "|MATURING|",
             "status_linked": "|MATURING|"
         },
         {
             "ci_supported": false,
             "endpoint": "colrev.ops.built_in.pdf_prep.last_page.PDFLastPage",
             "package_endpoint_identifier": "colrev.remove_last_page",
-            "short_description": "Prepare PDFs by removing unnecessary last pages (e.g. copyright notices, cited-by infos) (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/pdf_prep/last_page.md>`_)",
+            "short_description": "Prepare PDFs by removing unnecessary last pages (e.g. copyright notices, cited-by infos) (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/pdf_prep/last_page.md>`__)",
             "status": "|MATURING|",
             "status_linked": "|MATURING|"
         },
         {
             "ci_supported": false,
             "endpoint": "colrev.ops.built_in.pdf_prep.completeness_validation.PDFCompletenessValidation",
             "package_endpoint_identifier": "colrev.validate_completeness",
-            "short_description": "Prepare PDFs by validating its completeness (based on the number of pages) (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/pdf_prep/completeness_validation.md>`_)",
+            "short_description": "Prepare PDFs by validating its completeness (based on the number of pages) (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/pdf_prep/completeness_validation.md>`__)",
             "status": "|MATURING|",
             "status_linked": "|MATURING|"
         },
         {
             "ci_supported": false,
             "endpoint": "colrev.ops.built_in.pdf_prep.metadata_validation.PDFMetadataValidation",
             "package_endpoint_identifier": "colrev.validate_pdf_metadata",
-            "short_description": "Prepare PDFs by validating it against its associated metadata (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/pdf_prep/metadata_validation.md>`_)",
+            "short_description": "Prepare PDFs by validating it against its associated metadata (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/pdf_prep/metadata_validation.md>`__)",
             "status": "|MATURING|",
             "status_linked": "|MATURING|"
         }
     ],
     "pdf_prep_man": [
         {
             "ci_supported": false,
             "endpoint": "colrev.ops.built_in.pdf_prep_man.pdf_prep_man_cli.CoLRevCLIPDFManPrep",
             "package_endpoint_identifier": "colrev.colrev_cli_pdf_prep_man",
-            "short_description": "Manually prepare PDFs based on a CLI (not yet implemented) (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/pdf_prep_man/pdf_prep_man_cli.md>`_)",
+            "short_description": "Manually prepare PDFs based on a CLI (not yet implemented) (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/pdf_prep_man/pdf_prep_man_cli.md>`__)",
             "status": "|MATURING|",
             "status_linked": "|MATURING|"
         }
     ],
     "prep": [
         {
             "ci_supported": false,
             "endpoint": "colrev.ops.built_in.prep.add_journal_ranking.AddJournalRanking",
             "package_endpoint_identifier": "colrev.add_journal_ranking",
-            "short_description": "Class for add _journal_ranking (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/prep/add_journal_ranking.md>`_)",
+            "short_description": "Class for add _journal_ranking (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/prep/add_journal_ranking.md>`__)",
             "status": "|EXPERIMENTAL|",
             "status_linked": "|EXPERIMENTAL|"
         },
         {
             "ci_supported": true,
             "endpoint": "colrev.ops.built_in.prep.curation_prep.CurationPrep",
             "package_endpoint_identifier": "colrev.curation_prep",
-            "short_description": "Preparation of curations (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/prep/curation_prep.md>`_)",
+            "short_description": "Preparation of curations (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/prep/curation_prep.md>`__)",
             "status": "|EXPERIMENTAL|",
             "status_linked": "|EXPERIMENTAL|"
         },
         {
             "ci_supported": true,
             "endpoint": "colrev.ops.built_in.prep.exclude_collections.ExcludeCollectionsPrep",
             "package_endpoint_identifier": "colrev.exclude_collections",
-            "short_description": "Prepares records by excluding collection entries (e.g., proceedings) (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/prep/exclude_collections.md>`_)",
+            "short_description": "Prepares records by excluding collection entries (e.g., proceedings) (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/prep/exclude_collections.md>`__)",
             "status": "|MATURING|",
             "status_linked": "|MATURING|"
         },
         {
             "ci_supported": true,
             "endpoint": "colrev.ops.built_in.prep.exclude_complementary_materials.ExcludeComplementaryMaterialsPrep",
             "package_endpoint_identifier": "colrev.exclude_complementary_materials",
-            "short_description": "Prepares records by excluding complementary materials (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/prep/exclude_complementary_materials.md>`_)",
+            "short_description": "Prepares records by excluding complementary materials (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/prep/exclude_complementary_materials.md>`__)",
             "status": "|MATURING|",
             "status_linked": "|MATURING|"
         },
         {
             "ci_supported": true,
             "endpoint": "colrev.ops.built_in.prep.exclude_languages.ExcludeLanguagesPrep",
             "package_endpoint_identifier": "colrev.exclude_languages",
-            "short_description": "Prepares records by excluding ones that are not in the languages_to_include (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/prep/exclude_languages.md>`_)",
+            "short_description": "Prepares records by excluding ones that are not in the languages_to_include (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/prep/exclude_languages.md>`__)",
             "status": "|MATURING|",
             "status_linked": "|MATURING|"
         },
         {
             "ci_supported": true,
             "endpoint": "colrev.ops.built_in.prep.exclude_non_latin_alphabets.ExcludeNonLatinAlphabetsPrep",
             "package_endpoint_identifier": "colrev.exclude_non_latin_alphabets",
-            "short_description": "Prepares records by excluding ones that have a non-latin alphabet (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/prep/exclude_non_latin_alphabets.md>`_)",
+            "short_description": "Prepares records by excluding ones that have a non-latin alphabet (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/prep/exclude_non_latin_alphabets.md>`__)",
             "status": "|MATURING|",
             "status_linked": "|MATURING|"
         },
         {
             "ci_supported": true,
             "endpoint": "colrev.ops.built_in.prep.general_polish.GeneralPolishPrep",
             "package_endpoint_identifier": "colrev.general_polish",
-            "short_description": "Prepares records by applying polishing rules (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/prep/general_polish.md>`_)",
+            "short_description": "Prepares records by applying polishing rules (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/prep/general_polish.md>`__)",
             "status": "|EXPERIMENTAL|",
             "status_linked": "|EXPERIMENTAL|"
         },
         {
             "ci_supported": true,
             "endpoint": "colrev.ops.built_in.prep.semantic_scholar_prep.SemanticScholarPrep",
             "package_endpoint_identifier": "colrev.get_doi_from_sem_scholar",
-            "short_description": "Prepares records based on SemanticScholar metadata (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/prep/semantic_scholar_prep.md>`_)",
+            "short_description": "Prepares records based on SemanticScholar metadata (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/prep/semantic_scholar_prep.md>`__)",
             "status": "|EXPERIMENTAL|",
             "status_linked": "|EXPERIMENTAL|"
         },
         {
             "ci_supported": true,
             "endpoint": "colrev.ops.built_in.prep.doi_from_urls_prep.DOIFromURLsPrep",
             "package_endpoint_identifier": "colrev.get_doi_from_urls",
-            "short_description": "Prepares records by retrieving its DOI from the website (URL) (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/prep/doi_from_urls_prep.md>`_)",
+            "short_description": "Prepares records by retrieving its DOI from the website (URL) (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/prep/doi_from_urls_prep.md>`__)",
             "status": "|EXPERIMENTAL|",
             "status_linked": "|EXPERIMENTAL|"
         },
         {
             "ci_supported": true,
             "endpoint": "colrev.ops.built_in.prep.citeas_prep.CiteAsPrep",
             "package_endpoint_identifier": "colrev.get_masterdata_from_citeas",
-            "short_description": "Prepares records based on citeas.org metadata (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/prep/citeas_prep.md>`_)",
+            "short_description": "Prepares records based on citeas.org metadata (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/prep/citeas_prep.md>`__)",
             "status": "|EXPERIMENTAL|",
             "status_linked": "|EXPERIMENTAL|"
         },
         {
             "ci_supported": true,
             "endpoint": "colrev.ops.built_in.prep.crossref_metadata_prep.CrossrefMetadataPrep",
             "package_endpoint_identifier": "colrev.get_masterdata_from_crossref",
-            "short_description": "Prepares records based on crossref.org metadata (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/prep/crossref_metadata_prep.md>`_)",
+            "short_description": "Prepares records based on crossref.org metadata (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/prep/crossref_metadata_prep.md>`__)",
             "status": "|MATURING|",
             "status_linked": "|MATURING|"
         },
         {
             "ci_supported": true,
             "endpoint": "colrev.ops.built_in.prep.dblp_metadata_prep.DBLPMetadataPrep",
             "package_endpoint_identifier": "colrev.get_masterdata_from_dblp",
-            "short_description": "Prepares records based on dblp.org metadata (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/prep/dblp_metadata_prep.md>`_)",
+            "short_description": "Prepares records based on dblp.org metadata (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/prep/dblp_metadata_prep.md>`__)",
             "status": "|MATURING|",
             "status_linked": "|MATURING|"
         },
         {
             "ci_supported": true,
             "endpoint": "colrev.ops.built_in.prep.doi_metadata_prep.DOIMetadataPrep",
             "package_endpoint_identifier": "colrev.get_masterdata_from_doi",
-            "short_description": "Prepares records based on doi.org metadata (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/prep/doi_metadata_prep.md>`_)",
+            "short_description": "Prepares records based on doi.org metadata (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/prep/doi_metadata_prep.md>`__)",
             "status": "|EXPERIMENTAL|",
             "status_linked": "|EXPERIMENTAL|"
         },
         {
             "ci_supported": true,
             "endpoint": "colrev.ops.built_in.prep.europe_pmc_prep.EuropePMCMetadataPrep",
             "package_endpoint_identifier": "colrev.get_masterdata_from_europe_pmc",
-            "short_description": "Prepares records based on Europe PCM metadata (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/prep/europe_pmc_prep.md>`_)",
+            "short_description": "Prepares records based on Europe PCM metadata (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/prep/europe_pmc_prep.md>`__)",
             "status": "|MATURING|",
             "status_linked": "|MATURING|"
         },
         {
             "ci_supported": true,
             "endpoint": "colrev.ops.built_in.prep.local_index_prep.LocalIndexPrep",
             "package_endpoint_identifier": "colrev.get_masterdata_from_local_index",
-            "short_description": "Prepares records based on LocalIndex metadata (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/prep/local_index_prep.md>`_)",
+            "short_description": "Prepares records based on LocalIndex metadata (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/prep/local_index_prep.md>`__)",
             "status": "|MATURING|",
             "status_linked": "|MATURING|"
         },
         {
             "ci_supported": true,
             "endpoint": "colrev.ops.built_in.prep.open_library_prep.OpenLibraryMetadataPrep",
             "package_endpoint_identifier": "colrev.get_masterdata_from_open_library",
-            "short_description": "Prepares records based on openlibrary.org metadata (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/prep/open_library_prep.md>`_)",
+            "short_description": "Prepares records based on openlibrary.org metadata (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/prep/open_library_prep.md>`__)",
             "status": "|MATURING|",
             "status_linked": "|MATURING|"
         },
         {
             "ci_supported": true,
             "endpoint": "colrev.ops.built_in.prep.pubmed_metadata_prep.PubmedMetadataPrep",
             "package_endpoint_identifier": "colrev.get_masterdata_from_pubmed",
-            "short_description": "Prepares records based on Pubmed metadata (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/prep/pubmed_metadata_prep.md>`_)",
+            "short_description": "Prepares records based on Pubmed metadata (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/prep/pubmed_metadata_prep.md>`__)",
             "status": "|MATURING|",
             "status_linked": "|MATURING|"
         },
         {
             "ci_supported": true,
             "endpoint": "colrev.ops.built_in.prep.year_vol_iss_prep.YearVolIssPrep",
             "package_endpoint_identifier": "colrev.get_year_from_vol_iss_jour",
-            "short_description": "Prepares records based on year-volume-issue dependency (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/prep/year_vol_iss_prep.md>`_)",
+            "short_description": "Prepares records based on year-volume-issue dependency (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/prep/year_vol_iss_prep.md>`__)",
             "status": "|EXPERIMENTAL|",
             "status_linked": "|EXPERIMENTAL|"
         },
         {
             "ci_supported": true,
             "endpoint": "colrev.ops.built_in.prep.open_alex_metadata_prep.OpenAlexMetadataPrep",
             "package_endpoint_identifier": "colrev.open_alex_prep",
-            "short_description": "Prepares records based on OpenAlex metadata (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/prep/open_alex_metadata_prep.md>`_)",
+            "short_description": "Prepares records based on OpenAlex metadata (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/prep/open_alex_metadata_prep.md>`__)",
             "status": "|EXPERIMENTAL|",
             "status_linked": "|EXPERIMENTAL|"
         },
         {
             "ci_supported": true,
             "endpoint": "colrev.ops.built_in.prep.remove_broken_ids.RemoveBrokenIDPrep",
             "package_endpoint_identifier": "colrev.remove_broken_ids",
-            "short_description": "Prepares records by removing invalid IDs DOIs/ISBNs (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/prep/remove_broken_ids.md>`_)",
+            "short_description": "Prepares records by removing invalid IDs DOIs/ISBNs (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/prep/remove_broken_ids.md>`__)",
             "status": "|MATURING|",
             "status_linked": "|MATURING|"
         },
         {
             "ci_supported": true,
             "endpoint": "colrev.ops.built_in.prep.remove_error500_urls.RemoveError500URLsPrep",
             "package_endpoint_identifier": "colrev.remove_urls_with_500_errors",
-            "short_description": "Prepares records by removing urls that are not available (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/prep/remove_error500_urls.md>`_)",
+            "short_description": "Prepares records by removing urls that are not available (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/prep/remove_error500_urls.md>`__)",
             "status": "|MATURING|",
             "status_linked": "|MATURING|"
         },
         {
             "ci_supported": true,
             "endpoint": "colrev.ops.built_in.prep.bibtex_crossref_resolution.BibTexCrossrefResolutionPrep",
             "package_endpoint_identifier": "colrev.resolve_crossrefs",
-            "short_description": "Prepares records by resolving BibTex crossref links (e.g., to proceedings) (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/prep/bibtex_crossref_resolution.md>`_)",
+            "short_description": "Prepares records by resolving BibTex crossref links (e.g., to proceedings) (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/prep/bibtex_crossref_resolution.md>`__)",
             "status": "|MATURING|",
             "status_linked": "|MATURING|"
         },
         {
             "ci_supported": true,
             "endpoint": "colrev.ops.built_in.prep.source_specific_prep.SourceSpecificPrep",
             "package_endpoint_identifier": "colrev.source_specific_prep",
-            "short_description": "Prepares records based on the prepare scripts specified by the SearchSource (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/prep/source_specific_prep.md>`_)",
+            "short_description": "Prepares records based on the prepare scripts specified by the SearchSource (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/prep/source_specific_prep.md>`__)",
             "status": "|MATURING|",
             "status_linked": "|MATURING|"
         },
         {
             "ci_supported": true,
             "endpoint": "colrev.ops.built_in.prep.update_masterdata_status.UpdateMetadataStatusPrep",
             "package_endpoint_identifier": "colrev.update_metadata_status",
-            "short_description": "Prepares records by updating the metadata status (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/prep/update_masterdata_status.md>`_)",
+            "short_description": "Prepares records by updating the metadata status (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/prep/update_masterdata_status.md>`__)",
             "status": "|MATURING|",
             "status_linked": "|MATURING|"
         }
     ],
     "prep_man": [
         {
             "ci_supported": false,
             "endpoint": "colrev.ops.built_in.prep_man.prep_man_export.ExportManPrep",
             "package_endpoint_identifier": "colrev.export_man_prep",
-            "short_description": "Manual preparation based on exported and imported metadata (and PDFs if any) (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/prep_man/prep_man_export.md>`_)",
+            "short_description": "Manual preparation based on exported and imported metadata (and PDFs if any) (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/prep_man/prep_man_export.md>`__)",
             "status": "|MATURING|",
             "status_linked": "|MATURING|"
         },
         {
             "ci_supported": false,
             "endpoint": "colrev.ops.built_in.prep_man.curation_jupyter_prep_man.CurationJupyterNotebookManPrep",
             "package_endpoint_identifier": "colrev.prep_man_curation_jupyter",
-            "short_description": "Manual preparation based on a Jupyter Notebook (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/prep_man/curation_jupyter_prep_man.md>`_)",
+            "short_description": "Manual preparation based on a Jupyter Notebook (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/prep_man/curation_jupyter_prep_man.md>`__)",
             "status": "|EXPERIMENTAL|",
             "status_linked": "|EXPERIMENTAL|"
         }
     ],
     "prescreen": [
         {
             "ci_supported": false,
             "endpoint": "colrev.ops.built_in.prescreen.prescreen_cli.CoLRevCLIPrescreen",
             "package_endpoint_identifier": "colrev.colrev_cli_prescreen",
-            "short_description": "CLI-based prescreen (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/prescreen/prescreen_cli.md>`_)",
+            "short_description": "CLI-based prescreen (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/prescreen/prescreen_cli.md>`__)",
             "status": "|MATURING|",
             "status_linked": "|MATURING|"
         },
         {
             "ci_supported": true,
             "endpoint": "colrev.ops.built_in.prescreen.conditional_prescreen.ConditionalPrescreen",
             "package_endpoint_identifier": "colrev.conditional_prescreen",
-            "short_description": "Conditional prescreen (currently: include all) (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/prescreen/conditional_prescreen.md>`_)",
+            "short_description": "Conditional prescreen (currently: include all) (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/prescreen/conditional_prescreen.md>`__)",
             "status": "|MATURING|",
             "status_linked": "|MATURING|"
         },
         {
             "ci_supported": false,
             "endpoint": "colrev.ops.built_in.prescreen.prescreen_table.TablePrescreen",
             "package_endpoint_identifier": "colrev.prescreen_table",
-            "short_description": "Table-based prescreen (exported and imported) (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/prescreen/prescreen_table.md>`_)",
+            "short_description": "Table-based prescreen (exported and imported) (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/prescreen/prescreen_table.md>`__)",
             "status": "|MATURING|",
             "status_linked": "|MATURING|"
         },
         {
             "ci_supported": true,
             "endpoint": "colrev.ops.built_in.prescreen.scope_prescreen.ScopePrescreen",
             "package_endpoint_identifier": "colrev.scope_prescreen",
-            "short_description": "Rule-based prescreen (scope) (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/prescreen/scope_prescreen.md>`_)",
+            "short_description": "Rule-based prescreen (scope) (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/prescreen/scope_prescreen.md>`__)",
             "status": "|MATURING|",
             "status_linked": "|MATURING|"
         },
         {
             "ci_supported": false,
             "endpoint": "colrev_asreview.colrev_asreview.ASReviewPrescreen",
             "package_endpoint_identifier": "colrev_asreview.colrev_asreview",
-            "short_description": "ASReview-based prescreen (`instructions <https://github.com/CoLRev-Environment/colrev-asreview>`_)",
+            "short_description": "ASReview-based prescreen (`instructions <https://github.com/CoLRev-Environment/colrev-asreview>`__)",
             "status": "|MATURING|",
             "status_linked": "|MATURING|"
         }
     ],
     "review_type": [
         {
             "ci_supported": true,
+            "endpoint": "colrev.ops.built_in.review_types.blank.BlankReview",
+            "package_endpoint_identifier": "colrev.blank",
+            "short_description": "Blank review (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/review_types/blank.md>`__)",
+            "status": "|EXPERIMENTAL|",
+            "status_linked": "|EXPERIMENTAL|"
+        },
+        {
+            "ci_supported": true,
             "endpoint": "colrev.ops.built_in.review_types.conceptual_review.ConceptualReview",
             "package_endpoint_identifier": "colrev.conceptual_review",
-            "short_description": "Conceptual review (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/review_types/conceptual_review.md>`_)",
+            "short_description": "Conceptual review (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/review_types/conceptual_review.md>`__)",
             "status": "|EXPERIMENTAL|",
             "status_linked": "|EXPERIMENTAL|"
         },
         {
             "ci_supported": true,
             "endpoint": "colrev.ops.built_in.review_types.critical_review.CriticalReview",
             "package_endpoint_identifier": "colrev.critical_review",
-            "short_description": "Critical review (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/review_types/critical_review.md>`_)",
+            "short_description": "Critical review (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/review_types/critical_review.md>`__)",
             "status": "|EXPERIMENTAL|",
             "status_linked": "|EXPERIMENTAL|"
         },
         {
             "ci_supported": true,
             "endpoint": "colrev.ops.built_in.review_types.curated_masterdata.CuratedMasterdata",
             "package_endpoint_identifier": "colrev.curated_masterdata",
-            "short_description": "Curated masterdata (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/review_types/curated_masterdata.md>`_)",
+            "short_description": "Curated masterdata (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/review_types/curated_masterdata.md>`__)",
             "status": "|EXPERIMENTAL|",
             "status_linked": "|EXPERIMENTAL|"
         },
         {
             "ci_supported": true,
             "endpoint": "colrev.ops.built_in.review_types.descriptive_review.DescriptiveReview",
             "package_endpoint_identifier": "colrev.descriptive_review",
-            "short_description": "Descriptive review (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/review_types/descriptive_review.md>`_)",
+            "short_description": "Descriptive review (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/review_types/descriptive_review.md>`__)",
             "status": "|EXPERIMENTAL|",
             "status_linked": "|EXPERIMENTAL|"
         },
         {
             "ci_supported": true,
             "endpoint": "colrev.ops.built_in.review_types.literature_review.LiteratureReview",
             "package_endpoint_identifier": "colrev.literature_review",
-            "short_description": "Literature review (simple) (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/review_types/literature_review.md>`_)",
+            "short_description": "Literature review (simple) (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/review_types/literature_review.md>`__)",
             "status": "|MATURING|",
             "status_linked": "|MATURING|"
         },
         {
             "ci_supported": true,
             "endpoint": "colrev.ops.built_in.review_types.meta_analysis.MetaAnalysis",
             "package_endpoint_identifier": "colrev.meta_analysis",
-            "short_description": "Meta-analysis (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/review_types/meta_analysis.md>`_)",
+            "short_description": "Meta-analysis (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/review_types/meta_analysis.md>`__)",
             "status": "|EXPERIMENTAL|",
             "status_linked": "|EXPERIMENTAL|"
         },
         {
             "ci_supported": true,
             "endpoint": "colrev.ops.built_in.review_types.narrative_review.NarrativeReview",
             "package_endpoint_identifier": "colrev.narrative_review",
-            "short_description": "Narrative review (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/review_types/narrative_review.md>`_)",
+            "short_description": "Narrative review (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/review_types/narrative_review.md>`__)",
             "status": "|EXPERIMENTAL|",
             "status_linked": "|EXPERIMENTAL|"
         },
         {
             "ci_supported": true,
             "endpoint": "colrev.ops.built_in.review_types.qualitative_systematic_review.QualitativeSystematicReview",
             "package_endpoint_identifier": "colrev.qualitative_systematic_review",
-            "short_description": "Qualitative systematic review (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/review_types/qualitative_systematic_review.md>`_)",
+            "short_description": "Qualitative systematic review (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/review_types/qualitative_systematic_review.md>`__)",
             "status": "|EXPERIMENTAL|",
             "status_linked": "|EXPERIMENTAL|"
         },
         {
             "ci_supported": true,
             "endpoint": "colrev.ops.built_in.review_types.scientometric.ScientometricReview",
             "package_endpoint_identifier": "colrev.scientometric",
-            "short_description": "Scientometric study (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/review_types/scientometric.md>`_)",
+            "short_description": "Scientometric study (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/review_types/scientometric.md>`__)",
             "status": "|EXPERIMENTAL|",
             "status_linked": "|EXPERIMENTAL|"
         },
         {
             "ci_supported": true,
             "endpoint": "colrev.ops.built_in.review_types.scoping_review.ScopingReview",
             "package_endpoint_identifier": "colrev.scoping_review",
-            "short_description": "Scoping review (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/review_types/scoping_review.md>`_)",
+            "short_description": "Scoping review (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/review_types/scoping_review.md>`__)",
             "status": "|EXPERIMENTAL|",
             "status_linked": "|EXPERIMENTAL|"
         },
         {
             "ci_supported": true,
             "endpoint": "colrev.ops.built_in.review_types.theoretical_review.TheoreticalReview",
             "package_endpoint_identifier": "colrev.theoretical_review",
-            "short_description": "Theoretical review (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/review_types/theoretical_review.md>`_)",
+            "short_description": "Theoretical review (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/review_types/theoretical_review.md>`__)",
             "status": "|EXPERIMENTAL|",
             "status_linked": "|EXPERIMENTAL|"
         }
     ],
     "screen": [
         {
             "ci_supported": false,
             "endpoint": "colrev.ops.built_in.screen.screen_cli.CoLRevCLIScreen",
             "package_endpoint_identifier": "colrev.colrev_cli_screen",
-            "short_description": "Screen documents using a CLI (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/screen/screen_cli.md>`_)",
+            "short_description": "Screen documents using a CLI (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/screen/screen_cli.md>`__)",
             "status": "|MATURING|",
             "status_linked": "|MATURING|"
         },
         {
             "ci_supported": false,
             "endpoint": "colrev.ops.built_in.screen.screen_table.TableScreen",
             "package_endpoint_identifier": "colrev.screen_table",
-            "short_description": "Screen documents using tables (exported and imported) (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/screen/screen_table.md>`_)",
+            "short_description": "Screen documents using tables (exported and imported) (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/screen/screen_table.md>`__)",
             "status": "|MATURING|",
             "status_linked": "|MATURING|"
         }
     ],
     "search_source": [
         {
             "ci_supported": false,
             "endpoint": "colrev.ops.built_in.search_sources.abi_inform_proquest.ABIInformProQuestSearchSource",
             "package_endpoint_identifier": "colrev.abi_inform_proquest",
-            "short_description": "SearchSource for ABI/INFORM (ProQuest) (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/search_sources/abi_inform_proquest.md>`_)",
+            "short_description": "SearchSource for ABI/INFORM (ProQuest) (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/search_sources/abi_inform_proquest.md>`__)",
             "status": "|EXPERIMENTAL|",
             "status_linked": "|EXPERIMENTAL|"
         },
         {
             "ci_supported": false,
             "endpoint": "colrev.ops.built_in.search_sources.acm_digital_library.ACMDigitalLibrarySearchSource",
             "package_endpoint_identifier": "colrev.acm_digital_library",
-            "short_description": "SearchSource for the ACM digital Library (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/search_sources/acm_digital_library.md>`_)",
+            "short_description": "SearchSource for the ACM digital Library (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/search_sources/acm_digital_library.md>`__)",
             "status": "|EXPERIMENTAL|",
             "status_linked": "|EXPERIMENTAL|"
         },
         {
             "ci_supported": true,
             "endpoint": "colrev.ops.built_in.search_sources.aisel.AISeLibrarySearchSource",
             "package_endpoint_identifier": "colrev.ais_library",
-            "short_description": "SearchSource for the AIS electronic Library (AISeL) (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/search_sources/aisel.md>`_)",
+            "short_description": "SearchSource for the AIS electronic Library (AISeL) (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/search_sources/aisel.md>`__)",
             "status": "|MATURING|",
             "status_linked": "|MATURING|"
         },
         {
             "ci_supported": true,
             "endpoint": "colrev.ops.built_in.search_sources.colrev_project.ColrevProjectSearchSource",
             "package_endpoint_identifier": "colrev.colrev_project",
-            "short_description": "Performs a search in a CoLRev project (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/search_sources/colrev_project.md>`_)",
+            "short_description": "Performs a search in a CoLRev project (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/search_sources/colrev_project.md>`__)",
             "status": "|MATURING|",
             "status_linked": "|MATURING|"
         },
         {
             "ci_supported": true,
             "endpoint": "colrev.ops.built_in.search_sources.crossref.CrossrefSearchSource",
             "package_endpoint_identifier": "colrev.crossref",
-            "short_description": "SearchSource for the Crossref API (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/search_sources/crossref.md>`_)",
+            "short_description": "SearchSource for the Crossref API (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/search_sources/crossref.md>`__)",
             "status": "|MATURING|",
             "status_linked": "|MATURING|"
         },
         {
             "ci_supported": true,
             "endpoint": "colrev.ops.built_in.search_sources.dblp.DBLPSearchSource",
             "package_endpoint_identifier": "colrev.dblp",
-            "short_description": "SearchSource for DBLP (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/search_sources/dblp.md>`_)",
+            "short_description": "SearchSource for DBLP (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/search_sources/dblp.md>`__)",
             "status": "|MATURING|",
             "status_linked": "|MATURING|"
         },
         {
             "ci_supported": false,
             "endpoint": "colrev.ops.built_in.search_sources.ebsco_host.EbscoHostSearchSource",
             "package_endpoint_identifier": "colrev.ebsco_host",
-            "short_description": "SearchSource for EBSCOHost (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/search_sources/ebsco_host.md>`_)",
+            "short_description": "SearchSource for EBSCOHost (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/search_sources/ebsco_host.md>`__)",
             "status": "|EXPERIMENTAL|",
             "status_linked": "|EXPERIMENTAL|"
         },
         {
             "ci_supported": true,
             "endpoint": "colrev.ops.built_in.search_sources.eric.ERICSearchSource",
             "package_endpoint_identifier": "colrev.eric",
-            "short_description": "SearchSource for the ERIC API (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/search_sources/eric.md>`_)",
+            "short_description": "SearchSource for the ERIC API (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/search_sources/eric.md>`__)",
             "status": "|EXPERIMENTAL|",
             "status_linked": "|EXPERIMENTAL|"
         },
         {
             "ci_supported": true,
             "endpoint": "colrev.ops.built_in.search_sources.europe_pmc.EuropePMCSearchSource",
             "package_endpoint_identifier": "colrev.europe_pmc",
-            "short_description": "SearchSource for Europe PMC (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/search_sources/europe_pmc.md>`_)",
+            "short_description": "SearchSource for Europe PMC (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/search_sources/europe_pmc.md>`__)",
             "status": "|MATURING|",
             "status_linked": "|MATURING|"
         },
         {
             "ci_supported": false,
             "endpoint": "colrev.ops.built_in.search_sources.google_scholar.GoogleScholarSearchSource",
             "package_endpoint_identifier": "colrev.google_scholar",
-            "short_description": "SearchSource for GoogleScholar (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/search_sources/google_scholar.md>`_)",
+            "short_description": "SearchSource for GoogleScholar (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/search_sources/google_scholar.md>`__)",
             "status": "|EXPERIMENTAL|",
             "status_linked": "|EXPERIMENTAL|"
         },
         {
             "ci_supported": true,
             "endpoint": "colrev.ops.built_in.search_sources.ieee.IEEEXploreSearchSource",
             "package_endpoint_identifier": "colrev.ieee",
-            "short_description": "SearchSource for IEEEXplore (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/search_sources/ieee.md>`_)",
+            "short_description": "SearchSource for IEEEXplore (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/search_sources/ieee.md>`__)",
             "status": "|EXPERIMENTAL|",
             "status_linked": "|EXPERIMENTAL|"
         },
         {
             "ci_supported": false,
             "endpoint": "colrev.ops.built_in.search_sources.jstor.JSTORSearchSource",
             "package_endpoint_identifier": "colrev.jstor",
-            "short_description": "SearchSource for JSTOR (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/search_sources/jstor.md>`_)",
+            "short_description": "SearchSource for JSTOR (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/search_sources/jstor.md>`__)",
             "status": "|EXPERIMENTAL|",
             "status_linked": "|EXPERIMENTAL|"
         },
         {
             "ci_supported": true,
             "endpoint": "colrev.ops.built_in.search_sources.local_index.LocalIndexSearchSource",
             "package_endpoint_identifier": "colrev.local_index",
-            "short_description": "Performs a search in the LocalIndex (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/search_sources/local_index.md>`_)",
+            "short_description": "Performs a search in the LocalIndex (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/search_sources/local_index.md>`__)",
             "status": "|MATURING|",
             "status_linked": "|MATURING|"
         },
         {
             "ci_supported": true,
             "endpoint": "colrev.ops.built_in.search_sources.open_alex.OpenAlexSearchSource",
             "package_endpoint_identifier": "colrev.open_alex",
-            "short_description": "SearchSource for the OpenAlex API (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/search_sources/open_alex.md>`_)",
+            "short_description": "SearchSource for the OpenAlex API (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/search_sources/open_alex.md>`__)",
             "status": "|EXPERIMENTAL|",
             "status_linked": "|EXPERIMENTAL|"
         },
         {
             "ci_supported": true,
             "endpoint": "colrev.ops.built_in.search_sources.open_citations_forward_search.OpenCitationsSearchSource",
             "package_endpoint_identifier": "colrev.open_citations_forward_search",
-            "short_description": "Performs a forward search based on OpenCitations (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/search_sources/open_citations_forward_search.md>`_)",
+            "short_description": "Performs a forward search based on OpenCitations (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/search_sources/open_citations_forward_search.md>`__)",
             "status": "|MATURING|",
             "status_linked": "|MATURING|"
         },
         {
             "ci_supported": true,
             "endpoint": "colrev.ops.built_in.search_sources.open_library.OpenLibrarySearchSource",
             "package_endpoint_identifier": "colrev.open_library",
-            "short_description": "SearchSource for the OpenLibrary API (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/search_sources/open_library.md>`_)",
+            "short_description": "SearchSource for the OpenLibrary API (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/search_sources/open_library.md>`__)",
             "status": "|EXPERIMENTAL|",
             "status_linked": "|EXPERIMENTAL|"
         },
         {
             "ci_supported": false,
             "endpoint": "colrev.ops.built_in.search_sources.pdf_backward_search.BackwardSearchSource",
             "package_endpoint_identifier": "colrev.pdf_backward_search",
-            "short_description": "Performs a backward search extracting references from PDFs using GROBID (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/search_sources/pdf_backward_search.md>`_)",
+            "short_description": "Performs a backward search extracting references from PDFs using GROBID (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/search_sources/pdf_backward_search.md>`__)",
             "status": "|MATURING|",
             "status_linked": "|MATURING|"
         },
         {
             "ci_supported": false,
             "endpoint": "colrev.ops.built_in.search_sources.pdfs_dir.PDFSearchSource",
             "package_endpoint_identifier": "colrev.pdfs_dir",
-            "short_description": "SearchSource for PDF directories (based on GROBID) (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/search_sources/pdfs_dir.md>`_)",
+            "short_description": "SearchSource for PDF directories (based on GROBID) (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/search_sources/pdfs_dir.md>`__)",
             "status": "|MATURING|",
             "status_linked": "|MATURING|"
         },
         {
             "ci_supported": false,
             "endpoint": "colrev.ops.built_in.search_sources.psycinfo.PsycINFOSearchSource",
             "package_endpoint_identifier": "colrev.psycinfo",
-            "short_description": "SearchSource for PsycINFO (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/search_sources/psycinfo.md>`_)",
+            "short_description": "SearchSource for PsycINFO (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/search_sources/psycinfo.md>`__)",
             "status": "|EXPERIMENTAL|",
             "status_linked": "|EXPERIMENTAL|"
         },
         {
             "ci_supported": true,
             "endpoint": "colrev.ops.built_in.search_sources.pubmed.PubMedSearchSource",
             "package_endpoint_identifier": "colrev.pubmed",
-            "short_description": "SearchSource for Pubmed (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/search_sources/pubmed.md>`_)",
+            "short_description": "SearchSource for Pubmed (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/search_sources/pubmed.md>`__)",
             "status": "|MATURING|",
             "status_linked": "|MATURING|"
         },
         {
             "ci_supported": false,
             "endpoint": "colrev.ops.built_in.search_sources.scopus.ScopusSearchSource",
             "package_endpoint_identifier": "colrev.scopus",
-            "short_description": "SearchSource for scopus (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/search_sources/scopus.md>`_)",
+            "short_description": "SearchSource for scopus (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/search_sources/scopus.md>`__)",
             "status": "|EXPERIMENTAL|",
             "status_linked": "|EXPERIMENTAL|"
         },
         {
             "ci_supported": false,
             "endpoint": "colrev.ops.built_in.search_sources.springer_link.SpringerLinkSearchSource",
             "package_endpoint_identifier": "colrev.springer_link",
-            "short_description": "SearchSource for Springer Link (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/search_sources/springer_link.md>`_)",
+            "short_description": "SearchSource for Springer Link (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/search_sources/springer_link.md>`__)",
             "status": "|EXPERIMENTAL|",
             "status_linked": "|EXPERIMENTAL|"
         },
         {
             "ci_supported": false,
             "endpoint": "colrev.ops.built_in.search_sources.synergy_datasets.SYNERGYDatasetsSearchSource",
             "package_endpoint_identifier": "colrev.synergy_datasets",
-            "short_description": "SearchSource for SYNERGY-datasets (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/search_sources/systematic_review_datasets.md>`_)",
+            "short_description": "SearchSource for SYNERGY-datasets (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/search_sources/synergy_datasets.md>`__)",
             "status": "|EXPERIMENTAL|",
             "status_linked": "|EXPERIMENTAL|"
         },
         {
             "ci_supported": false,
             "endpoint": "colrev.ops.built_in.search_sources.taylor_and_francis.TaylorAndFrancisSearchSource",
             "package_endpoint_identifier": "colrev.taylor_and_francis",
-            "short_description": "SearchSource for Taylor and Francis (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/search_sources/taylor_and_francis.md>`_)",
+            "short_description": "SearchSource for Taylor and Francis (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/search_sources/taylor_and_francis.md>`__)",
             "status": "|EXPERIMENTAL|",
             "status_linked": "|EXPERIMENTAL|"
         },
         {
             "ci_supported": false,
             "endpoint": "colrev.ops.built_in.search_sources.trid.TransportResearchInternationalDocumentation",
             "package_endpoint_identifier": "colrev.trid",
-            "short_description": "SearchSource for Transport Research International Documentation (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/search_sources/trid.md>`_)",
+            "short_description": "SearchSource for Transport Research International Documentation (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/search_sources/trid.md>`__)",
             "status": "|EXPERIMENTAL|",
             "status_linked": "|EXPERIMENTAL|"
         },
         {
             "ci_supported": false,
             "endpoint": "colrev.ops.built_in.search_sources.unknown_source.UnknownSearchSource",
             "package_endpoint_identifier": "colrev.unknown_source",
-            "short_description": "SearchSource for unknown search results (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/search_sources/unknown_source.md>`_)",
+            "short_description": "SearchSource for unknown search results (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/search_sources/unknown_source.md>`__)",
             "status": "|MATURING|",
             "status_linked": "|MATURING|"
         },
         {
             "ci_supported": false,
             "endpoint": "colrev.ops.built_in.search_sources.video_dir.VideoDirSearchSource",
             "package_endpoint_identifier": "colrev.video_dir",
-            "short_description": "SearchSource for directory containing video files (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/search_sources/video_dir.md>`_)",
+            "short_description": "SearchSource for directory containing video files (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/search_sources/video_dir.md>`__)",
             "status": "|EXPERIMENTAL|",
             "status_linked": "|EXPERIMENTAL|"
         },
         {
             "ci_supported": false,
             "endpoint": "colrev.ops.built_in.search_sources.web_of_science.WebOfScienceSearchSource",
             "package_endpoint_identifier": "colrev.web_of_science",
-            "short_description": "SearchSource for Web of Science (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/search_sources/web_of_science.md>`_)",
+            "short_description": "SearchSource for Web of Science (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/search_sources/web_of_science.md>`__)",
             "status": "|EXPERIMENTAL|",
             "status_linked": "|EXPERIMENTAL|"
         },
         {
             "ci_supported": false,
             "endpoint": "colrev.ops.built_in.search_sources.wiley.WileyOnlineLibrarySearchSource",
             "package_endpoint_identifier": "colrev.wiley",
-            "short_description": "SearchSource for Wiley (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/search_sources/wiley.md>`_)",
+            "short_description": "SearchSource for Wiley (`instructions <https://github.com/CoLRev-Environment/colrev/blob/main/colrev/ops/built_in/search_sources/wiley.md>`__)",
             "status": "|EXPERIMENTAL|",
             "status_linked": "|EXPERIMENTAL|"
         }
     ]
 }
```

### Comparing `colrev-0.9.2/colrev/template/package_status.json` & `colrev-0.9.3/colrev/template/package_status.json`

 * *Files 0% similar despite different names*

#### Pretty-printed

 * *Similarity: 0.9965277777777777%*

 * *Differences: {"'review_type'": "{insert: [(11, OrderedDict([('package_endpoint_identifier', 'colrev.blank'), "*

 * *                  "('status', 'EXPERIMENTAL')]))]}"}*

```diff
@@ -277,14 +277,18 @@
         {
             "package_endpoint_identifier": "colrev.meta_analysis",
             "status": "EXPERIMENTAL"
         },
         {
             "package_endpoint_identifier": "colrev.scientometric",
             "status": "EXPERIMENTAL"
+        },
+        {
+            "package_endpoint_identifier": "colrev.blank",
+            "status": "EXPERIMENTAL"
         }
     ],
     "screen": [
         {
             "package_endpoint_identifier": "colrev.colrev_cli_screen",
             "status": "MATURING"
         },
```

### Comparing `colrev-0.9.2/colrev/template/paper_md/APA-7.docx` & `colrev-0.9.3/colrev/template/paper_md/APA-7.docx`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/template/paper_md/paper.md` & `colrev-0.9.3/colrev/template/paper_md/paper.md`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/template/prisma/PRISMA.csv` & `colrev-0.9.3/colrev/template/prisma/PRISMA.csv`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/template/prisma/PRISMA_original.csv` & `colrev-0.9.3/colrev/template/prisma/PRISMA_original.csv`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/template/prisma/prisma-refs.bib` & `colrev-0.9.3/colrev/template/prisma/prisma-refs.bib`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/template/review_type/curated_masterdata/curations_github_colrev_update.yml` & `colrev-0.9.3/colrev/template/review_type/curated_masterdata/curations_github_colrev_update.yml`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/template/review_type/meta_analysis/paper.md` & `colrev-0.9.3/colrev/template/review_type/meta_analysis/paper.md`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ui_cli/cli.py` & `colrev-0.9.3/colrev/ui_cli/cli.py`

 * *Files 5% similar despite different names*

```diff
@@ -24,44 +24,58 @@
 import colrev.review_manager
 import colrev.ui_cli.cli_colors as colors
 import colrev.ui_cli.cli_load
 import colrev.ui_cli.cli_status_printer
 import colrev.ui_cli.cli_validation
 import colrev.ui_cli.dedupe_errors
 
-# pylint: disable=too-many-branches
-# pylint: disable=too-many-locals
-# pylint: disable=too-many-return-statements
-# pylint: disable=import-outside-toplevel
 # pylint: disable=too-many-lines
 # pylint: disable=redefined-builtin
 # pylint: disable=redefined-outer-name
 # pylint: disable=too-many-arguments
 # pylint: disable=unused-argument
 # pylint: disable=superfluous-parens
+# pylint: disable=too-many-locals
+# pylint: disable=import-outside-toplevel
+# pylint: disable=too-many-locals
+# pylint: disable=import-outside-toplevel
+# pylint: disable=too-many-return-statements
+
 # Note: autocompletion needs bash/... activation:
 # https://click.palletsprojects.com/en/7.x/bashcomplete/
 
 EXACT_CALL = "colrev " + subprocess.list2cmdline(sys.argv[1:])  # nosec
 
 package_manager = colrev.env.package_manager.PackageManager()
+SHELL_MODE = False
 
 
 def __custom_startswith(string: str, incomplete: str) -> bool:
     """A custom completion matching that supports case insensitive matching"""
     if os.environ.get("_CLICK_COMPLETION_COMMAND_CASE_INSENSITIVE_COMPLETE"):
         string = string.lower()
         incomplete = incomplete.lower()
     return string.startswith(incomplete)
 
 
 click_completion.core.startswith = __custom_startswith
 click_completion.init()
 
 
+def get_search_files() -> list:
+    """Get the search files (for click choices)"""
+    # Take the filenames from sources because there may be API searches
+    # without files (yet)
+    try:
+        review_manager = colrev.review_manager.ReviewManager()
+        return [str(x.filename) for x in review_manager.settings.sources]
+    except Exception:  # pylint: disable=broad-exception-caught
+        return []
+
+
 class SpecialHelpOrder(click.Group):
     """Order for cli commands in help page overview"""
 
     def __init__(self, *args, **kwargs) -> None:  # type: ignore
         self.help_priorities: dict = {}
         super().__init__(*args, **kwargs)
 
@@ -128,24 +142,21 @@
     pdfs          Get and prepare PDFs
     screen        Include records based on PDFs
     data          Complete selected forms of data analysis and synthesis
 
     \b
     validate      Validate changes in the previous commit
 
-    \b
-    repl          Start interactive terminal
-
     Recommended workflow: colrev status > colrev OPERATION > colrev validate
 
     Documentation:  https://colrev.readthedocs.io/
     """
 
     try:
-        if ctx.invoked_subcommand == "repl":
+        if ctx.invoked_subcommand == "shell":
             ctx.obj = {"review_manager": colrev.review_manager.ReviewManager()}
     except colrev.exceptions.RepoSetupError:
         pass
 
 
 def get_review_manager(
     ctx: click.core.Context, review_manager_params: dict
@@ -167,18 +178,22 @@
             print("init review manager object ...")
             review_manager = colrev.review_manager.ReviewManager(
                 **review_manager_params
             )
             ctx.obj["review_manager"] = review_manager
         else:
             review_manager.update_config(**review_manager_params)
+        if SHELL_MODE:
+            review_manager.shell_mode = True
         return review_manager
     except (TypeError, KeyError):
         review_manager = colrev.review_manager.ReviewManager(**review_manager_params)
         ctx.obj = {"review_manager": review_manager}
+        if SHELL_MODE:
+            review_manager.shell_mode = True
         return review_manager
 
 
 @main.command(help_priority=100)
 @click.pass_context
 @catch_exception(handle=(colrev_exceptions.CoLRevException))
 def shell(
@@ -189,14 +204,17 @@
 
     print(f"CoLRev version {colrev.__version__}")
     print("Workflow: status > OPERATION > validate")
     print("https://colrev.readthedocs.io/en/latest/")
     print("Type exit to close the shell")
     print()
     prompt_kwargs = {"history": FileHistory(".history"), "message": "CoLRev > "}
+    # pylint: disable=global-statement
+    global SHELL_MODE
+    SHELL_MODE = True
     click_repl.repl(ctx, prompt_kwargs=prompt_kwargs)
 
 
 @main.command(help_priority=100)
 @click.pass_context
 @catch_exception(handle=(colrev_exceptions.CoLRevException))
 def exit(
@@ -210,119 +228,87 @@
     if calframe[7].function == "shell":
         raise click_repl.exceptions.ExitReplException
 
 
 @main.command(help_priority=1)
 @click.option(
     "--type",
-    type=str,
-    default="literature_review",
-    help="Review type (e.g., literature_review (default), scoping_review, theoretical_review)",
+    type=click.Choice(
+        package_manager.discover_packages(
+            package_type=colrev.env.package_manager.PackageEndpointType.review_type,
+            installed_only=True,
+        )
+    ),
+    default="colrev.literature_review",
+    help="Review type for the setup.",
 )
 @click.option(
     "--light",
     is_flag=True,
     default=False,
-    help="Setup a lightweight repository (not requiring Docker services)",
+    help="Setup a lightweight repository (without Docker services)",
 )
 @click.option(
     "--example",
     is_flag=True,
     default=False,
     help="Add search results example",
 )
 @click.option(
     "-lpdf",
     "--local_pdf_collection",
     is_flag=True,
     default=False,
     help="Add a local PDF collection repository",
 )
-@click.option(
-    "-v",
-    "--verbose",
-    is_flag=True,
-    default=False,
-    help="Verbose: printing more infos",
-)
-@click.option(
-    "-f",
-    "--force",
-    is_flag=True,
-    default=False,
-    help="Force mode: conduct full search again",
-)
 @click.pass_context
 @catch_exception(handle=(colrev_exceptions.CoLRevException))
 def init(
     ctx: click.core.Context,
     type: str,
     example: bool,
     light: bool,
     local_pdf_collection: bool,
-    verbose: bool,
-    force: bool,
 ) -> None:
-    """Initialize (define review objectives and type)"""
+    """Initialize (define review objectives and type)
 
+    Docs: https://colrev.readthedocs.io/en/latest/manual/problem_formulation/init.html
+    """
     import colrev.ops.init
 
     colrev.review_manager.get_init_operation(
         review_type=type,
         example=example,
         light=light,
         local_pdf_collection=local_pdf_collection,
         exact_call=EXACT_CALL,
     )
 
 
 @main.command(help_priority=2)
 @click.option(
-    "-a",
-    "--analytics",
-    is_flag=True,
-    default=False,
-    help="Print analytics",
-)
-@click.option(
     "-v",
     "--verbose",
     is_flag=True,
     default=False,
     help="Verbose: printing more infos",
 )
-@click.option(
-    "-f",
-    "--force",
-    is_flag=True,
-    default=False,
-    help="Force mode",
-)
 @click.pass_context
 @catch_exception(handle=(colrev_exceptions.CoLRevException))
 def status(
     ctx: click.core.Context,
-    analytics: bool,
     verbose: bool,
-    force: bool,
 ) -> None:
     """Show status"""
     try:
         review_manager = get_review_manager(
             ctx,
-            {"force_mode": force, "verbose_mode": verbose, "exact_call": EXACT_CALL},
+            {"force_mode": False, "verbose_mode": verbose, "exact_call": EXACT_CALL},
         )
         status_operation = review_manager.get_status_operation()
-
-        if analytics:
-            analytic_results = status_operation.get_analytics()
-            for cid, data_item in reversed(analytic_results.items()):
-                print(f"{cid} - {data_item}")
-            return
-
         colrev.ui_cli.cli_status_printer.print_project_status(status_operation)
 
     except KeyboardInterrupt:
         print("Stopped...")
     except colrev_exceptions.RepoSetupError as exc:
         print(exc)
 
@@ -338,15 +324,14 @@
 )
 @click.pass_context
 def dashboard(
     ctx: click.core.Context,
     verbose: bool,
 ) -> None:
     """Allows to track project progress through dashboard"""
-    # pylint: disable=import-outside-toplevel
     import colrev.ops.dashboard
 
     try:
         colrev.ops.dashboard.main()
     except colrev_exceptions.NoRecordsError:
         print("No records imported yet.")
     except colrev_exceptions.CoLRevException as exc:
@@ -418,18 +403,15 @@
     search_operation = review_manager.get_search_operation()
     search_operation.main(rerun=False)
 
     print()
 
     review_manager.exact_call = "colrev prep"
     load_operation = review_manager.get_load_operation()
-    heuristic_list = load_operation.get_new_sources_heuristic_list()
-    new_sources = colrev.ui_cli.cli_load.select_new_source(
-        heuristic_result_list=heuristic_list, skip_query=True
-    )
+    new_sources = load_operation.get_most_likely_sources()
     load_operation = review_manager.get_load_operation(hide_load_explanation=True)
     load_operation.main(new_sources=new_sources, keep_ids=False)
 
     print()
     review_manager.exact_call = "colrev prep"
     prep_operation = review_manager.get_prep_operation()
     prep_operation.main()
@@ -445,26 +427,29 @@
 @click.option(
     "-a",
     "--add",
     type=click.Choice(
         package_manager.discover_packages(
             package_type=colrev.env.package_manager.PackageEndpointType.search_source,
             installed_only=True,
-        ),
-        case_sensitive=False,
+        )
     ),
-    help="""
-Format: colrev search -a colrev.dblp:"https://dblp.org/search?q=microsourcing"
-""",
+    help="""Search source to be added.""",
+)
+@click.option(
+    "-p",
+    "--params",
+    type=str,
+    help="Parameters",
 )
 @click.option("-v", "--view", is_flag=True, default=False, help="View search sources")
 @click.option(
     "-s",
     "--selected",
-    type=str,
+    type=click.Choice(get_search_files()),
     help="Only retrieve search results for selected sources",
 )
 @click.option(
     "-r",
     "--rerun",
     is_flag=True,
     default=False,
@@ -472,21 +457,14 @@
     + "(not just the most recent ones)",
 )
 @click.option(
     "-bws",
     help="Backward search on a selected paper",
 )
 @click.option(
-    "-f",
-    "--force",
-    is_flag=True,
-    default=False,
-    help="Force mode",
-)
-@click.option(
     "-scs",
     "--setup_custom_script",
     is_flag=True,
     default=False,
     help="Setup template for custom search script.",
 )
 @click.option(
@@ -504,38 +482,40 @@
     help="Force mode",
 )
 @click.pass_context
 @catch_exception(handle=(colrev_exceptions.CoLRevException))
 def search(
     ctx: click.core.Context,
     add: str,
+    params: str,
     view: bool,
     selected: str,
     rerun: bool,
     bws: str,
     setup_custom_script: bool,
     verbose: bool,
     force: bool,
 ) -> None:
-    """Search for records"""
+    """Search for records
 
-    import colrev.ui_cli.add_packages
+    Docs: https://colrev.readthedocs.io/en/latest/manual/metadata_retrieval/search.html
+    """
 
     review_manager = get_review_manager(
         ctx, {"verbose_mode": verbose, "force_mode": force, "exact_call": EXACT_CALL}
     )
 
     search_operation = review_manager.get_search_operation()
 
     if add:
-        colrev.ui_cli.add_packages.add_search_source(
-            search_operation=search_operation,
-            query=add,
+        package_manager = review_manager.get_package_manager()
+        package_manager.add_endpoint_for_operation(
+            operation=search_operation, package_identifier=add, params=params
         )
-
+        search_operation.main(selection_str=selected, rerun=rerun)
     elif view:
         for source in search_operation.sources:
             search_operation.review_manager.p_printer.pprint(source)
 
     elif setup_custom_script:
         import colrev.ui_cli.setup_custom_scripts
 
@@ -597,24 +577,27 @@
     ctx: click.core.Context,
     keep_ids: bool,
     skip_query: bool,
     include: bool,
     verbose: bool,
     force: bool,
 ) -> None:
-    """Load records"""
+    """Load records
+
+    Docs: https://colrev.readthedocs.io/en/latest/manual/metadata_retrieval/load.html
+    """
 
     review_manager = get_review_manager(
         ctx, {"verbose_mode": verbose, "force_mode": force, "exact_call": EXACT_CALL}
     )
     load_operation = review_manager.get_load_operation()
 
     heuristic_list = load_operation.get_new_sources_heuristic_list()
     new_sources = colrev.ui_cli.cli_load.select_new_source(
-        heuristic_result_list=heuristic_list, skip_query=True
+        heuristic_result_list=heuristic_list
     )
 
     # Note : reinitialize to load new scripts:
     load_operation = review_manager.get_load_operation(hide_load_explanation=True)
 
     load_operation.main(new_sources=new_sources, keep_ids=keep_ids)
 
@@ -642,14 +625,31 @@
         print()
         screen_operation = review_manager.get_screen_operation()
         screen_operation.main()
 
 
 @main.command(help_priority=6)
 @click.option(
+    "-a",
+    "--add",
+    type=click.Choice(
+        package_manager.discover_packages(
+            package_type=colrev.env.package_manager.PackageEndpointType.prep,
+            installed_only=True,
+        )
+    ),
+    help="""Prep package to be added.""",
+)
+@click.option(
+    "-p",
+    "--params",
+    type=str,
+    help="Parameters",
+)
+@click.option(
     "-k",
     "--keep_ids",
     is_flag=True,
     default=False,
     help="Do not change the record IDs. Useful when importing an existing sample.",
 )
 @click.option(
@@ -700,22 +700,14 @@
 @click.option(
     "-df",
     "--debug_file",
     type=click.Path(exists=True),
     help="Debug the preparation step for a selected record (in a file).",
 )
 @click.option(
-    "-a",
-    "--add",
-    type=str,
-    help="""
-Format: colrev prep -a colrev.add_journal_ranking
-""",
-)
-@click.option(
     "--skip",
     is_flag=True,
     default=False,
     help="Skip the preparation.",
     hidden=True,
 )
 @click.option(
@@ -732,31 +724,33 @@
     default=False,
     help="Force mode",
 )
 @click.pass_context
 @catch_exception(handle=(colrev_exceptions.CoLRevException))
 def prep(
     ctx: click.core.Context,
+    add: str,
+    params: str,
     keep_ids: bool,
     polish: bool,
     reset_records: str,
     reset_ids: bool,
     set_ids: bool,
     debug: str,
     debug_file: Path,
     cpu: int,
     setup_custom_script: bool,
-    add: str,
     skip: bool,
     verbose: bool,
     force: bool,
 ) -> None:
-    """Prepare records"""
+    """Prepare records
 
-    import colrev.ui_cli.add_packages
+    Docs: https://colrev.readthedocs.io/en/latest/manual/metadata_retrieval/prep.html
+    """
 
     try:
         review_manager = get_review_manager(
             ctx,
             {"verbose_mode": verbose, "force_mode": force, "exact_call": EXACT_CALL},
         )
         prep_operation = review_manager.get_prep_operation()
@@ -783,17 +777,17 @@
             prep_operation.setup_custom_script()
             print("Activated custom_prep_script.py.")
             print(
                 "Please check and adapt its position in the settings.json and commit."
             )
             return
         if add:
-            colrev.ui_cli.add_packages.add_prep(
-                prep_operation=prep_operation,
-                query=add,
+            package_manager = review_manager.get_package_manager()
+            package_manager.add_endpoint_for_operation(
+                operation=prep_operation, package_identifier=add, params=params
             )
             return
         if skip:
             prep_operation.skip_prep()
 
         prep_operation.main(keep_ids=keep_ids, cpu=cpu, polish=polish)
 
@@ -802,14 +796,31 @@
         print("You can use the force mode to override")
         print(f"  {colors.ORANGE}colrev prep -f{colors.END}")
         return
 
 
 @main.command(help_priority=7)
 @click.option(
+    "-a",
+    "--add",
+    type=click.Choice(
+        package_manager.discover_packages(
+            package_type=colrev.env.package_manager.PackageEndpointType.prep_man,
+            installed_only=True,
+        )
+    ),
+    help="""Prep-man script  to be added.""",
+)
+@click.option(
+    "-p",
+    "--params",
+    type=str,
+    help="Parameters",
+)
+@click.option(
     "--stats",
     is_flag=True,
     default=False,
     help="Print statistics of records with colrev_status md_needs_manual_preparation",
 )
 @click.option(
     "-l",
@@ -831,43 +842,77 @@
     is_flag=True,
     default=False,
     help="Force mode",
 )
 @click.pass_context
 @catch_exception(handle=(colrev_exceptions.CoLRevException))
 def prep_man(
-    ctx: click.core.Context, stats: bool, languages: bool, verbose: bool, force: bool
+    ctx: click.core.Context,
+    add: str,
+    params: str,
+    stats: bool,
+    languages: bool,
+    verbose: bool,
+    force: bool,
 ) -> None:
-    """Prepare records manually"""
+    """Prepare records manually
+
+    Docs: https://colrev.readthedocs.io/en/latest/manual/metadata_retrieval/prep.html
+    """
 
     review_manager = get_review_manager(
         ctx, {"verbose_mode": verbose, "force_mode": force, "exact_call": EXACT_CALL}
     )
     prep_man_operation = review_manager.get_prep_man_operation()
     if languages:
         prep_man_operation.prep_man_langs()
         return
 
     if stats:
         prep_man_operation.prep_man_stats()
         return
 
+    if add:
+        package_manager = review_manager.get_package_manager()
+        package_manager.add_endpoint_for_operation(
+            operation=prep_man_operation, package_identifier=add, params=params
+        )
+        return
+
     prep_man_operation.main()
 
 
 def __view_dedupe_details(dedupe_operation: colrev.ops.dedupe.Dedupe) -> None:
     info = dedupe_operation.get_info()
 
     if len(info["same_source_merges"]) > 0:
         print(f"\n\n{colors.RED}Same source merges to check:{colors.END}")
         print("\n- " + "\n- ".join(info["same_source_merges"]))
 
 
 @main.command(help_priority=8)
 @click.option(
+    "-a",
+    "--add",
+    type=click.Choice(
+        package_manager.discover_packages(
+            package_type=colrev.env.package_manager.PackageEndpointType.dedupe,
+            installed_only=True,
+        ),
+        case_sensitive=False,
+    ),
+    help="""Dedupe package to be added.""",
+)
+@click.option(
+    "-p",
+    "--params",
+    type=str,
+    help="Parameters",
+)
+@click.option(
     "-m",
     "--merge",
     help="Merge records by providing a comma-separated list of IDs (ID1,ID2).",
     required=False,
 )
 @click.option(
     "-u",
@@ -886,15 +931,15 @@
 )
 @click.option(
     "-gid",
     help="Merge records with identical global IDs (e.g., DOI)",
     is_flag=True,
     default=False,
 )
-@click.option("-v", "--view", is_flag=True, default=False, help="View dedupe info")
+@click.option("--view", is_flag=True, default=False, help="View dedupe info")
 @click.option(
     "-v",
     "--verbose",
     is_flag=True,
     default=False,
     help="Verbose: printing more infos",
 )
@@ -905,32 +950,44 @@
     default=False,
     help="Force mode",
 )
 @click.pass_context
 @catch_exception(handle=(colrev_exceptions.CoLRevException))
 def dedupe(
     ctx: click.core.Context,
+    add: str,
+    params: str,
     merge: str,
     unmerge: str,
     fix_errors: bool,
     gid: bool,
     view: bool,
     verbose: bool,
     force: bool,
 ) -> None:
-    """Deduplicate records"""
+    """Deduplicate records
+
+    Docs: https://colrev.readthedocs.io/en/latest/manual/metadata_retrieval/dedupe.html
+    """
 
     review_manager = get_review_manager(
         ctx, {"verbose_mode": verbose, "force_mode": force, "exact_call": EXACT_CALL}
     )
     state_transition_operation = not view
     dedupe_operation = review_manager.get_dedupe_operation(
         notify_state_transition_operation=state_transition_operation
     )
 
+    if add:
+        package_manager = review_manager.get_package_manager()
+        package_manager.add_endpoint_for_operation(
+            operation=dedupe_operation, package_identifier=add, params=params
+        )
+        return
+
     if merge:
         review_manager.settings.dedupe.same_source_merges = (
             colrev.settings.SameSourceMergePolicy.warn
         )
         dedupe_operation.merge_records(merge=merge)
         return
 
@@ -973,14 +1030,31 @@
         return
 
     dedupe_operation.main()
 
 
 @main.command(help_priority=9)
 @click.option(
+    "-a",
+    "--add",
+    type=click.Choice(
+        package_manager.discover_packages(
+            package_type=colrev.env.package_manager.PackageEndpointType.prescreen,
+            installed_only=True,
+        )
+    ),
+    help="""Prescreen package to be added.""",
+)
+@click.option(
+    "-p",
+    "--params",
+    type=str,
+    help="Parameters",
+)
+@click.option(
     "--include_all",
     is_flag=True,
     default=False,
     help="Include all records in prescreen",
 )
 @click.option(
     "--include_all_always",
@@ -1019,22 +1093,14 @@
 @click.option(
     "-e",
     "--exclude",
     help="Prescreen exclude records based on IDs (ID1,ID2,...).",
     required=False,
 )
 @click.option(
-    "-a",
-    "--add",
-    type=str,
-    help="""
-Format: colrev prescreen -a colrev.scope_prescreen:"TimeScopeFrom=2010"
-""",
-)
-@click.option(
     "-scs",
     "--setup_custom_script",
     is_flag=True,
     default=False,
     help="Setup template for custom search script.",
 )
 @click.option(
@@ -1051,30 +1117,34 @@
     default=False,
     help="Force mode",
 )
 @click.pass_context
 @catch_exception(handle=(colrev_exceptions.CoLRevException))
 def prescreen(
     ctx: click.core.Context,
+    add: str,
+    params: str,
     include_all: bool,
     include_all_always: bool,
     export_format: str,
     import_table: str,
     create_split: int,
     split: str,
     include: str,
     exclude: str,
-    add: str,
     setup_custom_script: bool,
     verbose: bool,
     force: bool,
 ) -> None:
-    """Pre-screen exclusion based on metadata (titles and abstracts)"""
+    """Pre-screen exclusion based on metadata (titles and abstracts)
 
-    import colrev.ui_cli.add_packages
+    Docs: https://colrev.readthedocs.io/en/latest/manual/metadata_prescreen/prescreen.html
+    """
+
+    # pylint: disable=too-many-locals
 
     review_manager = get_review_manager(
         ctx, {"verbose_mode": verbose, "force_mode": force, "exact_call": EXACT_CALL}
     )
     prescreen_operation = review_manager.get_prescreen_operation()
 
     if export_format:
@@ -1097,17 +1167,17 @@
     elif exclude:
         prescreen_operation.exclude_records(ids=include)
 
     elif setup_custom_script:
         prescreen_operation.setup_custom_script()
         print("Activated custom_prescreen_script.py.")
     elif add:
-        colrev.ui_cli.add_packages.add_prescreen(
-            prescreen_operation=prescreen_operation,
-            add=add,
+        package_manager = review_manager.get_package_manager()
+        package_manager.add_endpoint_for_operation(
+            operation=prescreen_operation, package_identifier=add, params=params
         )
     else:
         review_manager.logger.info("Prescreen")
         review_manager.logger.info(
             "Exclude irrelevant records based on metadata (i.e., titles and abstracts)."
         )
         review_manager.logger.info("Remaining records are retained provisionally")
@@ -1120,14 +1190,31 @@
         )
 
         prescreen_operation.main(split_str=split)
 
 
 @main.command(help_priority=10)
 @click.option(
+    "-a",
+    "--add",
+    type=click.Choice(
+        package_manager.discover_packages(
+            package_type=colrev.env.package_manager.PackageEndpointType.screen,
+            installed_only=True,
+        )
+    ),
+    help="""Screen package to be added.""",
+)
+@click.option(
+    "-p",
+    "--params",
+    type=str,
+    help="Parameters",
+)
+@click.option(
     "--include_all",
     is_flag=True,
     default=False,
     help="Include all records in the screen",
 )
 @click.option(
     "--include_all_always",
@@ -1181,31 +1268,43 @@
     default=False,
     help="Force mode",
 )
 @click.pass_context
 @catch_exception(handle=(colrev_exceptions.CoLRevException))
 def screen(
     ctx: click.core.Context,
+    add: str,
+    params: str,
     include_all: bool,
     include_all_always: bool,
     add_criterion: str,
     delete_criterion: str,
     create_split: int,
     split: str,
     setup_custom_script: bool,
     verbose: bool,
     force: bool,
 ) -> None:
-    """Screen based on PDFs and inclusion/exclusion criteria"""
+    """Screen based on PDFs and inclusion/exclusion criteria
+
+    Docs: https://colrev.readthedocs.io/en/latest/manual/pdf_screen/screen.html
+    """
 
     review_manager = get_review_manager(
         ctx, {"verbose_mode": verbose, "force_mode": force, "exact_call": EXACT_CALL}
     )
     screen_operation = review_manager.get_screen_operation()
 
+    if add:
+        package_manager = review_manager.get_package_manager()
+        package_manager.add_endpoint_for_operation(
+            operation=screen_operation, package_identifier=add, params=params
+        )
+        return
+
     if include_all or include_all_always:
         screen_operation.include_all_in_screen(persist=include_all_always)
         return
     if add_criterion:
         screen_operation.add_criterion(criterion_to_add=add_criterion)
         return
     if delete_criterion:
@@ -1345,14 +1444,31 @@
 
     pdf_prep_operation = review_manager.get_pdf_prep_operation()
     pdf_prep_operation.main()
 
 
 @main.command(help_priority=12)
 @click.option(
+    "-a",
+    "--add",
+    type=click.Choice(
+        package_manager.discover_packages(
+            package_type=colrev.env.package_manager.PackageEndpointType.pdf_get,
+            installed_only=True,
+        )
+    ),
+    help="""PDF-get package to be added.""",
+)
+@click.option(
+    "-p",
+    "--params",
+    type=str,
+    help="Parameters",
+)
+@click.option(
     "-c",
     "--copy-to-repo",
     is_flag=True,
     default=False,
     help="Copy PDF files to the repository (the /pdfs directory)",
 )
 @click.option(
@@ -1389,22 +1505,27 @@
     default=False,
     help="Force mode",
 )
 @click.pass_context
 @catch_exception(handle=(colrev_exceptions.CoLRevException))
 def pdf_get(
     ctx: click.core.Context,
+    add: str,
+    params: str,
     copy_to_repo: bool,
     rename: bool,
     relink_pdfs: bool,
     setup_custom_script: bool,
     verbose: bool,
     force: bool,
 ) -> None:
-    """Get PDFs"""
+    """Get PDFs
+
+    Docs: https://colrev.readthedocs.io/en/latest/manual/pdf_retrieval/pdf_get.html
+    """
 
     review_manager = get_review_manager(
         ctx,
         {
             "verbose_mode": verbose,
             "force_mode": force,
             "exact_call": EXACT_CALL,
@@ -1412,14 +1533,20 @@
     )
 
     state_transition_operation = not relink_pdfs and not setup_custom_script
     pdf_get_operation = review_manager.get_pdf_get_operation(
         notify_state_transition_operation=state_transition_operation
     )
 
+    if add:
+        package_manager = review_manager.get_package_manager()
+        package_manager.add_endpoint_for_operation(
+            operation=pdf_get_operation, package_identifier=add, params=params
+        )
+        return
     if relink_pdfs:
         pdf_get_operation.relink_pdfs()
         return
     if copy_to_repo:
         pdf_get_operation.copy_pdfs_to_repo()
         return
     if rename:
@@ -1431,14 +1558,31 @@
         return
 
     pdf_get_operation.main()
 
 
 @main.command(help_priority=13)
 @click.option(
+    "-a",
+    "--add",
+    type=click.Choice(
+        package_manager.discover_packages(
+            package_type=colrev.env.package_manager.PackageEndpointType.pdf_get_man,
+            installed_only=True,
+        )
+    ),
+    help="""PDF-get-man package to be added.""",
+)
+@click.option(
+    "-p",
+    "--params",
+    type=str,
+    help="Parameters",
+)
+@click.option(
     "-e",
     "--export",
     is_flag=True,
     default=False,
     help="Export a table.",
 )
 @click.option(
@@ -1461,31 +1605,43 @@
     default=False,
     help="Force mode",
 )
 @click.pass_context
 @catch_exception(handle=(colrev_exceptions.CoLRevException))
 def pdf_get_man(
     ctx: click.core.Context,
+    add: str,
+    params: str,
     export: bool,
     discard: bool,
     verbose: bool,
     force: bool,
 ) -> None:
-    """Get PDFs manually"""
+    """Get PDFs manually
+
+    Docs: https://colrev.readthedocs.io/en/latest/manual/pdf_retrieval/pdf_get.html
+    """
 
     review_manager = get_review_manager(
         ctx,
         {
             "verbose_mode": verbose,
             "force_mode": force,
             "exact_call": EXACT_CALL,
         },
     )
     pdf_get_man_operation = review_manager.get_pdf_get_man_operation()
 
+    if add:
+        package_manager = review_manager.get_package_manager()
+        package_manager.add_endpoint_for_operation(
+            operation=pdf_get_man_operation, package_identifier=add, params=params
+        )
+        return
+
     if export:
         records = pdf_get_man_operation.review_manager.dataset.load_records_dict()
         pdf_get_man_records = [
             r
             for r in records.values()
             if r["colrev_status"]
             in [
@@ -1560,14 +1716,31 @@
         hash_size=32,
     )
     print(f"last page: {last_page_average_hash_32}")
 
 
 @main.command(help_priority=14)
 @click.option(
+    "-a",
+    "--add",
+    type=click.Choice(
+        package_manager.discover_packages(
+            package_type=colrev.env.package_manager.PackageEndpointType.pdf_prep,
+            installed_only=True,
+        )
+    ),
+    help="""PDF-prep package to be added.""",
+)
+@click.option(
+    "-p",
+    "--params",
+    type=str,
+    help="Parameters",
+)
+@click.option(
     "--update_colrev_pdf_ids", is_flag=True, default=False, help="Update colrev_pdf_ids"
 )
 @click.option(
     "-b",
     "--batch_size",
     required=False,
     type=int,
@@ -1607,35 +1780,51 @@
     default=False,
     help="Force mode",
 )
 @click.pass_context
 @catch_exception(handle=(colrev_exceptions.CoLRevException))
 def pdf_prep(
     ctx: click.core.Context,
+    add: str,
+    params: str,
     batch_size: int,
     update_colrev_pdf_ids: bool,
     reprocess: bool,
     setup_custom_script: bool,
     tei: bool,
     verbose: bool,
     force: bool,
 ) -> None:
-    """Prepare PDFs"""
+    """Prepare PDFs
 
-    try:
-        review_manager = get_review_manager(
-            ctx,
-            {
-                "verbose_mode": verbose,
-                "force_mode": force,
-                "exact_call": EXACT_CALL,
-            },
+    Docs: https://colrev.readthedocs.io/en/latest/manual/pdf_retrieval/pdf_prep.html
+    """
+
+    # pylint: disable=import-outside-toplevel
+
+    review_manager = get_review_manager(
+        ctx,
+        {
+            "verbose_mode": verbose,
+            "force_mode": force,
+            "exact_call": EXACT_CALL,
+        },
+    )
+    pdf_prep_operation = review_manager.get_pdf_prep_operation(reprocess=reprocess)
+
+    if add:
+        package_manager = review_manager.get_package_manager()
+        package_manager.add_endpoint_for_operation(
+            operation=pdf_prep_operation,
+            package_identifier=add,
+            params=params,
         )
-        pdf_prep_operation = review_manager.get_pdf_prep_operation(reprocess=reprocess)
+        return
 
+    try:
         if update_colrev_pdf_ids:
             pdf_prep_operation.update_colrev_pdf_ids()
 
         elif setup_custom_script:
             pdf_prep_operation.setup_custom_script()
             print("Activated custom_pdf_prep_script.py.")
         elif tei:
@@ -1668,14 +1857,31 @@
         if input("Extract coverpage from another PDF? (y/n)") == "n":
             break
         record_id = input("ID of next PDF for coverpage extraction:")
 
 
 @main.command(help_priority=15)
 @click.option(
+    "-a",
+    "--add",
+    type=click.Choice(
+        package_manager.discover_packages(
+            package_type=colrev.env.package_manager.PackageEndpointType.pdf_prep_man,
+            installed_only=True,
+        )
+    ),
+    help="""PDF-prep-man package to be added.""",
+)
+@click.option(
+    "-p",
+    "--params",
+    type=str,
+    help="Parameters",
+)
+@click.option(
     "-dfp",
     "--delete_first_page",
     type=str,
     help="Delete first page of PDF. Format: --delete_first_page ID",
 )
 @click.option(
     "--stats",
@@ -1715,34 +1921,44 @@
     default=False,
     help="Force mode",
 )
 @click.pass_context
 @catch_exception(handle=(colrev_exceptions.CoLRevException))
 def pdf_prep_man(
     ctx: click.core.Context,
+    add: str,
+    params: str,
     delete_first_page: str,
     stats: bool,
     discard: bool,
     extract: bool,
     apply: bool,
     verbose: bool,
     force: bool,
 ) -> None:
-    """Prepare PDFs manually"""
+    """Prepare PDFs manually
+
+    Docs: https://colrev.readthedocs.io/en/latest/manual/pdf_retrieval/pdf_prep.html
+    """
 
     review_manager = get_review_manager(
         ctx,
         {
             "verbose_mode": verbose,
             "force_mode": force,
             "exact_call": EXACT_CALL,
         },
     )
     pdf_prep_man_operation = review_manager.get_pdf_prep_man_operation()
 
+    if add:
+        package_manager = review_manager.get_package_manager()
+        package_manager.add_endpoint_for_operation(
+            operation=pdf_prep_man_operation, package_identifier=add, params=params
+        )
     if delete_first_page:
         __delete_first_pages_cli(pdf_prep_man_operation, delete_first_page)
         return
     if discard:
         pdf_prep_man_operation.discard()
         return
     if stats:
@@ -1756,32 +1972,43 @@
         return
 
     pdf_prep_man_operation.main()
 
 
 @main.command(help_priority=16)
 @click.option(
+    "-a",
+    "--add",
+    type=click.Choice(
+        package_manager.discover_packages(
+            package_type=colrev.env.package_manager.PackageEndpointType.data,
+            installed_only=True,
+        )
+    ),
+    help="Data package to be added.",
+)
+@click.option(
+    "-p",
+    "--params",
+    type=str,
+    help="Parameters",
+)
+@click.option(
     "--profile",
     is_flag=True,
     default=False,
     help="Create a sample profile (papers per journal and year)",
 )
 @click.option(
     "--reading_heuristics",
     is_flag=True,
     default=False,
     help="Heuristics to prioritize reading efforts",
 )
 @click.option(
-    "-a",
-    "--add",
-    type=str,
-    help="Add a data_format endpoint (e.g., colrev.structured)",
-)
-@click.option(
     "-scs",
     "--setup_custom_script",
     is_flag=True,
     default=False,
     help="Setup template for custom search script.",
 )
 @click.option(
@@ -1798,24 +2025,26 @@
     default=False,
     help="Force mode",
 )
 @click.pass_context
 @catch_exception(handle=(colrev_exceptions.CoLRevException))
 def data(
     ctx: click.core.Context,
+    add: str,
+    params: str,
     profile: bool,
     reading_heuristics: bool,
-    add: str,
     setup_custom_script: bool,
     verbose: bool,
     force: bool,
 ) -> None:
-    """Complete selected forms of data analysis and synthesis"""
+    """Complete selected forms of data analysis and synthesis
 
-    import colrev.ui_cli.add_packages
+    Docs: https://colrev.readthedocs.io/en/latest/manual/data/data.html
+    """
 
     review_manager = get_review_manager(
         ctx,
         {
             "verbose_mode": verbose,
             "force_mode": (force or profile),
             "exact_call": EXACT_CALL,
@@ -1833,17 +2062,19 @@
     if setup_custom_script:
         data_operation.setup_custom_script()
         print("Activated custom_data_script.py.")
         print("Please update the data_format in settings.json and commit.")
         return
 
     if add:
-        colrev.ui_cli.add_packages.add_data(
-            data_operation=data_operation,
-            add=add,
+        package_manager = review_manager.get_package_manager()
+        package_manager.add_endpoint_for_operation(
+            operation=data_operation,
+            package_identifier=add,
+            params=params,
         )
         return
 
     ret = data_operation.main()
     if data_operation.review_manager.in_ci_environment():
         if ret["ask_to_commit"]:
             review_manager.create_commit(msg="Data and synthesis", manual_author=True)
@@ -1913,19 +2144,18 @@
     verbose: bool,
     force: bool,
 ) -> None:
     """Validate changes in the given commit (scope)
 
     \b
     The validation scope argument can be
-    - a commit-sha,
-    - a commit tree,
+    - A commit-sha,
     - '.' for the latest commit,
     - HEAD~4 for commit 4 before HEAD
-    - a contributor name
+    - A contributor name
     """
 
     review_manager = get_review_manager(
         ctx,
         {
             "verbose_mode": verbose,
             "force_mode": force,
@@ -1952,43 +2182,27 @@
 
 @main.command(help_priority=18)
 @click.option(
     "--id",  # pylint: disable=invalid-name
     help="Record ID to trace (citation_key).",
     required=True,
 )
-@click.option(
-    "-v",
-    "--verbose",
-    is_flag=True,
-    default=False,
-    help="Verbose: printing more infos",
-)
-@click.option(
-    "-f",
-    "--force",
-    is_flag=True,
-    default=False,
-    help="Force mode",
-)
 @click.pass_context
 @catch_exception(handle=(colrev_exceptions.CoLRevException))
 def trace(
     ctx: click.core.Context,
     id: str,  # pylint: disable=invalid-name
-    verbose: bool,
-    force: bool,
 ) -> None:
     """Trace a record"""
 
     review_manager = get_review_manager(
         ctx,
         {
-            "verbose_mode": verbose,
-            "force_mode": force,
+            "verbose_mode": False,
+            "force_mode": False,
             "exact_call": EXACT_CALL,
         },
     )
     trace_operation = review_manager.get_trace_operation()
     trace_operation.main(record_id=id)
 
 
@@ -2118,15 +2332,14 @@
     help="Install a new resource providing its url "
     + "(e.g., a curated metadata repository)",
 )
 @click.option("--pull", is_flag=True, default=False, help="Pull curated metadata")
 @click.option(
     "-s", "--status", is_flag=True, default=False, help="Print environment status"
 )
-@click.option("--start", is_flag=True, default=False, help="Start environment services")
 @click.option(
     "-r",
     "--register",
     is_flag=True,
     default=False,
     help="Register a repository in the CoLRev environment",
 )
@@ -2145,37 +2358,30 @@
 @click.option(
     "-v",
     "--verbose",
     is_flag=True,
     default=False,
     help="Verbose: printing more infos",
 )
-@click.option(
-    "-f",
-    "--force",
-    is_flag=True,
-    default=False,
-    help="Force mode",
-)
 @click.pass_context
 def env(
     ctx: click.core.Context,
     index: bool,
     install: str,
     pull: bool,
     status: bool,
-    start: bool,
     register: bool,
     unregister: bool,
     update_package_list: bool,
     verbose: bool,
-    force: bool,
 ) -> None:
     """Manage the environment"""
 
+    # pylint: disable=too-many-branches
+
     review_manager = get_review_manager(
         ctx,
         {
             "verbose_mode": verbose,
             "force_mode": True,
         },
     )
@@ -2195,15 +2401,15 @@
             if "/curated_metadata/" not in curated_resource_path:
                 continue
 
             review_manager = get_review_manager(
                 ctx,
                 {
                     "verbose_mode": verbose,
-                    "force_mode": force,
+                    "force_mode": False,
                     "path_str": curated_resource_path,
                 },
             )
 
             review_manager.dataset.pull_if_repo_clean()
             print(f"Pulled {curated_resource_path}")
         return
@@ -2249,16 +2455,14 @@
         package_manager.update_package_list()
 
     local_index = review_manager.get_local_index()
 
     if index:
         local_index.index()
         local_index.load_journal_rankings()
-    elif start:
-        print("Started.")
 
 
 @main.command(help_priority=21)
 # @click.option("-v", "--view", is_flag=True, default=False)
 @click.option(
     "-uh",
     "--update_hooks",
@@ -2270,38 +2474,38 @@
     "-m",
     "--modify",
     type=str,
     default="",
     help="Modify the settings through the command line",
 )
 @click.option(
+    "-g",
+    "--update-global",
+    help="Global settings to update",
+)
+@click.option(
     "-v",
     "--verbose",
     is_flag=True,
     default=False,
     help="Verbose: printing more infos",
 )
 @click.option(
     "-f",
     "--force",
     is_flag=True,
     default=False,
     help="Force mode",
 )
-@click.option(
-    "-g",
-    "--update-global",
-    help="Global settings to update",
-)
 @click.pass_context
 def settings(
     ctx: click.core.Context,
     update_hooks: bool,
-    update_global: str,
     modify: str,
+    update_global: str,
     verbose: bool,
     force: bool,
 ) -> None:
     """Settings of the CoLRev project"""
 
     # pylint: disable=reimported
 
@@ -2390,35 +2594,19 @@
     help="Add a sync pre-commit hook",
 )
 @click.option(
     "-src",
     type=click.Path(exists=True),
     help="Sync selected citations from source file.",
 )
-@click.option(
-    "-v",
-    "--verbose",
-    is_flag=True,
-    default=False,
-    help="Verbose: printing more infos",
-)
-@click.option(
-    "-f",
-    "--force",
-    is_flag=True,
-    default=False,
-    help="Force mode",
-)
 @click.pass_context
 def sync(
     ctx: click.core.Context,
     add_hook: bool,
     src: Path,
-    verbose: bool,
-    force: bool,
 ) -> None:
     """Sync records from CoLRev environment to non-CoLRev repo"""
 
     if add_hook:
         if not Path(".git").is_dir():
             print("Not in a git directory.")
             return
@@ -2516,34 +2704,18 @@
     pull_operation = review_manager.get_pull_operation()
 
     pull_operation.main()
 
 
 @main.command(help_priority=24)
 @click.argument("git_url")
-@click.option(
-    "-v",
-    "--verbose",
-    is_flag=True,
-    default=False,
-    help="Verbose: printing more infos",
-)
-@click.option(
-    "-f",
-    "--force",
-    is_flag=True,
-    default=False,
-    help="Force mode",
-)
 @click.pass_context
 def clone(
     ctx: click.core.Context,
     git_url: str,
-    verbose: bool,
-    force: bool,
 ) -> None:
     """Create local clone from shared CoLRev repository with git_url"""
 
     clone_operation = colrev.review_manager.ReviewManager.get_clone_operation(
         git_url=git_url
     )
     clone_operation.clone_git_repo()
@@ -2604,60 +2776,20 @@
     push_operation = review_manager.get_push_operation()
 
     push_operation.main(
         records_only=records_only, project_only=project_only, all_records=all
     )
 
 
-@main.command(hidden=True, help_priority=26)
-@click.option(
-    "-v",
-    "--verbose",
-    is_flag=True,
-    default=False,
-    help="Verbose: printing more infos",
-)
-@click.option(
-    "-f",
-    "--force",
-    is_flag=True,
-    default=False,
-    help="Force mode",
-)
-@click.pass_context
-def service(
-    ctx: click.core.Context,
-    verbose: bool,
-    force: bool,
-) -> None:
-    """Service for real-time reviews"""
-
-    try:
-        review_manager = get_review_manager(
-            ctx,
-            {"verbose_mode": verbose, "force_mode": force},
-        )
-        review_manager.get_service_operation()
-
-    except KeyboardInterrupt:
-        print("\nPressed ctrl-c. Shutting down service")
-
-    if review_manager.dataset.has_changes():
-        if input("Commit current changes (y/n)?") == "y":
-            review_manager.create_commit(msg="Update (using CoLRev service)")
-    else:
-        print("No changes to commit")
-
-
 def __validate_show(ctx: click.core.Context, param: str, value: str) -> None:
     if value not in ["sample", "settings", "prisma", "venv"]:
         raise click.BadParameter("Invalid argument")
 
 
-@main.command(help_priority=27)
+@main.command(help_priority=26)
 @click.argument("keyword")
 @click.option(
     "-v",
     "--verbose",
     is_flag=True,
     default=False,
     help="Verbose: printing more infos",
@@ -2777,15 +2909,15 @@
 #     )
 #     se_instance = colrev.ui_web.settings_editor.SettingsEditor(
 #         review_manager=review_manager
 #     )
 #     se_instance.open_settings_editor()
 
 
-@main.command(hidden=True, help_priority=29)
+@main.command(hidden=True, help_priority=27)
 @click.option(
     "--disable_auto",
     is_flag=True,
     default=False,
     help="Disable automated upgrades",
 )
 @click.option(
@@ -2823,15 +2955,15 @@
     review_manager = colrev.review_manager.ReviewManager(
         force_mode=True, verbose_mode=verbose
     )
     upgrade_operation = review_manager.get_upgrade()
     upgrade_operation.main()
 
 
-@main.command(hidden=True, help_priority=30)
+@main.command(hidden=True, help_priority=28)
 @click.option(
     "-v",
     "--verbose",
     is_flag=True,
     default=False,
     help="Verbose: printing more infos",
 )
@@ -2854,15 +2986,15 @@
         ctx,
         {"verbose_mode": verbose, "force_mode": force},
     )
     repare_operation = review_manager.get_repare()
     repare_operation.main()
 
 
-@main.command(help_priority=31)
+@main.command(help_priority=29)
 @click.option(
     "--ids",
     help="Remove records and their origins from the repository (ID1,ID2,...).",
     required=False,
 )
 @click.option(
     "-v",
@@ -2894,15 +3026,15 @@
 
     remove_operation = review_manager.get_remove_operation()
 
     if ids:
         remove_operation.remove_records(ids=ids)
 
 
-@main.command(hidden=True, help_priority=32)
+@main.command(hidden=True, help_priority=30)
 @click.option(
     "-v",
     "--verbose",
     is_flag=True,
     default=False,
     help="Verbose: printing more infos",
 )
@@ -2920,15 +3052,15 @@
     force: bool,
 ) -> None:
     """Show the CoLRev documentation."""
 
     webbrowser.open("https://colrev.readthedocs.io/en/latest/")
 
 
-@main.command(help_priority=33)
+@main.command(help_priority=31)
 @click.option(
     "--branch",
     help="Branch to merge.",
     required=False,
 )
 @click.option(
     "-v",
@@ -2964,15 +3096,15 @@
         print(f"possible branches: {','.join([b.name for b in git_repo.heads])}")
         return
 
     merge_operation = review_manager.get_merge_operation()
     merge_operation.main(branch=branch)
 
 
-@main.command(help_priority=34)
+@main.command(help_priority=32)
 @click.argument("selection")
 @click.option(
     "-v",
     "--verbose",
     is_flag=True,
     default=False,
     help="Verbose: printing more infos",
@@ -3000,15 +3132,15 @@
 
     if selection == "commit":
         colrev.operation.CheckOperation(review_manager=review_manager)
         git_repo = review_manager.dataset.get_repo()
         git_repo.git.reset("--hard", "HEAD~1")
 
 
-@main.command(help_priority=35)
+@main.command(help_priority=33)
 @click.pass_context
 def version(
     ctx: click.core.Context,
 ) -> None:
     """Show colrev version."""
 
     from importlib.metadata import version
@@ -3055,10 +3187,7 @@
         if case_insensitive
         else {}
     )
     shell, path = click_completion.core.install(  # nosec
         shell=shell, path=path, append=append, extra_env=extra_env
     )
     click.echo(f"{shell} completion installed in {path}")
-
-
-# register_repl(main)
```

### Comparing `colrev-0.9.2/colrev/ui_cli/cli_status_printer.py` & `colrev-0.9.3/colrev/ui_cli/cli_status_printer.py`

 * *Files 0% similar despite different names*

```diff
@@ -238,15 +238,15 @@
     #     )
     if ExitCodes.FAIL == ret_check["status"]:
         # print(f"  ReviewManager.check_repo()  ...  {colors.RED}FAIL{colors.END}")
         # print(f'{ret_check["msg"]}\n')
         return
 
     # To format:
-    status_operation.review_manager.dataset.save_records_dict(records=checker.records)
+    # status_operation.review_manager.dataset.save_records_dict(records=checker.records)
 
     # if (
     #     not status_operation.review_manager.in_virtualenv()
     #     and status_operation.review_manager.verbose_mode
     # ):
     #     print(
     #         f"\n  {colors.RED}WARNING{colors.END} running scripts outside of virtualenv"
```

### Comparing `colrev-0.9.2/colrev/ui_cli/cli_validation.py` & `colrev-0.9.3/colrev/ui_cli/cli_validation.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ui_cli/dedupe_errors.py` & `colrev-0.9.3/colrev/ui_cli/dedupe_errors.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ui_cli/search_backward_selective.py` & `colrev-0.9.3/colrev/ui_cli/search_backward_selective.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ui_cli/setup_custom_scripts.py` & `colrev-0.9.3/colrev/ui_cli/setup_custom_scripts.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/colrev/ui_cli/show_printer.py` & `colrev-0.9.3/colrev/ui_cli/show_printer.py`

 * *Files identical despite different names*

### Comparing `colrev-0.9.2/pyproject.toml` & `colrev-0.9.3/pyproject.toml`

 * *Files 16% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 [tool.poetry]
 name = "colrev"
-version = "0.9.2"
+version = "0.9.3"
 description = "CoLRev: An open-source environment for collaborative reviews"
 authors = ["Gerit Wagner <gerit.wagner@hec.ca>", "Julian Prester <julian.prester@sydney.edu.au>"]
 license = "MIT"
 readme = "README.md"
 homepage="https://colrev.readthedocs.io/en/latest/"
 repository = "https://github.com/CoLRev-Environment/colrev"
 documentation = "https://colrev.readthedocs.io/en/latest/"
@@ -18,29 +18,28 @@
     "Programming Language :: Python :: 3.9",
     "Programming Language :: Python :: 3.10",
     "Programming Language :: Python :: 3.11",
     "Topic :: Scientific/Engineering",
     "Operating System :: OS Independent",
     "Typing :: Typed",
 ]
-include = ["CONTRIBUTING.md", "CHANGELOG.md", "LICENSE", "README.md", "colrev/py.typed"]
+include = ["CONTRIBUTING.md", "CHANGELOG.md", "LICENSE", "README.md", "colrev/py.typed", "colrev/.colrev_endpoints.json"]
 
 [tool.poetry.scripts]
 colrev = "colrev.ui_cli.cli:main"
 colrev-hooks-check = "colrev.hooks.check:main"
 colrev-hooks-format = "colrev.hooks.format:main"
 colrev-hooks-report = "colrev.hooks.report:main"
 colrev-hooks-share = "colrev.hooks.share:main"
 colrev-hooks-update = "colrev.hooks.update:main"
 
 [tool.poetry.dependencies]
 python = ">=3.8, <4"
 alphabet-detector = "^0.0.7"
 beautifulsoup4 = "^4.11.1"
-click8 = "^8.0.1"
 click_completion = "^0.5.2"
 crossrefapi = "^1.5.0"
 dacite = "^1.6.0"
 daff = "^1.3.46"
 dedupe = "^2.0.20"
 dictdiffer = "^0.9.0"
 docker = "6.0.0"
@@ -62,27 +61,27 @@
 transitions = "^0.8.11"
 "zope.interface" = "^5.5.0"
 pycountry = "^22.3.5"
 glom = "^22.1.0"
 pre-commit = "^2.20.0"
 Jinja2 = "^3.1.2"
 dataclasses-jsonschema = "^2.15.3"
-watchdog = "^2.2.1"
 openpyxl = "^3.1.2"
 pylint = "^2.17.2"
 pymupdf = "^1.22.0"
 imagehash = "^4.3.1"
 defusedxml = "^0.7.1"
 requests-mock = "^1.10.0"
 dash = "^2.11.1"
 levenshtein = "^0.21.0" # faster implementation of levenshtein distance (for thefuzz)
 pyalex = "^0.10"
 rispy = "^0.7.1"
 colrev-asreview = "^0.1.0"
 click-repl = "^0.3.0"
+click = "^8.1.6"
 
 [tool.poetry.group.docs.dependencies]
 Sphinx = "^5.2.3"
 sphinx-autodoc-typehints = "^1.19.4"
 sphinx-click = "^4.3.0"
 sphinx-rtd-theme = "^1.1.1"
 "sphinxcontrib.datatemplates" = "^0.9.2"
@@ -92,11 +91,17 @@
 [tool.poetry.group.dev.dependencies]
 pytest = "^7.2.1"
 coverage = "^6.5.0"
 types-click = "^7.1.8"
 pytest-mock = "^3.10.0"
 requests-mock = "^1.10.0"
 
+[tool.ruff]
+line-length = 160
+
+[tool.ruff.per-file-ignores]
+"**/{tests,docs}/*" = ["E501"]
+
 [build-system]
 # requires = ["poetry>=1.2.0b1"]
 requires = ["poetry-core>=1.0.0"]
 build-backend = "poetry.core.masonry.api"
```

### Comparing `colrev-0.9.2/PKG-INFO` & `colrev-0.9.3/PKG-INFO`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: colrev
-Version: 0.9.2
+Version: 0.9.3
 Summary: CoLRev: An open-source environment for collaborative reviews
 Home-page: https://colrev.readthedocs.io/en/latest/
 License: MIT
 Keywords: research,reproducible research,open science,literature,literature review,systematic review,systematic literature review
 Author: Gerit Wagner
 Author-email: gerit.wagner@hec.ca
 Requires-Python: >=3.8,<4
@@ -21,16 +21,16 @@
 Classifier: Typing :: Typed
 Requires-Dist: GitPython (>=3.1.29,<4.0.0)
 Requires-Dist: Jinja2 (>=3.1.2,<4.0.0)
 Requires-Dist: PyPDF2 (>=1.28.6,<2.0.0)
 Requires-Dist: PyYAML (>=6.0.0,<7.0.0)
 Requires-Dist: alphabet-detector (>=0.0.7,<0.0.8)
 Requires-Dist: beautifulsoup4 (>=4.11.1,<5.0.0)
+Requires-Dist: click (>=8.1.6,<9.0.0)
 Requires-Dist: click-repl (>=0.3.0,<0.4.0)
-Requires-Dist: click8 (>=8.0.1,<9.0.0)
 Requires-Dist: click_completion (>=0.5.2,<0.6.0)
 Requires-Dist: colrev-asreview (>=0.1.0,<0.2.0)
 Requires-Dist: crossrefapi (>=1.5.0,<2.0.0)
 Requires-Dist: dacite (>=1.6.0,<2.0.0)
 Requires-Dist: daff (>=1.3.46,<2.0.0)
 Requires-Dist: dash (>=2.11.1,<3.0.0)
 Requires-Dist: dataclasses-jsonschema (>=2.15.3,<3.0.0)
@@ -58,15 +58,14 @@
 Requires-Dist: requests (>=2.28.1,<3.0.0)
 Requires-Dist: requests-cache (>=0.9.6,<0.10.0)
 Requires-Dist: requests-mock (>=1.10.0,<2.0.0)
 Requires-Dist: rispy (>=0.7.1,<0.8.0)
 Requires-Dist: thefuzz (>=0.19.0,<0.20.0)
 Requires-Dist: tqdm (>=4.64.1,<5.0.0)
 Requires-Dist: transitions (>=0.8.11,<0.9.0)
-Requires-Dist: watchdog (>=2.2.1,<3.0.0)
 Requires-Dist: zope.interface (>=5.5.0,<6.0.0)
 Project-URL: Documentation, https://colrev.readthedocs.io/en/latest/
 Project-URL: Repository, https://github.com/CoLRev-Environment/colrev
 Description-Content-Type: text/markdown
 
 # Collaborative Literature Reviews (CoLRev)
```

