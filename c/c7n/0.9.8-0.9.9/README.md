# Comparing `tmp/c7n-0.9.8-py3-none-any.whl.zip` & `tmp/c7n-0.9.9-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,8 +1,8 @@
-Zip file size: 472275 bytes, number of entries: 141
+Zip file size: 475724 bytes, number of entries: 141
 -rw-rw-r--  2.0 unx       81 b- defN 20-Nov-17 16:47 c7n/__init__.py
 -rw-rw-r--  2.0 unx     3263 b- defN 20-Nov-17 16:47 c7n/cache.py
 -rw-rw-r--  2.0 unx    13215 b- defN 20-Oct-15 17:51 c7n/cli.py
 -rw-rw-r--  2.0 unx    18547 b- defN 20-Nov-17 16:47 c7n/commands.py
 -rw-rw-r--  2.0 unx     1122 b- defN 20-Nov-17 16:47 c7n/config.py
 -rw-rw-r--  2.0 unx     4485 b- defN 20-Nov-17 16:47 c7n/credentials.py
 -rw-rw-r--  2.0 unx     4915 b- defN 20-Nov-17 16:47 c7n/ctx.py
@@ -16,128 +16,128 @@
 -rw-rw-r--  2.0 unx     7455 b- defN 20-Nov-17 16:47 c7n/log.py
 -rw-rw-r--  2.0 unx     1657 b- defN 20-Nov-17 16:47 c7n/lookup.py
 -rw-rw-r--  2.0 unx     4683 b- defN 20-Nov-17 16:47 c7n/manager.py
 -rw-rw-r--  2.0 unx    58863 b- defN 20-Nov-17 16:47 c7n/mu.py
 -rw-rw-r--  2.0 unx    14796 b- defN 20-Nov-17 16:47 c7n/output.py
 -rw-rw-r--  2.0 unx    45922 b- defN 20-Nov-17 16:47 c7n/policy.py
 -rw-rw-r--  2.0 unx     3541 b- defN 20-Nov-17 16:47 c7n/provider.py
--rw-rw-r--  2.0 unx    29759 b- defN 20-Nov-17 16:47 c7n/query.py
+-rw-rw-r--  2.0 unx    29815 b- defN 20-Dec-14 15:57 c7n/query.py
 -rw-rw-r--  2.0 unx     2971 b- defN 20-Nov-17 16:47 c7n/registry.py
 -rw-rw-r--  2.0 unx     6455 b- defN 20-Nov-17 16:47 c7n/resolver.py
 -rw-rw-r--  2.0 unx    23675 b- defN 20-Nov-17 16:47 c7n/schema.py
 -rw-rw-r--  2.0 unx     4687 b- defN 20-Nov-17 16:47 c7n/sqsexec.py
 -rw-rw-r--  2.0 unx     3897 b- defN 20-Nov-17 16:47 c7n/structure.py
 -rw-rw-r--  2.0 unx    39615 b- defN 20-Nov-17 16:47 c7n/tags.py
 -rw-rw-r--  2.0 unx     8662 b- defN 20-Nov-17 16:47 c7n/testing.py
--rw-rw-r--  2.0 unx    20601 b- defN 20-Nov-17 16:47 c7n/utils.py
--rw-rw-r--  2.0 unx      136 b- defN 20-Nov-17 16:47 c7n/version.py
+-rw-rw-r--  2.0 unx    22059 b- defN 20-Dec-14 15:57 c7n/utils.py
+-rw-rw-r--  2.0 unx       57 b- defN 20-Dec-14 15:57 c7n/version.py
 -rw-rw-r--  2.0 unx      389 b- defN 20-Nov-17 16:47 c7n/actions/__init__.py
--rw-rw-r--  2.0 unx     5563 b- defN 20-Nov-17 16:47 c7n/actions/autotag.py
+-rw-rw-r--  2.0 unx     5826 b- defN 20-Dec-14 15:57 c7n/actions/autotag.py
 -rw-rw-r--  2.0 unx     2408 b- defN 20-Nov-17 16:47 c7n/actions/core.py
 -rw-rw-r--  2.0 unx     3599 b- defN 20-Nov-17 16:47 c7n/actions/invoke.py
 -rw-rw-r--  2.0 unx     5188 b- defN 20-Nov-17 16:47 c7n/actions/metric.py
 -rw-rw-r--  2.0 unx     8912 b- defN 20-Nov-17 16:47 c7n/actions/network.py
 -rw-rw-r--  2.0 unx    11354 b- defN 20-Nov-17 16:47 c7n/actions/notify.py
 -rw-rw-r--  2.0 unx     3559 b- defN 20-Nov-17 16:47 c7n/actions/policy.py
--rw-rw-r--  2.0 unx     5148 b- defN 20-Nov-17 16:47 c7n/actions/webhook.py
+-rw-rw-r--  2.0 unx     5176 b- defN 20-Dec-14 15:57 c7n/actions/webhook.py
 -rw-rw-r--  2.0 unx      548 b- defN 20-Nov-17 16:47 c7n/filters/__init__.py
 -rw-rw-r--  2.0 unx     5253 b- defN 20-Nov-17 16:47 c7n/filters/config.py
--rw-rw-r--  2.0 unx    32647 b- defN 20-Nov-17 16:47 c7n/filters/core.py
+-rw-rw-r--  2.0 unx    31661 b- defN 20-Dec-14 15:57 c7n/filters/core.py
 -rw-rw-r--  2.0 unx     4467 b- defN 20-Nov-17 16:47 c7n/filters/health.py
 -rw-rw-r--  2.0 unx    11356 b- defN 20-Nov-17 16:47 c7n/filters/iamaccess.py
 -rw-rw-r--  2.0 unx     3666 b- defN 20-Nov-17 16:47 c7n/filters/iamanalyzer.py
 -rw-rw-r--  2.0 unx     1910 b- defN 20-Nov-17 16:47 c7n/filters/kms.py
--rw-rw-r--  2.0 unx     9717 b- defN 20-Nov-17 16:47 c7n/filters/metrics.py
+-rw-rw-r--  2.0 unx     9937 b- defN 20-Dec-14 15:57 c7n/filters/metrics.py
 -rw-rw-r--  2.0 unx     2027 b- defN 20-Nov-17 16:47 c7n/filters/missing.py
 -rw-rw-r--  2.0 unx     1614 b- defN 20-Nov-17 16:47 c7n/filters/multiattr.py
 -rw-rw-r--  2.0 unx    23620 b- defN 20-Nov-17 16:47 c7n/filters/offhours.py
 -rw-rw-r--  2.0 unx     5730 b- defN 20-Nov-17 16:47 c7n/filters/related.py
 -rw-rw-r--  2.0 unx     6626 b- defN 20-Nov-17 16:47 c7n/filters/revisions.py
 -rw-rw-r--  2.0 unx    10382 b- defN 20-Nov-17 16:47 c7n/filters/vpc.py
 -rw-rw-r--  2.0 unx      106 b- defN 20-Nov-17 16:47 c7n/reports/__init__.py
 -rw-rw-r--  2.0 unx     8923 b- defN 20-Nov-17 16:47 c7n/reports/csvout.py
 -rw-rw-r--  2.0 unx     2310 b- defN 20-Nov-17 16:47 c7n/resources/__init__.py
--rw-rw-r--  2.0 unx    64649 b- defN 20-Nov-17 16:47 c7n/resources/account.py
+-rw-rw-r--  2.0 unx    65992 b- defN 20-Dec-14 15:57 c7n/resources/account.py
 -rw-rw-r--  2.0 unx     2790 b- defN 20-Nov-17 16:47 c7n/resources/acm.py
 -rw-rw-r--  2.0 unx    12601 b- defN 20-Nov-17 16:47 c7n/resources/ami.py
 -rw-rw-r--  2.0 unx    22322 b- defN 20-Nov-17 16:47 c7n/resources/apigw.py
--rw-rw-r--  2.0 unx    35672 b- defN 20-Nov-17 16:47 c7n/resources/appelb.py
+-rw-rw-r--  2.0 unx    38498 b- defN 20-Dec-14 15:57 c7n/resources/appelb.py
 -rw-rw-r--  2.0 unx     5587 b- defN 20-Nov-17 16:47 c7n/resources/artifact.py
--rw-rw-r--  2.0 unx    59142 b- defN 20-Nov-17 16:47 c7n/resources/asg.py
+-rw-rw-r--  2.0 unx    60126 b- defN 20-Dec-14 15:57 c7n/resources/asg.py
 -rw-rw-r--  2.0 unx    22922 b- defN 20-Nov-17 16:47 c7n/resources/aws.py
 -rw-rw-r--  2.0 unx    21431 b- defN 20-Nov-17 16:47 c7n/resources/awslambda.py
 -rw-rw-r--  2.0 unx     2786 b- defN 20-Nov-17 16:47 c7n/resources/backup.py
 -rw-rw-r--  2.0 unx     5904 b- defN 20-Nov-17 16:47 c7n/resources/batch.py
 -rw-rw-r--  2.0 unx     6823 b- defN 20-Nov-17 16:47 c7n/resources/cfn.py
 -rw-rw-r--  2.0 unx    24908 b- defN 20-Nov-17 16:47 c7n/resources/cloudfront.py
 -rw-rw-r--  2.0 unx     1084 b- defN 20-Nov-17 16:47 c7n/resources/cloudsearch.py
 -rw-rw-r--  2.0 unx     7817 b- defN 20-Nov-17 16:47 c7n/resources/cloudtrail.py
 -rw-rw-r--  2.0 unx     8726 b- defN 20-Nov-17 16:47 c7n/resources/code.py
 -rw-rw-r--  2.0 unx     3176 b- defN 20-Nov-17 16:47 c7n/resources/cognito.py
 -rw-rw-r--  2.0 unx     3362 b- defN 20-Nov-17 16:47 c7n/resources/config.py
--rw-rw-r--  2.0 unx    15058 b- defN 20-Nov-17 16:47 c7n/resources/cw.py
+-rw-rw-r--  2.0 unx    15167 b- defN 20-Dec-14 15:57 c7n/resources/cw.py
 -rw-rw-r--  2.0 unx     5885 b- defN 20-Nov-17 16:47 c7n/resources/datapipeline.py
 -rw-rw-r--  2.0 unx      618 b- defN 20-Nov-17 16:47 c7n/resources/directconnect.py
 -rw-rw-r--  2.0 unx     3693 b- defN 20-Nov-17 16:47 c7n/resources/directory.py
 -rw-rw-r--  2.0 unx      621 b- defN 20-Nov-17 16:47 c7n/resources/dlm.py
 -rw-rw-r--  2.0 unx    13835 b- defN 20-Nov-17 16:47 c7n/resources/dms.py
 -rw-rw-r--  2.0 unx    22690 b- defN 20-Nov-17 16:47 c7n/resources/dynamodb.py
--rw-rw-r--  2.0 unx    53512 b- defN 20-Nov-17 16:47 c7n/resources/ebs.py
--rw-rw-r--  2.0 unx    73255 b- defN 20-Nov-17 16:47 c7n/resources/ec2.py
--rw-rw-r--  2.0 unx    13247 b- defN 20-Nov-17 16:47 c7n/resources/ecr.py
+-rw-rw-r--  2.0 unx    56735 b- defN 20-Dec-14 15:57 c7n/resources/ebs.py
+-rw-rw-r--  2.0 unx    73273 b- defN 20-Dec-14 15:57 c7n/resources/ec2.py
+-rw-rw-r--  2.0 unx    13247 b- defN 20-Dec-14 15:57 c7n/resources/ecr.py
 -rw-rw-r--  2.0 unx    27084 b- defN 20-Nov-17 16:47 c7n/resources/ecs.py
 -rw-rw-r--  2.0 unx     8159 b- defN 20-Nov-17 16:47 c7n/resources/efs.py
 -rw-rw-r--  2.0 unx     6799 b- defN 20-Nov-17 16:47 c7n/resources/eks.py
 -rw-rw-r--  2.0 unx    17207 b- defN 20-Nov-17 16:47 c7n/resources/elasticache.py
 -rw-rw-r--  2.0 unx     6583 b- defN 20-Nov-17 16:47 c7n/resources/elasticbeanstalk.py
--rw-rw-r--  2.0 unx     8969 b- defN 20-Nov-17 16:47 c7n/resources/elasticsearch.py
+-rw-rw-r--  2.0 unx    11965 b- defN 20-Dec-14 15:57 c7n/resources/elasticsearch.py
 -rw-rw-r--  2.0 unx    29245 b- defN 20-Nov-17 16:47 c7n/resources/elb.py
 -rw-rw-r--  2.0 unx    10989 b- defN 20-Nov-17 16:47 c7n/resources/emr.py
 -rw-rw-r--  2.0 unx    10242 b- defN 20-Nov-17 16:47 c7n/resources/fsx.py
 -rw-rw-r--  2.0 unx      961 b- defN 20-Nov-17 16:47 c7n/resources/gamelift.py
 -rw-rw-r--  2.0 unx     5812 b- defN 20-Nov-17 16:47 c7n/resources/glacier.py
 -rw-rw-r--  2.0 unx    22876 b- defN 20-Nov-17 16:47 c7n/resources/glue.py
 -rw-rw-r--  2.0 unx     4419 b- defN 20-Nov-17 16:47 c7n/resources/health.py
 -rw-rw-r--  2.0 unx     2808 b- defN 20-Nov-17 16:47 c7n/resources/hsm.py
--rw-rw-r--  2.0 unx    78183 b- defN 20-Nov-17 16:47 c7n/resources/iam.py
+-rw-rw-r--  2.0 unx    79316 b- defN 20-Dec-14 15:57 c7n/resources/iam.py
 -rw-rw-r--  2.0 unx      552 b- defN 20-Nov-17 16:47 c7n/resources/iot.py
 -rw-rw-r--  2.0 unx     2791 b- defN 20-Nov-17 16:47 c7n/resources/kafka.py
 -rw-rw-r--  2.0 unx     9448 b- defN 20-Nov-17 16:47 c7n/resources/kinesis.py
--rw-rw-r--  2.0 unx    12069 b- defN 20-Nov-17 16:47 c7n/resources/kms.py
+-rw-rw-r--  2.0 unx    12152 b- defN 20-Dec-14 15:57 c7n/resources/kms.py
 -rw-rw-r--  2.0 unx     1026 b- defN 20-Nov-17 16:47 c7n/resources/lightsail.py
 -rw-rw-r--  2.0 unx     1722 b- defN 20-Nov-17 16:47 c7n/resources/ml.py
 -rw-rw-r--  2.0 unx     5003 b- defN 20-Nov-17 16:47 c7n/resources/mq.py
 -rw-rw-r--  2.0 unx     5691 b- defN 20-Nov-17 16:47 c7n/resources/opsworks.py
 -rw-rw-r--  2.0 unx     2200 b- defN 20-Sep-08 15:42 c7n/resources/qldb.py
--rw-rw-r--  2.0 unx    58753 b- defN 20-Nov-17 16:47 c7n/resources/rds.py
--rw-rw-r--  2.0 unx    17936 b- defN 20-Nov-17 16:47 c7n/resources/rdscluster.py
+-rw-rw-r--  2.0 unx    58988 b- defN 20-Dec-14 15:57 c7n/resources/rds.py
+-rw-rw-r--  2.0 unx    18221 b- defN 20-Dec-14 15:57 c7n/resources/rdscluster.py
 -rw-rw-r--  2.0 unx    11024 b- defN 20-Nov-17 16:47 c7n/resources/rdsparamgroup.py
 -rw-rw-r--  2.0 unx    32970 b- defN 20-Nov-17 16:47 c7n/resources/redshift.py
 -rw-rw-r--  2.0 unx    11204 b- defN 20-Nov-17 16:47 c7n/resources/resource_map.py
 -rw-rw-r--  2.0 unx    17438 b- defN 20-Nov-17 16:47 c7n/resources/route53.py
--rw-rw-r--  2.0 unx   119664 b- defN 20-Nov-17 16:47 c7n/resources/s3.py
+-rw-rw-r--  2.0 unx   120606 b- defN 20-Dec-14 15:57 c7n/resources/s3.py
 -rw-rw-r--  2.0 unx    23195 b- defN 20-Nov-17 16:47 c7n/resources/sagemaker.py
 -rw-rw-r--  2.0 unx     2779 b- defN 20-Nov-17 16:47 c7n/resources/sar.py
 -rw-rw-r--  2.0 unx     3390 b- defN 20-Nov-17 16:47 c7n/resources/secretsmanager.py
 -rw-rw-r--  2.0 unx    22785 b- defN 20-Nov-17 16:47 c7n/resources/securityhub.py
 -rw-rw-r--  2.0 unx     5773 b- defN 20-Nov-17 16:47 c7n/resources/servicecatalog.py
 -rw-rw-r--  2.0 unx     5654 b- defN 20-Nov-17 16:47 c7n/resources/sfn.py
 -rw-rw-r--  2.0 unx     5264 b- defN 20-Nov-17 16:47 c7n/resources/shield.py
 -rw-rw-r--  2.0 unx     1473 b- defN 20-Nov-17 16:47 c7n/resources/simpledb.py
 -rw-rw-r--  2.0 unx      969 b- defN 20-Nov-17 16:47 c7n/resources/snowball.py
 -rw-rw-r--  2.0 unx    15127 b- defN 20-Nov-17 16:47 c7n/resources/sns.py
--rw-rw-r--  2.0 unx    12146 b- defN 20-Nov-17 16:47 c7n/resources/sqs.py
+-rw-rw-r--  2.0 unx    12170 b- defN 20-Dec-14 15:57 c7n/resources/sqs.py
 -rw-rw-r--  2.0 unx    20984 b- defN 20-Nov-17 16:47 c7n/resources/ssm.py
 -rw-rw-r--  2.0 unx      577 b- defN 20-Nov-17 16:47 c7n/resources/storagegw.py
 -rw-rw-r--  2.0 unx      525 b- defN 20-Nov-17 16:47 c7n/resources/support.py
 -rw-rw-r--  2.0 unx    85658 b- defN 20-Nov-17 16:47 c7n/resources/vpc.py
 -rw-rw-r--  2.0 unx     1656 b- defN 20-Nov-17 16:47 c7n/resources/waf.py
 -rw-rw-r--  2.0 unx     3074 b- defN 20-Nov-17 16:47 c7n/resources/workspaces.py
 -rw-rw-r--  2.0 unx       81 b- defN 20-Nov-17 16:47 c7n/ufuncs/__init__.py
 -rw-rw-r--  2.0 unx     2773 b- defN 20-Nov-17 16:47 c7n/ufuncs/s3crypt.py
--rw-rw-r--  2.0 unx    11361 b- defN 20-Nov-17 16:54 c7n-0.9.8.dist-info/LICENSE.txt
--rw-rw-r--  2.0 unx    11375 b- defN 20-Nov-17 16:54 c7n-0.9.8.dist-info/METADATA
--rw-rw-r--  2.0 unx       92 b- defN 20-Nov-17 16:54 c7n-0.9.8.dist-info/WHEEL
--rw-rw-r--  2.0 unx       44 b- defN 20-Nov-17 16:54 c7n-0.9.8.dist-info/entry_points.txt
--rw-rw-r--  2.0 unx        4 b- defN 20-Nov-17 16:54 c7n-0.9.8.dist-info/top_level.txt
-?rw-rw-r--  2.0 unx    10977 b- defN 20-Nov-17 16:54 c7n-0.9.8.dist-info/RECORD
-141 files, 1837004 bytes uncompressed, 455609 bytes compressed:  75.2%
+-rw-rw-r--  2.0 unx    11361 b- defN 20-Dec-14 16:37 c7n-0.9.9.dist-info/LICENSE.txt
+-rw-rw-r--  2.0 unx    12343 b- defN 20-Dec-14 16:37 c7n-0.9.9.dist-info/METADATA
+-rw-rw-r--  2.0 unx       92 b- defN 20-Dec-14 16:37 c7n-0.9.9.dist-info/WHEEL
+-rw-rw-r--  2.0 unx       44 b- defN 20-Dec-14 16:37 c7n-0.9.9.dist-info/entry_points.txt
+-rw-rw-r--  2.0 unx        4 b- defN 20-Dec-14 16:37 c7n-0.9.9.dist-info/top_level.txt
+?rw-rw-r--  2.0 unx    10977 b- defN 20-Dec-14 16:37 c7n-0.9.9.dist-info/RECORD
+141 files, 1853133 bytes uncompressed, 459058 bytes compressed:  75.2%
```

## zipnote {}

```diff
@@ -399,26 +399,26 @@
 
 Filename: c7n/ufuncs/__init__.py
 Comment: 
 
 Filename: c7n/ufuncs/s3crypt.py
 Comment: 
 
-Filename: c7n-0.9.8.dist-info/LICENSE.txt
+Filename: c7n-0.9.9.dist-info/LICENSE.txt
 Comment: 
 
-Filename: c7n-0.9.8.dist-info/METADATA
+Filename: c7n-0.9.9.dist-info/METADATA
 Comment: 
 
-Filename: c7n-0.9.8.dist-info/WHEEL
+Filename: c7n-0.9.9.dist-info/WHEEL
 Comment: 
 
-Filename: c7n-0.9.8.dist-info/entry_points.txt
+Filename: c7n-0.9.9.dist-info/entry_points.txt
 Comment: 
 
-Filename: c7n-0.9.8.dist-info/top_level.txt
+Filename: c7n-0.9.9.dist-info/top_level.txt
 Comment: 
 
-Filename: c7n-0.9.8.dist-info/RECORD
+Filename: c7n-0.9.9.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## c7n/query.py

```diff
@@ -324,16 +324,16 @@
             if _c:
                 _c = _c.pop()
         elif query:
             return query
         else:
             _c = None
 
-        s = "select configuration, supplementaryConfiguration where resourceType = '{}'".format(
-            self.manager.resource_type.config_type)
+        s = ("select resourceId, configuration, supplementaryConfiguration "
+             "where resourceType = '{}'").format(self.manager.resource_type.config_type)
 
         if _c:
             s += "AND {}".format(_c)
 
         return {'expr': s}
 
     def load_resource(self, item):
@@ -740,17 +740,18 @@
     def _make_request(self, current_kwargs):
         return self.retry(self._method, **current_kwargs)
 
 
 class TypeMeta(type):
 
     def __repr__(cls):
-        identifier = None
         if cls.config_type:
             identifier = cls.config_type
+        elif cls.cfn_type:
+            identifier = cls.cfn_type
         elif cls.arn_type:
             identifier = "AWS::%s::%s" % (cls.service.title(), cls.arn_type.title())
         elif cls.enum_spec:
             identifier = "AWS::%s::%s" % (cls.service.title(), cls.enum_spec[1])
         else:
             identifier = "AWS::%s::%s" % (cls.service.title(), cls.id)
         return "<TypeInfo %s>" % identifier
```

## c7n/utils.py

```diff
@@ -1,26 +1,27 @@
 # Copyright The Cloud Custodian Authors.
 # SPDX-License-Identifier: Apache-2.0
 import copy
 from datetime import datetime, timedelta
+from dateutil.tz import tzutc
 import json
 import itertools
 import ipaddress
 import logging
 import os
 import random
 import re
 import sys
 import threading
 import time
 from urllib import parse as urlparse
 from urllib.request import getproxies
 
 
-from dateutil.parser import ParserError, parse as parse_date
+from dateutil.parser import ParserError, parse
 
 from c7n import config
 from c7n.exceptions import ClientError, PolicyValidationError
 
 # Try to play nice in a serverless environment, where we don't require yaml
 
 try:
@@ -102,14 +103,64 @@
 def filter_empty(d):
     for k, v in list(d.items()):
         if not v:
             del d[k]
     return d
 
 
+# We need a minimum floor when examining possible timestamp
+# values to distinguish from other numeric time usages. Use
+# the S3 Launch Date.
+DATE_FLOOR = time.mktime((2006, 3, 19, 0, 0, 0, 0, 0, 0))
+
+
+def parse_date(v, tz=None):
+    """Handle various permutations of a datetime serialization
+    to a datetime with the given timezone.
+
+    Handles strings, seconds since epoch, and milliseconds since epoch.
+    """
+
+    if v is None:
+        return v
+
+    tz = tz or tzutc()
+
+    if isinstance(v, datetime):
+        if v.tzinfo is None:
+            return v.astimezone(tz)
+        return v
+
+    if isinstance(v, str) and not v.isdigit():
+        try:
+            return parse(v).astimezone(tz)
+        except (AttributeError, TypeError, ValueError, OverflowError):
+            pass
+
+    # OSError on windows -- https://bugs.python.org/issue36439
+    exceptions = (ValueError, OSError) if os.name == "nt" else (ValueError)
+
+    if isinstance(v, (int, float, str)):
+        try:
+            if float(v) > DATE_FLOOR:
+                v = datetime.fromtimestamp(float(v)).astimezone(tz)
+        except exceptions:
+            pass
+
+    if isinstance(v, (int, float, str)):
+        # try interpreting as milliseconds epoch
+        try:
+            if float(v) > DATE_FLOOR:
+                v = datetime.fromtimestamp(float(v) / 1000).astimezone(tz)
+        except exceptions:
+            pass
+
+    return isinstance(v, datetime) and v or None
+
+
 def type_schema(
         type_name, inherits=None, rinherit=None,
         aliases=None, required=None, **props):
     """jsonschema generation helper
 
     params:
      - type_name: name of the type
@@ -211,20 +262,20 @@
             # config service handles datetime differently then describe sdks
             # the sdks use knowledge of the shape to support language native
             # date times, while config just turns everything into a serialized
             # json with mangled keys without type info. to normalize to describe
             # we implicitly sniff keys which look like datetimes, and have an
             # isoformat marker ('T').
             kn = k.lower()
-            if isinstance(v, str) and ('time' in kn or 'date' in kn) and "T" in v:
+            if isinstance(v, (str, int)) and ('time' in kn or 'date' in kn):
                 try:
                     dv = parse_date(v)
                 except ParserError:
-                    pass
-                else:
+                    dv = None
+                if dv:
                     obj["%s%s" % (k[0].upper(), k[1:])] = dv
         if isinstance(v, dict):
             camelResource(v)
         elif isinstance(v, list):
             list(map(camelResource, v))
     return obj
```

## c7n/version.py

```diff
@@ -1,4 +1,2 @@
-# Copyright The Cloud Custodian Authors.
-# SPDX-License-Identifier: Apache-2.0
 # Generated via tools/dev/poetrypkg.py
-version = "0.9.8"
+version = "0.9.9"
```

## c7n/actions/autotag.py

```diff
@@ -76,17 +76,15 @@
             raise PolicyValidationError(
                 "Resource does not support tagging %s" % (self.manager.data,))
         if 'tag' not in self.data:
             raise PolicyValidationError(
                 "auto-tag action requires 'tag'")
         return self
 
-    def process(self, resources, event):
-        if event is None:
-            return
+    def get_tag_value(self, event):
         event = event['detail']
         utype = event['userIdentity']['type']
         if utype not in self.data.get('user-type', ['AssumedRole', 'IAMUser', 'FederatedUser']):
             return
 
         user = None
         if utype == "IAMUser":
@@ -98,17 +96,24 @@
             principal_id_value = event['userIdentity'].get('principalId', '').split(':')[0]
             # instance role
             if user.startswith('i-'):
                 return
             # lambda function (old style)
             elif user.startswith('awslambda'):
                 return
-        if user is None:
-            return
+
         # if the auto-tag-user policy set update to False (or it's unset) then we
+        return {'user': user, 'id': principal_id_value}
+
+    def process(self, resources, event):
+        if event is None:
+            return
+
+        user_info = self.get_tag_value(event)
+
         # will skip writing their UserName tag and not overwrite pre-existing values
         if not self.data.get('update', False):
             untagged_resources = []
             # iterating over all the resources the user spun up in this event
             for resource in resources:
                 tag_already_set = False
                 for tag in resource.get('Tags', ()):
@@ -118,26 +123,32 @@
                 if not tag_already_set:
                     untagged_resources.append(resource)
         # if update is set to True, we will overwrite the userName tag even if
         # the user already set a value
         else:
             untagged_resources = resources
 
-        tag_action = self.manager.action_registry.get('tag')
-        new_tags = {
-            self.data['tag']: user
-        }
+        new_tags = {}
+        if user_info['user']:
+            new_tags[self.data['tag']] = user_info['user']
+
         # if principal_id_key is set (and value), we'll set the principalId tag.
         principal_id_key = self.data.get('principal_id_tag', None)
-        if principal_id_key and principal_id_value:
-            new_tags[principal_id_key] = principal_id_value
-        for key, value in new_tags.items():
-            tag_action({'key': key, 'value': value}, self.manager).process(untagged_resources)
+        if principal_id_key and user_info['id']:
+            new_tags[principal_id_key] = user_info['id']
+
+        if new_tags:
+            self.set_resource_tags(new_tags, untagged_resources)
         return new_tags
 
+    def set_resource_tags(self, tags, resources):
+        tag_action = self.manager.action_registry.get('tag')
+        for key, value in tags.items():
+            tag_action({'key': key, 'value': value}, self.manager).process(resources)
+
     @classmethod
     def register_resource(cls, registry, resource_class):
         if 'auto-tag-user' in resource_class.action_registry:
             return
         if resource_class.action_registry.get('tag'):
             resource_class.action_registry.register('auto-tag-user', AutoTagUser)
```

## c7n/actions/webhook.py

```diff
@@ -75,15 +75,16 @@
 
     def process(self, resources, event=None):
         self.lookup_data = {
             'account_id': self.manager.config.account_id,
             'region': self.manager.config.region,
             'execution_id': self.manager.ctx.execution_id,
             'execution_start': self.manager.ctx.start_time,
-            'policy': self.manager.data
+            'policy': self.manager.data,
+            'event': event
         }
 
         self.http = self._build_http_manager()
 
         if self.batch:
             for chunk in utils.chunks(resources, self.batch_size):
                 resource_data = self.lookup_data
```

## c7n/filters/core.py

```diff
@@ -7,27 +7,26 @@
 import datetime
 from datetime import timedelta
 import fnmatch
 import ipaddress
 import logging
 import operator
 import re
-import os
 
 from dateutil.tz import tzutc
 from dateutil.parser import parse
 from distutils import version
 from random import sample
 import jmespath
 
 from c7n.element import Element
 from c7n.exceptions import PolicyValidationError
 from c7n.registry import PluginRegistry
 from c7n.resolver import ValuesFrom
-from c7n.utils import set_annotation, type_schema, parse_cidr
+from c7n.utils import set_annotation, type_schema, parse_cidr, parse_date
 from c7n.manager import iter_filters
 
 
 class FilterValidationError(Exception):
     pass
 
 
@@ -721,50 +720,14 @@
         if event is None:
             return resources
         if self(event):
             return resources
         return []
 
 
-def parse_date(v, tz=None):
-    if v is None:
-        return v
-
-    tz = tz or tzutc()
-
-    if isinstance(v, datetime.datetime):
-        if v.tzinfo is None:
-            return v.astimezone(tz)
-        return v
-
-    if isinstance(v, str):
-        try:
-            return parse(v).astimezone(tz)
-        except (AttributeError, TypeError, ValueError, OverflowError):
-            pass
-
-    # OSError on windows -- https://bugs.python.org/issue36439
-    exceptions = (ValueError, OSError) if os.name == "nt" else (ValueError)
-
-    if isinstance(v, (int, float, str)):
-        try:
-            v = datetime.datetime.fromtimestamp(float(v)).astimezone(tz)
-        except exceptions:
-            pass
-
-    if isinstance(v, (int, float, str)):
-        try:
-            # try interpreting as milliseconds epoch
-            v = datetime.datetime.fromtimestamp(float(v) / 1000).astimezone(tz)
-        except exceptions:
-            pass
-
-    return isinstance(v, datetime.datetime) and v or None
-
-
 class ValueRegex:
     """Allows filtering based on the output of a regex capture.
     This is useful for parsing data that has a weird format.
 
     Instead of comparing the contents of the 'resource value' with the 'value',
     it will instead apply the regex to contents of the 'resource value', and compare
     the result of the capture group defined in that regex with the 'value'.
```

## c7n/filters/metrics.py

```diff
@@ -124,16 +124,19 @@
 
     def process(self, resources, event=None):
         days = self.data.get('days', 14)
         duration = timedelta(days)
 
         self.metric = self.data['name']
         self.end = datetime.utcnow()
-        self.start = self.end - duration
-        self.period = int(self.data.get('period', duration.total_seconds()))
+
+        # Adjust the start time to gracefully handle CloudWatch's retention schedule, which rolls up
+        # data points progressively (1 minute --> 5 minutes --> 1 hour) over time.
+        self.start = (self.end - duration).replace(minute=0)
+        self.period = int(self.data.get('period', (self.end - self.start).total_seconds()))
         self.statistics = self.data.get('statistics', 'Average')
         self.model = self.manager.get_model()
         self.op = OPERATORS[self.data.get('op', 'less-than')]
         self.value = self.data['value']
 
         ns = self.data.get('namespace')
         if not ns:
```

## c7n/resources/account.py

```diff
@@ -91,14 +91,57 @@
         for r in resources:
             if self.match(r, info):
                 r['c7n:credential-report'] = info
                 results.append(r)
         return results
 
 
+@filters.register('check-macie')
+class MacieEnabled(ValueFilter):
+    """Check status of macie v2 in the account.
+
+    Gets the macie session info for the account, and
+    the macie master account for the current account if
+    configured.
+    """
+
+    schema = type_schema('check-macie', rinherit=ValueFilter.schema)
+    schema_alias = False
+    annotation_key = 'c7n:macie'
+    annotate = False
+    permissions = ('macie2:GetMacieSession', 'macie2:GetMasterAccount',)
+
+    def process(self, resources, event=None):
+
+        if self.annotation_key not in resources[0]:
+            self.get_macie_info(resources[0])
+
+        if super().process([resources[0][self.annotation_key]]):
+            return resources
+
+    def get_macie_info(self, account):
+        client = local_session(
+            self.manager.session_factory).client('macie2')
+
+        try:
+            info = client.get_macie_session()
+            info.pop('ResponseMetadata')
+        except client.exceptions.AccessDeniedException:
+            info = {}
+
+        try:
+            minfo = client.get_master_account().get('master')
+        except (client.exceptions.AccessDeniedException,
+                client.exceptions.ResourceNotFoundException):
+            info['master'] = {}
+        else:
+            info['master'] = minfo
+        account[self.annotation_key] = info
+
+
 @filters.register('check-cloudtrail')
 class CloudTrailEnabled(Filter):
     """Verify cloud trail enabled for this account per specifications.
 
     Returns an annotated account resource if trail is not enabled.
 
     Of particular note, the current-region option will evaluate whether cloudtrail is available
```

## c7n/resources/appelb.py

```diff
@@ -480,14 +480,81 @@
             pass
         except client.exceptions.OperationNotPermittedException as e:
             self.log.warning(
                 "Exception trying to delete ALB: %s error: %s",
                 alb['LoadBalancerArn'], e)
 
 
+@AppELB.action_registry.register('modify-attributes')
+class AppELBModifyAttributes(BaseAction):
+    """Modify load balancer attributes.
+
+    :example:
+
+    .. code-block:: yaml
+
+            policies:
+              - name: turn-on-elb-deletion-protection
+                resource: app-elb
+                filters:
+                  - type: attributes
+                    key: "deletion_protection.enabled"
+                    value: false
+                actions:
+                  - type: modify-attributes
+                    attributes:
+                      "deletion_protection.enabled": "true"
+                      "idle_timeout.timeout_seconds": 120
+    """
+    schema = {
+        'type': 'object',
+        'additionalProperties': False,
+        'properties': {
+            'type': {
+                'enum': ['modify-attributes']},
+            'attributes': {
+                'type': 'object',
+                'additionalProperties': False,
+                'properties': {
+                    'access_logs.s3.enabled': {
+                        'enum': ['true', 'false', True, False]},
+                    'access_logs.s3.bucket': {'type': 'string'},
+                    'access_logs.s3.prefix': {'type': 'string'},
+                    'deletion_protection.enabled': {
+                        'enum': ['true', 'false', True, False]},
+                    'idle_timeout.timeout_seconds': {'type': 'number'},
+                    'routing.http.desync_mitigation_mode': {
+                        'enum': ['monitor', 'defensive', 'strictest']},
+                    'routing.http.drop_invalid_header_fields.enabled': {
+                        'enum': ['true', 'false', True, False]},
+                    'routing.http2.enabled': {
+                        'enum': ['true', 'false', True, False]},
+                    'load_balancing.cross_zone.enabled': {
+                        'enum': ['true', 'false', True, False]},
+                },
+            },
+        },
+    }
+    permissions = ("elasticloadbalancing:ModifyLoadBalancerAttributes",)
+
+    def process(self, resources):
+        client = local_session(self.manager.session_factory).client('elbv2')
+        for appelb in resources:
+            self.manager.retry(
+                client.modify_load_balancer_attributes,
+                LoadBalancerArn=appelb['LoadBalancerArn'],
+                Attributes=[
+                    {'Key': key, 'Value': serialize_attribute_value(value)}
+                    for (key, value) in self.data['attributes'].items()
+                ],
+                ignore_err_codes=('LoadBalancerNotFoundException',),
+            )
+        return resources
+
+
 class AppELBListenerFilterBase:
     """ Mixin base class for filters that query LB listeners.
     """
     permissions = ("elasticloadbalancing:DescribeListeners",)
 
     def initialize(self, albs):
         client = local_session(self.manager.session_factory).client('elbv2')
@@ -507,14 +574,24 @@
     elif v == 'true':
         v = True
     elif v == 'false':
         v = False
     return v
 
 
+def serialize_attribute_value(v):
+    if v is True:
+        return 'true'
+    elif v is False:
+        return 'false'
+    elif isinstance(v, int):
+        return str(v)
+    return v
+
+
 class AppELBAttributeFilterBase:
     """ Mixin base class for filters that query LB attributes.
     """
 
     def initialize(self, albs):
         client = local_session(self.manager.session_factory).client('elbv2')
```

## c7n/resources/asg.py

```diff
@@ -6,15 +6,15 @@
 from concurrent.futures import as_completed
 
 from dateutil.parser import parse
 
 import itertools
 import time
 
-from c7n.actions import Action
+from c7n.actions import Action, AutoTagUser
 from c7n.exceptions import PolicyValidationError
 from c7n.filters import ValueFilter, AgeFilter, Filter
 from c7n.filters.offhours import OffHour, OnHour
 import c7n.filters.vpc as net_filters
 
 from c7n.manager import resources
 from c7n import query
@@ -738,14 +738,30 @@
         details['CreatedTime'] = details['CreatedTime'].isoformat()
         # let's arbitrarily cut off key information per security hub's restrictions...
         details['LaunchConfigurationName'] = lid[:32]
         payload.update(details)
         return envelope
 
 
+@ASG.action_registry.register('auto-tag-user')
+class AutoScaleAutoTagUser(AutoTagUser):
+
+    schema = type_schema(
+        'auto-tag-user',
+        propagate={'type': 'boolean'},
+        rinherit=AutoTagUser.schema)
+    schema_alias = False
+
+    def set_resource_tags(self, tags, resources):
+        tag_action = self.manager.action_registry.get('tag')
+        tag_action(
+            {'tags': tags, 'propagate': self.data.get('propagate', False)},
+            self.manager).process(resources)
+
+
 @ASG.action_registry.register('tag-trim')
 class GroupTagTrim(TagTrim):
     """Action to trim the number of tags to avoid hitting tag limits
 
     :example:
 
     .. code-block:: yaml
@@ -1127,15 +1143,15 @@
         return tags
 
     def process(self, asgs):
         tags = self.get_tag_set()
         error = None
 
         client = self.get_client()
-        with self.executor_factory(max_workers=3) as w:
+        with self.executor_factory(max_workers=2) as w:
             futures = {}
             for asg_set in chunks(asgs, self.batch_size):
                 futures[w.submit(
                     self.process_resource_set, client, asg_set, tags)] = asg_set
             for f in as_completed(futures):
                 asg_set = futures[f]
                 if f.exception():
@@ -1156,43 +1172,47 @@
                 t['PropagateAtLaunch'] = propagate
         for t in tags:
             for a in asgs:
                 atags = dict(t)
                 atags['ResourceType'] = 'auto-scaling-group'
                 atags['ResourceId'] = a['AutoScalingGroupName']
                 tag_params.append(atags)
+                a.setdefault('Tags', []).append(atags)
         self.manager.retry(client.create_or_update_tags, Tags=tag_params)
 
     def get_client(self):
         return local_session(self.manager.session_factory).client('autoscaling')
 
 
 @ASG.action_registry.register('propagate-tags')
 class PropagateTags(Action):
     """Propagate tags to an asg instances.
 
-    In AWS changing an asg tag does not propagate to instances.
-
-    This action exists to do that, and can also trim older tags
-    not present on the asg anymore that are present on instances.
-
+    In AWS changing an asg tag does not automatically propagate to
+    extant instances even if the tag is set to propagate. It only
+    is applied to new instances.
+
+    This action exists to ensure that extant instances also have these
+    propagated tags set, and can also trim older tags not present on
+    the asg anymore that are present on instances.
 
     :example:
 
     .. code-block:: yaml
 
             policies:
               - name: asg-propagate-required
                 resource: asg
                 filters:
                   - "tag:OwnerName": present
                 actions:
                   - type: propagate-tags
                     tags:
                       - OwnerName
+
     """
 
     schema = type_schema(
         'propagate-tags',
         tags={'type': 'array', 'items': {'type': 'string'}},
         trim={'type': 'boolean'})
     permissions = ('ec2:DeleteTags', 'ec2:CreateTags')
@@ -1208,29 +1228,36 @@
         if self.data.get('trim', False):
             self.instance_map = self.get_instance_map(asgs)
         with self.executor_factory(max_workers=3) as w:
             instance_count = sum(list(w.map(self.process_asg, asgs)))
             self.log.info("Applied tags to %d instances" % instance_count)
 
     def process_asg(self, asg):
-        client = local_session(self.manager.session_factory).client('ec2')
         instance_ids = [i['InstanceId'] for i in asg['Instances']]
         tag_map = {t['Key']: t['Value'] for t in asg.get('Tags', [])
                    if t['PropagateAtLaunch'] and not t['Key'].startswith('aws:')}
 
         if self.data.get('tags'):
             tag_map = {
                 k: v for k, v in tag_map.items()
                 if k in self.data['tags']}
 
+        if not tag_map and not self.get('trim', False):
+            self.log.error(
+                'No tags found to propagate on asg:{} tags configured:{}'.format(
+                    asg['AutoScalingGroupName'], self.data.get('tags')))
+
         tag_set = set(tag_map)
+        client = local_session(self.manager.session_factory).client('ec2')
+
         if self.data.get('trim', False):
             instances = [self.instance_map[i] for i in instance_ids]
             self.prune_instance_tags(client, asg, tag_set, instances)
-        if not self.manager.config.dryrun and instances:
+
+        if not self.manager.config.dryrun and instance_ids and tag_map:
             client.create_tags(
                 Resources=instance_ids,
                 Tags=[{'Key': k, 'Value': v} for k, v in tag_map.items()])
         return len(instance_ids)
 
     def prune_instance_tags(self, client, asg, tag_set, instances):
         """Remove tags present on all asg instances which are not present
```

## c7n/resources/cw.py

```diff
@@ -18,15 +18,16 @@
 @resources.register('alarm')
 class Alarm(QueryResourceManager):
 
     class resource_type(TypeInfo):
         service = 'cloudwatch'
         arn_type = 'alarm'
         enum_spec = ('describe_alarms', 'MetricAlarms', None)
-        id = 'AlarmArn'
+        id = 'AlarmName'
+        arn = 'AlarmArn'
         filter_name = 'AlarmNames'
         filter_type = 'list'
         name = 'AlarmName'
         date = 'AlarmConfigurationUpdatedTimestamp'
         cfn_type = config_type = 'AWS::CloudWatch::Alarm'
 
     retry = staticmethod(get_retry(('Throttled',)))
@@ -141,23 +142,25 @@
 @resources.register('log-group')
 class LogGroup(QueryResourceManager):
 
     class resource_type(TypeInfo):
         service = 'logs'
         arn_type = 'log-group'
         enum_spec = ('describe_log_groups', 'logGroups', None)
-        name = 'logGroupName'
-        id = 'arn'
+        id = name = 'logGroupName'
+        arn = 'arn'  # see get-arns override re attribute usage
         filter_name = 'logGroupNamePrefix'
         filter_type = 'scalar'
         dimension = 'LogGroupName'
         date = 'creationTime'
         universal_taggable = True
         cfn_type = 'AWS::Logs::LogGroup'
 
+    augment = universal_augment
+
     def get_arns(self, resources):
         # log group arn in resource describe has ':*' suffix, not all
         # apis can use that form, so normalize to standard arn.
         return [r['arn'][:-2] for r in resources]
 
 
 @resources.register('insight-rule')
```

## c7n/resources/ebs.py

```diff
@@ -509,14 +509,103 @@
             waiter.config.delay = 60
             waiter.config.max_attempts = 60
             waiter.wait(SnapshotIds=copy_ids)
             self.log.debug(
                 "Cross region copy complete %s", ",".join(copy_ids))
 
 
+@Snapshot.action_registry.register('set-permissions')
+class SetPermissions(BaseAction):
+    """Action to set permissions for creating volumes from a snapshot
+
+    Use the 'add' and 'remove' parameters to control which accounts to
+    add or remove respectively.  The default is to remove any create
+    volume permissions granted to other AWS accounts.
+
+    Combining this action with the 'cross-account' filter allows you
+    greater control over which accounts will be removed, e.g. using a
+    whitelist:
+
+    :example:
+
+    .. code-block:: yaml
+
+            policies:
+              - name: ebs-dont-share-cross-account
+                resource: ebs-snapshot
+                filters:
+                  - type: cross-account
+                    whitelist:
+                    - '112233445566'
+                actions:
+                  - type: set-permissions
+                    remove: matched
+    """
+    schema = type_schema(
+        'set-permissions',
+        remove={
+            'oneOf': [
+                {'enum': ['matched']},
+                {'type': 'array', 'items': {
+                    'type': 'string', 'minLength': 12, 'maxLength': 12}},
+            ]},
+        add={
+            'type': 'array', 'items': {
+                'type': 'string', 'minLength': 12, 'maxLength': 12}},
+    )
+
+    permissions = ('ec2:ModifySnapshotAttribute',)
+
+    def validate(self):
+        if self.data.get('remove') == 'matched':
+            found = False
+            for f in self.manager.iter_filters():
+                if isinstance(f, SnapshotCrossAccountAccess):
+                    found = True
+                    break
+            if not found:
+                raise PolicyValidationError(
+                    "policy:%s filter:%s with matched requires cross-account filter" % (
+                        self.manager.ctx.policy.name, self.type))
+
+    def process(self, snapshots):
+        client = local_session(self.manager.session_factory).client('ec2')
+        for i in snapshots:
+            self.process_image(client, i)
+
+    def process_image(self, client, snapshot):
+        add_accounts = self.data.get('add', [])
+        remove_accounts = self.data.get('remove', [])
+        if not add_accounts and not remove_accounts:
+            return client.reset_snapshot_attribute(
+                SnapshotId=snapshot['SnapshotId'], Attribute="createVolumePermission")
+        if remove_accounts == 'matched':
+            remove_accounts = snapshot.get(
+                'c7n:' + SnapshotCrossAccountAccess.annotation_key)
+
+        remove = []
+        remove.extend([{'UserId': a} for a in remove_accounts if a != 'all'])
+        if 'all' in remove_accounts:
+            remove.append({'Group': 'all'})
+            remove_accounts.remove('all')
+
+        add = [{'UserId': a} for a in add_accounts]
+
+        if remove:
+            client.modify_snapshot_attribute(
+                SnapshotId=snapshot['SnapshotId'],
+                CreateVolumePermission={'Remove': remove},
+                OperationType='remove')
+        if add:
+            client.modify_snapshot_attribute(
+                SnapshotId=snapshot['SnapshotId'],
+                CreateVolumePermission={'Add': add},
+                OperationType='add')
+
+
 @resources.register('ebs')
 class EBS(QueryResourceManager):
 
     class resource_type(TypeInfo):
         service = 'ec2'
         arn_type = 'volume'
         enum_spec = ('describe_volumes', 'Volumes', None)
```

## c7n/resources/ec2.py

```diff
@@ -185,15 +185,15 @@
         profile_arns = list(profile_arn_map.items())
         profile_role_map = {
             arn: profile['Roles'][0]['Arn']
             for arn, profile in zip(
                 [p[0] for p in profile_arns],
                 self.manager.get_resource_manager(
                     'iam-profile').get_resources(
-                        [p[1] for p in profile_arns]))}
+                        [p[0].split('/', 1)[-1] for p in profile_arns]))}
         return [
             profile_role_map.get(r.get('IamInstanceProfile', {}).get('Arn'))
             for r in resources]
 
 
 @filters.register('state-age')
 class StateTransitionAge(AgeFilter):
```

## c7n/resources/ecr.py

```diff
@@ -28,16 +28,16 @@
 
 @resources.register('ecr')
 class ECR(QueryResourceManager):
 
     class resource_type(TypeInfo):
         service = 'ecr'
         enum_spec = ('describe_repositories', 'repositories', None)
-        name = "repositoryName"
-        arn = id = "repositoryArn"
+        id = name = "repositoryName"
+        arn = "repositoryArn"
         arn_type = 'repository'
         filter_name = 'repositoryNames'
         filter_type = 'list'
         cfn_type = 'AWS::ECR::Repository'
 
     source_mapping = {
         'describe': DescribeECR,
```

## c7n/resources/elasticsearch.py

```diff
@@ -1,13 +1,15 @@
 # Copyright The Cloud Custodian Authors.
 # SPDX-License-Identifier: Apache-2.0
 import jmespath
+import json
 
-from c7n.actions import Action, ModifyVpcSecurityGroupsAction
-from c7n.filters import MetricsFilter
+from c7n.actions import Action, ModifyVpcSecurityGroupsAction, RemovePolicyBase
+from c7n.filters import MetricsFilter, CrossAccountAccessFilter
+from c7n.exceptions import PolicyValidationError
 from c7n.filters.vpc import SecurityGroupFilter, SubnetFilter, VpcFilter
 from c7n.manager import resources
 from c7n.query import ConfigSource, DescribeSource, QueryResourceManager, TypeInfo
 from c7n.utils import chunks, local_session, type_schema
 from c7n.tags import Tag, RemoveTag, TagActionFilter, TagDelayedAction
 from c7n.filters.kms import KmsRelatedFilter
 
@@ -110,14 +112,102 @@
                 key: c7n:AliasName
                 value: "^(alias/aws/es)"
                 op: regex
     """
     RelatedIdsExpression = 'EncryptionAtRestOptions.KmsKeyId'
 
 
+@ElasticSearchDomain.filter_registry.register('cross-account')
+class ElasticSearchCrossAccountAccessFilter(CrossAccountAccessFilter):
+    """
+    Filter to return all elasticsearch domains with cross account access permissions
+
+    :example:
+
+    .. code-block:: yaml
+
+        policies:
+          - name: check-elasticsearch-cross-account
+            resource: aws.elasticsearch
+            filters:
+              - type: cross-account
+    """
+    policy_attribute = 'c7n:Policy'
+    permissions = ('es:DescribeElasticsearchDomainConfig',)
+
+    def process(self, resources, event=None):
+        client = local_session(self.manager.session_factory).client('es')
+        for r in resources:
+            if self.policy_attribute not in r:
+                result = self.manager.retry(
+                    client.describe_elasticsearch_domain_config,
+                    DomainName=r['DomainName'],
+                    ignore_err_codes=('ResourceNotFoundException',))
+                if result:
+                    r[self.policy_attribute] = json.loads(
+                        result.get('DomainConfig').get('AccessPolicies').get('Options')
+                    )
+        return super().process(resources)
+
+
+@ElasticSearchDomain.action_registry.register('remove-statements')
+class RemovePolicyStatement(RemovePolicyBase):
+    """
+    Action to remove policy statements from elasticsearch
+
+    :example:
+
+    .. code-block:: yaml
+
+        policies:
+          - name: elasticsearch-cross-account
+            resource: aws.elasticsearch
+            filters:
+              - type: cross-account
+            actions:
+              - type: remove-statements
+                statement_ids: matched
+    """
+
+    permissions = ('es:DescribeElasticsearchDomainConfig', 'es:UpdateElasticsearchDomainConfig',)
+
+    def validate(self):
+        for f in self.manager.iter_filters():
+            if isinstance(f, ElasticSearchCrossAccountAccessFilter):
+                return self
+        raise PolicyValidationError(
+            '`remove-statements` may only be used in '
+            'conjunction with `cross-account` filter on %s' % (self.manager.data,))
+
+    def process(self, resources):
+        client = local_session(self.manager.session_factory).client('es')
+        for r in resources:
+            try:
+                self.process_resource(client, r)
+            except Exception:
+                self.log.exception("Error processing es:%s", r['ARN'])
+
+    def process_resource(self, client, resource):
+        p = resource.get('c7n:Policy')
+
+        if p is None:
+            return
+
+        statements, found = self.process_policy(
+            p, resource, CrossAccountAccessFilter.annotation_key)
+
+        if found:
+            client.update_elasticsearch_domain_config(
+                DomainName=resource['DomainName'],
+                AccessPolicies=json.dumps(p)
+            )
+
+        return
+
+
 @ElasticSearchDomain.action_registry.register('post-finding')
 class ElasticSearchPostFinding(PostFinding):
 
     resource_type = 'AwsElasticsearchDomain'
 
     def format_resource(self, r):
         envelope, payload = self.format_envelope(r)
```

## c7n/resources/iam.py

```diff
@@ -412,16 +412,15 @@
 @resources.register('iam-profile')
 class InstanceProfile(QueryResourceManager):
 
     class resource_type(TypeInfo):
         service = 'iam'
         arn_type = 'instance-profile'
         enum_spec = ('list_instance_profiles', 'InstanceProfiles', None)
-        id = 'InstanceProfileId'
-        name = 'InstanceProfileId'
+        name = id = 'InstanceProfileName'
         date = 'CreateDate'
         # Denotes this resource type exists across regions
         global_resource = True
         arn = 'Arn'
 
 
 @resources.register('iam-certificate')
@@ -429,21 +428,59 @@
 
     class resource_type(TypeInfo):
         service = 'iam'
         arn_type = 'server-certificate'
         enum_spec = ('list_server_certificates',
                      'ServerCertificateMetadataList',
                      None)
-        id = 'ServerCertificateId'
+        name = id = 'ServerCertificateName'
         name = 'ServerCertificateName'
         date = 'Expiration'
         # Denotes this resource type exists across regions
         global_resource = True
 
 
+@ServerCertificate.action_registry.register('delete')
+class CertificateDelete(BaseAction):
+    """Delete an IAM Certificate
+
+    For example, if you want to automatically delete an unused IAM certificate.
+
+    :example:
+
+      .. code-block:: yaml
+
+        - name: aws-iam-certificate-delete-expired
+          resource: iam-certificate
+          filters:
+            - type: value
+              key: Expiration
+              value_type: expiration
+              op: greater-than
+              value: 0
+          actions:
+            - type: delete
+
+    """
+    schema = type_schema('delete')
+    permissions = ('iam:DeleteServerCertificate',)
+
+    def process(self, resources):
+        client = local_session(self.manager.session_factory).client('iam')
+        for cert in resources:
+            self.manager.retry(
+                client.delete_server_certificate,
+                ServerCertificateName=cert['ServerCertificateName'],
+                ignore_err_codes=(
+                    'NoSuchEntityException',
+                    'DeleteConflictException',
+                ),
+            )
+
+
 @User.filter_registry.register('usage')
 @Role.filter_registry.register('usage')
 @Group.filter_registry.register('usage')
 @Policy.filter_registry.register('usage')
 class ServiceUsage(Filter):
     """Filter iam resources by their api/service usage.
 
@@ -1097,16 +1134,17 @@
         for r in resources:
             if self.data.get('force', False):
                 self.detach_inline_policies(client, r)
             try:
                 client.delete_role(RoleName=r['RoleName'])
             except client.exceptions.DeleteConflictException as e:
                 self.log.warning(
-                    "Role:%s cannot be deleted, set force to detach policy and delete"
-                    % r['Arn'])
+                    ("Role:%s cannot be deleted, set force "
+                     "to detach policy and delete, error: %s") % (
+                         r['Arn'], str(e)))
                 error = e
             except (client.exceptions.NoSuchEntityException,
                     client.exceptions.UnmodifiableEntityException):
                 continue
         if error:
             raise error
```

## c7n/resources/kms.py

```diff
@@ -81,14 +81,15 @@
 @resources.register('kms-key')
 class Key(QueryResourceManager):
 
     class resource_type(TypeInfo):
         service = 'kms'
         arn_type = "key"
         enum_spec = ('list_keys', 'Keys', None)
+        detail_spec = ('describe_key', 'KeyId', 'Arn', 'KeyMetadata')  # overriden
         name = id = "KeyId"
         arn = 'Arn'
         universal_taggable = True
         cfn_type = config_type = 'AWS::KMS::Key'
 
     source_mapping = {
         'config': ConfigSource,
```

## c7n/resources/rds.py

```diff
@@ -66,16 +66,27 @@
 filters = FilterRegistry('rds.filters')
 actions = ActionRegistry('rds.actions')
 
 
 class DescribeRDS(DescribeSource):
 
     def augment(self, dbs):
-        return universal_augment(
-            self.manager, super(DescribeRDS, self).augment(dbs))
+        for d in dbs:
+            d['Tags'] = d.pop('TagList', ())
+        return dbs
+
+
+class ConfigRDS(ConfigSource):
+
+    def load_resource(self, item):
+        resource = super().load_resource(item)
+        for k in list(resource.keys()):
+            if k.startswith('Db'):
+                resource["DB%s" % k[2:]] = resource[k]
+        return resource
 
 
 @resources.register('rds')
 class RDS(QueryResourceManager):
     """Resource manager for RDS DB instances.
     """
 
@@ -107,15 +118,15 @@
         permissions_enum = ('rds:DescribeDBInstances',)
 
     filter_registry = filters
     action_registry = actions
 
     source_mapping = {
         'describe': DescribeRDS,
-        'config': ConfigSource
+        'config': ConfigRDS
     }
 
 
 def _db_instance_eligible_for_backup(resource):
     db_instance_id = resource['DBInstanceIdentifier']
 
     # Database instance is not in available state
@@ -949,16 +960,17 @@
                 ignore_err_codes=('SubscriptionNotFoundFault',
                 'InvalidEventSubscriptionStateFault'))
 
 
 class DescribeRDSSnapshot(DescribeSource):
 
     def augment(self, snaps):
-        return universal_augment(
-            self.manager, super(DescribeRDSSnapshot, self).augment(snaps))
+        for s in snaps:
+            s['Tags'] = s.pop('TagList', ())
+        return snaps
 
 
 @resources.register('rds-snapshot')
 class RDSSnapshot(QueryResourceManager):
     """Resource manager for RDS DB snapshots.
     """
```

## c7n/resources/rdscluster.py

```diff
@@ -1,34 +1,48 @@
 # Copyright The Cloud Custodian Authors.
 # SPDX-License-Identifier: Apache-2.0
 import logging
 
 from concurrent.futures import as_completed
-from datetime import datetime
-from dateutil.tz import tzutc
 
 from c7n.actions import BaseAction
 from c7n.filters import AgeFilter, CrossAccountAccessFilter
 from c7n.filters.offhours import OffHour, OnHour
 import c7n.filters.vpc as net_filters
 from c7n.manager import resources
 from c7n.query import ConfigSource, QueryResourceManager, TypeInfo, DescribeSource
-from c7n import tags
 from .aws import shape_validate
 from c7n.exceptions import PolicyValidationError
 from c7n.utils import (
     type_schema, local_session, snapshot_identifier, chunks)
 
 log = logging.getLogger('custodian.rds-cluster')
 
 
 class DescribeCluster(DescribeSource):
 
     def augment(self, resources):
-        return tags.universal_augment(self.manager, resources)
+        for r in resources:
+            r['Tags'] = r.pop('TagList', ())
+        return resources
+
+
+class ConfigCluster(ConfigSource):
+
+    def load_resource(self, item):
+        resource = super().load_resource(item)
+        resource.pop('TagList', None)  # we pull tags from supplementary config
+        for k in list(resource.keys()):
+            if k.startswith('Dbc'):
+                resource["DBC%s" % (k[3:])] = resource.pop(k)
+            elif k.startswith('Iamd'):
+                resource['IAMD%s' % (k[4:])] = resource.pop(k)
+            elif k.startswith('Dbs'):
+                resource["DBS%s" % (k[3:])] = resource.pop(k)
+        return resource
 
 
 @resources.register('rds-cluster')
 class RDSCluster(QueryResourceManager):
     """Resource manager for RDS clusters.
     """
 
@@ -42,15 +56,15 @@
         name = id = 'DBClusterIdentifier'
         dimension = 'DBClusterIdentifier'
         universal_taggable = True
         permissions_enum = ('rds:DescribeDBClusters',)
         cfn_type = config_type = 'AWS::RDS::DBCluster'
 
     source_mapping = {
-        'config': ConfigSource,
+        'config': ConfigCluster,
         'describe': DescribeCluster
     }
 
 
 RDSCluster.filter_registry.register('offhour', OffHour)
 RDSCluster.filter_registry.register('onhour', OnHour)
 
@@ -351,15 +365,17 @@
         return self.manager.retry(
             client.describe_db_cluster_snapshots,
             Filters=[{
                 'Name': 'db-cluster-snapshot-id',
                 'Values': resource_ids}]).get('DBClusterSnapshots', ())
 
     def augment(self, resources):
-        return tags.universal_augment(self.manager, resources)
+        for r in resources:
+            r['Tags'] = r.pop('TagList', ())
+        return resources
 
 
 class ConfigClusterSnapshot(ConfigSource):
 
     def load_resource(self, item):
 
         resource = super(ConfigClusterSnapshot, self).load_resource(item)
@@ -370,20 +386,14 @@
                 k = 'DBCl%s' % k[4:]
                 resource[k] = v
             elif k.startswith('Iamd'):
                 resource.pop(k)
                 k = 'IAMD%s' % k[4:]
                 resource[k] = v
         resource['Tags'] = [{'Key': k, 'Value': v} for k, v in item['tags'].items()]
-
-        utc = tzutc()
-        resource['SnapshotCreateTime'] = datetime.fromtimestamp(
-            resource['SnapshotCreateTime'] / 1000, tz=utc)
-        resource['ClusterCreateTime'] = datetime.fromtimestamp(
-            resource['ClusterCreateTime'] / 1000, tz=utc)
         return resource
 
 
 @resources.register('rds-cluster-snapshot')
 class RDSClusterSnapshot(QueryResourceManager):
     """Resource manager for RDS cluster snapshots.
     """
```

## c7n/resources/s3.py

```diff
@@ -346,15 +346,16 @@
 @resources.register('s3')
 class S3(query.QueryResourceManager):
 
     class resource_type(query.TypeInfo):
         service = 's3'
         arn_type = ''
         enum_spec = ('list_buckets', 'Buckets[]', None)
-        detail_spec = ('list_objects', 'Bucket', 'Contents[]')
+        # not used but we want some consistency on the metadata
+        detail_spec = ('get_bucket_location', 'Bucket', 'Name', 'LocationConstraint')
         name = id = 'Name'
         date = 'CreationDate'
         dimension = 'BucketName'
         cfn_type = config_type = 'AWS::S3::Bucket'
 
     filter_registry = filters
     action_registry = actions
@@ -583,55 +584,72 @@
     def get_accounts(self):
         """add in elb access by default
 
         ELB Accounts by region
          https://docs.aws.amazon.com/elasticloadbalancing/latest/classic/enable-access-logs.html
 
         Redshift Accounts by region
+        https://docs.aws.amazon.com/redshift/latest/mgmt/db-auditing.html#db-auditing-manage-log-files
          https://docs.aws.amazon.com/redshift/latest/mgmt/db-auditing.html#rs-db-auditing-cloud-trail-rs-acct-ids
 
         Cloudtrail Accounts by region
          https://docs.aws.amazon.com/awscloudtrail/latest/userguide/cloudtrail-supported-regions.html
         """
         accounts = super(S3CrossAccountFilter, self).get_accounts()
         return accounts.union(
             [
                 # ELB accounts
                 '127311923021',  # us-east-1
                 '033677994240',  # us-east-2
-                '797873946194',  # us-west-2
                 '027434742980',  # us-west-1
+                '797873946194',  # us-west-2
+                '098369216593',  # af-south-1
                 '985666609251',  # ca-central-1
-                '156460612806',  # eu-west-1
                 '054676820928',  # eu-central-1
+                '897822967062',  # eu-north-1
+                '635631232127',  # eu-south-1
+                '156460612806',  # eu-west-1
                 '652711504416',  # eu-west-2
+                '009996457667',  # eu-west-3
+                '754344448648',  # ap-east-1
                 '582318560864',  # ap-northeast-1
                 '600734575887',  # ap-northeast-2
+                '383597477331',  # ap-northeast-3
                 '114774131450',  # ap-southeast-1
                 '783225319266',  # ap-southeast-2
                 '718504428378',  # ap-south-1
+                '076674570225',  # me-south-1
                 '507241528517',  # sa-east-1
                 '048591011584',  # us-gov-west-1 or gov-cloud-1
+                '190560391635',  # us-gov-east-1
                 '638102146993',  # cn-north-1
+                '037604701340',  # cn-northwest-1
 
-                # Redshift accounts
-                '368064434614',  # us-east-1
-                '790247189693',  # us-east-2
-                '703715109447',  # us-east-1
-                '473191095985',  # us-west-2
-                '408097707231',  # ap-south-1
-                '713597048934',  # ap-northeast-2
-                '960118270566',  # ap-southeast-1
-                '485979073181',  # ap-southeast-2
-                '615915377779',  # ap-northeast-1
-                '764870610256',  # ca-central-1
-                '434091160558',  # eu-central-1
-                '246478207311',  # eu-west-1
-                '885798887673',  # eu-west-2
-                '392442076723',  # sa-east-1
+                # Redshift audit logging
+                '193672423079',  # us-east-1
+                '391106570357',  # us-east-2
+                '262260360010',  # us-west-1
+                '902366379725',  # us-west-2
+                '365689465814',  # af-south-1
+                '313564881002',  # ap-east-1
+                '865932855811',  # ap-south-1
+                '090321488786',  # ap-northeast-3
+                '760740231472',  # ap-northeast-2
+                '361669875840',  # ap-southeast-1
+                '762762565011',  # ap-southeast-2
+                '404641285394',  # ap-northeast-1
+                '907379612154',  # ca-central-1
+                '053454850223',  # eu-central-1
+                '210876761215',  # eu-west-1
+                '307160386991',  # eu-west-2
+                '945612479654',  # eu-south-1
+                '915173422425',  # eu-west-3
+                '729911121831',  # eu-north-1
+                '013126148197',  # me-south-1
+                '075028567923',  # sa-east-1
 
                 # Cloudtrail accounts (psa. folks should be using
                 # cloudtrail service in bucket policies)
                 '086441151436',  # us-east-1
                 '475085895292',  # us-west-2
                 '388731089494',  # us-west-1
                 '113285607260',  # us-west-2
```

## c7n/resources/sqs.py

```diff
@@ -29,15 +29,15 @@
                     QueueUrl=r,
                     AttributeNames=['All'])['Attributes']
                 queue['QueueUrl'] = r
             except ClientError as e:
                 if e.response['Error']['Code'] == 'AWS.SimpleQueueService.NonExistentQueue':
                     return
                 if e.response['Error']['Code'] == 'AccessDenied':
-                    self.log.warning("Denied access to sqs %s" % r)
+                    self.manager.log.warning("Denied access to sqs %s" % r)
                     return
                 raise
             return queue
 
         with self.manager.executor_factory(max_workers=2) as w:
             return universal_augment(
                 self.manager, list(filter(None, w.map(_augment, resources))))
@@ -53,15 +53,15 @@
 
 @resources.register('sqs')
 class SQS(QueryResourceManager):
 
     class resource_type(TypeInfo):
         service = 'sqs'
         arn_type = ""
-        enum_spec = ('list_queues', 'QueueUrls', None)
+        enum_spec = ('list_queues', 'QueueUrls', {'MaxResults': 1000})
         detail_spec = ("get_queue_attributes", "QueueUrl", None, "Attributes")
         cfn_type = config_type = 'AWS::SQS::Queue'
         id = 'QueueUrl'
         arn = "QueueArn"
         filter_name = 'QueueNamePrefix'
         filter_type = 'scalar'
         name = 'QueueUrl'
```

## Comparing `c7n-0.9.8.dist-info/LICENSE.txt` & `c7n-0.9.9.dist-info/LICENSE.txt`

 * *Files identical despite different names*

## Comparing `c7n-0.9.8.dist-info/METADATA` & `c7n-0.9.9.dist-info/METADATA`

 * *Files 13% similar despite different names*

```diff
@@ -1,25 +1,33 @@
 Metadata-Version: 2.1
 Name: c7n
-Version: 0.9.8
+Version: 0.9.9
 Summary: Cloud Custodian - Policy Rules Engine
 Home-page: https://cloudcustodian.io
 Author: Cloud Custodian Project
 License: UNKNOWN
 Platform: UNKNOWN
 Requires-Python: >=3.6,<4.0
 Description-Content-Type: text/markdown
-Requires-Dist: argcomplete (<2.0.0,>=1.11.1)
-Requires-Dist: boto3 (<2.0.0,>=1.12.31)
-Requires-Dist: importlib-metadata (<2.0.0)
+Requires-Dist: argcomplete (==1.12.2)
+Requires-Dist: boto3 (==1.16.32)
+Requires-Dist: botocore (==1.19.32)
 Requires-Dist: jsonpickle (==1.3)
-Requires-Dist: jsonschema (<4.0.0,>=3.2.0)
-Requires-Dist: python-dateutil (<3.0.0,>=2.8.1)
-Requires-Dist: pyyaml (<6.0,>=5.3)
-Requires-Dist: tabulate (<0.9.0,>=0.8.6)
+Requires-Dist: jsonschema (==3.2.0)
+Requires-Dist: s3transfer (==0.3.3)
+Requires-Dist: tabulate (==0.8.7)
+Requires-Dist: jmespath (==0.10.0) ; python_version >= "2.6" and python_full_version < "3.0.0" or python_full_version >= "3.3.0"
+Requires-Dist: python-dateutil (==2.8.1) ; python_version >= "2.7" and python_full_version < "3.0.0" or python_full_version >= "3.3.0"
+Requires-Dist: six (==1.15.0) ; python_version >= "2.7" and python_full_version < "3.0.0" or python_full_version >= "3.3.0"
+Requires-Dist: attrs (==20.3.0) ; python_version >= "2.7" and python_full_version < "3.0.0" or python_full_version >= "3.4.0"
+Requires-Dist: importlib-metadata (==1.7.0) ; python_version >= "2.7" and python_full_version < "3.0.0" or python_full_version >= "3.5.0"
+Requires-Dist: pyyaml (==5.3.1) ; python_version >= "2.7" and python_full_version < "3.0.0" or python_full_version >= "3.5.0"
+Requires-Dist: urllib3 (==1.26.2) ; python_version >= "2.7" and python_full_version < "3.0.0" or python_full_version >= "3.5.0" and python_version < "4"
+Requires-Dist: pyrsistent (==0.17.3) ; python_version >= "3.5"
+Requires-Dist: zipp (==3.4.0) ; python_version >= "3.6"
 
 Cloud Custodian
 =================
 
 <p align="center"><img src="https://cloudcustodian.io/img/logo_capone_devex_cloud_custodian.svg" alt="Cloud Custodian Logo" width="200px" height="200px" /></p>
 
 ---
```

## Comparing `c7n-0.9.8.dist-info/RECORD` & `c7n-0.9.9.dist-info/RECORD`

 * *Files 8% similar despite different names*

```diff
@@ -15,127 +15,127 @@
 c7n/log.py,sha256=HBmXNBYrYzubrujOtn0t2J4oKI0EDGsxeeWXGwc_mQw,7455
 c7n/lookup.py,sha256=UpyQ92skmFZx12d6hbHeS2N-5ETW5N7qqo6AV350sg8,1657
 c7n/manager.py,sha256=B3QUQ88gMh6vyiwEICQDWGWIZmlR-ryV8zuDc_Cly_4,4683
 c7n/mu.py,sha256=fKyua-Ge3C-7L4kDSVym9Siq4pW6bl58Vog-HElvXC0,58863
 c7n/output.py,sha256=RdaIfAZDt7J0oIuibll4zJJZeC_r50dza9r-y4NBmxo,14796
 c7n/policy.py,sha256=7xeGQyGpWeHx1ChESR4ixL0X6hK4rRDZdgsMlm0RXXs,45922
 c7n/provider.py,sha256=unzF4-Kz20ZuzokjIfXTz5-mq_2rzsYBVbuRmX7l1OI,3541
-c7n/query.py,sha256=TCBAIaidbLSRX8fyG9YINYDlZT_6n9XS7fQTAWZBOO8,29759
+c7n/query.py,sha256=jD3Cfp--_efOsD3gmHC4T7332QRhW828cXmju4t0m2o,29815
 c7n/registry.py,sha256=1u86djN1LfUsPN0oG2OJktPRVu8wzIKrfrk0u87SFuk,2971
 c7n/resolver.py,sha256=032HYtSyKMjeb8BpC6fZaoXS9mjLDdqWGuXQZw_rA14,6455
 c7n/schema.py,sha256=NoWkIAidS33UNLM5-p1Hp19atU08snW7hFN8TuCTkJU,23675
 c7n/sqsexec.py,sha256=AJJ_qYSl_X7QZjOa0QIp5kiFAbAhhQfsWLR0J9LlBHc,4687
 c7n/structure.py,sha256=laTuRHBuci2UNwR6Q3Rv2c97hBACiPKErbN5Q0j3-7I,3897
 c7n/tags.py,sha256=lp8AZ1iAMuN1OcKYZ6PkNnvqNk4VJ86Fa_ves3xrxfQ,39615
 c7n/testing.py,sha256=OJlE6GaT6xiUFiJrc0TaDicHVf1r1sVJmT5Q2PvJXlo,8662
-c7n/utils.py,sha256=OyX2ADVydLoHrk6Ov5qe10XPdoQ6WzHZ6crfJuW-kcQ,20601
-c7n/version.py,sha256=m5A1njjdfAoE6kLtyCYxrmL7kIUVDbachaIZ2BGCIJs,136
+c7n/utils.py,sha256=rjbsOdaSLXM_zU1BG2j07gAwcprzlMRxhT_aICrhdZo,22059
+c7n/version.py,sha256=p66GK8AlhhLAX-APoqVSMS7iYYdQNV2CSIkFTPbiAMk,57
 c7n/actions/__init__.py,sha256=gZ4KQNqtksXW8tJ0iONeGQpOz3g4mH1Bscn8brkzB1Q,389
-c7n/actions/autotag.py,sha256=_XpB6I-WKcT4nA3j80JVGBi59gyzFK7KRcg99jNcQ_E,5563
+c7n/actions/autotag.py,sha256=RjMWzjhDNPVDA7pwsRjeoM5djwOG2k84M30IejbpDeM,5826
 c7n/actions/core.py,sha256=guK9zDmq8TesGJT51FD8vrArIDx64MQ5j0GxIhzYmhY,2408
 c7n/actions/invoke.py,sha256=qbR8QpgM12_iL0rpoOItmdD7NPWt-2R4WJS-cIat4Gc,3599
 c7n/actions/metric.py,sha256=6MqOeDO2pkLKI1c3PNV7GIHaHruFO4MAg7pLw2M4RGc,5188
 c7n/actions/network.py,sha256=OhB20iPcknVApXUhzdPzIsa0e1xAI7nG-8qbr2K58AU,8912
 c7n/actions/notify.py,sha256=M34iBavRYtnJrc-Nzg94sCuA1k4trzrw7OsCRSq7540,11354
 c7n/actions/policy.py,sha256=F_wX2GoujVuIVfPvVcgJMrk-urWmh-N67oGTrwparwA,3559
-c7n/actions/webhook.py,sha256=eDKj1zqhWM5dSvCzUM7NtaUckbQjA2iqxeQGlEV5BXQ,5148
+c7n/actions/webhook.py,sha256=8R4aFj5gOChKdCfhZMAw6O7T_MqTLkmhkuMiDj8gOLM,5176
 c7n/filters/__init__.py,sha256=STRdpo2HeCHedsLgGq2uuuQQ05QV_FHJVaUQpsoBKnc,548
 c7n/filters/config.py,sha256=VTi1aTKrlI3sLDF2_8p1vJqZhUzAvNmJVhKzlHAwhSw,5253
-c7n/filters/core.py,sha256=aWxdlk72ZtgEVJM9HAhkANgfRa7PrQx0Pya-EoOaL90,32647
+c7n/filters/core.py,sha256=e0IzX3KVS3d24zf_aEJbTyjU6iUSP3LiVJJ_VBfkvvE,31661
 c7n/filters/health.py,sha256=9yD8Oth1n02Vd4S7HK7DDv9ZTWq_h5JmI9u5PDNjHkM,4467
 c7n/filters/iamaccess.py,sha256=J-TR1xEQ1IZNpfv8xRJPO79I-HxbyKh1G1JEjXk5cFk,11356
 c7n/filters/iamanalyzer.py,sha256=-XhT12wV34ZiLx-ha1UJmXsIURtqN3zHmNpGjHyZDJQ,3666
 c7n/filters/kms.py,sha256=2SkcsFpAP8UtXa_uirIYktOMDk-xhkL8MupHCyfmA2k,1910
-c7n/filters/metrics.py,sha256=Js2xxcHo4mSl5rAqXEMvgoBSRzaBskbp8CLzi-Js_ic,9717
+c7n/filters/metrics.py,sha256=z18q2F9AuddOyTyhOdYRp1NIFoiqQzd_ZX7grqmlI5s,9937
 c7n/filters/missing.py,sha256=chd1p-Z7RGzXzEh7kasGtnvxSICe7GVxrNLLVmWaDFU,2027
 c7n/filters/multiattr.py,sha256=5MPxV_aBB8QHbN6Ekvi2WxLgPPM4Np37VTQ-u3mQAnw,1614
 c7n/filters/offhours.py,sha256=EnzaHrNIzINhHoT3epb-d-JT1rW_hDO0ketZ3EG73d0,23620
 c7n/filters/related.py,sha256=2YnzfKqHuCygdj0NgpueKDKxrLQmuTiHBzJ-1nLUjaI,5730
 c7n/filters/revisions.py,sha256=7S0hDVYHximBth9GbWtF8EY5_g3o3kBZrljPa-TEmlk,6626
 c7n/filters/vpc.py,sha256=mzxheuoouv_D9kkRFBfoB959Q7ppitGaxQJODQpvcik,10382
 c7n/reports/__init__.py,sha256=AE4B_K4oFGnIxF74GmW2wHQAGAGLDX-U1BWlCbqQGwU,106
 c7n/reports/csvout.py,sha256=rZRYPIVEjSMi8uyxVAs8BEYJu6MRajBOMSaZXV08LVI,8923
 c7n/resources/__init__.py,sha256=RHnAU3v-3v1HS1csLqjrWpTF7UrjA6RywsaJTyRPsPg,2310
-c7n/resources/account.py,sha256=C6D5Ks7oP_xG3pHkDABUlAk1zVQw-9523rvaS0vmg8E,64649
+c7n/resources/account.py,sha256=KpKDV_fyNqlQASExTY1SCVNd0fhs1Un-Nk7_lAv8a4I,65992
 c7n/resources/acm.py,sha256=z2YABlZsNB6CLJGHbPFgdWHyI3PFOM1s8Dc0Fvf_7ew,2790
 c7n/resources/ami.py,sha256=pw8e8qhOWDtnrRvcSMv8U57Tw-agQN1iwD2rY8Iz3U4,12601
 c7n/resources/apigw.py,sha256=lB4MOQv6kj45GTJxukSkW3HWBmiuDGNqIDaYF3Q62bQ,22322
-c7n/resources/appelb.py,sha256=l1CkJjJHrznMo5Q2fhFvGSLyWWoH6fJD5KmOEBa3cZg,35672
+c7n/resources/appelb.py,sha256=fdfRbyjRgHMl_6zWgGp-yBO6PLm_z3IY87YF7WVYF-s,38498
 c7n/resources/artifact.py,sha256=sFCO1KHu0SqvG5WllBJ4iCFDFKR3qrIkJhEIhzaHgV8,5587
-c7n/resources/asg.py,sha256=wlxvyymRbF5WHFQmaoYUQpCNQm0bE-BzINavxCCNaZQ,59142
+c7n/resources/asg.py,sha256=yT4NnIhHtvADmqkF32gdXRsk1uBldtkUDHbNoUyLsjs,60126
 c7n/resources/aws.py,sha256=2pSk5uYx5nnPcRiH_5UZQV46L2hze-dtqN8EgvwkAmQ,22922
 c7n/resources/awslambda.py,sha256=CZGQ2JCMiSR9VXS_mzdl5teFAud-pUczScE0c-SFiTo,21431
 c7n/resources/backup.py,sha256=S3azB0QuPj4F6gU4X3V2lO9468bc60xKSpTFHnZXmZg,2786
 c7n/resources/batch.py,sha256=_YbSuwLcJwLCVzUCfDkL8PV2VRonNo8cT0t5WI7T7gE,5904
 c7n/resources/cfn.py,sha256=Gzu-NFG6FNZL20mHaqkU0PCYjOrAwmtAiRzT9EcT-PM,6823
 c7n/resources/cloudfront.py,sha256=boMzOsMPaC9HwYNYollI0JhpTyjdFip9GIl1drtEZIs,24908
 c7n/resources/cloudsearch.py,sha256=ayW2OIMGdAtdLOQqeWsZen-xiAuodIYVqHXBrdWhe6U,1084
 c7n/resources/cloudtrail.py,sha256=IbdcqSuoBa3gRkt30oOtS7eJ9ylj3vZ8E8Xt8Nq0FCo,7817
 c7n/resources/code.py,sha256=eqhSt_JWMPLeLJop14V08W48aIU_5L5wEofmohQr43E,8726
 c7n/resources/cognito.py,sha256=XtIpQ3y3qlbdICqt2l-uv-26xLjRloLrmCSfWpTNhMg,3176
 c7n/resources/config.py,sha256=-X8W1HXx9euYiIMUojAbDgIkznqrtauimmsEdGMWp2k,3362
-c7n/resources/cw.py,sha256=qmj9jj6ggUQgGkMaH2BEANVlhLaY9IDCyXCAfgQV_rw,15058
+c7n/resources/cw.py,sha256=Y4cqlFz-ilAcfzDDcmHyGjjzNB1tTyef9Vkrp9DmEiQ,15167
 c7n/resources/datapipeline.py,sha256=_-N_pwoEg4_F9b1ayZ3mgl18iL9hqKjnUn7DP1ilCXE,5885
 c7n/resources/directconnect.py,sha256=iLDKTjzVD_uECmGsXuQTxkW1lZ53UN17VYDoVp1nB_M,618
 c7n/resources/directory.py,sha256=fgXa2Z36mYZ-GSiGUR2BNYb42BI--NDeG3qYTcyrW5c,3693
 c7n/resources/dlm.py,sha256=w3mFEN1PmMN8db4VVvFIfO5xdF6Z-RwnZgeAL79_cGM,621
 c7n/resources/dms.py,sha256=BecWoo-Ncb4EdpMIUDWRyeBpH_TFHuD3kDxhR4Hs-aE,13835
 c7n/resources/dynamodb.py,sha256=H2IqBg2-QL_GoOox0eCsTRJ7pRaLXvwiqbARycxV9lk,22690
-c7n/resources/ebs.py,sha256=TbRFCHUcBG50T1p1spcUtJlcroYlXQJHwGijtxBPDVo,53512
-c7n/resources/ec2.py,sha256=UdXZ6LOF1A_aEwlf3hZ4GKny9wfeUKoTSBPI_C2ZpCk,73255
-c7n/resources/ecr.py,sha256=jFxvLW5YV2UnkfDndqRZwXd76UMjCrBzN2pCJcdpzVw,13247
+c7n/resources/ebs.py,sha256=bh6KMNNv7j2CWX6ZDgZ__xyFQ87qhN09eJ6IOE-20QY,56735
+c7n/resources/ec2.py,sha256=WCpWsi7gCGVKslbcPZcCc-KSDDce4wtXo92tYU6ekMU,73273
+c7n/resources/ecr.py,sha256=KihVslLHrDKaPJzvdYL1m4JeBgAEswa0O39Uki1Jo30,13247
 c7n/resources/ecs.py,sha256=7exA1rZMGYitW46yUWod7j8h-7Gzkdvy8mrPv2JhLt8,27084
 c7n/resources/efs.py,sha256=DVGGyGjAEqoxr2w58iaW3-MeGCXMGbZAwfzE1XMHlCw,8159
 c7n/resources/eks.py,sha256=uNjtfWYo8NUaa4pbnWz1gvANm2FnZtM4LuJvoa9bFRY,6799
 c7n/resources/elasticache.py,sha256=NjLEyYS2CojA4yiSFQ5iohM0EojZRVYhHc2pe1X31Qc,17207
 c7n/resources/elasticbeanstalk.py,sha256=0bRmNYiGPO7-ouYI_YKi8ziafbpo6_pH33McqgStIi0,6583
-c7n/resources/elasticsearch.py,sha256=UWnIJP5TPWqctRwVKei1DxEpKgTLMx9S6OshZ_3dlZQ,8969
+c7n/resources/elasticsearch.py,sha256=pKDRxmiEX3z85jrA8zyA5PQC9UqXzemwIyTwrS5f9QU,11965
 c7n/resources/elb.py,sha256=LYWnptskR32pH4Y1gvkaMIr6ogIr4Pkd6NGLg3gMbS8,29245
 c7n/resources/emr.py,sha256=YfQPYXN1bLfAlK2qVS9F_2Lh9rQBEPxS9EM3BQEaBOk,10989
 c7n/resources/fsx.py,sha256=61buK7dCJh0Q6nMI-v-UMClzHz5pHZFJlXSn6JhRmkU,10242
 c7n/resources/gamelift.py,sha256=NpCbF0h_4uDrQzWqnOzOoEfCpg30hsa3cQakIaXy8iw,961
 c7n/resources/glacier.py,sha256=R3CUuppNO7Wo_VTaXowQRadIevkykL_pq-L6IeZe9C8,5812
 c7n/resources/glue.py,sha256=BUuTcE4F2kVL_aXWAmkeoh91p-V7J9CX8Rn3payPQNY,22876
 c7n/resources/health.py,sha256=nu6k-CocfhtwPE6VZmWLQr0xaYMhZFlpUgIFgR46vkE,4419
 c7n/resources/hsm.py,sha256=FQBNGjNLRthtSTxIulSq0jyCdOci7rqkLcFXvfDwX0c,2808
-c7n/resources/iam.py,sha256=wFPQAqptwHuW-PkzkYkEx8vAakLf7rgL3bm3B0xa2Lk,78183
+c7n/resources/iam.py,sha256=BhJTt09QKhKN0mHS2D92E5VQLvxyaccxIwFvtFmMYX0,79316
 c7n/resources/iot.py,sha256=tkjxWquS4h8xnCKoZ8JpcZFGMm8omUyWmg28IUFOzoU,552
 c7n/resources/kafka.py,sha256=gpaMz35MDjTfQgY5rtCbq9JJyUdnY1nhAbBOKjf3Ufs,2791
 c7n/resources/kinesis.py,sha256=4yA0ohQRBt4OmdQMsc4v0akK8GvV8YShkXnx37GEQ4A,9448
-c7n/resources/kms.py,sha256=fHWy3zrcS5J6YTroNMV5CssVQw3Nb5mqbdVfg6CYW0A,12069
+c7n/resources/kms.py,sha256=O3VQXgDk9vk_-kp-ndz36KR1De5qN2-pkw5tztWzDU8,12152
 c7n/resources/lightsail.py,sha256=Jt34XVMXoADgFaa-ZtEA12w2pEx12yvDi736Lx2PTXA,1026
 c7n/resources/ml.py,sha256=9zVAqLYJae0HjeSeisbudb9yofiGP_SszRUzom7QNfo,1722
 c7n/resources/mq.py,sha256=nNXio2a5mwFheMdHe1pMzMOeEO4PQwf2af2QOCCkTA0,5003
 c7n/resources/opsworks.py,sha256=kQ2-o5ReC13Uo35eYsuFJKkRrUQm7ddgRMYjw3MTNSU,5691
 c7n/resources/qldb.py,sha256=xo4NJKJ2wVHXvHSdlZAHy0XHk6wxx5pUZ5Wl_Og_BM4,2200
-c7n/resources/rds.py,sha256=iijIACz-fOwBjaPgrlURgLk7yKAqbjzUSwrQGNwk4s8,58753
-c7n/resources/rdscluster.py,sha256=iOuh7P5xqxDx4HbLcQ721w7q3Eh2_zi_hT6qxbRnHIg,17936
+c7n/resources/rds.py,sha256=drNTp-NBceisBgjJBQxuNfKHGc_qgCzJEoMZIxn-R48,58988
+c7n/resources/rdscluster.py,sha256=tfAgbF8YNkyjmPsAam-HPyjkps1jTQv2YOdv3B8WFKY,18221
 c7n/resources/rdsparamgroup.py,sha256=zZ2D6g3M8-rANKCYL2Y1wDE7Q5Qyc6YdALwxncVQP44,11024
 c7n/resources/redshift.py,sha256=QjGN5QfjbrF_w3ZlICV34WRxTSqklx7GLlLXoTmLR_c,32970
 c7n/resources/resource_map.py,sha256=I_GP1fwqSYES_fuZ3mAFfh3-SOxs2S-BI0AkgnhWH28,11204
 c7n/resources/route53.py,sha256=Hih2NEX8bkSzLyjsnCjbOiBRnvTBnSpeIEWmGNxAufY,17438
-c7n/resources/s3.py,sha256=cM6iXy7_yTF5d6n0PzH0_SYHNw057ZGTLrQWx8OYVpg,119664
+c7n/resources/s3.py,sha256=YaWP3sZhz969N3St4mB1UYBjNnbdrhSKd0XiG9WwgxY,120606
 c7n/resources/sagemaker.py,sha256=jEutef-w9QE6W0sNbGsoxBlczPnFCFuTIQFT1paWqzQ,23195
 c7n/resources/sar.py,sha256=jqWF3uOakPAMMPTNeNh6x1heAcIMlOGBNhz9JzGGv7g,2779
 c7n/resources/secretsmanager.py,sha256=X41QKhIlTrOVdWtCh2u4NzHjz4LLktkiz2OL5NZrHUY,3390
 c7n/resources/securityhub.py,sha256=VMFBLT9dbmMJkr56b075dLwgjPI0vH-_TsNKYRft9g4,22785
 c7n/resources/servicecatalog.py,sha256=kGtygADhBIF4uWJBaj3sayfovCvtqZS42QN9zLJ5KkY,5773
 c7n/resources/sfn.py,sha256=Wh8agOHk3NdEQUHQAZJ3JLYMxBjn8HebMgBcXDjcrE8,5654
 c7n/resources/shield.py,sha256=FCnqMVAMRUdd6ZSLX0gHR2LbjWfeZ4HfgDSVquBYxrY,5264
 c7n/resources/simpledb.py,sha256=N_Mc8zkFOT7WcR5XK_2M_EqwAyQc-LJkjZuKT7Vgpjk,1473
 c7n/resources/snowball.py,sha256=wWr8ZQAapfHh3DOe9z83EifQ_9zPLno8gu_EbgVLrWs,969
 c7n/resources/sns.py,sha256=r6Mz98GUPxNg8I8QHoaASfg79o98mOZh46ebTi1yZiM,15127
-c7n/resources/sqs.py,sha256=tmKAdO1TjmAcPKSRbs2PWK0KGeQjNUm9EBMamVf9qhE,12146
+c7n/resources/sqs.py,sha256=Zdbb960xGfWp92NNOOPvKjN0k27zzKKRmdOJKFTyr8U,12170
 c7n/resources/ssm.py,sha256=6dvcuYwIpNMHCTd8pV9Uk5WdjxcsfhXYNnxa2hb0Yns,20984
 c7n/resources/storagegw.py,sha256=-v2prsLaVb8uO1kmVii9YCsA3JO21kOPobGWM91dOe8,577
 c7n/resources/support.py,sha256=VwloxU9UN68VqUgS1rZ5GuQvrIN6bQb5-07G9cYi-yE,525
 c7n/resources/vpc.py,sha256=EfRB5szZEC9iCJeBCWEMhtVw8a9CDBQHRK64ZSRiOgU,85658
 c7n/resources/waf.py,sha256=duQZGyVgieVTYK8ul0pNDNUATdwy-E6q7QvdbUmzzGM,1656
 c7n/resources/workspaces.py,sha256=6g11TlNeMGVesLlsSQGaqyip6fpR6rzWsSres9BQNnY,3074
 c7n/ufuncs/__init__.py,sha256=047jWuqQJ9y8E890HQc54IOBixoLTr-X2Y-HLjhF7zs,81
 c7n/ufuncs/s3crypt.py,sha256=OpCWqImJ0K3B2hr8Hm4AOTm_Ksc-Y1_LdwPvtjCDWHA,2773
-c7n-0.9.8.dist-info/LICENSE.txt,sha256=xqS5ZRfY0FVRBjej5dpDDIg6GWLvwfTpEyzGqETLhOg,11361
-c7n-0.9.8.dist-info/METADATA,sha256=-7hg5G3MBd5PgPwJke7yaE8SR5NXfAAbOF8AyFda-cE,11375
-c7n-0.9.8.dist-info/WHEEL,sha256=EVRjI69F5qVjm_YgqcTXPnTAv3BfSUr0WVAHuSP3Xoo,92
-c7n-0.9.8.dist-info/entry_points.txt,sha256=OHXdypHH_ryo9JLKL-I7g_os9dSI4ZRJ1aZ6XdkIscI,44
-c7n-0.9.8.dist-info/top_level.txt,sha256=Qpnx2S5vAkm-t7ZjZVN5gZ-70crukbZq275wJd4q5Kw,4
-c7n-0.9.8.dist-info/RECORD,,
+c7n-0.9.9.dist-info/LICENSE.txt,sha256=xqS5ZRfY0FVRBjej5dpDDIg6GWLvwfTpEyzGqETLhOg,11361
+c7n-0.9.9.dist-info/METADATA,sha256=y6J-OhLRgierTyr40kcVlALb-q7ZHDe0YorPEHZRxU4,12343
+c7n-0.9.9.dist-info/WHEEL,sha256=OqRkF0eY5GHssMorFjlbTIq072vpHpF60fIQA6lS9xA,92
+c7n-0.9.9.dist-info/entry_points.txt,sha256=OHXdypHH_ryo9JLKL-I7g_os9dSI4ZRJ1aZ6XdkIscI,44
+c7n-0.9.9.dist-info/top_level.txt,sha256=Qpnx2S5vAkm-t7ZjZVN5gZ-70crukbZq275wJd4q5Kw,4
+c7n-0.9.9.dist-info/RECORD,,
```

