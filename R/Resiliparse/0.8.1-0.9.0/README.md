# Comparing `tmp/Resiliparse-0.8.1.tar.gz` & `tmp/Resiliparse-0.9.0.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "Resiliparse-0.8.1.tar", last modified: Fri Dec  3 17:42:34 2021, max compression
+gzip compressed data, was "Resiliparse-0.9.0.tar", last modified: Mon Dec  6 13:53:10 2021, max compression
```

## Comparing `Resiliparse-0.8.1.tar` & `Resiliparse-0.9.0.tar`

### file list

```diff
@@ -1,72 +1,72 @@
-drwxr-xr-x   0 runner    (1001) docker     (121)        0 2021-12-03 17:42:34.497286 Resiliparse-0.8.1/
--rw-r--r--   0 runner    (1001) docker     (121)     1870 2021-12-03 17:42:34.497286 Resiliparse-0.8.1/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (121)     1505 2021-12-03 17:42:09.000000 Resiliparse-0.8.1/README.md
-drwxr-xr-x   0 runner    (1001) docker     (121)        0 2021-12-03 17:42:34.485286 Resiliparse-0.8.1/Resiliparse.egg-info/
--rw-r--r--   0 runner    (1001) docker     (121)     1870 2021-12-03 17:42:34.000000 Resiliparse-0.8.1/Resiliparse.egg-info/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (121)     1779 2021-12-03 17:42:34.000000 Resiliparse-0.8.1/Resiliparse.egg-info/SOURCES.txt
--rw-r--r--   0 runner    (1001) docker     (121)        1 2021-12-03 17:42:34.000000 Resiliparse-0.8.1/Resiliparse.egg-info/dependency_links.txt
--rw-r--r--   0 runner    (1001) docker     (121)       60 2021-12-03 17:42:34.000000 Resiliparse-0.8.1/Resiliparse.egg-info/entry_points.txt
--rw-r--r--   0 runner    (1001) docker     (121)       34 2021-12-03 17:42:34.000000 Resiliparse-0.8.1/Resiliparse.egg-info/requires.txt
--rw-r--r--   0 runner    (1001) docker     (121)       47 2021-12-03 17:42:34.000000 Resiliparse-0.8.1/Resiliparse.egg-info/top_level.txt
--rw-r--r--   0 runner    (1001) docker     (121)      153 2021-12-03 17:42:09.000000 Resiliparse-0.8.1/pyproject.toml
-drwxr-xr-x   0 runner    (1001) docker     (121)        0 2021-12-03 17:42:34.485286 Resiliparse-0.8.1/resiliparse/
--rw-r--r--   0 runner    (1001) docker     (121)      580 2021-12-03 17:42:09.000000 Resiliparse-0.8.1/resiliparse/__init__.pxd
--rw-r--r--   0 runner    (1001) docker     (121)      580 2021-12-03 17:42:09.000000 Resiliparse-0.8.1/resiliparse/__init__.py
--rw-r--r--   0 runner    (1001) docker     (121)    25151 2021-12-03 17:42:09.000000 Resiliparse-0.8.1/resiliparse/cli.py
-drwxr-xr-x   0 runner    (1001) docker     (121)        0 2021-12-03 17:42:34.489286 Resiliparse-0.8.1/resiliparse/extract/
--rw-r--r--   0 runner    (1001) docker     (121)      580 2021-12-03 17:42:09.000000 Resiliparse-0.8.1/resiliparse/extract/__init__.pxd
--rw-r--r--   0 runner    (1001) docker     (121)      580 2021-12-03 17:42:09.000000 Resiliparse-0.8.1/resiliparse/extract/__init__.py
--rw-r--r--   0 runner    (1001) docker     (121)   534189 2021-12-03 17:42:30.000000 Resiliparse-0.8.1/resiliparse/extract/html2text.cpp
--rw-r--r--   0 runner    (1001) docker     (121)      580 2021-12-03 17:42:09.000000 Resiliparse-0.8.1/resiliparse/extract/html2text.pxd
--rw-r--r--   0 runner    (1001) docker     (121)    24011 2021-12-03 17:42:09.000000 Resiliparse-0.8.1/resiliparse/extract/html2text.pyx
--rw-r--r--   0 runner    (1001) docker     (121)   380637 2021-12-03 17:42:30.000000 Resiliparse-0.8.1/resiliparse/itertools.cpp
--rw-r--r--   0 runner    (1001) docker     (121)      580 2021-12-03 17:42:09.000000 Resiliparse-0.8.1/resiliparse/itertools.pxd
--rw-r--r--   0 runner    (1001) docker     (121)     6737 2021-12-03 17:42:09.000000 Resiliparse-0.8.1/resiliparse/itertools.pyx
-drwxr-xr-x   0 runner    (1001) docker     (121)        0 2021-12-03 17:42:34.493286 Resiliparse-0.8.1/resiliparse/parse/
--rw-r--r--   0 runner    (1001) docker     (121)      580 2021-12-03 17:42:09.000000 Resiliparse-0.8.1/resiliparse/parse/__init__.pxd
--rw-r--r--   0 runner    (1001) docker     (121)      781 2021-12-03 17:42:09.000000 Resiliparse-0.8.1/resiliparse/parse/__init__.py
--rw-r--r--   0 runner    (1001) docker     (121)   440879 2021-12-03 17:42:31.000000 Resiliparse-0.8.1/resiliparse/parse/encoding.cpp
--rw-r--r--   0 runner    (1001) docker     (121)     4917 2021-12-03 17:42:09.000000 Resiliparse-0.8.1/resiliparse/parse/encoding.h
--rw-r--r--   0 runner    (1001) docker     (121)     1296 2021-12-03 17:42:09.000000 Resiliparse-0.8.1/resiliparse/parse/encoding.pxd
--rw-r--r--   0 runner    (1001) docker     (121)    21470 2021-12-03 17:42:09.000000 Resiliparse-0.8.1/resiliparse/parse/encoding.pyx
--rw-r--r--   0 runner    (1001) docker     (121)  1482745 2021-12-03 17:42:32.000000 Resiliparse-0.8.1/resiliparse/parse/html.cpp
--rw-r--r--   0 runner    (1001) docker     (121)     1490 2021-12-03 17:42:09.000000 Resiliparse-0.8.1/resiliparse/parse/html.h
--rw-r--r--   0 runner    (1001) docker     (121)     6508 2021-12-03 17:42:09.000000 Resiliparse-0.8.1/resiliparse/parse/html.pxd
--rw-r--r--   0 runner    (1001) docker     (121)    63198 2021-12-03 17:42:09.000000 Resiliparse-0.8.1/resiliparse/parse/html.pyx
--rw-r--r--   0 runner    (1001) docker     (121)   201260 2021-12-03 17:42:32.000000 Resiliparse-0.8.1/resiliparse/parse/http.cpp
--rw-r--r--   0 runner    (1001) docker     (121)      617 2021-12-03 17:42:09.000000 Resiliparse-0.8.1/resiliparse/parse/http.pxd
--rw-r--r--   0 runner    (1001) docker     (121)     1818 2021-12-03 17:42:09.000000 Resiliparse-0.8.1/resiliparse/parse/http.pyx
--rw-r--r--   0 runner    (1001) docker     (121)   222191 2021-12-03 17:42:32.000000 Resiliparse-0.8.1/resiliparse/parse/lang.cpp
--rw-r--r--   0 runner    (1001) docker     (121)     2316 2021-12-03 17:42:09.000000 Resiliparse-0.8.1/resiliparse/parse/lang.pxd
--rw-r--r--   0 runner    (1001) docker     (121)     7010 2021-12-03 17:42:09.000000 Resiliparse-0.8.1/resiliparse/parse/lang.pyx
--rw-r--r--   0 runner    (1001) docker     (121)    80918 2021-12-03 17:42:09.000000 Resiliparse-0.8.1/resiliparse/parse/lang_profiles.h
--rw-r--r--   0 runner    (1001) docker     (121)   647666 2021-12-03 17:42:32.000000 Resiliparse-0.8.1/resiliparse/process_guard.cpp
--rw-r--r--   0 runner    (1001) docker     (121)     1951 2021-12-03 17:42:09.000000 Resiliparse-0.8.1/resiliparse/process_guard.pxd
--rw-r--r--   0 runner    (1001) docker     (121)    21918 2021-12-03 17:42:09.000000 Resiliparse-0.8.1/resiliparse/process_guard.pyx
-drwxr-xr-x   0 runner    (1001) docker     (121)        0 2021-12-03 17:42:34.493286 Resiliparse-0.8.1/resiliparse_common/
--rw-r--r--   0 runner    (1001) docker     (121)      580 2021-12-03 17:42:09.000000 Resiliparse-0.8.1/resiliparse_common/__init__.pxd
--rw-r--r--   0 runner    (1001) docker     (121)     2510 2021-12-03 17:42:09.000000 Resiliparse-0.8.1/resiliparse_common/string_util.pxd
-drwxr-xr-x   0 runner    (1001) docker     (121)        0 2021-12-03 17:42:34.497286 Resiliparse-0.8.1/resiliparse_inc/
--rw-r--r--   0 runner    (1001) docker     (121)        0 2021-12-03 17:42:09.000000 Resiliparse-0.8.1/resiliparse_inc/__init__.pxd
--rw-r--r--   0 runner    (1001) docker     (121)      203 2021-12-03 17:42:09.000000 Resiliparse-0.8.1/resiliparse_inc/algorithm.pxd
--rw-r--r--   0 runner    (1001) docker     (121)      338 2021-12-03 17:42:09.000000 Resiliparse-0.8.1/resiliparse_inc/atomic.pxd
--rw-r--r--   0 runner    (1001) docker     (121)     4743 2021-12-03 17:42:09.000000 Resiliparse-0.8.1/resiliparse_inc/boost_regex.pxd
--rw-r--r--   0 runner    (1001) docker     (121)       97 2021-12-03 17:42:09.000000 Resiliparse-0.8.1/resiliparse_inc/cctype.pxd
--rw-r--r--   0 runner    (1001) docker     (121)      110 2021-12-03 17:42:09.000000 Resiliparse-0.8.1/resiliparse_inc/cstdlib.pxd
--rw-r--r--   0 runner    (1001) docker     (121)       83 2021-12-03 17:42:09.000000 Resiliparse-0.8.1/resiliparse_inc/cstring.pxd
--rw-r--r--   0 runner    (1001) docker     (121)      214 2021-12-03 17:42:09.000000 Resiliparse-0.8.1/resiliparse_inc/dlfcn.pxd
--rw-r--r--   0 runner    (1001) docker     (121)       50 2021-12-03 17:42:09.000000 Resiliparse-0.8.1/resiliparse_inc/errno.pxd
--rw-r--r--   0 runner    (1001) docker     (121)    31603 2021-12-03 17:42:09.000000 Resiliparse-0.8.1/resiliparse_inc/lexbor.pxd
--rw-r--r--   0 runner    (1001) docker     (121)     1916 2021-12-03 17:42:09.000000 Resiliparse-0.8.1/resiliparse_inc/lz4frame.pxd
--rw-r--r--   0 runner    (1001) docker     (121)      168 2021-12-03 17:42:09.000000 Resiliparse-0.8.1/resiliparse_inc/lz4hc.pxd
--rw-r--r--   0 runner    (1001) docker     (121)      152 2021-12-03 17:42:09.000000 Resiliparse-0.8.1/resiliparse_inc/pthread.pxd
--rw-r--r--   0 runner    (1001) docker     (121)     7365 2021-12-03 17:42:09.000000 Resiliparse-0.8.1/resiliparse_inc/re2.pxd
--rw-r--r--   0 runner    (1001) docker     (121)      149 2021-12-03 17:42:09.000000 Resiliparse-0.8.1/resiliparse_inc/stdio.pxd
--rw-r--r--   0 runner    (1001) docker     (121)     1430 2021-12-03 17:42:09.000000 Resiliparse-0.8.1/resiliparse_inc/string_view.pxd
--rw-r--r--   0 runner    (1001) docker     (121)      282 2021-12-03 17:42:09.000000 Resiliparse-0.8.1/resiliparse_inc/time.pxd
--rw-r--r--   0 runner    (1001) docker     (121)      390 2021-12-03 17:42:09.000000 Resiliparse-0.8.1/resiliparse_inc/uchardet.pxd
--rw-r--r--   0 runner    (1001) docker     (121)      129 2021-12-03 17:42:09.000000 Resiliparse-0.8.1/resiliparse_inc/unistd.pxd
--rw-r--r--   0 runner    (1001) docker     (121)     1026 2021-12-03 17:42:09.000000 Resiliparse-0.8.1/resiliparse_inc/utility.pxd
--rw-r--r--   0 runner    (1001) docker     (121)     1189 2021-12-03 17:42:09.000000 Resiliparse-0.8.1/resiliparse_inc/zlib.pxd
--rw-r--r--   0 runner    (1001) docker     (121)       38 2021-12-03 17:42:34.497286 Resiliparse-0.8.1/setup.cfg
--rw-r--r--   0 runner    (1001) docker     (121)     5438 2021-12-03 17:42:09.000000 Resiliparse-0.8.1/setup.py
+drwxr-xr-x   0 runner    (1001) docker     (121)        0 2021-12-06 13:53:10.677152 Resiliparse-0.9.0/
+-rw-r--r--   0 runner    (1001) docker     (121)     1870 2021-12-06 13:53:10.677152 Resiliparse-0.9.0/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (121)     1505 2021-12-06 13:52:44.000000 Resiliparse-0.9.0/README.md
+drwxr-xr-x   0 runner    (1001) docker     (121)        0 2021-12-06 13:53:10.665151 Resiliparse-0.9.0/Resiliparse.egg-info/
+-rw-r--r--   0 runner    (1001) docker     (121)     1870 2021-12-06 13:53:10.000000 Resiliparse-0.9.0/Resiliparse.egg-info/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (121)     1779 2021-12-06 13:53:10.000000 Resiliparse-0.9.0/Resiliparse.egg-info/SOURCES.txt
+-rw-r--r--   0 runner    (1001) docker     (121)        1 2021-12-06 13:53:10.000000 Resiliparse-0.9.0/Resiliparse.egg-info/dependency_links.txt
+-rw-r--r--   0 runner    (1001) docker     (121)       60 2021-12-06 13:53:10.000000 Resiliparse-0.9.0/Resiliparse.egg-info/entry_points.txt
+-rw-r--r--   0 runner    (1001) docker     (121)       34 2021-12-06 13:53:10.000000 Resiliparse-0.9.0/Resiliparse.egg-info/requires.txt
+-rw-r--r--   0 runner    (1001) docker     (121)       47 2021-12-06 13:53:10.000000 Resiliparse-0.9.0/Resiliparse.egg-info/top_level.txt
+-rw-r--r--   0 runner    (1001) docker     (121)      153 2021-12-06 13:52:44.000000 Resiliparse-0.9.0/pyproject.toml
+drwxr-xr-x   0 runner    (1001) docker     (121)        0 2021-12-06 13:53:10.669151 Resiliparse-0.9.0/resiliparse/
+-rw-r--r--   0 runner    (1001) docker     (121)      580 2021-12-06 13:52:44.000000 Resiliparse-0.9.0/resiliparse/__init__.pxd
+-rw-r--r--   0 runner    (1001) docker     (121)      580 2021-12-06 13:52:44.000000 Resiliparse-0.9.0/resiliparse/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (121)    25151 2021-12-06 13:52:44.000000 Resiliparse-0.9.0/resiliparse/cli.py
+drwxr-xr-x   0 runner    (1001) docker     (121)        0 2021-12-06 13:53:10.669151 Resiliparse-0.9.0/resiliparse/extract/
+-rw-r--r--   0 runner    (1001) docker     (121)      580 2021-12-06 13:52:44.000000 Resiliparse-0.9.0/resiliparse/extract/__init__.pxd
+-rw-r--r--   0 runner    (1001) docker     (121)      580 2021-12-06 13:52:44.000000 Resiliparse-0.9.0/resiliparse/extract/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (121)   547959 2021-12-06 13:53:06.000000 Resiliparse-0.9.0/resiliparse/extract/html2text.cpp
+-rw-r--r--   0 runner    (1001) docker     (121)      580 2021-12-06 13:52:44.000000 Resiliparse-0.9.0/resiliparse/extract/html2text.pxd
+-rw-r--r--   0 runner    (1001) docker     (121)    25278 2021-12-06 13:52:44.000000 Resiliparse-0.9.0/resiliparse/extract/html2text.pyx
+-rw-r--r--   0 runner    (1001) docker     (121)   385125 2021-12-06 13:53:06.000000 Resiliparse-0.9.0/resiliparse/itertools.cpp
+-rw-r--r--   0 runner    (1001) docker     (121)      580 2021-12-06 13:52:44.000000 Resiliparse-0.9.0/resiliparse/itertools.pxd
+-rw-r--r--   0 runner    (1001) docker     (121)     6737 2021-12-06 13:52:44.000000 Resiliparse-0.9.0/resiliparse/itertools.pyx
+drwxr-xr-x   0 runner    (1001) docker     (121)        0 2021-12-06 13:53:10.673151 Resiliparse-0.9.0/resiliparse/parse/
+-rw-r--r--   0 runner    (1001) docker     (121)      580 2021-12-06 13:52:44.000000 Resiliparse-0.9.0/resiliparse/parse/__init__.pxd
+-rw-r--r--   0 runner    (1001) docker     (121)      781 2021-12-06 13:52:44.000000 Resiliparse-0.9.0/resiliparse/parse/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (121)   447340 2021-12-06 13:53:07.000000 Resiliparse-0.9.0/resiliparse/parse/encoding.cpp
+-rw-r--r--   0 runner    (1001) docker     (121)     4917 2021-12-06 13:52:44.000000 Resiliparse-0.9.0/resiliparse/parse/encoding.h
+-rw-r--r--   0 runner    (1001) docker     (121)     1296 2021-12-06 13:52:44.000000 Resiliparse-0.9.0/resiliparse/parse/encoding.pxd
+-rw-r--r--   0 runner    (1001) docker     (121)    21600 2021-12-06 13:52:44.000000 Resiliparse-0.9.0/resiliparse/parse/encoding.pyx
+-rw-r--r--   0 runner    (1001) docker     (121)  1511057 2021-12-06 13:53:08.000000 Resiliparse-0.9.0/resiliparse/parse/html.cpp
+-rw-r--r--   0 runner    (1001) docker     (121)     1490 2021-12-06 13:52:44.000000 Resiliparse-0.9.0/resiliparse/parse/html.h
+-rw-r--r--   0 runner    (1001) docker     (121)     7184 2021-12-06 13:52:44.000000 Resiliparse-0.9.0/resiliparse/parse/html.pxd
+-rw-r--r--   0 runner    (1001) docker     (121)    64691 2021-12-06 13:52:44.000000 Resiliparse-0.9.0/resiliparse/parse/html.pyx
+-rw-r--r--   0 runner    (1001) docker     (121)   205594 2021-12-06 13:53:08.000000 Resiliparse-0.9.0/resiliparse/parse/http.cpp
+-rw-r--r--   0 runner    (1001) docker     (121)      617 2021-12-06 13:52:44.000000 Resiliparse-0.9.0/resiliparse/parse/http.pxd
+-rw-r--r--   0 runner    (1001) docker     (121)     1818 2021-12-06 13:52:44.000000 Resiliparse-0.9.0/resiliparse/parse/http.pyx
+-rw-r--r--   0 runner    (1001) docker     (121)   226211 2021-12-06 13:53:08.000000 Resiliparse-0.9.0/resiliparse/parse/lang.cpp
+-rw-r--r--   0 runner    (1001) docker     (121)     2316 2021-12-06 13:52:44.000000 Resiliparse-0.9.0/resiliparse/parse/lang.pxd
+-rw-r--r--   0 runner    (1001) docker     (121)     7010 2021-12-06 13:52:44.000000 Resiliparse-0.9.0/resiliparse/parse/lang.pyx
+-rw-r--r--   0 runner    (1001) docker     (121)    80918 2021-12-06 13:52:44.000000 Resiliparse-0.9.0/resiliparse/parse/lang_profiles.h
+-rw-r--r--   0 runner    (1001) docker     (121)   652324 2021-12-06 13:53:08.000000 Resiliparse-0.9.0/resiliparse/process_guard.cpp
+-rw-r--r--   0 runner    (1001) docker     (121)     1951 2021-12-06 13:52:44.000000 Resiliparse-0.9.0/resiliparse/process_guard.pxd
+-rw-r--r--   0 runner    (1001) docker     (121)    21918 2021-12-06 13:52:44.000000 Resiliparse-0.9.0/resiliparse/process_guard.pyx
+drwxr-xr-x   0 runner    (1001) docker     (121)        0 2021-12-06 13:53:10.673151 Resiliparse-0.9.0/resiliparse_common/
+-rw-r--r--   0 runner    (1001) docker     (121)      580 2021-12-06 13:52:44.000000 Resiliparse-0.9.0/resiliparse_common/__init__.pxd
+-rw-r--r--   0 runner    (1001) docker     (121)     2524 2021-12-06 13:52:44.000000 Resiliparse-0.9.0/resiliparse_common/string_util.pxd
+drwxr-xr-x   0 runner    (1001) docker     (121)        0 2021-12-06 13:53:10.677152 Resiliparse-0.9.0/resiliparse_inc/
+-rw-r--r--   0 runner    (1001) docker     (121)        0 2021-12-06 13:52:44.000000 Resiliparse-0.9.0/resiliparse_inc/__init__.pxd
+-rw-r--r--   0 runner    (1001) docker     (121)      203 2021-12-06 13:52:44.000000 Resiliparse-0.9.0/resiliparse_inc/algorithm.pxd
+-rw-r--r--   0 runner    (1001) docker     (121)      338 2021-12-06 13:52:44.000000 Resiliparse-0.9.0/resiliparse_inc/atomic.pxd
+-rw-r--r--   0 runner    (1001) docker     (121)     4743 2021-12-06 13:52:44.000000 Resiliparse-0.9.0/resiliparse_inc/boost_regex.pxd
+-rw-r--r--   0 runner    (1001) docker     (121)       97 2021-12-06 13:52:44.000000 Resiliparse-0.9.0/resiliparse_inc/cctype.pxd
+-rw-r--r--   0 runner    (1001) docker     (121)      110 2021-12-06 13:52:44.000000 Resiliparse-0.9.0/resiliparse_inc/cstdlib.pxd
+-rw-r--r--   0 runner    (1001) docker     (121)       83 2021-12-06 13:52:44.000000 Resiliparse-0.9.0/resiliparse_inc/cstring.pxd
+-rw-r--r--   0 runner    (1001) docker     (121)      214 2021-12-06 13:52:44.000000 Resiliparse-0.9.0/resiliparse_inc/dlfcn.pxd
+-rw-r--r--   0 runner    (1001) docker     (121)       50 2021-12-06 13:52:44.000000 Resiliparse-0.9.0/resiliparse_inc/errno.pxd
+-rw-r--r--   0 runner    (1001) docker     (121)    31974 2021-12-06 13:52:44.000000 Resiliparse-0.9.0/resiliparse_inc/lexbor.pxd
+-rw-r--r--   0 runner    (1001) docker     (121)     1916 2021-12-06 13:52:44.000000 Resiliparse-0.9.0/resiliparse_inc/lz4frame.pxd
+-rw-r--r--   0 runner    (1001) docker     (121)      168 2021-12-06 13:52:44.000000 Resiliparse-0.9.0/resiliparse_inc/lz4hc.pxd
+-rw-r--r--   0 runner    (1001) docker     (121)      152 2021-12-06 13:52:44.000000 Resiliparse-0.9.0/resiliparse_inc/pthread.pxd
+-rw-r--r--   0 runner    (1001) docker     (121)     7365 2021-12-06 13:52:44.000000 Resiliparse-0.9.0/resiliparse_inc/re2.pxd
+-rw-r--r--   0 runner    (1001) docker     (121)      149 2021-12-06 13:52:44.000000 Resiliparse-0.9.0/resiliparse_inc/stdio.pxd
+-rw-r--r--   0 runner    (1001) docker     (121)     1430 2021-12-06 13:52:44.000000 Resiliparse-0.9.0/resiliparse_inc/string_view.pxd
+-rw-r--r--   0 runner    (1001) docker     (121)      282 2021-12-06 13:52:44.000000 Resiliparse-0.9.0/resiliparse_inc/time.pxd
+-rw-r--r--   0 runner    (1001) docker     (121)      390 2021-12-06 13:52:44.000000 Resiliparse-0.9.0/resiliparse_inc/uchardet.pxd
+-rw-r--r--   0 runner    (1001) docker     (121)      129 2021-12-06 13:52:44.000000 Resiliparse-0.9.0/resiliparse_inc/unistd.pxd
+-rw-r--r--   0 runner    (1001) docker     (121)     1026 2021-12-06 13:52:44.000000 Resiliparse-0.9.0/resiliparse_inc/utility.pxd
+-rw-r--r--   0 runner    (1001) docker     (121)     1189 2021-12-06 13:52:44.000000 Resiliparse-0.9.0/resiliparse_inc/zlib.pxd
+-rw-r--r--   0 runner    (1001) docker     (121)       38 2021-12-06 13:53:10.677152 Resiliparse-0.9.0/setup.cfg
+-rw-r--r--   0 runner    (1001) docker     (121)     5438 2021-12-06 13:52:44.000000 Resiliparse-0.9.0/setup.py
```

### Comparing `Resiliparse-0.8.1/PKG-INFO` & `Resiliparse-0.9.0/PKG-INFO`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: Resiliparse
-Version: 0.8.1
+Version: 0.9.0
 Summary: A collection of robust and fast processing tools for parsing and analyzing (not only) web archive data.
 Home-page: https://github.com/chatnoir-eu/chatnoir-resiliparse
 Author: Janek Bevendorff
 License: Apache License 2.0
 Platform: UNKNOWN
 Description-Content-Type: text/markdown
 Provides-Extra: CLI
```

### Comparing `Resiliparse-0.8.1/README.md` & `Resiliparse-0.9.0/README.md`

 * *Files identical despite different names*

### Comparing `Resiliparse-0.8.1/Resiliparse.egg-info/PKG-INFO` & `Resiliparse-0.9.0/Resiliparse.egg-info/PKG-INFO`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: Resiliparse
-Version: 0.8.1
+Version: 0.9.0
 Summary: A collection of robust and fast processing tools for parsing and analyzing (not only) web archive data.
 Home-page: https://github.com/chatnoir-eu/chatnoir-resiliparse
 Author: Janek Bevendorff
 License: Apache License 2.0
 Platform: UNKNOWN
 Description-Content-Type: text/markdown
 Provides-Extra: CLI
```

### Comparing `Resiliparse-0.8.1/Resiliparse.egg-info/SOURCES.txt` & `Resiliparse-0.9.0/Resiliparse.egg-info/SOURCES.txt`

 * *Files identical despite different names*

### Comparing `Resiliparse-0.8.1/resiliparse/__init__.pxd` & `Resiliparse-0.9.0/resiliparse/__init__.pxd`

 * *Files identical despite different names*

### Comparing `Resiliparse-0.8.1/resiliparse/__init__.py` & `Resiliparse-0.9.0/resiliparse/__init__.py`

 * *Files identical despite different names*

### Comparing `Resiliparse-0.8.1/resiliparse/cli.py` & `Resiliparse-0.9.0/resiliparse/cli.py`

 * *Files identical despite different names*

### Comparing `Resiliparse-0.8.1/resiliparse/extract/__init__.pxd` & `Resiliparse-0.9.0/resiliparse/extract/__init__.pxd`

 * *Files identical despite different names*

### Comparing `Resiliparse-0.8.1/resiliparse/extract/__init__.py` & `Resiliparse-0.9.0/resiliparse/extract/__init__.py`

 * *Files identical despite different names*

### Comparing `Resiliparse-0.8.1/resiliparse/extract/html2text.cpp` & `Resiliparse-0.9.0/resiliparse/extract/html2text.cpp`

 * *Files 5% similar despite different names*

```diff
@@ -1,8 +1,8 @@
-/* Generated by Cython 0.29.24 */
+/* Generated by Cython 0.29.25 */
 
 /* BEGIN: Cython Metadata
 {
     "distutils": {
         "depends": [
             "resiliparse/parse/html.h"
         ],
@@ -40,16 +40,16 @@
 #endif /* PY_SSIZE_T_CLEAN */
 #include "Python.h"
 #ifndef Py_PYTHON_H
     #error Python headers needed to compile C extensions, please install development version of Python.
 #elif PY_VERSION_HEX < 0x02060000 || (0x03000000 <= PY_VERSION_HEX && PY_VERSION_HEX < 0x03030000)
     #error Cython requires Python 2.6+ or Python 3.3+.
 #else
-#define CYTHON_ABI "0_29_24"
-#define CYTHON_HEX_VERSION 0x001D18F0
+#define CYTHON_ABI "0_29_25"
+#define CYTHON_HEX_VERSION 0x001D19F0
 #define CYTHON_FUTURE_DIVISION 1
 #include <stddef.h>
 #ifndef offsetof
   #define offsetof(type, member) ( (size_t) & ((type*)0) -> member )
 #endif
 #if !defined(WIN32) && !defined(MS_WINDOWS)
   #ifndef __stdcall
@@ -188,15 +188,15 @@
   #endif
   #ifndef CYTHON_USE_PYLIST_INTERNALS
     #define CYTHON_USE_PYLIST_INTERNALS 1
   #endif
   #ifndef CYTHON_USE_UNICODE_INTERNALS
     #define CYTHON_USE_UNICODE_INTERNALS 1
   #endif
-  #if PY_VERSION_HEX < 0x030300F0
+  #if PY_VERSION_HEX < 0x030300F0 || PY_VERSION_HEX >= 0x030B00A2
     #undef CYTHON_USE_UNICODE_WRITER
     #define CYTHON_USE_UNICODE_WRITER 0
   #elif !defined(CYTHON_USE_UNICODE_WRITER)
     #define CYTHON_USE_UNICODE_WRITER 1
   #endif
   #ifndef CYTHON_AVOID_BORROWED_REFS
     #define CYTHON_AVOID_BORROWED_REFS 0
@@ -207,15 +207,15 @@
   #ifndef CYTHON_UNPACK_METHODS
     #define CYTHON_UNPACK_METHODS 1
   #endif
   #ifndef CYTHON_FAST_THREAD_STATE
     #define CYTHON_FAST_THREAD_STATE 1
   #endif
   #ifndef CYTHON_FAST_PYCALL
-    #define CYTHON_FAST_PYCALL 1
+    #define CYTHON_FAST_PYCALL (PY_VERSION_HEX < 0x030B00A1)
   #endif
   #ifndef CYTHON_PEP489_MULTI_PHASE_INIT
     #define CYTHON_PEP489_MULTI_PHASE_INIT (PY_VERSION_HEX >= 0x03050000)
   #endif
   #ifndef CYTHON_USE_TP_FINALIZE
     #define CYTHON_USE_TP_FINALIZE (PY_VERSION_HEX >= 0x030400a1)
   #endif
@@ -226,15 +226,17 @@
     #define CYTHON_USE_EXC_INFO_STACK (PY_VERSION_HEX >= 0x030700A3)
   #endif
 #endif
 #if !defined(CYTHON_FAST_PYCCALL)
 #define CYTHON_FAST_PYCCALL  (CYTHON_FAST_PYCALL && PY_VERSION_HEX >= 0x030600B1)
 #endif
 #if CYTHON_USE_PYLONG_INTERNALS
-  #include "longintrepr.h"
+  #if PY_MAJOR_VERSION < 3
+    #include "longintrepr.h"
+  #endif
   #undef SHIFT
   #undef BASE
   #undef MASK
   #ifdef SIZEOF_VOID_P
     enum { __pyx_check_sizeof_voidp = 1 / (int)(SIZEOF_VOID_P == sizeof(void*)) };
   #endif
 #endif
@@ -357,17 +359,76 @@
 #if PY_MAJOR_VERSION < 3
   #define __Pyx_BUILTIN_MODULE_NAME "__builtin__"
   #define __Pyx_PyCode_New(a, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)\
           PyCode_New(a+k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)
   #define __Pyx_DefaultClassType PyClass_Type
 #else
   #define __Pyx_BUILTIN_MODULE_NAME "builtins"
-#if PY_VERSION_HEX >= 0x030800A4 && PY_VERSION_HEX < 0x030800B2
-  #define __Pyx_PyCode_New(a, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)\
-          PyCode_New(a, 0, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)
+  #define __Pyx_DefaultClassType PyType_Type
+#if PY_VERSION_HEX >= 0x030B00A1
+    static CYTHON_INLINE PyCodeObject* __Pyx_PyCode_New(int a, int k, int l, int s, int f,
+                                                    PyObject *code, PyObject *c, PyObject* n, PyObject *v,
+                                                    PyObject *fv, PyObject *cell, PyObject* fn,
+                                                    PyObject *name, int fline, PyObject *lnos) {
+        PyObject *kwds=NULL, *argcount=NULL, *posonlyargcount=NULL, *kwonlyargcount=NULL;
+        PyObject *nlocals=NULL, *stacksize=NULL, *flags=NULL, *replace=NULL, *call_result=NULL, *empty=NULL;
+        const char *fn_cstr=NULL;
+        const char *name_cstr=NULL;
+        PyCodeObject* co=NULL;
+        PyObject *type, *value, *traceback;
+        PyErr_Fetch(&type, &value, &traceback);
+        if (!(kwds=PyDict_New())) goto end;
+        if (!(argcount=PyLong_FromLong(a))) goto end;
+        if (PyDict_SetItemString(kwds, "co_argcount", argcount) != 0) goto end;
+        if (!(posonlyargcount=PyLong_FromLong(0))) goto end;
+        if (PyDict_SetItemString(kwds, "co_posonlyargcount", posonlyargcount) != 0) goto end;
+        if (!(kwonlyargcount=PyLong_FromLong(k))) goto end;
+        if (PyDict_SetItemString(kwds, "co_kwonlyargcount", kwonlyargcount) != 0) goto end;
+        if (!(nlocals=PyLong_FromLong(l))) goto end;
+        if (PyDict_SetItemString(kwds, "co_nlocals", nlocals) != 0) goto end;
+        if (!(stacksize=PyLong_FromLong(s))) goto end;
+        if (PyDict_SetItemString(kwds, "co_stacksize", stacksize) != 0) goto end;
+        if (!(flags=PyLong_FromLong(f))) goto end;
+        if (PyDict_SetItemString(kwds, "co_flags", flags) != 0) goto end;
+        if (PyDict_SetItemString(kwds, "co_code", code) != 0) goto end;
+        if (PyDict_SetItemString(kwds, "co_consts", c) != 0) goto end;
+        if (PyDict_SetItemString(kwds, "co_names", n) != 0) goto end;
+        if (PyDict_SetItemString(kwds, "co_varnames", v) != 0) goto end;
+        if (PyDict_SetItemString(kwds, "co_freevars", fv) != 0) goto end;
+        if (PyDict_SetItemString(kwds, "co_cellvars", cell) != 0) goto end;
+        if (PyDict_SetItemString(kwds, "co_linetable", lnos) != 0) goto end;
+        if (!(fn_cstr=PyUnicode_AsUTF8AndSize(fn, NULL))) goto end;
+        if (!(name_cstr=PyUnicode_AsUTF8AndSize(name, NULL))) goto end;
+        if (!(co = PyCode_NewEmpty(fn_cstr, name_cstr, fline))) goto end;
+        if (!(replace = PyObject_GetAttrString((PyObject*)co, "replace"))) goto cleanup_code_too;
+        if (!(empty = PyTuple_New(0))) goto cleanup_code_too; // unfortunately __pyx_empty_tuple isn't available here
+        if (!(call_result = PyObject_Call(replace, empty, kwds))) goto cleanup_code_too;
+        Py_XDECREF((PyObject*)co);
+        co = (PyCodeObject*)call_result;
+        call_result = NULL;
+        if (0) {
+            cleanup_code_too:
+            Py_XDECREF((PyObject*)co);
+            co = NULL;
+        }
+        end:
+        Py_XDECREF(kwds);
+        Py_XDECREF(argcount);
+        Py_XDECREF(posonlyargcount);
+        Py_XDECREF(kwonlyargcount);
+        Py_XDECREF(nlocals);
+        Py_XDECREF(stacksize);
+        Py_XDECREF(replace);
+        Py_XDECREF(call_result);
+        Py_XDECREF(empty);
+        if (type) {
+            PyErr_Restore(type, value, traceback);
+        }
+        return co;
+    }
 #else
   #define __Pyx_PyCode_New(a, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)\
           PyCode_New(a, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)
 #endif
   #define __Pyx_DefaultClassType PyType_Type
 #endif
 #ifndef Py_TPFLAGS_CHECKTYPES
@@ -597,18 +658,18 @@
   #ifndef PyUnicode_InternFromString
     #define PyUnicode_InternFromString(s) PyUnicode_FromString(s)
   #endif
 #endif
 #if PY_VERSION_HEX < 0x030200A4
   typedef long Py_hash_t;
   #define __Pyx_PyInt_FromHash_t PyInt_FromLong
-  #define __Pyx_PyInt_AsHash_t   PyInt_AsLong
+  #define __Pyx_PyInt_AsHash_t   __Pyx_PyIndex_AsHash_t
 #else
   #define __Pyx_PyInt_FromHash_t PyInt_FromSsize_t
-  #define __Pyx_PyInt_AsHash_t   PyInt_AsSsize_t
+  #define __Pyx_PyInt_AsHash_t   __Pyx_PyIndex_AsSsize_t
 #endif
 #if PY_MAJOR_VERSION >= 3
   #define __Pyx_PyMethod_New(func, self, klass) ((self) ? ((void)(klass), PyMethod_New(func, self)) : __Pyx_NewRef(func))
 #else
   #define __Pyx_PyMethod_New(func, self, klass) PyMethod_New(func, self, klass)
 #endif
 #if CYTHON_USE_ASYNC_SLOTS
@@ -661,34 +722,36 @@
   #endif
 #endif
 
 #define __PYX_HAVE__resiliparse__extract__html2text
 #define __PYX_HAVE_API__resiliparse__extract__html2text
 /* Early includes */
 #include <stdint.h>
-#include <string.h>
-#include <string>
 #include "ios"
 #include "new"
 #include "stdexcept"
 #include "typeinfo"
-#include <vector>
-#include <cctype>
 #include <utility>
 
-    #if __cplusplus > 199711L
+    #if __cplusplus >= 201103L || (defined(_MSC_VER) && _MSC_VER >= 1600)
+    // move should be defined for these versions of MSVC, but __cplusplus isn't set usefully
     #include <type_traits>
 
     namespace cython_std {
     template <typename T> typename std::remove_reference<T>::type&& move(T& t) noexcept { return std::move(t); }
     template <typename T> typename std::remove_reference<T>::type&& move(T&& t) noexcept { return std::move(t); }
     }
 
     #endif
     
+#include <set>
+#include <string.h>
+#include <string>
+#include <vector>
+#include <cctype>
 #include <map>
 #include <string_view>
 #include <re2/stringpiece.h>
 #include <re2/re2.h>
 
     class RE2Stack {
     public:
@@ -841,14 +904,15 @@
 static CYTHON_INLINE int __Pyx_PyObject_IsTrue(PyObject*);
 static CYTHON_INLINE int __Pyx_PyObject_IsTrueAndDecref(PyObject*);
 static CYTHON_INLINE PyObject* __Pyx_PyNumber_IntOrLong(PyObject* x);
 #define __Pyx_PySequence_Tuple(obj)\
     (likely(PyTuple_CheckExact(obj)) ? __Pyx_NewRef(obj) : PySequence_Tuple(obj))
 static CYTHON_INLINE Py_ssize_t __Pyx_PyIndex_AsSsize_t(PyObject*);
 static CYTHON_INLINE PyObject * __Pyx_PyInt_FromSize_t(size_t);
+static CYTHON_INLINE Py_hash_t __Pyx_PyIndex_AsHash_t(PyObject*);
 #if CYTHON_ASSUME_SAFE_MACROS
 #define __pyx_PyFloat_AsDouble(x) (PyFloat_CheckExact(x) ? PyFloat_AS_DOUBLE(x) : PyFloat_AsDouble(x))
 #else
 #define __pyx_PyFloat_AsDouble(x) PyFloat_AsDouble(x)
 #endif
 #define __pyx_PyFloat_AsFloat(x) ((float) __pyx_PyFloat_AsDouble(x))
 #if PY_MAJOR_VERSION >= 3
@@ -994,15 +1058,15 @@
 struct __pyx_opt_args_11resiliparse_5parse_4html_7DOMNode_get_elements_by_attr;
 struct __pyx_opt_args_11resiliparse_5parse_4html_7DOMNode_get_elements_by_class_name;
 struct __pyx_opt_args_11resiliparse_5parse_4html_13DOMCollection_get_element_by_id;
 struct __pyx_opt_args_11resiliparse_5parse_4html_13DOMCollection_get_elements_by_attr;
 struct __pyx_opt_args_11resiliparse_5parse_4html_13DOMCollection_get_elements_by_class_name;
 struct __pyx_opt_args_11resiliparse_5parse_4html_create_html_tree;
 
-/* "resiliparse/parse/html.pxd":123
+/* "resiliparse/parse/html.pxd":131
  * 
  * # noinspection DuplicatedCode
  * cpdef enum NodeType:             # <<<<<<<<<<<<<<
  *     ELEMENT = 0x01,
  *     ATTRIBUTE = 0x02,
  */
 enum __pyx_t_11resiliparse_5parse_4html_NodeType {
@@ -1017,186 +1081,186 @@
   __pyx_e_11resiliparse_5parse_4html_DOCUMENT = 0x09,
   __pyx_e_11resiliparse_5parse_4html_DOCUMENT_TYPE = 0x0A,
   __pyx_e_11resiliparse_5parse_4html_DOCUMENT_FRAGMENT = 0x0B,
   __pyx_e_11resiliparse_5parse_4html_NOTATION = 0x0C,
   __pyx_e_11resiliparse_5parse_4html_LAST_ENTRY = 0x0D
 };
 
-/* "resiliparse/parse/html.pxd":26
- * 
+/* "resiliparse/parse/html.pxd":33
+ *                                                   size_t selector_len) except NULL
  * 
  * cdef lxb_dom_node_t* next_node(const lxb_dom_node_t* root_node, lxb_dom_node_t* node,             # <<<<<<<<<<<<<<
  *                                size_t* depth=*, bint* end_tag=*) nogil
  * 
  */
 struct __pyx_opt_args_11resiliparse_5parse_4html_next_node {
   int __pyx_n;
   size_t *depth;
   int *end_tag;
 };
 
-/* "resiliparse/parse/html.pxd":29
+/* "resiliparse/parse/html.pxd":36
  *                                size_t* depth=*, bint* end_tag=*) nogil
  * 
  * cdef inline lxb_dom_node_t* next_element_node(const lxb_dom_node_t* root_node, lxb_dom_node_t* node,             # <<<<<<<<<<<<<<
  *                                               size_t* depth=NULL, bint* end_tag=NULL) nogil:
  *     node = next_node(root_node, node, depth, end_tag)
  */
 struct __pyx_opt_args_11resiliparse_5parse_4html_next_element_node {
   int __pyx_n;
   size_t *depth;
   int *end_tag;
 };
 
-/* "resiliparse/parse/html.pxd":52
+/* "resiliparse/parse/html.pxd":59
  * cdef string get_node_text(lxb_dom_node_t* node) nogil
  * 
  * cdef lxb_dom_node_t* get_element_by_id_impl(lxb_dom_node_t* node, bytes id_value, bint case_insensitive=*)             # <<<<<<<<<<<<<<
  * cdef lxb_dom_collection_t* get_elements_by_attr_impl(lxb_dom_node_t* node, bytes attr_name, bytes attr_value,
  *                                                      size_t init_size=*, bint case_insensitive=*)
  */
 struct __pyx_opt_args_11resiliparse_5parse_4html_get_element_by_id_impl {
   int __pyx_n;
   int case_insensitive;
 };
 
-/* "resiliparse/parse/html.pxd":53
+/* "resiliparse/parse/html.pxd":60
  * 
  * cdef lxb_dom_node_t* get_element_by_id_impl(lxb_dom_node_t* node, bytes id_value, bint case_insensitive=*)
  * cdef lxb_dom_collection_t* get_elements_by_attr_impl(lxb_dom_node_t* node, bytes attr_name, bytes attr_value,             # <<<<<<<<<<<<<<
  *                                                      size_t init_size=*, bint case_insensitive=*)
  * cdef lxb_dom_collection_t* get_elements_by_class_name_impl(lxb_dom_node_t* node, bytes class_name, size_t init_size=*)
  */
 struct __pyx_opt_args_11resiliparse_5parse_4html_get_elements_by_attr_impl {
   int __pyx_n;
   size_t init_size;
   int case_insensitive;
 };
 
-/* "resiliparse/parse/html.pxd":55
+/* "resiliparse/parse/html.pxd":62
  * cdef lxb_dom_collection_t* get_elements_by_attr_impl(lxb_dom_node_t* node, bytes attr_name, bytes attr_value,
  *                                                      size_t init_size=*, bint case_insensitive=*)
  * cdef lxb_dom_collection_t* get_elements_by_class_name_impl(lxb_dom_node_t* node, bytes class_name, size_t init_size=*)             # <<<<<<<<<<<<<<
  * cdef lxb_dom_collection_t* get_elements_by_tag_name_impl(lxb_dom_node_t* node, bytes tag_name)
- * cdef lxb_dom_node_t* query_selector_impl(lxb_dom_node_t* node, HTMLTree tree, bytes selector)
+ * cdef lxb_dom_node_t* query_selector_impl(lxb_dom_node_t* node, HTMLTree tree,
  */
 struct __pyx_opt_args_11resiliparse_5parse_4html_get_elements_by_class_name_impl {
   int __pyx_n;
   size_t init_size;
 };
 
-/* "resiliparse/parse/html.pxd":58
- * cdef lxb_dom_collection_t* get_elements_by_tag_name_impl(lxb_dom_node_t* node, bytes tag_name)
- * cdef lxb_dom_node_t* query_selector_impl(lxb_dom_node_t* node, HTMLTree tree, bytes selector)
+/* "resiliparse/parse/html.pxd":66
+ * cdef lxb_dom_node_t* query_selector_impl(lxb_dom_node_t* node, HTMLTree tree,
+ *                                          bytes selector) except <lxb_dom_node_t*>-1
  * cdef lxb_dom_collection_t* query_selector_all_impl(lxb_dom_node_t* node, HTMLTree tree, bytes selector,             # <<<<<<<<<<<<<<
- *                                                    size_t init_size=*)
+ *                                                    size_t init_size=*) except <lxb_dom_collection_t*>-1
  * cdef bint matches_impl(lxb_dom_node_t* node, HTMLTree tree, bytes selector)
  */
 struct __pyx_opt_args_11resiliparse_5parse_4html_query_selector_all_impl {
   int __pyx_n;
   size_t init_size;
 };
 
-/* "resiliparse/parse/html.pxd":82
+/* "resiliparse/parse/html.pxd":90
  * 
  *     cpdef bint hasattr(self, str attr_name) except -1
  *     cdef str _getattr_impl(self, const string& attr_name, bint raise_if_not_exists=*)             # <<<<<<<<<<<<<<
  *     cpdef str getattr(self, str attr_name, str default_value=*)
  *     cdef bint _setattr_impl(self, bytes attr_name, bytes attr_value)  except -1
  */
 struct __pyx_opt_args_11resiliparse_5parse_4html_7DOMNode__getattr_impl {
   int __pyx_n;
   int raise_if_not_exists;
 };
 
-/* "resiliparse/parse/html.pxd":83
+/* "resiliparse/parse/html.pxd":91
  *     cpdef bint hasattr(self, str attr_name) except -1
  *     cdef str _getattr_impl(self, const string& attr_name, bint raise_if_not_exists=*)
  *     cpdef str getattr(self, str attr_name, str default_value=*)             # <<<<<<<<<<<<<<
  *     cdef bint _setattr_impl(self, bytes attr_name, bytes attr_value)  except -1
  *     cpdef setattr(self, str attr_name, str attr_value)
  */
 struct __pyx_opt_args_11resiliparse_5parse_4html_7DOMNode_getattr {
   int __pyx_n;
   PyObject *default_value;
 };
 
-/* "resiliparse/parse/html.pxd":89
+/* "resiliparse/parse/html.pxd":97
  *     cpdef delattr(self, str attr_name)
  * 
  *     cpdef DOMNode get_element_by_id(self, str element_id, bint case_insensitive=*)             # <<<<<<<<<<<<<<
  *     cpdef DOMCollection get_elements_by_attr(self, str attr_name, str attr_value, bint case_insensitive=*)
  *     cpdef DOMCollection get_elements_by_class_name(self, str class_name, bint case_insensitive=*)
  */
 struct __pyx_opt_args_11resiliparse_5parse_4html_7DOMNode_get_element_by_id {
   int __pyx_n;
   int case_insensitive;
 };
 
-/* "resiliparse/parse/html.pxd":90
+/* "resiliparse/parse/html.pxd":98
  * 
  *     cpdef DOMNode get_element_by_id(self, str element_id, bint case_insensitive=*)
  *     cpdef DOMCollection get_elements_by_attr(self, str attr_name, str attr_value, bint case_insensitive=*)             # <<<<<<<<<<<<<<
  *     cpdef DOMCollection get_elements_by_class_name(self, str class_name, bint case_insensitive=*)
  *     cpdef DOMCollection get_elements_by_tag_name(self, str tag_name)
  */
 struct __pyx_opt_args_11resiliparse_5parse_4html_7DOMNode_get_elements_by_attr {
   int __pyx_n;
   int case_insensitive;
 };
 
-/* "resiliparse/parse/html.pxd":91
+/* "resiliparse/parse/html.pxd":99
  *     cpdef DOMNode get_element_by_id(self, str element_id, bint case_insensitive=*)
  *     cpdef DOMCollection get_elements_by_attr(self, str attr_name, str attr_value, bint case_insensitive=*)
  *     cpdef DOMCollection get_elements_by_class_name(self, str class_name, bint case_insensitive=*)             # <<<<<<<<<<<<<<
  *     cpdef DOMCollection get_elements_by_tag_name(self, str tag_name)
  * 
  */
 struct __pyx_opt_args_11resiliparse_5parse_4html_7DOMNode_get_elements_by_class_name {
   int __pyx_n;
   int case_insensitive;
 };
 
-/* "resiliparse/parse/html.pxd":112
+/* "resiliparse/parse/html.pxd":120
  *     cdef DOMCollection _forward_collection_match(self, bytes func, attrs)
  * 
  *     cpdef DOMNode get_element_by_id(self, str element_id, bint case_insensitive=*)             # <<<<<<<<<<<<<<
  *     cpdef DOMCollection get_elements_by_attr(self, str attr_name, str attr_value, bint case_insensitive=*)
  *     cpdef DOMCollection get_elements_by_class_name(self, str class_name, bint case_insensitive=*)
  */
 struct __pyx_opt_args_11resiliparse_5parse_4html_13DOMCollection_get_element_by_id {
   int __pyx_n;
   int case_insensitive;
 };
 
-/* "resiliparse/parse/html.pxd":113
+/* "resiliparse/parse/html.pxd":121
  * 
  *     cpdef DOMNode get_element_by_id(self, str element_id, bint case_insensitive=*)
  *     cpdef DOMCollection get_elements_by_attr(self, str attr_name, str attr_value, bint case_insensitive=*)             # <<<<<<<<<<<<<<
  *     cpdef DOMCollection get_elements_by_class_name(self, str class_name, bint case_insensitive=*)
  *     cpdef DOMCollection get_elements_by_tag_name(self, str tag_name)
  */
 struct __pyx_opt_args_11resiliparse_5parse_4html_13DOMCollection_get_elements_by_attr {
   int __pyx_n;
   int case_insensitive;
 };
 
-/* "resiliparse/parse/html.pxd":114
+/* "resiliparse/parse/html.pxd":122
  *     cpdef DOMNode get_element_by_id(self, str element_id, bint case_insensitive=*)
  *     cpdef DOMCollection get_elements_by_attr(self, str attr_name, str attr_value, bint case_insensitive=*)
  *     cpdef DOMCollection get_elements_by_class_name(self, str class_name, bint case_insensitive=*)             # <<<<<<<<<<<<<<
  *     cpdef DOMCollection get_elements_by_tag_name(self, str tag_name)
  * 
  */
 struct __pyx_opt_args_11resiliparse_5parse_4html_13DOMCollection_get_elements_by_class_name {
   int __pyx_n;
   int case_insensitive;
 };
 
-/* "resiliparse/parse/html.pxd":139
+/* "resiliparse/parse/html.pxd":147
  * 
  * 
  * cdef HTMLTree create_html_tree(bytes document, bint reencode=*, str encoding=*, str errors=*)             # <<<<<<<<<<<<<<
  * 
  * cdef class HTMLTree:
  */
 struct __pyx_opt_args_11resiliparse_5parse_4html_create_html_tree {
@@ -1204,15 +1268,15 @@
   int reencode;
   PyObject *encoding;
   PyObject *errors;
 };
 struct __pyx_t_11resiliparse_7extract_9html2text_ExtractOpts;
 struct __pyx_t_11resiliparse_7extract_9html2text_ExtractContext;
 
-/* "resiliparse/extract/html2text.pyx":31
+/* "resiliparse/extract/html2text.pyx":32
  * 
  * 
  * cdef struct ExtractOpts:             # <<<<<<<<<<<<<<
  *     bint preserve_formatting
  *     bint list_bullets
  */
 struct __pyx_t_11resiliparse_7extract_9html2text_ExtractOpts {
@@ -1220,15 +1284,15 @@
   int list_bullets;
   int links;
   int alt_texts;
   int form_fields;
   int noscript;
 };
 
-/* "resiliparse/extract/html2text.pyx":40
+/* "resiliparse/extract/html2text.pyx":41
  * 
  * 
  * cdef struct ExtractContext:             # <<<<<<<<<<<<<<
  *     lxb_dom_node_t* root_node
  *     lxb_dom_node_t* node
  */
 struct __pyx_t_11resiliparse_7extract_9html2text_ExtractContext {
@@ -1236,34 +1300,35 @@
   lxb_dom_node_t *node;
   size_t depth;
   size_t list_depth;
   size_t pre_depth;
   std::vector<size_t>  list_numbering;
   size_t space_before_next_block;
   size_t newline_before_next_block;
+  size_t tab_before_next_block;
   size_t lstrip_next_block;
   std::vector<std::string>  text;
   struct __pyx_t_11resiliparse_7extract_9html2text_ExtractOpts opts;
 };
 
-/* "resiliparse/parse/html.pxd":67
+/* "resiliparse/parse/html.pxd":75
  * 
  * 
  * cdef class DOMElementClassList:             # <<<<<<<<<<<<<<
  *     cdef DOMNode node
  * 
  */
 struct __pyx_obj_11resiliparse_5parse_4html_DOMElementClassList {
   PyObject_HEAD
   struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMElementClassList *__pyx_vtab;
   struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *node;
 };
 
 
-/* "resiliparse/parse/html.pxd":76
+/* "resiliparse/parse/html.pxd":84
  * 
  * 
  * cdef class DOMNode:             # <<<<<<<<<<<<<<
  *     cdef HTMLTree tree
  *     cdef lxb_dom_node_t* node
  */
 struct __pyx_obj_11resiliparse_5parse_4html_DOMNode {
@@ -1271,30 +1336,30 @@
   struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMNode *__pyx_vtab;
   struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *tree;
   lxb_dom_node_t *node;
   struct __pyx_obj_11resiliparse_5parse_4html_DOMElementClassList *class_list_singleton;
 };
 
 
-/* "resiliparse/parse/html.pxd":105
+/* "resiliparse/parse/html.pxd":113
  * 
  * 
  * cdef class DOMCollection:             # <<<<<<<<<<<<<<
  *     cdef HTMLTree tree
  *     cdef lxb_dom_collection_t* coll
  */
 struct __pyx_obj_11resiliparse_5parse_4html_DOMCollection {
   PyObject_HEAD
   struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMCollection *__pyx_vtab;
   struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *tree;
   lxb_dom_collection_t *coll;
 };
 
 
-/* "resiliparse/parse/html.pxd":141
+/* "resiliparse/parse/html.pxd":149
  * cdef HTMLTree create_html_tree(bytes document, bint reencode=*, str encoding=*, str errors=*)
  * 
  * cdef class HTMLTree:             # <<<<<<<<<<<<<<
  *     cdef lxb_html_document_t* dom_document
  *     cdef str encoding
  */
 struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree {
@@ -1304,41 +1369,41 @@
   PyObject *encoding;
   lxb_css_parser_t *css_parser;
   lxb_selectors_t *selectors;
   lxb_css_selectors_t *css_selectors;
 };
 
 
-/* "resiliparse/extract/html2text.pyx":501
+/* "resiliparse/extract/html2text.pyx":516
  * 
  * 
- * def extract_plain_text(DOMNode base_node, bint preserve_formatting=True, bint main_content=False, bint list_bullets=True,             # <<<<<<<<<<<<<<
- *                        bint alt_texts=True, bint links=False, bint form_fields=False, bint noscript=False,
- *                        skip_elements=None):
+ * def extract_plain_text(DOMNode base_node, bint preserve_formatting=True, bint main_content=False,             # <<<<<<<<<<<<<<
+ *                        bint list_bullets=True,  bint alt_texts=True, bint links=False, bint form_fields=False,
+ *                        bint noscript=False, skip_elements=None):
  */
 struct __pyx_obj_11resiliparse_7extract_9html2text___pyx_scope_struct__extract_plain_text {
   PyObject_HEAD
   struct __pyx_t_11resiliparse_7extract_9html2text_ExtractContext __pyx_v_ctx;
 };
 
 
-/* "resiliparse/extract/html2text.pyx":613
+/* "resiliparse/extract/html2text.pyx":642
  *             ctx.node = next_node(ctx.root_node, ctx.node, &ctx.depth, &is_end_tag)
  * 
  *     return ''.join(s.decode() for s in ctx.text).rstrip()             # <<<<<<<<<<<<<<
  */
 struct __pyx_obj_11resiliparse_7extract_9html2text___pyx_scope_struct_1_genexpr {
   PyObject_HEAD
   struct __pyx_obj_11resiliparse_7extract_9html2text___pyx_scope_struct__extract_plain_text *__pyx_outer_scope;
   std::string __pyx_v_s;
 };
 
 
 
-/* "resiliparse/parse/html.pxd":67
+/* "resiliparse/parse/html.pxd":75
  * 
  * 
  * cdef class DOMElementClassList:             # <<<<<<<<<<<<<<
  *     cdef DOMNode node
  * 
  */
 
@@ -1347,15 +1412,15 @@
   PyObject *(*_class_name_bytes)(struct __pyx_obj_11resiliparse_5parse_4html_DOMElementClassList *);
   void (*add)(struct __pyx_obj_11resiliparse_5parse_4html_DOMElementClassList *, PyObject *, int __pyx_skip_dispatch);
   void (*remove)(struct __pyx_obj_11resiliparse_5parse_4html_DOMElementClassList *, PyObject *, int __pyx_skip_dispatch);
 };
 static struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMElementClassList *__pyx_vtabptr_11resiliparse_5parse_4html_DOMElementClassList;
 
 
-/* "resiliparse/parse/html.pxd":76
+/* "resiliparse/parse/html.pxd":84
  * 
  * 
  * cdef class DOMNode:             # <<<<<<<<<<<<<<
  *     cdef HTMLTree tree
  *     cdef lxb_dom_node_t* node
  */
 
@@ -1379,15 +1444,15 @@
   struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *(*replace_child)(struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *, struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *, struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *, int __pyx_skip_dispatch);
   struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *(*remove_child)(struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *, struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *, int __pyx_skip_dispatch);
   PyObject *(*decompose)(struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *, int __pyx_skip_dispatch);
 };
 static struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMNode *__pyx_vtabptr_11resiliparse_5parse_4html_DOMNode;
 
 
-/* "resiliparse/parse/html.pxd":105
+/* "resiliparse/parse/html.pxd":113
  * 
  * 
  * cdef class DOMCollection:             # <<<<<<<<<<<<<<
  *     cdef HTMLTree tree
  *     cdef lxb_dom_collection_t* coll
  */
 
@@ -1401,15 +1466,15 @@
   struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *(*query_selector)(struct __pyx_obj_11resiliparse_5parse_4html_DOMCollection *, PyObject *, int __pyx_skip_dispatch);
   struct __pyx_obj_11resiliparse_5parse_4html_DOMCollection *(*query_selector_all)(struct __pyx_obj_11resiliparse_5parse_4html_DOMCollection *, PyObject *, int __pyx_skip_dispatch);
   int (*matches)(struct __pyx_obj_11resiliparse_5parse_4html_DOMCollection *, PyObject *, int __pyx_skip_dispatch);
 };
 static struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMCollection *__pyx_vtabptr_11resiliparse_5parse_4html_DOMCollection;
 
 
-/* "resiliparse/parse/html.pxd":141
+/* "resiliparse/parse/html.pxd":149
  * cdef HTMLTree create_html_tree(bytes document, bint reencode=*, str encoding=*, str errors=*)
  * 
  * cdef class HTMLTree:             # <<<<<<<<<<<<<<
  *     cdef lxb_html_document_t* dom_document
  *     cdef str encoding
  */
 
@@ -1612,21 +1677,23 @@
 #define __Pyx_PyFunction_FastCallDict(func, args, nargs, kwargs) _PyFunction_FastCallDict(func, args, nargs, kwargs)
 #endif
 #define __Pyx_BUILD_ASSERT_EXPR(cond)\
     (sizeof(char [1 - 2*!(cond)]) - 1)
 #ifndef Py_MEMBER_SIZE
 #define Py_MEMBER_SIZE(type, member) sizeof(((type *)0)->member)
 #endif
+#if CYTHON_FAST_PYCALL
   static size_t __pyx_pyframe_localsplus_offset = 0;
   #include "frameobject.h"
   #define __Pxy_PyFrame_Initialize_Offsets()\
     ((void)__Pyx_BUILD_ASSERT_EXPR(sizeof(PyFrameObject) == offsetof(PyFrameObject, f_localsplus) + Py_MEMBER_SIZE(PyFrameObject, f_localsplus)),\
      (void)(__pyx_pyframe_localsplus_offset = ((size_t)PyFrame_Type.tp_basicsize) - Py_MEMBER_SIZE(PyFrameObject, f_localsplus)))
   #define __Pyx_PyFrame_GetLocalsplus(frame)\
     (assert(__pyx_pyframe_localsplus_offset), (PyObject **)(((char *)(frame)) + __pyx_pyframe_localsplus_offset))
+#endif // CYTHON_FAST_PYCALL
 #endif
 
 /* PyObjectCall.proto */
 #if CYTHON_COMPILING_IN_CPYTHON
 static CYTHON_INLINE PyObject* __Pyx_PyObject_Call(PyObject *func, PyObject *arg, PyObject *kw);
 #else
 #define __Pyx_PyObject_Call(func, arg, kw) PyObject_Call(func, arg, kw)
@@ -1650,16 +1717,80 @@
 #else
 #define __Pyx_PyCFunction_FastCall(func, args, nargs)  (assert(0), NULL)
 #endif
 
 /* PyObjectCallOneArg.proto */
 static CYTHON_INLINE PyObject* __Pyx_PyObject_CallOneArg(PyObject *func, PyObject *arg);
 
-/* PyObjectCall2Args.proto */
-static CYTHON_UNUSED PyObject* __Pyx_PyObject_Call2Args(PyObject* function, PyObject* arg1, PyObject* arg2);
+/* UnpackUnboundCMethod.proto */
+typedef struct {
+    PyObject *type;
+    PyObject **method_name;
+    PyCFunction func;
+    PyObject *method;
+    int flag;
+} __Pyx_CachedCFunction;
+
+/* CallUnboundCMethod1.proto */
+static PyObject* __Pyx__CallUnboundCMethod1(__Pyx_CachedCFunction* cfunc, PyObject* self, PyObject* arg);
+#if CYTHON_COMPILING_IN_CPYTHON
+static CYTHON_INLINE PyObject* __Pyx_CallUnboundCMethod1(__Pyx_CachedCFunction* cfunc, PyObject* self, PyObject* arg);
+#else
+#define __Pyx_CallUnboundCMethod1(cfunc, self, arg)  __Pyx__CallUnboundCMethod1(cfunc, self, arg)
+#endif
+
+/* StringJoin.proto */
+#if PY_MAJOR_VERSION < 3
+#define __Pyx_PyString_Join __Pyx_PyBytes_Join
+#define __Pyx_PyBaseString_Join(s, v) (PyUnicode_CheckExact(s) ? PyUnicode_Join(s, v) : __Pyx_PyBytes_Join(s, v))
+#else
+#define __Pyx_PyString_Join PyUnicode_Join
+#define __Pyx_PyBaseString_Join PyUnicode_Join
+#endif
+#if CYTHON_COMPILING_IN_CPYTHON
+    #if PY_MAJOR_VERSION < 3
+    #define __Pyx_PyBytes_Join _PyString_Join
+    #else
+    #define __Pyx_PyBytes_Join _PyBytes_Join
+    #endif
+#else
+static CYTHON_INLINE PyObject* __Pyx_PyBytes_Join(PyObject* sep, PyObject* values);
+#endif
+
+/* GetException.proto */
+#if CYTHON_FAST_THREAD_STATE
+#define __Pyx_GetException(type, value, tb)  __Pyx__GetException(__pyx_tstate, type, value, tb)
+static int __Pyx__GetException(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb);
+#else
+static int __Pyx_GetException(PyObject **type, PyObject **value, PyObject **tb);
+#endif
+
+/* SwapException.proto */
+#if CYTHON_FAST_THREAD_STATE
+#define __Pyx_ExceptionSwap(type, value, tb)  __Pyx__ExceptionSwap(__pyx_tstate, type, value, tb)
+static CYTHON_INLINE void __Pyx__ExceptionSwap(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb);
+#else
+static CYTHON_INLINE void __Pyx_ExceptionSwap(PyObject **type, PyObject **value, PyObject **tb);
+#endif
+
+/* GetTopmostException.proto */
+#if CYTHON_USE_EXC_INFO_STACK
+static _PyErr_StackItem * __Pyx_PyErr_GetTopmostException(PyThreadState *tstate);
+#endif
+
+/* SaveResetException.proto */
+#if CYTHON_FAST_THREAD_STATE
+#define __Pyx_ExceptionSave(type, value, tb)  __Pyx__ExceptionSave(__pyx_tstate, type, value, tb)
+static CYTHON_INLINE void __Pyx__ExceptionSave(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb);
+#define __Pyx_ExceptionReset(type, value, tb)  __Pyx__ExceptionReset(__pyx_tstate, type, value, tb)
+static CYTHON_INLINE void __Pyx__ExceptionReset(PyThreadState *tstate, PyObject *type, PyObject *value, PyObject *tb);
+#else
+#define __Pyx_ExceptionSave(type, value, tb)   PyErr_GetExcInfo(type, value, tb)
+#define __Pyx_ExceptionReset(type, value, tb)  PyErr_SetExcInfo(type, value, tb)
+#endif
 
 /* IncludeStringH.proto */
 #include <string.h>
 
 /* PyObject_GenericGetAttrNoDict.proto */
 #if CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP && PY_VERSION_HEX < 0x03070000
 static CYTHON_INLINE PyObject* __Pyx_PyObject_GenericGetAttrNoDict(PyObject* obj, PyObject* attr_name);
@@ -1816,37 +1947,16 @@
 
 /* FetchCommonType.proto */
 static PyTypeObject* __Pyx_FetchCommonType(PyTypeObject* type);
 
 /* RaiseException.proto */
 static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb, PyObject *cause);
 
-/* GetTopmostException.proto */
-#if CYTHON_USE_EXC_INFO_STACK
-static _PyErr_StackItem * __Pyx_PyErr_GetTopmostException(PyThreadState *tstate);
-#endif
-
-/* SaveResetException.proto */
-#if CYTHON_FAST_THREAD_STATE
-#define __Pyx_ExceptionSave(type, value, tb)  __Pyx__ExceptionSave(__pyx_tstate, type, value, tb)
-static CYTHON_INLINE void __Pyx__ExceptionSave(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb);
-#define __Pyx_ExceptionReset(type, value, tb)  __Pyx__ExceptionReset(__pyx_tstate, type, value, tb)
-static CYTHON_INLINE void __Pyx__ExceptionReset(PyThreadState *tstate, PyObject *type, PyObject *value, PyObject *tb);
-#else
-#define __Pyx_ExceptionSave(type, value, tb)   PyErr_GetExcInfo(type, value, tb)
-#define __Pyx_ExceptionReset(type, value, tb)  PyErr_SetExcInfo(type, value, tb)
-#endif
-
-/* SwapException.proto */
-#if CYTHON_FAST_THREAD_STATE
-#define __Pyx_ExceptionSwap(type, value, tb)  __Pyx__ExceptionSwap(__pyx_tstate, type, value, tb)
-static CYTHON_INLINE void __Pyx__ExceptionSwap(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb);
-#else
-static CYTHON_INLINE void __Pyx_ExceptionSwap(PyObject **type, PyObject **value, PyObject **tb);
-#endif
+/* PyObjectCall2Args.proto */
+static CYTHON_UNUSED PyObject* __Pyx_PyObject_Call2Args(PyObject* function, PyObject* arg1, PyObject* arg2);
 
 /* PyObjectGetMethod.proto */
 static int __Pyx_PyObject_GetMethod(PyObject *obj, PyObject *name, PyObject **method);
 
 /* PyObjectCallMethod1.proto */
 static PyObject* __Pyx_PyObject_CallMethod1(PyObject* obj, PyObject* method_name, PyObject* arg);
 
@@ -1934,14 +2044,18 @@
 
 /* InitStrings.proto */
 static int __Pyx_InitStrings(__Pyx_StringTabEntry *t);
 
 
 /* Module declarations from 'libc.stdint' */
 
+/* Module declarations from 'libcpp.utility' */
+
+/* Module declarations from 'libcpp.set' */
+
 /* Module declarations from 'libc.string' */
 
 /* Module declarations from 'libcpp.string' */
 
 /* Module declarations from 'libcpp.vector' */
 
 /* Module declarations from 'resiliparse_inc.cctype' */
@@ -1949,30 +2063,33 @@
 /* Module declarations from 'resiliparse_common.string_util' */
 static CYTHON_INLINE size_t __pyx_f_18resiliparse_common_11string_util_lstrip_c_str(char const **, size_t); /*proto*/
 static CYTHON_INLINE size_t __pyx_f_18resiliparse_common_11string_util_rstrip_c_str(char const **, size_t); /*proto*/
 static CYTHON_INLINE size_t __pyx_f_18resiliparse_common_11string_util_strip_c_str(char const **, size_t); /*proto*/
 static CYTHON_INLINE std::string __pyx_f_18resiliparse_common_11string_util_rstrip_str(std::string const &); /*proto*/
 static CYTHON_INLINE std::string __pyx_f_18resiliparse_common_11string_util_strip_str(std::string const &); /*proto*/
 
-/* Module declarations from 'libcpp.utility' */
-
 /* Module declarations from 'libcpp.map' */
 
 /* Module declarations from 'resiliparse_inc.string_view' */
 
 /* Module declarations from 'resiliparse_inc.re2' */
 
 /* Module declarations from 'resiliparse_inc.lexbor' */
 
 /* Module declarations from 'resiliparse.parse.html' */
 static PyTypeObject *__pyx_ptype_11resiliparse_5parse_4html_DOMElementClassList = 0;
 static PyTypeObject *__pyx_ptype_11resiliparse_5parse_4html_DOMNode = 0;
 static PyTypeObject *__pyx_ptype_11resiliparse_5parse_4html_DOMCollection = 0;
 static PyTypeObject *__pyx_ptype_11resiliparse_5parse_4html_HTMLTree = 0;
 static CYTHON_INLINE int __pyx_f_11resiliparse_5parse_4html_check_node(struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *); /*proto*/
+static int (*__pyx_f_11resiliparse_5parse_4html_init_css_parser)(lxb_css_parser_t **); /*proto*/
+static void (*__pyx_f_11resiliparse_5parse_4html_destroy_css_parser)(lxb_css_parser_t *); /*proto*/
+static int (*__pyx_f_11resiliparse_5parse_4html_init_css_selectors)(lxb_css_parser_t *, lxb_css_selectors_t **, lxb_selectors_t **); /*proto*/
+static void (*__pyx_f_11resiliparse_5parse_4html_destroy_css_selectors)(lxb_css_selectors_t *, lxb_selectors_t *); /*proto*/
+static lxb_css_selector_list_t *(*__pyx_f_11resiliparse_5parse_4html_parse_css_selectors)(lxb_css_parser_t *, lxb_char_t const *, size_t); /*proto*/
 static lxb_dom_node_t *(*__pyx_f_11resiliparse_5parse_4html_next_node)(lxb_dom_node_t const *, lxb_dom_node_t *, struct __pyx_opt_args_11resiliparse_5parse_4html_next_node *__pyx_optional_args); /*proto*/
 static CYTHON_INLINE lxb_dom_node_t *__pyx_f_11resiliparse_5parse_4html_next_element_node(lxb_dom_node_t const *, lxb_dom_node_t *, struct __pyx_opt_args_11resiliparse_5parse_4html_next_element_node *__pyx_optional_args); /*proto*/
 static CYTHON_INLINE std::string_view __pyx_f_11resiliparse_5parse_4html_get_node_attr_sv(lxb_dom_node_t *, std::string const &); /*proto*/
 static CYTHON_INLINE re2::StringPiece __pyx_f_11resiliparse_5parse_4html_get_node_attr_sp(lxb_dom_node_t *, std::string const &); /*proto*/
 static std::string (*__pyx_f_11resiliparse_5parse_4html_get_node_text)(lxb_dom_node_t *); /*proto*/
 static int (*__pyx_f_11resiliparse_5parse_4html_is_block_element)(lxb_tag_id_t); /*proto*/
 
@@ -1999,38 +2116,37 @@
 static CYTHON_INLINE void __pyx_f_11resiliparse_7extract_9html2text__add_space(struct __pyx_t_11resiliparse_7extract_9html2text_ExtractContext *); /*proto*/
 static CYTHON_INLINE void __pyx_f_11resiliparse_7extract_9html2text__make_block(struct __pyx_t_11resiliparse_7extract_9html2text_ExtractContext *); /*proto*/
 static int __pyx_f_11resiliparse_7extract_9html2text__is_unprintable_pua(lxb_dom_node_t *); /*proto*/
 static void __pyx_f_11resiliparse_7extract_9html2text__extract_start_cb(struct __pyx_t_11resiliparse_7extract_9html2text_ExtractContext *); /*proto*/
 static void __pyx_f_11resiliparse_7extract_9html2text__extract_end_cb(struct __pyx_t_11resiliparse_7extract_9html2text_ExtractContext *); /*proto*/
 static CYTHON_INLINE int __pyx_f_11resiliparse_7extract_9html2text_regex_search_not_empty(re2::StringPiece const &, RE2Stack const &); /*proto*/
 static int __pyx_f_11resiliparse_7extract_9html2text__is_main_content_node(lxb_dom_node_t *); /*proto*/
-static std::string __pyx_convert_string_from_py_std__in_string(PyObject *); /*proto*/
-static std::vector<std::string>  __pyx_convert_vector_from_py_std_3a__3a_string(PyObject *); /*proto*/
+static CYTHON_INLINE lxb_status_t __pyx_f_11resiliparse_7extract_9html2text__blacklist_select_cb(lxb_dom_node_t *, lxb_css_selector_specificity_t *, void *); /*proto*/
 static CYTHON_INLINE PyObject *__pyx_convert_PyObject_string_to_py_std__in_string(std::string const &); /*proto*/
 static CYTHON_INLINE PyObject *__pyx_convert_PyUnicode_string_to_py_std__in_string(std::string const &); /*proto*/
 static CYTHON_INLINE PyObject *__pyx_convert_PyStr_string_to_py_std__in_string(std::string const &); /*proto*/
 static CYTHON_INLINE PyObject *__pyx_convert_PyBytes_string_to_py_std__in_string(std::string const &); /*proto*/
 static CYTHON_INLINE PyObject *__pyx_convert_PyByteArray_string_to_py_std__in_string(std::string const &); /*proto*/
 #define __Pyx_MODULE_NAME "resiliparse.extract.html2text"
 extern int __pyx_module_is_main_resiliparse__extract__html2text;
 int __pyx_module_is_main_resiliparse__extract__html2text = 0;
 
 /* Implementation of 'resiliparse.extract.html2text' */
 static PyObject *__pyx_builtin_range;
 static const char __pyx_k_[] = "";
 static const char __pyx_k_e[] = "e";
 static const char __pyx_k_i[] = "i";
+static const char __pyx_k__2[] = ",";
 static const char __pyx_k_id[] = "id";
-static const char __pyx_k_add[] = "add";
 static const char __pyx_k_alt[] = "alt";
 static const char __pyx_k_ctx[] = "ctx";
 static const char __pyx_k_area[] = "area";
 static const char __pyx_k_args[] = "args";
-static const char __pyx_k_head[] = "head";
 static const char __pyx_k_href[] = "href";
+static const char __pyx_k_join[] = "join";
 static const char __pyx_k_main[] = "__main__";
 static const char __pyx_k_name[] = "__name__";
 static const char __pyx_k_role[] = "role";
 static const char __pyx_k_send[] = "send";
 static const char __pyx_k_skip[] = "skip";
 static const char __pyx_k_test[] = "__test__";
 static const char __pyx_k_type[] = "type";
@@ -2053,90 +2169,103 @@
 static const char __pyx_k_genexpr[] = "genexpr";
 static const char __pyx_k_embedimg[] = "embedimg";
 static const char __pyx_k_noscript[] = "noscript";
 static const char __pyx_k_tag_name[] = "tag_name";
 static const char __pyx_k_textarea[] = "textarea";
 static const char __pyx_k_alt_texts[] = "alt_texts";
 static const char __pyx_k_base_node[] = "base_node";
+static const char __pyx_k_selectors[] = "selectors";
+static const char __pyx_k_css_parser[] = "css_parser";
 static const char __pyx_k_is_end_tag[] = "is_end_tag";
 static const char __pyx_k_pyx_vtable[] = "__pyx_vtable__";
 static const char __pyx_k_aria_hidden[] = "aria-hidden";
 static const char __pyx_k_form_fields[] = "form_fields";
 static const char __pyx_k_placeholder[] = "placeholder";
 static const char __pyx_k_list_bullets[] = "list_bullets";
 static const char __pyx_k_main_content[] = "main_content";
 static const char __pyx_k_tag_name_len[] = "tag_name_len";
 static const char __pyx_k_tag_name_str[] = "tag_name_str";
+static const char __pyx_k_css_selectors[] = "css_selectors";
+static const char __pyx_k_selector_list[] = "selector_list";
 static const char __pyx_k_skip_elements[] = "skip_elements";
-static const char __pyx_k_skip_elements_vec[] = "skip_elements_vec";
+static const char __pyx_k_node_blacklist[] = "node_blacklist";
+static const char __pyx_k_skip_selectors[] = "skip_selectors";
+static const char __pyx_k_combined_skip_sel[] = "combined_skip_sel";
 static const char __pyx_k_cline_in_traceback[] = "cline_in_traceback";
 static const char __pyx_k_extract_plain_text[] = "extract_plain_text";
 static const char __pyx_k_preserve_formatting[] = "preserve_formatting";
 static const char __pyx_k_resiliparse_extract_html2text[] = "resiliparse.extract.html2text";
 static const char __pyx_k_extract_plain_text_locals_genexp[] = "extract_plain_text.<locals>.genexpr";
 static const char __pyx_k_resiliparse_extract_html2text_py[] = "resiliparse/extract/html2text.pyx";
 static PyObject *__pyx_kp_u_;
-static PyObject *__pyx_n_s_add;
+static PyObject *__pyx_kp_b__2;
 static PyObject *__pyx_n_s_alt_texts;
 static PyObject *__pyx_n_b_area;
 static PyObject *__pyx_n_s_args;
 static PyObject *__pyx_n_b_audio;
 static PyObject *__pyx_n_s_base_node;
 static PyObject *__pyx_n_b_button;
 static PyObject *__pyx_n_s_cline_in_traceback;
 static PyObject *__pyx_n_s_close;
+static PyObject *__pyx_n_s_combined_skip_sel;
+static PyObject *__pyx_n_s_css_parser;
+static PyObject *__pyx_n_s_css_selectors;
 static PyObject *__pyx_n_s_ctx;
 static PyObject *__pyx_n_s_e;
 static PyObject *__pyx_n_b_embedimg;
 static PyObject *__pyx_n_s_encode;
 static PyObject *__pyx_n_s_extract_plain_text;
 static PyObject *__pyx_n_s_extract_plain_text_locals_genexp;
 static PyObject *__pyx_n_s_form_fields;
 static PyObject *__pyx_n_s_genexpr;
-static PyObject *__pyx_n_b_head;
 static PyObject *__pyx_n_s_i;
 static PyObject *__pyx_n_b_input;
 static PyObject *__pyx_n_s_is_end_tag;
+static PyObject *__pyx_n_s_join;
 static PyObject *__pyx_n_s_links;
 static PyObject *__pyx_n_s_list_bullets;
 static PyObject *__pyx_n_s_main;
 static PyObject *__pyx_n_s_main_content;
 static PyObject *__pyx_n_s_name;
+static PyObject *__pyx_n_s_node_blacklist;
 static PyObject *__pyx_n_b_noscript;
 static PyObject *__pyx_n_s_noscript;
 static PyObject *__pyx_n_b_object;
 static PyObject *__pyx_n_s_preserve_formatting;
 static PyObject *__pyx_n_s_pyx_vtable;
 static PyObject *__pyx_n_s_range;
 static PyObject *__pyx_n_s_resiliparse_extract_html2text;
 static PyObject *__pyx_kp_s_resiliparse_extract_html2text_py;
 static PyObject *__pyx_n_s_rstrip;
 static PyObject *__pyx_n_b_script;
+static PyObject *__pyx_n_s_selector_list;
+static PyObject *__pyx_n_s_selectors;
 static PyObject *__pyx_n_s_send;
 static PyObject *__pyx_n_s_skip;
 static PyObject *__pyx_n_s_skip_elements;
-static PyObject *__pyx_n_s_skip_elements_vec;
+static PyObject *__pyx_n_s_skip_selectors;
 static PyObject *__pyx_n_b_style;
 static PyObject *__pyx_n_s_tag_name;
 static PyObject *__pyx_n_s_tag_name_len;
 static PyObject *__pyx_n_s_tag_name_str;
 static PyObject *__pyx_n_s_test;
 static PyObject *__pyx_n_b_textarea;
 static PyObject *__pyx_n_s_throw;
 static PyObject *__pyx_n_s_update;
 static PyObject *__pyx_n_b_video;
 static PyObject *__pyx_pf_11resiliparse_7extract_9html2text_18extract_plain_text_genexpr(PyObject *__pyx_self); /* proto */
 static PyObject *__pyx_pf_11resiliparse_7extract_9html2text_extract_plain_text(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *__pyx_v_base_node, int __pyx_v_preserve_formatting, int __pyx_v_main_content, int __pyx_v_list_bullets, int __pyx_v_alt_texts, int __pyx_v_links, int __pyx_v_form_fields, int __pyx_v_noscript, PyObject *__pyx_v_skip_elements); /* proto */
 static PyObject *__pyx_tp_new_11resiliparse_7extract_9html2text___pyx_scope_struct__extract_plain_text(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
 static PyObject *__pyx_tp_new_11resiliparse_7extract_9html2text___pyx_scope_struct_1_genexpr(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
-static PyObject *__pyx_tuple__2;
-static PyObject *__pyx_codeobj__3;
+static __Pyx_CachedCFunction __pyx_umethod_PySet_Type_update = {0, &__pyx_n_s_update, 0, 0, 0};
+static PyObject *__pyx_tuple__3;
+static PyObject *__pyx_codeobj__4;
 /* Late includes */
 
-/* "resiliparse/extract/html2text.pyx":54
+/* "resiliparse/extract/html2text.pyx":56
  * 
  * 
  * cdef string _get_collapsed_string(const string_view& input_str, ExtractContext* ctx) nogil:             # <<<<<<<<<<<<<<
  *     """
  *     Collapse newlines and consecutive white space in a string to single spaces.
  */
 
@@ -2150,25 +2279,25 @@
   size_t __pyx_t_4;
   size_t __pyx_t_5;
   size_t __pyx_t_6;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
 
-  /* "resiliparse/extract/html2text.pyx":59
+  /* "resiliparse/extract/html2text.pyx":61
  *     Takes into account previously extracted text from ``ctx.text``.
  *     """
  *     if input_str.empty():             # <<<<<<<<<<<<<<
  *         return string()
  * 
  */
   __pyx_t_1 = (__pyx_v_input_str.empty() != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/extract/html2text.pyx":60
+    /* "resiliparse/extract/html2text.pyx":62
  *     """
  *     if input_str.empty():
  *         return string()             # <<<<<<<<<<<<<<
  * 
  *     cdef string element_text
  */
     try {
@@ -2177,29 +2306,29 @@
       #ifdef WITH_THREAD
       PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
       #endif
       __Pyx_CppExn2PyErr();
       #ifdef WITH_THREAD
       __Pyx_PyGILState_Release(__pyx_gilstate_save);
       #endif
-      __PYX_ERR(0, 60, __pyx_L1_error)
+      __PYX_ERR(0, 62, __pyx_L1_error)
     }
     __pyx_r = __pyx_t_2;
     goto __pyx_L0;
 
-    /* "resiliparse/extract/html2text.pyx":59
+    /* "resiliparse/extract/html2text.pyx":61
  *     Takes into account previously extracted text from ``ctx.text``.
  *     """
  *     if input_str.empty():             # <<<<<<<<<<<<<<
  *         return string()
  * 
  */
   }
 
-  /* "resiliparse/extract/html2text.pyx":66
+  /* "resiliparse/extract/html2text.pyx":68
  *     # Pre-formatted context, return string as is, but add list indents
  *     cdef size_t i
  *     if ctx.opts.preserve_formatting and ctx.pre_depth > 0:             # <<<<<<<<<<<<<<
  *         if ctx.list_depth > 0:
  *             element_text.reserve(input_str.size())
  */
   __pyx_t_3 = (__pyx_v_ctx->opts.preserve_formatting != 0);
@@ -2209,25 +2338,25 @@
     goto __pyx_L5_bool_binop_done;
   }
   __pyx_t_3 = ((__pyx_v_ctx->pre_depth > 0) != 0);
   __pyx_t_1 = __pyx_t_3;
   __pyx_L5_bool_binop_done:;
   if (__pyx_t_1) {
 
-    /* "resiliparse/extract/html2text.pyx":67
+    /* "resiliparse/extract/html2text.pyx":69
  *     cdef size_t i
  *     if ctx.opts.preserve_formatting and ctx.pre_depth > 0:
  *         if ctx.list_depth > 0:             # <<<<<<<<<<<<<<
  *             element_text.reserve(input_str.size())
  *             for i in range(input_str.size()):
  */
     __pyx_t_1 = ((__pyx_v_ctx->list_depth > 0) != 0);
     if (__pyx_t_1) {
 
-      /* "resiliparse/extract/html2text.pyx":68
+      /* "resiliparse/extract/html2text.pyx":70
  *     if ctx.opts.preserve_formatting and ctx.pre_depth > 0:
  *         if ctx.list_depth > 0:
  *             element_text.reserve(input_str.size())             # <<<<<<<<<<<<<<
  *             for i in range(input_str.size()):
  *                 element_text.push_back(input_str[i])
  */
       try {
@@ -2236,30 +2365,30 @@
         #ifdef WITH_THREAD
         PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
         #endif
         __Pyx_CppExn2PyErr();
         #ifdef WITH_THREAD
         __Pyx_PyGILState_Release(__pyx_gilstate_save);
         #endif
-        __PYX_ERR(0, 68, __pyx_L1_error)
+        __PYX_ERR(0, 70, __pyx_L1_error)
       }
 
-      /* "resiliparse/extract/html2text.pyx":69
+      /* "resiliparse/extract/html2text.pyx":71
  *         if ctx.list_depth > 0:
  *             element_text.reserve(input_str.size())
  *             for i in range(input_str.size()):             # <<<<<<<<<<<<<<
  *                 element_text.push_back(input_str[i])
  *                 if input_str[i] == b'\n':
  */
       __pyx_t_4 = __pyx_v_input_str.size();
       __pyx_t_5 = __pyx_t_4;
       for (__pyx_t_6 = 0; __pyx_t_6 < __pyx_t_5; __pyx_t_6+=1) {
         __pyx_v_i = __pyx_t_6;
 
-        /* "resiliparse/extract/html2text.pyx":70
+        /* "resiliparse/extract/html2text.pyx":72
  *             element_text.reserve(input_str.size())
  *             for i in range(input_str.size()):
  *                 element_text.push_back(input_str[i])             # <<<<<<<<<<<<<<
  *                 if input_str[i] == b'\n':
  *                     insert_list_indent(element_text, ctx)
  */
         try {
@@ -2268,85 +2397,85 @@
           #ifdef WITH_THREAD
           PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
           #endif
           __Pyx_CppExn2PyErr();
           #ifdef WITH_THREAD
           __Pyx_PyGILState_Release(__pyx_gilstate_save);
           #endif
-          __PYX_ERR(0, 70, __pyx_L1_error)
+          __PYX_ERR(0, 72, __pyx_L1_error)
         }
 
-        /* "resiliparse/extract/html2text.pyx":71
+        /* "resiliparse/extract/html2text.pyx":73
  *             for i in range(input_str.size()):
  *                 element_text.push_back(input_str[i])
  *                 if input_str[i] == b'\n':             # <<<<<<<<<<<<<<
  *                     insert_list_indent(element_text, ctx)
  *             return element_text
  */
         __pyx_t_1 = (((__pyx_v_input_str[__pyx_v_i]) == '\n') != 0);
         if (__pyx_t_1) {
 
-          /* "resiliparse/extract/html2text.pyx":72
+          /* "resiliparse/extract/html2text.pyx":74
  *                 element_text.push_back(input_str[i])
  *                 if input_str[i] == b'\n':
  *                     insert_list_indent(element_text, ctx)             # <<<<<<<<<<<<<<
  *             return element_text
  *         return <string>input_str
  */
           __pyx_f_11resiliparse_7extract_9html2text_insert_list_indent(__pyx_v_element_text, __pyx_v_ctx);
 
-          /* "resiliparse/extract/html2text.pyx":71
+          /* "resiliparse/extract/html2text.pyx":73
  *             for i in range(input_str.size()):
  *                 element_text.push_back(input_str[i])
  *                 if input_str[i] == b'\n':             # <<<<<<<<<<<<<<
  *                     insert_list_indent(element_text, ctx)
  *             return element_text
  */
         }
       }
 
-      /* "resiliparse/extract/html2text.pyx":73
+      /* "resiliparse/extract/html2text.pyx":75
  *                 if input_str[i] == b'\n':
  *                     insert_list_indent(element_text, ctx)
  *             return element_text             # <<<<<<<<<<<<<<
  *         return <string>input_str
  * 
  */
       __pyx_r = __pyx_v_element_text;
       goto __pyx_L0;
 
-      /* "resiliparse/extract/html2text.pyx":67
+      /* "resiliparse/extract/html2text.pyx":69
  *     cdef size_t i
  *     if ctx.opts.preserve_formatting and ctx.pre_depth > 0:
  *         if ctx.list_depth > 0:             # <<<<<<<<<<<<<<
  *             element_text.reserve(input_str.size())
  *             for i in range(input_str.size()):
  */
     }
 
-    /* "resiliparse/extract/html2text.pyx":74
+    /* "resiliparse/extract/html2text.pyx":76
  *                     insert_list_indent(element_text, ctx)
  *             return element_text
  *         return <string>input_str             # <<<<<<<<<<<<<<
  * 
  *     # Otherwise collapse white space
  */
     __pyx_r = ((std::string)__pyx_v_input_str);
     goto __pyx_L0;
 
-    /* "resiliparse/extract/html2text.pyx":66
+    /* "resiliparse/extract/html2text.pyx":68
  *     # Pre-formatted context, return string as is, but add list indents
  *     cdef size_t i
  *     if ctx.opts.preserve_formatting and ctx.pre_depth > 0:             # <<<<<<<<<<<<<<
  *         if ctx.list_depth > 0:
  *             element_text.reserve(input_str.size())
  */
   }
 
-  /* "resiliparse/extract/html2text.pyx":77
+  /* "resiliparse/extract/html2text.pyx":79
  * 
  *     # Otherwise collapse white space
  *     element_text.reserve(input_str.size())             # <<<<<<<<<<<<<<
  *     for i in range(input_str.size()):
  *         if isspace(input_str[i]):
  */
   try {
@@ -2355,40 +2484,40 @@
     #ifdef WITH_THREAD
     PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
     #endif
     __Pyx_CppExn2PyErr();
     #ifdef WITH_THREAD
     __Pyx_PyGILState_Release(__pyx_gilstate_save);
     #endif
-    __PYX_ERR(0, 77, __pyx_L1_error)
+    __PYX_ERR(0, 79, __pyx_L1_error)
   }
 
-  /* "resiliparse/extract/html2text.pyx":78
+  /* "resiliparse/extract/html2text.pyx":80
  *     # Otherwise collapse white space
  *     element_text.reserve(input_str.size())
  *     for i in range(input_str.size()):             # <<<<<<<<<<<<<<
  *         if isspace(input_str[i]):
  *             if (element_text.empty() and not ctx.text.empty() and not isspace(ctx.text.back().back())) or \
  */
   __pyx_t_4 = __pyx_v_input_str.size();
   __pyx_t_5 = __pyx_t_4;
   for (__pyx_t_6 = 0; __pyx_t_6 < __pyx_t_5; __pyx_t_6+=1) {
     __pyx_v_i = __pyx_t_6;
 
-    /* "resiliparse/extract/html2text.pyx":79
+    /* "resiliparse/extract/html2text.pyx":81
  *     element_text.reserve(input_str.size())
  *     for i in range(input_str.size()):
  *         if isspace(input_str[i]):             # <<<<<<<<<<<<<<
  *             if (element_text.empty() and not ctx.text.empty() and not isspace(ctx.text.back().back())) or \
  *                     (not element_text.empty() and not isspace(element_text.back())):
  */
     __pyx_t_1 = (std::isspace((__pyx_v_input_str[__pyx_v_i])) != 0);
     if (__pyx_t_1) {
 
-      /* "resiliparse/extract/html2text.pyx":80
+      /* "resiliparse/extract/html2text.pyx":82
  *     for i in range(input_str.size()):
  *         if isspace(input_str[i]):
  *             if (element_text.empty() and not ctx.text.empty() and not isspace(ctx.text.back().back())) or \             # <<<<<<<<<<<<<<
  *                     (not element_text.empty() and not isspace(element_text.back())):
  *                 element_text.push_back(b' ')
  */
       __pyx_t_3 = (__pyx_v_element_text.empty() != 0);
@@ -2405,15 +2534,15 @@
       if (!__pyx_t_3) {
       } else {
         __pyx_t_1 = __pyx_t_3;
         goto __pyx_L15_bool_binop_done;
       }
       __pyx_L16_next_or:;
 
-      /* "resiliparse/extract/html2text.pyx":81
+      /* "resiliparse/extract/html2text.pyx":83
  *         if isspace(input_str[i]):
  *             if (element_text.empty() and not ctx.text.empty() and not isspace(ctx.text.back().back())) or \
  *                     (not element_text.empty() and not isspace(element_text.back())):             # <<<<<<<<<<<<<<
  *                 element_text.push_back(b' ')
  *         else:
  */
       __pyx_t_3 = ((!(__pyx_v_element_text.empty() != 0)) != 0);
@@ -2422,24 +2551,24 @@
         __pyx_t_1 = __pyx_t_3;
         goto __pyx_L15_bool_binop_done;
       }
       __pyx_t_3 = ((!(std::isspace(__pyx_v_element_text.back()) != 0)) != 0);
       __pyx_t_1 = __pyx_t_3;
       __pyx_L15_bool_binop_done:;
 
-      /* "resiliparse/extract/html2text.pyx":80
+      /* "resiliparse/extract/html2text.pyx":82
  *     for i in range(input_str.size()):
  *         if isspace(input_str[i]):
  *             if (element_text.empty() and not ctx.text.empty() and not isspace(ctx.text.back().back())) or \             # <<<<<<<<<<<<<<
  *                     (not element_text.empty() and not isspace(element_text.back())):
  *                 element_text.push_back(b' ')
  */
       if (__pyx_t_1) {
 
-        /* "resiliparse/extract/html2text.pyx":82
+        /* "resiliparse/extract/html2text.pyx":84
  *             if (element_text.empty() and not ctx.text.empty() and not isspace(ctx.text.back().back())) or \
  *                     (not element_text.empty() and not isspace(element_text.back())):
  *                 element_text.push_back(b' ')             # <<<<<<<<<<<<<<
  *         else:
  *             element_text.push_back(input_str[i])
  */
         try {
@@ -2448,37 +2577,37 @@
           #ifdef WITH_THREAD
           PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
           #endif
           __Pyx_CppExn2PyErr();
           #ifdef WITH_THREAD
           __Pyx_PyGILState_Release(__pyx_gilstate_save);
           #endif
-          __PYX_ERR(0, 82, __pyx_L1_error)
+          __PYX_ERR(0, 84, __pyx_L1_error)
         }
 
-        /* "resiliparse/extract/html2text.pyx":80
+        /* "resiliparse/extract/html2text.pyx":82
  *     for i in range(input_str.size()):
  *         if isspace(input_str[i]):
  *             if (element_text.empty() and not ctx.text.empty() and not isspace(ctx.text.back().back())) or \             # <<<<<<<<<<<<<<
  *                     (not element_text.empty() and not isspace(element_text.back())):
  *                 element_text.push_back(b' ')
  */
       }
 
-      /* "resiliparse/extract/html2text.pyx":79
+      /* "resiliparse/extract/html2text.pyx":81
  *     element_text.reserve(input_str.size())
  *     for i in range(input_str.size()):
  *         if isspace(input_str[i]):             # <<<<<<<<<<<<<<
  *             if (element_text.empty() and not ctx.text.empty() and not isspace(ctx.text.back().back())) or \
  *                     (not element_text.empty() and not isspace(element_text.back())):
  */
       goto __pyx_L13;
     }
 
-    /* "resiliparse/extract/html2text.pyx":84
+    /* "resiliparse/extract/html2text.pyx":86
  *                 element_text.push_back(b' ')
  *         else:
  *             element_text.push_back(input_str[i])             # <<<<<<<<<<<<<<
  * 
  *     if element_text.capacity() > element_text.size() // 2:
  */
     /*else*/ {
@@ -2488,31 +2617,31 @@
         #ifdef WITH_THREAD
         PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
         #endif
         __Pyx_CppExn2PyErr();
         #ifdef WITH_THREAD
         __Pyx_PyGILState_Release(__pyx_gilstate_save);
         #endif
-        __PYX_ERR(0, 84, __pyx_L1_error)
+        __PYX_ERR(0, 86, __pyx_L1_error)
       }
     }
     __pyx_L13:;
   }
 
-  /* "resiliparse/extract/html2text.pyx":86
+  /* "resiliparse/extract/html2text.pyx":88
  *             element_text.push_back(input_str[i])
  * 
  *     if element_text.capacity() > element_text.size() // 2:             # <<<<<<<<<<<<<<
  *         element_text.reserve(element_text.size())    # Shrink to fit
  *     return element_text
  */
   __pyx_t_1 = ((__pyx_v_element_text.capacity() > (__pyx_v_element_text.size() / 2)) != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/extract/html2text.pyx":87
+    /* "resiliparse/extract/html2text.pyx":89
  * 
  *     if element_text.capacity() > element_text.size() // 2:
  *         element_text.reserve(element_text.size())    # Shrink to fit             # <<<<<<<<<<<<<<
  *     return element_text
  * 
  */
     try {
@@ -2521,37 +2650,37 @@
       #ifdef WITH_THREAD
       PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
       #endif
       __Pyx_CppExn2PyErr();
       #ifdef WITH_THREAD
       __Pyx_PyGILState_Release(__pyx_gilstate_save);
       #endif
-      __PYX_ERR(0, 87, __pyx_L1_error)
+      __PYX_ERR(0, 89, __pyx_L1_error)
     }
 
-    /* "resiliparse/extract/html2text.pyx":86
+    /* "resiliparse/extract/html2text.pyx":88
  *             element_text.push_back(input_str[i])
  * 
  *     if element_text.capacity() > element_text.size() // 2:             # <<<<<<<<<<<<<<
  *         element_text.reserve(element_text.size())    # Shrink to fit
  *     return element_text
  */
   }
 
-  /* "resiliparse/extract/html2text.pyx":88
+  /* "resiliparse/extract/html2text.pyx":90
  *     if element_text.capacity() > element_text.size() // 2:
  *         element_text.reserve(element_text.size())    # Shrink to fit
  *     return element_text             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __pyx_r = __pyx_v_element_text;
   goto __pyx_L0;
 
-  /* "resiliparse/extract/html2text.pyx":54
+  /* "resiliparse/extract/html2text.pyx":56
  * 
  * 
  * cdef string _get_collapsed_string(const string_view& input_str, ExtractContext* ctx) nogil:             # <<<<<<<<<<<<<<
  *     """
  *     Collapse newlines and consecutive white space in a string to single spaces.
  */
 
@@ -2559,15 +2688,15 @@
   __pyx_L1_error:;
   __Pyx_WriteUnraisable("resiliparse.extract.html2text._get_collapsed_string", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 1);
   __Pyx_pretend_to_initialize(&__pyx_r);
   __pyx_L0:;
   return __pyx_r;
 }
 
-/* "resiliparse/extract/html2text.pyx":94
+/* "resiliparse/extract/html2text.pyx":96
  * 
  * 
  * cdef inline void insert_list_indent(string& element_text, ExtractContext* ctx) nogil:             # <<<<<<<<<<<<<<
  *     if ctx.list_depth == 0 \
  *             or (not element_text.empty() and element_text.back() != b'\n') \
  */
 
@@ -2577,29 +2706,29 @@
   int __pyx_t_2;
   std::string __pyx_t_3;
   lxb_dom_node_t *__pyx_t_4;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
 
-  /* "resiliparse/extract/html2text.pyx":95
+  /* "resiliparse/extract/html2text.pyx":97
  * 
  * cdef inline void insert_list_indent(string& element_text, ExtractContext* ctx) nogil:
  *     if ctx.list_depth == 0 \             # <<<<<<<<<<<<<<
  *             or (not element_text.empty() and element_text.back() != b'\n') \
  *             or (element_text.empty() and not ctx.text.empty() and ctx.text.back().back() != b'\n'):
  */
   __pyx_t_2 = ((__pyx_v_ctx->list_depth == 0) != 0);
   if (!__pyx_t_2) {
   } else {
     __pyx_t_1 = __pyx_t_2;
     goto __pyx_L4_bool_binop_done;
   }
 
-  /* "resiliparse/extract/html2text.pyx":96
+  /* "resiliparse/extract/html2text.pyx":98
  * cdef inline void insert_list_indent(string& element_text, ExtractContext* ctx) nogil:
  *     if ctx.list_depth == 0 \
  *             or (not element_text.empty() and element_text.back() != b'\n') \             # <<<<<<<<<<<<<<
  *             or (element_text.empty() and not ctx.text.empty() and ctx.text.back().back() != b'\n'):
  *         return
  */
   __pyx_t_2 = ((!(__pyx_v_element_text.empty() != 0)) != 0);
@@ -2611,15 +2740,15 @@
   if (!__pyx_t_2) {
   } else {
     __pyx_t_1 = __pyx_t_2;
     goto __pyx_L4_bool_binop_done;
   }
   __pyx_L6_next_or:;
 
-  /* "resiliparse/extract/html2text.pyx":97
+  /* "resiliparse/extract/html2text.pyx":99
  *     if ctx.list_depth == 0 \
  *             or (not element_text.empty() and element_text.back() != b'\n') \
  *             or (element_text.empty() and not ctx.text.empty() and ctx.text.back().back() != b'\n'):             # <<<<<<<<<<<<<<
  *         return
  * 
  */
   __pyx_t_2 = (__pyx_v_element_text.empty() != 0);
@@ -2634,42 +2763,42 @@
     __pyx_t_1 = __pyx_t_2;
     goto __pyx_L4_bool_binop_done;
   }
   __pyx_t_2 = ((__pyx_v_ctx->text.back().back() != '\n') != 0);
   __pyx_t_1 = __pyx_t_2;
   __pyx_L4_bool_binop_done:;
 
-  /* "resiliparse/extract/html2text.pyx":95
+  /* "resiliparse/extract/html2text.pyx":97
  * 
  * cdef inline void insert_list_indent(string& element_text, ExtractContext* ctx) nogil:
  *     if ctx.list_depth == 0 \             # <<<<<<<<<<<<<<
  *             or (not element_text.empty() and element_text.back() != b'\n') \
  *             or (element_text.empty() and not ctx.text.empty() and ctx.text.back().back() != b'\n'):
  */
   if (__pyx_t_1) {
 
-    /* "resiliparse/extract/html2text.pyx":98
+    /* "resiliparse/extract/html2text.pyx":100
  *             or (not element_text.empty() and element_text.back() != b'\n') \
  *             or (element_text.empty() and not ctx.text.empty() and ctx.text.back().back() != b'\n'):
  *         return             # <<<<<<<<<<<<<<
  * 
  *     element_text.append(string(2 * ctx.list_depth, <char>b' '))
  */
     goto __pyx_L0;
 
-    /* "resiliparse/extract/html2text.pyx":95
+    /* "resiliparse/extract/html2text.pyx":97
  * 
  * cdef inline void insert_list_indent(string& element_text, ExtractContext* ctx) nogil:
  *     if ctx.list_depth == 0 \             # <<<<<<<<<<<<<<
  *             or (not element_text.empty() and element_text.back() != b'\n') \
  *             or (element_text.empty() and not ctx.text.empty() and ctx.text.back().back() != b'\n'):
  */
   }
 
-  /* "resiliparse/extract/html2text.pyx":100
+  /* "resiliparse/extract/html2text.pyx":102
  *         return
  * 
  *     element_text.append(string(2 * ctx.list_depth, <char>b' '))             # <<<<<<<<<<<<<<
  *     cdef lxb_dom_node_t* node = ctx.node if ctx.node.type != LXB_DOM_NODE_TYPE_TEXT else ctx.node.parent
  *     if ctx.opts.list_bullets and node.local_name != LXB_TAG_LI:
  */
   try {
@@ -2678,44 +2807,44 @@
     #ifdef WITH_THREAD
     PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
     #endif
     __Pyx_CppExn2PyErr();
     #ifdef WITH_THREAD
     __Pyx_PyGILState_Release(__pyx_gilstate_save);
     #endif
-    __PYX_ERR(0, 100, __pyx_L1_error)
+    __PYX_ERR(0, 102, __pyx_L1_error)
   }
   try {
     __pyx_v_element_text.append(__pyx_t_3);
   } catch(...) {
     #ifdef WITH_THREAD
     PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
     #endif
     __Pyx_CppExn2PyErr();
     #ifdef WITH_THREAD
     __Pyx_PyGILState_Release(__pyx_gilstate_save);
     #endif
-    __PYX_ERR(0, 100, __pyx_L1_error)
+    __PYX_ERR(0, 102, __pyx_L1_error)
   }
 
-  /* "resiliparse/extract/html2text.pyx":101
+  /* "resiliparse/extract/html2text.pyx":103
  * 
  *     element_text.append(string(2 * ctx.list_depth, <char>b' '))
  *     cdef lxb_dom_node_t* node = ctx.node if ctx.node.type != LXB_DOM_NODE_TYPE_TEXT else ctx.node.parent             # <<<<<<<<<<<<<<
  *     if ctx.opts.list_bullets and node.local_name != LXB_TAG_LI:
  *         # Add an additional two spaces if element is not the li element itself or a direct text child
  */
   if (((__pyx_v_ctx->node->type != LXB_DOM_NODE_TYPE_TEXT) != 0)) {
     __pyx_t_4 = __pyx_v_ctx->node;
   } else {
     __pyx_t_4 = __pyx_v_ctx->node->parent;
   }
   __pyx_v_node = __pyx_t_4;
 
-  /* "resiliparse/extract/html2text.pyx":102
+  /* "resiliparse/extract/html2text.pyx":104
  *     element_text.append(string(2 * ctx.list_depth, <char>b' '))
  *     cdef lxb_dom_node_t* node = ctx.node if ctx.node.type != LXB_DOM_NODE_TYPE_TEXT else ctx.node.parent
  *     if ctx.opts.list_bullets and node.local_name != LXB_TAG_LI:             # <<<<<<<<<<<<<<
  *         # Add an additional two spaces if element is not the li element itself or a direct text child
  *         element_text.append(b'  ')
  */
   __pyx_t_2 = (__pyx_v_ctx->opts.list_bullets != 0);
@@ -2725,15 +2854,15 @@
     goto __pyx_L11_bool_binop_done;
   }
   __pyx_t_2 = ((__pyx_v_node->local_name != LXB_TAG_LI) != 0);
   __pyx_t_1 = __pyx_t_2;
   __pyx_L11_bool_binop_done:;
   if (__pyx_t_1) {
 
-    /* "resiliparse/extract/html2text.pyx":104
+    /* "resiliparse/extract/html2text.pyx":106
  *     if ctx.opts.list_bullets and node.local_name != LXB_TAG_LI:
  *         # Add an additional two spaces if element is not the li element itself or a direct text child
  *         element_text.append(b'  ')             # <<<<<<<<<<<<<<
  * 
  * 
  */
     try {
@@ -2742,119 +2871,162 @@
       #ifdef WITH_THREAD
       PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
       #endif
       __Pyx_CppExn2PyErr();
       #ifdef WITH_THREAD
       __Pyx_PyGILState_Release(__pyx_gilstate_save);
       #endif
-      __PYX_ERR(0, 104, __pyx_L1_error)
+      __PYX_ERR(0, 106, __pyx_L1_error)
     }
 
-    /* "resiliparse/extract/html2text.pyx":102
+    /* "resiliparse/extract/html2text.pyx":104
  *     element_text.append(string(2 * ctx.list_depth, <char>b' '))
  *     cdef lxb_dom_node_t* node = ctx.node if ctx.node.type != LXB_DOM_NODE_TYPE_TEXT else ctx.node.parent
  *     if ctx.opts.list_bullets and node.local_name != LXB_TAG_LI:             # <<<<<<<<<<<<<<
  *         # Add an additional two spaces if element is not the li element itself or a direct text child
  *         element_text.append(b'  ')
  */
   }
 
-  /* "resiliparse/extract/html2text.pyx":94
+  /* "resiliparse/extract/html2text.pyx":96
  * 
  * 
  * cdef inline void insert_list_indent(string& element_text, ExtractContext* ctx) nogil:             # <<<<<<<<<<<<<<
  *     if ctx.list_depth == 0 \
  *             or (not element_text.empty() and element_text.back() != b'\n') \
  */
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_WriteUnraisable("resiliparse.extract.html2text.insert_list_indent", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 1);
   __pyx_L0:;
 }
 
-/* "resiliparse/extract/html2text.pyx":107
+/* "resiliparse/extract/html2text.pyx":109
  * 
  * 
  * cdef inline void _add_space(ExtractContext* ctx) nogil:             # <<<<<<<<<<<<<<
  *     """Add space if last character is a non-space character."""
  *     if not ctx.text.empty() and not isspace(ctx.text.back().back()):
  */
 
 static CYTHON_INLINE void __pyx_f_11resiliparse_7extract_9html2text__add_space(struct __pyx_t_11resiliparse_7extract_9html2text_ExtractContext *__pyx_v_ctx) {
   int __pyx_t_1;
   int __pyx_t_2;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
 
-  /* "resiliparse/extract/html2text.pyx":109
+  /* "resiliparse/extract/html2text.pyx":111
  * cdef inline void _add_space(ExtractContext* ctx) nogil:
  *     """Add space if last character is a non-space character."""
  *     if not ctx.text.empty() and not isspace(ctx.text.back().back()):             # <<<<<<<<<<<<<<
- *         ctx.text.back().push_back(<char>b' ')
- * 
+ *         if ctx.tab_before_next_block:
+ *             ctx.text.back().append(<char*>b'\t\t')
  */
   __pyx_t_2 = ((!(__pyx_v_ctx->text.empty() != 0)) != 0);
   if (__pyx_t_2) {
   } else {
     __pyx_t_1 = __pyx_t_2;
     goto __pyx_L4_bool_binop_done;
   }
   __pyx_t_2 = ((!(std::isspace(__pyx_v_ctx->text.back().back()) != 0)) != 0);
   __pyx_t_1 = __pyx_t_2;
   __pyx_L4_bool_binop_done:;
   if (__pyx_t_1) {
 
-    /* "resiliparse/extract/html2text.pyx":110
+    /* "resiliparse/extract/html2text.pyx":112
  *     """Add space if last character is a non-space character."""
  *     if not ctx.text.empty() and not isspace(ctx.text.back().back()):
- *         ctx.text.back().push_back(<char>b' ')             # <<<<<<<<<<<<<<
+ *         if ctx.tab_before_next_block:             # <<<<<<<<<<<<<<
+ *             ctx.text.back().append(<char*>b'\t\t')
+ *         else:
+ */
+    __pyx_t_1 = (__pyx_v_ctx->tab_before_next_block != 0);
+    if (__pyx_t_1) {
+
+      /* "resiliparse/extract/html2text.pyx":113
+ *     if not ctx.text.empty() and not isspace(ctx.text.back().back()):
+ *         if ctx.tab_before_next_block:
+ *             ctx.text.back().append(<char*>b'\t\t')             # <<<<<<<<<<<<<<
+ *         else:
+ *             ctx.text.back().push_back(<char>b' ')
+ */
+      try {
+        __pyx_v_ctx->text.back().append(((char *)((char *)"\t\t")));
+      } catch(...) {
+        #ifdef WITH_THREAD
+        PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
+        #endif
+        __Pyx_CppExn2PyErr();
+        #ifdef WITH_THREAD
+        __Pyx_PyGILState_Release(__pyx_gilstate_save);
+        #endif
+        __PYX_ERR(0, 113, __pyx_L1_error)
+      }
+
+      /* "resiliparse/extract/html2text.pyx":112
+ *     """Add space if last character is a non-space character."""
+ *     if not ctx.text.empty() and not isspace(ctx.text.back().back()):
+ *         if ctx.tab_before_next_block:             # <<<<<<<<<<<<<<
+ *             ctx.text.back().append(<char*>b'\t\t')
+ *         else:
+ */
+      goto __pyx_L6;
+    }
+
+    /* "resiliparse/extract/html2text.pyx":115
+ *             ctx.text.back().append(<char*>b'\t\t')
+ *         else:
+ *             ctx.text.back().push_back(<char>b' ')             # <<<<<<<<<<<<<<
  * 
  * 
  */
-    try {
-      __pyx_v_ctx->text.back().push_back(((char)' '));
-    } catch(...) {
-      #ifdef WITH_THREAD
-      PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
-      #endif
-      __Pyx_CppExn2PyErr();
-      #ifdef WITH_THREAD
-      __Pyx_PyGILState_Release(__pyx_gilstate_save);
-      #endif
-      __PYX_ERR(0, 110, __pyx_L1_error)
+    /*else*/ {
+      try {
+        __pyx_v_ctx->text.back().push_back(((char)' '));
+      } catch(...) {
+        #ifdef WITH_THREAD
+        PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
+        #endif
+        __Pyx_CppExn2PyErr();
+        #ifdef WITH_THREAD
+        __Pyx_PyGILState_Release(__pyx_gilstate_save);
+        #endif
+        __PYX_ERR(0, 115, __pyx_L1_error)
+      }
     }
+    __pyx_L6:;
 
-    /* "resiliparse/extract/html2text.pyx":109
+    /* "resiliparse/extract/html2text.pyx":111
  * cdef inline void _add_space(ExtractContext* ctx) nogil:
  *     """Add space if last character is a non-space character."""
  *     if not ctx.text.empty() and not isspace(ctx.text.back().back()):             # <<<<<<<<<<<<<<
- *         ctx.text.back().push_back(<char>b' ')
- * 
+ *         if ctx.tab_before_next_block:
+ *             ctx.text.back().append(<char*>b'\t\t')
  */
   }
 
-  /* "resiliparse/extract/html2text.pyx":107
+  /* "resiliparse/extract/html2text.pyx":109
  * 
  * 
  * cdef inline void _add_space(ExtractContext* ctx) nogil:             # <<<<<<<<<<<<<<
  *     """Add space if last character is a non-space character."""
  *     if not ctx.text.empty() and not isspace(ctx.text.back().back()):
  */
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_WriteUnraisable("resiliparse.extract.html2text._add_space", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 1);
   __pyx_L0:;
 }
 
-/* "resiliparse/extract/html2text.pyx":113
+/* "resiliparse/extract/html2text.pyx":118
  * 
  * 
  * cdef inline void _make_block(ExtractContext* ctx) nogil:             # <<<<<<<<<<<<<<
  *     """Make a block start or end by inserting the needed number of linefeeds."""
  * 
  */
 
@@ -2864,15 +3036,15 @@
   int __pyx_t_1;
   int __pyx_t_2;
   char const *__pyx_t_3;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
 
-  /* "resiliparse/extract/html2text.pyx":117
+  /* "resiliparse/extract/html2text.pyx":122
  * 
  *     # Strip previous linefeeds to prevent excess empty lines
  *     while not ctx.text.empty() and isspace(ctx.text.back().back()):             # <<<<<<<<<<<<<<
  *         ctx.text[ctx.text.size() - 1] = rstrip_str(ctx.text.back())
  *         if ctx.text.back().empty():
  */
   while (1) {
@@ -2883,90 +3055,90 @@
       goto __pyx_L5_bool_binop_done;
     }
     __pyx_t_2 = (std::isspace(__pyx_v_ctx->text.back().back()) != 0);
     __pyx_t_1 = __pyx_t_2;
     __pyx_L5_bool_binop_done:;
     if (!__pyx_t_1) break;
 
-    /* "resiliparse/extract/html2text.pyx":118
+    /* "resiliparse/extract/html2text.pyx":123
  *     # Strip previous linefeeds to prevent excess empty lines
  *     while not ctx.text.empty() and isspace(ctx.text.back().back()):
  *         ctx.text[ctx.text.size() - 1] = rstrip_str(ctx.text.back())             # <<<<<<<<<<<<<<
  *         if ctx.text.back().empty():
  *             ctx.text.pop_back()
  */
     (__pyx_v_ctx->text[(__pyx_v_ctx->text.size() - 1)]) = __pyx_f_18resiliparse_common_11string_util_rstrip_str(__pyx_v_ctx->text.back());
 
-    /* "resiliparse/extract/html2text.pyx":119
+    /* "resiliparse/extract/html2text.pyx":124
  *     while not ctx.text.empty() and isspace(ctx.text.back().back()):
  *         ctx.text[ctx.text.size() - 1] = rstrip_str(ctx.text.back())
  *         if ctx.text.back().empty():             # <<<<<<<<<<<<<<
  *             ctx.text.pop_back()
  * 
  */
     __pyx_t_1 = (__pyx_v_ctx->text.back().empty() != 0);
     if (__pyx_t_1) {
 
-      /* "resiliparse/extract/html2text.pyx":120
+      /* "resiliparse/extract/html2text.pyx":125
  *         ctx.text[ctx.text.size() - 1] = rstrip_str(ctx.text.back())
  *         if ctx.text.back().empty():
  *             ctx.text.pop_back()             # <<<<<<<<<<<<<<
  * 
  *     if not ctx.opts.preserve_formatting:
  */
       __pyx_v_ctx->text.pop_back();
 
-      /* "resiliparse/extract/html2text.pyx":119
+      /* "resiliparse/extract/html2text.pyx":124
  *     while not ctx.text.empty() and isspace(ctx.text.back().back()):
  *         ctx.text[ctx.text.size() - 1] = rstrip_str(ctx.text.back())
  *         if ctx.text.back().empty():             # <<<<<<<<<<<<<<
  *             ctx.text.pop_back()
  * 
  */
     }
   }
 
-  /* "resiliparse/extract/html2text.pyx":122
+  /* "resiliparse/extract/html2text.pyx":127
  *             ctx.text.pop_back()
  * 
  *     if not ctx.opts.preserve_formatting:             # <<<<<<<<<<<<<<
  *         _add_space(ctx)
  *         return
  */
   __pyx_t_1 = ((!(__pyx_v_ctx->opts.preserve_formatting != 0)) != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/extract/html2text.pyx":123
+    /* "resiliparse/extract/html2text.pyx":128
  * 
  *     if not ctx.opts.preserve_formatting:
  *         _add_space(ctx)             # <<<<<<<<<<<<<<
  *         return
  * 
  */
     __pyx_f_11resiliparse_7extract_9html2text__add_space(__pyx_v_ctx);
 
-    /* "resiliparse/extract/html2text.pyx":124
+    /* "resiliparse/extract/html2text.pyx":129
  *     if not ctx.opts.preserve_formatting:
  *         _add_space(ctx)
  *         return             # <<<<<<<<<<<<<<
  * 
  *     cdef bint block_creates_newline = ctx.newline_before_next_block and not ctx.lstrip_next_block
  */
     goto __pyx_L0;
 
-    /* "resiliparse/extract/html2text.pyx":122
+    /* "resiliparse/extract/html2text.pyx":127
  *             ctx.text.pop_back()
  * 
  *     if not ctx.opts.preserve_formatting:             # <<<<<<<<<<<<<<
  *         _add_space(ctx)
  *         return
  */
   }
 
-  /* "resiliparse/extract/html2text.pyx":126
+  /* "resiliparse/extract/html2text.pyx":131
  *         return
  * 
  *     cdef bint block_creates_newline = ctx.newline_before_next_block and not ctx.lstrip_next_block             # <<<<<<<<<<<<<<
  *     cdef string ws
  *     if not ctx.text.empty() and (not ctx.lstrip_next_block or not ctx.opts.list_bullets):
  */
   __pyx_t_2 = (__pyx_v_ctx->newline_before_next_block != 0);
@@ -2976,15 +3148,15 @@
     goto __pyx_L9_bool_binop_done;
   }
   __pyx_t_2 = ((!(__pyx_v_ctx->lstrip_next_block != 0)) != 0);
   __pyx_t_1 = __pyx_t_2;
   __pyx_L9_bool_binop_done:;
   __pyx_v_block_creates_newline = __pyx_t_1;
 
-  /* "resiliparse/extract/html2text.pyx":128
+  /* "resiliparse/extract/html2text.pyx":133
  *     cdef bint block_creates_newline = ctx.newline_before_next_block and not ctx.lstrip_next_block
  *     cdef string ws
  *     if not ctx.text.empty() and (not ctx.lstrip_next_block or not ctx.opts.list_bullets):             # <<<<<<<<<<<<<<
  *         if ctx.node.local_name in [LXB_TAG_H1, LXB_TAG_H2, LXB_TAG_H3, LXB_TAG_H4, LXB_TAG_H5, LXB_TAG_H6, LXB_TAG_P]:
  *             block_creates_newline = not ctx.lstrip_next_block
  */
   __pyx_t_2 = ((!(__pyx_v_ctx->text.empty() != 0)) != 0);
@@ -3000,15 +3172,15 @@
     goto __pyx_L12_bool_binop_done;
   }
   __pyx_t_2 = ((!(__pyx_v_ctx->opts.list_bullets != 0)) != 0);
   __pyx_t_1 = __pyx_t_2;
   __pyx_L12_bool_binop_done:;
   if (__pyx_t_1) {
 
-    /* "resiliparse/extract/html2text.pyx":129
+    /* "resiliparse/extract/html2text.pyx":134
  *     cdef string ws
  *     if not ctx.text.empty() and (not ctx.lstrip_next_block or not ctx.opts.list_bullets):
  *         if ctx.node.local_name in [LXB_TAG_H1, LXB_TAG_H2, LXB_TAG_H3, LXB_TAG_H4, LXB_TAG_H5, LXB_TAG_H6, LXB_TAG_P]:             # <<<<<<<<<<<<<<
  *             block_creates_newline = not ctx.lstrip_next_block
  *         ws = <const char*>b'\n\n' if block_creates_newline else <const char*>b'\n'
  */
     switch (__pyx_v_ctx->node->local_name) {
@@ -3016,77 +3188,77 @@
       case LXB_TAG_H2:
       case LXB_TAG_H3:
       case LXB_TAG_H4:
       case LXB_TAG_H5:
       case LXB_TAG_H6:
       case LXB_TAG_P:
 
-      /* "resiliparse/extract/html2text.pyx":130
+      /* "resiliparse/extract/html2text.pyx":135
  *     if not ctx.text.empty() and (not ctx.lstrip_next_block or not ctx.opts.list_bullets):
  *         if ctx.node.local_name in [LXB_TAG_H1, LXB_TAG_H2, LXB_TAG_H3, LXB_TAG_H4, LXB_TAG_H5, LXB_TAG_H6, LXB_TAG_P]:
  *             block_creates_newline = not ctx.lstrip_next_block             # <<<<<<<<<<<<<<
  *         ws = <const char*>b'\n\n' if block_creates_newline else <const char*>b'\n'
  * 
  */
       __pyx_v_block_creates_newline = (!(__pyx_v_ctx->lstrip_next_block != 0));
 
-      /* "resiliparse/extract/html2text.pyx":129
+      /* "resiliparse/extract/html2text.pyx":134
  *     cdef string ws
  *     if not ctx.text.empty() and (not ctx.lstrip_next_block or not ctx.opts.list_bullets):
  *         if ctx.node.local_name in [LXB_TAG_H1, LXB_TAG_H2, LXB_TAG_H3, LXB_TAG_H4, LXB_TAG_H5, LXB_TAG_H6, LXB_TAG_P]:             # <<<<<<<<<<<<<<
  *             block_creates_newline = not ctx.lstrip_next_block
  *         ws = <const char*>b'\n\n' if block_creates_newline else <const char*>b'\n'
  */
       break;
       default: break;
     }
 
-    /* "resiliparse/extract/html2text.pyx":131
+    /* "resiliparse/extract/html2text.pyx":136
  *         if ctx.node.local_name in [LXB_TAG_H1, LXB_TAG_H2, LXB_TAG_H3, LXB_TAG_H4, LXB_TAG_H5, LXB_TAG_H6, LXB_TAG_P]:
  *             block_creates_newline = not ctx.lstrip_next_block
  *         ws = <const char*>b'\n\n' if block_creates_newline else <const char*>b'\n'             # <<<<<<<<<<<<<<
  * 
  *     insert_list_indent(ws, ctx)
  */
     if ((__pyx_v_block_creates_newline != 0)) {
       __pyx_t_3 = ((char const *)((char const *)"\n\n"));
     } else {
       __pyx_t_3 = ((char const *)((char const *)"\n"));
     }
     __pyx_v_ws = __pyx_t_3;
 
-    /* "resiliparse/extract/html2text.pyx":128
+    /* "resiliparse/extract/html2text.pyx":133
  *     cdef bint block_creates_newline = ctx.newline_before_next_block and not ctx.lstrip_next_block
  *     cdef string ws
  *     if not ctx.text.empty() and (not ctx.lstrip_next_block or not ctx.opts.list_bullets):             # <<<<<<<<<<<<<<
  *         if ctx.node.local_name in [LXB_TAG_H1, LXB_TAG_H2, LXB_TAG_H3, LXB_TAG_H4, LXB_TAG_H5, LXB_TAG_H6, LXB_TAG_P]:
  *             block_creates_newline = not ctx.lstrip_next_block
  */
   }
 
-  /* "resiliparse/extract/html2text.pyx":133
+  /* "resiliparse/extract/html2text.pyx":138
  *         ws = <const char*>b'\n\n' if block_creates_newline else <const char*>b'\n'
  * 
  *     insert_list_indent(ws, ctx)             # <<<<<<<<<<<<<<
  *     if ctx.space_before_next_block:
  *         ws.push_back(b' ')
  */
   __pyx_f_11resiliparse_7extract_9html2text_insert_list_indent(__pyx_v_ws, __pyx_v_ctx);
 
-  /* "resiliparse/extract/html2text.pyx":134
+  /* "resiliparse/extract/html2text.pyx":139
  * 
  *     insert_list_indent(ws, ctx)
  *     if ctx.space_before_next_block:             # <<<<<<<<<<<<<<
  *         ws.push_back(b' ')
  *     if not ws.empty():
  */
   __pyx_t_1 = (__pyx_v_ctx->space_before_next_block != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/extract/html2text.pyx":135
+    /* "resiliparse/extract/html2text.pyx":140
  *     insert_list_indent(ws, ctx)
  *     if ctx.space_before_next_block:
  *         ws.push_back(b' ')             # <<<<<<<<<<<<<<
  *     if not ws.empty():
  *         ctx.text.push_back(move(ws))
  */
     try {
@@ -3095,37 +3267,37 @@
       #ifdef WITH_THREAD
       PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
       #endif
       __Pyx_CppExn2PyErr();
       #ifdef WITH_THREAD
       __Pyx_PyGILState_Release(__pyx_gilstate_save);
       #endif
-      __PYX_ERR(0, 135, __pyx_L1_error)
+      __PYX_ERR(0, 140, __pyx_L1_error)
     }
 
-    /* "resiliparse/extract/html2text.pyx":134
+    /* "resiliparse/extract/html2text.pyx":139
  * 
  *     insert_list_indent(ws, ctx)
  *     if ctx.space_before_next_block:             # <<<<<<<<<<<<<<
  *         ws.push_back(b' ')
  *     if not ws.empty():
  */
   }
 
-  /* "resiliparse/extract/html2text.pyx":136
+  /* "resiliparse/extract/html2text.pyx":141
  *     if ctx.space_before_next_block:
  *         ws.push_back(b' ')
  *     if not ws.empty():             # <<<<<<<<<<<<<<
  *         ctx.text.push_back(move(ws))
  * 
  */
   __pyx_t_1 = ((!(__pyx_v_ws.empty() != 0)) != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/extract/html2text.pyx":137
+    /* "resiliparse/extract/html2text.pyx":142
  *         ws.push_back(b' ')
  *     if not ws.empty():
  *         ctx.text.push_back(move(ws))             # <<<<<<<<<<<<<<
  * 
  * 
  */
     try {
@@ -3134,57 +3306,57 @@
       #ifdef WITH_THREAD
       PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
       #endif
       __Pyx_CppExn2PyErr();
       #ifdef WITH_THREAD
       __Pyx_PyGILState_Release(__pyx_gilstate_save);
       #endif
-      __PYX_ERR(0, 137, __pyx_L1_error)
+      __PYX_ERR(0, 142, __pyx_L1_error)
     }
 
-    /* "resiliparse/extract/html2text.pyx":136
+    /* "resiliparse/extract/html2text.pyx":141
  *     if ctx.space_before_next_block:
  *         ws.push_back(b' ')
  *     if not ws.empty():             # <<<<<<<<<<<<<<
  *         ctx.text.push_back(move(ws))
  * 
  */
   }
 
-  /* "resiliparse/extract/html2text.pyx":113
+  /* "resiliparse/extract/html2text.pyx":118
  * 
  * 
  * cdef inline void _make_block(ExtractContext* ctx) nogil:             # <<<<<<<<<<<<<<
  *     """Make a block start or end by inserting the needed number of linefeeds."""
  * 
  */
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_WriteUnraisable("resiliparse.extract.html2text._make_block", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 1);
   __pyx_L0:;
 }
 
-/* "resiliparse/extract/html2text.pyx":140
+/* "resiliparse/extract/html2text.pyx":145
  * 
  * 
  * cdef bint _is_unprintable_pua(lxb_dom_node_t* node) nogil:             # <<<<<<<<<<<<<<
  *     """Whether text node contains only a single unprintable code point from the private use area."""
  *     if node.first_child and (node.first_child.next or node.first_child.type != LXB_DOM_NODE_TYPE_TEXT):
  */
 
 static int __pyx_f_11resiliparse_7extract_9html2text__is_unprintable_pua(lxb_dom_node_t *__pyx_v_node) {
   std::string __pyx_v_element_text;
   uint32_t __pyx_v_cp;
   int __pyx_r;
   int __pyx_t_1;
   int __pyx_t_2;
 
-  /* "resiliparse/extract/html2text.pyx":142
+  /* "resiliparse/extract/html2text.pyx":147
  * cdef bint _is_unprintable_pua(lxb_dom_node_t* node) nogil:
  *     """Whether text node contains only a single unprintable code point from the private use area."""
  *     if node.first_child and (node.first_child.next or node.first_child.type != LXB_DOM_NODE_TYPE_TEXT):             # <<<<<<<<<<<<<<
  *         # Node has more than one child
  *         return False
  */
   __pyx_t_2 = (__pyx_v_node->first_child != 0);
@@ -3200,34 +3372,34 @@
     goto __pyx_L4_bool_binop_done;
   }
   __pyx_t_2 = ((__pyx_v_node->first_child->type != LXB_DOM_NODE_TYPE_TEXT) != 0);
   __pyx_t_1 = __pyx_t_2;
   __pyx_L4_bool_binop_done:;
   if (__pyx_t_1) {
 
-    /* "resiliparse/extract/html2text.pyx":144
+    /* "resiliparse/extract/html2text.pyx":149
  *     if node.first_child and (node.first_child.next or node.first_child.type != LXB_DOM_NODE_TYPE_TEXT):
  *         # Node has more than one child
  *         return False             # <<<<<<<<<<<<<<
  *     if not node.first_child and node.type != LXB_DOM_NODE_TYPE_TEXT:
  *         return False
  */
     __pyx_r = 0;
     goto __pyx_L0;
 
-    /* "resiliparse/extract/html2text.pyx":142
+    /* "resiliparse/extract/html2text.pyx":147
  * cdef bint _is_unprintable_pua(lxb_dom_node_t* node) nogil:
  *     """Whether text node contains only a single unprintable code point from the private use area."""
  *     if node.first_child and (node.first_child.next or node.first_child.type != LXB_DOM_NODE_TYPE_TEXT):             # <<<<<<<<<<<<<<
  *         # Node has more than one child
  *         return False
  */
   }
 
-  /* "resiliparse/extract/html2text.pyx":145
+  /* "resiliparse/extract/html2text.pyx":150
  *         # Node has more than one child
  *         return False
  *     if not node.first_child and node.type != LXB_DOM_NODE_TYPE_TEXT:             # <<<<<<<<<<<<<<
  *         return False
  * 
  */
   __pyx_t_2 = ((!(__pyx_v_node->first_child != 0)) != 0);
@@ -3237,194 +3409,194 @@
     goto __pyx_L8_bool_binop_done;
   }
   __pyx_t_2 = ((__pyx_v_node->type != LXB_DOM_NODE_TYPE_TEXT) != 0);
   __pyx_t_1 = __pyx_t_2;
   __pyx_L8_bool_binop_done:;
   if (__pyx_t_1) {
 
-    /* "resiliparse/extract/html2text.pyx":146
+    /* "resiliparse/extract/html2text.pyx":151
  *         return False
  *     if not node.first_child and node.type != LXB_DOM_NODE_TYPE_TEXT:
  *         return False             # <<<<<<<<<<<<<<
  * 
  *     cdef string element_text = strip_str(get_node_text(node))
  */
     __pyx_r = 0;
     goto __pyx_L0;
 
-    /* "resiliparse/extract/html2text.pyx":145
+    /* "resiliparse/extract/html2text.pyx":150
  *         # Node has more than one child
  *         return False
  *     if not node.first_child and node.type != LXB_DOM_NODE_TYPE_TEXT:             # <<<<<<<<<<<<<<
  *         return False
  * 
  */
   }
 
-  /* "resiliparse/extract/html2text.pyx":148
+  /* "resiliparse/extract/html2text.pyx":153
  *         return False
  * 
  *     cdef string element_text = strip_str(get_node_text(node))             # <<<<<<<<<<<<<<
  *     if element_text.size() > 3:
  *         return False
  */
   __pyx_v_element_text = __pyx_f_18resiliparse_common_11string_util_strip_str(__pyx_f_11resiliparse_5parse_4html_get_node_text(__pyx_v_node));
 
-  /* "resiliparse/extract/html2text.pyx":149
+  /* "resiliparse/extract/html2text.pyx":154
  * 
  *     cdef string element_text = strip_str(get_node_text(node))
  *     if element_text.size() > 3:             # <<<<<<<<<<<<<<
  *         return False
  * 
  */
   __pyx_t_1 = ((__pyx_v_element_text.size() > 3) != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/extract/html2text.pyx":150
+    /* "resiliparse/extract/html2text.pyx":155
  *     cdef string element_text = strip_str(get_node_text(node))
  *     if element_text.size() > 3:
  *         return False             # <<<<<<<<<<<<<<
  * 
  *     # Pilcrow character (probably an anchor link)
  */
     __pyx_r = 0;
     goto __pyx_L0;
 
-    /* "resiliparse/extract/html2text.pyx":149
+    /* "resiliparse/extract/html2text.pyx":154
  * 
  *     cdef string element_text = strip_str(get_node_text(node))
  *     if element_text.size() > 3:             # <<<<<<<<<<<<<<
  *         return False
  * 
  */
   }
 
-  /* "resiliparse/extract/html2text.pyx":153
+  /* "resiliparse/extract/html2text.pyx":158
  * 
  *     # Pilcrow character (probably an anchor link)
  *     if element_text == b'\xc2\xb6':             # <<<<<<<<<<<<<<
- *         return False
+ *         return True
  * 
  */
   __pyx_t_1 = ((__pyx_v_element_text == ((char const *)"\302\266")) != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/extract/html2text.pyx":154
+    /* "resiliparse/extract/html2text.pyx":159
  *     # Pilcrow character (probably an anchor link)
  *     if element_text == b'\xc2\xb6':
- *         return False             # <<<<<<<<<<<<<<
+ *         return True             # <<<<<<<<<<<<<<
  * 
  *     # BMP private use area (probably an icon font)
  */
-    __pyx_r = 0;
+    __pyx_r = 1;
     goto __pyx_L0;
 
-    /* "resiliparse/extract/html2text.pyx":153
+    /* "resiliparse/extract/html2text.pyx":158
  * 
  *     # Pilcrow character (probably an anchor link)
  *     if element_text == b'\xc2\xb6':             # <<<<<<<<<<<<<<
- *         return False
+ *         return True
  * 
  */
   }
 
-  /* "resiliparse/extract/html2text.pyx":157
+  /* "resiliparse/extract/html2text.pyx":162
  * 
  *     # BMP private use area (probably an icon font)
  *     cdef uint32_t cp = 0             # <<<<<<<<<<<<<<
  *     if element_text.size() == 3:
  *         memcpy(&cp, element_text.data(), 3 * sizeof(char))
  */
   __pyx_v_cp = 0;
 
-  /* "resiliparse/extract/html2text.pyx":158
+  /* "resiliparse/extract/html2text.pyx":163
  *     # BMP private use area (probably an icon font)
  *     cdef uint32_t cp = 0
  *     if element_text.size() == 3:             # <<<<<<<<<<<<<<
  *         memcpy(&cp, element_text.data(), 3 * sizeof(char))
  *         if 0x8080ee <= cp <= 0xbfa3ef:
  */
   __pyx_t_1 = ((__pyx_v_element_text.size() == 3) != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/extract/html2text.pyx":159
+    /* "resiliparse/extract/html2text.pyx":164
  *     cdef uint32_t cp = 0
  *     if element_text.size() == 3:
  *         memcpy(&cp, element_text.data(), 3 * sizeof(char))             # <<<<<<<<<<<<<<
  *         if 0x8080ee <= cp <= 0xbfa3ef:
  *             return True
  */
     (void)(memcpy((&__pyx_v_cp), __pyx_v_element_text.data(), (3 * (sizeof(char)))));
 
-    /* "resiliparse/extract/html2text.pyx":160
+    /* "resiliparse/extract/html2text.pyx":165
  *     if element_text.size() == 3:
  *         memcpy(&cp, element_text.data(), 3 * sizeof(char))
  *         if 0x8080ee <= cp <= 0xbfa3ef:             # <<<<<<<<<<<<<<
  *             return True
  * 
  */
     __pyx_t_1 = (0x8080ee <= __pyx_v_cp);
     if (__pyx_t_1) {
       __pyx_t_1 = (__pyx_v_cp <= 0xbfa3ef);
     }
     __pyx_t_2 = (__pyx_t_1 != 0);
     if (__pyx_t_2) {
 
-      /* "resiliparse/extract/html2text.pyx":161
+      /* "resiliparse/extract/html2text.pyx":166
  *         memcpy(&cp, element_text.data(), 3 * sizeof(char))
  *         if 0x8080ee <= cp <= 0xbfa3ef:
  *             return True             # <<<<<<<<<<<<<<
  * 
  *     return False
  */
       __pyx_r = 1;
       goto __pyx_L0;
 
-      /* "resiliparse/extract/html2text.pyx":160
+      /* "resiliparse/extract/html2text.pyx":165
  *     if element_text.size() == 3:
  *         memcpy(&cp, element_text.data(), 3 * sizeof(char))
  *         if 0x8080ee <= cp <= 0xbfa3ef:             # <<<<<<<<<<<<<<
  *             return True
  * 
  */
     }
 
-    /* "resiliparse/extract/html2text.pyx":158
+    /* "resiliparse/extract/html2text.pyx":163
  *     # BMP private use area (probably an icon font)
  *     cdef uint32_t cp = 0
  *     if element_text.size() == 3:             # <<<<<<<<<<<<<<
  *         memcpy(&cp, element_text.data(), 3 * sizeof(char))
  *         if 0x8080ee <= cp <= 0xbfa3ef:
  */
   }
 
-  /* "resiliparse/extract/html2text.pyx":163
+  /* "resiliparse/extract/html2text.pyx":168
  *             return True
  * 
  *     return False             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __pyx_r = 0;
   goto __pyx_L0;
 
-  /* "resiliparse/extract/html2text.pyx":140
+  /* "resiliparse/extract/html2text.pyx":145
  * 
  * 
  * cdef bint _is_unprintable_pua(lxb_dom_node_t* node) nogil:             # <<<<<<<<<<<<<<
  *     """Whether text node contains only a single unprintable code point from the private use area."""
  *     if node.first_child and (node.first_child.next or node.first_child.type != LXB_DOM_NODE_TYPE_TEXT):
  */
 
   /* function exit code */
   __pyx_L0:;
   return __pyx_r;
 }
 
-/* "resiliparse/extract/html2text.pyx":166
+/* "resiliparse/extract/html2text.pyx":171
  * 
  * 
  * cdef void _extract_start_cb(ExtractContext* ctx) nogil:             # <<<<<<<<<<<<<<
  *     """Extraction start element callback."""
  *     cdef lxb_dom_character_data_t* node_char_data = NULL
  */
 
@@ -3441,71 +3613,79 @@
   std::string_view __pyx_t_4;
   std::string __pyx_t_5;
   std::string __pyx_t_6;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
 
-  /* "resiliparse/extract/html2text.pyx":168
+  /* "resiliparse/extract/html2text.pyx":173
  * cdef void _extract_start_cb(ExtractContext* ctx) nogil:
  *     """Extraction start element callback."""
  *     cdef lxb_dom_character_data_t* node_char_data = NULL             # <<<<<<<<<<<<<<
  *     cdef string_view node_attr_data
  *     cdef string element_text
  */
   __pyx_v_node_char_data = NULL;
 
-  /* "resiliparse/extract/html2text.pyx":173
+  /* "resiliparse/extract/html2text.pyx":178
  *     cdef size_t i
  * 
  *     if ctx.node.type == LXB_DOM_NODE_TYPE_TEXT:             # <<<<<<<<<<<<<<
- *         if ctx.space_before_next_block:
+ *         if ctx.space_before_next_block or ctx.tab_before_next_block:
  *             _add_space(ctx)
  */
   __pyx_t_1 = ((__pyx_v_ctx->node->type == LXB_DOM_NODE_TYPE_TEXT) != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/extract/html2text.pyx":174
+    /* "resiliparse/extract/html2text.pyx":179
  * 
  *     if ctx.node.type == LXB_DOM_NODE_TYPE_TEXT:
- *         if ctx.space_before_next_block:             # <<<<<<<<<<<<<<
+ *         if ctx.space_before_next_block or ctx.tab_before_next_block:             # <<<<<<<<<<<<<<
  *             _add_space(ctx)
  * 
  */
-    __pyx_t_1 = (__pyx_v_ctx->space_before_next_block != 0);
+    __pyx_t_2 = (__pyx_v_ctx->space_before_next_block != 0);
+    if (!__pyx_t_2) {
+    } else {
+      __pyx_t_1 = __pyx_t_2;
+      goto __pyx_L5_bool_binop_done;
+    }
+    __pyx_t_2 = (__pyx_v_ctx->tab_before_next_block != 0);
+    __pyx_t_1 = __pyx_t_2;
+    __pyx_L5_bool_binop_done:;
     if (__pyx_t_1) {
 
-      /* "resiliparse/extract/html2text.pyx":175
+      /* "resiliparse/extract/html2text.pyx":180
  *     if ctx.node.type == LXB_DOM_NODE_TYPE_TEXT:
- *         if ctx.space_before_next_block:
+ *         if ctx.space_before_next_block or ctx.tab_before_next_block:
  *             _add_space(ctx)             # <<<<<<<<<<<<<<
  * 
  *         node_char_data = <lxb_dom_character_data_t*>ctx.node
  */
       __pyx_f_11resiliparse_7extract_9html2text__add_space(__pyx_v_ctx);
 
-      /* "resiliparse/extract/html2text.pyx":174
+      /* "resiliparse/extract/html2text.pyx":179
  * 
  *     if ctx.node.type == LXB_DOM_NODE_TYPE_TEXT:
- *         if ctx.space_before_next_block:             # <<<<<<<<<<<<<<
+ *         if ctx.space_before_next_block or ctx.tab_before_next_block:             # <<<<<<<<<<<<<<
  *             _add_space(ctx)
  * 
  */
     }
 
-    /* "resiliparse/extract/html2text.pyx":177
+    /* "resiliparse/extract/html2text.pyx":182
  *             _add_space(ctx)
  * 
  *         node_char_data = <lxb_dom_character_data_t*>ctx.node             # <<<<<<<<<<<<<<
  *         element_text.append(<const char*>node_char_data.data.data, node_char_data.data.length)
  *         element_text = _get_collapsed_string(<string_view>element_text, ctx)
  */
     __pyx_v_node_char_data = ((lxb_dom_character_data_t *)__pyx_v_ctx->node);
 
-    /* "resiliparse/extract/html2text.pyx":178
+    /* "resiliparse/extract/html2text.pyx":183
  * 
  *         node_char_data = <lxb_dom_character_data_t*>ctx.node
  *         element_text.append(<const char*>node_char_data.data.data, node_char_data.data.length)             # <<<<<<<<<<<<<<
  *         element_text = _get_collapsed_string(<string_view>element_text, ctx)
  *         if not rstrip_str(element_text).empty():
  */
     try {
@@ -3514,226 +3694,235 @@
       #ifdef WITH_THREAD
       PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
       #endif
       __Pyx_CppExn2PyErr();
       #ifdef WITH_THREAD
       __Pyx_PyGILState_Release(__pyx_gilstate_save);
       #endif
-      __PYX_ERR(0, 178, __pyx_L1_error)
+      __PYX_ERR(0, 183, __pyx_L1_error)
     }
 
-    /* "resiliparse/extract/html2text.pyx":179
+    /* "resiliparse/extract/html2text.pyx":184
  *         node_char_data = <lxb_dom_character_data_t*>ctx.node
  *         element_text.append(<const char*>node_char_data.data.data, node_char_data.data.length)
  *         element_text = _get_collapsed_string(<string_view>element_text, ctx)             # <<<<<<<<<<<<<<
  *         if not rstrip_str(element_text).empty():
  *             ctx.newline_before_next_block = False
  */
     __pyx_v_element_text = __pyx_f_11resiliparse_7extract_9html2text__get_collapsed_string(((std::string_view)__pyx_v_element_text), __pyx_v_ctx);
 
-    /* "resiliparse/extract/html2text.pyx":180
+    /* "resiliparse/extract/html2text.pyx":185
  *         element_text.append(<const char*>node_char_data.data.data, node_char_data.data.length)
  *         element_text = _get_collapsed_string(<string_view>element_text, ctx)
  *         if not rstrip_str(element_text).empty():             # <<<<<<<<<<<<<<
  *             ctx.newline_before_next_block = False
  *             ctx.lstrip_next_block = False
  */
     __pyx_t_1 = ((!(__pyx_f_18resiliparse_common_11string_util_rstrip_str(__pyx_v_element_text).empty() != 0)) != 0);
     if (__pyx_t_1) {
 
-      /* "resiliparse/extract/html2text.pyx":181
+      /* "resiliparse/extract/html2text.pyx":186
  *         element_text = _get_collapsed_string(<string_view>element_text, ctx)
  *         if not rstrip_str(element_text).empty():
  *             ctx.newline_before_next_block = False             # <<<<<<<<<<<<<<
  *             ctx.lstrip_next_block = False
  *             ctx.space_before_next_block = False
  */
       __pyx_v_ctx->newline_before_next_block = 0;
 
-      /* "resiliparse/extract/html2text.pyx":182
+      /* "resiliparse/extract/html2text.pyx":187
  *         if not rstrip_str(element_text).empty():
  *             ctx.newline_before_next_block = False
  *             ctx.lstrip_next_block = False             # <<<<<<<<<<<<<<
  *             ctx.space_before_next_block = False
- *             ctx.text.push_back(move(element_text))
+ *             ctx.tab_before_next_block = False
  */
       __pyx_v_ctx->lstrip_next_block = 0;
 
-      /* "resiliparse/extract/html2text.pyx":183
+      /* "resiliparse/extract/html2text.pyx":188
  *             ctx.newline_before_next_block = False
  *             ctx.lstrip_next_block = False
  *             ctx.space_before_next_block = False             # <<<<<<<<<<<<<<
+ *             ctx.tab_before_next_block = False
  *             ctx.text.push_back(move(element_text))
- *         else:
  */
       __pyx_v_ctx->space_before_next_block = 0;
 
-      /* "resiliparse/extract/html2text.pyx":184
+      /* "resiliparse/extract/html2text.pyx":189
  *             ctx.lstrip_next_block = False
  *             ctx.space_before_next_block = False
+ *             ctx.tab_before_next_block = False             # <<<<<<<<<<<<<<
+ *             ctx.text.push_back(move(element_text))
+ *         else:
+ */
+      __pyx_v_ctx->tab_before_next_block = 0;
+
+      /* "resiliparse/extract/html2text.pyx":190
+ *             ctx.space_before_next_block = False
+ *             ctx.tab_before_next_block = False
  *             ctx.text.push_back(move(element_text))             # <<<<<<<<<<<<<<
  *         else:
  *             _add_space(ctx)
  */
       try {
         __pyx_v_ctx->text.push_back(stdx::move<std::string>(__pyx_v_element_text));
       } catch(...) {
         #ifdef WITH_THREAD
         PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
         #endif
         __Pyx_CppExn2PyErr();
         #ifdef WITH_THREAD
         __Pyx_PyGILState_Release(__pyx_gilstate_save);
         #endif
-        __PYX_ERR(0, 184, __pyx_L1_error)
+        __PYX_ERR(0, 190, __pyx_L1_error)
       }
 
-      /* "resiliparse/extract/html2text.pyx":180
+      /* "resiliparse/extract/html2text.pyx":185
  *         element_text.append(<const char*>node_char_data.data.data, node_char_data.data.length)
  *         element_text = _get_collapsed_string(<string_view>element_text, ctx)
  *         if not rstrip_str(element_text).empty():             # <<<<<<<<<<<<<<
  *             ctx.newline_before_next_block = False
  *             ctx.lstrip_next_block = False
  */
-      goto __pyx_L5;
+      goto __pyx_L7;
     }
 
-    /* "resiliparse/extract/html2text.pyx":186
+    /* "resiliparse/extract/html2text.pyx":192
  *             ctx.text.push_back(move(element_text))
  *         else:
  *             _add_space(ctx)             # <<<<<<<<<<<<<<
  *         return
  * 
  */
     /*else*/ {
       __pyx_f_11resiliparse_7extract_9html2text__add_space(__pyx_v_ctx);
     }
-    __pyx_L5:;
+    __pyx_L7:;
 
-    /* "resiliparse/extract/html2text.pyx":187
+    /* "resiliparse/extract/html2text.pyx":193
  *         else:
  *             _add_space(ctx)
  *         return             # <<<<<<<<<<<<<<
  * 
  *     if ctx.node.type != LXB_DOM_NODE_TYPE_ELEMENT:
  */
     goto __pyx_L0;
 
-    /* "resiliparse/extract/html2text.pyx":173
+    /* "resiliparse/extract/html2text.pyx":178
  *     cdef size_t i
  * 
  *     if ctx.node.type == LXB_DOM_NODE_TYPE_TEXT:             # <<<<<<<<<<<<<<
- *         if ctx.space_before_next_block:
+ *         if ctx.space_before_next_block or ctx.tab_before_next_block:
  *             _add_space(ctx)
  */
   }
 
-  /* "resiliparse/extract/html2text.pyx":189
+  /* "resiliparse/extract/html2text.pyx":195
  *         return
  * 
  *     if ctx.node.type != LXB_DOM_NODE_TYPE_ELEMENT:             # <<<<<<<<<<<<<<
  *         return
  * 
  */
   __pyx_t_1 = ((__pyx_v_ctx->node->type != LXB_DOM_NODE_TYPE_ELEMENT) != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/extract/html2text.pyx":190
+    /* "resiliparse/extract/html2text.pyx":196
  * 
  *     if ctx.node.type != LXB_DOM_NODE_TYPE_ELEMENT:
  *         return             # <<<<<<<<<<<<<<
  * 
  *     cdef bint last_was_space = not ctx.text.empty() and isspace(ctx.text.back().back())
  */
     goto __pyx_L0;
 
-    /* "resiliparse/extract/html2text.pyx":189
+    /* "resiliparse/extract/html2text.pyx":195
  *         return
  * 
  *     if ctx.node.type != LXB_DOM_NODE_TYPE_ELEMENT:             # <<<<<<<<<<<<<<
  *         return
  * 
  */
   }
 
-  /* "resiliparse/extract/html2text.pyx":192
+  /* "resiliparse/extract/html2text.pyx":198
  *         return
  * 
  *     cdef bint last_was_space = not ctx.text.empty() and isspace(ctx.text.back().back())             # <<<<<<<<<<<<<<
  * 
  *     # Alternative descriptions
  */
   __pyx_t_2 = ((!(__pyx_v_ctx->text.empty() != 0)) != 0);
   if (__pyx_t_2) {
   } else {
     __pyx_t_1 = __pyx_t_2;
-    goto __pyx_L7_bool_binop_done;
+    goto __pyx_L9_bool_binop_done;
   }
   __pyx_t_2 = (std::isspace(__pyx_v_ctx->text.back().back()) != 0);
   __pyx_t_1 = __pyx_t_2;
-  __pyx_L7_bool_binop_done:;
+  __pyx_L9_bool_binop_done:;
   __pyx_v_last_was_space = __pyx_t_1;
 
-  /* "resiliparse/extract/html2text.pyx":195
+  /* "resiliparse/extract/html2text.pyx":201
  * 
  *     # Alternative descriptions
  *     if ctx.opts.alt_texts and ctx.node.local_name in [LXB_TAG_IMG, LXB_TAG_AREA]:             # <<<<<<<<<<<<<<
  *         node_attr_data = get_node_attr_sv(ctx.node, b'alt')
  *         if not node_attr_data.empty():
  */
   __pyx_t_2 = (__pyx_v_ctx->opts.alt_texts != 0);
   if (__pyx_t_2) {
   } else {
     __pyx_t_1 = __pyx_t_2;
-    goto __pyx_L10_bool_binop_done;
+    goto __pyx_L12_bool_binop_done;
   }
   switch (__pyx_v_ctx->node->local_name) {
     case LXB_TAG_IMG:
     case LXB_TAG_AREA:
     __pyx_t_2 = 1;
     break;
     default:
     __pyx_t_2 = 0;
     break;
   }
   __pyx_t_3 = (__pyx_t_2 != 0);
   __pyx_t_1 = __pyx_t_3;
-  __pyx_L10_bool_binop_done:;
+  __pyx_L12_bool_binop_done:;
   if (__pyx_t_1) {
 
-    /* "resiliparse/extract/html2text.pyx":196
+    /* "resiliparse/extract/html2text.pyx":202
  *     # Alternative descriptions
  *     if ctx.opts.alt_texts and ctx.node.local_name in [LXB_TAG_IMG, LXB_TAG_AREA]:
  *         node_attr_data = get_node_attr_sv(ctx.node, b'alt')             # <<<<<<<<<<<<<<
  *         if not node_attr_data.empty():
  *             if not last_was_space:
  */
     __pyx_v_node_attr_data = __pyx_f_11resiliparse_5parse_4html_get_node_attr_sv(__pyx_v_ctx->node, __pyx_k_alt);
 
-    /* "resiliparse/extract/html2text.pyx":197
+    /* "resiliparse/extract/html2text.pyx":203
  *     if ctx.opts.alt_texts and ctx.node.local_name in [LXB_TAG_IMG, LXB_TAG_AREA]:
  *         node_attr_data = get_node_attr_sv(ctx.node, b'alt')
  *         if not node_attr_data.empty():             # <<<<<<<<<<<<<<
  *             if not last_was_space:
  *                 element_text.push_back(b' ')
  */
     __pyx_t_1 = ((!(__pyx_v_node_attr_data.empty() != 0)) != 0);
     if (__pyx_t_1) {
 
-      /* "resiliparse/extract/html2text.pyx":198
+      /* "resiliparse/extract/html2text.pyx":204
  *         node_attr_data = get_node_attr_sv(ctx.node, b'alt')
  *         if not node_attr_data.empty():
  *             if not last_was_space:             # <<<<<<<<<<<<<<
  *                 element_text.push_back(b' ')
  *             element_text.append(_get_collapsed_string(node_attr_data, ctx))
  */
       __pyx_t_1 = ((!(__pyx_v_last_was_space != 0)) != 0);
       if (__pyx_t_1) {
 
-        /* "resiliparse/extract/html2text.pyx":199
+        /* "resiliparse/extract/html2text.pyx":205
  *         if not node_attr_data.empty():
  *             if not last_was_space:
  *                 element_text.push_back(b' ')             # <<<<<<<<<<<<<<
  *             element_text.append(_get_collapsed_string(node_attr_data, ctx))
  *             element_text.push_back(b' ')
  */
         try {
@@ -3742,27 +3931,27 @@
           #ifdef WITH_THREAD
           PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
           #endif
           __Pyx_CppExn2PyErr();
           #ifdef WITH_THREAD
           __Pyx_PyGILState_Release(__pyx_gilstate_save);
           #endif
-          __PYX_ERR(0, 199, __pyx_L1_error)
+          __PYX_ERR(0, 205, __pyx_L1_error)
         }
 
-        /* "resiliparse/extract/html2text.pyx":198
+        /* "resiliparse/extract/html2text.pyx":204
  *         node_attr_data = get_node_attr_sv(ctx.node, b'alt')
  *         if not node_attr_data.empty():
  *             if not last_was_space:             # <<<<<<<<<<<<<<
  *                 element_text.push_back(b' ')
  *             element_text.append(_get_collapsed_string(node_attr_data, ctx))
  */
       }
 
-      /* "resiliparse/extract/html2text.pyx":200
+      /* "resiliparse/extract/html2text.pyx":206
  *             if not last_was_space:
  *                 element_text.push_back(b' ')
  *             element_text.append(_get_collapsed_string(node_attr_data, ctx))             # <<<<<<<<<<<<<<
  *             element_text.push_back(b' ')
  *             ctx.text.push_back(move(element_text))
  */
       try {
@@ -3771,18 +3960,18 @@
         #ifdef WITH_THREAD
         PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
         #endif
         __Pyx_CppExn2PyErr();
         #ifdef WITH_THREAD
         __Pyx_PyGILState_Release(__pyx_gilstate_save);
         #endif
-        __PYX_ERR(0, 200, __pyx_L1_error)
+        __PYX_ERR(0, 206, __pyx_L1_error)
       }
 
-      /* "resiliparse/extract/html2text.pyx":201
+      /* "resiliparse/extract/html2text.pyx":207
  *                 element_text.push_back(b' ')
  *             element_text.append(_get_collapsed_string(node_attr_data, ctx))
  *             element_text.push_back(b' ')             # <<<<<<<<<<<<<<
  *             ctx.text.push_back(move(element_text))
  *         return
  */
       try {
@@ -3791,18 +3980,18 @@
         #ifdef WITH_THREAD
         PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
         #endif
         __Pyx_CppExn2PyErr();
         #ifdef WITH_THREAD
         __Pyx_PyGILState_Release(__pyx_gilstate_save);
         #endif
-        __PYX_ERR(0, 201, __pyx_L1_error)
+        __PYX_ERR(0, 207, __pyx_L1_error)
       }
 
-      /* "resiliparse/extract/html2text.pyx":202
+      /* "resiliparse/extract/html2text.pyx":208
  *             element_text.append(_get_collapsed_string(node_attr_data, ctx))
  *             element_text.push_back(b' ')
  *             ctx.text.push_back(move(element_text))             # <<<<<<<<<<<<<<
  *         return
  * 
  */
       try {
@@ -3811,55 +4000,55 @@
         #ifdef WITH_THREAD
         PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
         #endif
         __Pyx_CppExn2PyErr();
         #ifdef WITH_THREAD
         __Pyx_PyGILState_Release(__pyx_gilstate_save);
         #endif
-        __PYX_ERR(0, 202, __pyx_L1_error)
+        __PYX_ERR(0, 208, __pyx_L1_error)
       }
 
-      /* "resiliparse/extract/html2text.pyx":197
+      /* "resiliparse/extract/html2text.pyx":203
  *     if ctx.opts.alt_texts and ctx.node.local_name in [LXB_TAG_IMG, LXB_TAG_AREA]:
  *         node_attr_data = get_node_attr_sv(ctx.node, b'alt')
  *         if not node_attr_data.empty():             # <<<<<<<<<<<<<<
  *             if not last_was_space:
  *                 element_text.push_back(b' ')
  */
     }
 
-    /* "resiliparse/extract/html2text.pyx":203
+    /* "resiliparse/extract/html2text.pyx":209
  *             element_text.push_back(b' ')
  *             ctx.text.push_back(move(element_text))
  *         return             # <<<<<<<<<<<<<<
  * 
  *     # Form field elements
  */
     goto __pyx_L0;
 
-    /* "resiliparse/extract/html2text.pyx":195
+    /* "resiliparse/extract/html2text.pyx":201
  * 
  *     # Alternative descriptions
  *     if ctx.opts.alt_texts and ctx.node.local_name in [LXB_TAG_IMG, LXB_TAG_AREA]:             # <<<<<<<<<<<<<<
  *         node_attr_data = get_node_attr_sv(ctx.node, b'alt')
  *         if not node_attr_data.empty():
  */
   }
 
-  /* "resiliparse/extract/html2text.pyx":206
+  /* "resiliparse/extract/html2text.pyx":212
  * 
  *     # Form field elements
  *     if ctx.opts.form_fields:             # <<<<<<<<<<<<<<
  *         if ctx.node.local_name in [LXB_TAG_TEXTAREA, LXB_TAG_BUTTON] and ctx.node.first_child:
  *             ctx.pre_depth += <int>ctx.node.local_name == LXB_TAG_TEXTAREA
  */
   __pyx_t_1 = (__pyx_v_ctx->opts.form_fields != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/extract/html2text.pyx":207
+    /* "resiliparse/extract/html2text.pyx":213
  *     # Form field elements
  *     if ctx.opts.form_fields:
  *         if ctx.node.local_name in [LXB_TAG_TEXTAREA, LXB_TAG_BUTTON] and ctx.node.first_child:             # <<<<<<<<<<<<<<
  *             ctx.pre_depth += <int>ctx.node.local_name == LXB_TAG_TEXTAREA
  *             if not last_was_space:
  */
     switch (__pyx_v_ctx->node->local_name) {
@@ -3871,41 +4060,41 @@
       __pyx_t_3 = 0;
       break;
     }
     __pyx_t_2 = (__pyx_t_3 != 0);
     if (__pyx_t_2) {
     } else {
       __pyx_t_1 = __pyx_t_2;
-      goto __pyx_L16_bool_binop_done;
+      goto __pyx_L18_bool_binop_done;
     }
     __pyx_t_2 = (__pyx_v_ctx->node->first_child != 0);
     __pyx_t_1 = __pyx_t_2;
-    __pyx_L16_bool_binop_done:;
+    __pyx_L18_bool_binop_done:;
     if (__pyx_t_1) {
 
-      /* "resiliparse/extract/html2text.pyx":208
+      /* "resiliparse/extract/html2text.pyx":214
  *     if ctx.opts.form_fields:
  *         if ctx.node.local_name in [LXB_TAG_TEXTAREA, LXB_TAG_BUTTON] and ctx.node.first_child:
  *             ctx.pre_depth += <int>ctx.node.local_name == LXB_TAG_TEXTAREA             # <<<<<<<<<<<<<<
  *             if not last_was_space:
  *                 element_text.push_back(<char>b' ')
  */
       __pyx_v_ctx->pre_depth = (__pyx_v_ctx->pre_depth + (((int)__pyx_v_ctx->node->local_name) == LXB_TAG_TEXTAREA));
 
-      /* "resiliparse/extract/html2text.pyx":209
+      /* "resiliparse/extract/html2text.pyx":215
  *         if ctx.node.local_name in [LXB_TAG_TEXTAREA, LXB_TAG_BUTTON] and ctx.node.first_child:
  *             ctx.pre_depth += <int>ctx.node.local_name == LXB_TAG_TEXTAREA
  *             if not last_was_space:             # <<<<<<<<<<<<<<
  *                 element_text.push_back(<char>b' ')
  *             element_text.append(b'[ ')
  */
       __pyx_t_1 = ((!(__pyx_v_last_was_space != 0)) != 0);
       if (__pyx_t_1) {
 
-        /* "resiliparse/extract/html2text.pyx":210
+        /* "resiliparse/extract/html2text.pyx":216
  *             ctx.pre_depth += <int>ctx.node.local_name == LXB_TAG_TEXTAREA
  *             if not last_was_space:
  *                 element_text.push_back(<char>b' ')             # <<<<<<<<<<<<<<
  *             element_text.append(b'[ ')
  *         elif ctx.node.local_name == LXB_TAG_INPUT:
  */
         try {
@@ -3914,27 +4103,27 @@
           #ifdef WITH_THREAD
           PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
           #endif
           __Pyx_CppExn2PyErr();
           #ifdef WITH_THREAD
           __Pyx_PyGILState_Release(__pyx_gilstate_save);
           #endif
-          __PYX_ERR(0, 210, __pyx_L1_error)
+          __PYX_ERR(0, 216, __pyx_L1_error)
         }
 
-        /* "resiliparse/extract/html2text.pyx":209
+        /* "resiliparse/extract/html2text.pyx":215
  *         if ctx.node.local_name in [LXB_TAG_TEXTAREA, LXB_TAG_BUTTON] and ctx.node.first_child:
  *             ctx.pre_depth += <int>ctx.node.local_name == LXB_TAG_TEXTAREA
  *             if not last_was_space:             # <<<<<<<<<<<<<<
  *                 element_text.push_back(<char>b' ')
  *             element_text.append(b'[ ')
  */
       }
 
-      /* "resiliparse/extract/html2text.pyx":211
+      /* "resiliparse/extract/html2text.pyx":217
  *             if not last_was_space:
  *                 element_text.push_back(<char>b' ')
  *             element_text.append(b'[ ')             # <<<<<<<<<<<<<<
  *         elif ctx.node.local_name == LXB_TAG_INPUT:
  *             node_attr_data = get_node_attr_sv(ctx.node, b'type')
  */
       try {
@@ -3943,156 +4132,156 @@
         #ifdef WITH_THREAD
         PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
         #endif
         __Pyx_CppExn2PyErr();
         #ifdef WITH_THREAD
         __Pyx_PyGILState_Release(__pyx_gilstate_save);
         #endif
-        __PYX_ERR(0, 211, __pyx_L1_error)
+        __PYX_ERR(0, 217, __pyx_L1_error)
       }
 
-      /* "resiliparse/extract/html2text.pyx":207
+      /* "resiliparse/extract/html2text.pyx":213
  *     # Form field elements
  *     if ctx.opts.form_fields:
  *         if ctx.node.local_name in [LXB_TAG_TEXTAREA, LXB_TAG_BUTTON] and ctx.node.first_child:             # <<<<<<<<<<<<<<
  *             ctx.pre_depth += <int>ctx.node.local_name == LXB_TAG_TEXTAREA
  *             if not last_was_space:
  */
-      goto __pyx_L15;
+      goto __pyx_L17;
     }
 
-    /* "resiliparse/extract/html2text.pyx":212
+    /* "resiliparse/extract/html2text.pyx":218
  *                 element_text.push_back(<char>b' ')
  *             element_text.append(b'[ ')
  *         elif ctx.node.local_name == LXB_TAG_INPUT:             # <<<<<<<<<<<<<<
  *             node_attr_data = get_node_attr_sv(ctx.node, b'type')
  *             if node_attr_data.empty() or node_attr_data not in \
  */
     __pyx_t_1 = ((__pyx_v_ctx->node->local_name == LXB_TAG_INPUT) != 0);
     if (__pyx_t_1) {
 
-      /* "resiliparse/extract/html2text.pyx":213
+      /* "resiliparse/extract/html2text.pyx":219
  *             element_text.append(b'[ ')
  *         elif ctx.node.local_name == LXB_TAG_INPUT:
  *             node_attr_data = get_node_attr_sv(ctx.node, b'type')             # <<<<<<<<<<<<<<
  *             if node_attr_data.empty() or node_attr_data not in \
  *                     [b'checkbox', b'color', b'file', b'hidden', b'radio', b'reset']:
  */
       __pyx_v_node_attr_data = __pyx_f_11resiliparse_5parse_4html_get_node_attr_sv(__pyx_v_ctx->node, __pyx_k_type);
 
-      /* "resiliparse/extract/html2text.pyx":214
+      /* "resiliparse/extract/html2text.pyx":220
  *         elif ctx.node.local_name == LXB_TAG_INPUT:
  *             node_attr_data = get_node_attr_sv(ctx.node, b'type')
  *             if node_attr_data.empty() or node_attr_data not in \             # <<<<<<<<<<<<<<
  *                     [b'checkbox', b'color', b'file', b'hidden', b'radio', b'reset']:
  *                 node_attr_data = get_node_attr_sv(ctx.node, b'value')
  */
       __pyx_t_2 = (__pyx_v_node_attr_data.empty() != 0);
       if (!__pyx_t_2) {
       } else {
         __pyx_t_1 = __pyx_t_2;
-        goto __pyx_L20_bool_binop_done;
+        goto __pyx_L22_bool_binop_done;
       }
       __pyx_t_4 = __pyx_v_node_attr_data;
       __pyx_t_3 = ((__pyx_t_4 != ((char const *)"checkbox")) != 0);
       if (__pyx_t_3) {
       } else {
         __pyx_t_2 = __pyx_t_3;
-        goto __pyx_L22_bool_binop_done;
+        goto __pyx_L24_bool_binop_done;
       }
       __pyx_t_3 = ((__pyx_t_4 != ((char const *)"color")) != 0);
       if (__pyx_t_3) {
       } else {
         __pyx_t_2 = __pyx_t_3;
-        goto __pyx_L22_bool_binop_done;
+        goto __pyx_L24_bool_binop_done;
       }
       __pyx_t_3 = ((__pyx_t_4 != ((char const *)"file")) != 0);
       if (__pyx_t_3) {
       } else {
         __pyx_t_2 = __pyx_t_3;
-        goto __pyx_L22_bool_binop_done;
+        goto __pyx_L24_bool_binop_done;
       }
       __pyx_t_3 = ((__pyx_t_4 != ((char const *)"hidden")) != 0);
       if (__pyx_t_3) {
       } else {
         __pyx_t_2 = __pyx_t_3;
-        goto __pyx_L22_bool_binop_done;
+        goto __pyx_L24_bool_binop_done;
       }
       __pyx_t_3 = ((__pyx_t_4 != ((char const *)"radio")) != 0);
       if (__pyx_t_3) {
       } else {
         __pyx_t_2 = __pyx_t_3;
-        goto __pyx_L22_bool_binop_done;
+        goto __pyx_L24_bool_binop_done;
       }
       __pyx_t_3 = ((__pyx_t_4 != ((char const *)"reset")) != 0);
       __pyx_t_2 = __pyx_t_3;
-      __pyx_L22_bool_binop_done:;
+      __pyx_L24_bool_binop_done:;
       __pyx_t_3 = (__pyx_t_2 != 0);
       __pyx_t_1 = __pyx_t_3;
-      __pyx_L20_bool_binop_done:;
+      __pyx_L22_bool_binop_done:;
       if (__pyx_t_1) {
 
-        /* "resiliparse/extract/html2text.pyx":216
+        /* "resiliparse/extract/html2text.pyx":222
  *             if node_attr_data.empty() or node_attr_data not in \
  *                     [b'checkbox', b'color', b'file', b'hidden', b'radio', b'reset']:
  *                 node_attr_data = get_node_attr_sv(ctx.node, b'value')             # <<<<<<<<<<<<<<
  *                 if node_attr_data.empty():
  *                     node_attr_data = get_node_attr_sv(ctx.node, b'placeholder')
  */
         __pyx_v_node_attr_data = __pyx_f_11resiliparse_5parse_4html_get_node_attr_sv(__pyx_v_ctx->node, __pyx_k_value);
 
-        /* "resiliparse/extract/html2text.pyx":217
+        /* "resiliparse/extract/html2text.pyx":223
  *                     [b'checkbox', b'color', b'file', b'hidden', b'radio', b'reset']:
  *                 node_attr_data = get_node_attr_sv(ctx.node, b'value')
  *                 if node_attr_data.empty():             # <<<<<<<<<<<<<<
  *                     node_attr_data = get_node_attr_sv(ctx.node, b'placeholder')
  *                 if not node_attr_data.empty():
  */
         __pyx_t_1 = (__pyx_v_node_attr_data.empty() != 0);
         if (__pyx_t_1) {
 
-          /* "resiliparse/extract/html2text.pyx":218
+          /* "resiliparse/extract/html2text.pyx":224
  *                 node_attr_data = get_node_attr_sv(ctx.node, b'value')
  *                 if node_attr_data.empty():
  *                     node_attr_data = get_node_attr_sv(ctx.node, b'placeholder')             # <<<<<<<<<<<<<<
  *                 if not node_attr_data.empty():
  *                     if not last_was_space:
  */
           __pyx_v_node_attr_data = __pyx_f_11resiliparse_5parse_4html_get_node_attr_sv(__pyx_v_ctx->node, __pyx_k_placeholder);
 
-          /* "resiliparse/extract/html2text.pyx":217
+          /* "resiliparse/extract/html2text.pyx":223
  *                     [b'checkbox', b'color', b'file', b'hidden', b'radio', b'reset']:
  *                 node_attr_data = get_node_attr_sv(ctx.node, b'value')
  *                 if node_attr_data.empty():             # <<<<<<<<<<<<<<
  *                     node_attr_data = get_node_attr_sv(ctx.node, b'placeholder')
  *                 if not node_attr_data.empty():
  */
         }
 
-        /* "resiliparse/extract/html2text.pyx":219
+        /* "resiliparse/extract/html2text.pyx":225
  *                 if node_attr_data.empty():
  *                     node_attr_data = get_node_attr_sv(ctx.node, b'placeholder')
  *                 if not node_attr_data.empty():             # <<<<<<<<<<<<<<
  *                     if not last_was_space:
  *                         element_text.push_back(<char>b' ')
  */
         __pyx_t_1 = ((!(__pyx_v_node_attr_data.empty() != 0)) != 0);
         if (__pyx_t_1) {
 
-          /* "resiliparse/extract/html2text.pyx":220
+          /* "resiliparse/extract/html2text.pyx":226
  *                     node_attr_data = get_node_attr_sv(ctx.node, b'placeholder')
  *                 if not node_attr_data.empty():
  *                     if not last_was_space:             # <<<<<<<<<<<<<<
  *                         element_text.push_back(<char>b' ')
  *                     element_text.append(b'[ ')
  */
           __pyx_t_1 = ((!(__pyx_v_last_was_space != 0)) != 0);
           if (__pyx_t_1) {
 
-            /* "resiliparse/extract/html2text.pyx":221
+            /* "resiliparse/extract/html2text.pyx":227
  *                 if not node_attr_data.empty():
  *                     if not last_was_space:
  *                         element_text.push_back(<char>b' ')             # <<<<<<<<<<<<<<
  *                     element_text.append(b'[ ')
  *                     element_text.append(_get_collapsed_string(node_attr_data, ctx))
  */
             try {
@@ -4101,27 +4290,27 @@
               #ifdef WITH_THREAD
               PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
               #endif
               __Pyx_CppExn2PyErr();
               #ifdef WITH_THREAD
               __Pyx_PyGILState_Release(__pyx_gilstate_save);
               #endif
-              __PYX_ERR(0, 221, __pyx_L1_error)
+              __PYX_ERR(0, 227, __pyx_L1_error)
             }
 
-            /* "resiliparse/extract/html2text.pyx":220
+            /* "resiliparse/extract/html2text.pyx":226
  *                     node_attr_data = get_node_attr_sv(ctx.node, b'placeholder')
  *                 if not node_attr_data.empty():
  *                     if not last_was_space:             # <<<<<<<<<<<<<<
  *                         element_text.push_back(<char>b' ')
  *                     element_text.append(b'[ ')
  */
           }
 
-          /* "resiliparse/extract/html2text.pyx":222
+          /* "resiliparse/extract/html2text.pyx":228
  *                     if not last_was_space:
  *                         element_text.push_back(<char>b' ')
  *                     element_text.append(b'[ ')             # <<<<<<<<<<<<<<
  *                     element_text.append(_get_collapsed_string(node_attr_data, ctx))
  *                     if not isspace(element_text.back()):
  */
           try {
@@ -4130,18 +4319,18 @@
             #ifdef WITH_THREAD
             PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
             #endif
             __Pyx_CppExn2PyErr();
             #ifdef WITH_THREAD
             __Pyx_PyGILState_Release(__pyx_gilstate_save);
             #endif
-            __PYX_ERR(0, 222, __pyx_L1_error)
+            __PYX_ERR(0, 228, __pyx_L1_error)
           }
 
-          /* "resiliparse/extract/html2text.pyx":223
+          /* "resiliparse/extract/html2text.pyx":229
  *                         element_text.push_back(<char>b' ')
  *                     element_text.append(b'[ ')
  *                     element_text.append(_get_collapsed_string(node_attr_data, ctx))             # <<<<<<<<<<<<<<
  *                     if not isspace(element_text.back()):
  *                         element_text.push_back(b' ')
  */
           try {
@@ -4150,28 +4339,28 @@
             #ifdef WITH_THREAD
             PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
             #endif
             __Pyx_CppExn2PyErr();
             #ifdef WITH_THREAD
             __Pyx_PyGILState_Release(__pyx_gilstate_save);
             #endif
-            __PYX_ERR(0, 223, __pyx_L1_error)
+            __PYX_ERR(0, 229, __pyx_L1_error)
           }
 
-          /* "resiliparse/extract/html2text.pyx":224
+          /* "resiliparse/extract/html2text.pyx":230
  *                     element_text.append(b'[ ')
  *                     element_text.append(_get_collapsed_string(node_attr_data, ctx))
  *                     if not isspace(element_text.back()):             # <<<<<<<<<<<<<<
  *                         element_text.push_back(b' ')
  *                     element_text.append(b'] ')
  */
           __pyx_t_1 = ((!(std::isspace(__pyx_v_element_text.back()) != 0)) != 0);
           if (__pyx_t_1) {
 
-            /* "resiliparse/extract/html2text.pyx":225
+            /* "resiliparse/extract/html2text.pyx":231
  *                     element_text.append(_get_collapsed_string(node_attr_data, ctx))
  *                     if not isspace(element_text.back()):
  *                         element_text.push_back(b' ')             # <<<<<<<<<<<<<<
  *                     element_text.append(b'] ')
  *                     ctx.text.push_back(move(element_text))
  */
             try {
@@ -4180,27 +4369,27 @@
               #ifdef WITH_THREAD
               PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
               #endif
               __Pyx_CppExn2PyErr();
               #ifdef WITH_THREAD
               __Pyx_PyGILState_Release(__pyx_gilstate_save);
               #endif
-              __PYX_ERR(0, 225, __pyx_L1_error)
+              __PYX_ERR(0, 231, __pyx_L1_error)
             }
 
-            /* "resiliparse/extract/html2text.pyx":224
+            /* "resiliparse/extract/html2text.pyx":230
  *                     element_text.append(b'[ ')
  *                     element_text.append(_get_collapsed_string(node_attr_data, ctx))
  *                     if not isspace(element_text.back()):             # <<<<<<<<<<<<<<
  *                         element_text.push_back(b' ')
  *                     element_text.append(b'] ')
  */
           }
 
-          /* "resiliparse/extract/html2text.pyx":226
+          /* "resiliparse/extract/html2text.pyx":232
  *                     if not isspace(element_text.back()):
  *                         element_text.push_back(b' ')
  *                     element_text.append(b'] ')             # <<<<<<<<<<<<<<
  *                     ctx.text.push_back(move(element_text))
  *                 return
  */
           try {
@@ -4209,18 +4398,18 @@
             #ifdef WITH_THREAD
             PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
             #endif
             __Pyx_CppExn2PyErr();
             #ifdef WITH_THREAD
             __Pyx_PyGILState_Release(__pyx_gilstate_save);
             #endif
-            __PYX_ERR(0, 226, __pyx_L1_error)
+            __PYX_ERR(0, 232, __pyx_L1_error)
           }
 
-          /* "resiliparse/extract/html2text.pyx":227
+          /* "resiliparse/extract/html2text.pyx":233
  *                         element_text.push_back(b' ')
  *                     element_text.append(b'] ')
  *                     ctx.text.push_back(move(element_text))             # <<<<<<<<<<<<<<
  *                 return
  * 
  */
           try {
@@ -4229,310 +4418,310 @@
             #ifdef WITH_THREAD
             PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
             #endif
             __Pyx_CppExn2PyErr();
             #ifdef WITH_THREAD
             __Pyx_PyGILState_Release(__pyx_gilstate_save);
             #endif
-            __PYX_ERR(0, 227, __pyx_L1_error)
+            __PYX_ERR(0, 233, __pyx_L1_error)
           }
 
-          /* "resiliparse/extract/html2text.pyx":219
+          /* "resiliparse/extract/html2text.pyx":225
  *                 if node_attr_data.empty():
  *                     node_attr_data = get_node_attr_sv(ctx.node, b'placeholder')
  *                 if not node_attr_data.empty():             # <<<<<<<<<<<<<<
  *                     if not last_was_space:
  *                         element_text.push_back(<char>b' ')
  */
         }
 
-        /* "resiliparse/extract/html2text.pyx":228
+        /* "resiliparse/extract/html2text.pyx":234
  *                     element_text.append(b'] ')
  *                     ctx.text.push_back(move(element_text))
  *                 return             # <<<<<<<<<<<<<<
  * 
  *     # Short-circuit empty blocks (such as <br>, <hr>, or empty <divs>)
  */
         goto __pyx_L0;
 
-        /* "resiliparse/extract/html2text.pyx":214
+        /* "resiliparse/extract/html2text.pyx":220
  *         elif ctx.node.local_name == LXB_TAG_INPUT:
  *             node_attr_data = get_node_attr_sv(ctx.node, b'type')
  *             if node_attr_data.empty() or node_attr_data not in \             # <<<<<<<<<<<<<<
  *                     [b'checkbox', b'color', b'file', b'hidden', b'radio', b'reset']:
  *                 node_attr_data = get_node_attr_sv(ctx.node, b'value')
  */
       }
 
-      /* "resiliparse/extract/html2text.pyx":212
+      /* "resiliparse/extract/html2text.pyx":218
  *                 element_text.push_back(<char>b' ')
  *             element_text.append(b'[ ')
  *         elif ctx.node.local_name == LXB_TAG_INPUT:             # <<<<<<<<<<<<<<
  *             node_attr_data = get_node_attr_sv(ctx.node, b'type')
  *             if node_attr_data.empty() or node_attr_data not in \
  */
     }
-    __pyx_L15:;
+    __pyx_L17:;
 
-    /* "resiliparse/extract/html2text.pyx":206
+    /* "resiliparse/extract/html2text.pyx":212
  * 
  *     # Form field elements
  *     if ctx.opts.form_fields:             # <<<<<<<<<<<<<<
  *         if ctx.node.local_name in [LXB_TAG_TEXTAREA, LXB_TAG_BUTTON] and ctx.node.first_child:
  *             ctx.pre_depth += <int>ctx.node.local_name == LXB_TAG_TEXTAREA
  */
   }
 
-  /* "resiliparse/extract/html2text.pyx":231
+  /* "resiliparse/extract/html2text.pyx":237
  * 
  *     # Short-circuit empty blocks (such as <br>, <hr>, or empty <divs>)
  *     if not ctx.opts.preserve_formatting or not ctx.node.first_child:             # <<<<<<<<<<<<<<
  *         if is_block_element(ctx.node.local_name):
  *             _make_block(ctx)
  */
   __pyx_t_3 = ((!(__pyx_v_ctx->opts.preserve_formatting != 0)) != 0);
   if (!__pyx_t_3) {
   } else {
     __pyx_t_1 = __pyx_t_3;
-    goto __pyx_L33_bool_binop_done;
+    goto __pyx_L35_bool_binop_done;
   }
   __pyx_t_3 = ((!(__pyx_v_ctx->node->first_child != 0)) != 0);
   __pyx_t_1 = __pyx_t_3;
-  __pyx_L33_bool_binop_done:;
+  __pyx_L35_bool_binop_done:;
   if (__pyx_t_1) {
 
-    /* "resiliparse/extract/html2text.pyx":232
+    /* "resiliparse/extract/html2text.pyx":238
  *     # Short-circuit empty blocks (such as <br>, <hr>, or empty <divs>)
  *     if not ctx.opts.preserve_formatting or not ctx.node.first_child:
  *         if is_block_element(ctx.node.local_name):             # <<<<<<<<<<<<<<
  *             _make_block(ctx)
  *         return
  */
     __pyx_t_1 = (__pyx_f_11resiliparse_5parse_4html_is_block_element(__pyx_v_ctx->node->local_name) != 0);
     if (__pyx_t_1) {
 
-      /* "resiliparse/extract/html2text.pyx":233
+      /* "resiliparse/extract/html2text.pyx":239
  *     if not ctx.opts.preserve_formatting or not ctx.node.first_child:
  *         if is_block_element(ctx.node.local_name):
  *             _make_block(ctx)             # <<<<<<<<<<<<<<
  *         return
  * 
  */
       __pyx_f_11resiliparse_7extract_9html2text__make_block(__pyx_v_ctx);
 
-      /* "resiliparse/extract/html2text.pyx":232
+      /* "resiliparse/extract/html2text.pyx":238
  *     # Short-circuit empty blocks (such as <br>, <hr>, or empty <divs>)
  *     if not ctx.opts.preserve_formatting or not ctx.node.first_child:
  *         if is_block_element(ctx.node.local_name):             # <<<<<<<<<<<<<<
  *             _make_block(ctx)
  *         return
  */
     }
 
-    /* "resiliparse/extract/html2text.pyx":234
+    /* "resiliparse/extract/html2text.pyx":240
  *         if is_block_element(ctx.node.local_name):
  *             _make_block(ctx)
  *         return             # <<<<<<<<<<<<<<
  * 
  *     cdef size_t tag_name_len
  */
     goto __pyx_L0;
 
-    /* "resiliparse/extract/html2text.pyx":231
+    /* "resiliparse/extract/html2text.pyx":237
  * 
  *     # Short-circuit empty blocks (such as <br>, <hr>, or empty <divs>)
  *     if not ctx.opts.preserve_formatting or not ctx.node.first_child:             # <<<<<<<<<<<<<<
  *         if is_block_element(ctx.node.local_name):
  *             _make_block(ctx)
  */
   }
 
-  /* "resiliparse/extract/html2text.pyx":237
+  /* "resiliparse/extract/html2text.pyx":243
  * 
  *     cdef size_t tag_name_len
  *     cdef const lxb_char_t* tag_name = lxb_dom_element_qualified_name(<lxb_dom_element_t*>ctx.node, &tag_name_len)             # <<<<<<<<<<<<<<
  * 
  *     # Block formatting
  */
   __pyx_v_tag_name = lxb_dom_element_qualified_name(((lxb_dom_element_t *)__pyx_v_ctx->node), (&__pyx_v_tag_name_len));
 
-  /* "resiliparse/extract/html2text.pyx":240
+  /* "resiliparse/extract/html2text.pyx":246
  * 
  *     # Block formatting
  *     if is_block_element(ctx.node.local_name):             # <<<<<<<<<<<<<<
  *         if ctx.node.local_name == LXB_TAG_LI:
  *             ctx.lstrip_next_block = False
  */
   __pyx_t_1 = (__pyx_f_11resiliparse_5parse_4html_is_block_element(__pyx_v_ctx->node->local_name) != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/extract/html2text.pyx":241
+    /* "resiliparse/extract/html2text.pyx":247
  *     # Block formatting
  *     if is_block_element(ctx.node.local_name):
  *         if ctx.node.local_name == LXB_TAG_LI:             # <<<<<<<<<<<<<<
  *             ctx.lstrip_next_block = False
  *             ctx.space_before_next_block = False
  */
     __pyx_t_1 = ((__pyx_v_ctx->node->local_name == LXB_TAG_LI) != 0);
     if (__pyx_t_1) {
 
-      /* "resiliparse/extract/html2text.pyx":242
+      /* "resiliparse/extract/html2text.pyx":248
  *     if is_block_element(ctx.node.local_name):
  *         if ctx.node.local_name == LXB_TAG_LI:
  *             ctx.lstrip_next_block = False             # <<<<<<<<<<<<<<
  *             ctx.space_before_next_block = False
  *         if ctx.node.local_name == LXB_TAG_UL and ctx.node.parent and ctx.node.parent.local_name == LXB_TAG_LI:
  */
       __pyx_v_ctx->lstrip_next_block = 0;
 
-      /* "resiliparse/extract/html2text.pyx":243
+      /* "resiliparse/extract/html2text.pyx":249
  *         if ctx.node.local_name == LXB_TAG_LI:
  *             ctx.lstrip_next_block = False
  *             ctx.space_before_next_block = False             # <<<<<<<<<<<<<<
  *         if ctx.node.local_name == LXB_TAG_UL and ctx.node.parent and ctx.node.parent.local_name == LXB_TAG_LI:
  *             ctx.newline_before_next_block = False
  */
       __pyx_v_ctx->space_before_next_block = 0;
 
-      /* "resiliparse/extract/html2text.pyx":241
+      /* "resiliparse/extract/html2text.pyx":247
  *     # Block formatting
  *     if is_block_element(ctx.node.local_name):
  *         if ctx.node.local_name == LXB_TAG_LI:             # <<<<<<<<<<<<<<
  *             ctx.lstrip_next_block = False
  *             ctx.space_before_next_block = False
  */
     }
 
-    /* "resiliparse/extract/html2text.pyx":244
+    /* "resiliparse/extract/html2text.pyx":250
  *             ctx.lstrip_next_block = False
  *             ctx.space_before_next_block = False
  *         if ctx.node.local_name == LXB_TAG_UL and ctx.node.parent and ctx.node.parent.local_name == LXB_TAG_LI:             # <<<<<<<<<<<<<<
  *             ctx.newline_before_next_block = False
  *         _make_block(ctx)
  */
     __pyx_t_3 = ((__pyx_v_ctx->node->local_name == LXB_TAG_UL) != 0);
     if (__pyx_t_3) {
     } else {
       __pyx_t_1 = __pyx_t_3;
-      goto __pyx_L39_bool_binop_done;
+      goto __pyx_L41_bool_binop_done;
     }
     __pyx_t_3 = (__pyx_v_ctx->node->parent != 0);
     if (__pyx_t_3) {
     } else {
       __pyx_t_1 = __pyx_t_3;
-      goto __pyx_L39_bool_binop_done;
+      goto __pyx_L41_bool_binop_done;
     }
     __pyx_t_3 = ((__pyx_v_ctx->node->parent->local_name == LXB_TAG_LI) != 0);
     __pyx_t_1 = __pyx_t_3;
-    __pyx_L39_bool_binop_done:;
+    __pyx_L41_bool_binop_done:;
     if (__pyx_t_1) {
 
-      /* "resiliparse/extract/html2text.pyx":245
+      /* "resiliparse/extract/html2text.pyx":251
  *             ctx.space_before_next_block = False
  *         if ctx.node.local_name == LXB_TAG_UL and ctx.node.parent and ctx.node.parent.local_name == LXB_TAG_LI:
  *             ctx.newline_before_next_block = False             # <<<<<<<<<<<<<<
  *         _make_block(ctx)
  * 
  */
       __pyx_v_ctx->newline_before_next_block = 0;
 
-      /* "resiliparse/extract/html2text.pyx":244
+      /* "resiliparse/extract/html2text.pyx":250
  *             ctx.lstrip_next_block = False
  *             ctx.space_before_next_block = False
  *         if ctx.node.local_name == LXB_TAG_UL and ctx.node.parent and ctx.node.parent.local_name == LXB_TAG_LI:             # <<<<<<<<<<<<<<
  *             ctx.newline_before_next_block = False
  *         _make_block(ctx)
  */
     }
 
-    /* "resiliparse/extract/html2text.pyx":246
+    /* "resiliparse/extract/html2text.pyx":252
  *         if ctx.node.local_name == LXB_TAG_UL and ctx.node.parent and ctx.node.parent.local_name == LXB_TAG_LI:
  *             ctx.newline_before_next_block = False
  *         _make_block(ctx)             # <<<<<<<<<<<<<<
  * 
  *     # Pre-formatted text
  */
     __pyx_f_11resiliparse_7extract_9html2text__make_block(__pyx_v_ctx);
 
-    /* "resiliparse/extract/html2text.pyx":240
+    /* "resiliparse/extract/html2text.pyx":246
  * 
  *     # Block formatting
  *     if is_block_element(ctx.node.local_name):             # <<<<<<<<<<<<<<
  *         if ctx.node.local_name == LXB_TAG_LI:
  *             ctx.lstrip_next_block = False
  */
   }
 
-  /* "resiliparse/extract/html2text.pyx":249
+  /* "resiliparse/extract/html2text.pyx":255
  * 
  *     # Pre-formatted text
  *     if ctx.node.local_name == LXB_TAG_PRE:             # <<<<<<<<<<<<<<
  *         ctx.pre_depth += 1
  * 
  */
   __pyx_t_1 = ((__pyx_v_ctx->node->local_name == LXB_TAG_PRE) != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/extract/html2text.pyx":250
+    /* "resiliparse/extract/html2text.pyx":256
  *     # Pre-formatted text
  *     if ctx.node.local_name == LXB_TAG_PRE:
  *         ctx.pre_depth += 1             # <<<<<<<<<<<<<<
  * 
  *     # Lists
  */
     __pyx_v_ctx->pre_depth = (__pyx_v_ctx->pre_depth + 1);
 
-    /* "resiliparse/extract/html2text.pyx":249
+    /* "resiliparse/extract/html2text.pyx":255
  * 
  *     # Pre-formatted text
  *     if ctx.node.local_name == LXB_TAG_PRE:             # <<<<<<<<<<<<<<
  *         ctx.pre_depth += 1
  * 
  */
   }
 
-  /* "resiliparse/extract/html2text.pyx":253
+  /* "resiliparse/extract/html2text.pyx":259
  * 
  *     # Lists
  *     if ctx.node.local_name == LXB_TAG_UL:             # <<<<<<<<<<<<<<
  *         preinc(ctx.list_depth)
  *     elif ctx.node.local_name == LXB_TAG_OL:
  */
   switch (__pyx_v_ctx->node->local_name) {
     case LXB_TAG_UL:
 
-    /* "resiliparse/extract/html2text.pyx":254
+    /* "resiliparse/extract/html2text.pyx":260
  *     # Lists
  *     if ctx.node.local_name == LXB_TAG_UL:
  *         preinc(ctx.list_depth)             # <<<<<<<<<<<<<<
  *     elif ctx.node.local_name == LXB_TAG_OL:
  *         preinc(ctx.list_depth)
  */
     (void)((++__pyx_v_ctx->list_depth));
 
-    /* "resiliparse/extract/html2text.pyx":253
+    /* "resiliparse/extract/html2text.pyx":259
  * 
  *     # Lists
  *     if ctx.node.local_name == LXB_TAG_UL:             # <<<<<<<<<<<<<<
  *         preinc(ctx.list_depth)
  *     elif ctx.node.local_name == LXB_TAG_OL:
  */
     break;
     case LXB_TAG_OL:
 
-    /* "resiliparse/extract/html2text.pyx":256
+    /* "resiliparse/extract/html2text.pyx":262
  *         preinc(ctx.list_depth)
  *     elif ctx.node.local_name == LXB_TAG_OL:
  *         preinc(ctx.list_depth)             # <<<<<<<<<<<<<<
  *         ctx.list_numbering.push_back(0)
  * 
  */
     (void)((++__pyx_v_ctx->list_depth));
 
-    /* "resiliparse/extract/html2text.pyx":257
+    /* "resiliparse/extract/html2text.pyx":263
  *     elif ctx.node.local_name == LXB_TAG_OL:
  *         preinc(ctx.list_depth)
  *         ctx.list_numbering.push_back(0)             # <<<<<<<<<<<<<<
  * 
  *     # List items
  */
     try {
@@ -4541,68 +4730,68 @@
       #ifdef WITH_THREAD
       PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
       #endif
       __Pyx_CppExn2PyErr();
       #ifdef WITH_THREAD
       __Pyx_PyGILState_Release(__pyx_gilstate_save);
       #endif
-      __PYX_ERR(0, 257, __pyx_L1_error)
+      __PYX_ERR(0, 263, __pyx_L1_error)
     }
 
-    /* "resiliparse/extract/html2text.pyx":255
+    /* "resiliparse/extract/html2text.pyx":261
  *     if ctx.node.local_name == LXB_TAG_UL:
  *         preinc(ctx.list_depth)
  *     elif ctx.node.local_name == LXB_TAG_OL:             # <<<<<<<<<<<<<<
  *         preinc(ctx.list_depth)
  *         ctx.list_numbering.push_back(0)
  */
     break;
     default: break;
   }
 
-  /* "resiliparse/extract/html2text.pyx":260
+  /* "resiliparse/extract/html2text.pyx":266
  * 
  *     # List items
  *     if ctx.node.local_name == LXB_TAG_LI:             # <<<<<<<<<<<<<<
  *         if ctx.opts.list_bullets:
  *             insert_list_indent(element_text, ctx)
  */
   __pyx_t_1 = ((__pyx_v_ctx->node->local_name == LXB_TAG_LI) != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/extract/html2text.pyx":261
+    /* "resiliparse/extract/html2text.pyx":267
  *     # List items
  *     if ctx.node.local_name == LXB_TAG_LI:
  *         if ctx.opts.list_bullets:             # <<<<<<<<<<<<<<
  *             insert_list_indent(element_text, ctx)
  *             if ctx.node.parent.local_name == LXB_TAG_OL:
  */
     __pyx_t_1 = (__pyx_v_ctx->opts.list_bullets != 0);
     if (__pyx_t_1) {
 
-      /* "resiliparse/extract/html2text.pyx":262
+      /* "resiliparse/extract/html2text.pyx":268
  *     if ctx.node.local_name == LXB_TAG_LI:
  *         if ctx.opts.list_bullets:
  *             insert_list_indent(element_text, ctx)             # <<<<<<<<<<<<<<
  *             if ctx.node.parent.local_name == LXB_TAG_OL:
  *                 element_text.append(to_string(preinc(ctx.list_numbering.back())) + <const char*>b'. ')
  */
       __pyx_f_11resiliparse_7extract_9html2text_insert_list_indent(__pyx_v_element_text, __pyx_v_ctx);
 
-      /* "resiliparse/extract/html2text.pyx":263
+      /* "resiliparse/extract/html2text.pyx":269
  *         if ctx.opts.list_bullets:
  *             insert_list_indent(element_text, ctx)
  *             if ctx.node.parent.local_name == LXB_TAG_OL:             # <<<<<<<<<<<<<<
  *                 element_text.append(to_string(preinc(ctx.list_numbering.back())) + <const char*>b'. ')
  *             else:
  */
       __pyx_t_1 = ((__pyx_v_ctx->node->parent->local_name == LXB_TAG_OL) != 0);
       if (__pyx_t_1) {
 
-        /* "resiliparse/extract/html2text.pyx":264
+        /* "resiliparse/extract/html2text.pyx":270
  *             insert_list_indent(element_text, ctx)
  *             if ctx.node.parent.local_name == LXB_TAG_OL:
  *                 element_text.append(to_string(preinc(ctx.list_numbering.back())) + <const char*>b'. ')             # <<<<<<<<<<<<<<
  *             else:
  *                 element_text.append(LIST_BULLET)
  */
         try {
@@ -4611,52 +4800,52 @@
           #ifdef WITH_THREAD
           PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
           #endif
           __Pyx_CppExn2PyErr();
           #ifdef WITH_THREAD
           __Pyx_PyGILState_Release(__pyx_gilstate_save);
           #endif
-          __PYX_ERR(0, 264, __pyx_L1_error)
+          __PYX_ERR(0, 270, __pyx_L1_error)
         }
         try {
           __pyx_t_6 = (__pyx_t_5 + ((char const *)((char const *)". ")));
         } catch(...) {
           #ifdef WITH_THREAD
           PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
           #endif
           __Pyx_CppExn2PyErr();
           #ifdef WITH_THREAD
           __Pyx_PyGILState_Release(__pyx_gilstate_save);
           #endif
-          __PYX_ERR(0, 264, __pyx_L1_error)
+          __PYX_ERR(0, 270, __pyx_L1_error)
         }
         try {
           __pyx_v_element_text.append(__pyx_t_6);
         } catch(...) {
           #ifdef WITH_THREAD
           PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
           #endif
           __Pyx_CppExn2PyErr();
           #ifdef WITH_THREAD
           __Pyx_PyGILState_Release(__pyx_gilstate_save);
           #endif
-          __PYX_ERR(0, 264, __pyx_L1_error)
+          __PYX_ERR(0, 270, __pyx_L1_error)
         }
 
-        /* "resiliparse/extract/html2text.pyx":263
+        /* "resiliparse/extract/html2text.pyx":269
  *         if ctx.opts.list_bullets:
  *             insert_list_indent(element_text, ctx)
  *             if ctx.node.parent.local_name == LXB_TAG_OL:             # <<<<<<<<<<<<<<
  *                 element_text.append(to_string(preinc(ctx.list_numbering.back())) + <const char*>b'. ')
  *             else:
  */
-        goto __pyx_L45;
+        goto __pyx_L47;
       }
 
-      /* "resiliparse/extract/html2text.pyx":266
+      /* "resiliparse/extract/html2text.pyx":272
  *                 element_text.append(to_string(preinc(ctx.list_numbering.back())) + <const char*>b'. ')
  *             else:
  *                 element_text.append(LIST_BULLET)             # <<<<<<<<<<<<<<
  *             ctx.space_before_next_block = True
  *         ctx.lstrip_next_block = True
  */
       /*else*/ {
@@ -4666,66 +4855,66 @@
           #ifdef WITH_THREAD
           PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
           #endif
           __Pyx_CppExn2PyErr();
           #ifdef WITH_THREAD
           __Pyx_PyGILState_Release(__pyx_gilstate_save);
           #endif
-          __PYX_ERR(0, 266, __pyx_L1_error)
+          __PYX_ERR(0, 272, __pyx_L1_error)
         }
       }
-      __pyx_L45:;
+      __pyx_L47:;
 
-      /* "resiliparse/extract/html2text.pyx":267
+      /* "resiliparse/extract/html2text.pyx":273
  *             else:
  *                 element_text.append(LIST_BULLET)
  *             ctx.space_before_next_block = True             # <<<<<<<<<<<<<<
  *         ctx.lstrip_next_block = True
  * 
  */
       __pyx_v_ctx->space_before_next_block = 1;
 
-      /* "resiliparse/extract/html2text.pyx":261
+      /* "resiliparse/extract/html2text.pyx":267
  *     # List items
  *     if ctx.node.local_name == LXB_TAG_LI:
  *         if ctx.opts.list_bullets:             # <<<<<<<<<<<<<<
  *             insert_list_indent(element_text, ctx)
  *             if ctx.node.parent.local_name == LXB_TAG_OL:
  */
     }
 
-    /* "resiliparse/extract/html2text.pyx":268
+    /* "resiliparse/extract/html2text.pyx":274
  *                 element_text.append(LIST_BULLET)
  *             ctx.space_before_next_block = True
  *         ctx.lstrip_next_block = True             # <<<<<<<<<<<<<<
  * 
  *     if not element_text.empty():
  */
     __pyx_v_ctx->lstrip_next_block = 1;
 
-    /* "resiliparse/extract/html2text.pyx":260
+    /* "resiliparse/extract/html2text.pyx":266
  * 
  *     # List items
  *     if ctx.node.local_name == LXB_TAG_LI:             # <<<<<<<<<<<<<<
  *         if ctx.opts.list_bullets:
  *             insert_list_indent(element_text, ctx)
  */
   }
 
-  /* "resiliparse/extract/html2text.pyx":270
+  /* "resiliparse/extract/html2text.pyx":276
  *         ctx.lstrip_next_block = True
  * 
  *     if not element_text.empty():             # <<<<<<<<<<<<<<
  *         ctx.text.push_back(move(element_text))
  * 
  */
   __pyx_t_1 = ((!(__pyx_v_element_text.empty() != 0)) != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/extract/html2text.pyx":271
+    /* "resiliparse/extract/html2text.pyx":277
  * 
  *     if not element_text.empty():
  *         ctx.text.push_back(move(element_text))             # <<<<<<<<<<<<<<
  * 
  * 
  */
     try {
@@ -4734,42 +4923,42 @@
       #ifdef WITH_THREAD
       PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
       #endif
       __Pyx_CppExn2PyErr();
       #ifdef WITH_THREAD
       __Pyx_PyGILState_Release(__pyx_gilstate_save);
       #endif
-      __PYX_ERR(0, 271, __pyx_L1_error)
+      __PYX_ERR(0, 277, __pyx_L1_error)
     }
 
-    /* "resiliparse/extract/html2text.pyx":270
+    /* "resiliparse/extract/html2text.pyx":276
  *         ctx.lstrip_next_block = True
  * 
  *     if not element_text.empty():             # <<<<<<<<<<<<<<
  *         ctx.text.push_back(move(element_text))
  * 
  */
   }
 
-  /* "resiliparse/extract/html2text.pyx":166
+  /* "resiliparse/extract/html2text.pyx":171
  * 
  * 
  * cdef void _extract_start_cb(ExtractContext* ctx) nogil:             # <<<<<<<<<<<<<<
  *     """Extraction start element callback."""
  *     cdef lxb_dom_character_data_t* node_char_data = NULL
  */
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_WriteUnraisable("resiliparse.extract.html2text._extract_start_cb", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 1);
   __pyx_L0:;
 }
 
-/* "resiliparse/extract/html2text.pyx":274
+/* "resiliparse/extract/html2text.pyx":280
  * 
  * 
  * cdef void _extract_end_cb(ExtractContext* ctx) nogil:             # <<<<<<<<<<<<<<
  *     """Extraction end element callback."""
  *     if ctx.node.type != LXB_DOM_NODE_TYPE_ELEMENT or not ctx.opts.preserve_formatting:
  */
 
@@ -4779,15 +4968,15 @@
   int __pyx_t_1;
   int __pyx_t_2;
   int __pyx_t_3;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
 
-  /* "resiliparse/extract/html2text.pyx":276
+  /* "resiliparse/extract/html2text.pyx":282
  * cdef void _extract_end_cb(ExtractContext* ctx) nogil:
  *     """Extraction end element callback."""
  *     if ctx.node.type != LXB_DOM_NODE_TYPE_ELEMENT or not ctx.opts.preserve_formatting:             # <<<<<<<<<<<<<<
  *         return
  * 
  */
   __pyx_t_2 = ((__pyx_v_ctx->node->type != LXB_DOM_NODE_TYPE_ELEMENT) != 0);
@@ -4797,43 +4986,43 @@
     goto __pyx_L4_bool_binop_done;
   }
   __pyx_t_2 = ((!(__pyx_v_ctx->opts.preserve_formatting != 0)) != 0);
   __pyx_t_1 = __pyx_t_2;
   __pyx_L4_bool_binop_done:;
   if (__pyx_t_1) {
 
-    /* "resiliparse/extract/html2text.pyx":277
+    /* "resiliparse/extract/html2text.pyx":283
  *     """Extraction end element callback."""
  *     if ctx.node.type != LXB_DOM_NODE_TYPE_ELEMENT or not ctx.opts.preserve_formatting:
  *         return             # <<<<<<<<<<<<<<
  * 
  *     if ctx.text.empty():
  */
     goto __pyx_L0;
 
-    /* "resiliparse/extract/html2text.pyx":276
+    /* "resiliparse/extract/html2text.pyx":282
  * cdef void _extract_end_cb(ExtractContext* ctx) nogil:
  *     """Extraction end element callback."""
  *     if ctx.node.type != LXB_DOM_NODE_TYPE_ELEMENT or not ctx.opts.preserve_formatting:             # <<<<<<<<<<<<<<
  *         return
  * 
  */
   }
 
-  /* "resiliparse/extract/html2text.pyx":279
+  /* "resiliparse/extract/html2text.pyx":285
  *         return
  * 
  *     if ctx.text.empty():             # <<<<<<<<<<<<<<
  *         ctx.text.push_back(<const char*>b'')
  * 
  */
   __pyx_t_1 = (__pyx_v_ctx->text.empty() != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/extract/html2text.pyx":280
+    /* "resiliparse/extract/html2text.pyx":286
  * 
  *     if ctx.text.empty():
  *         ctx.text.push_back(<const char*>b'')             # <<<<<<<<<<<<<<
  * 
  *     # Headings and paragraphs insert newlines
  */
     try {
@@ -4842,27 +5031,27 @@
       #ifdef WITH_THREAD
       PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
       #endif
       __Pyx_CppExn2PyErr();
       #ifdef WITH_THREAD
       __Pyx_PyGILState_Release(__pyx_gilstate_save);
       #endif
-      __PYX_ERR(0, 280, __pyx_L1_error)
+      __PYX_ERR(0, 286, __pyx_L1_error)
     }
 
-    /* "resiliparse/extract/html2text.pyx":279
+    /* "resiliparse/extract/html2text.pyx":285
  *         return
  * 
  *     if ctx.text.empty():             # <<<<<<<<<<<<<<
  *         ctx.text.push_back(<const char*>b'')
  * 
  */
   }
 
-  /* "resiliparse/extract/html2text.pyx":283
+  /* "resiliparse/extract/html2text.pyx":289
  * 
  *     # Headings and paragraphs insert newlines
  *     if ctx.node.local_name in [LXB_TAG_H1, LXB_TAG_H2, LXB_TAG_H3, LXB_TAG_H4, LXB_TAG_H5, LXB_TAG_H6, LXB_TAG_P]:             # <<<<<<<<<<<<<<
  *         ctx.newline_before_next_block = True
  * 
  */
   switch (__pyx_v_ctx->node->local_name) {
@@ -4870,121 +5059,121 @@
     case LXB_TAG_H2:
     case LXB_TAG_H3:
     case LXB_TAG_H4:
     case LXB_TAG_H5:
     case LXB_TAG_H6:
     case LXB_TAG_P:
 
-    /* "resiliparse/extract/html2text.pyx":284
+    /* "resiliparse/extract/html2text.pyx":290
  *     # Headings and paragraphs insert newlines
  *     if ctx.node.local_name in [LXB_TAG_H1, LXB_TAG_H2, LXB_TAG_H3, LXB_TAG_H4, LXB_TAG_H5, LXB_TAG_H6, LXB_TAG_P]:
  *         ctx.newline_before_next_block = True             # <<<<<<<<<<<<<<
  * 
  *     # Pre-formatted text
  */
     __pyx_v_ctx->newline_before_next_block = 1;
 
-    /* "resiliparse/extract/html2text.pyx":283
+    /* "resiliparse/extract/html2text.pyx":289
  * 
  *     # Headings and paragraphs insert newlines
  *     if ctx.node.local_name in [LXB_TAG_H1, LXB_TAG_H2, LXB_TAG_H3, LXB_TAG_H4, LXB_TAG_H5, LXB_TAG_H6, LXB_TAG_P]:             # <<<<<<<<<<<<<<
  *         ctx.newline_before_next_block = True
  * 
  */
     break;
     default: break;
   }
 
-  /* "resiliparse/extract/html2text.pyx":287
+  /* "resiliparse/extract/html2text.pyx":293
  * 
  *     # Pre-formatted text
  *     if ctx.node.local_name == LXB_TAG_PRE:             # <<<<<<<<<<<<<<
  *         ctx.pre_depth -= 1
  * 
  */
   __pyx_t_1 = ((__pyx_v_ctx->node->local_name == LXB_TAG_PRE) != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/extract/html2text.pyx":288
+    /* "resiliparse/extract/html2text.pyx":294
  *     # Pre-formatted text
  *     if ctx.node.local_name == LXB_TAG_PRE:
  *         ctx.pre_depth -= 1             # <<<<<<<<<<<<<<
  * 
  *     # Lists
  */
     __pyx_v_ctx->pre_depth = (__pyx_v_ctx->pre_depth - 1);
 
-    /* "resiliparse/extract/html2text.pyx":287
+    /* "resiliparse/extract/html2text.pyx":293
  * 
  *     # Pre-formatted text
  *     if ctx.node.local_name == LXB_TAG_PRE:             # <<<<<<<<<<<<<<
  *         ctx.pre_depth -= 1
  * 
  */
   }
 
-  /* "resiliparse/extract/html2text.pyx":291
+  /* "resiliparse/extract/html2text.pyx":297
  * 
  *     # Lists
  *     if ctx.node.local_name == LXB_TAG_UL:             # <<<<<<<<<<<<<<
  *         predec(ctx.list_depth)
  *     elif ctx.node.local_name == LXB_TAG_OL:
  */
   switch (__pyx_v_ctx->node->local_name) {
     case LXB_TAG_UL:
 
-    /* "resiliparse/extract/html2text.pyx":292
+    /* "resiliparse/extract/html2text.pyx":298
  *     # Lists
  *     if ctx.node.local_name == LXB_TAG_UL:
  *         predec(ctx.list_depth)             # <<<<<<<<<<<<<<
  *     elif ctx.node.local_name == LXB_TAG_OL:
  *         predec(ctx.list_depth)
  */
     (void)((--__pyx_v_ctx->list_depth));
 
-    /* "resiliparse/extract/html2text.pyx":291
+    /* "resiliparse/extract/html2text.pyx":297
  * 
  *     # Lists
  *     if ctx.node.local_name == LXB_TAG_UL:             # <<<<<<<<<<<<<<
  *         predec(ctx.list_depth)
  *     elif ctx.node.local_name == LXB_TAG_OL:
  */
     break;
     case LXB_TAG_OL:
 
-    /* "resiliparse/extract/html2text.pyx":294
+    /* "resiliparse/extract/html2text.pyx":300
  *         predec(ctx.list_depth)
  *     elif ctx.node.local_name == LXB_TAG_OL:
  *         predec(ctx.list_depth)             # <<<<<<<<<<<<<<
  *         ctx.list_numbering.pop_back()
  * 
  */
     (void)((--__pyx_v_ctx->list_depth));
 
-    /* "resiliparse/extract/html2text.pyx":295
+    /* "resiliparse/extract/html2text.pyx":301
  *     elif ctx.node.local_name == LXB_TAG_OL:
  *         predec(ctx.list_depth)
  *         ctx.list_numbering.pop_back()             # <<<<<<<<<<<<<<
  * 
  *     # Forms
  */
     __pyx_v_ctx->list_numbering.pop_back();
 
-    /* "resiliparse/extract/html2text.pyx":293
+    /* "resiliparse/extract/html2text.pyx":299
  *     if ctx.node.local_name == LXB_TAG_UL:
  *         predec(ctx.list_depth)
  *     elif ctx.node.local_name == LXB_TAG_OL:             # <<<<<<<<<<<<<<
  *         predec(ctx.list_depth)
  *         ctx.list_numbering.pop_back()
  */
     break;
     default: break;
   }
 
-  /* "resiliparse/extract/html2text.pyx":298
+  /* "resiliparse/extract/html2text.pyx":304
  * 
  *     # Forms
  *     if ctx.opts.form_fields and ctx.node.local_name in [LXB_TAG_TEXTAREA, LXB_TAG_BUTTON]:             # <<<<<<<<<<<<<<
  *         ctx.pre_depth -= <int>ctx.node.local_name == LXB_TAG_TEXTAREA
  *         if not isspace(ctx.text.back().back()):
  */
   __pyx_t_2 = (__pyx_v_ctx->opts.form_fields != 0);
@@ -5003,34 +5192,34 @@
     break;
   }
   __pyx_t_3 = (__pyx_t_2 != 0);
   __pyx_t_1 = __pyx_t_3;
   __pyx_L9_bool_binop_done:;
   if (__pyx_t_1) {
 
-    /* "resiliparse/extract/html2text.pyx":299
+    /* "resiliparse/extract/html2text.pyx":305
  *     # Forms
  *     if ctx.opts.form_fields and ctx.node.local_name in [LXB_TAG_TEXTAREA, LXB_TAG_BUTTON]:
  *         ctx.pre_depth -= <int>ctx.node.local_name == LXB_TAG_TEXTAREA             # <<<<<<<<<<<<<<
  *         if not isspace(ctx.text.back().back()):
  *             ctx.text.back().push_back(b' ')
  */
     __pyx_v_ctx->pre_depth = (__pyx_v_ctx->pre_depth - (((int)__pyx_v_ctx->node->local_name) == LXB_TAG_TEXTAREA));
 
-    /* "resiliparse/extract/html2text.pyx":300
+    /* "resiliparse/extract/html2text.pyx":306
  *     if ctx.opts.form_fields and ctx.node.local_name in [LXB_TAG_TEXTAREA, LXB_TAG_BUTTON]:
  *         ctx.pre_depth -= <int>ctx.node.local_name == LXB_TAG_TEXTAREA
  *         if not isspace(ctx.text.back().back()):             # <<<<<<<<<<<<<<
  *             ctx.text.back().push_back(b' ')
  *         ctx.text.back().append(b'] ')
  */
     __pyx_t_1 = ((!(std::isspace(__pyx_v_ctx->text.back().back()) != 0)) != 0);
     if (__pyx_t_1) {
 
-      /* "resiliparse/extract/html2text.pyx":301
+      /* "resiliparse/extract/html2text.pyx":307
  *         ctx.pre_depth -= <int>ctx.node.local_name == LXB_TAG_TEXTAREA
  *         if not isspace(ctx.text.back().back()):
  *             ctx.text.back().push_back(b' ')             # <<<<<<<<<<<<<<
  *         ctx.text.back().append(b'] ')
  * 
  */
       try {
@@ -5039,134 +5228,150 @@
         #ifdef WITH_THREAD
         PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
         #endif
         __Pyx_CppExn2PyErr();
         #ifdef WITH_THREAD
         __Pyx_PyGILState_Release(__pyx_gilstate_save);
         #endif
-        __PYX_ERR(0, 301, __pyx_L1_error)
+        __PYX_ERR(0, 307, __pyx_L1_error)
       }
 
-      /* "resiliparse/extract/html2text.pyx":300
+      /* "resiliparse/extract/html2text.pyx":306
  *     if ctx.opts.form_fields and ctx.node.local_name in [LXB_TAG_TEXTAREA, LXB_TAG_BUTTON]:
  *         ctx.pre_depth -= <int>ctx.node.local_name == LXB_TAG_TEXTAREA
  *         if not isspace(ctx.text.back().back()):             # <<<<<<<<<<<<<<
  *             ctx.text.back().push_back(b' ')
  *         ctx.text.back().append(b'] ')
  */
     }
 
-    /* "resiliparse/extract/html2text.pyx":302
+    /* "resiliparse/extract/html2text.pyx":308
  *         if not isspace(ctx.text.back().back()):
  *             ctx.text.back().push_back(b' ')
  *         ctx.text.back().append(b'] ')             # <<<<<<<<<<<<<<
  * 
- *     # Add tabs between table cells
+ *     # Strip whitespace between table cells
  */
     try {
       __pyx_v_ctx->text.back().append(((char const *)"] "));
     } catch(...) {
       #ifdef WITH_THREAD
       PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
       #endif
       __Pyx_CppExn2PyErr();
       #ifdef WITH_THREAD
       __Pyx_PyGILState_Release(__pyx_gilstate_save);
       #endif
-      __PYX_ERR(0, 302, __pyx_L1_error)
+      __PYX_ERR(0, 308, __pyx_L1_error)
     }
 
-    /* "resiliparse/extract/html2text.pyx":298
+    /* "resiliparse/extract/html2text.pyx":304
  * 
  *     # Forms
  *     if ctx.opts.form_fields and ctx.node.local_name in [LXB_TAG_TEXTAREA, LXB_TAG_BUTTON]:             # <<<<<<<<<<<<<<
  *         ctx.pre_depth -= <int>ctx.node.local_name == LXB_TAG_TEXTAREA
  *         if not isspace(ctx.text.back().back()):
  */
   }
 
-  /* "resiliparse/extract/html2text.pyx":305
+  /* "resiliparse/extract/html2text.pyx":311
  * 
- *     # Add tabs between table cells
+ *     # Strip whitespace between table cells
  *     if ctx.node.local_name in [LXB_TAG_TD, LXB_TAG_TH]:             # <<<<<<<<<<<<<<
- *         ctx.text.back().append(b'\t\t')
- * 
+ *         ctx.tab_before_next_block = True
+ *         ctx.lstrip_next_block = True
  */
   switch (__pyx_v_ctx->node->local_name) {
     case LXB_TAG_TD:
     case LXB_TAG_TH:
 
-    /* "resiliparse/extract/html2text.pyx":306
- *     # Add tabs between table cells
+    /* "resiliparse/extract/html2text.pyx":312
+ *     # Strip whitespace between table cells
  *     if ctx.node.local_name in [LXB_TAG_TD, LXB_TAG_TH]:
- *         ctx.text.back().append(b'\t\t')             # <<<<<<<<<<<<<<
+ *         ctx.tab_before_next_block = True             # <<<<<<<<<<<<<<
+ *         ctx.lstrip_next_block = True
+ * 
+ */
+    __pyx_v_ctx->tab_before_next_block = 1;
+
+    /* "resiliparse/extract/html2text.pyx":313
+ *     if ctx.node.local_name in [LXB_TAG_TD, LXB_TAG_TH]:
+ *         ctx.tab_before_next_block = True
+ *         ctx.lstrip_next_block = True             # <<<<<<<<<<<<<<
  * 
  *     # No additional white space after table rows
  */
-    try {
-      __pyx_v_ctx->text.back().append(((char const *)"\t\t"));
-    } catch(...) {
-      #ifdef WITH_THREAD
-      PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
-      #endif
-      __Pyx_CppExn2PyErr();
-      #ifdef WITH_THREAD
-      __Pyx_PyGILState_Release(__pyx_gilstate_save);
-      #endif
-      __PYX_ERR(0, 306, __pyx_L1_error)
-    }
+    __pyx_v_ctx->lstrip_next_block = 1;
 
-    /* "resiliparse/extract/html2text.pyx":305
+    /* "resiliparse/extract/html2text.pyx":311
  * 
- *     # Add tabs between table cells
+ *     # Strip whitespace between table cells
  *     if ctx.node.local_name in [LXB_TAG_TD, LXB_TAG_TH]:             # <<<<<<<<<<<<<<
- *         ctx.text.back().append(b'\t\t')
- * 
+ *         ctx.tab_before_next_block = True
+ *         ctx.lstrip_next_block = True
  */
     break;
     default: break;
   }
 
-  /* "resiliparse/extract/html2text.pyx":309
+  /* "resiliparse/extract/html2text.pyx":316
  * 
  *     # No additional white space after table rows
  *     if ctx.node.local_name == LXB_TAG_TR and not ctx.text.empty():             # <<<<<<<<<<<<<<
+ *         ctx.tab_before_next_block = False
  *         ctx.newline_before_next_block = False
- * 
  */
   __pyx_t_3 = ((__pyx_v_ctx->node->local_name == LXB_TAG_TR) != 0);
   if (__pyx_t_3) {
   } else {
     __pyx_t_1 = __pyx_t_3;
     goto __pyx_L13_bool_binop_done;
   }
   __pyx_t_3 = ((!(__pyx_v_ctx->text.empty() != 0)) != 0);
   __pyx_t_1 = __pyx_t_3;
   __pyx_L13_bool_binop_done:;
   if (__pyx_t_1) {
 
-    /* "resiliparse/extract/html2text.pyx":310
+    /* "resiliparse/extract/html2text.pyx":317
  *     # No additional white space after table rows
  *     if ctx.node.local_name == LXB_TAG_TR and not ctx.text.empty():
+ *         ctx.tab_before_next_block = False             # <<<<<<<<<<<<<<
+ *         ctx.newline_before_next_block = False
+ *         ctx.lstrip_next_block = False
+ */
+    __pyx_v_ctx->tab_before_next_block = 0;
+
+    /* "resiliparse/extract/html2text.pyx":318
+ *     if ctx.node.local_name == LXB_TAG_TR and not ctx.text.empty():
+ *         ctx.tab_before_next_block = False
  *         ctx.newline_before_next_block = False             # <<<<<<<<<<<<<<
+ *         ctx.lstrip_next_block = False
  * 
- *     # Link targets
  */
     __pyx_v_ctx->newline_before_next_block = 0;
 
-    /* "resiliparse/extract/html2text.pyx":309
+    /* "resiliparse/extract/html2text.pyx":319
+ *         ctx.tab_before_next_block = False
+ *         ctx.newline_before_next_block = False
+ *         ctx.lstrip_next_block = False             # <<<<<<<<<<<<<<
+ * 
+ *     # Link targets
+ */
+    __pyx_v_ctx->lstrip_next_block = 0;
+
+    /* "resiliparse/extract/html2text.pyx":316
  * 
  *     # No additional white space after table rows
  *     if ctx.node.local_name == LXB_TAG_TR and not ctx.text.empty():             # <<<<<<<<<<<<<<
+ *         ctx.tab_before_next_block = False
  *         ctx.newline_before_next_block = False
- * 
  */
   }
 
-  /* "resiliparse/extract/html2text.pyx":314
+  /* "resiliparse/extract/html2text.pyx":323
  *     # Link targets
  *     cdef string_view link_href
  *     if ctx.opts.links and ctx.node.local_name == LXB_TAG_A:             # <<<<<<<<<<<<<<
  *         link_href = get_node_attr_sv(ctx.node, b'href')
  *         if not link_href.empty():
  */
   __pyx_t_3 = (__pyx_v_ctx->opts.links != 0);
@@ -5176,44 +5381,44 @@
     goto __pyx_L16_bool_binop_done;
   }
   __pyx_t_3 = ((__pyx_v_ctx->node->local_name == LXB_TAG_A) != 0);
   __pyx_t_1 = __pyx_t_3;
   __pyx_L16_bool_binop_done:;
   if (__pyx_t_1) {
 
-    /* "resiliparse/extract/html2text.pyx":315
+    /* "resiliparse/extract/html2text.pyx":324
  *     cdef string_view link_href
  *     if ctx.opts.links and ctx.node.local_name == LXB_TAG_A:
  *         link_href = get_node_attr_sv(ctx.node, b'href')             # <<<<<<<<<<<<<<
  *         if not link_href.empty():
  *             if not isspace(ctx.text.back().back()):
  */
     __pyx_v_link_href = __pyx_f_11resiliparse_5parse_4html_get_node_attr_sv(__pyx_v_ctx->node, __pyx_k_href);
 
-    /* "resiliparse/extract/html2text.pyx":316
+    /* "resiliparse/extract/html2text.pyx":325
  *     if ctx.opts.links and ctx.node.local_name == LXB_TAG_A:
  *         link_href = get_node_attr_sv(ctx.node, b'href')
  *         if not link_href.empty():             # <<<<<<<<<<<<<<
  *             if not isspace(ctx.text.back().back()):
  *                 ctx.text.back().push_back(b' ')
  */
     __pyx_t_1 = ((!(__pyx_v_link_href.empty() != 0)) != 0);
     if (__pyx_t_1) {
 
-      /* "resiliparse/extract/html2text.pyx":317
+      /* "resiliparse/extract/html2text.pyx":326
  *         link_href = get_node_attr_sv(ctx.node, b'href')
  *         if not link_href.empty():
  *             if not isspace(ctx.text.back().back()):             # <<<<<<<<<<<<<<
  *                 ctx.text.back().push_back(b' ')
  *             ctx.text.back().push_back(b'(')
  */
       __pyx_t_1 = ((!(std::isspace(__pyx_v_ctx->text.back().back()) != 0)) != 0);
       if (__pyx_t_1) {
 
-        /* "resiliparse/extract/html2text.pyx":318
+        /* "resiliparse/extract/html2text.pyx":327
  *         if not link_href.empty():
  *             if not isspace(ctx.text.back().back()):
  *                 ctx.text.back().push_back(b' ')             # <<<<<<<<<<<<<<
  *             ctx.text.back().push_back(b'(')
  *             ctx.text.back().append(_get_collapsed_string(link_href, ctx))
  */
         try {
@@ -5222,27 +5427,27 @@
           #ifdef WITH_THREAD
           PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
           #endif
           __Pyx_CppExn2PyErr();
           #ifdef WITH_THREAD
           __Pyx_PyGILState_Release(__pyx_gilstate_save);
           #endif
-          __PYX_ERR(0, 318, __pyx_L1_error)
+          __PYX_ERR(0, 327, __pyx_L1_error)
         }
 
-        /* "resiliparse/extract/html2text.pyx":317
+        /* "resiliparse/extract/html2text.pyx":326
  *         link_href = get_node_attr_sv(ctx.node, b'href')
  *         if not link_href.empty():
  *             if not isspace(ctx.text.back().back()):             # <<<<<<<<<<<<<<
  *                 ctx.text.back().push_back(b' ')
  *             ctx.text.back().push_back(b'(')
  */
       }
 
-      /* "resiliparse/extract/html2text.pyx":319
+      /* "resiliparse/extract/html2text.pyx":328
  *             if not isspace(ctx.text.back().back()):
  *                 ctx.text.back().push_back(b' ')
  *             ctx.text.back().push_back(b'(')             # <<<<<<<<<<<<<<
  *             ctx.text.back().append(_get_collapsed_string(link_href, ctx))
  *             ctx.text.back().append(b')')
  */
       try {
@@ -5251,18 +5456,18 @@
         #ifdef WITH_THREAD
         PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
         #endif
         __Pyx_CppExn2PyErr();
         #ifdef WITH_THREAD
         __Pyx_PyGILState_Release(__pyx_gilstate_save);
         #endif
-        __PYX_ERR(0, 319, __pyx_L1_error)
+        __PYX_ERR(0, 328, __pyx_L1_error)
       }
 
-      /* "resiliparse/extract/html2text.pyx":320
+      /* "resiliparse/extract/html2text.pyx":329
  *                 ctx.text.back().push_back(b' ')
  *             ctx.text.back().push_back(b'(')
  *             ctx.text.back().append(_get_collapsed_string(link_href, ctx))             # <<<<<<<<<<<<<<
  *             ctx.text.back().append(b')')
  * 
  */
       try {
@@ -5271,18 +5476,18 @@
         #ifdef WITH_THREAD
         PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
         #endif
         __Pyx_CppExn2PyErr();
         #ifdef WITH_THREAD
         __Pyx_PyGILState_Release(__pyx_gilstate_save);
         #endif
-        __PYX_ERR(0, 320, __pyx_L1_error)
+        __PYX_ERR(0, 329, __pyx_L1_error)
       }
 
-      /* "resiliparse/extract/html2text.pyx":321
+      /* "resiliparse/extract/html2text.pyx":330
  *             ctx.text.back().push_back(b'(')
  *             ctx.text.back().append(_get_collapsed_string(link_href, ctx))
  *             ctx.text.back().append(b')')             # <<<<<<<<<<<<<<
  * 
  *     cdef string stripped
  */
       try {
@@ -5291,66 +5496,66 @@
         #ifdef WITH_THREAD
         PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
         #endif
         __Pyx_CppExn2PyErr();
         #ifdef WITH_THREAD
         __Pyx_PyGILState_Release(__pyx_gilstate_save);
         #endif
-        __PYX_ERR(0, 321, __pyx_L1_error)
+        __PYX_ERR(0, 330, __pyx_L1_error)
       }
 
-      /* "resiliparse/extract/html2text.pyx":316
+      /* "resiliparse/extract/html2text.pyx":325
  *     if ctx.opts.links and ctx.node.local_name == LXB_TAG_A:
  *         link_href = get_node_attr_sv(ctx.node, b'href')
  *         if not link_href.empty():             # <<<<<<<<<<<<<<
  *             if not isspace(ctx.text.back().back()):
  *                 ctx.text.back().push_back(b' ')
  */
     }
 
-    /* "resiliparse/extract/html2text.pyx":314
+    /* "resiliparse/extract/html2text.pyx":323
  *     # Link targets
  *     cdef string_view link_href
  *     if ctx.opts.links and ctx.node.local_name == LXB_TAG_A:             # <<<<<<<<<<<<<<
  *         link_href = get_node_attr_sv(ctx.node, b'href')
  *         if not link_href.empty():
  */
   }
 
-  /* "resiliparse/extract/html2text.pyx":324
+  /* "resiliparse/extract/html2text.pyx":333
  * 
  *     cdef string stripped
  *     if ctx.node.local_name == LXB_TAG_LI:             # <<<<<<<<<<<<<<
  *         # Clean up empty list items
  *         while not ctx.text.empty():
  */
   __pyx_t_1 = ((__pyx_v_ctx->node->local_name == LXB_TAG_LI) != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/extract/html2text.pyx":326
+    /* "resiliparse/extract/html2text.pyx":335
  *     if ctx.node.local_name == LXB_TAG_LI:
  *         # Clean up empty list items
  *         while not ctx.text.empty():             # <<<<<<<<<<<<<<
  *             stripped = strip_str(ctx.text.back())
  *             if not stripped.empty() and stripped != LIST_BULLET:
  */
     while (1) {
       __pyx_t_1 = ((!(__pyx_v_ctx->text.empty() != 0)) != 0);
       if (!__pyx_t_1) break;
 
-      /* "resiliparse/extract/html2text.pyx":327
+      /* "resiliparse/extract/html2text.pyx":336
  *         # Clean up empty list items
  *         while not ctx.text.empty():
  *             stripped = strip_str(ctx.text.back())             # <<<<<<<<<<<<<<
  *             if not stripped.empty() and stripped != LIST_BULLET:
  *                 break
  */
       __pyx_v_stripped = __pyx_f_18resiliparse_common_11string_util_strip_str(__pyx_v_ctx->text.back());
 
-      /* "resiliparse/extract/html2text.pyx":328
+      /* "resiliparse/extract/html2text.pyx":337
  *         while not ctx.text.empty():
  *             stripped = strip_str(ctx.text.back())
  *             if not stripped.empty() and stripped != LIST_BULLET:             # <<<<<<<<<<<<<<
  *                 break
  *             ctx.text.pop_back()
  */
       __pyx_t_3 = ((!(__pyx_v_stripped.empty() != 0)) != 0);
@@ -5360,178 +5565,178 @@
         goto __pyx_L24_bool_binop_done;
       }
       __pyx_t_3 = ((__pyx_v_stripped != __pyx_v_11resiliparse_7extract_9html2text_LIST_BULLET) != 0);
       __pyx_t_1 = __pyx_t_3;
       __pyx_L24_bool_binop_done:;
       if (__pyx_t_1) {
 
-        /* "resiliparse/extract/html2text.pyx":329
+        /* "resiliparse/extract/html2text.pyx":338
  *             stripped = strip_str(ctx.text.back())
  *             if not stripped.empty() and stripped != LIST_BULLET:
  *                 break             # <<<<<<<<<<<<<<
  *             ctx.text.pop_back()
  * 
  */
         goto __pyx_L22_break;
 
-        /* "resiliparse/extract/html2text.pyx":328
+        /* "resiliparse/extract/html2text.pyx":337
  *         while not ctx.text.empty():
  *             stripped = strip_str(ctx.text.back())
  *             if not stripped.empty() and stripped != LIST_BULLET:             # <<<<<<<<<<<<<<
  *                 break
  *             ctx.text.pop_back()
  */
       }
 
-      /* "resiliparse/extract/html2text.pyx":330
+      /* "resiliparse/extract/html2text.pyx":339
  *             if not stripped.empty() and stripped != LIST_BULLET:
  *                 break
  *             ctx.text.pop_back()             # <<<<<<<<<<<<<<
  * 
  *         # No additional white space after list items
  */
       __pyx_v_ctx->text.pop_back();
     }
     __pyx_L22_break:;
 
-    /* "resiliparse/extract/html2text.pyx":333
+    /* "resiliparse/extract/html2text.pyx":342
  * 
  *         # No additional white space after list items
  *         ctx.newline_before_next_block = False             # <<<<<<<<<<<<<<
  *         ctx.lstrip_next_block = False
  * 
  */
     __pyx_v_ctx->newline_before_next_block = 0;
 
-    /* "resiliparse/extract/html2text.pyx":334
+    /* "resiliparse/extract/html2text.pyx":343
  *         # No additional white space after list items
  *         ctx.newline_before_next_block = False
  *         ctx.lstrip_next_block = False             # <<<<<<<<<<<<<<
  * 
  *     if is_block_element(ctx.node.local_name):
  */
     __pyx_v_ctx->lstrip_next_block = 0;
 
-    /* "resiliparse/extract/html2text.pyx":324
+    /* "resiliparse/extract/html2text.pyx":333
  * 
  *     cdef string stripped
  *     if ctx.node.local_name == LXB_TAG_LI:             # <<<<<<<<<<<<<<
  *         # Clean up empty list items
  *         while not ctx.text.empty():
  */
   }
 
-  /* "resiliparse/extract/html2text.pyx":336
+  /* "resiliparse/extract/html2text.pyx":345
  *         ctx.lstrip_next_block = False
  * 
  *     if is_block_element(ctx.node.local_name):             # <<<<<<<<<<<<<<
  *         _make_block(ctx)
  * 
  */
   __pyx_t_1 = (__pyx_f_11resiliparse_5parse_4html_is_block_element(__pyx_v_ctx->node->local_name) != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/extract/html2text.pyx":337
+    /* "resiliparse/extract/html2text.pyx":346
  * 
  *     if is_block_element(ctx.node.local_name):
  *         _make_block(ctx)             # <<<<<<<<<<<<<<
  * 
  * 
  */
     __pyx_f_11resiliparse_7extract_9html2text__make_block(__pyx_v_ctx);
 
-    /* "resiliparse/extract/html2text.pyx":336
+    /* "resiliparse/extract/html2text.pyx":345
  *         ctx.lstrip_next_block = False
  * 
  *     if is_block_element(ctx.node.local_name):             # <<<<<<<<<<<<<<
  *         _make_block(ctx)
  * 
  */
   }
 
-  /* "resiliparse/extract/html2text.pyx":274
+  /* "resiliparse/extract/html2text.pyx":280
  * 
  * 
  * cdef void _extract_end_cb(ExtractContext* ctx) nogil:             # <<<<<<<<<<<<<<
  *     """Extraction end element callback."""
  *     if ctx.node.type != LXB_DOM_NODE_TYPE_ELEMENT or not ctx.opts.preserve_formatting:
  */
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __Pyx_WriteUnraisable("resiliparse.extract.html2text._extract_end_cb", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 1);
   __pyx_L0:;
 }
 
-/* "resiliparse/extract/html2text.pyx":356
+/* "resiliparse/extract/html2text.pyx":365
  * 
  * 
  * cdef inline bint regex_search_not_empty(const StringPiece& s, const RE2& r) nogil:             # <<<<<<<<<<<<<<
  *     if s.empty():
  *         return False
  */
 
 static CYTHON_INLINE int __pyx_f_11resiliparse_7extract_9html2text_regex_search_not_empty(re2::StringPiece const &__pyx_v_s, RE2Stack const &__pyx_v_r) {
   int __pyx_r;
   int __pyx_t_1;
 
-  /* "resiliparse/extract/html2text.pyx":357
+  /* "resiliparse/extract/html2text.pyx":366
  * 
  * cdef inline bint regex_search_not_empty(const StringPiece& s, const RE2& r) nogil:
  *     if s.empty():             # <<<<<<<<<<<<<<
  *         return False
  *     return PartialMatch(s, r())
  */
   __pyx_t_1 = (__pyx_v_s.empty() != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/extract/html2text.pyx":358
+    /* "resiliparse/extract/html2text.pyx":367
  * cdef inline bint regex_search_not_empty(const StringPiece& s, const RE2& r) nogil:
  *     if s.empty():
  *         return False             # <<<<<<<<<<<<<<
  *     return PartialMatch(s, r())
  * 
  */
     __pyx_r = 0;
     goto __pyx_L0;
 
-    /* "resiliparse/extract/html2text.pyx":357
+    /* "resiliparse/extract/html2text.pyx":366
  * 
  * cdef inline bint regex_search_not_empty(const StringPiece& s, const RE2& r) nogil:
  *     if s.empty():             # <<<<<<<<<<<<<<
  *         return False
  *     return PartialMatch(s, r())
  */
   }
 
-  /* "resiliparse/extract/html2text.pyx":359
+  /* "resiliparse/extract/html2text.pyx":368
  *     if s.empty():
  *         return False
  *     return PartialMatch(s, r())             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __pyx_r = re2::RE2::PartialMatch(__pyx_v_s, __pyx_v_r());
   goto __pyx_L0;
 
-  /* "resiliparse/extract/html2text.pyx":356
+  /* "resiliparse/extract/html2text.pyx":365
  * 
  * 
  * cdef inline bint regex_search_not_empty(const StringPiece& s, const RE2& r) nogil:             # <<<<<<<<<<<<<<
  *     if s.empty():
  *         return False
  */
 
   /* function exit code */
   __pyx_L0:;
   return __pyx_r;
 }
 
-/* "resiliparse/extract/html2text.pyx":362
+/* "resiliparse/extract/html2text.pyx":371
  * 
  * 
  * cdef bint _is_main_content_node(lxb_dom_node_t* node) nogil:             # <<<<<<<<<<<<<<
  *     """Check with simple heuristics if node belongs to main content."""
  * 
  */
 
@@ -5551,53 +5756,53 @@
   std::string_view __pyx_t_3;
   int __pyx_t_4;
   lxb_dom_node_t *__pyx_t_5;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
 
-  /* "resiliparse/extract/html2text.pyx":365
+  /* "resiliparse/extract/html2text.pyx":374
  *     """Check with simple heuristics if node belongs to main content."""
  * 
  *     if node.type != LXB_DOM_NODE_TYPE_ELEMENT:             # <<<<<<<<<<<<<<
  *         return True
  * 
  */
   __pyx_t_1 = ((__pyx_v_node->type != LXB_DOM_NODE_TYPE_ELEMENT) != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/extract/html2text.pyx":366
+    /* "resiliparse/extract/html2text.pyx":375
  * 
  *     if node.type != LXB_DOM_NODE_TYPE_ELEMENT:
  *         return True             # <<<<<<<<<<<<<<
  * 
  *     cdef bint is_block = is_block_element(node.local_name)
  */
     __pyx_r = 1;
     goto __pyx_L0;
 
-    /* "resiliparse/extract/html2text.pyx":365
+    /* "resiliparse/extract/html2text.pyx":374
  *     """Check with simple heuristics if node belongs to main content."""
  * 
  *     if node.type != LXB_DOM_NODE_TYPE_ELEMENT:             # <<<<<<<<<<<<<<
  *         return True
  * 
  */
   }
 
-  /* "resiliparse/extract/html2text.pyx":368
+  /* "resiliparse/extract/html2text.pyx":377
  *         return True
  * 
  *     cdef bint is_block = is_block_element(node.local_name)             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __pyx_v_is_block = __pyx_f_11resiliparse_5parse_4html_is_block_element(__pyx_v_node->local_name);
 
-  /* "resiliparse/extract/html2text.pyx":373
+  /* "resiliparse/extract/html2text.pyx":382
  *     # ------ Section 1: Inline and block elements ------
  * 
  *     if not is_block and _is_unprintable_pua(node):             # <<<<<<<<<<<<<<
  *         return False
  * 
  */
   __pyx_t_2 = ((!(__pyx_v_is_block != 0)) != 0);
@@ -5607,101 +5812,101 @@
     goto __pyx_L5_bool_binop_done;
   }
   __pyx_t_2 = (__pyx_f_11resiliparse_7extract_9html2text__is_unprintable_pua(__pyx_v_node) != 0);
   __pyx_t_1 = __pyx_t_2;
   __pyx_L5_bool_binop_done:;
   if (__pyx_t_1) {
 
-    /* "resiliparse/extract/html2text.pyx":374
+    /* "resiliparse/extract/html2text.pyx":383
  * 
  *     if not is_block and _is_unprintable_pua(node):
  *         return False             # <<<<<<<<<<<<<<
  * 
  *     # Hidden elements
  */
     __pyx_r = 0;
     goto __pyx_L0;
 
-    /* "resiliparse/extract/html2text.pyx":373
+    /* "resiliparse/extract/html2text.pyx":382
  *     # ------ Section 1: Inline and block elements ------
  * 
  *     if not is_block and _is_unprintable_pua(node):             # <<<<<<<<<<<<<<
  *         return False
  * 
  */
   }
 
-  /* "resiliparse/extract/html2text.pyx":377
+  /* "resiliparse/extract/html2text.pyx":386
  * 
  *     # Hidden elements
  *     if lxb_dom_element_has_attribute(<lxb_dom_element_t*>node, <lxb_char_t*>b'hidden', 6):             # <<<<<<<<<<<<<<
  *         return False
  * 
  */
   __pyx_t_1 = (lxb_dom_element_has_attribute(((lxb_dom_element_t *)__pyx_v_node), ((lxb_char_t *)((lxb_char_t *)((char const *)"hidden"))), 6) != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/extract/html2text.pyx":378
+    /* "resiliparse/extract/html2text.pyx":387
  *     # Hidden elements
  *     if lxb_dom_element_has_attribute(<lxb_dom_element_t*>node, <lxb_char_t*>b'hidden', 6):
  *         return False             # <<<<<<<<<<<<<<
  * 
  *     # ARIA hidden
  */
     __pyx_r = 0;
     goto __pyx_L0;
 
-    /* "resiliparse/extract/html2text.pyx":377
+    /* "resiliparse/extract/html2text.pyx":386
  * 
  *     # Hidden elements
  *     if lxb_dom_element_has_attribute(<lxb_dom_element_t*>node, <lxb_char_t*>b'hidden', 6):             # <<<<<<<<<<<<<<
  *         return False
  * 
  */
   }
 
-  /* "resiliparse/extract/html2text.pyx":381
+  /* "resiliparse/extract/html2text.pyx":390
  * 
  *     # ARIA hidden
  *     if get_node_attr_sv(node, b'aria-hidden') == b'true':             # <<<<<<<<<<<<<<
  *         return False
  * 
  */
   __pyx_t_1 = ((__pyx_f_11resiliparse_5parse_4html_get_node_attr_sv(__pyx_v_node, __pyx_k_aria_hidden) == ((char const *)"true")) != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/extract/html2text.pyx":382
+    /* "resiliparse/extract/html2text.pyx":391
  *     # ARIA hidden
  *     if get_node_attr_sv(node, b'aria-hidden') == b'true':
  *         return False             # <<<<<<<<<<<<<<
  * 
  *     # ARIA roles
  */
     __pyx_r = 0;
     goto __pyx_L0;
 
-    /* "resiliparse/extract/html2text.pyx":381
+    /* "resiliparse/extract/html2text.pyx":390
  * 
  *     # ARIA hidden
  *     if get_node_attr_sv(node, b'aria-hidden') == b'true':             # <<<<<<<<<<<<<<
  *         return False
  * 
  */
   }
 
-  /* "resiliparse/extract/html2text.pyx":385
+  /* "resiliparse/extract/html2text.pyx":394
  * 
  *     # ARIA roles
  *     cdef string_view role_attr = get_node_attr_sv(node, b'role')             # <<<<<<<<<<<<<<
  *     if not role_attr.empty() and role_attr in [b'contentinfo', b'img', b'menu', b'menubar', b'navigation', b'menuitem',
  *                                                b'alert', b'dialog', b'checkbox', b'radio']:
  */
   __pyx_v_role_attr = __pyx_f_11resiliparse_5parse_4html_get_node_attr_sv(__pyx_v_node, __pyx_k_role);
 
-  /* "resiliparse/extract/html2text.pyx":386
+  /* "resiliparse/extract/html2text.pyx":395
  *     # ARIA roles
  *     cdef string_view role_attr = get_node_attr_sv(node, b'role')
  *     if not role_attr.empty() and role_attr in [b'contentinfo', b'img', b'menu', b'menubar', b'navigation', b'menuitem',             # <<<<<<<<<<<<<<
  *                                                b'alert', b'dialog', b'checkbox', b'radio']:
  *         return False
  */
   __pyx_t_2 = ((!(__pyx_v_role_attr.empty() != 0)) != 0);
@@ -5769,72 +5974,72 @@
   __pyx_t_2 = __pyx_t_4;
   __pyx_L12_bool_binop_done:;
   __pyx_t_4 = (__pyx_t_2 != 0);
   __pyx_t_1 = __pyx_t_4;
   __pyx_L10_bool_binop_done:;
   if (__pyx_t_1) {
 
-    /* "resiliparse/extract/html2text.pyx":388
+    /* "resiliparse/extract/html2text.pyx":397
  *     if not role_attr.empty() and role_attr in [b'contentinfo', b'img', b'menu', b'menubar', b'navigation', b'menuitem',
  *                                                b'alert', b'dialog', b'checkbox', b'radio']:
  *         return False             # <<<<<<<<<<<<<<
  * 
  *     # Block element matching based only on tag name
  */
     __pyx_r = 0;
     goto __pyx_L0;
 
-    /* "resiliparse/extract/html2text.pyx":386
+    /* "resiliparse/extract/html2text.pyx":395
  *     # ARIA roles
  *     cdef string_view role_attr = get_node_attr_sv(node, b'role')
  *     if not role_attr.empty() and role_attr in [b'contentinfo', b'img', b'menu', b'menubar', b'navigation', b'menuitem',             # <<<<<<<<<<<<<<
  *                                                b'alert', b'dialog', b'checkbox', b'radio']:
  *         return False
  */
   }
 
-  /* "resiliparse/extract/html2text.pyx":391
+  /* "resiliparse/extract/html2text.pyx":400
  * 
  *     # Block element matching based only on tag name
  *     cdef size_t length_to_body = 0             # <<<<<<<<<<<<<<
  *     cdef lxb_dom_node_t* pnode = node.parent
  *     cdef bint footer_is_last_body_child = True
  */
   __pyx_v_length_to_body = 0;
 
-  /* "resiliparse/extract/html2text.pyx":392
+  /* "resiliparse/extract/html2text.pyx":401
  *     # Block element matching based only on tag name
  *     cdef size_t length_to_body = 0
  *     cdef lxb_dom_node_t* pnode = node.parent             # <<<<<<<<<<<<<<
  *     cdef bint footer_is_last_body_child = True
  *     if is_block:
  */
   __pyx_t_5 = __pyx_v_node->parent;
   __pyx_v_pnode = __pyx_t_5;
 
-  /* "resiliparse/extract/html2text.pyx":393
+  /* "resiliparse/extract/html2text.pyx":402
  *     cdef size_t length_to_body = 0
  *     cdef lxb_dom_node_t* pnode = node.parent
  *     cdef bint footer_is_last_body_child = True             # <<<<<<<<<<<<<<
  *     if is_block:
  *         while pnode.local_name != LXB_TAG_BODY and pnode.parent:
  */
   __pyx_v_footer_is_last_body_child = 1;
 
-  /* "resiliparse/extract/html2text.pyx":394
+  /* "resiliparse/extract/html2text.pyx":403
  *     cdef lxb_dom_node_t* pnode = node.parent
  *     cdef bint footer_is_last_body_child = True
  *     if is_block:             # <<<<<<<<<<<<<<
  *         while pnode.local_name != LXB_TAG_BODY and pnode.parent:
  *             preinc(length_to_body)
  */
   __pyx_t_1 = (__pyx_v_is_block != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/extract/html2text.pyx":395
+    /* "resiliparse/extract/html2text.pyx":404
  *     cdef bint footer_is_last_body_child = True
  *     if is_block:
  *         while pnode.local_name != LXB_TAG_BODY and pnode.parent:             # <<<<<<<<<<<<<<
  *             preinc(length_to_body)
  *             pnode = pnode.parent
  */
     while (1) {
@@ -5845,112 +6050,112 @@
         goto __pyx_L25_bool_binop_done;
       }
       __pyx_t_4 = (__pyx_v_pnode->parent != 0);
       __pyx_t_1 = __pyx_t_4;
       __pyx_L25_bool_binop_done:;
       if (!__pyx_t_1) break;
 
-      /* "resiliparse/extract/html2text.pyx":396
+      /* "resiliparse/extract/html2text.pyx":405
  *     if is_block:
  *         while pnode.local_name != LXB_TAG_BODY and pnode.parent:
  *             preinc(length_to_body)             # <<<<<<<<<<<<<<
  *             pnode = pnode.parent
  * 
  */
       (void)((++__pyx_v_length_to_body));
 
-      /* "resiliparse/extract/html2text.pyx":397
+      /* "resiliparse/extract/html2text.pyx":406
  *         while pnode.local_name != LXB_TAG_BODY and pnode.parent:
  *             preinc(length_to_body)
  *             pnode = pnode.parent             # <<<<<<<<<<<<<<
  * 
  *         # Main elements
  */
       __pyx_t_5 = __pyx_v_pnode->parent;
       __pyx_v_pnode = __pyx_t_5;
     }
 
-    /* "resiliparse/extract/html2text.pyx":400
+    /* "resiliparse/extract/html2text.pyx":409
  * 
  *         # Main elements
  *         if node.local_name == LXB_TAG_MAIN:             # <<<<<<<<<<<<<<
  *             return True
  * 
  */
     __pyx_t_1 = ((__pyx_v_node->local_name == LXB_TAG_MAIN) != 0);
     if (__pyx_t_1) {
 
-      /* "resiliparse/extract/html2text.pyx":401
+      /* "resiliparse/extract/html2text.pyx":410
  *         # Main elements
  *         if node.local_name == LXB_TAG_MAIN:
  *             return True             # <<<<<<<<<<<<<<
  * 
  *         # Global footer
  */
       __pyx_r = 1;
       goto __pyx_L0;
 
-      /* "resiliparse/extract/html2text.pyx":400
+      /* "resiliparse/extract/html2text.pyx":409
  * 
  *         # Main elements
  *         if node.local_name == LXB_TAG_MAIN:             # <<<<<<<<<<<<<<
  *             return True
  * 
  */
     }
 
-    /* "resiliparse/extract/html2text.pyx":404
+    /* "resiliparse/extract/html2text.pyx":413
  * 
  *         # Global footer
  *         if node.local_name == LXB_TAG_FOOTER:             # <<<<<<<<<<<<<<
  *             if length_to_body < 3:
  *                 return False
  */
     __pyx_t_1 = ((__pyx_v_node->local_name == LXB_TAG_FOOTER) != 0);
     if (__pyx_t_1) {
 
-      /* "resiliparse/extract/html2text.pyx":405
+      /* "resiliparse/extract/html2text.pyx":414
  *         # Global footer
  *         if node.local_name == LXB_TAG_FOOTER:
  *             if length_to_body < 3:             # <<<<<<<<<<<<<<
  *                 return False
  * 
  */
       __pyx_t_1 = ((__pyx_v_length_to_body < 3) != 0);
       if (__pyx_t_1) {
 
-        /* "resiliparse/extract/html2text.pyx":406
+        /* "resiliparse/extract/html2text.pyx":415
  *         if node.local_name == LXB_TAG_FOOTER:
  *             if length_to_body < 3:
  *                 return False             # <<<<<<<<<<<<<<
  * 
  *             # Check if footer is recursive last element node of a direct body child
  */
         __pyx_r = 0;
         goto __pyx_L0;
 
-        /* "resiliparse/extract/html2text.pyx":405
+        /* "resiliparse/extract/html2text.pyx":414
  *         # Global footer
  *         if node.local_name == LXB_TAG_FOOTER:
  *             if length_to_body < 3:             # <<<<<<<<<<<<<<
  *                 return False
  * 
  */
       }
 
-      /* "resiliparse/extract/html2text.pyx":409
+      /* "resiliparse/extract/html2text.pyx":418
  * 
  *             # Check if footer is recursive last element node of a direct body child
  *             pnode = node             # <<<<<<<<<<<<<<
  *             while pnode and pnode.parent and pnode.parent.local_name != LXB_TAG_BODY:
  *                 if pnode.next and pnode.next.type == LXB_DOM_NODE_TYPE_TEXT:
  */
       __pyx_v_pnode = __pyx_v_node;
 
-      /* "resiliparse/extract/html2text.pyx":410
+      /* "resiliparse/extract/html2text.pyx":419
  *             # Check if footer is recursive last element node of a direct body child
  *             pnode = node
  *             while pnode and pnode.parent and pnode.parent.local_name != LXB_TAG_BODY:             # <<<<<<<<<<<<<<
  *                 if pnode.next and pnode.next.type == LXB_DOM_NODE_TYPE_TEXT:
  *                     pnode = pnode.next
  */
       while (1) {
@@ -5967,15 +6172,15 @@
           goto __pyx_L32_bool_binop_done;
         }
         __pyx_t_4 = ((__pyx_v_pnode->parent->local_name != LXB_TAG_BODY) != 0);
         __pyx_t_1 = __pyx_t_4;
         __pyx_L32_bool_binop_done:;
         if (!__pyx_t_1) break;
 
-        /* "resiliparse/extract/html2text.pyx":411
+        /* "resiliparse/extract/html2text.pyx":420
  *             pnode = node
  *             while pnode and pnode.parent and pnode.parent.local_name != LXB_TAG_BODY:
  *                 if pnode.next and pnode.next.type == LXB_DOM_NODE_TYPE_TEXT:             # <<<<<<<<<<<<<<
  *                     pnode = pnode.next
  *                 if pnode.next:
  */
         __pyx_t_4 = (__pyx_v_pnode->next != 0);
@@ -5985,121 +6190,121 @@
           goto __pyx_L36_bool_binop_done;
         }
         __pyx_t_4 = ((__pyx_v_pnode->next->type == LXB_DOM_NODE_TYPE_TEXT) != 0);
         __pyx_t_1 = __pyx_t_4;
         __pyx_L36_bool_binop_done:;
         if (__pyx_t_1) {
 
-          /* "resiliparse/extract/html2text.pyx":412
+          /* "resiliparse/extract/html2text.pyx":421
  *             while pnode and pnode.parent and pnode.parent.local_name != LXB_TAG_BODY:
  *                 if pnode.next and pnode.next.type == LXB_DOM_NODE_TYPE_TEXT:
  *                     pnode = pnode.next             # <<<<<<<<<<<<<<
  *                 if pnode.next:
  *                     # There is at least one more element node
  */
           __pyx_t_5 = __pyx_v_pnode->next;
           __pyx_v_pnode = __pyx_t_5;
 
-          /* "resiliparse/extract/html2text.pyx":411
+          /* "resiliparse/extract/html2text.pyx":420
  *             pnode = node
  *             while pnode and pnode.parent and pnode.parent.local_name != LXB_TAG_BODY:
  *                 if pnode.next and pnode.next.type == LXB_DOM_NODE_TYPE_TEXT:             # <<<<<<<<<<<<<<
  *                     pnode = pnode.next
  *                 if pnode.next:
  */
         }
 
-        /* "resiliparse/extract/html2text.pyx":413
+        /* "resiliparse/extract/html2text.pyx":422
  *                 if pnode.next and pnode.next.type == LXB_DOM_NODE_TYPE_TEXT:
  *                     pnode = pnode.next
  *                 if pnode.next:             # <<<<<<<<<<<<<<
  *                     # There is at least one more element node
  *                     footer_is_last_body_child = False
  */
         __pyx_t_1 = (__pyx_v_pnode->next != 0);
         if (__pyx_t_1) {
 
-          /* "resiliparse/extract/html2text.pyx":415
+          /* "resiliparse/extract/html2text.pyx":424
  *                 if pnode.next:
  *                     # There is at least one more element node
  *                     footer_is_last_body_child = False             # <<<<<<<<<<<<<<
  *                     break
  *                 pnode = pnode.parent
  */
           __pyx_v_footer_is_last_body_child = 0;
 
-          /* "resiliparse/extract/html2text.pyx":416
+          /* "resiliparse/extract/html2text.pyx":425
  *                     # There is at least one more element node
  *                     footer_is_last_body_child = False
  *                     break             # <<<<<<<<<<<<<<
  *                 pnode = pnode.parent
  *             if footer_is_last_body_child:
  */
           goto __pyx_L31_break;
 
-          /* "resiliparse/extract/html2text.pyx":413
+          /* "resiliparse/extract/html2text.pyx":422
  *                 if pnode.next and pnode.next.type == LXB_DOM_NODE_TYPE_TEXT:
  *                     pnode = pnode.next
  *                 if pnode.next:             # <<<<<<<<<<<<<<
  *                     # There is at least one more element node
  *                     footer_is_last_body_child = False
  */
         }
 
-        /* "resiliparse/extract/html2text.pyx":417
+        /* "resiliparse/extract/html2text.pyx":426
  *                     footer_is_last_body_child = False
  *                     break
  *                 pnode = pnode.parent             # <<<<<<<<<<<<<<
  *             if footer_is_last_body_child:
  *                 return False
  */
         __pyx_t_5 = __pyx_v_pnode->parent;
         __pyx_v_pnode = __pyx_t_5;
       }
       __pyx_L31_break:;
 
-      /* "resiliparse/extract/html2text.pyx":418
+      /* "resiliparse/extract/html2text.pyx":427
  *                     break
  *                 pnode = pnode.parent
  *             if footer_is_last_body_child:             # <<<<<<<<<<<<<<
  *                 return False
  * 
  */
       __pyx_t_1 = (__pyx_v_footer_is_last_body_child != 0);
       if (__pyx_t_1) {
 
-        /* "resiliparse/extract/html2text.pyx":419
+        /* "resiliparse/extract/html2text.pyx":428
  *                 pnode = pnode.parent
  *             if footer_is_last_body_child:
  *                 return False             # <<<<<<<<<<<<<<
  * 
  *         # Global navigation
  */
         __pyx_r = 0;
         goto __pyx_L0;
 
-        /* "resiliparse/extract/html2text.pyx":418
+        /* "resiliparse/extract/html2text.pyx":427
  *                     break
  *                 pnode = pnode.parent
  *             if footer_is_last_body_child:             # <<<<<<<<<<<<<<
  *                 return False
  * 
  */
       }
 
-      /* "resiliparse/extract/html2text.pyx":404
+      /* "resiliparse/extract/html2text.pyx":413
  * 
  *         # Global footer
  *         if node.local_name == LXB_TAG_FOOTER:             # <<<<<<<<<<<<<<
  *             if length_to_body < 3:
  *                 return False
  */
     }
 
-    /* "resiliparse/extract/html2text.pyx":422
+    /* "resiliparse/extract/html2text.pyx":431
  * 
  *         # Global navigation
  *         if node.local_name in [LXB_TAG_UL, LXB_TAG_NAV] and length_to_body < 3:             # <<<<<<<<<<<<<<
  *             return False
  * 
  */
     switch (__pyx_v_node->local_name) {
@@ -6118,34 +6323,34 @@
       goto __pyx_L41_bool_binop_done;
     }
     __pyx_t_2 = ((__pyx_v_length_to_body < 3) != 0);
     __pyx_t_1 = __pyx_t_2;
     __pyx_L41_bool_binop_done:;
     if (__pyx_t_1) {
 
-      /* "resiliparse/extract/html2text.pyx":423
+      /* "resiliparse/extract/html2text.pyx":432
  *         # Global navigation
  *         if node.local_name in [LXB_TAG_UL, LXB_TAG_NAV] and length_to_body < 3:
  *             return False             # <<<<<<<<<<<<<<
  * 
  *         # Global aside
  */
       __pyx_r = 0;
       goto __pyx_L0;
 
-      /* "resiliparse/extract/html2text.pyx":422
+      /* "resiliparse/extract/html2text.pyx":431
  * 
  *         # Global navigation
  *         if node.local_name in [LXB_TAG_UL, LXB_TAG_NAV] and length_to_body < 3:             # <<<<<<<<<<<<<<
  *             return False
  * 
  */
     }
 
-    /* "resiliparse/extract/html2text.pyx":426
+    /* "resiliparse/extract/html2text.pyx":435
  * 
  *         # Global aside
  *         if node.local_name == LXB_TAG_ASIDE and length_to_body < 3:             # <<<<<<<<<<<<<<
  *             return False
  * 
  */
     __pyx_t_2 = ((__pyx_v_node->local_name == LXB_TAG_ASIDE) != 0);
@@ -6155,90 +6360,90 @@
       goto __pyx_L44_bool_binop_done;
     }
     __pyx_t_2 = ((__pyx_v_length_to_body < 3) != 0);
     __pyx_t_1 = __pyx_t_2;
     __pyx_L44_bool_binop_done:;
     if (__pyx_t_1) {
 
-      /* "resiliparse/extract/html2text.pyx":427
+      /* "resiliparse/extract/html2text.pyx":436
  *         # Global aside
  *         if node.local_name == LXB_TAG_ASIDE and length_to_body < 3:
  *             return False             # <<<<<<<<<<<<<<
  * 
  *         # Iframes
  */
       __pyx_r = 0;
       goto __pyx_L0;
 
-      /* "resiliparse/extract/html2text.pyx":426
+      /* "resiliparse/extract/html2text.pyx":435
  * 
  *         # Global aside
  *         if node.local_name == LXB_TAG_ASIDE and length_to_body < 3:             # <<<<<<<<<<<<<<
  *             return False
  * 
  */
     }
 
-    /* "resiliparse/extract/html2text.pyx":430
+    /* "resiliparse/extract/html2text.pyx":439
  * 
  *         # Iframes
  *         if node.local_name == LXB_TAG_IFRAME:             # <<<<<<<<<<<<<<
  *             return False
  * 
  */
     __pyx_t_1 = ((__pyx_v_node->local_name == LXB_TAG_IFRAME) != 0);
     if (__pyx_t_1) {
 
-      /* "resiliparse/extract/html2text.pyx":431
+      /* "resiliparse/extract/html2text.pyx":440
  *         # Iframes
  *         if node.local_name == LXB_TAG_IFRAME:
  *             return False             # <<<<<<<<<<<<<<
  * 
  * 
  */
       __pyx_r = 0;
       goto __pyx_L0;
 
-      /* "resiliparse/extract/html2text.pyx":430
+      /* "resiliparse/extract/html2text.pyx":439
  * 
  *         # Iframes
  *         if node.local_name == LXB_TAG_IFRAME:             # <<<<<<<<<<<<<<
  *             return False
  * 
  */
     }
 
-    /* "resiliparse/extract/html2text.pyx":394
+    /* "resiliparse/extract/html2text.pyx":403
  *     cdef lxb_dom_node_t* pnode = node.parent
  *     cdef bint footer_is_last_body_child = True
  *     if is_block:             # <<<<<<<<<<<<<<
  *         while pnode.local_name != LXB_TAG_BODY and pnode.parent:
  *             preinc(length_to_body)
  */
   }
 
-  /* "resiliparse/extract/html2text.pyx":436
+  /* "resiliparse/extract/html2text.pyx":445
  *     # ------ Section 2: General class and id matching ------
  * 
  *     cdef StringPiece cls_attr = get_node_attr_sp(node, b'class')             # <<<<<<<<<<<<<<
  *     cdef StringPiece id_attr = get_node_attr_sp(node, b'id')
  *     if cls_attr.empty() and id_attr.empty():
  */
   __pyx_v_cls_attr = __pyx_f_11resiliparse_5parse_4html_get_node_attr_sp(__pyx_v_node, __pyx_k_class);
 
-  /* "resiliparse/extract/html2text.pyx":437
+  /* "resiliparse/extract/html2text.pyx":446
  * 
  *     cdef StringPiece cls_attr = get_node_attr_sp(node, b'class')
  *     cdef StringPiece id_attr = get_node_attr_sp(node, b'id')             # <<<<<<<<<<<<<<
  *     if cls_attr.empty() and id_attr.empty():
  *         return True
  */
   __pyx_v_id_attr = __pyx_f_11resiliparse_5parse_4html_get_node_attr_sp(__pyx_v_node, __pyx_k_id);
 
-  /* "resiliparse/extract/html2text.pyx":438
+  /* "resiliparse/extract/html2text.pyx":447
  *     cdef StringPiece cls_attr = get_node_attr_sp(node, b'class')
  *     cdef StringPiece id_attr = get_node_attr_sp(node, b'id')
  *     if cls_attr.empty() and id_attr.empty():             # <<<<<<<<<<<<<<
  *         return True
  * 
  */
   __pyx_t_2 = (__pyx_v_cls_attr.empty() != 0);
@@ -6248,53 +6453,53 @@
     goto __pyx_L48_bool_binop_done;
   }
   __pyx_t_2 = (__pyx_v_id_attr.empty() != 0);
   __pyx_t_1 = __pyx_t_2;
   __pyx_L48_bool_binop_done:;
   if (__pyx_t_1) {
 
-    /* "resiliparse/extract/html2text.pyx":439
+    /* "resiliparse/extract/html2text.pyx":448
  *     cdef StringPiece id_attr = get_node_attr_sp(node, b'id')
  *     if cls_attr.empty() and id_attr.empty():
  *         return True             # <<<<<<<<<<<<<<
  * 
  *     cdef string cls_and_id_attr_str = cls_attr.as_string()
  */
     __pyx_r = 1;
     goto __pyx_L0;
 
-    /* "resiliparse/extract/html2text.pyx":438
+    /* "resiliparse/extract/html2text.pyx":447
  *     cdef StringPiece cls_attr = get_node_attr_sp(node, b'class')
  *     cdef StringPiece id_attr = get_node_attr_sp(node, b'id')
  *     if cls_attr.empty() and id_attr.empty():             # <<<<<<<<<<<<<<
  *         return True
  * 
  */
   }
 
-  /* "resiliparse/extract/html2text.pyx":441
+  /* "resiliparse/extract/html2text.pyx":450
  *         return True
  * 
  *     cdef string cls_and_id_attr_str = cls_attr.as_string()             # <<<<<<<<<<<<<<
  *     if not cls_and_id_attr_str.empty():
  *         cls_and_id_attr_str.push_back(b' ')
  */
   __pyx_v_cls_and_id_attr_str = __pyx_v_cls_attr.as_string();
 
-  /* "resiliparse/extract/html2text.pyx":442
+  /* "resiliparse/extract/html2text.pyx":451
  * 
  *     cdef string cls_and_id_attr_str = cls_attr.as_string()
  *     if not cls_and_id_attr_str.empty():             # <<<<<<<<<<<<<<
  *         cls_and_id_attr_str.push_back(b' ')
  *     cls_and_id_attr_str.append(id_attr.as_string())
  */
   __pyx_t_1 = ((!(__pyx_v_cls_and_id_attr_str.empty() != 0)) != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/extract/html2text.pyx":443
+    /* "resiliparse/extract/html2text.pyx":452
  *     cdef string cls_and_id_attr_str = cls_attr.as_string()
  *     if not cls_and_id_attr_str.empty():
  *         cls_and_id_attr_str.push_back(b' ')             # <<<<<<<<<<<<<<
  *     cls_and_id_attr_str.append(id_attr.as_string())
  *     cdef StringPiece cls_and_id_attr = StringPiece(cls_and_id_attr_str)
  */
     try {
@@ -6303,27 +6508,27 @@
       #ifdef WITH_THREAD
       PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
       #endif
       __Pyx_CppExn2PyErr();
       #ifdef WITH_THREAD
       __Pyx_PyGILState_Release(__pyx_gilstate_save);
       #endif
-      __PYX_ERR(0, 443, __pyx_L1_error)
+      __PYX_ERR(0, 452, __pyx_L1_error)
     }
 
-    /* "resiliparse/extract/html2text.pyx":442
+    /* "resiliparse/extract/html2text.pyx":451
  * 
  *     cdef string cls_and_id_attr_str = cls_attr.as_string()
  *     if not cls_and_id_attr_str.empty():             # <<<<<<<<<<<<<<
  *         cls_and_id_attr_str.push_back(b' ')
  *     cls_and_id_attr_str.append(id_attr.as_string())
  */
   }
 
-  /* "resiliparse/extract/html2text.pyx":444
+  /* "resiliparse/extract/html2text.pyx":453
  *     if not cls_and_id_attr_str.empty():
  *         cls_and_id_attr_str.push_back(b' ')
  *     cls_and_id_attr_str.append(id_attr.as_string())             # <<<<<<<<<<<<<<
  *     cdef StringPiece cls_and_id_attr = StringPiece(cls_and_id_attr_str)
  * 
  */
   try {
@@ -6332,80 +6537,80 @@
     #ifdef WITH_THREAD
     PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
     #endif
     __Pyx_CppExn2PyErr();
     #ifdef WITH_THREAD
     __Pyx_PyGILState_Release(__pyx_gilstate_save);
     #endif
-    __PYX_ERR(0, 444, __pyx_L1_error)
+    __PYX_ERR(0, 453, __pyx_L1_error)
   }
 
-  /* "resiliparse/extract/html2text.pyx":445
+  /* "resiliparse/extract/html2text.pyx":454
  *         cls_and_id_attr_str.push_back(b' ')
  *     cls_and_id_attr_str.append(id_attr.as_string())
  *     cdef StringPiece cls_and_id_attr = StringPiece(cls_and_id_attr_str)             # <<<<<<<<<<<<<<
  * 
  *     # Hidden elements
  */
   __pyx_v_cls_and_id_attr = re2::StringPiece(__pyx_v_cls_and_id_attr_str);
 
-  /* "resiliparse/extract/html2text.pyx":448
+  /* "resiliparse/extract/html2text.pyx":457
  * 
  *     # Hidden elements
  *     if regex_search_not_empty(cls_attr, display_cls_regex) \             # <<<<<<<<<<<<<<
  *             or regex_search_not_empty(get_node_attr_sp(node, b'style'), display_css_regex):
  *         return False
  */
   __pyx_t_2 = (__pyx_f_11resiliparse_7extract_9html2text_regex_search_not_empty(__pyx_v_cls_attr, __pyx_v_11resiliparse_7extract_9html2text_display_cls_regex) != 0);
   if (!__pyx_t_2) {
   } else {
     __pyx_t_1 = __pyx_t_2;
     goto __pyx_L52_bool_binop_done;
   }
 
-  /* "resiliparse/extract/html2text.pyx":449
+  /* "resiliparse/extract/html2text.pyx":458
  *     # Hidden elements
  *     if regex_search_not_empty(cls_attr, display_cls_regex) \
  *             or regex_search_not_empty(get_node_attr_sp(node, b'style'), display_css_regex):             # <<<<<<<<<<<<<<
  *         return False
  * 
  */
   __pyx_t_2 = (__pyx_f_11resiliparse_7extract_9html2text_regex_search_not_empty(__pyx_f_11resiliparse_5parse_4html_get_node_attr_sp(__pyx_v_node, __pyx_k_style), __pyx_v_11resiliparse_7extract_9html2text_display_css_regex) != 0);
   __pyx_t_1 = __pyx_t_2;
   __pyx_L52_bool_binop_done:;
 
-  /* "resiliparse/extract/html2text.pyx":448
+  /* "resiliparse/extract/html2text.pyx":457
  * 
  *     # Hidden elements
  *     if regex_search_not_empty(cls_attr, display_cls_regex) \             # <<<<<<<<<<<<<<
  *             or regex_search_not_empty(get_node_attr_sp(node, b'style'), display_css_regex):
  *         return False
  */
   if (__pyx_t_1) {
 
-    /* "resiliparse/extract/html2text.pyx":450
+    /* "resiliparse/extract/html2text.pyx":459
  *     if regex_search_not_empty(cls_attr, display_cls_regex) \
  *             or regex_search_not_empty(get_node_attr_sp(node, b'style'), display_css_regex):
  *         return False             # <<<<<<<<<<<<<<
  * 
  *     # Skip links
  */
     __pyx_r = 0;
     goto __pyx_L0;
 
-    /* "resiliparse/extract/html2text.pyx":448
+    /* "resiliparse/extract/html2text.pyx":457
  * 
  *     # Hidden elements
  *     if regex_search_not_empty(cls_attr, display_cls_regex) \             # <<<<<<<<<<<<<<
  *             or regex_search_not_empty(get_node_attr_sp(node, b'style'), display_css_regex):
  *         return False
  */
   }
 
-  /* "resiliparse/extract/html2text.pyx":453
+  /* "resiliparse/extract/html2text.pyx":462
  * 
  *     # Skip links
  *     if node.local_name in [LXB_TAG_A, LXB_TAG_SPAN, LXB_TAG_LI] and regex_search_not_empty(cls_attr, skip_cls_regex):             # <<<<<<<<<<<<<<
  *         return False
  * 
  */
   switch (__pyx_v_node->local_name) {
@@ -6425,173 +6630,173 @@
     goto __pyx_L55_bool_binop_done;
   }
   __pyx_t_4 = (__pyx_f_11resiliparse_7extract_9html2text_regex_search_not_empty(__pyx_v_cls_attr, __pyx_v_11resiliparse_7extract_9html2text_skip_cls_regex) != 0);
   __pyx_t_1 = __pyx_t_4;
   __pyx_L55_bool_binop_done:;
   if (__pyx_t_1) {
 
-    /* "resiliparse/extract/html2text.pyx":454
+    /* "resiliparse/extract/html2text.pyx":463
  *     # Skip links
  *     if node.local_name in [LXB_TAG_A, LXB_TAG_SPAN, LXB_TAG_LI] and regex_search_not_empty(cls_attr, skip_cls_regex):
  *         return False             # <<<<<<<<<<<<<<
  * 
  *     # Social media and feedback forms
  */
     __pyx_r = 0;
     goto __pyx_L0;
 
-    /* "resiliparse/extract/html2text.pyx":453
+    /* "resiliparse/extract/html2text.pyx":462
  * 
  *     # Skip links
  *     if node.local_name in [LXB_TAG_A, LXB_TAG_SPAN, LXB_TAG_LI] and regex_search_not_empty(cls_attr, skip_cls_regex):             # <<<<<<<<<<<<<<
  *         return False
  * 
  */
   }
 
-  /* "resiliparse/extract/html2text.pyx":457
+  /* "resiliparse/extract/html2text.pyx":466
  * 
  *     # Social media and feedback forms
  *     if regex_search_not_empty(cls_attr, social_cls_regex):             # <<<<<<<<<<<<<<
  *         return False
  * 
  */
   __pyx_t_1 = (__pyx_f_11resiliparse_7extract_9html2text_regex_search_not_empty(__pyx_v_cls_attr, __pyx_v_11resiliparse_7extract_9html2text_social_cls_regex) != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/extract/html2text.pyx":458
+    /* "resiliparse/extract/html2text.pyx":467
  *     # Social media and feedback forms
  *     if regex_search_not_empty(cls_attr, social_cls_regex):
  *         return False             # <<<<<<<<<<<<<<
  * 
  *     # Ads
  */
     __pyx_r = 0;
     goto __pyx_L0;
 
-    /* "resiliparse/extract/html2text.pyx":457
+    /* "resiliparse/extract/html2text.pyx":466
  * 
  *     # Social media and feedback forms
  *     if regex_search_not_empty(cls_attr, social_cls_regex):             # <<<<<<<<<<<<<<
  *         return False
  * 
  */
   }
 
-  /* "resiliparse/extract/html2text.pyx":461
+  /* "resiliparse/extract/html2text.pyx":470
  * 
  *     # Ads
  *     if regex_search_not_empty(cls_and_id_attr, ads_cls_regex) \             # <<<<<<<<<<<<<<
  *             or lxb_dom_element_has_attribute(<lxb_dom_element_t*>node, <lxb_char_t*>b'data-ad', 7) \
  *             or lxb_dom_element_has_attribute(<lxb_dom_element_t*>node, <lxb_char_t*>b'data-advertisement', 18) \
  */
   __pyx_t_4 = (__pyx_f_11resiliparse_7extract_9html2text_regex_search_not_empty(__pyx_v_cls_and_id_attr, __pyx_v_11resiliparse_7extract_9html2text_ads_cls_regex) != 0);
   if (!__pyx_t_4) {
   } else {
     __pyx_t_1 = __pyx_t_4;
     goto __pyx_L59_bool_binop_done;
   }
 
-  /* "resiliparse/extract/html2text.pyx":462
+  /* "resiliparse/extract/html2text.pyx":471
  *     # Ads
  *     if regex_search_not_empty(cls_and_id_attr, ads_cls_regex) \
  *             or lxb_dom_element_has_attribute(<lxb_dom_element_t*>node, <lxb_char_t*>b'data-ad', 7) \             # <<<<<<<<<<<<<<
  *             or lxb_dom_element_has_attribute(<lxb_dom_element_t*>node, <lxb_char_t*>b'data-advertisement', 18) \
  *             or lxb_dom_element_has_attribute(<lxb_dom_element_t*>node, <lxb_char_t*>b'data-text-ad', 12):
  */
   __pyx_t_4 = (lxb_dom_element_has_attribute(((lxb_dom_element_t *)__pyx_v_node), ((lxb_char_t *)((lxb_char_t *)((char const *)"data-ad"))), 7) != 0);
   if (!__pyx_t_4) {
   } else {
     __pyx_t_1 = __pyx_t_4;
     goto __pyx_L59_bool_binop_done;
   }
 
-  /* "resiliparse/extract/html2text.pyx":463
+  /* "resiliparse/extract/html2text.pyx":472
  *     if regex_search_not_empty(cls_and_id_attr, ads_cls_regex) \
  *             or lxb_dom_element_has_attribute(<lxb_dom_element_t*>node, <lxb_char_t*>b'data-ad', 7) \
  *             or lxb_dom_element_has_attribute(<lxb_dom_element_t*>node, <lxb_char_t*>b'data-advertisement', 18) \             # <<<<<<<<<<<<<<
  *             or lxb_dom_element_has_attribute(<lxb_dom_element_t*>node, <lxb_char_t*>b'data-text-ad', 12):
  *         return False
  */
   __pyx_t_4 = (lxb_dom_element_has_attribute(((lxb_dom_element_t *)__pyx_v_node), ((lxb_char_t *)((lxb_char_t *)((char const *)"data-advertisement"))), 18) != 0);
   if (!__pyx_t_4) {
   } else {
     __pyx_t_1 = __pyx_t_4;
     goto __pyx_L59_bool_binop_done;
   }
 
-  /* "resiliparse/extract/html2text.pyx":464
+  /* "resiliparse/extract/html2text.pyx":473
  *             or lxb_dom_element_has_attribute(<lxb_dom_element_t*>node, <lxb_char_t*>b'data-ad', 7) \
  *             or lxb_dom_element_has_attribute(<lxb_dom_element_t*>node, <lxb_char_t*>b'data-advertisement', 18) \
  *             or lxb_dom_element_has_attribute(<lxb_dom_element_t*>node, <lxb_char_t*>b'data-text-ad', 12):             # <<<<<<<<<<<<<<
  *         return False
  * 
  */
   __pyx_t_4 = (lxb_dom_element_has_attribute(((lxb_dom_element_t *)__pyx_v_node), ((lxb_char_t *)((lxb_char_t *)((char const *)"data-text-ad"))), 12) != 0);
   __pyx_t_1 = __pyx_t_4;
   __pyx_L59_bool_binop_done:;
 
-  /* "resiliparse/extract/html2text.pyx":461
+  /* "resiliparse/extract/html2text.pyx":470
  * 
  *     # Ads
  *     if regex_search_not_empty(cls_and_id_attr, ads_cls_regex) \             # <<<<<<<<<<<<<<
  *             or lxb_dom_element_has_attribute(<lxb_dom_element_t*>node, <lxb_char_t*>b'data-ad', 7) \
  *             or lxb_dom_element_has_attribute(<lxb_dom_element_t*>node, <lxb_char_t*>b'data-advertisement', 18) \
  */
   if (__pyx_t_1) {
 
-    /* "resiliparse/extract/html2text.pyx":465
+    /* "resiliparse/extract/html2text.pyx":474
  *             or lxb_dom_element_has_attribute(<lxb_dom_element_t*>node, <lxb_char_t*>b'data-advertisement', 18) \
  *             or lxb_dom_element_has_attribute(<lxb_dom_element_t*>node, <lxb_char_t*>b'data-text-ad', 12):
  *         return False             # <<<<<<<<<<<<<<
  * 
  * 
  */
     __pyx_r = 0;
     goto __pyx_L0;
 
-    /* "resiliparse/extract/html2text.pyx":461
+    /* "resiliparse/extract/html2text.pyx":470
  * 
  *     # Ads
  *     if regex_search_not_empty(cls_and_id_attr, ads_cls_regex) \             # <<<<<<<<<<<<<<
  *             or lxb_dom_element_has_attribute(<lxb_dom_element_t*>node, <lxb_char_t*>b'data-ad', 7) \
  *             or lxb_dom_element_has_attribute(<lxb_dom_element_t*>node, <lxb_char_t*>b'data-advertisement', 18) \
  */
   }
 
-  /* "resiliparse/extract/html2text.pyx":470
+  /* "resiliparse/extract/html2text.pyx":479
  *     # ------ Section 3: Class and id matching of block elements only ------
  * 
  *     if not is_block:             # <<<<<<<<<<<<<<
  *         return True
  * 
  */
   __pyx_t_1 = ((!(__pyx_v_is_block != 0)) != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/extract/html2text.pyx":471
+    /* "resiliparse/extract/html2text.pyx":480
  * 
  *     if not is_block:
  *         return True             # <<<<<<<<<<<<<<
  * 
  *     # Global footer
  */
     __pyx_r = 1;
     goto __pyx_L0;
 
-    /* "resiliparse/extract/html2text.pyx":470
+    /* "resiliparse/extract/html2text.pyx":479
  *     # ------ Section 3: Class and id matching of block elements only ------
  * 
  *     if not is_block:             # <<<<<<<<<<<<<<
  *         return True
  * 
  */
   }
 
-  /* "resiliparse/extract/html2text.pyx":474
+  /* "resiliparse/extract/html2text.pyx":483
  * 
  *     # Global footer
  *     if regex_search_not_empty(cls_and_id_attr, footer_cls_regex) and length_to_body < 8:             # <<<<<<<<<<<<<<
  *         return False
  * 
  */
   __pyx_t_4 = (__pyx_f_11resiliparse_7extract_9html2text_regex_search_not_empty(__pyx_v_cls_and_id_attr, __pyx_v_11resiliparse_7extract_9html2text_footer_cls_regex) != 0);
@@ -6601,34 +6806,34 @@
     goto __pyx_L65_bool_binop_done;
   }
   __pyx_t_4 = ((__pyx_v_length_to_body < 8) != 0);
   __pyx_t_1 = __pyx_t_4;
   __pyx_L65_bool_binop_done:;
   if (__pyx_t_1) {
 
-    /* "resiliparse/extract/html2text.pyx":475
+    /* "resiliparse/extract/html2text.pyx":484
  *     # Global footer
  *     if regex_search_not_empty(cls_and_id_attr, footer_cls_regex) and length_to_body < 8:
  *         return False             # <<<<<<<<<<<<<<
  * 
  *     # Wrapper elements (whitelist them, they may contain more specific elements)
  */
     __pyx_r = 0;
     goto __pyx_L0;
 
-    /* "resiliparse/extract/html2text.pyx":474
+    /* "resiliparse/extract/html2text.pyx":483
  * 
  *     # Global footer
  *     if regex_search_not_empty(cls_and_id_attr, footer_cls_regex) and length_to_body < 8:             # <<<<<<<<<<<<<<
  *         return False
  * 
  */
   }
 
-  /* "resiliparse/extract/html2text.pyx":478
+  /* "resiliparse/extract/html2text.pyx":487
  * 
  *     # Wrapper elements (whitelist them, they may contain more specific elements)
  *     if node.local_name in [LXB_TAG_SECTION, LXB_TAG_DIV] and regex_search_not_empty(cls_and_id_attr, wrapper_cls_regex):             # <<<<<<<<<<<<<<
  *         return True
  * 
  */
   switch (__pyx_v_node->local_name) {
@@ -6647,34 +6852,34 @@
     goto __pyx_L68_bool_binop_done;
   }
   __pyx_t_2 = (__pyx_f_11resiliparse_7extract_9html2text_regex_search_not_empty(__pyx_v_cls_and_id_attr, __pyx_v_11resiliparse_7extract_9html2text_wrapper_cls_regex) != 0);
   __pyx_t_1 = __pyx_t_2;
   __pyx_L68_bool_binop_done:;
   if (__pyx_t_1) {
 
-    /* "resiliparse/extract/html2text.pyx":479
+    /* "resiliparse/extract/html2text.pyx":488
  *     # Wrapper elements (whitelist them, they may contain more specific elements)
  *     if node.local_name in [LXB_TAG_SECTION, LXB_TAG_DIV] and regex_search_not_empty(cls_and_id_attr, wrapper_cls_regex):
  *         return True             # <<<<<<<<<<<<<<
  * 
  *     # Global navigation
  */
     __pyx_r = 1;
     goto __pyx_L0;
 
-    /* "resiliparse/extract/html2text.pyx":478
+    /* "resiliparse/extract/html2text.pyx":487
  * 
  *     # Wrapper elements (whitelist them, they may contain more specific elements)
  *     if node.local_name in [LXB_TAG_SECTION, LXB_TAG_DIV] and regex_search_not_empty(cls_and_id_attr, wrapper_cls_regex):             # <<<<<<<<<<<<<<
  *         return True
  * 
  */
   }
 
-  /* "resiliparse/extract/html2text.pyx":482
+  /* "resiliparse/extract/html2text.pyx":491
  * 
  *     # Global navigation
  *     if length_to_body < 12 and node.local_name in [LXB_TAG_UL, LXB_TAG_HEADER, LXB_TAG_NAV, LXB_TAG_SECTION]:             # <<<<<<<<<<<<<<
  *         if regex_search_not_empty(cls_and_id_attr, nav_cls_regex):
  *             return False
  */
   __pyx_t_2 = ((__pyx_v_length_to_body < 12) != 0);
@@ -6695,82 +6900,82 @@
     break;
   }
   __pyx_t_4 = (__pyx_t_2 != 0);
   __pyx_t_1 = __pyx_t_4;
   __pyx_L71_bool_binop_done:;
   if (__pyx_t_1) {
 
-    /* "resiliparse/extract/html2text.pyx":483
+    /* "resiliparse/extract/html2text.pyx":492
  *     # Global navigation
  *     if length_to_body < 12 and node.local_name in [LXB_TAG_UL, LXB_TAG_HEADER, LXB_TAG_NAV, LXB_TAG_SECTION]:
  *         if regex_search_not_empty(cls_and_id_attr, nav_cls_regex):             # <<<<<<<<<<<<<<
  *             return False
  * 
  */
     __pyx_t_1 = (__pyx_f_11resiliparse_7extract_9html2text_regex_search_not_empty(__pyx_v_cls_and_id_attr, __pyx_v_11resiliparse_7extract_9html2text_nav_cls_regex) != 0);
     if (__pyx_t_1) {
 
-      /* "resiliparse/extract/html2text.pyx":484
+      /* "resiliparse/extract/html2text.pyx":493
  *     if length_to_body < 12 and node.local_name in [LXB_TAG_UL, LXB_TAG_HEADER, LXB_TAG_NAV, LXB_TAG_SECTION]:
  *         if regex_search_not_empty(cls_and_id_attr, nav_cls_regex):
  *             return False             # <<<<<<<<<<<<<<
  * 
  *     # Global search bar
  */
       __pyx_r = 0;
       goto __pyx_L0;
 
-      /* "resiliparse/extract/html2text.pyx":483
+      /* "resiliparse/extract/html2text.pyx":492
  *     # Global navigation
  *     if length_to_body < 12 and node.local_name in [LXB_TAG_UL, LXB_TAG_HEADER, LXB_TAG_NAV, LXB_TAG_SECTION]:
  *         if regex_search_not_empty(cls_and_id_attr, nav_cls_regex):             # <<<<<<<<<<<<<<
  *             return False
  * 
  */
     }
 
-    /* "resiliparse/extract/html2text.pyx":482
+    /* "resiliparse/extract/html2text.pyx":491
  * 
  *     # Global navigation
  *     if length_to_body < 12 and node.local_name in [LXB_TAG_UL, LXB_TAG_HEADER, LXB_TAG_NAV, LXB_TAG_SECTION]:             # <<<<<<<<<<<<<<
  *         if regex_search_not_empty(cls_and_id_attr, nav_cls_regex):
  *             return False
  */
   }
 
-  /* "resiliparse/extract/html2text.pyx":487
+  /* "resiliparse/extract/html2text.pyx":496
  * 
  *     # Global search bar
  *     if regex_search_not_empty(cls_and_id_attr, search_cls_regex):             # <<<<<<<<<<<<<<
  *         return False
  * 
  */
   __pyx_t_1 = (__pyx_f_11resiliparse_7extract_9html2text_regex_search_not_empty(__pyx_v_cls_and_id_attr, __pyx_v_11resiliparse_7extract_9html2text_search_cls_regex) != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/extract/html2text.pyx":488
+    /* "resiliparse/extract/html2text.pyx":497
  *     # Global search bar
  *     if regex_search_not_empty(cls_and_id_attr, search_cls_regex):
  *         return False             # <<<<<<<<<<<<<<
  * 
  *     # Global sidebar
  */
     __pyx_r = 0;
     goto __pyx_L0;
 
-    /* "resiliparse/extract/html2text.pyx":487
+    /* "resiliparse/extract/html2text.pyx":496
  * 
  *     # Global search bar
  *     if regex_search_not_empty(cls_and_id_attr, search_cls_regex):             # <<<<<<<<<<<<<<
  *         return False
  * 
  */
   }
 
-  /* "resiliparse/extract/html2text.pyx":491
+  /* "resiliparse/extract/html2text.pyx":500
  * 
  *     # Global sidebar
  *     if length_to_body < 4 and regex_search_not_empty(cls_and_id_attr, sidebar_cls_regex):             # <<<<<<<<<<<<<<
  *         return False
  * 
  */
   __pyx_t_4 = ((__pyx_v_length_to_body < 4) != 0);
@@ -6780,73 +6985,73 @@
     goto __pyx_L76_bool_binop_done;
   }
   __pyx_t_4 = (__pyx_f_11resiliparse_7extract_9html2text_regex_search_not_empty(__pyx_v_cls_and_id_attr, __pyx_v_11resiliparse_7extract_9html2text_sidebar_cls_regex) != 0);
   __pyx_t_1 = __pyx_t_4;
   __pyx_L76_bool_binop_done:;
   if (__pyx_t_1) {
 
-    /* "resiliparse/extract/html2text.pyx":492
+    /* "resiliparse/extract/html2text.pyx":501
  *     # Global sidebar
  *     if length_to_body < 4 and regex_search_not_empty(cls_and_id_attr, sidebar_cls_regex):
  *         return False             # <<<<<<<<<<<<<<
  * 
  *     # Modals
  */
     __pyx_r = 0;
     goto __pyx_L0;
 
-    /* "resiliparse/extract/html2text.pyx":491
+    /* "resiliparse/extract/html2text.pyx":500
  * 
  *     # Global sidebar
  *     if length_to_body < 4 and regex_search_not_empty(cls_and_id_attr, sidebar_cls_regex):             # <<<<<<<<<<<<<<
  *         return False
  * 
  */
   }
 
-  /* "resiliparse/extract/html2text.pyx":495
+  /* "resiliparse/extract/html2text.pyx":504
  * 
  *     # Modals
  *     if regex_search_not_empty(cls_and_id_attr, modal_cls_regex):             # <<<<<<<<<<<<<<
  *         return False
  * 
  */
   __pyx_t_1 = (__pyx_f_11resiliparse_7extract_9html2text_regex_search_not_empty(__pyx_v_cls_and_id_attr, __pyx_v_11resiliparse_7extract_9html2text_modal_cls_regex) != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/extract/html2text.pyx":496
+    /* "resiliparse/extract/html2text.pyx":505
  *     # Modals
  *     if regex_search_not_empty(cls_and_id_attr, modal_cls_regex):
  *         return False             # <<<<<<<<<<<<<<
  * 
  *     return True
  */
     __pyx_r = 0;
     goto __pyx_L0;
 
-    /* "resiliparse/extract/html2text.pyx":495
+    /* "resiliparse/extract/html2text.pyx":504
  * 
  *     # Modals
  *     if regex_search_not_empty(cls_and_id_attr, modal_cls_regex):             # <<<<<<<<<<<<<<
  *         return False
  * 
  */
   }
 
-  /* "resiliparse/extract/html2text.pyx":498
+  /* "resiliparse/extract/html2text.pyx":507
  *         return False
  * 
  *     return True             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __pyx_r = 1;
   goto __pyx_L0;
 
-  /* "resiliparse/extract/html2text.pyx":362
+  /* "resiliparse/extract/html2text.pyx":371
  * 
  * 
  * cdef bint _is_main_content_node(lxb_dom_node_t* node) nogil:             # <<<<<<<<<<<<<<
  *     """Check with simple heuristics if node belongs to main content."""
  * 
  */
 
@@ -6854,25 +7059,85 @@
   __pyx_L1_error:;
   __Pyx_WriteUnraisable("resiliparse.extract.html2text._is_main_content_node", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 1);
   __pyx_r = 0;
   __pyx_L0:;
   return __pyx_r;
 }
 
-/* "resiliparse/extract/html2text.pyx":501
+/* "resiliparse/extract/html2text.pyx":510
+ * 
+ * 
+ * cdef inline lxb_status_t _blacklist_select_cb(lxb_dom_node_t *node,             # <<<<<<<<<<<<<<
+ *                                               lxb_css_selector_specificity_t *spec, void *ctx) nogil:
+ *     (<stl_set[lxb_dom_node_t*]*>ctx).insert(node)
+ */
+
+static CYTHON_INLINE lxb_status_t __pyx_f_11resiliparse_7extract_9html2text__blacklist_select_cb(lxb_dom_node_t *__pyx_v_node, CYTHON_UNUSED lxb_css_selector_specificity_t *__pyx_v_spec, void *__pyx_v_ctx) {
+  lxb_status_t __pyx_r;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+
+  /* "resiliparse/extract/html2text.pyx":512
+ * cdef inline lxb_status_t _blacklist_select_cb(lxb_dom_node_t *node,
+ *                                               lxb_css_selector_specificity_t *spec, void *ctx) nogil:
+ *     (<stl_set[lxb_dom_node_t*]*>ctx).insert(node)             # <<<<<<<<<<<<<<
+ *     return LXB_STATUS_OK
+ * 
+ */
+  try {
+    ((std::set<lxb_dom_node_t *>  *)__pyx_v_ctx)->insert(__pyx_v_node);
+  } catch(...) {
+    #ifdef WITH_THREAD
+    PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
+    #endif
+    __Pyx_CppExn2PyErr();
+    #ifdef WITH_THREAD
+    __Pyx_PyGILState_Release(__pyx_gilstate_save);
+    #endif
+    __PYX_ERR(0, 512, __pyx_L1_error)
+  }
+
+  /* "resiliparse/extract/html2text.pyx":513
+ *                                               lxb_css_selector_specificity_t *spec, void *ctx) nogil:
+ *     (<stl_set[lxb_dom_node_t*]*>ctx).insert(node)
+ *     return LXB_STATUS_OK             # <<<<<<<<<<<<<<
+ * 
+ * 
+ */
+  __pyx_r = LXB_STATUS_OK;
+  goto __pyx_L0;
+
+  /* "resiliparse/extract/html2text.pyx":510
+ * 
+ * 
+ * cdef inline lxb_status_t _blacklist_select_cb(lxb_dom_node_t *node,             # <<<<<<<<<<<<<<
+ *                                               lxb_css_selector_specificity_t *spec, void *ctx) nogil:
+ *     (<stl_set[lxb_dom_node_t*]*>ctx).insert(node)
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_WriteUnraisable("resiliparse.extract.html2text._blacklist_select_cb", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 1);
+  __pyx_r = 0;
+  __pyx_L0:;
+  return __pyx_r;
+}
+
+/* "resiliparse/extract/html2text.pyx":516
  * 
  * 
- * def extract_plain_text(DOMNode base_node, bint preserve_formatting=True, bint main_content=False, bint list_bullets=True,             # <<<<<<<<<<<<<<
- *                        bint alt_texts=True, bint links=False, bint form_fields=False, bint noscript=False,
- *                        skip_elements=None):
+ * def extract_plain_text(DOMNode base_node, bint preserve_formatting=True, bint main_content=False,             # <<<<<<<<<<<<<<
+ *                        bint list_bullets=True,  bint alt_texts=True, bint links=False, bint form_fields=False,
+ *                        bint noscript=False, skip_elements=None):
  */
 
 /* Python wrapper */
 static PyObject *__pyx_pw_11resiliparse_7extract_9html2text_1extract_plain_text(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static char __pyx_doc_11resiliparse_7extract_9html2text_extract_plain_text[] = "\n    extract_plain_text(base_node, preserve_formatting=True, preserve_formatting=True, main_content=False,         list_bullets=True, alt_texts=False, links=True, form_fields=False, noscript=False, skip_elements=None)\n\n    Perform a simple plain-text extraction from the given DOM node and its children.\n\n    Extracts all visible text (excluding script/style elements, comment nodes etc.)\n    and collapses consecutive white space characters. If ``preserve_formatting`` is\n    ``True``, line breaks, paragraphs, other block-level elements, list elements, and\n    ``<pre>``-formatted text will be preserved.\n\n    Extraction of particular elements and attributes such as links, alt texts, or form fields\n    can be be configured individually by setting the corresponding parameter to ``True``.\n    Defaults to ``False`` for most elements (i.e., only basic text will be extracted).\n\n    :param base_node: base DOM node of which to extract sub tree\n    :type base_node: DOMNode\n    :param preserve_formatting: preserve basic block-level formatting\n    :type preserve_formatting: bool\n    :param main_content: apply simple heuristics for extracting only \"main-content\" elements\n    :type main_content: bool\n    :param list_bullets: insert bullets / numbers for list items\n    :type list_bullets: bool\n    :param alt_texts: preserve alternative text descriptions\n    :type alt_texts: bool\n    :param links: extract link target URLs\n    :type links: bool\n    :param form_fields: extract form fields and their values\n    :type form_fields: bool\n    :param noscript: extract contents of <noscript> elements\n    :param skip_elements: names of elements to skip (defaults to ``head``, ``script``, ``style``)\n    :type skip_elements: t.Iterable[str] or None\n    :type noscript: bool\n    :return: extracted plain text\n    :rtype: str\n    ";
+static char __pyx_doc_11resiliparse_7extract_9html2text_extract_plain_text[] = "\n    extract_plain_text(base_node, preserve_formatting=True, preserve_formatting=True, main_content=False,         list_bullets=True, alt_texts=False, links=True, form_fields=False, noscript=False, skip_elements=None)\n\n    Perform a simple plain-text extraction from the given DOM node and its children.\n\n    Extracts all visible text (excluding script/style elements, comment nodes etc.)\n    and collapses consecutive white space characters. If ``preserve_formatting`` is\n    ``True``, line breaks, paragraphs, other block-level elements, list elements, and\n    ``<pre>``-formatted text will be preserved.\n\n    Extraction of particular elements and attributes such as links, alt texts, or form fields\n    can be be configured individually by setting the corresponding parameter to ``True``.\n    Defaults to ``False`` for most elements (i.e., only basic text will be extracted).\n\n    :param base_node: base DOM node of which to extract sub tree\n    :type base_node: DOMNode\n    :param preserve_formatting: preserve basic block-level formatting\n    :type preserve_formatting: bool\n    :param main_content: apply simple heuristics for extracting only \"main-content\" elements\n    :type main_content: bool\n    :param list_bullets: insert bullets / numbers for list items\n    :type list_bullets: bool\n    :param alt_texts: preserve alternative text descriptions\n    :type alt_texts: bool\n    :param links: extract link target URLs\n    :type links: bool\n    :param form_fields: extract form fields and their values\n    :type form_fields: bool\n    :param noscript: extract contents of <noscript> elements\n    :param skip_elements: list of CSS selectors for elements to skip (defaults to ``head``, ``script``, ``style``)\n    :type skip_elements: t.Iterable[str] or None\n    :type noscript: bool\n    :return: extracted plain text\n    :rtype: str\n    ";
 static PyMethodDef __pyx_mdef_11resiliparse_7extract_9html2text_1extract_plain_text = {"extract_plain_text", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_11resiliparse_7extract_9html2text_1extract_plain_text, METH_VARARGS|METH_KEYWORDS, __pyx_doc_11resiliparse_7extract_9html2text_extract_plain_text};
 static PyObject *__pyx_pw_11resiliparse_7extract_9html2text_1extract_plain_text(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *__pyx_v_base_node = 0;
   int __pyx_v_preserve_formatting;
   int __pyx_v_main_content;
   int __pyx_v_list_bullets;
   int __pyx_v_alt_texts;
@@ -6886,18 +7151,18 @@
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("extract_plain_text (wrapper)", 0);
   {
     static PyObject **__pyx_pyargnames[] = {&__pyx_n_s_base_node,&__pyx_n_s_preserve_formatting,&__pyx_n_s_main_content,&__pyx_n_s_list_bullets,&__pyx_n_s_alt_texts,&__pyx_n_s_links,&__pyx_n_s_form_fields,&__pyx_n_s_noscript,&__pyx_n_s_skip_elements,0};
     PyObject* values[9] = {0,0,0,0,0,0,0,0,0};
 
-    /* "resiliparse/extract/html2text.pyx":503
- * def extract_plain_text(DOMNode base_node, bint preserve_formatting=True, bint main_content=False, bint list_bullets=True,
- *                        bint alt_texts=True, bint links=False, bint form_fields=False, bint noscript=False,
- *                        skip_elements=None):             # <<<<<<<<<<<<<<
+    /* "resiliparse/extract/html2text.pyx":518
+ * def extract_plain_text(DOMNode base_node, bint preserve_formatting=True, bint main_content=False,
+ *                        bint list_bullets=True,  bint alt_texts=True, bint links=False, bint form_fields=False,
+ *                        bint noscript=False, skip_elements=None):             # <<<<<<<<<<<<<<
  *     """
  *     extract_plain_text(base_node, preserve_formatting=True, preserve_formatting=True, main_content=False, \
  */
     values[8] = ((PyObject *)Py_None);
     if (unlikely(__pyx_kwds)) {
       Py_ssize_t kw_args;
       const Py_ssize_t pos_args = PyTuple_GET_SIZE(__pyx_args);
@@ -6974,15 +7239,15 @@
         case  8:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_skip_elements);
           if (value) { values[8] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "extract_plain_text") < 0)) __PYX_ERR(0, 501, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "extract_plain_text") < 0)) __PYX_ERR(0, 516, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  9: values[8] = PyTuple_GET_ITEM(__pyx_args, 8);
         CYTHON_FALLTHROUGH;
         case  8: values[7] = PyTuple_GET_ITEM(__pyx_args, 7);
         CYTHON_FALLTHROUGH;
@@ -7001,96 +7266,104 @@
         case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
         break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_base_node = ((struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *)values[0]);
     if (values[1]) {
-      __pyx_v_preserve_formatting = __Pyx_PyObject_IsTrue(values[1]); if (unlikely((__pyx_v_preserve_formatting == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 501, __pyx_L3_error)
+      __pyx_v_preserve_formatting = __Pyx_PyObject_IsTrue(values[1]); if (unlikely((__pyx_v_preserve_formatting == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 516, __pyx_L3_error)
     } else {
 
-      /* "resiliparse/extract/html2text.pyx":501
+      /* "resiliparse/extract/html2text.pyx":516
  * 
  * 
- * def extract_plain_text(DOMNode base_node, bint preserve_formatting=True, bint main_content=False, bint list_bullets=True,             # <<<<<<<<<<<<<<
- *                        bint alt_texts=True, bint links=False, bint form_fields=False, bint noscript=False,
- *                        skip_elements=None):
+ * def extract_plain_text(DOMNode base_node, bint preserve_formatting=True, bint main_content=False,             # <<<<<<<<<<<<<<
+ *                        bint list_bullets=True,  bint alt_texts=True, bint links=False, bint form_fields=False,
+ *                        bint noscript=False, skip_elements=None):
  */
       __pyx_v_preserve_formatting = ((int)1);
     }
     if (values[2]) {
-      __pyx_v_main_content = __Pyx_PyObject_IsTrue(values[2]); if (unlikely((__pyx_v_main_content == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 501, __pyx_L3_error)
+      __pyx_v_main_content = __Pyx_PyObject_IsTrue(values[2]); if (unlikely((__pyx_v_main_content == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 516, __pyx_L3_error)
     } else {
       __pyx_v_main_content = ((int)0);
     }
     if (values[3]) {
-      __pyx_v_list_bullets = __Pyx_PyObject_IsTrue(values[3]); if (unlikely((__pyx_v_list_bullets == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 501, __pyx_L3_error)
-    } else {
-      __pyx_v_list_bullets = ((int)1);
-    }
-    if (values[4]) {
-      __pyx_v_alt_texts = __Pyx_PyObject_IsTrue(values[4]); if (unlikely((__pyx_v_alt_texts == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 502, __pyx_L3_error)
+      __pyx_v_list_bullets = __Pyx_PyObject_IsTrue(values[3]); if (unlikely((__pyx_v_list_bullets == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 517, __pyx_L3_error)
     } else {
 
-      /* "resiliparse/extract/html2text.pyx":502
+      /* "resiliparse/extract/html2text.pyx":517
  * 
- * def extract_plain_text(DOMNode base_node, bint preserve_formatting=True, bint main_content=False, bint list_bullets=True,
- *                        bint alt_texts=True, bint links=False, bint form_fields=False, bint noscript=False,             # <<<<<<<<<<<<<<
- *                        skip_elements=None):
+ * def extract_plain_text(DOMNode base_node, bint preserve_formatting=True, bint main_content=False,
+ *                        bint list_bullets=True,  bint alt_texts=True, bint links=False, bint form_fields=False,             # <<<<<<<<<<<<<<
+ *                        bint noscript=False, skip_elements=None):
  *     """
  */
+      __pyx_v_list_bullets = ((int)1);
+    }
+    if (values[4]) {
+      __pyx_v_alt_texts = __Pyx_PyObject_IsTrue(values[4]); if (unlikely((__pyx_v_alt_texts == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 517, __pyx_L3_error)
+    } else {
       __pyx_v_alt_texts = ((int)1);
     }
     if (values[5]) {
-      __pyx_v_links = __Pyx_PyObject_IsTrue(values[5]); if (unlikely((__pyx_v_links == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 502, __pyx_L3_error)
+      __pyx_v_links = __Pyx_PyObject_IsTrue(values[5]); if (unlikely((__pyx_v_links == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 517, __pyx_L3_error)
     } else {
       __pyx_v_links = ((int)0);
     }
     if (values[6]) {
-      __pyx_v_form_fields = __Pyx_PyObject_IsTrue(values[6]); if (unlikely((__pyx_v_form_fields == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 502, __pyx_L3_error)
+      __pyx_v_form_fields = __Pyx_PyObject_IsTrue(values[6]); if (unlikely((__pyx_v_form_fields == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 517, __pyx_L3_error)
     } else {
       __pyx_v_form_fields = ((int)0);
     }
     if (values[7]) {
-      __pyx_v_noscript = __Pyx_PyObject_IsTrue(values[7]); if (unlikely((__pyx_v_noscript == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 502, __pyx_L3_error)
+      __pyx_v_noscript = __Pyx_PyObject_IsTrue(values[7]); if (unlikely((__pyx_v_noscript == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 518, __pyx_L3_error)
     } else {
+
+      /* "resiliparse/extract/html2text.pyx":518
+ * def extract_plain_text(DOMNode base_node, bint preserve_formatting=True, bint main_content=False,
+ *                        bint list_bullets=True,  bint alt_texts=True, bint links=False, bint form_fields=False,
+ *                        bint noscript=False, skip_elements=None):             # <<<<<<<<<<<<<<
+ *     """
+ *     extract_plain_text(base_node, preserve_formatting=True, preserve_formatting=True, main_content=False, \
+ */
       __pyx_v_noscript = ((int)0);
     }
     __pyx_v_skip_elements = values[8];
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("extract_plain_text", 0, 1, 9, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 501, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("extract_plain_text", 0, 1, 9, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 516, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("resiliparse.extract.html2text.extract_plain_text", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_base_node), __pyx_ptype_11resiliparse_5parse_4html_DOMNode, 1, "base_node", 0))) __PYX_ERR(0, 501, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_base_node), __pyx_ptype_11resiliparse_5parse_4html_DOMNode, 1, "base_node", 0))) __PYX_ERR(0, 516, __pyx_L1_error)
   __pyx_r = __pyx_pf_11resiliparse_7extract_9html2text_extract_plain_text(__pyx_self, __pyx_v_base_node, __pyx_v_preserve_formatting, __pyx_v_main_content, __pyx_v_list_bullets, __pyx_v_alt_texts, __pyx_v_links, __pyx_v_form_fields, __pyx_v_noscript, __pyx_v_skip_elements);
 
-  /* "resiliparse/extract/html2text.pyx":501
+  /* "resiliparse/extract/html2text.pyx":516
  * 
  * 
- * def extract_plain_text(DOMNode base_node, bint preserve_formatting=True, bint main_content=False, bint list_bullets=True,             # <<<<<<<<<<<<<<
- *                        bint alt_texts=True, bint links=False, bint form_fields=False, bint noscript=False,
- *                        skip_elements=None):
+ * def extract_plain_text(DOMNode base_node, bint preserve_formatting=True, bint main_content=False,             # <<<<<<<<<<<<<<
+ *                        bint list_bullets=True,  bint alt_texts=True, bint links=False, bint form_fields=False,
+ *                        bint noscript=False, skip_elements=None):
  */
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 static PyObject *__pyx_gb_11resiliparse_7extract_9html2text_18extract_plain_text_2generator(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value); /* proto */
 
-/* "resiliparse/extract/html2text.pyx":613
+/* "resiliparse/extract/html2text.pyx":642
  *             ctx.node = next_node(ctx.root_node, ctx.node, &ctx.depth, &is_end_tag)
  * 
  *     return ''.join(s.decode() for s in ctx.text).rstrip()             # <<<<<<<<<<<<<<
  */
 
 static PyObject *__pyx_pf_11resiliparse_7extract_9html2text_18extract_plain_text_genexpr(PyObject *__pyx_self) {
   struct __pyx_obj_11resiliparse_7extract_9html2text___pyx_scope_struct_1_genexpr *__pyx_cur_scope;
@@ -7100,23 +7373,23 @@
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("genexpr", 0);
   __pyx_cur_scope = (struct __pyx_obj_11resiliparse_7extract_9html2text___pyx_scope_struct_1_genexpr *)__pyx_tp_new_11resiliparse_7extract_9html2text___pyx_scope_struct_1_genexpr(__pyx_ptype_11resiliparse_7extract_9html2text___pyx_scope_struct_1_genexpr, __pyx_empty_tuple, NULL);
   if (unlikely(!__pyx_cur_scope)) {
     __pyx_cur_scope = ((struct __pyx_obj_11resiliparse_7extract_9html2text___pyx_scope_struct_1_genexpr *)Py_None);
     __Pyx_INCREF(Py_None);
-    __PYX_ERR(0, 613, __pyx_L1_error)
+    __PYX_ERR(0, 642, __pyx_L1_error)
   } else {
     __Pyx_GOTREF(__pyx_cur_scope);
   }
   __pyx_cur_scope->__pyx_outer_scope = (struct __pyx_obj_11resiliparse_7extract_9html2text___pyx_scope_struct__extract_plain_text *) __pyx_self;
   __Pyx_INCREF(((PyObject *)__pyx_cur_scope->__pyx_outer_scope));
   __Pyx_GIVEREF(__pyx_cur_scope->__pyx_outer_scope);
   {
-    __pyx_CoroutineObject *gen = __Pyx_Generator_New((__pyx_coroutine_body_t) __pyx_gb_11resiliparse_7extract_9html2text_18extract_plain_text_2generator, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_genexpr, __pyx_n_s_extract_plain_text_locals_genexp, __pyx_n_s_resiliparse_extract_html2text); if (unlikely(!gen)) __PYX_ERR(0, 613, __pyx_L1_error)
+    __pyx_CoroutineObject *gen = __Pyx_Generator_New((__pyx_coroutine_body_t) __pyx_gb_11resiliparse_7extract_9html2text_18extract_plain_text_2generator, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_genexpr, __pyx_n_s_extract_plain_text_locals_genexp, __pyx_n_s_resiliparse_extract_html2text); if (unlikely(!gen)) __PYX_ERR(0, 642, __pyx_L1_error)
     __Pyx_DECREF(__pyx_cur_scope);
     __Pyx_RefNannyFinishContext();
     return (PyObject *) gen;
   }
 
   /* function exit code */
   __pyx_L1_error:;
@@ -7144,27 +7417,27 @@
   switch (__pyx_generator->resume_label) {
     case 0: goto __pyx_L3_first_run;
     default: /* CPython raises the right error here */
     __Pyx_RefNannyFinishContext();
     return NULL;
   }
   __pyx_L3_first_run:;
-  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 613, __pyx_L1_error)
-  __pyx_r = PyList_New(0); if (unlikely(!__pyx_r)) __PYX_ERR(0, 613, __pyx_L1_error)
+  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 642, __pyx_L1_error)
+  __pyx_r = PyList_New(0); if (unlikely(!__pyx_r)) __PYX_ERR(0, 642, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_r);
   __pyx_t_2 = &__pyx_cur_scope->__pyx_outer_scope->__pyx_v_ctx.text;
   __pyx_t_1 = __pyx_t_2->begin();
   for (;;) {
     if (!(__pyx_t_1 != __pyx_t_2->end())) break;
     __pyx_t_3 = *__pyx_t_1;
     ++__pyx_t_1;
     __pyx_cur_scope->__pyx_v_s = __pyx_t_3;
-    __pyx_t_4 = __Pyx_decode_cpp_string(__pyx_cur_scope->__pyx_v_s, 0, PY_SSIZE_T_MAX, NULL, NULL, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 613, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_decode_cpp_string(__pyx_cur_scope->__pyx_v_s, 0, PY_SSIZE_T_MAX, NULL, NULL, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 642, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    if (unlikely(__Pyx_ListComp_Append(__pyx_r, (PyObject*)__pyx_t_4))) __PYX_ERR(0, 613, __pyx_L1_error)
+    if (unlikely(__Pyx_ListComp_Append(__pyx_r, (PyObject*)__pyx_t_4))) __PYX_ERR(0, 642, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   }
   CYTHON_MAYBE_UNUSED_VAR(__pyx_cur_scope);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
@@ -7178,31 +7451,34 @@
   #endif
   __pyx_generator->resume_label = -1;
   __Pyx_Coroutine_clear((PyObject*)__pyx_generator);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/extract/html2text.pyx":501
+/* "resiliparse/extract/html2text.pyx":516
  * 
  * 
- * def extract_plain_text(DOMNode base_node, bint preserve_formatting=True, bint main_content=False, bint list_bullets=True,             # <<<<<<<<<<<<<<
- *                        bint alt_texts=True, bint links=False, bint form_fields=False, bint noscript=False,
- *                        skip_elements=None):
+ * def extract_plain_text(DOMNode base_node, bint preserve_formatting=True, bint main_content=False,             # <<<<<<<<<<<<<<
+ *                        bint list_bullets=True,  bint alt_texts=True, bint links=False, bint form_fields=False,
+ *                        bint noscript=False, skip_elements=None):
  */
 
 static PyObject *__pyx_pf_11resiliparse_7extract_9html2text_extract_plain_text(CYTHON_UNUSED PyObject *__pyx_self, struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *__pyx_v_base_node, int __pyx_v_preserve_formatting, int __pyx_v_main_content, int __pyx_v_list_bullets, int __pyx_v_alt_texts, int __pyx_v_links, int __pyx_v_form_fields, int __pyx_v_noscript, PyObject *__pyx_v_skip_elements) {
   struct __pyx_obj_11resiliparse_7extract_9html2text___pyx_scope_struct__extract_plain_text *__pyx_cur_scope;
-  std::vector<std::string>  __pyx_v_skip_elements_vec;
-  lxb_char_t const *__pyx_v_tag_name;
-  size_t __pyx_v_tag_name_len;
-  std::string __pyx_v_tag_name_str;
-  size_t __pyx_v_i;
-  int __pyx_v_skip;
+  PyObject *__pyx_v_skip_selectors = NULL;
+  CYTHON_UNUSED lxb_char_t const *__pyx_v_tag_name;
+  CYTHON_UNUSED int __pyx_v_skip;
   int __pyx_v_is_end_tag;
+  lxb_css_parser_t *__pyx_v_css_parser;
+  lxb_css_selectors_t *__pyx_v_css_selectors;
+  lxb_selectors_t *__pyx_v_selectors;
+  lxb_css_selector_list_t *__pyx_v_selector_list;
+  std::set<lxb_dom_node_t *>  __pyx_v_node_blacklist;
+  PyObject *__pyx_v_combined_skip_sel = NULL;
   PyObject *__pyx_7genexpr__pyx_v_e = NULL;
   PyObject *__pyx_gb_11resiliparse_7extract_9html2text_18extract_plain_text_2generator = 0;
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   int __pyx_t_1;
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
@@ -7210,909 +7486,970 @@
   Py_ssize_t __pyx_t_5;
   PyObject *(*__pyx_t_6)(PyObject *);
   PyObject *__pyx_t_7 = NULL;
   PyObject *__pyx_t_8 = NULL;
   int __pyx_t_9;
   lxb_dom_node_t *__pyx_t_10;
   struct __pyx_t_11resiliparse_7extract_9html2text_ExtractOpts __pyx_t_11;
-  std::vector<std::string>  __pyx_t_12;
-  struct __pyx_opt_args_11resiliparse_5parse_4html_next_node __pyx_t_13;
-  std::string __pyx_t_14;
-  std::vector<std::string> ::size_type __pyx_t_15;
-  std::vector<std::string> ::size_type __pyx_t_16;
-  size_t __pyx_t_17;
+  lxb_char_t *__pyx_t_12;
+  lxb_css_selector_list_t *__pyx_t_13;
+  int __pyx_t_14;
+  int __pyx_t_15;
+  char const *__pyx_t_16;
+  PyObject *__pyx_t_17 = NULL;
+  PyObject *__pyx_t_18 = NULL;
+  PyObject *__pyx_t_19 = NULL;
+  PyObject *__pyx_t_20 = NULL;
+  PyObject *__pyx_t_21 = NULL;
+  PyObject *__pyx_t_22 = NULL;
+  struct __pyx_opt_args_11resiliparse_5parse_4html_next_node __pyx_t_23;
+  int __pyx_t_24;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("extract_plain_text", 0);
   __pyx_cur_scope = (struct __pyx_obj_11resiliparse_7extract_9html2text___pyx_scope_struct__extract_plain_text *)__pyx_tp_new_11resiliparse_7extract_9html2text___pyx_scope_struct__extract_plain_text(__pyx_ptype_11resiliparse_7extract_9html2text___pyx_scope_struct__extract_plain_text, __pyx_empty_tuple, NULL);
   if (unlikely(!__pyx_cur_scope)) {
     __pyx_cur_scope = ((struct __pyx_obj_11resiliparse_7extract_9html2text___pyx_scope_struct__extract_plain_text *)Py_None);
     __Pyx_INCREF(Py_None);
-    __PYX_ERR(0, 501, __pyx_L1_error)
+    __PYX_ERR(0, 516, __pyx_L1_error)
   } else {
     __Pyx_GOTREF(__pyx_cur_scope);
   }
-  __Pyx_INCREF(__pyx_v_skip_elements);
 
-  /* "resiliparse/extract/html2text.pyx":540
+  /* "resiliparse/extract/html2text.pyx":555
  *     :rtype: str
  *     """
  *     if not check_node(base_node):             # <<<<<<<<<<<<<<
  *         return ''
  * 
  */
   __pyx_t_1 = ((!(__pyx_f_11resiliparse_5parse_4html_check_node(__pyx_v_base_node) != 0)) != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/extract/html2text.pyx":541
+    /* "resiliparse/extract/html2text.pyx":556
  *     """
  *     if not check_node(base_node):
  *         return ''             # <<<<<<<<<<<<<<
  * 
- *     skip_elements = {e.encode() for e in skip_elements or []}
+ *     skip_selectors = {e.encode() for e in skip_elements or []}
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_kp_u_);
     __pyx_r = __pyx_kp_u_;
     goto __pyx_L0;
 
-    /* "resiliparse/extract/html2text.pyx":540
+    /* "resiliparse/extract/html2text.pyx":555
  *     :rtype: str
  *     """
  *     if not check_node(base_node):             # <<<<<<<<<<<<<<
  *         return ''
  * 
  */
   }
 
-  /* "resiliparse/extract/html2text.pyx":543
+  /* "resiliparse/extract/html2text.pyx":558
  *         return ''
  * 
- *     skip_elements = {e.encode() for e in skip_elements or []}             # <<<<<<<<<<<<<<
- *     if not skip_elements:
- *         skip_elements = {b'head', b'script', b'style'}
+ *     skip_selectors = {e.encode() for e in skip_elements or []}             # <<<<<<<<<<<<<<
+ *     skip_selectors.update({b'script', b'style'})
+ *     if not alt_texts:
  */
   { /* enter inner scope */
-    __pyx_t_2 = PySet_New(NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 543, __pyx_L6_error)
+    __pyx_t_2 = PySet_New(NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 558, __pyx_L6_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_skip_elements); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 543, __pyx_L6_error)
+    __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_skip_elements); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 558, __pyx_L6_error)
     if (!__pyx_t_1) {
     } else {
       __Pyx_INCREF(__pyx_v_skip_elements);
       __pyx_t_3 = __pyx_v_skip_elements;
       goto __pyx_L9_bool_binop_done;
     }
-    __pyx_t_4 = PyList_New(0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 543, __pyx_L6_error)
+    __pyx_t_4 = PyList_New(0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 558, __pyx_L6_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_INCREF(__pyx_t_4);
     __pyx_t_3 = __pyx_t_4;
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __pyx_L9_bool_binop_done:;
     if (likely(PyList_CheckExact(__pyx_t_3)) || PyTuple_CheckExact(__pyx_t_3)) {
       __pyx_t_4 = __pyx_t_3; __Pyx_INCREF(__pyx_t_4); __pyx_t_5 = 0;
       __pyx_t_6 = NULL;
     } else {
-      __pyx_t_5 = -1; __pyx_t_4 = PyObject_GetIter(__pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 543, __pyx_L6_error)
+      __pyx_t_5 = -1; __pyx_t_4 = PyObject_GetIter(__pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 558, __pyx_L6_error)
       __Pyx_GOTREF(__pyx_t_4);
-      __pyx_t_6 = Py_TYPE(__pyx_t_4)->tp_iternext; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 543, __pyx_L6_error)
+      __pyx_t_6 = Py_TYPE(__pyx_t_4)->tp_iternext; if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 558, __pyx_L6_error)
     }
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     for (;;) {
       if (likely(!__pyx_t_6)) {
         if (likely(PyList_CheckExact(__pyx_t_4))) {
           if (__pyx_t_5 >= PyList_GET_SIZE(__pyx_t_4)) break;
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-          __pyx_t_3 = PyList_GET_ITEM(__pyx_t_4, __pyx_t_5); __Pyx_INCREF(__pyx_t_3); __pyx_t_5++; if (unlikely(0 < 0)) __PYX_ERR(0, 543, __pyx_L6_error)
+          __pyx_t_3 = PyList_GET_ITEM(__pyx_t_4, __pyx_t_5); __Pyx_INCREF(__pyx_t_3); __pyx_t_5++; if (unlikely(0 < 0)) __PYX_ERR(0, 558, __pyx_L6_error)
           #else
-          __pyx_t_3 = PySequence_ITEM(__pyx_t_4, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 543, __pyx_L6_error)
+          __pyx_t_3 = PySequence_ITEM(__pyx_t_4, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 558, __pyx_L6_error)
           __Pyx_GOTREF(__pyx_t_3);
           #endif
         } else {
           if (__pyx_t_5 >= PyTuple_GET_SIZE(__pyx_t_4)) break;
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-          __pyx_t_3 = PyTuple_GET_ITEM(__pyx_t_4, __pyx_t_5); __Pyx_INCREF(__pyx_t_3); __pyx_t_5++; if (unlikely(0 < 0)) __PYX_ERR(0, 543, __pyx_L6_error)
+          __pyx_t_3 = PyTuple_GET_ITEM(__pyx_t_4, __pyx_t_5); __Pyx_INCREF(__pyx_t_3); __pyx_t_5++; if (unlikely(0 < 0)) __PYX_ERR(0, 558, __pyx_L6_error)
           #else
-          __pyx_t_3 = PySequence_ITEM(__pyx_t_4, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 543, __pyx_L6_error)
+          __pyx_t_3 = PySequence_ITEM(__pyx_t_4, __pyx_t_5); __pyx_t_5++; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 558, __pyx_L6_error)
           __Pyx_GOTREF(__pyx_t_3);
           #endif
         }
       } else {
         __pyx_t_3 = __pyx_t_6(__pyx_t_4);
         if (unlikely(!__pyx_t_3)) {
           PyObject* exc_type = PyErr_Occurred();
           if (exc_type) {
             if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-            else __PYX_ERR(0, 543, __pyx_L6_error)
+            else __PYX_ERR(0, 558, __pyx_L6_error)
           }
           break;
         }
         __Pyx_GOTREF(__pyx_t_3);
       }
       __Pyx_XDECREF_SET(__pyx_7genexpr__pyx_v_e, __pyx_t_3);
       __pyx_t_3 = 0;
-      __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_7genexpr__pyx_v_e, __pyx_n_s_encode); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 543, __pyx_L6_error)
+      __pyx_t_7 = __Pyx_PyObject_GetAttrStr(__pyx_7genexpr__pyx_v_e, __pyx_n_s_encode); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 558, __pyx_L6_error)
       __Pyx_GOTREF(__pyx_t_7);
       __pyx_t_8 = NULL;
       if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_7))) {
         __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_7);
         if (likely(__pyx_t_8)) {
           PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
           __Pyx_INCREF(__pyx_t_8);
           __Pyx_INCREF(function);
           __Pyx_DECREF_SET(__pyx_t_7, function);
         }
       }
       __pyx_t_3 = (__pyx_t_8) ? __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_t_8) : __Pyx_PyObject_CallNoArg(__pyx_t_7);
       __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
-      if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 543, __pyx_L6_error)
+      if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 558, __pyx_L6_error)
       __Pyx_GOTREF(__pyx_t_3);
       __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-      if (unlikely(PySet_Add(__pyx_t_2, (PyObject*)__pyx_t_3))) __PYX_ERR(0, 543, __pyx_L6_error)
+      if (unlikely(PySet_Add(__pyx_t_2, (PyObject*)__pyx_t_3))) __PYX_ERR(0, 558, __pyx_L6_error)
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     }
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_XDECREF(__pyx_7genexpr__pyx_v_e); __pyx_7genexpr__pyx_v_e = 0;
     goto __pyx_L11_exit_scope;
     __pyx_L6_error:;
     __Pyx_XDECREF(__pyx_7genexpr__pyx_v_e); __pyx_7genexpr__pyx_v_e = 0;
     goto __pyx_L1_error;
     __pyx_L11_exit_scope:;
   } /* exit inner scope */
-  __Pyx_DECREF_SET(__pyx_v_skip_elements, __pyx_t_2);
+  __pyx_v_skip_selectors = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "resiliparse/extract/html2text.pyx":544
- * 
- *     skip_elements = {e.encode() for e in skip_elements or []}
- *     if not skip_elements:             # <<<<<<<<<<<<<<
- *         skip_elements = {b'head', b'script', b'style'}
- *     if not alt_texts:
- */
-  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_v_skip_elements); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 544, __pyx_L1_error)
-  __pyx_t_9 = ((!__pyx_t_1) != 0);
-  if (__pyx_t_9) {
-
-    /* "resiliparse/extract/html2text.pyx":545
- *     skip_elements = {e.encode() for e in skip_elements or []}
- *     if not skip_elements:
- *         skip_elements = {b'head', b'script', b'style'}             # <<<<<<<<<<<<<<
- *     if not alt_texts:
- *         skip_elements.update({b'object', b'video', b'audio', b'embed' b'img', b'area'})
- */
-    __pyx_t_2 = PySet_New(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 545, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_2);
-    if (PySet_Add(__pyx_t_2, __pyx_n_b_head) < 0) __PYX_ERR(0, 545, __pyx_L1_error)
-    if (PySet_Add(__pyx_t_2, __pyx_n_b_script) < 0) __PYX_ERR(0, 545, __pyx_L1_error)
-    if (PySet_Add(__pyx_t_2, __pyx_n_b_style) < 0) __PYX_ERR(0, 545, __pyx_L1_error)
-    __Pyx_DECREF_SET(__pyx_v_skip_elements, __pyx_t_2);
-    __pyx_t_2 = 0;
-
-    /* "resiliparse/extract/html2text.pyx":544
+  /* "resiliparse/extract/html2text.pyx":559
  * 
- *     skip_elements = {e.encode() for e in skip_elements or []}
- *     if not skip_elements:             # <<<<<<<<<<<<<<
- *         skip_elements = {b'head', b'script', b'style'}
+ *     skip_selectors = {e.encode() for e in skip_elements or []}
+ *     skip_selectors.update({b'script', b'style'})             # <<<<<<<<<<<<<<
  *     if not alt_texts:
+ *         skip_selectors.update({b'object', b'video', b'audio', b'embed' b'img', b'area'})
  */
-  }
+  __pyx_t_2 = PySet_New(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 559, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  if (PySet_Add(__pyx_t_2, __pyx_n_b_script) < 0) __PYX_ERR(0, 559, __pyx_L1_error)
+  if (PySet_Add(__pyx_t_2, __pyx_n_b_style) < 0) __PYX_ERR(0, 559, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_CallUnboundCMethod1(&__pyx_umethod_PySet_Type_update, __pyx_v_skip_selectors, __pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 559, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_4);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "resiliparse/extract/html2text.pyx":546
- *     if not skip_elements:
- *         skip_elements = {b'head', b'script', b'style'}
+  /* "resiliparse/extract/html2text.pyx":560
+ *     skip_selectors = {e.encode() for e in skip_elements or []}
+ *     skip_selectors.update({b'script', b'style'})
  *     if not alt_texts:             # <<<<<<<<<<<<<<
- *         skip_elements.update({b'object', b'video', b'audio', b'embed' b'img', b'area'})
+ *         skip_selectors.update({b'object', b'video', b'audio', b'embed' b'img', b'area'})
  *     if not noscript:
  */
-  __pyx_t_9 = ((!(__pyx_v_alt_texts != 0)) != 0);
-  if (__pyx_t_9) {
+  __pyx_t_1 = ((!(__pyx_v_alt_texts != 0)) != 0);
+  if (__pyx_t_1) {
 
-    /* "resiliparse/extract/html2text.pyx":547
- *         skip_elements = {b'head', b'script', b'style'}
+    /* "resiliparse/extract/html2text.pyx":561
+ *     skip_selectors.update({b'script', b'style'})
  *     if not alt_texts:
- *         skip_elements.update({b'object', b'video', b'audio', b'embed' b'img', b'area'})             # <<<<<<<<<<<<<<
+ *         skip_selectors.update({b'object', b'video', b'audio', b'embed' b'img', b'area'})             # <<<<<<<<<<<<<<
  *     if not noscript:
- *         skip_elements.add(b'noscript')
+ *         skip_selectors.add(b'noscript')
  */
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_skip_elements, __pyx_n_s_update); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 547, __pyx_L1_error)
+    __pyx_t_4 = PySet_New(0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 561, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_3 = PySet_New(0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 547, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_3);
-    if (PySet_Add(__pyx_t_3, __pyx_n_b_object) < 0) __PYX_ERR(0, 547, __pyx_L1_error)
-    if (PySet_Add(__pyx_t_3, __pyx_n_b_video) < 0) __PYX_ERR(0, 547, __pyx_L1_error)
-    if (PySet_Add(__pyx_t_3, __pyx_n_b_audio) < 0) __PYX_ERR(0, 547, __pyx_L1_error)
-    if (PySet_Add(__pyx_t_3, __pyx_n_b_embedimg) < 0) __PYX_ERR(0, 547, __pyx_L1_error)
-    if (PySet_Add(__pyx_t_3, __pyx_n_b_area) < 0) __PYX_ERR(0, 547, __pyx_L1_error)
-    __pyx_t_7 = NULL;
-    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
-      __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_4);
-      if (likely(__pyx_t_7)) {
-        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
-        __Pyx_INCREF(__pyx_t_7);
-        __Pyx_INCREF(function);
-        __Pyx_DECREF_SET(__pyx_t_4, function);
-      }
-    }
-    __pyx_t_2 = (__pyx_t_7) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_7, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_3);
-    __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
-    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 547, __pyx_L1_error)
+    if (PySet_Add(__pyx_t_4, __pyx_n_b_object) < 0) __PYX_ERR(0, 561, __pyx_L1_error)
+    if (PySet_Add(__pyx_t_4, __pyx_n_b_video) < 0) __PYX_ERR(0, 561, __pyx_L1_error)
+    if (PySet_Add(__pyx_t_4, __pyx_n_b_audio) < 0) __PYX_ERR(0, 561, __pyx_L1_error)
+    if (PySet_Add(__pyx_t_4, __pyx_n_b_embedimg) < 0) __PYX_ERR(0, 561, __pyx_L1_error)
+    if (PySet_Add(__pyx_t_4, __pyx_n_b_area) < 0) __PYX_ERR(0, 561, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_CallUnboundCMethod1(&__pyx_umethod_PySet_Type_update, __pyx_v_skip_selectors, __pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 561, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-    /* "resiliparse/extract/html2text.pyx":546
- *     if not skip_elements:
- *         skip_elements = {b'head', b'script', b'style'}
+    /* "resiliparse/extract/html2text.pyx":560
+ *     skip_selectors = {e.encode() for e in skip_elements or []}
+ *     skip_selectors.update({b'script', b'style'})
  *     if not alt_texts:             # <<<<<<<<<<<<<<
- *         skip_elements.update({b'object', b'video', b'audio', b'embed' b'img', b'area'})
+ *         skip_selectors.update({b'object', b'video', b'audio', b'embed' b'img', b'area'})
  *     if not noscript:
  */
   }
 
-  /* "resiliparse/extract/html2text.pyx":548
+  /* "resiliparse/extract/html2text.pyx":562
  *     if not alt_texts:
- *         skip_elements.update({b'object', b'video', b'audio', b'embed' b'img', b'area'})
+ *         skip_selectors.update({b'object', b'video', b'audio', b'embed' b'img', b'area'})
  *     if not noscript:             # <<<<<<<<<<<<<<
- *         skip_elements.add(b'noscript')
+ *         skip_selectors.add(b'noscript')
  *     if not form_fields:
  */
-  __pyx_t_9 = ((!(__pyx_v_noscript != 0)) != 0);
-  if (__pyx_t_9) {
+  __pyx_t_1 = ((!(__pyx_v_noscript != 0)) != 0);
+  if (__pyx_t_1) {
 
-    /* "resiliparse/extract/html2text.pyx":549
- *         skip_elements.update({b'object', b'video', b'audio', b'embed' b'img', b'area'})
+    /* "resiliparse/extract/html2text.pyx":563
+ *         skip_selectors.update({b'object', b'video', b'audio', b'embed' b'img', b'area'})
  *     if not noscript:
- *         skip_elements.add(b'noscript')             # <<<<<<<<<<<<<<
+ *         skip_selectors.add(b'noscript')             # <<<<<<<<<<<<<<
  *     if not form_fields:
- *         skip_elements.update({b'textarea', b'input', b'button'})
+ *         skip_selectors.update({b'textarea', b'input', b'button'})
  */
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_skip_elements, __pyx_n_s_add); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 549, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_3 = NULL;
-    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
-      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_4);
-      if (likely(__pyx_t_3)) {
-        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
-        __Pyx_INCREF(__pyx_t_3);
-        __Pyx_INCREF(function);
-        __Pyx_DECREF_SET(__pyx_t_4, function);
-      }
-    }
-    __pyx_t_2 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_3, __pyx_n_b_noscript) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_n_b_noscript);
-    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 549, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_2);
-    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+    __pyx_t_9 = PySet_Add(__pyx_v_skip_selectors, __pyx_n_b_noscript); if (unlikely(__pyx_t_9 == ((int)-1))) __PYX_ERR(0, 563, __pyx_L1_error)
 
-    /* "resiliparse/extract/html2text.pyx":548
+    /* "resiliparse/extract/html2text.pyx":562
  *     if not alt_texts:
- *         skip_elements.update({b'object', b'video', b'audio', b'embed' b'img', b'area'})
+ *         skip_selectors.update({b'object', b'video', b'audio', b'embed' b'img', b'area'})
  *     if not noscript:             # <<<<<<<<<<<<<<
- *         skip_elements.add(b'noscript')
+ *         skip_selectors.add(b'noscript')
  *     if not form_fields:
  */
   }
 
-  /* "resiliparse/extract/html2text.pyx":550
+  /* "resiliparse/extract/html2text.pyx":564
  *     if not noscript:
- *         skip_elements.add(b'noscript')
+ *         skip_selectors.add(b'noscript')
  *     if not form_fields:             # <<<<<<<<<<<<<<
- *         skip_elements.update({b'textarea', b'input', b'button'})
+ *         skip_selectors.update({b'textarea', b'input', b'button'})
  * 
  */
-  __pyx_t_9 = ((!(__pyx_v_form_fields != 0)) != 0);
-  if (__pyx_t_9) {
+  __pyx_t_1 = ((!(__pyx_v_form_fields != 0)) != 0);
+  if (__pyx_t_1) {
 
-    /* "resiliparse/extract/html2text.pyx":551
- *         skip_elements.add(b'noscript')
+    /* "resiliparse/extract/html2text.pyx":565
+ *         skip_selectors.add(b'noscript')
  *     if not form_fields:
- *         skip_elements.update({b'textarea', b'input', b'button'})             # <<<<<<<<<<<<<<
+ *         skip_selectors.update({b'textarea', b'input', b'button'})             # <<<<<<<<<<<<<<
  * 
  *     cdef ExtractContext ctx
  */
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_skip_elements, __pyx_n_s_update); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 551, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_3 = PySet_New(0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 551, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_3);
-    if (PySet_Add(__pyx_t_3, __pyx_n_b_textarea) < 0) __PYX_ERR(0, 551, __pyx_L1_error)
-    if (PySet_Add(__pyx_t_3, __pyx_n_b_input) < 0) __PYX_ERR(0, 551, __pyx_L1_error)
-    if (PySet_Add(__pyx_t_3, __pyx_n_b_button) < 0) __PYX_ERR(0, 551, __pyx_L1_error)
-    __pyx_t_7 = NULL;
-    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
-      __pyx_t_7 = PyMethod_GET_SELF(__pyx_t_4);
-      if (likely(__pyx_t_7)) {
-        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
-        __Pyx_INCREF(__pyx_t_7);
-        __Pyx_INCREF(function);
-        __Pyx_DECREF_SET(__pyx_t_4, function);
-      }
-    }
-    __pyx_t_2 = (__pyx_t_7) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_7, __pyx_t_3) : __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_3);
-    __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
-    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 551, __pyx_L1_error)
+    __pyx_t_2 = PySet_New(0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 565, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    if (PySet_Add(__pyx_t_2, __pyx_n_b_textarea) < 0) __PYX_ERR(0, 565, __pyx_L1_error)
+    if (PySet_Add(__pyx_t_2, __pyx_n_b_input) < 0) __PYX_ERR(0, 565, __pyx_L1_error)
+    if (PySet_Add(__pyx_t_2, __pyx_n_b_button) < 0) __PYX_ERR(0, 565, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_CallUnboundCMethod1(&__pyx_umethod_PySet_Type_update, __pyx_v_skip_selectors, __pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 565, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-    /* "resiliparse/extract/html2text.pyx":550
+    /* "resiliparse/extract/html2text.pyx":564
  *     if not noscript:
- *         skip_elements.add(b'noscript')
+ *         skip_selectors.add(b'noscript')
  *     if not form_fields:             # <<<<<<<<<<<<<<
- *         skip_elements.update({b'textarea', b'input', b'button'})
+ *         skip_selectors.update({b'textarea', b'input', b'button'})
  * 
  */
   }
 
-  /* "resiliparse/extract/html2text.pyx":554
+  /* "resiliparse/extract/html2text.pyx":568
  * 
  *     cdef ExtractContext ctx
  *     ctx.root_node = base_node.node             # <<<<<<<<<<<<<<
  *     ctx.depth = 0
  *     ctx.list_depth = 0
  */
   __pyx_t_10 = __pyx_v_base_node->node;
   __pyx_cur_scope->__pyx_v_ctx.root_node = __pyx_t_10;
 
-  /* "resiliparse/extract/html2text.pyx":555
+  /* "resiliparse/extract/html2text.pyx":569
  *     cdef ExtractContext ctx
  *     ctx.root_node = base_node.node
  *     ctx.depth = 0             # <<<<<<<<<<<<<<
  *     ctx.list_depth = 0
  *     ctx.pre_depth = 0
  */
   __pyx_cur_scope->__pyx_v_ctx.depth = 0;
 
-  /* "resiliparse/extract/html2text.pyx":556
+  /* "resiliparse/extract/html2text.pyx":570
  *     ctx.root_node = base_node.node
  *     ctx.depth = 0
  *     ctx.list_depth = 0             # <<<<<<<<<<<<<<
  *     ctx.pre_depth = 0
  *     ctx.space_before_next_block = False
  */
   __pyx_cur_scope->__pyx_v_ctx.list_depth = 0;
 
-  /* "resiliparse/extract/html2text.pyx":557
+  /* "resiliparse/extract/html2text.pyx":571
  *     ctx.depth = 0
  *     ctx.list_depth = 0
  *     ctx.pre_depth = 0             # <<<<<<<<<<<<<<
  *     ctx.space_before_next_block = False
  *     ctx.newline_before_next_block = False
  */
   __pyx_cur_scope->__pyx_v_ctx.pre_depth = 0;
 
-  /* "resiliparse/extract/html2text.pyx":558
+  /* "resiliparse/extract/html2text.pyx":572
  *     ctx.list_depth = 0
  *     ctx.pre_depth = 0
  *     ctx.space_before_next_block = False             # <<<<<<<<<<<<<<
  *     ctx.newline_before_next_block = False
- *     ctx.lstrip_next_block = False
+ *     ctx.tab_before_next_block = False
  */
   __pyx_cur_scope->__pyx_v_ctx.space_before_next_block = 0;
 
-  /* "resiliparse/extract/html2text.pyx":559
+  /* "resiliparse/extract/html2text.pyx":573
  *     ctx.pre_depth = 0
  *     ctx.space_before_next_block = False
  *     ctx.newline_before_next_block = False             # <<<<<<<<<<<<<<
+ *     ctx.tab_before_next_block = False
  *     ctx.lstrip_next_block = False
- *     ctx.opts = [
  */
   __pyx_cur_scope->__pyx_v_ctx.newline_before_next_block = 0;
 
-  /* "resiliparse/extract/html2text.pyx":560
+  /* "resiliparse/extract/html2text.pyx":574
  *     ctx.space_before_next_block = False
  *     ctx.newline_before_next_block = False
+ *     ctx.tab_before_next_block = False             # <<<<<<<<<<<<<<
+ *     ctx.lstrip_next_block = False
+ *     ctx.opts = [
+ */
+  __pyx_cur_scope->__pyx_v_ctx.tab_before_next_block = 0;
+
+  /* "resiliparse/extract/html2text.pyx":575
+ *     ctx.newline_before_next_block = False
+ *     ctx.tab_before_next_block = False
  *     ctx.lstrip_next_block = False             # <<<<<<<<<<<<<<
  *     ctx.opts = [
  *         preserve_formatting,
  */
   __pyx_cur_scope->__pyx_v_ctx.lstrip_next_block = 0;
 
-  /* "resiliparse/extract/html2text.pyx":561
- *     ctx.newline_before_next_block = False
+  /* "resiliparse/extract/html2text.pyx":576
+ *     ctx.tab_before_next_block = False
  *     ctx.lstrip_next_block = False
  *     ctx.opts = [             # <<<<<<<<<<<<<<
  *         preserve_formatting,
  *         list_bullets,
  */
   __pyx_t_11.preserve_formatting = __pyx_v_preserve_formatting;
   __pyx_t_11.list_bullets = __pyx_v_list_bullets;
   __pyx_t_11.links = __pyx_v_links;
   __pyx_t_11.alt_texts = __pyx_v_alt_texts;
   __pyx_t_11.form_fields = __pyx_v_form_fields;
   __pyx_t_11.noscript = __pyx_v_noscript;
   __pyx_cur_scope->__pyx_v_ctx.opts = __pyx_t_11;
 
-  /* "resiliparse/extract/html2text.pyx":569
+  /* "resiliparse/extract/html2text.pyx":584
  *         noscript]
  * 
  *     ctx.node = base_node.node             # <<<<<<<<<<<<<<
  * 
- *     cdef vector[string] skip_elements_vec = list(skip_elements)
+ *     cdef const lxb_char_t* tag_name = NULL
  */
   __pyx_t_10 = __pyx_v_base_node->node;
   __pyx_cur_scope->__pyx_v_ctx.node = __pyx_t_10;
 
-  /* "resiliparse/extract/html2text.pyx":571
+  /* "resiliparse/extract/html2text.pyx":586
  *     ctx.node = base_node.node
  * 
- *     cdef vector[string] skip_elements_vec = list(skip_elements)             # <<<<<<<<<<<<<<
- *     cdef const lxb_char_t* tag_name = NULL
- *     cdef size_t tag_name_len
- */
-  __pyx_t_2 = PySequence_List(__pyx_v_skip_elements); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 571, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_12 = __pyx_convert_vector_from_py_std_3a__3a_string(__pyx_t_2); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 571, __pyx_L1_error)
-  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_v_skip_elements_vec = __pyx_t_12;
-
-  /* "resiliparse/extract/html2text.pyx":572
- * 
- *     cdef vector[string] skip_elements_vec = list(skip_elements)
  *     cdef const lxb_char_t* tag_name = NULL             # <<<<<<<<<<<<<<
  *     cdef size_t tag_name_len
  *     cdef string tag_name_str
  */
   __pyx_v_tag_name = NULL;
 
-  /* "resiliparse/extract/html2text.pyx":576
+  /* "resiliparse/extract/html2text.pyx":590
  *     cdef string tag_name_str
  *     cdef size_t i
  *     cdef bint skip = False             # <<<<<<<<<<<<<<
  *     cdef bint is_end_tag = False
  * 
  */
   __pyx_v_skip = 0;
 
-  /* "resiliparse/extract/html2text.pyx":577
+  /* "resiliparse/extract/html2text.pyx":591
  *     cdef size_t i
  *     cdef bint skip = False
  *     cdef bint is_end_tag = False             # <<<<<<<<<<<<<<
  * 
  *     if ctx.node.type == LXB_DOM_NODE_TYPE_DOCUMENT:
  */
   __pyx_v_is_end_tag = 0;
 
-  /* "resiliparse/extract/html2text.pyx":579
+  /* "resiliparse/extract/html2text.pyx":593
  *     cdef bint is_end_tag = False
  * 
  *     if ctx.node.type == LXB_DOM_NODE_TYPE_DOCUMENT:             # <<<<<<<<<<<<<<
  *         ctx.root_node = next_element_node(ctx.node, ctx.node.first_child)
  *         ctx.node = ctx.root_node
  */
-  __pyx_t_9 = ((__pyx_cur_scope->__pyx_v_ctx.node->type == LXB_DOM_NODE_TYPE_DOCUMENT) != 0);
-  if (__pyx_t_9) {
+  __pyx_t_1 = ((__pyx_cur_scope->__pyx_v_ctx.node->type == LXB_DOM_NODE_TYPE_DOCUMENT) != 0);
+  if (__pyx_t_1) {
 
-    /* "resiliparse/extract/html2text.pyx":580
+    /* "resiliparse/extract/html2text.pyx":594
  * 
  *     if ctx.node.type == LXB_DOM_NODE_TYPE_DOCUMENT:
  *         ctx.root_node = next_element_node(ctx.node, ctx.node.first_child)             # <<<<<<<<<<<<<<
  *         ctx.node = ctx.root_node
  * 
  */
     __pyx_cur_scope->__pyx_v_ctx.root_node = __pyx_f_11resiliparse_5parse_4html_next_element_node(__pyx_cur_scope->__pyx_v_ctx.node, __pyx_cur_scope->__pyx_v_ctx.node->first_child, NULL);
 
-    /* "resiliparse/extract/html2text.pyx":581
+    /* "resiliparse/extract/html2text.pyx":595
  *     if ctx.node.type == LXB_DOM_NODE_TYPE_DOCUMENT:
  *         ctx.root_node = next_element_node(ctx.node, ctx.node.first_child)
  *         ctx.node = ctx.root_node             # <<<<<<<<<<<<<<
  * 
- *     with nogil:
+ *     cdef lxb_css_parser_t* css_parser = NULL
  */
     __pyx_t_10 = __pyx_cur_scope->__pyx_v_ctx.root_node;
     __pyx_cur_scope->__pyx_v_ctx.node = __pyx_t_10;
 
-    /* "resiliparse/extract/html2text.pyx":579
+    /* "resiliparse/extract/html2text.pyx":593
  *     cdef bint is_end_tag = False
  * 
  *     if ctx.node.type == LXB_DOM_NODE_TYPE_DOCUMENT:             # <<<<<<<<<<<<<<
  *         ctx.root_node = next_element_node(ctx.node, ctx.node.first_child)
  *         ctx.node = ctx.root_node
  */
   }
 
-  /* "resiliparse/extract/html2text.pyx":583
+  /* "resiliparse/extract/html2text.pyx":597
  *         ctx.node = ctx.root_node
  * 
+ *     cdef lxb_css_parser_t* css_parser = NULL             # <<<<<<<<<<<<<<
+ *     cdef lxb_css_selectors_t* css_selectors = NULL
+ *     cdef lxb_selectors_t* selectors = NULL
+ */
+  __pyx_v_css_parser = NULL;
+
+  /* "resiliparse/extract/html2text.pyx":598
+ * 
+ *     cdef lxb_css_parser_t* css_parser = NULL
+ *     cdef lxb_css_selectors_t* css_selectors = NULL             # <<<<<<<<<<<<<<
+ *     cdef lxb_selectors_t* selectors = NULL
+ * 
+ */
+  __pyx_v_css_selectors = NULL;
+
+  /* "resiliparse/extract/html2text.pyx":599
+ *     cdef lxb_css_parser_t* css_parser = NULL
+ *     cdef lxb_css_selectors_t* css_selectors = NULL
+ *     cdef lxb_selectors_t* selectors = NULL             # <<<<<<<<<<<<<<
+ * 
+ *     cdef lxb_css_selector_list_t* selector_list = NULL
+ */
+  __pyx_v_selectors = NULL;
+
+  /* "resiliparse/extract/html2text.pyx":601
+ *     cdef lxb_selectors_t* selectors = NULL
+ * 
+ *     cdef lxb_css_selector_list_t* selector_list = NULL             # <<<<<<<<<<<<<<
+ *     cdef stl_set[lxb_dom_node_t*] node_blacklist
+ *     try:
+ */
+  __pyx_v_selector_list = NULL;
+
+  /* "resiliparse/extract/html2text.pyx":603
+ *     cdef lxb_css_selector_list_t* selector_list = NULL
+ *     cdef stl_set[lxb_dom_node_t*] node_blacklist
+ *     try:             # <<<<<<<<<<<<<<
+ *         # Select all blacklisted elements and save them in an ordered set
+ *         init_css_parser(&css_parser)
+ */
+  /*try:*/ {
+
+    /* "resiliparse/extract/html2text.pyx":605
+ *     try:
+ *         # Select all blacklisted elements and save them in an ordered set
+ *         init_css_parser(&css_parser)             # <<<<<<<<<<<<<<
+ *         init_css_selectors(css_parser, &css_selectors, &selectors)
+ *         combined_skip_sel = b','.join(skip_selectors)
+ */
+    __pyx_t_1 = __pyx_f_11resiliparse_5parse_4html_init_css_parser((&__pyx_v_css_parser)); if (unlikely(__pyx_t_1 == ((int)0))) __PYX_ERR(0, 605, __pyx_L17_error)
+
+    /* "resiliparse/extract/html2text.pyx":606
+ *         # Select all blacklisted elements and save them in an ordered set
+ *         init_css_parser(&css_parser)
+ *         init_css_selectors(css_parser, &css_selectors, &selectors)             # <<<<<<<<<<<<<<
+ *         combined_skip_sel = b','.join(skip_selectors)
+ *         selector_list = parse_css_selectors(css_parser, <lxb_char_t*>combined_skip_sel, len(combined_skip_sel))
+ */
+    __pyx_t_1 = __pyx_f_11resiliparse_5parse_4html_init_css_selectors(__pyx_v_css_parser, (&__pyx_v_css_selectors), (&__pyx_v_selectors)); if (unlikely(__pyx_t_1 == ((int)0))) __PYX_ERR(0, 606, __pyx_L17_error)
+
+    /* "resiliparse/extract/html2text.pyx":607
+ *         init_css_parser(&css_parser)
+ *         init_css_selectors(css_parser, &css_selectors, &selectors)
+ *         combined_skip_sel = b','.join(skip_selectors)             # <<<<<<<<<<<<<<
+ *         selector_list = parse_css_selectors(css_parser, <lxb_char_t*>combined_skip_sel, len(combined_skip_sel))
+ *         lxb_selectors_find(selectors, ctx.root_node, selector_list,
+ */
+    __pyx_t_4 = __Pyx_PyBytes_Join(__pyx_kp_b__2, __pyx_v_skip_selectors); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 607, __pyx_L17_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __pyx_v_combined_skip_sel = __pyx_t_4;
+    __pyx_t_4 = 0;
+
+    /* "resiliparse/extract/html2text.pyx":608
+ *         init_css_selectors(css_parser, &css_selectors, &selectors)
+ *         combined_skip_sel = b','.join(skip_selectors)
+ *         selector_list = parse_css_selectors(css_parser, <lxb_char_t*>combined_skip_sel, len(combined_skip_sel))             # <<<<<<<<<<<<<<
+ *         lxb_selectors_find(selectors, ctx.root_node, selector_list,
+ *                            <lxb_selectors_cb_f>_blacklist_select_cb, &node_blacklist)
+ */
+    __pyx_t_12 = __Pyx_PyObject_AsWritableUString(__pyx_v_combined_skip_sel); if (unlikely((!__pyx_t_12) && PyErr_Occurred())) __PYX_ERR(0, 608, __pyx_L17_error)
+    __pyx_t_5 = PyObject_Length(__pyx_v_combined_skip_sel); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 608, __pyx_L17_error)
+    __pyx_t_13 = __pyx_f_11resiliparse_5parse_4html_parse_css_selectors(__pyx_v_css_parser, ((lxb_char_t *)__pyx_t_12), __pyx_t_5); if (unlikely(__pyx_t_13 == ((lxb_css_selector_list_t *)NULL))) __PYX_ERR(0, 608, __pyx_L17_error)
+    __pyx_v_selector_list = __pyx_t_13;
+
+    /* "resiliparse/extract/html2text.pyx":609
+ *         combined_skip_sel = b','.join(skip_selectors)
+ *         selector_list = parse_css_selectors(css_parser, <lxb_char_t*>combined_skip_sel, len(combined_skip_sel))
+ *         lxb_selectors_find(selectors, ctx.root_node, selector_list,             # <<<<<<<<<<<<<<
+ *                            <lxb_selectors_cb_f>_blacklist_select_cb, &node_blacklist)
+ *     finally:
+ */
+    (void)(lxb_selectors_find(__pyx_v_selectors, __pyx_cur_scope->__pyx_v_ctx.root_node, __pyx_v_selector_list, ((lxb_selectors_cb_f)__pyx_f_11resiliparse_7extract_9html2text__blacklist_select_cb), (&__pyx_v_node_blacklist)));
+  }
+
+  /* "resiliparse/extract/html2text.pyx":612
+ *                            <lxb_selectors_cb_f>_blacklist_select_cb, &node_blacklist)
+ *     finally:
+ *         destroy_css_selectors(css_selectors, selectors)             # <<<<<<<<<<<<<<
+ *         destroy_css_parser(css_parser)
+ * 
+ */
+  /*finally:*/ {
+    /*normal exit:*/{
+      __pyx_f_11resiliparse_5parse_4html_destroy_css_selectors(__pyx_v_css_selectors, __pyx_v_selectors);
+
+      /* "resiliparse/extract/html2text.pyx":613
+ *     finally:
+ *         destroy_css_selectors(css_selectors, selectors)
+ *         destroy_css_parser(css_parser)             # <<<<<<<<<<<<<<
+ * 
+ *     with nogil:
+ */
+      __pyx_f_11resiliparse_5parse_4html_destroy_css_parser(__pyx_v_css_parser);
+      goto __pyx_L18;
+    }
+    __pyx_L17_error:;
+    /*exception exit:*/{
+      __Pyx_PyThreadState_declare
+      __Pyx_PyThreadState_assign
+      __pyx_t_17 = 0; __pyx_t_18 = 0; __pyx_t_19 = 0; __pyx_t_20 = 0; __pyx_t_21 = 0; __pyx_t_22 = 0;
+      __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
+      __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
+      __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
+      __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
+      __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
+      if (PY_MAJOR_VERSION >= 3) __Pyx_ExceptionSwap(&__pyx_t_20, &__pyx_t_21, &__pyx_t_22);
+      if ((PY_MAJOR_VERSION < 3) || unlikely(__Pyx_GetException(&__pyx_t_17, &__pyx_t_18, &__pyx_t_19) < 0)) __Pyx_ErrFetch(&__pyx_t_17, &__pyx_t_18, &__pyx_t_19);
+      __Pyx_XGOTREF(__pyx_t_17);
+      __Pyx_XGOTREF(__pyx_t_18);
+      __Pyx_XGOTREF(__pyx_t_19);
+      __Pyx_XGOTREF(__pyx_t_20);
+      __Pyx_XGOTREF(__pyx_t_21);
+      __Pyx_XGOTREF(__pyx_t_22);
+      __pyx_t_14 = __pyx_lineno; __pyx_t_15 = __pyx_clineno; __pyx_t_16 = __pyx_filename;
+      {
+
+        /* "resiliparse/extract/html2text.pyx":612
+ *                            <lxb_selectors_cb_f>_blacklist_select_cb, &node_blacklist)
+ *     finally:
+ *         destroy_css_selectors(css_selectors, selectors)             # <<<<<<<<<<<<<<
+ *         destroy_css_parser(css_parser)
+ * 
+ */
+        __pyx_f_11resiliparse_5parse_4html_destroy_css_selectors(__pyx_v_css_selectors, __pyx_v_selectors);
+
+        /* "resiliparse/extract/html2text.pyx":613
+ *     finally:
+ *         destroy_css_selectors(css_selectors, selectors)
+ *         destroy_css_parser(css_parser)             # <<<<<<<<<<<<<<
+ * 
+ *     with nogil:
+ */
+        __pyx_f_11resiliparse_5parse_4html_destroy_css_parser(__pyx_v_css_parser);
+      }
+      if (PY_MAJOR_VERSION >= 3) {
+        __Pyx_XGIVEREF(__pyx_t_20);
+        __Pyx_XGIVEREF(__pyx_t_21);
+        __Pyx_XGIVEREF(__pyx_t_22);
+        __Pyx_ExceptionReset(__pyx_t_20, __pyx_t_21, __pyx_t_22);
+      }
+      __Pyx_XGIVEREF(__pyx_t_17);
+      __Pyx_XGIVEREF(__pyx_t_18);
+      __Pyx_XGIVEREF(__pyx_t_19);
+      __Pyx_ErrRestore(__pyx_t_17, __pyx_t_18, __pyx_t_19);
+      __pyx_t_17 = 0; __pyx_t_18 = 0; __pyx_t_19 = 0; __pyx_t_20 = 0; __pyx_t_21 = 0; __pyx_t_22 = 0;
+      __pyx_lineno = __pyx_t_14; __pyx_clineno = __pyx_t_15; __pyx_filename = __pyx_t_16;
+      goto __pyx_L1_error;
+    }
+    __pyx_L18:;
+  }
+
+  /* "resiliparse/extract/html2text.pyx":615
+ *         destroy_css_parser(css_parser)
+ * 
  *     with nogil:             # <<<<<<<<<<<<<<
  *         while ctx.node:
  *             # Skip everything except element and text nodes
  */
   {
       #ifdef WITH_THREAD
       PyThreadState *_save;
       Py_UNBLOCK_THREADS
       __Pyx_FastGIL_Remember();
       #endif
       /*try:*/ {
 
-        /* "resiliparse/extract/html2text.pyx":584
+        /* "resiliparse/extract/html2text.pyx":616
  * 
  *     with nogil:
  *         while ctx.node:             # <<<<<<<<<<<<<<
  *             # Skip everything except element and text nodes
  *             if ctx.node.type != LXB_DOM_NODE_TYPE_ELEMENT and ctx.node.type != LXB_DOM_NODE_TYPE_TEXT:
  */
         while (1) {
-          __pyx_t_9 = (__pyx_cur_scope->__pyx_v_ctx.node != 0);
-          if (!__pyx_t_9) break;
+          __pyx_t_1 = (__pyx_cur_scope->__pyx_v_ctx.node != 0);
+          if (!__pyx_t_1) break;
 
-          /* "resiliparse/extract/html2text.pyx":586
+          /* "resiliparse/extract/html2text.pyx":618
  *         while ctx.node:
  *             # Skip everything except element and text nodes
  *             if ctx.node.type != LXB_DOM_NODE_TYPE_ELEMENT and ctx.node.type != LXB_DOM_NODE_TYPE_TEXT:             # <<<<<<<<<<<<<<
  *                 is_end_tag = True
  *                 ctx.node = next_node(ctx.root_node, ctx.node, &ctx.depth, &is_end_tag)
  */
           switch (__pyx_cur_scope->__pyx_v_ctx.node->type) {
             case LXB_DOM_NODE_TYPE_ELEMENT:
             case LXB_DOM_NODE_TYPE_TEXT:
-            __pyx_t_9 = 0;
+            __pyx_t_1 = 0;
             break;
             default:
-            __pyx_t_9 = 1;
+            __pyx_t_1 = 1;
             break;
           }
-          if (__pyx_t_9) {
+          if (__pyx_t_1) {
 
-            /* "resiliparse/extract/html2text.pyx":587
+            /* "resiliparse/extract/html2text.pyx":619
  *             # Skip everything except element and text nodes
  *             if ctx.node.type != LXB_DOM_NODE_TYPE_ELEMENT and ctx.node.type != LXB_DOM_NODE_TYPE_TEXT:
  *                 is_end_tag = True             # <<<<<<<<<<<<<<
  *                 ctx.node = next_node(ctx.root_node, ctx.node, &ctx.depth, &is_end_tag)
  *                 continue
  */
             __pyx_v_is_end_tag = 1;
 
-            /* "resiliparse/extract/html2text.pyx":588
+            /* "resiliparse/extract/html2text.pyx":620
  *             if ctx.node.type != LXB_DOM_NODE_TYPE_ELEMENT and ctx.node.type != LXB_DOM_NODE_TYPE_TEXT:
  *                 is_end_tag = True
  *                 ctx.node = next_node(ctx.root_node, ctx.node, &ctx.depth, &is_end_tag)             # <<<<<<<<<<<<<<
  *                 continue
  * 
  */
-            __pyx_t_13.__pyx_n = 2;
-            __pyx_t_13.depth = (&__pyx_cur_scope->__pyx_v_ctx.depth);
-            __pyx_t_13.end_tag = (&__pyx_v_is_end_tag);
-            __pyx_t_10 = __pyx_f_11resiliparse_5parse_4html_next_node(__pyx_cur_scope->__pyx_v_ctx.root_node, __pyx_cur_scope->__pyx_v_ctx.node, &__pyx_t_13); 
+            __pyx_t_23.__pyx_n = 2;
+            __pyx_t_23.depth = (&__pyx_cur_scope->__pyx_v_ctx.depth);
+            __pyx_t_23.end_tag = (&__pyx_v_is_end_tag);
+            __pyx_t_10 = __pyx_f_11resiliparse_5parse_4html_next_node(__pyx_cur_scope->__pyx_v_ctx.root_node, __pyx_cur_scope->__pyx_v_ctx.node, &__pyx_t_23); 
             __pyx_cur_scope->__pyx_v_ctx.node = __pyx_t_10;
 
-            /* "resiliparse/extract/html2text.pyx":589
+            /* "resiliparse/extract/html2text.pyx":621
  *                 is_end_tag = True
  *                 ctx.node = next_node(ctx.root_node, ctx.node, &ctx.depth, &is_end_tag)
  *                 continue             # <<<<<<<<<<<<<<
  * 
- *             # Skip unwanted element nodes
+ *             if ctx.node.local_name == LXB_TAG_HEAD:
  */
-            goto __pyx_L20_continue;
+            goto __pyx_L24_continue;
 
-            /* "resiliparse/extract/html2text.pyx":586
+            /* "resiliparse/extract/html2text.pyx":618
  *         while ctx.node:
  *             # Skip everything except element and text nodes
  *             if ctx.node.type != LXB_DOM_NODE_TYPE_ELEMENT and ctx.node.type != LXB_DOM_NODE_TYPE_TEXT:             # <<<<<<<<<<<<<<
  *                 is_end_tag = True
  *                 ctx.node = next_node(ctx.root_node, ctx.node, &ctx.depth, &is_end_tag)
  */
           }
 
-          /* "resiliparse/extract/html2text.pyx":592
+          /* "resiliparse/extract/html2text.pyx":623
+ *                 continue
  * 
- *             # Skip unwanted element nodes
- *             if ctx.node.type == LXB_DOM_NODE_TYPE_ELEMENT:             # <<<<<<<<<<<<<<
- *                 tag_name = lxb_dom_element_qualified_name(<lxb_dom_element_t*>ctx.node, &tag_name_len)
- *                 tag_name_str = string(<const char*>tag_name, tag_name_len)
- */
-          __pyx_t_9 = ((__pyx_cur_scope->__pyx_v_ctx.node->type == LXB_DOM_NODE_TYPE_ELEMENT) != 0);
-          if (__pyx_t_9) {
-
-            /* "resiliparse/extract/html2text.pyx":593
- *             # Skip unwanted element nodes
- *             if ctx.node.type == LXB_DOM_NODE_TYPE_ELEMENT:
- *                 tag_name = lxb_dom_element_qualified_name(<lxb_dom_element_t*>ctx.node, &tag_name_len)             # <<<<<<<<<<<<<<
- *                 tag_name_str = string(<const char*>tag_name, tag_name_len)
- *                 skip = False
- */
-            __pyx_v_tag_name = lxb_dom_element_qualified_name(((lxb_dom_element_t *)__pyx_cur_scope->__pyx_v_ctx.node), (&__pyx_v_tag_name_len));
-
-            /* "resiliparse/extract/html2text.pyx":594
- *             if ctx.node.type == LXB_DOM_NODE_TYPE_ELEMENT:
- *                 tag_name = lxb_dom_element_qualified_name(<lxb_dom_element_t*>ctx.node, &tag_name_len)
- *                 tag_name_str = string(<const char*>tag_name, tag_name_len)             # <<<<<<<<<<<<<<
- *                 skip = False
- *                 for i in range(skip_elements_vec.size()):
+ *             if ctx.node.local_name == LXB_TAG_HEAD:             # <<<<<<<<<<<<<<
+ *                 is_end_tag = True
+ *                 ctx.node = next_node(ctx.root_node, ctx.node, &ctx.depth, &is_end_tag)
  */
-            try {
-              __pyx_t_14 = std::string(((char const *)__pyx_v_tag_name), __pyx_v_tag_name_len);
-            } catch(...) {
-              #ifdef WITH_THREAD
-              PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
-              #endif
-              __Pyx_CppExn2PyErr();
-              #ifdef WITH_THREAD
-              __Pyx_PyGILState_Release(__pyx_gilstate_save);
-              #endif
-              __PYX_ERR(0, 594, __pyx_L18_error)
-            }
-            __pyx_v_tag_name_str = __pyx_t_14;
+          __pyx_t_1 = ((__pyx_cur_scope->__pyx_v_ctx.node->local_name == LXB_TAG_HEAD) != 0);
+          if (__pyx_t_1) {
 
-            /* "resiliparse/extract/html2text.pyx":595
- *                 tag_name = lxb_dom_element_qualified_name(<lxb_dom_element_t*>ctx.node, &tag_name_len)
- *                 tag_name_str = string(<const char*>tag_name, tag_name_len)
- *                 skip = False             # <<<<<<<<<<<<<<
- *                 for i in range(skip_elements_vec.size()):
- *                     if skip_elements_vec[i] == tag_name_str:
+            /* "resiliparse/extract/html2text.pyx":624
+ * 
+ *             if ctx.node.local_name == LXB_TAG_HEAD:
+ *                 is_end_tag = True             # <<<<<<<<<<<<<<
+ *                 ctx.node = next_node(ctx.root_node, ctx.node, &ctx.depth, &is_end_tag)
+ *                 continue
  */
-            __pyx_v_skip = 0;
+            __pyx_v_is_end_tag = 1;
 
-            /* "resiliparse/extract/html2text.pyx":596
- *                 tag_name_str = string(<const char*>tag_name, tag_name_len)
- *                 skip = False
- *                 for i in range(skip_elements_vec.size()):             # <<<<<<<<<<<<<<
- *                     if skip_elements_vec[i] == tag_name_str:
- *                         skip = True
+            /* "resiliparse/extract/html2text.pyx":625
+ *             if ctx.node.local_name == LXB_TAG_HEAD:
+ *                 is_end_tag = True
+ *                 ctx.node = next_node(ctx.root_node, ctx.node, &ctx.depth, &is_end_tag)             # <<<<<<<<<<<<<<
+ *                 continue
+ * 
  */
-            __pyx_t_15 = __pyx_v_skip_elements_vec.size();
-            __pyx_t_16 = __pyx_t_15;
-            for (__pyx_t_17 = 0; __pyx_t_17 < __pyx_t_16; __pyx_t_17+=1) {
-              __pyx_v_i = __pyx_t_17;
+            __pyx_t_23.__pyx_n = 2;
+            __pyx_t_23.depth = (&__pyx_cur_scope->__pyx_v_ctx.depth);
+            __pyx_t_23.end_tag = (&__pyx_v_is_end_tag);
+            __pyx_t_10 = __pyx_f_11resiliparse_5parse_4html_next_node(__pyx_cur_scope->__pyx_v_ctx.root_node, __pyx_cur_scope->__pyx_v_ctx.node, &__pyx_t_23); 
+            __pyx_cur_scope->__pyx_v_ctx.node = __pyx_t_10;
 
-              /* "resiliparse/extract/html2text.pyx":597
- *                 skip = False
- *                 for i in range(skip_elements_vec.size()):
- *                     if skip_elements_vec[i] == tag_name_str:             # <<<<<<<<<<<<<<
- *                         skip = True
- *                         break
+            /* "resiliparse/extract/html2text.pyx":626
+ *                 is_end_tag = True
+ *                 ctx.node = next_node(ctx.root_node, ctx.node, &ctx.depth, &is_end_tag)
+ *                 continue             # <<<<<<<<<<<<<<
+ * 
+ *             # Skip blacklisted or non-main-content nodes
  */
-              __pyx_t_9 = (((__pyx_v_skip_elements_vec[__pyx_v_i]) == __pyx_v_tag_name_str) != 0);
-              if (__pyx_t_9) {
+            goto __pyx_L24_continue;
 
-                /* "resiliparse/extract/html2text.pyx":598
- *                 for i in range(skip_elements_vec.size()):
- *                     if skip_elements_vec[i] == tag_name_str:
- *                         skip = True             # <<<<<<<<<<<<<<
- *                         break
+            /* "resiliparse/extract/html2text.pyx":623
+ *                 continue
  * 
+ *             if ctx.node.local_name == LXB_TAG_HEAD:             # <<<<<<<<<<<<<<
+ *                 is_end_tag = True
+ *                 ctx.node = next_node(ctx.root_node, ctx.node, &ctx.depth, &is_end_tag)
  */
-                __pyx_v_skip = 1;
+          }
 
-                /* "resiliparse/extract/html2text.pyx":599
- *                     if skip_elements_vec[i] == tag_name_str:
- *                         skip = True
- *                         break             # <<<<<<<<<<<<<<
+          /* "resiliparse/extract/html2text.pyx":629
  * 
- *                 if skip or (main_content and not _is_main_content_node(ctx.node)):
+ *             # Skip blacklisted or non-main-content nodes
+ *             if node_blacklist.find(ctx.node) != node_blacklist.end() or \             # <<<<<<<<<<<<<<
+ *                     (main_content and not _is_main_content_node(ctx.node)):
+ *                 is_end_tag = True
  */
-                goto __pyx_L25_break;
+          __pyx_t_24 = ((__pyx_v_node_blacklist.find(__pyx_cur_scope->__pyx_v_ctx.node) != __pyx_v_node_blacklist.end()) != 0);
+          if (!__pyx_t_24) {
+          } else {
+            __pyx_t_1 = __pyx_t_24;
+            goto __pyx_L29_bool_binop_done;
+          }
 
-                /* "resiliparse/extract/html2text.pyx":597
- *                 skip = False
- *                 for i in range(skip_elements_vec.size()):
- *                     if skip_elements_vec[i] == tag_name_str:             # <<<<<<<<<<<<<<
- *                         skip = True
- *                         break
+          /* "resiliparse/extract/html2text.pyx":630
+ *             # Skip blacklisted or non-main-content nodes
+ *             if node_blacklist.find(ctx.node) != node_blacklist.end() or \
+ *                     (main_content and not _is_main_content_node(ctx.node)):             # <<<<<<<<<<<<<<
+ *                 is_end_tag = True
+ *                 ctx.node = next_node(ctx.root_node, ctx.node, &ctx.depth, &is_end_tag)
  */
-              }
-            }
-            __pyx_L25_break:;
+          __pyx_t_24 = (__pyx_v_main_content != 0);
+          if (__pyx_t_24) {
+          } else {
+            __pyx_t_1 = __pyx_t_24;
+            goto __pyx_L29_bool_binop_done;
+          }
+          __pyx_t_24 = ((!(__pyx_f_11resiliparse_7extract_9html2text__is_main_content_node(__pyx_cur_scope->__pyx_v_ctx.node) != 0)) != 0);
+          __pyx_t_1 = __pyx_t_24;
+          __pyx_L29_bool_binop_done:;
+
+          /* "resiliparse/extract/html2text.pyx":629
+ * 
+ *             # Skip blacklisted or non-main-content nodes
+ *             if node_blacklist.find(ctx.node) != node_blacklist.end() or \             # <<<<<<<<<<<<<<
+ *                     (main_content and not _is_main_content_node(ctx.node)):
+ *                 is_end_tag = True
+ */
+          if (__pyx_t_1) {
 
-            /* "resiliparse/extract/html2text.pyx":601
- *                         break
- * 
- *                 if skip or (main_content and not _is_main_content_node(ctx.node)):             # <<<<<<<<<<<<<<
- *                     is_end_tag = True
- *                     ctx.node = next_node(ctx.root_node, ctx.node, &ctx.depth, &is_end_tag)
+            /* "resiliparse/extract/html2text.pyx":631
+ *             if node_blacklist.find(ctx.node) != node_blacklist.end() or \
+ *                     (main_content and not _is_main_content_node(ctx.node)):
+ *                 is_end_tag = True             # <<<<<<<<<<<<<<
+ *                 ctx.node = next_node(ctx.root_node, ctx.node, &ctx.depth, &is_end_tag)
+ *                 continue
  */
-            __pyx_t_1 = (__pyx_v_skip != 0);
-            if (!__pyx_t_1) {
-            } else {
-              __pyx_t_9 = __pyx_t_1;
-              goto __pyx_L28_bool_binop_done;
-            }
-            __pyx_t_1 = (__pyx_v_main_content != 0);
-            if (__pyx_t_1) {
-            } else {
-              __pyx_t_9 = __pyx_t_1;
-              goto __pyx_L28_bool_binop_done;
-            }
-            __pyx_t_1 = ((!(__pyx_f_11resiliparse_7extract_9html2text__is_main_content_node(__pyx_cur_scope->__pyx_v_ctx.node) != 0)) != 0);
-            __pyx_t_9 = __pyx_t_1;
-            __pyx_L28_bool_binop_done:;
-            if (__pyx_t_9) {
-
-              /* "resiliparse/extract/html2text.pyx":602
- * 
- *                 if skip or (main_content and not _is_main_content_node(ctx.node)):
- *                     is_end_tag = True             # <<<<<<<<<<<<<<
- *                     ctx.node = next_node(ctx.root_node, ctx.node, &ctx.depth, &is_end_tag)
- *                     continue
- */
-              __pyx_v_is_end_tag = 1;
-
-              /* "resiliparse/extract/html2text.pyx":603
- *                 if skip or (main_content and not _is_main_content_node(ctx.node)):
- *                     is_end_tag = True
- *                     ctx.node = next_node(ctx.root_node, ctx.node, &ctx.depth, &is_end_tag)             # <<<<<<<<<<<<<<
- *                     continue
- * 
- */
-              __pyx_t_13.__pyx_n = 2;
-              __pyx_t_13.depth = (&__pyx_cur_scope->__pyx_v_ctx.depth);
-              __pyx_t_13.end_tag = (&__pyx_v_is_end_tag);
-              __pyx_t_10 = __pyx_f_11resiliparse_5parse_4html_next_node(__pyx_cur_scope->__pyx_v_ctx.root_node, __pyx_cur_scope->__pyx_v_ctx.node, &__pyx_t_13); 
-              __pyx_cur_scope->__pyx_v_ctx.node = __pyx_t_10;
-
-              /* "resiliparse/extract/html2text.pyx":604
- *                     is_end_tag = True
- *                     ctx.node = next_node(ctx.root_node, ctx.node, &ctx.depth, &is_end_tag)
- *                     continue             # <<<<<<<<<<<<<<
+            __pyx_v_is_end_tag = 1;
+
+            /* "resiliparse/extract/html2text.pyx":632
+ *                     (main_content and not _is_main_content_node(ctx.node)):
+ *                 is_end_tag = True
+ *                 ctx.node = next_node(ctx.root_node, ctx.node, &ctx.depth, &is_end_tag)             # <<<<<<<<<<<<<<
+ *                 continue
  * 
- *             if not is_end_tag:
  */
-              goto __pyx_L20_continue;
+            __pyx_t_23.__pyx_n = 2;
+            __pyx_t_23.depth = (&__pyx_cur_scope->__pyx_v_ctx.depth);
+            __pyx_t_23.end_tag = (&__pyx_v_is_end_tag);
+            __pyx_t_10 = __pyx_f_11resiliparse_5parse_4html_next_node(__pyx_cur_scope->__pyx_v_ctx.root_node, __pyx_cur_scope->__pyx_v_ctx.node, &__pyx_t_23); 
+            __pyx_cur_scope->__pyx_v_ctx.node = __pyx_t_10;
 
-              /* "resiliparse/extract/html2text.pyx":601
- *                         break
+            /* "resiliparse/extract/html2text.pyx":633
+ *                 is_end_tag = True
+ *                 ctx.node = next_node(ctx.root_node, ctx.node, &ctx.depth, &is_end_tag)
+ *                 continue             # <<<<<<<<<<<<<<
  * 
- *                 if skip or (main_content and not _is_main_content_node(ctx.node)):             # <<<<<<<<<<<<<<
- *                     is_end_tag = True
- *                     ctx.node = next_node(ctx.root_node, ctx.node, &ctx.depth, &is_end_tag)
+ *             if not is_end_tag:
  */
-            }
+            goto __pyx_L24_continue;
 
-            /* "resiliparse/extract/html2text.pyx":592
+            /* "resiliparse/extract/html2text.pyx":629
  * 
- *             # Skip unwanted element nodes
- *             if ctx.node.type == LXB_DOM_NODE_TYPE_ELEMENT:             # <<<<<<<<<<<<<<
- *                 tag_name = lxb_dom_element_qualified_name(<lxb_dom_element_t*>ctx.node, &tag_name_len)
- *                 tag_name_str = string(<const char*>tag_name, tag_name_len)
+ *             # Skip blacklisted or non-main-content nodes
+ *             if node_blacklist.find(ctx.node) != node_blacklist.end() or \             # <<<<<<<<<<<<<<
+ *                     (main_content and not _is_main_content_node(ctx.node)):
+ *                 is_end_tag = True
  */
           }
 
-          /* "resiliparse/extract/html2text.pyx":606
- *                     continue
+          /* "resiliparse/extract/html2text.pyx":635
+ *                 continue
  * 
  *             if not is_end_tag:             # <<<<<<<<<<<<<<
  *                 _extract_start_cb(&ctx)
  *             else:
  */
-          __pyx_t_9 = ((!(__pyx_v_is_end_tag != 0)) != 0);
-          if (__pyx_t_9) {
+          __pyx_t_1 = ((!(__pyx_v_is_end_tag != 0)) != 0);
+          if (__pyx_t_1) {
 
-            /* "resiliparse/extract/html2text.pyx":607
+            /* "resiliparse/extract/html2text.pyx":636
  * 
  *             if not is_end_tag:
  *                 _extract_start_cb(&ctx)             # <<<<<<<<<<<<<<
  *             else:
  *                 _extract_end_cb(&ctx)
  */
             __pyx_f_11resiliparse_7extract_9html2text__extract_start_cb((&__pyx_cur_scope->__pyx_v_ctx));
 
-            /* "resiliparse/extract/html2text.pyx":606
- *                     continue
+            /* "resiliparse/extract/html2text.pyx":635
+ *                 continue
  * 
  *             if not is_end_tag:             # <<<<<<<<<<<<<<
  *                 _extract_start_cb(&ctx)
  *             else:
  */
-            goto __pyx_L31;
+            goto __pyx_L32;
           }
 
-          /* "resiliparse/extract/html2text.pyx":609
+          /* "resiliparse/extract/html2text.pyx":638
  *                 _extract_start_cb(&ctx)
  *             else:
  *                 _extract_end_cb(&ctx)             # <<<<<<<<<<<<<<
  * 
  *             ctx.node = next_node(ctx.root_node, ctx.node, &ctx.depth, &is_end_tag)
  */
           /*else*/ {
             __pyx_f_11resiliparse_7extract_9html2text__extract_end_cb((&__pyx_cur_scope->__pyx_v_ctx));
           }
-          __pyx_L31:;
+          __pyx_L32:;
 
-          /* "resiliparse/extract/html2text.pyx":611
+          /* "resiliparse/extract/html2text.pyx":640
  *                 _extract_end_cb(&ctx)
  * 
  *             ctx.node = next_node(ctx.root_node, ctx.node, &ctx.depth, &is_end_tag)             # <<<<<<<<<<<<<<
  * 
  *     return ''.join(s.decode() for s in ctx.text).rstrip()
  */
-          __pyx_t_13.__pyx_n = 2;
-          __pyx_t_13.depth = (&__pyx_cur_scope->__pyx_v_ctx.depth);
-          __pyx_t_13.end_tag = (&__pyx_v_is_end_tag);
-          __pyx_t_10 = __pyx_f_11resiliparse_5parse_4html_next_node(__pyx_cur_scope->__pyx_v_ctx.root_node, __pyx_cur_scope->__pyx_v_ctx.node, &__pyx_t_13); 
+          __pyx_t_23.__pyx_n = 2;
+          __pyx_t_23.depth = (&__pyx_cur_scope->__pyx_v_ctx.depth);
+          __pyx_t_23.end_tag = (&__pyx_v_is_end_tag);
+          __pyx_t_10 = __pyx_f_11resiliparse_5parse_4html_next_node(__pyx_cur_scope->__pyx_v_ctx.root_node, __pyx_cur_scope->__pyx_v_ctx.node, &__pyx_t_23); 
           __pyx_cur_scope->__pyx_v_ctx.node = __pyx_t_10;
-          __pyx_L20_continue:;
+          __pyx_L24_continue:;
         }
       }
 
-      /* "resiliparse/extract/html2text.pyx":583
- *         ctx.node = ctx.root_node
+      /* "resiliparse/extract/html2text.pyx":615
+ *         destroy_css_parser(css_parser)
  * 
  *     with nogil:             # <<<<<<<<<<<<<<
  *         while ctx.node:
  *             # Skip everything except element and text nodes
  */
       /*finally:*/ {
         /*normal exit:*/{
           #ifdef WITH_THREAD
           __Pyx_FastGIL_Forget();
           Py_BLOCK_THREADS
           #endif
-          goto __pyx_L19;
+          goto __pyx_L23;
         }
-        __pyx_L18_error: {
-          #ifdef WITH_THREAD
-          __Pyx_FastGIL_Forget();
-          Py_BLOCK_THREADS
-          #endif
-          goto __pyx_L1_error;
-        }
-        __pyx_L19:;
+        __pyx_L23:;
       }
   }
 
-  /* "resiliparse/extract/html2text.pyx":613
+  /* "resiliparse/extract/html2text.pyx":642
  *             ctx.node = next_node(ctx.root_node, ctx.node, &ctx.depth, &is_end_tag)
  * 
  *     return ''.join(s.decode() for s in ctx.text).rstrip()             # <<<<<<<<<<<<<<
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_4 = __pyx_pf_11resiliparse_7extract_9html2text_18extract_plain_text_genexpr(((PyObject*)__pyx_cur_scope)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 613, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_3 = __Pyx_Generator_Next(__pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 613, __pyx_L1_error)
+  __pyx_t_2 = __pyx_pf_11resiliparse_7extract_9html2text_18extract_plain_text_genexpr(((PyObject*)__pyx_cur_scope)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 642, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_3 = __Pyx_Generator_Next(__pyx_t_2); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 642, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = PyUnicode_Join(__pyx_kp_u_, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 613, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_4);
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_2 = PyUnicode_Join(__pyx_kp_u_, __pyx_t_3); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 642, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_4, __pyx_n_s_rstrip); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 613, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_2, __pyx_n_s_rstrip); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 642, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = NULL;
+  __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_t_2 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_3))) {
-    __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
-    if (likely(__pyx_t_4)) {
+    __pyx_t_2 = PyMethod_GET_SELF(__pyx_t_3);
+    if (likely(__pyx_t_2)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_3);
-      __Pyx_INCREF(__pyx_t_4);
+      __Pyx_INCREF(__pyx_t_2);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_3, function);
     }
   }
-  __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
-  __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 613, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_t_2);
+  __pyx_t_4 = (__pyx_t_2) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_2) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
+  __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
+  if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 642, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-  __pyx_r = __pyx_t_2;
-  __pyx_t_2 = 0;
+  __pyx_r = __pyx_t_4;
+  __pyx_t_4 = 0;
   goto __pyx_L0;
 
-  /* "resiliparse/extract/html2text.pyx":501
+  /* "resiliparse/extract/html2text.pyx":516
  * 
  * 
- * def extract_plain_text(DOMNode base_node, bint preserve_formatting=True, bint main_content=False, bint list_bullets=True,             # <<<<<<<<<<<<<<
- *                        bint alt_texts=True, bint links=False, bint form_fields=False, bint noscript=False,
- *                        skip_elements=None):
+ * def extract_plain_text(DOMNode base_node, bint preserve_formatting=True, bint main_content=False,             # <<<<<<<<<<<<<<
+ *                        bint list_bullets=True,  bint alt_texts=True, bint links=False, bint form_fields=False,
+ *                        bint noscript=False, skip_elements=None):
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_3);
   __Pyx_XDECREF(__pyx_t_4);
   __Pyx_XDECREF(__pyx_t_7);
   __Pyx_XDECREF(__pyx_t_8);
   __Pyx_AddTraceback("resiliparse.extract.html2text.extract_plain_text", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __pyx_L0:;
+  __Pyx_XDECREF(__pyx_v_skip_selectors);
+  __Pyx_XDECREF(__pyx_v_combined_skip_sel);
   __Pyx_XDECREF(__pyx_7genexpr__pyx_v_e);
   __Pyx_XDECREF(__pyx_gb_11resiliparse_7extract_9html2text_18extract_plain_text_2generator);
-  __Pyx_XDECREF(__pyx_v_skip_elements);
   __Pyx_DECREF(((PyObject *)__pyx_cur_scope));
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* "resiliparse_common/string_util.pxd":22
@@ -8295,117 +8632,14 @@
  */
 
   /* function exit code */
   __pyx_L0:;
   return __pyx_r;
 }
 
-/* "resiliparse_common/string_util.pxd":43
- * 
- * 
- * cdef inline string lstrip_str(const string& s) nogil:             # <<<<<<<<<<<<<<
- *     """Strip leading white space from a C++ string."""
- *     cdef const char* start = s.data()
- */
-
-static CYTHON_INLINE std::string __pyx_f_18resiliparse_common_11string_util_lstrip_str(std::string const &__pyx_v_s) {
-  char const *__pyx_v_start;
-  size_t __pyx_v_l;
-  std::string __pyx_r;
-  int __pyx_t_1;
-  std::string __pyx_t_2;
-  int __pyx_lineno = 0;
-  const char *__pyx_filename = NULL;
-  int __pyx_clineno = 0;
-
-  /* "resiliparse_common/string_util.pxd":45
- * cdef inline string lstrip_str(const string& s) nogil:
- *     """Strip leading white space from a C++ string."""
- *     cdef const char* start = s.data()             # <<<<<<<<<<<<<<
- *     cdef size_t l = lstrip_c_str(&start, s.size())
- *     if start == s.data():
- */
-  __pyx_v_start = __pyx_v_s.data();
-
-  /* "resiliparse_common/string_util.pxd":46
- *     """Strip leading white space from a C++ string."""
- *     cdef const char* start = s.data()
- *     cdef size_t l = lstrip_c_str(&start, s.size())             # <<<<<<<<<<<<<<
- *     if start == s.data():
- *         return s
- */
-  __pyx_v_l = __pyx_f_18resiliparse_common_11string_util_lstrip_c_str((&__pyx_v_start), __pyx_v_s.size());
-
-  /* "resiliparse_common/string_util.pxd":47
- *     cdef const char* start = s.data()
- *     cdef size_t l = lstrip_c_str(&start, s.size())
- *     if start == s.data():             # <<<<<<<<<<<<<<
- *         return s
- *     return string(start, l)
- */
-  __pyx_t_1 = ((__pyx_v_start == __pyx_v_s.data()) != 0);
-  if (__pyx_t_1) {
-
-    /* "resiliparse_common/string_util.pxd":48
- *     cdef size_t l = lstrip_c_str(&start, s.size())
- *     if start == s.data():
- *         return s             # <<<<<<<<<<<<<<
- *     return string(start, l)
- * 
- */
-    __pyx_r = __pyx_v_s;
-    goto __pyx_L0;
-
-    /* "resiliparse_common/string_util.pxd":47
- *     cdef const char* start = s.data()
- *     cdef size_t l = lstrip_c_str(&start, s.size())
- *     if start == s.data():             # <<<<<<<<<<<<<<
- *         return s
- *     return string(start, l)
- */
-  }
-
-  /* "resiliparse_common/string_util.pxd":49
- *     if start == s.data():
- *         return s
- *     return string(start, l)             # <<<<<<<<<<<<<<
- * 
- * 
- */
-  try {
-    __pyx_t_2 = std::string(__pyx_v_start, __pyx_v_l);
-  } catch(...) {
-    #ifdef WITH_THREAD
-    PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
-    #endif
-    __Pyx_CppExn2PyErr();
-    #ifdef WITH_THREAD
-    __Pyx_PyGILState_Release(__pyx_gilstate_save);
-    #endif
-    __PYX_ERR(1, 49, __pyx_L1_error)
-  }
-  __pyx_r = __pyx_t_2;
-  goto __pyx_L0;
-
-  /* "resiliparse_common/string_util.pxd":43
- * 
- * 
- * cdef inline string lstrip_str(const string& s) nogil:             # <<<<<<<<<<<<<<
- *     """Strip leading white space from a C++ string."""
- *     cdef const char* start = s.data()
- */
-
-  /* function exit code */
-  __pyx_L1_error:;
-  __Pyx_WriteUnraisable("resiliparse_common.string_util.lstrip_str", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 1);
-  __Pyx_pretend_to_initialize(&__pyx_r);
-  __pyx_L0:;
-  return __pyx_r;
-}
-
 /* "resiliparse_common/string_util.pxd":52
  * 
  * 
  * cdef inline string rstrip_str(const string& s) nogil:             # <<<<<<<<<<<<<<
  *     """Strip leading white space from a C++ string."""
  *     cdef const char* start = s.data()
  */
@@ -8652,15 +8886,15 @@
   __Pyx_RefNannySetupContext("check_node", 0);
 
   /* "resiliparse/parse/html.pxd":23
  * cdef inline bint check_node(DOMNode node):
  *     """Check whether node is initialized and valid."""
  *     return node is not None and node.tree is not None and node.node != NULL             # <<<<<<<<<<<<<<
  * 
- * 
+ * cdef bint init_css_parser(lxb_css_parser_t** parser) except 0
  */
   __pyx_t_2 = (((PyObject *)__pyx_v_node) != Py_None);
   __pyx_t_3 = (__pyx_t_2 != 0);
   if (__pyx_t_3) {
   } else {
     __pyx_t_1 = __pyx_t_3;
     goto __pyx_L3_bool_binop_done;
@@ -8688,25 +8922,25 @@
 
   /* function exit code */
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pxd":29
+/* "resiliparse/parse/html.pxd":36
  *                                size_t* depth=*, bint* end_tag=*) nogil
  * 
  * cdef inline lxb_dom_node_t* next_element_node(const lxb_dom_node_t* root_node, lxb_dom_node_t* node,             # <<<<<<<<<<<<<<
  *                                               size_t* depth=NULL, bint* end_tag=NULL) nogil:
  *     node = next_node(root_node, node, depth, end_tag)
  */
 
 static CYTHON_INLINE lxb_dom_node_t *__pyx_f_11resiliparse_5parse_4html_next_element_node(lxb_dom_node_t const *__pyx_v_root_node, lxb_dom_node_t *__pyx_v_node, struct __pyx_opt_args_11resiliparse_5parse_4html_next_element_node *__pyx_optional_args) {
 
-  /* "resiliparse/parse/html.pxd":30
+  /* "resiliparse/parse/html.pxd":37
  * 
  * cdef inline lxb_dom_node_t* next_element_node(const lxb_dom_node_t* root_node, lxb_dom_node_t* node,
  *                                               size_t* depth=NULL, bint* end_tag=NULL) nogil:             # <<<<<<<<<<<<<<
  *     node = next_node(root_node, node, depth, end_tag)
  *     while node and node.type != LXB_DOM_NODE_TYPE_ELEMENT:
  */
   size_t *__pyx_v_depth = ((size_t *)NULL);
@@ -8721,28 +8955,28 @@
       __pyx_v_depth = __pyx_optional_args->depth;
       if (__pyx_optional_args->__pyx_n > 1) {
         __pyx_v_end_tag = __pyx_optional_args->end_tag;
       }
     }
   }
 
-  /* "resiliparse/parse/html.pxd":31
+  /* "resiliparse/parse/html.pxd":38
  * cdef inline lxb_dom_node_t* next_element_node(const lxb_dom_node_t* root_node, lxb_dom_node_t* node,
  *                                               size_t* depth=NULL, bint* end_tag=NULL) nogil:
  *     node = next_node(root_node, node, depth, end_tag)             # <<<<<<<<<<<<<<
  *     while node and node.type != LXB_DOM_NODE_TYPE_ELEMENT:
  *         node = next_node(root_node, node, depth, end_tag)
  */
   __pyx_t_2.__pyx_n = 2;
   __pyx_t_2.depth = __pyx_v_depth;
   __pyx_t_2.end_tag = __pyx_v_end_tag;
   __pyx_t_1 = __pyx_f_11resiliparse_5parse_4html_next_node(__pyx_v_root_node, __pyx_v_node, &__pyx_t_2); 
   __pyx_v_node = __pyx_t_1;
 
-  /* "resiliparse/parse/html.pxd":32
+  /* "resiliparse/parse/html.pxd":39
  *                                               size_t* depth=NULL, bint* end_tag=NULL) nogil:
  *     node = next_node(root_node, node, depth, end_tag)
  *     while node and node.type != LXB_DOM_NODE_TYPE_ELEMENT:             # <<<<<<<<<<<<<<
  *         node = next_node(root_node, node, depth, end_tag)
  *     return node
  */
   while (1) {
@@ -8753,328 +8987,141 @@
       goto __pyx_L5_bool_binop_done;
     }
     __pyx_t_4 = ((__pyx_v_node->type != LXB_DOM_NODE_TYPE_ELEMENT) != 0);
     __pyx_t_3 = __pyx_t_4;
     __pyx_L5_bool_binop_done:;
     if (!__pyx_t_3) break;
 
-    /* "resiliparse/parse/html.pxd":33
+    /* "resiliparse/parse/html.pxd":40
  *     node = next_node(root_node, node, depth, end_tag)
  *     while node and node.type != LXB_DOM_NODE_TYPE_ELEMENT:
  *         node = next_node(root_node, node, depth, end_tag)             # <<<<<<<<<<<<<<
  *     return node
  * 
  */
     __pyx_t_2.__pyx_n = 2;
     __pyx_t_2.depth = __pyx_v_depth;
     __pyx_t_2.end_tag = __pyx_v_end_tag;
     __pyx_t_1 = __pyx_f_11resiliparse_5parse_4html_next_node(__pyx_v_root_node, __pyx_v_node, &__pyx_t_2); 
     __pyx_v_node = __pyx_t_1;
   }
 
-  /* "resiliparse/parse/html.pxd":34
+  /* "resiliparse/parse/html.pxd":41
  *     while node and node.type != LXB_DOM_NODE_TYPE_ELEMENT:
  *         node = next_node(root_node, node, depth, end_tag)
  *     return node             # <<<<<<<<<<<<<<
  * 
  * cdef inline string_view get_node_attr_sv(lxb_dom_node_t* node, const string& attr) nogil:
  */
   __pyx_r = __pyx_v_node;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pxd":29
+  /* "resiliparse/parse/html.pxd":36
  *                                size_t* depth=*, bint* end_tag=*) nogil
  * 
  * cdef inline lxb_dom_node_t* next_element_node(const lxb_dom_node_t* root_node, lxb_dom_node_t* node,             # <<<<<<<<<<<<<<
  *                                               size_t* depth=NULL, bint* end_tag=NULL) nogil:
  *     node = next_node(root_node, node, depth, end_tag)
  */
 
   /* function exit code */
   __pyx_L0:;
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pxd":36
+/* "resiliparse/parse/html.pxd":43
  *     return node
  * 
  * cdef inline string_view get_node_attr_sv(lxb_dom_node_t* node, const string& attr) nogil:             # <<<<<<<<<<<<<<
  *     """Get node attribute value as string_view."""
  *     cdef size_t node_attr_len
  */
 
 static CYTHON_INLINE std::string_view __pyx_f_11resiliparse_5parse_4html_get_node_attr_sv(lxb_dom_node_t *__pyx_v_node, std::string const &__pyx_v_attr) {
   size_t __pyx_v_node_attr_len;
   lxb_char_t const *__pyx_v_node_attr_data;
   std::string_view __pyx_r;
 
-  /* "resiliparse/parse/html.pxd":39
+  /* "resiliparse/parse/html.pxd":46
  *     """Get node attribute value as string_view."""
  *     cdef size_t node_attr_len
  *     cdef const lxb_char_t* node_attr_data = lxb_dom_element_get_attribute(             # <<<<<<<<<<<<<<
  *         <lxb_dom_element_t*>node, <lxb_char_t*>attr.data(), attr.size(), &node_attr_len)
  *     return string_view(<const char*>node_attr_data, node_attr_len)
  */
   __pyx_v_node_attr_data = lxb_dom_element_get_attribute(((lxb_dom_element_t *)__pyx_v_node), ((lxb_char_t *)__pyx_v_attr.data()), __pyx_v_attr.size(), (&__pyx_v_node_attr_len));
 
-  /* "resiliparse/parse/html.pxd":41
+  /* "resiliparse/parse/html.pxd":48
  *     cdef const lxb_char_t* node_attr_data = lxb_dom_element_get_attribute(
  *         <lxb_dom_element_t*>node, <lxb_char_t*>attr.data(), attr.size(), &node_attr_len)
  *     return string_view(<const char*>node_attr_data, node_attr_len)             # <<<<<<<<<<<<<<
  * 
  * cdef inline StringPiece get_node_attr_sp(lxb_dom_node_t* node, const string& attr) nogil:
  */
   __pyx_r = std::string_view(((char const *)__pyx_v_node_attr_data), __pyx_v_node_attr_len);
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pxd":36
+  /* "resiliparse/parse/html.pxd":43
  *     return node
  * 
  * cdef inline string_view get_node_attr_sv(lxb_dom_node_t* node, const string& attr) nogil:             # <<<<<<<<<<<<<<
  *     """Get node attribute value as string_view."""
  *     cdef size_t node_attr_len
  */
 
   /* function exit code */
   __pyx_L0:;
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pxd":43
+/* "resiliparse/parse/html.pxd":50
  *     return string_view(<const char*>node_attr_data, node_attr_len)
  * 
  * cdef inline StringPiece get_node_attr_sp(lxb_dom_node_t* node, const string& attr) nogil:             # <<<<<<<<<<<<<<
  *     """Get node attribute value as RE2 StringPiece."""
  *     cdef size_t node_attr_len
  */
 
 static CYTHON_INLINE re2::StringPiece __pyx_f_11resiliparse_5parse_4html_get_node_attr_sp(lxb_dom_node_t *__pyx_v_node, std::string const &__pyx_v_attr) {
   size_t __pyx_v_node_attr_len;
   lxb_char_t const *__pyx_v_node_attr_data;
   re2::StringPiece __pyx_r;
 
-  /* "resiliparse/parse/html.pxd":46
+  /* "resiliparse/parse/html.pxd":53
  *     """Get node attribute value as RE2 StringPiece."""
  *     cdef size_t node_attr_len
  *     cdef const lxb_char_t* node_attr_data = lxb_dom_element_get_attribute(             # <<<<<<<<<<<<<<
  *         <lxb_dom_element_t*>node, <lxb_char_t*>attr.data(), attr.size(), &node_attr_len)
  *     return StringPiece(<const char*>node_attr_data, node_attr_len)
  */
   __pyx_v_node_attr_data = lxb_dom_element_get_attribute(((lxb_dom_element_t *)__pyx_v_node), ((lxb_char_t *)__pyx_v_attr.data()), __pyx_v_attr.size(), (&__pyx_v_node_attr_len));
 
-  /* "resiliparse/parse/html.pxd":48
+  /* "resiliparse/parse/html.pxd":55
  *     cdef const lxb_char_t* node_attr_data = lxb_dom_element_get_attribute(
  *         <lxb_dom_element_t*>node, <lxb_char_t*>attr.data(), attr.size(), &node_attr_len)
  *     return StringPiece(<const char*>node_attr_data, node_attr_len)             # <<<<<<<<<<<<<<
  * 
  * cdef string get_node_text(lxb_dom_node_t* node) nogil
  */
   __pyx_r = re2::StringPiece(((char const *)__pyx_v_node_attr_data), __pyx_v_node_attr_len);
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pxd":43
+  /* "resiliparse/parse/html.pxd":50
  *     return string_view(<const char*>node_attr_data, node_attr_len)
  * 
  * cdef inline StringPiece get_node_attr_sp(lxb_dom_node_t* node, const string& attr) nogil:             # <<<<<<<<<<<<<<
  *     """Get node attribute value as RE2 StringPiece."""
  *     cdef size_t node_attr_len
  */
 
   /* function exit code */
   __pyx_L0:;
   return __pyx_r;
 }
 
-/* "string.from_py":13
- * 
- * @cname("__pyx_convert_string_from_py_std__in_string")
- * cdef string __pyx_convert_string_from_py_std__in_string(object o) except *:             # <<<<<<<<<<<<<<
- *     cdef Py_ssize_t length = 0
- *     cdef const char* data = __Pyx_PyObject_AsStringAndSize(o, &length)
- */
-
-static std::string __pyx_convert_string_from_py_std__in_string(PyObject *__pyx_v_o) {
-  Py_ssize_t __pyx_v_length;
-  char const *__pyx_v_data;
-  std::string __pyx_r;
-  __Pyx_RefNannyDeclarations
-  char const *__pyx_t_1;
-  int __pyx_lineno = 0;
-  const char *__pyx_filename = NULL;
-  int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("__pyx_convert_string_from_py_std__in_string", 0);
-
-  /* "string.from_py":14
- * @cname("__pyx_convert_string_from_py_std__in_string")
- * cdef string __pyx_convert_string_from_py_std__in_string(object o) except *:
- *     cdef Py_ssize_t length = 0             # <<<<<<<<<<<<<<
- *     cdef const char* data = __Pyx_PyObject_AsStringAndSize(o, &length)
- *     return string(data, length)
- */
-  __pyx_v_length = 0;
-
-  /* "string.from_py":15
- * cdef string __pyx_convert_string_from_py_std__in_string(object o) except *:
- *     cdef Py_ssize_t length = 0
- *     cdef const char* data = __Pyx_PyObject_AsStringAndSize(o, &length)             # <<<<<<<<<<<<<<
- *     return string(data, length)
- * 
- */
-  __pyx_t_1 = __Pyx_PyObject_AsStringAndSize(__pyx_v_o, (&__pyx_v_length)); if (unlikely(__pyx_t_1 == ((char const *)NULL))) __PYX_ERR(2, 15, __pyx_L1_error)
-  __pyx_v_data = __pyx_t_1;
-
-  /* "string.from_py":16
- *     cdef Py_ssize_t length = 0
- *     cdef const char* data = __Pyx_PyObject_AsStringAndSize(o, &length)
- *     return string(data, length)             # <<<<<<<<<<<<<<
- * 
- * 
- */
-  __pyx_r = std::string(__pyx_v_data, __pyx_v_length);
-  goto __pyx_L0;
-
-  /* "string.from_py":13
- * 
- * @cname("__pyx_convert_string_from_py_std__in_string")
- * cdef string __pyx_convert_string_from_py_std__in_string(object o) except *:             # <<<<<<<<<<<<<<
- *     cdef Py_ssize_t length = 0
- *     cdef const char* data = __Pyx_PyObject_AsStringAndSize(o, &length)
- */
-
-  /* function exit code */
-  __pyx_L1_error:;
-  __Pyx_AddTraceback("string.from_py.__pyx_convert_string_from_py_std__in_string", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __Pyx_pretend_to_initialize(&__pyx_r);
-  __pyx_L0:;
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
-/* "vector.from_py":45
- * 
- * @cname("__pyx_convert_vector_from_py_std_3a__3a_string")
- * cdef vector[X] __pyx_convert_vector_from_py_std_3a__3a_string(object o) except *:             # <<<<<<<<<<<<<<
- *     cdef vector[X] v
- *     for item in o:
- */
-
-static std::vector<std::string>  __pyx_convert_vector_from_py_std_3a__3a_string(PyObject *__pyx_v_o) {
-  std::vector<std::string>  __pyx_v_v;
-  PyObject *__pyx_v_item = NULL;
-  std::vector<std::string>  __pyx_r;
-  __Pyx_RefNannyDeclarations
-  PyObject *__pyx_t_1 = NULL;
-  Py_ssize_t __pyx_t_2;
-  PyObject *(*__pyx_t_3)(PyObject *);
-  PyObject *__pyx_t_4 = NULL;
-  std::string __pyx_t_5;
-  int __pyx_lineno = 0;
-  const char *__pyx_filename = NULL;
-  int __pyx_clineno = 0;
-  __Pyx_RefNannySetupContext("__pyx_convert_vector_from_py_std_3a__3a_string", 0);
-
-  /* "vector.from_py":47
- * cdef vector[X] __pyx_convert_vector_from_py_std_3a__3a_string(object o) except *:
- *     cdef vector[X] v
- *     for item in o:             # <<<<<<<<<<<<<<
- *         v.push_back(<X>item)
- *     return v
- */
-  if (likely(PyList_CheckExact(__pyx_v_o)) || PyTuple_CheckExact(__pyx_v_o)) {
-    __pyx_t_1 = __pyx_v_o; __Pyx_INCREF(__pyx_t_1); __pyx_t_2 = 0;
-    __pyx_t_3 = NULL;
-  } else {
-    __pyx_t_2 = -1; __pyx_t_1 = PyObject_GetIter(__pyx_v_o); if (unlikely(!__pyx_t_1)) __PYX_ERR(2, 47, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_3 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_3)) __PYX_ERR(2, 47, __pyx_L1_error)
-  }
-  for (;;) {
-    if (likely(!__pyx_t_3)) {
-      if (likely(PyList_CheckExact(__pyx_t_1))) {
-        if (__pyx_t_2 >= PyList_GET_SIZE(__pyx_t_1)) break;
-        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_4 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(2, 47, __pyx_L1_error)
-        #else
-        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) __PYX_ERR(2, 47, __pyx_L1_error)
-        __Pyx_GOTREF(__pyx_t_4);
-        #endif
-      } else {
-        if (__pyx_t_2 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
-        #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(2, 47, __pyx_L1_error)
-        #else
-        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) __PYX_ERR(2, 47, __pyx_L1_error)
-        __Pyx_GOTREF(__pyx_t_4);
-        #endif
-      }
-    } else {
-      __pyx_t_4 = __pyx_t_3(__pyx_t_1);
-      if (unlikely(!__pyx_t_4)) {
-        PyObject* exc_type = PyErr_Occurred();
-        if (exc_type) {
-          if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-          else __PYX_ERR(2, 47, __pyx_L1_error)
-        }
-        break;
-      }
-      __Pyx_GOTREF(__pyx_t_4);
-    }
-    __Pyx_XDECREF_SET(__pyx_v_item, __pyx_t_4);
-    __pyx_t_4 = 0;
-
-    /* "vector.from_py":48
- *     cdef vector[X] v
- *     for item in o:
- *         v.push_back(<X>item)             # <<<<<<<<<<<<<<
- *     return v
- * 
- */
-    __pyx_t_5 = __pyx_convert_string_from_py_std__in_string(__pyx_v_item); if (unlikely(PyErr_Occurred())) __PYX_ERR(2, 48, __pyx_L1_error)
-    __pyx_v_v.push_back(((std::string)__pyx_t_5));
-
-    /* "vector.from_py":47
- * cdef vector[X] __pyx_convert_vector_from_py_std_3a__3a_string(object o) except *:
- *     cdef vector[X] v
- *     for item in o:             # <<<<<<<<<<<<<<
- *         v.push_back(<X>item)
- *     return v
- */
-  }
-  __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-
-  /* "vector.from_py":49
- *     for item in o:
- *         v.push_back(<X>item)
- *     return v             # <<<<<<<<<<<<<<
- * 
- * 
- */
-  __pyx_r = __pyx_v_v;
-  goto __pyx_L0;
-
-  /* "vector.from_py":45
- * 
- * @cname("__pyx_convert_vector_from_py_std_3a__3a_string")
- * cdef vector[X] __pyx_convert_vector_from_py_std_3a__3a_string(object o) except *:             # <<<<<<<<<<<<<<
- *     cdef vector[X] v
- *     for item in o:
- */
-
-  /* function exit code */
-  __pyx_L1_error:;
-  __Pyx_XDECREF(__pyx_t_1);
-  __Pyx_XDECREF(__pyx_t_4);
-  __Pyx_AddTraceback("vector.from_py.__pyx_convert_vector_from_py_std_3a__3a_string", __pyx_clineno, __pyx_lineno, __pyx_filename);
-  __Pyx_pretend_to_initialize(&__pyx_r);
-  __pyx_L0:;
-  __Pyx_XDECREF(__pyx_v_item);
-  __Pyx_RefNannyFinishContext();
-  return __pyx_r;
-}
-
 /* "string.to_py":31
  * 
  * @cname("__pyx_convert_PyObject_string_to_py_std__in_string")
  * cdef inline object __pyx_convert_PyObject_string_to_py_std__in_string(const string& s):             # <<<<<<<<<<<<<<
  *     return __Pyx_PyObject_FromStringAndSize(s.data(), s.size())
  * cdef extern from *:
  */
@@ -9407,14 +9454,17 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
+  #if PY_VERSION_HEX >= 0x030B00A2
+  0, /*tp_inline_values_offset*/
+  #endif
 };
 
 static struct __pyx_obj_11resiliparse_7extract_9html2text___pyx_scope_struct_1_genexpr *__pyx_freelist_11resiliparse_7extract_9html2text___pyx_scope_struct_1_genexpr[8];
 static int __pyx_freecount_11resiliparse_7extract_9html2text___pyx_scope_struct_1_genexpr = 0;
 
 static PyObject *__pyx_tp_new_11resiliparse_7extract_9html2text___pyx_scope_struct_1_genexpr(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
   struct __pyx_obj_11resiliparse_7extract_9html2text___pyx_scope_struct_1_genexpr *p;
@@ -9517,14 +9567,17 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
+  #if PY_VERSION_HEX >= 0x030B00A2
+  0, /*tp_inline_values_offset*/
+  #endif
 };
 
 static PyMethodDef __pyx_methods[] = {
   {0, 0, 0, 0}
 };
 
 #if PY_MAJOR_VERSION >= 3
@@ -9566,95 +9619,102 @@
 #else
     #define CYTHON_SMALL_CODE
 #endif
 #endif
 
 static __Pyx_StringTabEntry __pyx_string_tab[] = {
   {&__pyx_kp_u_, __pyx_k_, sizeof(__pyx_k_), 0, 1, 0, 0},
-  {&__pyx_n_s_add, __pyx_k_add, sizeof(__pyx_k_add), 0, 0, 1, 1},
+  {&__pyx_kp_b__2, __pyx_k__2, sizeof(__pyx_k__2), 0, 0, 0, 0},
   {&__pyx_n_s_alt_texts, __pyx_k_alt_texts, sizeof(__pyx_k_alt_texts), 0, 0, 1, 1},
   {&__pyx_n_b_area, __pyx_k_area, sizeof(__pyx_k_area), 0, 0, 0, 1},
   {&__pyx_n_s_args, __pyx_k_args, sizeof(__pyx_k_args), 0, 0, 1, 1},
   {&__pyx_n_b_audio, __pyx_k_audio, sizeof(__pyx_k_audio), 0, 0, 0, 1},
   {&__pyx_n_s_base_node, __pyx_k_base_node, sizeof(__pyx_k_base_node), 0, 0, 1, 1},
   {&__pyx_n_b_button, __pyx_k_button, sizeof(__pyx_k_button), 0, 0, 0, 1},
   {&__pyx_n_s_cline_in_traceback, __pyx_k_cline_in_traceback, sizeof(__pyx_k_cline_in_traceback), 0, 0, 1, 1},
   {&__pyx_n_s_close, __pyx_k_close, sizeof(__pyx_k_close), 0, 0, 1, 1},
+  {&__pyx_n_s_combined_skip_sel, __pyx_k_combined_skip_sel, sizeof(__pyx_k_combined_skip_sel), 0, 0, 1, 1},
+  {&__pyx_n_s_css_parser, __pyx_k_css_parser, sizeof(__pyx_k_css_parser), 0, 0, 1, 1},
+  {&__pyx_n_s_css_selectors, __pyx_k_css_selectors, sizeof(__pyx_k_css_selectors), 0, 0, 1, 1},
   {&__pyx_n_s_ctx, __pyx_k_ctx, sizeof(__pyx_k_ctx), 0, 0, 1, 1},
   {&__pyx_n_s_e, __pyx_k_e, sizeof(__pyx_k_e), 0, 0, 1, 1},
   {&__pyx_n_b_embedimg, __pyx_k_embedimg, sizeof(__pyx_k_embedimg), 0, 0, 0, 1},
   {&__pyx_n_s_encode, __pyx_k_encode, sizeof(__pyx_k_encode), 0, 0, 1, 1},
   {&__pyx_n_s_extract_plain_text, __pyx_k_extract_plain_text, sizeof(__pyx_k_extract_plain_text), 0, 0, 1, 1},
   {&__pyx_n_s_extract_plain_text_locals_genexp, __pyx_k_extract_plain_text_locals_genexp, sizeof(__pyx_k_extract_plain_text_locals_genexp), 0, 0, 1, 1},
   {&__pyx_n_s_form_fields, __pyx_k_form_fields, sizeof(__pyx_k_form_fields), 0, 0, 1, 1},
   {&__pyx_n_s_genexpr, __pyx_k_genexpr, sizeof(__pyx_k_genexpr), 0, 0, 1, 1},
-  {&__pyx_n_b_head, __pyx_k_head, sizeof(__pyx_k_head), 0, 0, 0, 1},
   {&__pyx_n_s_i, __pyx_k_i, sizeof(__pyx_k_i), 0, 0, 1, 1},
   {&__pyx_n_b_input, __pyx_k_input, sizeof(__pyx_k_input), 0, 0, 0, 1},
   {&__pyx_n_s_is_end_tag, __pyx_k_is_end_tag, sizeof(__pyx_k_is_end_tag), 0, 0, 1, 1},
+  {&__pyx_n_s_join, __pyx_k_join, sizeof(__pyx_k_join), 0, 0, 1, 1},
   {&__pyx_n_s_links, __pyx_k_links, sizeof(__pyx_k_links), 0, 0, 1, 1},
   {&__pyx_n_s_list_bullets, __pyx_k_list_bullets, sizeof(__pyx_k_list_bullets), 0, 0, 1, 1},
   {&__pyx_n_s_main, __pyx_k_main, sizeof(__pyx_k_main), 0, 0, 1, 1},
   {&__pyx_n_s_main_content, __pyx_k_main_content, sizeof(__pyx_k_main_content), 0, 0, 1, 1},
   {&__pyx_n_s_name, __pyx_k_name, sizeof(__pyx_k_name), 0, 0, 1, 1},
+  {&__pyx_n_s_node_blacklist, __pyx_k_node_blacklist, sizeof(__pyx_k_node_blacklist), 0, 0, 1, 1},
   {&__pyx_n_b_noscript, __pyx_k_noscript, sizeof(__pyx_k_noscript), 0, 0, 0, 1},
   {&__pyx_n_s_noscript, __pyx_k_noscript, sizeof(__pyx_k_noscript), 0, 0, 1, 1},
   {&__pyx_n_b_object, __pyx_k_object, sizeof(__pyx_k_object), 0, 0, 0, 1},
   {&__pyx_n_s_preserve_formatting, __pyx_k_preserve_formatting, sizeof(__pyx_k_preserve_formatting), 0, 0, 1, 1},
   {&__pyx_n_s_pyx_vtable, __pyx_k_pyx_vtable, sizeof(__pyx_k_pyx_vtable), 0, 0, 1, 1},
   {&__pyx_n_s_range, __pyx_k_range, sizeof(__pyx_k_range), 0, 0, 1, 1},
   {&__pyx_n_s_resiliparse_extract_html2text, __pyx_k_resiliparse_extract_html2text, sizeof(__pyx_k_resiliparse_extract_html2text), 0, 0, 1, 1},
   {&__pyx_kp_s_resiliparse_extract_html2text_py, __pyx_k_resiliparse_extract_html2text_py, sizeof(__pyx_k_resiliparse_extract_html2text_py), 0, 0, 1, 0},
   {&__pyx_n_s_rstrip, __pyx_k_rstrip, sizeof(__pyx_k_rstrip), 0, 0, 1, 1},
   {&__pyx_n_b_script, __pyx_k_script, sizeof(__pyx_k_script), 0, 0, 0, 1},
+  {&__pyx_n_s_selector_list, __pyx_k_selector_list, sizeof(__pyx_k_selector_list), 0, 0, 1, 1},
+  {&__pyx_n_s_selectors, __pyx_k_selectors, sizeof(__pyx_k_selectors), 0, 0, 1, 1},
   {&__pyx_n_s_send, __pyx_k_send, sizeof(__pyx_k_send), 0, 0, 1, 1},
   {&__pyx_n_s_skip, __pyx_k_skip, sizeof(__pyx_k_skip), 0, 0, 1, 1},
   {&__pyx_n_s_skip_elements, __pyx_k_skip_elements, sizeof(__pyx_k_skip_elements), 0, 0, 1, 1},
-  {&__pyx_n_s_skip_elements_vec, __pyx_k_skip_elements_vec, sizeof(__pyx_k_skip_elements_vec), 0, 0, 1, 1},
+  {&__pyx_n_s_skip_selectors, __pyx_k_skip_selectors, sizeof(__pyx_k_skip_selectors), 0, 0, 1, 1},
   {&__pyx_n_b_style, __pyx_k_style, sizeof(__pyx_k_style), 0, 0, 0, 1},
   {&__pyx_n_s_tag_name, __pyx_k_tag_name, sizeof(__pyx_k_tag_name), 0, 0, 1, 1},
   {&__pyx_n_s_tag_name_len, __pyx_k_tag_name_len, sizeof(__pyx_k_tag_name_len), 0, 0, 1, 1},
   {&__pyx_n_s_tag_name_str, __pyx_k_tag_name_str, sizeof(__pyx_k_tag_name_str), 0, 0, 1, 1},
   {&__pyx_n_s_test, __pyx_k_test, sizeof(__pyx_k_test), 0, 0, 1, 1},
   {&__pyx_n_b_textarea, __pyx_k_textarea, sizeof(__pyx_k_textarea), 0, 0, 0, 1},
   {&__pyx_n_s_throw, __pyx_k_throw, sizeof(__pyx_k_throw), 0, 0, 1, 1},
   {&__pyx_n_s_update, __pyx_k_update, sizeof(__pyx_k_update), 0, 0, 1, 1},
   {&__pyx_n_b_video, __pyx_k_video, sizeof(__pyx_k_video), 0, 0, 0, 1},
   {0, 0, 0, 0, 0, 0, 0}
 };
 static CYTHON_SMALL_CODE int __Pyx_InitCachedBuiltins(void) {
-  __pyx_builtin_range = __Pyx_GetBuiltinName(__pyx_n_s_range); if (!__pyx_builtin_range) __PYX_ERR(0, 69, __pyx_L1_error)
+  __pyx_builtin_range = __Pyx_GetBuiltinName(__pyx_n_s_range); if (!__pyx_builtin_range) __PYX_ERR(0, 71, __pyx_L1_error)
   return 0;
   __pyx_L1_error:;
   return -1;
 }
 
 static CYTHON_SMALL_CODE int __Pyx_InitCachedConstants(void) {
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__Pyx_InitCachedConstants", 0);
 
-  /* "resiliparse/extract/html2text.pyx":501
+  /* "resiliparse/extract/html2text.pyx":516
  * 
  * 
- * def extract_plain_text(DOMNode base_node, bint preserve_formatting=True, bint main_content=False, bint list_bullets=True,             # <<<<<<<<<<<<<<
- *                        bint alt_texts=True, bint links=False, bint form_fields=False, bint noscript=False,
- *                        skip_elements=None):
+ * def extract_plain_text(DOMNode base_node, bint preserve_formatting=True, bint main_content=False,             # <<<<<<<<<<<<<<
+ *                        bint list_bullets=True,  bint alt_texts=True, bint links=False, bint form_fields=False,
+ *                        bint noscript=False, skip_elements=None):
  */
-  __pyx_tuple__2 = PyTuple_Pack(20, __pyx_n_s_base_node, __pyx_n_s_preserve_formatting, __pyx_n_s_main_content, __pyx_n_s_list_bullets, __pyx_n_s_alt_texts, __pyx_n_s_links, __pyx_n_s_form_fields, __pyx_n_s_noscript, __pyx_n_s_skip_elements, __pyx_n_s_ctx, __pyx_n_s_skip_elements_vec, __pyx_n_s_tag_name, __pyx_n_s_tag_name_len, __pyx_n_s_tag_name_str, __pyx_n_s_i, __pyx_n_s_skip, __pyx_n_s_is_end_tag, __pyx_n_s_e, __pyx_n_s_genexpr, __pyx_n_s_genexpr); if (unlikely(!__pyx_tuple__2)) __PYX_ERR(0, 501, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__2);
-  __Pyx_GIVEREF(__pyx_tuple__2);
-  __pyx_codeobj__3 = (PyObject*)__Pyx_PyCode_New(9, 0, 20, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__2, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_resiliparse_extract_html2text_py, __pyx_n_s_extract_plain_text, 501, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__3)) __PYX_ERR(0, 501, __pyx_L1_error)
+  __pyx_tuple__3 = PyTuple_Pack(26, __pyx_n_s_base_node, __pyx_n_s_preserve_formatting, __pyx_n_s_main_content, __pyx_n_s_list_bullets, __pyx_n_s_alt_texts, __pyx_n_s_links, __pyx_n_s_form_fields, __pyx_n_s_noscript, __pyx_n_s_skip_elements, __pyx_n_s_skip_selectors, __pyx_n_s_ctx, __pyx_n_s_tag_name, __pyx_n_s_tag_name_len, __pyx_n_s_tag_name_str, __pyx_n_s_i, __pyx_n_s_skip, __pyx_n_s_is_end_tag, __pyx_n_s_css_parser, __pyx_n_s_css_selectors, __pyx_n_s_selectors, __pyx_n_s_selector_list, __pyx_n_s_node_blacklist, __pyx_n_s_combined_skip_sel, __pyx_n_s_e, __pyx_n_s_genexpr, __pyx_n_s_genexpr); if (unlikely(!__pyx_tuple__3)) __PYX_ERR(0, 516, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__3);
+  __Pyx_GIVEREF(__pyx_tuple__3);
+  __pyx_codeobj__4 = (PyObject*)__Pyx_PyCode_New(9, 0, 26, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__3, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_resiliparse_extract_html2text_py, __pyx_n_s_extract_plain_text, 516, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__4)) __PYX_ERR(0, 516, __pyx_L1_error)
   __Pyx_RefNannyFinishContext();
   return 0;
   __pyx_L1_error:;
   __Pyx_RefNannyFinishContext();
   return -1;
 }
 
 static CYTHON_SMALL_CODE int __Pyx_InitGlobals(void) {
+  __pyx_umethod_PySet_Type_update.type = (PyObject*)&PySet_Type;
   if (__Pyx_InitStrings(__pyx_string_tab) < 0) __PYX_ERR(0, 1, __pyx_L1_error);
   return 0;
   __pyx_L1_error:;
   return -1;
 }
 
 static CYTHON_SMALL_CODE int __Pyx_modinit_global_init_code(void); /*proto*/
@@ -9692,23 +9752,23 @@
 static int __Pyx_modinit_type_init_code(void) {
   __Pyx_RefNannyDeclarations
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__Pyx_modinit_type_init_code", 0);
   /*--- Type init code ---*/
-  if (PyType_Ready(&__pyx_type_11resiliparse_7extract_9html2text___pyx_scope_struct__extract_plain_text) < 0) __PYX_ERR(0, 501, __pyx_L1_error)
+  if (PyType_Ready(&__pyx_type_11resiliparse_7extract_9html2text___pyx_scope_struct__extract_plain_text) < 0) __PYX_ERR(0, 516, __pyx_L1_error)
   #if PY_VERSION_HEX < 0x030800B1
   __pyx_type_11resiliparse_7extract_9html2text___pyx_scope_struct__extract_plain_text.tp_print = 0;
   #endif
   if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_11resiliparse_7extract_9html2text___pyx_scope_struct__extract_plain_text.tp_dictoffset && __pyx_type_11resiliparse_7extract_9html2text___pyx_scope_struct__extract_plain_text.tp_getattro == PyObject_GenericGetAttr)) {
     __pyx_type_11resiliparse_7extract_9html2text___pyx_scope_struct__extract_plain_text.tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
   }
   __pyx_ptype_11resiliparse_7extract_9html2text___pyx_scope_struct__extract_plain_text = &__pyx_type_11resiliparse_7extract_9html2text___pyx_scope_struct__extract_plain_text;
-  if (PyType_Ready(&__pyx_type_11resiliparse_7extract_9html2text___pyx_scope_struct_1_genexpr) < 0) __PYX_ERR(0, 613, __pyx_L1_error)
+  if (PyType_Ready(&__pyx_type_11resiliparse_7extract_9html2text___pyx_scope_struct_1_genexpr) < 0) __PYX_ERR(0, 642, __pyx_L1_error)
   #if PY_VERSION_HEX < 0x030800B1
   __pyx_type_11resiliparse_7extract_9html2text___pyx_scope_struct_1_genexpr.tp_print = 0;
   #endif
   if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_11resiliparse_7extract_9html2text___pyx_scope_struct_1_genexpr.tp_dictoffset && __pyx_type_11resiliparse_7extract_9html2text___pyx_scope_struct_1_genexpr.tp_getattro == PyObject_GenericGetAttr)) {
     __pyx_type_11resiliparse_7extract_9html2text___pyx_scope_struct_1_genexpr.tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
   }
   __pyx_ptype_11resiliparse_7extract_9html2text___pyx_scope_struct_1_genexpr = &__pyx_type_11resiliparse_7extract_9html2text___pyx_scope_struct_1_genexpr;
@@ -9723,28 +9783,28 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__Pyx_modinit_type_import_code", 0);
   /*--- Type import code ---*/
-  __pyx_t_1 = PyImport_ImportModule("resiliparse.parse.html"); if (unlikely(!__pyx_t_1)) __PYX_ERR(3, 67, __pyx_L1_error)
+  __pyx_t_1 = PyImport_ImportModule("resiliparse.parse.html"); if (unlikely(!__pyx_t_1)) __PYX_ERR(3, 75, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_ptype_11resiliparse_5parse_4html_DOMElementClassList = __Pyx_ImportType(__pyx_t_1, "resiliparse.parse.html", "DOMElementClassList", sizeof(struct __pyx_obj_11resiliparse_5parse_4html_DOMElementClassList), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_11resiliparse_5parse_4html_DOMElementClassList) __PYX_ERR(3, 67, __pyx_L1_error)
-  __pyx_vtabptr_11resiliparse_5parse_4html_DOMElementClassList = (struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMElementClassList*)__Pyx_GetVtable(__pyx_ptype_11resiliparse_5parse_4html_DOMElementClassList->tp_dict); if (unlikely(!__pyx_vtabptr_11resiliparse_5parse_4html_DOMElementClassList)) __PYX_ERR(3, 67, __pyx_L1_error)
+   if (!__pyx_ptype_11resiliparse_5parse_4html_DOMElementClassList) __PYX_ERR(3, 75, __pyx_L1_error)
+  __pyx_vtabptr_11resiliparse_5parse_4html_DOMElementClassList = (struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMElementClassList*)__Pyx_GetVtable(__pyx_ptype_11resiliparse_5parse_4html_DOMElementClassList->tp_dict); if (unlikely(!__pyx_vtabptr_11resiliparse_5parse_4html_DOMElementClassList)) __PYX_ERR(3, 75, __pyx_L1_error)
   __pyx_ptype_11resiliparse_5parse_4html_DOMNode = __Pyx_ImportType(__pyx_t_1, "resiliparse.parse.html", "DOMNode", sizeof(struct __pyx_obj_11resiliparse_5parse_4html_DOMNode), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_11resiliparse_5parse_4html_DOMNode) __PYX_ERR(3, 76, __pyx_L1_error)
-  __pyx_vtabptr_11resiliparse_5parse_4html_DOMNode = (struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMNode*)__Pyx_GetVtable(__pyx_ptype_11resiliparse_5parse_4html_DOMNode->tp_dict); if (unlikely(!__pyx_vtabptr_11resiliparse_5parse_4html_DOMNode)) __PYX_ERR(3, 76, __pyx_L1_error)
+   if (!__pyx_ptype_11resiliparse_5parse_4html_DOMNode) __PYX_ERR(3, 84, __pyx_L1_error)
+  __pyx_vtabptr_11resiliparse_5parse_4html_DOMNode = (struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMNode*)__Pyx_GetVtable(__pyx_ptype_11resiliparse_5parse_4html_DOMNode->tp_dict); if (unlikely(!__pyx_vtabptr_11resiliparse_5parse_4html_DOMNode)) __PYX_ERR(3, 84, __pyx_L1_error)
   __pyx_ptype_11resiliparse_5parse_4html_DOMCollection = __Pyx_ImportType(__pyx_t_1, "resiliparse.parse.html", "DOMCollection", sizeof(struct __pyx_obj_11resiliparse_5parse_4html_DOMCollection), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_11resiliparse_5parse_4html_DOMCollection) __PYX_ERR(3, 105, __pyx_L1_error)
-  __pyx_vtabptr_11resiliparse_5parse_4html_DOMCollection = (struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMCollection*)__Pyx_GetVtable(__pyx_ptype_11resiliparse_5parse_4html_DOMCollection->tp_dict); if (unlikely(!__pyx_vtabptr_11resiliparse_5parse_4html_DOMCollection)) __PYX_ERR(3, 105, __pyx_L1_error)
+   if (!__pyx_ptype_11resiliparse_5parse_4html_DOMCollection) __PYX_ERR(3, 113, __pyx_L1_error)
+  __pyx_vtabptr_11resiliparse_5parse_4html_DOMCollection = (struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMCollection*)__Pyx_GetVtable(__pyx_ptype_11resiliparse_5parse_4html_DOMCollection->tp_dict); if (unlikely(!__pyx_vtabptr_11resiliparse_5parse_4html_DOMCollection)) __PYX_ERR(3, 113, __pyx_L1_error)
   __pyx_ptype_11resiliparse_5parse_4html_HTMLTree = __Pyx_ImportType(__pyx_t_1, "resiliparse.parse.html", "HTMLTree", sizeof(struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree), __Pyx_ImportType_CheckSize_Warn);
-   if (!__pyx_ptype_11resiliparse_5parse_4html_HTMLTree) __PYX_ERR(3, 141, __pyx_L1_error)
-  __pyx_vtabptr_11resiliparse_5parse_4html_HTMLTree = (struct __pyx_vtabstruct_11resiliparse_5parse_4html_HTMLTree*)__Pyx_GetVtable(__pyx_ptype_11resiliparse_5parse_4html_HTMLTree->tp_dict); if (unlikely(!__pyx_vtabptr_11resiliparse_5parse_4html_HTMLTree)) __PYX_ERR(3, 141, __pyx_L1_error)
+   if (!__pyx_ptype_11resiliparse_5parse_4html_HTMLTree) __PYX_ERR(3, 149, __pyx_L1_error)
+  __pyx_vtabptr_11resiliparse_5parse_4html_HTMLTree = (struct __pyx_vtabstruct_11resiliparse_5parse_4html_HTMLTree*)__Pyx_GetVtable(__pyx_ptype_11resiliparse_5parse_4html_HTMLTree->tp_dict); if (unlikely(!__pyx_vtabptr_11resiliparse_5parse_4html_HTMLTree)) __PYX_ERR(3, 149, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_RefNannyFinishContext();
   return 0;
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_RefNannyFinishContext();
   return -1;
@@ -9764,14 +9824,19 @@
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__Pyx_modinit_function_import_code", 0);
   /*--- Function import code ---*/
   __pyx_t_1 = PyImport_ImportModule("resiliparse.parse.html"); if (!__pyx_t_1) __PYX_ERR(0, 1, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
+  if (__Pyx_ImportFunction(__pyx_t_1, "init_css_parser", (void (**)(void))&__pyx_f_11resiliparse_5parse_4html_init_css_parser, "int (lxb_css_parser_t **)") < 0) __PYX_ERR(0, 1, __pyx_L1_error)
+  if (__Pyx_ImportFunction(__pyx_t_1, "destroy_css_parser", (void (**)(void))&__pyx_f_11resiliparse_5parse_4html_destroy_css_parser, "void (lxb_css_parser_t *)") < 0) __PYX_ERR(0, 1, __pyx_L1_error)
+  if (__Pyx_ImportFunction(__pyx_t_1, "init_css_selectors", (void (**)(void))&__pyx_f_11resiliparse_5parse_4html_init_css_selectors, "int (lxb_css_parser_t *, lxb_css_selectors_t **, lxb_selectors_t **)") < 0) __PYX_ERR(0, 1, __pyx_L1_error)
+  if (__Pyx_ImportFunction(__pyx_t_1, "destroy_css_selectors", (void (**)(void))&__pyx_f_11resiliparse_5parse_4html_destroy_css_selectors, "void (lxb_css_selectors_t *, lxb_selectors_t *)") < 0) __PYX_ERR(0, 1, __pyx_L1_error)
+  if (__Pyx_ImportFunction(__pyx_t_1, "parse_css_selectors", (void (**)(void))&__pyx_f_11resiliparse_5parse_4html_parse_css_selectors, "lxb_css_selector_list_t *(lxb_css_parser_t *, lxb_char_t const *, size_t)") < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   if (__Pyx_ImportFunction(__pyx_t_1, "next_node", (void (**)(void))&__pyx_f_11resiliparse_5parse_4html_next_node, "lxb_dom_node_t *(lxb_dom_node_t const *, lxb_dom_node_t *, struct __pyx_opt_args_11resiliparse_5parse_4html_next_node *__pyx_optional_args)") < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   if (__Pyx_ImportFunction(__pyx_t_1, "get_node_text", (void (**)(void))&__pyx_f_11resiliparse_5parse_4html_get_node_text, "std::string (lxb_dom_node_t *)") < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   if (__Pyx_ImportFunction(__pyx_t_1, "is_block_element", (void (**)(void))&__pyx_f_11resiliparse_5parse_4html_is_block_element, "int (lxb_tag_id_t)") < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_RefNannyFinishContext();
   return 0;
   __pyx_L1_error:;
@@ -9976,141 +10041,141 @@
   (void)__Pyx_modinit_variable_import_code();
   if (unlikely(__Pyx_modinit_function_import_code() < 0)) __PYX_ERR(0, 1, __pyx_L1_error)
   /*--- Execution code ---*/
   #if defined(__Pyx_Generator_USED) || defined(__Pyx_Coroutine_USED)
   if (__Pyx_patch_abc() < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   #endif
 
-  /* "resiliparse/extract/html2text.pyx":91
+  /* "resiliparse/extract/html2text.pyx":93
  * 
  * 
  * cdef string LIST_BULLET = <const char*>b'\xe2\x80\xa2'             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __pyx_v_11resiliparse_7extract_9html2text_LIST_BULLET = ((char const *)((char const *)"\342\200\242"));
 
-  /* "resiliparse/extract/html2text.pyx":341
+  /* "resiliparse/extract/html2text.pyx":350
  * 
  * cdef RE2Options re_opts
  * re_opts.set_case_sensitive(False)             # <<<<<<<<<<<<<<
  * 
  * cdef RE2 wrapper_cls_regex = RE2(b'(?:^|[\\s_-])wrap(?:per)?(?:$|[\\s_-])', re_opts)
  */
   __pyx_v_11resiliparse_7extract_9html2text_re_opts.set_case_sensitive(0);
 
-  /* "resiliparse/extract/html2text.pyx":343
+  /* "resiliparse/extract/html2text.pyx":352
  * re_opts.set_case_sensitive(False)
  * 
  * cdef RE2 wrapper_cls_regex = RE2(b'(?:^|[\\s_-])wrap(?:per)?(?:$|[\\s_-])', re_opts)             # <<<<<<<<<<<<<<
  * cdef RE2 nav_cls_regex = RE2(b'(?:^|[\\s_-])(?:nav(?:bar|igation)?|menu(?:[_-]item)?)(?:$|\\s)', re_opts)
  * cdef RE2 footer_cls_regex = RE2(b'(?:^|\\s)(?:(?:global|page|site|copyright)[_-]?)?footer(?:[_-]?(?:section|wrapper)?)(?:^|\\s)', re_opts)
  */
   __pyx_v_11resiliparse_7extract_9html2text_wrapper_cls_regex = RE2Stack(((char const *)"(?:^|[\\s_-])wrap(?:per)?(?:$|[\\s_-])"), __pyx_v_11resiliparse_7extract_9html2text_re_opts);
 
-  /* "resiliparse/extract/html2text.pyx":344
+  /* "resiliparse/extract/html2text.pyx":353
  * 
  * cdef RE2 wrapper_cls_regex = RE2(b'(?:^|[\\s_-])wrap(?:per)?(?:$|[\\s_-])', re_opts)
  * cdef RE2 nav_cls_regex = RE2(b'(?:^|[\\s_-])(?:nav(?:bar|igation)?|menu(?:[_-]item)?)(?:$|\\s)', re_opts)             # <<<<<<<<<<<<<<
  * cdef RE2 footer_cls_regex = RE2(b'(?:^|\\s)(?:(?:global|page|site|copyright)[_-]?)?footer(?:[_-]?(?:section|wrapper)?)(?:^|\\s)', re_opts)
  * cdef RE2 sidebar_cls_regex = RE2(b'(?:^|[\\s_-])sidebar(?:$|\\s)', re_opts)
  */
   __pyx_v_11resiliparse_7extract_9html2text_nav_cls_regex = RE2Stack(((char const *)"(?:^|[\\s_-])(?:nav(?:bar|igation)?|menu(?:[_-]item)?)(?:$|\\s)"), __pyx_v_11resiliparse_7extract_9html2text_re_opts);
 
-  /* "resiliparse/extract/html2text.pyx":345
+  /* "resiliparse/extract/html2text.pyx":354
  * cdef RE2 wrapper_cls_regex = RE2(b'(?:^|[\\s_-])wrap(?:per)?(?:$|[\\s_-])', re_opts)
  * cdef RE2 nav_cls_regex = RE2(b'(?:^|[\\s_-])(?:nav(?:bar|igation)?|menu(?:[_-]item)?)(?:$|\\s)', re_opts)
  * cdef RE2 footer_cls_regex = RE2(b'(?:^|\\s)(?:(?:global|page|site|copyright)[_-]?)?footer(?:[_-]?(?:section|wrapper)?)(?:^|\\s)', re_opts)             # <<<<<<<<<<<<<<
  * cdef RE2 sidebar_cls_regex = RE2(b'(?:^|[\\s_-])sidebar(?:$|\\s)', re_opts)
  * cdef RE2 search_cls_regex = RE2(b'(?:^|[\\s_-])search(?:[_-]?(?:bar|facility|box))?(?:$|\\s)', re_opts)
  */
   __pyx_v_11resiliparse_7extract_9html2text_footer_cls_regex = RE2Stack(((char const *)"(?:^|\\s)(?:(?:global|page|site|copyright)[_-]?)?footer(?:[_-]?(?:section|wrapper)?)(?:^|\\s)"), __pyx_v_11resiliparse_7extract_9html2text_re_opts);
 
-  /* "resiliparse/extract/html2text.pyx":346
+  /* "resiliparse/extract/html2text.pyx":355
  * cdef RE2 nav_cls_regex = RE2(b'(?:^|[\\s_-])(?:nav(?:bar|igation)?|menu(?:[_-]item)?)(?:$|\\s)', re_opts)
  * cdef RE2 footer_cls_regex = RE2(b'(?:^|\\s)(?:(?:global|page|site|copyright)[_-]?)?footer(?:[_-]?(?:section|wrapper)?)(?:^|\\s)', re_opts)
  * cdef RE2 sidebar_cls_regex = RE2(b'(?:^|[\\s_-])sidebar(?:$|\\s)', re_opts)             # <<<<<<<<<<<<<<
  * cdef RE2 search_cls_regex = RE2(b'(?:^|[\\s_-])search(?:[_-]?(?:bar|facility|box))?(?:$|\\s)', re_opts)
  * cdef RE2 skip_cls_regex = RE2(b'(?:^|[\\s_-])(?:skip|skip-to|skiplink|scroll-(?:up|down))(?:$|[\\s_-])', re_opts)
  */
   __pyx_v_11resiliparse_7extract_9html2text_sidebar_cls_regex = RE2Stack(((char const *)"(?:^|[\\s_-])sidebar(?:$|\\s)"), __pyx_v_11resiliparse_7extract_9html2text_re_opts);
 
-  /* "resiliparse/extract/html2text.pyx":347
+  /* "resiliparse/extract/html2text.pyx":356
  * cdef RE2 footer_cls_regex = RE2(b'(?:^|\\s)(?:(?:global|page|site|copyright)[_-]?)?footer(?:[_-]?(?:section|wrapper)?)(?:^|\\s)', re_opts)
  * cdef RE2 sidebar_cls_regex = RE2(b'(?:^|[\\s_-])sidebar(?:$|\\s)', re_opts)
  * cdef RE2 search_cls_regex = RE2(b'(?:^|[\\s_-])search(?:[_-]?(?:bar|facility|box))?(?:$|\\s)', re_opts)             # <<<<<<<<<<<<<<
  * cdef RE2 skip_cls_regex = RE2(b'(?:^|[\\s_-])(?:skip|skip-to|skiplink|scroll-(?:up|down))(?:$|[\\s_-])', re_opts)
  * cdef RE2 display_cls_regex = RE2(b'(?:^|\\s)(?:is[_-])?(?:display-none|hidden|invisible|collapsed|h-0)(?:-xs|-sm|-lg|-xl)?(?:$|\\s)', re_opts)
  */
   __pyx_v_11resiliparse_7extract_9html2text_search_cls_regex = RE2Stack(((char const *)"(?:^|[\\s_-])search(?:[_-]?(?:bar|facility|box))?(?:$|\\s)"), __pyx_v_11resiliparse_7extract_9html2text_re_opts);
 
-  /* "resiliparse/extract/html2text.pyx":348
+  /* "resiliparse/extract/html2text.pyx":357
  * cdef RE2 sidebar_cls_regex = RE2(b'(?:^|[\\s_-])sidebar(?:$|\\s)', re_opts)
  * cdef RE2 search_cls_regex = RE2(b'(?:^|[\\s_-])search(?:[_-]?(?:bar|facility|box))?(?:$|\\s)', re_opts)
  * cdef RE2 skip_cls_regex = RE2(b'(?:^|[\\s_-])(?:skip|skip-to|skiplink|scroll-(?:up|down))(?:$|[\\s_-])', re_opts)             # <<<<<<<<<<<<<<
  * cdef RE2 display_cls_regex = RE2(b'(?:^|\\s)(?:is[_-])?(?:display-none|hidden|invisible|collapsed|h-0)(?:-xs|-sm|-lg|-xl)?(?:$|\\s)', re_opts)
  * cdef RE2 display_css_regex = RE2(b'(?:^|;\\s)(?:display\\s?:\\s?none|visibility\\s?:\\s?hidden)(?:$|\\s?;)', re_opts)
  */
   __pyx_v_11resiliparse_7extract_9html2text_skip_cls_regex = RE2Stack(((char const *)"(?:^|[\\s_-])(?:skip|skip-to|skiplink|scroll-(?:up|down))(?:$|[\\s_-])"), __pyx_v_11resiliparse_7extract_9html2text_re_opts);
 
-  /* "resiliparse/extract/html2text.pyx":349
+  /* "resiliparse/extract/html2text.pyx":358
  * cdef RE2 search_cls_regex = RE2(b'(?:^|[\\s_-])search(?:[_-]?(?:bar|facility|box))?(?:$|\\s)', re_opts)
  * cdef RE2 skip_cls_regex = RE2(b'(?:^|[\\s_-])(?:skip|skip-to|skiplink|scroll-(?:up|down))(?:$|[\\s_-])', re_opts)
  * cdef RE2 display_cls_regex = RE2(b'(?:^|\\s)(?:is[_-])?(?:display-none|hidden|invisible|collapsed|h-0)(?:-xs|-sm|-lg|-xl)?(?:$|\\s)', re_opts)             # <<<<<<<<<<<<<<
  * cdef RE2 display_css_regex = RE2(b'(?:^|;\\s)(?:display\\s?:\\s?none|visibility\\s?:\\s?hidden)(?:$|\\s?;)', re_opts)
  * cdef RE2 modal_cls_regex = RE2(b'(?:^|\\s)(?:modal|popup|lightbox|dropdown)(?:$|\\s)', re_opts)
  */
   __pyx_v_11resiliparse_7extract_9html2text_display_cls_regex = RE2Stack(((char const *)"(?:^|\\s)(?:is[_-])?(?:display-none|hidden|invisible|collapsed|h-0)(?:-xs|-sm|-lg|-xl)?(?:$|\\s)"), __pyx_v_11resiliparse_7extract_9html2text_re_opts);
 
-  /* "resiliparse/extract/html2text.pyx":350
+  /* "resiliparse/extract/html2text.pyx":359
  * cdef RE2 skip_cls_regex = RE2(b'(?:^|[\\s_-])(?:skip|skip-to|skiplink|scroll-(?:up|down))(?:$|[\\s_-])', re_opts)
  * cdef RE2 display_cls_regex = RE2(b'(?:^|\\s)(?:is[_-])?(?:display-none|hidden|invisible|collapsed|h-0)(?:-xs|-sm|-lg|-xl)?(?:$|\\s)', re_opts)
  * cdef RE2 display_css_regex = RE2(b'(?:^|;\\s)(?:display\\s?:\\s?none|visibility\\s?:\\s?hidden)(?:$|\\s?;)', re_opts)             # <<<<<<<<<<<<<<
  * cdef RE2 modal_cls_regex = RE2(b'(?:^|\\s)(?:modal|popup|lightbox|dropdown)(?:$|\\s)', re_opts)
  * cdef RE2 ads_cls_regex = RE2(b'(?:^|[\\s_-])(?:google[_-])?(?:ad(?:vert|vertisement)?|widead|banner|promoted)(?:[_-][a-f0-9]+)?(?:$|\\s)', re_opts)
  */
   __pyx_v_11resiliparse_7extract_9html2text_display_css_regex = RE2Stack(((char const *)"(?:^|;\\s)(?:display\\s?:\\s?none|visibility\\s?:\\s?hidden)(?:$|\\s?;)"), __pyx_v_11resiliparse_7extract_9html2text_re_opts);
 
-  /* "resiliparse/extract/html2text.pyx":351
+  /* "resiliparse/extract/html2text.pyx":360
  * cdef RE2 display_cls_regex = RE2(b'(?:^|\\s)(?:is[_-])?(?:display-none|hidden|invisible|collapsed|h-0)(?:-xs|-sm|-lg|-xl)?(?:$|\\s)', re_opts)
  * cdef RE2 display_css_regex = RE2(b'(?:^|;\\s)(?:display\\s?:\\s?none|visibility\\s?:\\s?hidden)(?:$|\\s?;)', re_opts)
  * cdef RE2 modal_cls_regex = RE2(b'(?:^|\\s)(?:modal|popup|lightbox|dropdown)(?:$|\\s)', re_opts)             # <<<<<<<<<<<<<<
  * cdef RE2 ads_cls_regex = RE2(b'(?:^|[\\s_-])(?:google[_-])?(?:ad(?:vert|vertisement)?|widead|banner|promoted)(?:[_-][a-f0-9]+)?(?:$|\\s)', re_opts)
  * cdef RE2 social_cls_regex = RE2(b'(?:^|\\s)(?:social(?:media)?|share|sharing|feedback|facebook|twitter)(?:[_-](?:links|section))?(?:$|\\s)', re_opts)
  */
   __pyx_v_11resiliparse_7extract_9html2text_modal_cls_regex = RE2Stack(((char const *)"(?:^|\\s)(?:modal|popup|lightbox|dropdown)(?:$|\\s)"), __pyx_v_11resiliparse_7extract_9html2text_re_opts);
 
-  /* "resiliparse/extract/html2text.pyx":352
+  /* "resiliparse/extract/html2text.pyx":361
  * cdef RE2 display_css_regex = RE2(b'(?:^|;\\s)(?:display\\s?:\\s?none|visibility\\s?:\\s?hidden)(?:$|\\s?;)', re_opts)
  * cdef RE2 modal_cls_regex = RE2(b'(?:^|\\s)(?:modal|popup|lightbox|dropdown)(?:$|\\s)', re_opts)
  * cdef RE2 ads_cls_regex = RE2(b'(?:^|[\\s_-])(?:google[_-])?(?:ad(?:vert|vertisement)?|widead|banner|promoted)(?:[_-][a-f0-9]+)?(?:$|\\s)', re_opts)             # <<<<<<<<<<<<<<
  * cdef RE2 social_cls_regex = RE2(b'(?:^|\\s)(?:social(?:media)?|share|sharing|feedback|facebook|twitter)(?:[_-](?:links|section))?(?:$|\\s)', re_opts)
  * 
  */
   __pyx_v_11resiliparse_7extract_9html2text_ads_cls_regex = RE2Stack(((char const *)"(?:^|[\\s_-])(?:google[_-])?(?:ad(?:vert|vertisement)?|widead|banner|promoted)(?:[_-][a-f0-9]+)?(?:$|\\s)"), __pyx_v_11resiliparse_7extract_9html2text_re_opts);
 
-  /* "resiliparse/extract/html2text.pyx":353
+  /* "resiliparse/extract/html2text.pyx":362
  * cdef RE2 modal_cls_regex = RE2(b'(?:^|\\s)(?:modal|popup|lightbox|dropdown)(?:$|\\s)', re_opts)
  * cdef RE2 ads_cls_regex = RE2(b'(?:^|[\\s_-])(?:google[_-])?(?:ad(?:vert|vertisement)?|widead|banner|promoted)(?:[_-][a-f0-9]+)?(?:$|\\s)', re_opts)
  * cdef RE2 social_cls_regex = RE2(b'(?:^|\\s)(?:social(?:media)?|share|sharing|feedback|facebook|twitter)(?:[_-](?:links|section))?(?:$|\\s)', re_opts)             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __pyx_v_11resiliparse_7extract_9html2text_social_cls_regex = RE2Stack(((char const *)"(?:^|\\s)(?:social(?:media)?|share|sharing|feedback|facebook|twitter)(?:[_-](?:links|section))?(?:$|\\s)"), __pyx_v_11resiliparse_7extract_9html2text_re_opts);
 
-  /* "resiliparse/extract/html2text.pyx":501
+  /* "resiliparse/extract/html2text.pyx":516
  * 
  * 
- * def extract_plain_text(DOMNode base_node, bint preserve_formatting=True, bint main_content=False, bint list_bullets=True,             # <<<<<<<<<<<<<<
- *                        bint alt_texts=True, bint links=False, bint form_fields=False, bint noscript=False,
- *                        skip_elements=None):
+ * def extract_plain_text(DOMNode base_node, bint preserve_formatting=True, bint main_content=False,             # <<<<<<<<<<<<<<
+ *                        bint list_bullets=True,  bint alt_texts=True, bint links=False, bint form_fields=False,
+ *                        bint noscript=False, skip_elements=None):
  */
-  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_11resiliparse_7extract_9html2text_1extract_plain_text, NULL, __pyx_n_s_resiliparse_extract_html2text); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 501, __pyx_L1_error)
+  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_11resiliparse_7extract_9html2text_1extract_plain_text, NULL, __pyx_n_s_resiliparse_extract_html2text); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 516, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_extract_plain_text, __pyx_t_1) < 0) __PYX_ERR(0, 501, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_extract_plain_text, __pyx_t_1) < 0) __PYX_ERR(0, 516, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
   /* "resiliparse/extract/html2text.pyx":1
  * # Copyright 2021 Janek Bevendorff             # <<<<<<<<<<<<<<
  * #
  * # Licensed under the Apache License, Version 2.0 (the "License");
  */
@@ -10693,42 +10758,257 @@
     if (unlikely(!args)) return NULL;
     result = __Pyx_PyObject_Call(func, args, NULL);
     Py_DECREF(args);
     return result;
 }
 #endif
 
-/* PyObjectCall2Args */
-static CYTHON_UNUSED PyObject* __Pyx_PyObject_Call2Args(PyObject* function, PyObject* arg1, PyObject* arg2) {
+/* UnpackUnboundCMethod */
+static int __Pyx_TryUnpackUnboundCMethod(__Pyx_CachedCFunction* target) {
+    PyObject *method;
+    method = __Pyx_PyObject_GetAttrStr(target->type, *target->method_name);
+    if (unlikely(!method))
+        return -1;
+    target->method = method;
+#if CYTHON_COMPILING_IN_CPYTHON
+    #if PY_MAJOR_VERSION >= 3
+    if (likely(__Pyx_TypeCheck(method, &PyMethodDescr_Type)))
+    #endif
+    {
+        PyMethodDescrObject *descr = (PyMethodDescrObject*) method;
+        target->func = descr->d_method->ml_meth;
+        target->flag = descr->d_method->ml_flags & ~(METH_CLASS | METH_STATIC | METH_COEXIST | METH_STACKLESS);
+    }
+#endif
+    return 0;
+}
+
+/* CallUnboundCMethod1 */
+#if CYTHON_COMPILING_IN_CPYTHON
+static CYTHON_INLINE PyObject* __Pyx_CallUnboundCMethod1(__Pyx_CachedCFunction* cfunc, PyObject* self, PyObject* arg) {
+    if (likely(cfunc->func)) {
+        int flag = cfunc->flag;
+        if (flag == METH_O) {
+            return (*(cfunc->func))(self, arg);
+        } else if (PY_VERSION_HEX >= 0x030600B1 && flag == METH_FASTCALL) {
+            if (PY_VERSION_HEX >= 0x030700A0) {
+                return (*(__Pyx_PyCFunctionFast)(void*)(PyCFunction)cfunc->func)(self, &arg, 1);
+            } else {
+                return (*(__Pyx_PyCFunctionFastWithKeywords)(void*)(PyCFunction)cfunc->func)(self, &arg, 1, NULL);
+            }
+        } else if (PY_VERSION_HEX >= 0x030700A0 && flag == (METH_FASTCALL | METH_KEYWORDS)) {
+            return (*(__Pyx_PyCFunctionFastWithKeywords)(void*)(PyCFunction)cfunc->func)(self, &arg, 1, NULL);
+        }
+    }
+    return __Pyx__CallUnboundCMethod1(cfunc, self, arg);
+}
+#endif
+static PyObject* __Pyx__CallUnboundCMethod1(__Pyx_CachedCFunction* cfunc, PyObject* self, PyObject* arg){
     PyObject *args, *result = NULL;
-    #if CYTHON_FAST_PYCALL
-    if (PyFunction_Check(function)) {
-        PyObject *args[2] = {arg1, arg2};
-        return __Pyx_PyFunction_FastCall(function, args, 2);
+    if (unlikely(!cfunc->func && !cfunc->method) && unlikely(__Pyx_TryUnpackUnboundCMethod(cfunc) < 0)) return NULL;
+#if CYTHON_COMPILING_IN_CPYTHON
+    if (cfunc->func && (cfunc->flag & METH_VARARGS)) {
+        args = PyTuple_New(1);
+        if (unlikely(!args)) goto bad;
+        Py_INCREF(arg);
+        PyTuple_SET_ITEM(args, 0, arg);
+        if (cfunc->flag & METH_KEYWORDS)
+            result = (*(PyCFunctionWithKeywords)(void*)(PyCFunction)cfunc->func)(self, args, NULL);
+        else
+            result = (*cfunc->func)(self, args);
+    } else {
+        args = PyTuple_New(2);
+        if (unlikely(!args)) goto bad;
+        Py_INCREF(self);
+        PyTuple_SET_ITEM(args, 0, self);
+        Py_INCREF(arg);
+        PyTuple_SET_ITEM(args, 1, arg);
+        result = __Pyx_PyObject_Call(cfunc->method, args, NULL);
+    }
+#else
+    args = PyTuple_Pack(2, self, arg);
+    if (unlikely(!args)) goto bad;
+    result = __Pyx_PyObject_Call(cfunc->method, args, NULL);
+#endif
+bad:
+    Py_XDECREF(args);
+    return result;
+}
+
+/* StringJoin */
+#if !CYTHON_COMPILING_IN_CPYTHON
+static CYTHON_INLINE PyObject* __Pyx_PyBytes_Join(PyObject* sep, PyObject* values) {
+    return PyObject_CallMethodObjArgs(sep, __pyx_n_s_join, values, NULL);
+}
+#endif
+
+/* GetException */
+#if CYTHON_FAST_THREAD_STATE
+static int __Pyx__GetException(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb)
+#else
+static int __Pyx_GetException(PyObject **type, PyObject **value, PyObject **tb)
+#endif
+{
+    PyObject *local_type, *local_value, *local_tb;
+#if CYTHON_FAST_THREAD_STATE
+    PyObject *tmp_type, *tmp_value, *tmp_tb;
+    local_type = tstate->curexc_type;
+    local_value = tstate->curexc_value;
+    local_tb = tstate->curexc_traceback;
+    tstate->curexc_type = 0;
+    tstate->curexc_value = 0;
+    tstate->curexc_traceback = 0;
+#else
+    PyErr_Fetch(&local_type, &local_value, &local_tb);
+#endif
+    PyErr_NormalizeException(&local_type, &local_value, &local_tb);
+#if CYTHON_FAST_THREAD_STATE
+    if (unlikely(tstate->curexc_type))
+#else
+    if (unlikely(PyErr_Occurred()))
+#endif
+        goto bad;
+    #if PY_MAJOR_VERSION >= 3
+    if (local_tb) {
+        if (unlikely(PyException_SetTraceback(local_value, local_tb) < 0))
+            goto bad;
     }
     #endif
-    #if CYTHON_FAST_PYCCALL
-    if (__Pyx_PyFastCFunction_Check(function)) {
-        PyObject *args[2] = {arg1, arg2};
-        return __Pyx_PyCFunction_FastCall(function, args, 2);
+    Py_XINCREF(local_tb);
+    Py_XINCREF(local_type);
+    Py_XINCREF(local_value);
+    *type = local_type;
+    *value = local_value;
+    *tb = local_tb;
+#if CYTHON_FAST_THREAD_STATE
+    #if CYTHON_USE_EXC_INFO_STACK
+    {
+        _PyErr_StackItem *exc_info = tstate->exc_info;
+        tmp_type = exc_info->exc_type;
+        tmp_value = exc_info->exc_value;
+        tmp_tb = exc_info->exc_traceback;
+        exc_info->exc_type = local_type;
+        exc_info->exc_value = local_value;
+        exc_info->exc_traceback = local_tb;
     }
+    #else
+    tmp_type = tstate->exc_type;
+    tmp_value = tstate->exc_value;
+    tmp_tb = tstate->exc_traceback;
+    tstate->exc_type = local_type;
+    tstate->exc_value = local_value;
+    tstate->exc_traceback = local_tb;
     #endif
-    args = PyTuple_New(2);
-    if (unlikely(!args)) goto done;
-    Py_INCREF(arg1);
-    PyTuple_SET_ITEM(args, 0, arg1);
-    Py_INCREF(arg2);
-    PyTuple_SET_ITEM(args, 1, arg2);
-    Py_INCREF(function);
-    result = __Pyx_PyObject_Call(function, args, NULL);
-    Py_DECREF(args);
-    Py_DECREF(function);
-done:
-    return result;
+    Py_XDECREF(tmp_type);
+    Py_XDECREF(tmp_value);
+    Py_XDECREF(tmp_tb);
+#else
+    PyErr_SetExcInfo(local_type, local_value, local_tb);
+#endif
+    return 0;
+bad:
+    *type = 0;
+    *value = 0;
+    *tb = 0;
+    Py_XDECREF(local_type);
+    Py_XDECREF(local_value);
+    Py_XDECREF(local_tb);
+    return -1;
+}
+
+/* SwapException */
+#if CYTHON_FAST_THREAD_STATE
+static CYTHON_INLINE void __Pyx__ExceptionSwap(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb) {
+    PyObject *tmp_type, *tmp_value, *tmp_tb;
+    #if CYTHON_USE_EXC_INFO_STACK
+    _PyErr_StackItem *exc_info = tstate->exc_info;
+    tmp_type = exc_info->exc_type;
+    tmp_value = exc_info->exc_value;
+    tmp_tb = exc_info->exc_traceback;
+    exc_info->exc_type = *type;
+    exc_info->exc_value = *value;
+    exc_info->exc_traceback = *tb;
+    #else
+    tmp_type = tstate->exc_type;
+    tmp_value = tstate->exc_value;
+    tmp_tb = tstate->exc_traceback;
+    tstate->exc_type = *type;
+    tstate->exc_value = *value;
+    tstate->exc_traceback = *tb;
+    #endif
+    *type = tmp_type;
+    *value = tmp_value;
+    *tb = tmp_tb;
+}
+#else
+static CYTHON_INLINE void __Pyx_ExceptionSwap(PyObject **type, PyObject **value, PyObject **tb) {
+    PyObject *tmp_type, *tmp_value, *tmp_tb;
+    PyErr_GetExcInfo(&tmp_type, &tmp_value, &tmp_tb);
+    PyErr_SetExcInfo(*type, *value, *tb);
+    *type = tmp_type;
+    *value = tmp_value;
+    *tb = tmp_tb;
+}
+#endif
+
+/* GetTopmostException */
+#if CYTHON_USE_EXC_INFO_STACK
+static _PyErr_StackItem *
+__Pyx_PyErr_GetTopmostException(PyThreadState *tstate)
+{
+    _PyErr_StackItem *exc_info = tstate->exc_info;
+    while ((exc_info->exc_type == NULL || exc_info->exc_type == Py_None) &&
+           exc_info->previous_item != NULL)
+    {
+        exc_info = exc_info->previous_item;
+    }
+    return exc_info;
 }
+#endif
+
+/* SaveResetException */
+#if CYTHON_FAST_THREAD_STATE
+static CYTHON_INLINE void __Pyx__ExceptionSave(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb) {
+    #if CYTHON_USE_EXC_INFO_STACK
+    _PyErr_StackItem *exc_info = __Pyx_PyErr_GetTopmostException(tstate);
+    *type = exc_info->exc_type;
+    *value = exc_info->exc_value;
+    *tb = exc_info->exc_traceback;
+    #else
+    *type = tstate->exc_type;
+    *value = tstate->exc_value;
+    *tb = tstate->exc_traceback;
+    #endif
+    Py_XINCREF(*type);
+    Py_XINCREF(*value);
+    Py_XINCREF(*tb);
+}
+static CYTHON_INLINE void __Pyx__ExceptionReset(PyThreadState *tstate, PyObject *type, PyObject *value, PyObject *tb) {
+    PyObject *tmp_type, *tmp_value, *tmp_tb;
+    #if CYTHON_USE_EXC_INFO_STACK
+    _PyErr_StackItem *exc_info = tstate->exc_info;
+    tmp_type = exc_info->exc_type;
+    tmp_value = exc_info->exc_value;
+    tmp_tb = exc_info->exc_traceback;
+    exc_info->exc_type = type;
+    exc_info->exc_value = value;
+    exc_info->exc_traceback = tb;
+    #else
+    tmp_type = tstate->exc_type;
+    tmp_value = tstate->exc_value;
+    tmp_tb = tstate->exc_traceback;
+    tstate->exc_type = type;
+    tstate->exc_value = value;
+    tstate->exc_traceback = tb;
+    #endif
+    Py_XDECREF(tmp_type);
+    Py_XDECREF(tmp_value);
+    Py_XDECREF(tmp_tb);
+}
+#endif
 
 /* PyObject_GenericGetAttrNoDict */
 #if CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP && PY_VERSION_HEX < 0x03070000
 static PyObject *__Pyx_RaiseGenericGetAttributeError(PyTypeObject *tp, PyObject *attr_name) {
     PyErr_Format(PyExc_AttributeError,
 #if PY_MAJOR_VERSION >= 3
                  "'%.50s' object has no attribute '%U'",
@@ -10901,15 +11181,15 @@
       } else {
         PyErr_Clear();
         use_cline = NULL;
       }
     }
     if (!use_cline) {
         c_line = 0;
-        PyObject_SetAttr(__pyx_cython_runtime, __pyx_n_s_cline_in_traceback, Py_False);
+        (void) PyObject_SetAttr(__pyx_cython_runtime, __pyx_n_s_cline_in_traceback, Py_False);
     }
     else if (use_cline == Py_False || (use_cline != Py_True && PyObject_Not(use_cline) != 0)) {
         c_line = 0;
     }
     __Pyx_ErrRestoreInState(tstate, ptype, pvalue, ptraceback);
     return c_line;
 }
@@ -10998,38 +11278,39 @@
 /* AddTraceback */
 #include "compile.h"
 #include "frameobject.h"
 #include "traceback.h"
 static PyCodeObject* __Pyx_CreateCodeObjectForTraceback(
             const char *funcname, int c_line,
             int py_line, const char *filename) {
-    PyCodeObject *py_code = 0;
-    PyObject *py_srcfile = 0;
-    PyObject *py_funcname = 0;
+    PyCodeObject *py_code = NULL;
+    PyObject *py_funcname = NULL;
     #if PY_MAJOR_VERSION < 3
+    PyObject *py_srcfile = NULL;
     py_srcfile = PyString_FromString(filename);
-    #else
-    py_srcfile = PyUnicode_FromString(filename);
-    #endif
     if (!py_srcfile) goto bad;
+    #endif
     if (c_line) {
         #if PY_MAJOR_VERSION < 3
         py_funcname = PyString_FromFormat( "%s (%s:%d)", funcname, __pyx_cfilenm, c_line);
+        if (!py_funcname) goto bad;
         #else
         py_funcname = PyUnicode_FromFormat( "%s (%s:%d)", funcname, __pyx_cfilenm, c_line);
+        if (!py_funcname) goto bad;
+        funcname = PyUnicode_AsUTF8(py_funcname);
+        if (!funcname) goto bad;
         #endif
     }
     else {
         #if PY_MAJOR_VERSION < 3
         py_funcname = PyString_FromString(funcname);
-        #else
-        py_funcname = PyUnicode_FromString(funcname);
+        if (!py_funcname) goto bad;
         #endif
     }
-    if (!py_funcname) goto bad;
+    #if PY_MAJOR_VERSION < 3
     py_code = __Pyx_PyCode_New(
         0,
         0,
         0,
         0,
         0,
         __pyx_empty_bytes, /*PyObject *code,*/
@@ -11040,19 +11321,24 @@
         __pyx_empty_tuple, /*PyObject *cellvars,*/
         py_srcfile,   /*PyObject *filename,*/
         py_funcname,  /*PyObject *name,*/
         py_line,
         __pyx_empty_bytes  /*PyObject *lnotab*/
     );
     Py_DECREF(py_srcfile);
-    Py_DECREF(py_funcname);
+    #else
+    py_code = PyCode_NewEmpty(filename, funcname, py_line);
+    #endif
+    Py_XDECREF(py_funcname);  // XDECREF since it's only set on Py3 if cline
     return py_code;
 bad:
-    Py_XDECREF(py_srcfile);
     Py_XDECREF(py_funcname);
+    #if PY_MAJOR_VERSION < 3
+    Py_XDECREF(py_srcfile);
+    #endif
     return NULL;
 }
 static void __Pyx_AddTraceback(const char *funcname, int c_line,
                                int py_line, const char *filename) {
     PyCodeObject *py_code = 0;
     PyFrameObject *py_frame = 0;
     PyThreadState *tstate = __Pyx_PyThreadState_Current;
@@ -12256,104 +12542,42 @@
     }
 bad:
     Py_XDECREF(owned_instance);
     return;
 }
 #endif
 
-/* GetTopmostException */
-#if CYTHON_USE_EXC_INFO_STACK
-static _PyErr_StackItem *
-__Pyx_PyErr_GetTopmostException(PyThreadState *tstate)
-{
-    _PyErr_StackItem *exc_info = tstate->exc_info;
-    while ((exc_info->exc_type == NULL || exc_info->exc_type == Py_None) &&
-           exc_info->previous_item != NULL)
-    {
-        exc_info = exc_info->previous_item;
+/* PyObjectCall2Args */
+static CYTHON_UNUSED PyObject* __Pyx_PyObject_Call2Args(PyObject* function, PyObject* arg1, PyObject* arg2) {
+    PyObject *args, *result = NULL;
+    #if CYTHON_FAST_PYCALL
+    if (PyFunction_Check(function)) {
+        PyObject *args[2] = {arg1, arg2};
+        return __Pyx_PyFunction_FastCall(function, args, 2);
     }
-    return exc_info;
-}
-#endif
-
-/* SaveResetException */
-#if CYTHON_FAST_THREAD_STATE
-static CYTHON_INLINE void __Pyx__ExceptionSave(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb) {
-    #if CYTHON_USE_EXC_INFO_STACK
-    _PyErr_StackItem *exc_info = __Pyx_PyErr_GetTopmostException(tstate);
-    *type = exc_info->exc_type;
-    *value = exc_info->exc_value;
-    *tb = exc_info->exc_traceback;
-    #else
-    *type = tstate->exc_type;
-    *value = tstate->exc_value;
-    *tb = tstate->exc_traceback;
     #endif
-    Py_XINCREF(*type);
-    Py_XINCREF(*value);
-    Py_XINCREF(*tb);
-}
-static CYTHON_INLINE void __Pyx__ExceptionReset(PyThreadState *tstate, PyObject *type, PyObject *value, PyObject *tb) {
-    PyObject *tmp_type, *tmp_value, *tmp_tb;
-    #if CYTHON_USE_EXC_INFO_STACK
-    _PyErr_StackItem *exc_info = tstate->exc_info;
-    tmp_type = exc_info->exc_type;
-    tmp_value = exc_info->exc_value;
-    tmp_tb = exc_info->exc_traceback;
-    exc_info->exc_type = type;
-    exc_info->exc_value = value;
-    exc_info->exc_traceback = tb;
-    #else
-    tmp_type = tstate->exc_type;
-    tmp_value = tstate->exc_value;
-    tmp_tb = tstate->exc_traceback;
-    tstate->exc_type = type;
-    tstate->exc_value = value;
-    tstate->exc_traceback = tb;
-    #endif
-    Py_XDECREF(tmp_type);
-    Py_XDECREF(tmp_value);
-    Py_XDECREF(tmp_tb);
-}
-#endif
-
-/* SwapException */
-#if CYTHON_FAST_THREAD_STATE
-static CYTHON_INLINE void __Pyx__ExceptionSwap(PyThreadState *tstate, PyObject **type, PyObject **value, PyObject **tb) {
-    PyObject *tmp_type, *tmp_value, *tmp_tb;
-    #if CYTHON_USE_EXC_INFO_STACK
-    _PyErr_StackItem *exc_info = tstate->exc_info;
-    tmp_type = exc_info->exc_type;
-    tmp_value = exc_info->exc_value;
-    tmp_tb = exc_info->exc_traceback;
-    exc_info->exc_type = *type;
-    exc_info->exc_value = *value;
-    exc_info->exc_traceback = *tb;
-    #else
-    tmp_type = tstate->exc_type;
-    tmp_value = tstate->exc_value;
-    tmp_tb = tstate->exc_traceback;
-    tstate->exc_type = *type;
-    tstate->exc_value = *value;
-    tstate->exc_traceback = *tb;
+    #if CYTHON_FAST_PYCCALL
+    if (__Pyx_PyFastCFunction_Check(function)) {
+        PyObject *args[2] = {arg1, arg2};
+        return __Pyx_PyCFunction_FastCall(function, args, 2);
+    }
     #endif
-    *type = tmp_type;
-    *value = tmp_value;
-    *tb = tmp_tb;
-}
-#else
-static CYTHON_INLINE void __Pyx_ExceptionSwap(PyObject **type, PyObject **value, PyObject **tb) {
-    PyObject *tmp_type, *tmp_value, *tmp_tb;
-    PyErr_GetExcInfo(&tmp_type, &tmp_value, &tmp_tb);
-    PyErr_SetExcInfo(*type, *value, *tb);
-    *type = tmp_type;
-    *value = tmp_value;
-    *tb = tmp_tb;
+    args = PyTuple_New(2);
+    if (unlikely(!args)) goto done;
+    Py_INCREF(arg1);
+    PyTuple_SET_ITEM(args, 0, arg1);
+    Py_INCREF(arg2);
+    PyTuple_SET_ITEM(args, 1, arg2);
+    Py_INCREF(function);
+    result = __Pyx_PyObject_Call(function, args, NULL);
+    Py_DECREF(args);
+    Py_DECREF(function);
+done:
+    return result;
 }
-#endif
 
 /* PyObjectGetMethod */
 static int __Pyx_PyObject_GetMethod(PyObject *obj, PyObject *name, PyObject **method) {
     PyObject *attr;
 #if CYTHON_UNPACK_METHODS && CYTHON_COMPILING_IN_CPYTHON && CYTHON_USE_PYTYPE_LOOKUP
     PyTypeObject *tp = Py_TYPE(obj);
     PyObject *descr;
@@ -12635,17 +12859,21 @@
     exc_state = &self->gi_exc_state;
     if (exc_state->exc_type) {
         #if CYTHON_COMPILING_IN_PYPY || CYTHON_COMPILING_IN_PYSTON
         #else
         if (exc_state->exc_traceback) {
             PyTracebackObject *tb = (PyTracebackObject *) exc_state->exc_traceback;
             PyFrameObject *f = tb->tb_frame;
-            Py_XINCREF(tstate->frame);
             assert(f->f_back == NULL);
+            #if PY_VERSION_HEX >= 0x030B00A1
+            f->f_back = PyThreadState_GetFrame(tstate);
+            #else
+            Py_XINCREF(tstate->frame);
             f->f_back = tstate->frame;
+            #endif
         }
         #endif
     }
 #if CYTHON_USE_EXC_INFO_STACK
     exc_state->previous_item = tstate->exc_info;
     tstate->exc_info = exc_state;
 #else
@@ -13431,14 +13659,17 @@
 #endif
 #if PY_VERSION_HEX >= 0x030800b1
     0,
 #endif
 #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
     0,
 #endif
+#if PY_VERSION_HEX >= 0x030B00A2
+    0,
+#endif
 };
 static int __pyx_Generator_init(void) {
     __pyx_GeneratorType_type.tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
     __pyx_GeneratorType_type.tp_iter = PyObject_SelfIter;
     __pyx_GeneratorType = __Pyx_FetchCommonType(&__pyx_GeneratorType_type);
     if (unlikely(!__pyx_GeneratorType)) {
         return -1;
@@ -13760,14 +13991,31 @@
   }
   x = PyNumber_Index(b);
   if (!x) return -1;
   ival = PyInt_AsSsize_t(x);
   Py_DECREF(x);
   return ival;
 }
+static CYTHON_INLINE Py_hash_t __Pyx_PyIndex_AsHash_t(PyObject* o) {
+  if (sizeof(Py_hash_t) == sizeof(Py_ssize_t)) {
+    return (Py_hash_t) __Pyx_PyIndex_AsSsize_t(o);
+#if PY_MAJOR_VERSION < 3
+  } else if (likely(PyInt_CheckExact(o))) {
+    return PyInt_AS_LONG(o);
+#endif
+  } else {
+    Py_ssize_t ival;
+    PyObject *x;
+    x = PyNumber_Index(o);
+    if (!x) return -1;
+    ival = PyInt_AsLong(x);
+    Py_DECREF(x);
+    return ival;
+  }
+}
 static CYTHON_INLINE PyObject * __Pyx_PyBool_FromLong(long b) {
   return b ? __Pyx_NewRef(Py_True) : __Pyx_NewRef(Py_False);
 }
 static CYTHON_INLINE PyObject * __Pyx_PyInt_FromSize_t(size_t ival) {
     return PyInt_FromSize_t(ival);
 }
```

### Comparing `Resiliparse-0.8.1/resiliparse/extract/html2text.pxd` & `Resiliparse-0.9.0/resiliparse/extract/html2text.pxd`

 * *Files identical despite different names*

### Comparing `Resiliparse-0.8.1/resiliparse/extract/html2text.pyx` & `Resiliparse-0.9.0/resiliparse/extract/html2text.pyx`

 * *Files 8% similar despite different names*

```diff
@@ -12,14 +12,15 @@
 # See the License for the specific language governing permissions and
 # limitations under the License.
 
 # distutils: language = c++
 
 from cython.operator cimport preincrement as preinc, predecrement as predec
 from libc.stdint cimport uint32_t
+from libcpp.set cimport set as stl_set
 from libc.string cimport memcpy
 from libcpp.string cimport string, to_string
 from libcpp.vector cimport vector
 
 from resiliparse_common.string_util cimport rstrip_str, strip_str
 from resiliparse_inc.cctype cimport isspace
 from resiliparse.parse.html cimport *
@@ -42,14 +43,15 @@
     lxb_dom_node_t* node
     size_t depth
     size_t list_depth
     size_t pre_depth
     vector[size_t] list_numbering
     size_t space_before_next_block
     size_t newline_before_next_block
+    size_t tab_before_next_block
     size_t lstrip_next_block
     vector[string] text
     ExtractOpts opts
 
 
 cdef string _get_collapsed_string(const string_view& input_str, ExtractContext* ctx) nogil:
     """
@@ -103,15 +105,18 @@
         # Add an additional two spaces if element is not the li element itself or a direct text child
         element_text.append(b'  ')
 
 
 cdef inline void _add_space(ExtractContext* ctx) nogil:
     """Add space if last character is a non-space character."""
     if not ctx.text.empty() and not isspace(ctx.text.back().back()):
-        ctx.text.back().push_back(<char>b' ')
+        if ctx.tab_before_next_block:
+            ctx.text.back().append(<char*>b'\t\t')
+        else:
+            ctx.text.back().push_back(<char>b' ')
 
 
 cdef inline void _make_block(ExtractContext* ctx) nogil:
     """Make a block start or end by inserting the needed number of linefeeds."""
 
     # Strip previous linefeeds to prevent excess empty lines
     while not ctx.text.empty() and isspace(ctx.text.back().back()):
@@ -147,15 +152,15 @@
 
     cdef string element_text = strip_str(get_node_text(node))
     if element_text.size() > 3:
         return False
 
     # Pilcrow character (probably an anchor link)
     if element_text == b'\xc2\xb6':
-        return False
+        return True
 
     # BMP private use area (probably an icon font)
     cdef uint32_t cp = 0
     if element_text.size() == 3:
         memcpy(&cp, element_text.data(), 3 * sizeof(char))
         if 0x8080ee <= cp <= 0xbfa3ef:
             return True
@@ -167,24 +172,25 @@
     """Extraction start element callback."""
     cdef lxb_dom_character_data_t* node_char_data = NULL
     cdef string_view node_attr_data
     cdef string element_text
     cdef size_t i
 
     if ctx.node.type == LXB_DOM_NODE_TYPE_TEXT:
-        if ctx.space_before_next_block:
+        if ctx.space_before_next_block or ctx.tab_before_next_block:
             _add_space(ctx)
 
         node_char_data = <lxb_dom_character_data_t*>ctx.node
         element_text.append(<const char*>node_char_data.data.data, node_char_data.data.length)
         element_text = _get_collapsed_string(<string_view>element_text, ctx)
         if not rstrip_str(element_text).empty():
             ctx.newline_before_next_block = False
             ctx.lstrip_next_block = False
             ctx.space_before_next_block = False
+            ctx.tab_before_next_block = False
             ctx.text.push_back(move(element_text))
         else:
             _add_space(ctx)
         return
 
     if ctx.node.type != LXB_DOM_NODE_TYPE_ELEMENT:
         return
@@ -297,21 +303,24 @@
     # Forms
     if ctx.opts.form_fields and ctx.node.local_name in [LXB_TAG_TEXTAREA, LXB_TAG_BUTTON]:
         ctx.pre_depth -= <int>ctx.node.local_name == LXB_TAG_TEXTAREA
         if not isspace(ctx.text.back().back()):
             ctx.text.back().push_back(b' ')
         ctx.text.back().append(b'] ')
 
-    # Add tabs between table cells
+    # Strip whitespace between table cells
     if ctx.node.local_name in [LXB_TAG_TD, LXB_TAG_TH]:
-        ctx.text.back().append(b'\t\t')
+        ctx.tab_before_next_block = True
+        ctx.lstrip_next_block = True
 
     # No additional white space after table rows
     if ctx.node.local_name == LXB_TAG_TR and not ctx.text.empty():
+        ctx.tab_before_next_block = False
         ctx.newline_before_next_block = False
+        ctx.lstrip_next_block = False
 
     # Link targets
     cdef string_view link_href
     if ctx.opts.links and ctx.node.local_name == LXB_TAG_A:
         link_href = get_node_attr_sv(ctx.node, b'href')
         if not link_href.empty():
             if not isspace(ctx.text.back().back()):
@@ -494,17 +503,23 @@
     # Modals
     if regex_search_not_empty(cls_and_id_attr, modal_cls_regex):
         return False
 
     return True
 
 
-def extract_plain_text(DOMNode base_node, bint preserve_formatting=True, bint main_content=False, bint list_bullets=True,
-                       bint alt_texts=True, bint links=False, bint form_fields=False, bint noscript=False,
-                       skip_elements=None):
+cdef inline lxb_status_t _blacklist_select_cb(lxb_dom_node_t *node,
+                                              lxb_css_selector_specificity_t *spec, void *ctx) nogil:
+    (<stl_set[lxb_dom_node_t*]*>ctx).insert(node)
+    return LXB_STATUS_OK
+
+
+def extract_plain_text(DOMNode base_node, bint preserve_formatting=True, bint main_content=False,
+                       bint list_bullets=True,  bint alt_texts=True, bint links=False, bint form_fields=False,
+                       bint noscript=False, skip_elements=None):
     """
     extract_plain_text(base_node, preserve_formatting=True, preserve_formatting=True, main_content=False, \
         list_bullets=True, alt_texts=False, links=True, form_fields=False, noscript=False, skip_elements=None)
 
     Perform a simple plain-text extraction from the given DOM node and its children.
 
     Extracts all visible text (excluding script/style elements, comment nodes etc.)
@@ -527,85 +542,99 @@
     :param alt_texts: preserve alternative text descriptions
     :type alt_texts: bool
     :param links: extract link target URLs
     :type links: bool
     :param form_fields: extract form fields and their values
     :type form_fields: bool
     :param noscript: extract contents of <noscript> elements
-    :param skip_elements: names of elements to skip (defaults to ``head``, ``script``, ``style``)
+    :param skip_elements: list of CSS selectors for elements to skip (defaults to ``head``, ``script``, ``style``)
     :type skip_elements: t.Iterable[str] or None
     :type noscript: bool
     :return: extracted plain text
     :rtype: str
     """
     if not check_node(base_node):
         return ''
 
-    skip_elements = {e.encode() for e in skip_elements or []}
-    if not skip_elements:
-        skip_elements = {b'head', b'script', b'style'}
+    skip_selectors = {e.encode() for e in skip_elements or []}
+    skip_selectors.update({b'script', b'style'})
     if not alt_texts:
-        skip_elements.update({b'object', b'video', b'audio', b'embed' b'img', b'area'})
+        skip_selectors.update({b'object', b'video', b'audio', b'embed' b'img', b'area'})
     if not noscript:
-        skip_elements.add(b'noscript')
+        skip_selectors.add(b'noscript')
     if not form_fields:
-        skip_elements.update({b'textarea', b'input', b'button'})
+        skip_selectors.update({b'textarea', b'input', b'button'})
 
     cdef ExtractContext ctx
     ctx.root_node = base_node.node
     ctx.depth = 0
     ctx.list_depth = 0
     ctx.pre_depth = 0
     ctx.space_before_next_block = False
     ctx.newline_before_next_block = False
+    ctx.tab_before_next_block = False
     ctx.lstrip_next_block = False
     ctx.opts = [
         preserve_formatting,
         list_bullets,
         links,
         alt_texts,
         form_fields,
         noscript]
 
     ctx.node = base_node.node
 
-    cdef vector[string] skip_elements_vec = list(skip_elements)
     cdef const lxb_char_t* tag_name = NULL
     cdef size_t tag_name_len
     cdef string tag_name_str
     cdef size_t i
     cdef bint skip = False
     cdef bint is_end_tag = False
 
     if ctx.node.type == LXB_DOM_NODE_TYPE_DOCUMENT:
         ctx.root_node = next_element_node(ctx.node, ctx.node.first_child)
         ctx.node = ctx.root_node
 
+    cdef lxb_css_parser_t* css_parser = NULL
+    cdef lxb_css_selectors_t* css_selectors = NULL
+    cdef lxb_selectors_t* selectors = NULL
+
+    cdef lxb_css_selector_list_t* selector_list = NULL
+    cdef stl_set[lxb_dom_node_t*] node_blacklist
+    try:
+        # Select all blacklisted elements and save them in an ordered set
+        init_css_parser(&css_parser)
+        init_css_selectors(css_parser, &css_selectors, &selectors)
+        combined_skip_sel = b','.join(skip_selectors)
+        selector_list = parse_css_selectors(css_parser, <lxb_char_t*>combined_skip_sel, len(combined_skip_sel))
+        lxb_selectors_find(selectors, ctx.root_node, selector_list,
+                           <lxb_selectors_cb_f>_blacklist_select_cb, &node_blacklist)
+    finally:
+        destroy_css_selectors(css_selectors, selectors)
+        destroy_css_parser(css_parser)
+
     with nogil:
         while ctx.node:
             # Skip everything except element and text nodes
             if ctx.node.type != LXB_DOM_NODE_TYPE_ELEMENT and ctx.node.type != LXB_DOM_NODE_TYPE_TEXT:
                 is_end_tag = True
                 ctx.node = next_node(ctx.root_node, ctx.node, &ctx.depth, &is_end_tag)
                 continue
 
-            # Skip unwanted element nodes
-            if ctx.node.type == LXB_DOM_NODE_TYPE_ELEMENT:
-                tag_name = lxb_dom_element_qualified_name(<lxb_dom_element_t*>ctx.node, &tag_name_len)
-                tag_name_str = string(<const char*>tag_name, tag_name_len)
-                skip = False
-                for i in range(skip_elements_vec.size()):
-                    if skip_elements_vec[i] == tag_name_str:
-                        skip = True
-                        break
-
-                if skip or (main_content and not _is_main_content_node(ctx.node)):
-                    is_end_tag = True
-                    ctx.node = next_node(ctx.root_node, ctx.node, &ctx.depth, &is_end_tag)
-                    continue
+            if ctx.node.local_name == LXB_TAG_HEAD:
+                is_end_tag = True
+                ctx.node = next_node(ctx.root_node, ctx.node, &ctx.depth, &is_end_tag)
+                continue
+
+            # Skip blacklisted or non-main-content nodes
+            if node_blacklist.find(ctx.node) != node_blacklist.end() or \
+                    (main_content and not _is_main_content_node(ctx.node)):
+                is_end_tag = True
+                ctx.node = next_node(ctx.root_node, ctx.node, &ctx.depth, &is_end_tag)
+                continue
 
             if not is_end_tag:
                 _extract_start_cb(&ctx)
             else:
                 _extract_end_cb(&ctx)
 
             ctx.node = next_node(ctx.root_node, ctx.node, &ctx.depth, &is_end_tag)
```

### Comparing `Resiliparse-0.8.1/resiliparse/itertools.cpp` & `Resiliparse-0.9.0/resiliparse/itertools.cpp`

 * *Files 2% similar despite different names*

```diff
@@ -1,8 +1,8 @@
-/* Generated by Cython 0.29.24 */
+/* Generated by Cython 0.29.25 */
 
 /* BEGIN: Cython Metadata
 {
     "distutils": {
         "depends": [],
         "extra_compile_args": [
             "-std=c++17",
@@ -31,16 +31,16 @@
 #endif /* PY_SSIZE_T_CLEAN */
 #include "Python.h"
 #ifndef Py_PYTHON_H
     #error Python headers needed to compile C extensions, please install development version of Python.
 #elif PY_VERSION_HEX < 0x02060000 || (0x03000000 <= PY_VERSION_HEX && PY_VERSION_HEX < 0x03030000)
     #error Cython requires Python 2.6+ or Python 3.3+.
 #else
-#define CYTHON_ABI "0_29_24"
-#define CYTHON_HEX_VERSION 0x001D18F0
+#define CYTHON_ABI "0_29_25"
+#define CYTHON_HEX_VERSION 0x001D19F0
 #define CYTHON_FUTURE_DIVISION 1
 #include <stddef.h>
 #ifndef offsetof
   #define offsetof(type, member) ( (size_t) & ((type*)0) -> member )
 #endif
 #if !defined(WIN32) && !defined(MS_WINDOWS)
   #ifndef __stdcall
@@ -179,15 +179,15 @@
   #endif
   #ifndef CYTHON_USE_PYLIST_INTERNALS
     #define CYTHON_USE_PYLIST_INTERNALS 1
   #endif
   #ifndef CYTHON_USE_UNICODE_INTERNALS
     #define CYTHON_USE_UNICODE_INTERNALS 1
   #endif
-  #if PY_VERSION_HEX < 0x030300F0
+  #if PY_VERSION_HEX < 0x030300F0 || PY_VERSION_HEX >= 0x030B00A2
     #undef CYTHON_USE_UNICODE_WRITER
     #define CYTHON_USE_UNICODE_WRITER 0
   #elif !defined(CYTHON_USE_UNICODE_WRITER)
     #define CYTHON_USE_UNICODE_WRITER 1
   #endif
   #ifndef CYTHON_AVOID_BORROWED_REFS
     #define CYTHON_AVOID_BORROWED_REFS 0
@@ -198,15 +198,15 @@
   #ifndef CYTHON_UNPACK_METHODS
     #define CYTHON_UNPACK_METHODS 1
   #endif
   #ifndef CYTHON_FAST_THREAD_STATE
     #define CYTHON_FAST_THREAD_STATE 1
   #endif
   #ifndef CYTHON_FAST_PYCALL
-    #define CYTHON_FAST_PYCALL 1
+    #define CYTHON_FAST_PYCALL (PY_VERSION_HEX < 0x030B00A1)
   #endif
   #ifndef CYTHON_PEP489_MULTI_PHASE_INIT
     #define CYTHON_PEP489_MULTI_PHASE_INIT (PY_VERSION_HEX >= 0x03050000)
   #endif
   #ifndef CYTHON_USE_TP_FINALIZE
     #define CYTHON_USE_TP_FINALIZE (PY_VERSION_HEX >= 0x030400a1)
   #endif
@@ -217,15 +217,17 @@
     #define CYTHON_USE_EXC_INFO_STACK (PY_VERSION_HEX >= 0x030700A3)
   #endif
 #endif
 #if !defined(CYTHON_FAST_PYCCALL)
 #define CYTHON_FAST_PYCCALL  (CYTHON_FAST_PYCALL && PY_VERSION_HEX >= 0x030600B1)
 #endif
 #if CYTHON_USE_PYLONG_INTERNALS
-  #include "longintrepr.h"
+  #if PY_MAJOR_VERSION < 3
+    #include "longintrepr.h"
+  #endif
   #undef SHIFT
   #undef BASE
   #undef MASK
   #ifdef SIZEOF_VOID_P
     enum { __pyx_check_sizeof_voidp = 1 / (int)(SIZEOF_VOID_P == sizeof(void*)) };
   #endif
 #endif
@@ -348,17 +350,76 @@
 #if PY_MAJOR_VERSION < 3
   #define __Pyx_BUILTIN_MODULE_NAME "__builtin__"
   #define __Pyx_PyCode_New(a, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)\
           PyCode_New(a+k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)
   #define __Pyx_DefaultClassType PyClass_Type
 #else
   #define __Pyx_BUILTIN_MODULE_NAME "builtins"
-#if PY_VERSION_HEX >= 0x030800A4 && PY_VERSION_HEX < 0x030800B2
-  #define __Pyx_PyCode_New(a, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)\
-          PyCode_New(a, 0, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)
+  #define __Pyx_DefaultClassType PyType_Type
+#if PY_VERSION_HEX >= 0x030B00A1
+    static CYTHON_INLINE PyCodeObject* __Pyx_PyCode_New(int a, int k, int l, int s, int f,
+                                                    PyObject *code, PyObject *c, PyObject* n, PyObject *v,
+                                                    PyObject *fv, PyObject *cell, PyObject* fn,
+                                                    PyObject *name, int fline, PyObject *lnos) {
+        PyObject *kwds=NULL, *argcount=NULL, *posonlyargcount=NULL, *kwonlyargcount=NULL;
+        PyObject *nlocals=NULL, *stacksize=NULL, *flags=NULL, *replace=NULL, *call_result=NULL, *empty=NULL;
+        const char *fn_cstr=NULL;
+        const char *name_cstr=NULL;
+        PyCodeObject* co=NULL;
+        PyObject *type, *value, *traceback;
+        PyErr_Fetch(&type, &value, &traceback);
+        if (!(kwds=PyDict_New())) goto end;
+        if (!(argcount=PyLong_FromLong(a))) goto end;
+        if (PyDict_SetItemString(kwds, "co_argcount", argcount) != 0) goto end;
+        if (!(posonlyargcount=PyLong_FromLong(0))) goto end;
+        if (PyDict_SetItemString(kwds, "co_posonlyargcount", posonlyargcount) != 0) goto end;
+        if (!(kwonlyargcount=PyLong_FromLong(k))) goto end;
+        if (PyDict_SetItemString(kwds, "co_kwonlyargcount", kwonlyargcount) != 0) goto end;
+        if (!(nlocals=PyLong_FromLong(l))) goto end;
+        if (PyDict_SetItemString(kwds, "co_nlocals", nlocals) != 0) goto end;
+        if (!(stacksize=PyLong_FromLong(s))) goto end;
+        if (PyDict_SetItemString(kwds, "co_stacksize", stacksize) != 0) goto end;
+        if (!(flags=PyLong_FromLong(f))) goto end;
+        if (PyDict_SetItemString(kwds, "co_flags", flags) != 0) goto end;
+        if (PyDict_SetItemString(kwds, "co_code", code) != 0) goto end;
+        if (PyDict_SetItemString(kwds, "co_consts", c) != 0) goto end;
+        if (PyDict_SetItemString(kwds, "co_names", n) != 0) goto end;
+        if (PyDict_SetItemString(kwds, "co_varnames", v) != 0) goto end;
+        if (PyDict_SetItemString(kwds, "co_freevars", fv) != 0) goto end;
+        if (PyDict_SetItemString(kwds, "co_cellvars", cell) != 0) goto end;
+        if (PyDict_SetItemString(kwds, "co_linetable", lnos) != 0) goto end;
+        if (!(fn_cstr=PyUnicode_AsUTF8AndSize(fn, NULL))) goto end;
+        if (!(name_cstr=PyUnicode_AsUTF8AndSize(name, NULL))) goto end;
+        if (!(co = PyCode_NewEmpty(fn_cstr, name_cstr, fline))) goto end;
+        if (!(replace = PyObject_GetAttrString((PyObject*)co, "replace"))) goto cleanup_code_too;
+        if (!(empty = PyTuple_New(0))) goto cleanup_code_too; // unfortunately __pyx_empty_tuple isn't available here
+        if (!(call_result = PyObject_Call(replace, empty, kwds))) goto cleanup_code_too;
+        Py_XDECREF((PyObject*)co);
+        co = (PyCodeObject*)call_result;
+        call_result = NULL;
+        if (0) {
+            cleanup_code_too:
+            Py_XDECREF((PyObject*)co);
+            co = NULL;
+        }
+        end:
+        Py_XDECREF(kwds);
+        Py_XDECREF(argcount);
+        Py_XDECREF(posonlyargcount);
+        Py_XDECREF(kwonlyargcount);
+        Py_XDECREF(nlocals);
+        Py_XDECREF(stacksize);
+        Py_XDECREF(replace);
+        Py_XDECREF(call_result);
+        Py_XDECREF(empty);
+        if (type) {
+            PyErr_Restore(type, value, traceback);
+        }
+        return co;
+    }
 #else
   #define __Pyx_PyCode_New(a, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)\
           PyCode_New(a, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)
 #endif
   #define __Pyx_DefaultClassType PyType_Type
 #endif
 #ifndef Py_TPFLAGS_CHECKTYPES
@@ -588,18 +649,18 @@
   #ifndef PyUnicode_InternFromString
     #define PyUnicode_InternFromString(s) PyUnicode_FromString(s)
   #endif
 #endif
 #if PY_VERSION_HEX < 0x030200A4
   typedef long Py_hash_t;
   #define __Pyx_PyInt_FromHash_t PyInt_FromLong
-  #define __Pyx_PyInt_AsHash_t   PyInt_AsLong
+  #define __Pyx_PyInt_AsHash_t   __Pyx_PyIndex_AsHash_t
 #else
   #define __Pyx_PyInt_FromHash_t PyInt_FromSsize_t
-  #define __Pyx_PyInt_AsHash_t   PyInt_AsSsize_t
+  #define __Pyx_PyInt_AsHash_t   __Pyx_PyIndex_AsSsize_t
 #endif
 #if PY_MAJOR_VERSION >= 3
   #define __Pyx_PyMethod_New(func, self, klass) ((self) ? ((void)(klass), PyMethod_New(func, self)) : __Pyx_NewRef(func))
 #else
   #define __Pyx_PyMethod_New(func, self, klass) PyMethod_New(func, self, klass)
 #endif
 #if CYTHON_USE_ASYNC_SLOTS
@@ -762,14 +823,15 @@
 static CYTHON_INLINE int __Pyx_PyObject_IsTrue(PyObject*);
 static CYTHON_INLINE int __Pyx_PyObject_IsTrueAndDecref(PyObject*);
 static CYTHON_INLINE PyObject* __Pyx_PyNumber_IntOrLong(PyObject* x);
 #define __Pyx_PySequence_Tuple(obj)\
     (likely(PyTuple_CheckExact(obj)) ? __Pyx_NewRef(obj) : PySequence_Tuple(obj))
 static CYTHON_INLINE Py_ssize_t __Pyx_PyIndex_AsSsize_t(PyObject*);
 static CYTHON_INLINE PyObject * __Pyx_PyInt_FromSize_t(size_t);
+static CYTHON_INLINE Py_hash_t __Pyx_PyIndex_AsHash_t(PyObject*);
 #if CYTHON_ASSUME_SAFE_MACROS
 #define __pyx_PyFloat_AsDouble(x) (PyFloat_CheckExact(x) ? PyFloat_AS_DOUBLE(x) : PyFloat_AsDouble(x))
 #else
 #define __pyx_PyFloat_AsDouble(x) PyFloat_AsDouble(x)
 #endif
 #define __pyx_PyFloat_AsFloat(x) ((float) __pyx_PyFloat_AsDouble(x))
 #if PY_MAJOR_VERSION >= 3
@@ -1855,21 +1917,23 @@
 #define __Pyx_PyFunction_FastCallDict(func, args, nargs, kwargs) _PyFunction_FastCallDict(func, args, nargs, kwargs)
 #endif
 #define __Pyx_BUILD_ASSERT_EXPR(cond)\
     (sizeof(char [1 - 2*!(cond)]) - 1)
 #ifndef Py_MEMBER_SIZE
 #define Py_MEMBER_SIZE(type, member) sizeof(((type *)0)->member)
 #endif
+#if CYTHON_FAST_PYCALL
   static size_t __pyx_pyframe_localsplus_offset = 0;
   #include "frameobject.h"
   #define __Pxy_PyFrame_Initialize_Offsets()\
     ((void)__Pyx_BUILD_ASSERT_EXPR(sizeof(PyFrameObject) == offsetof(PyFrameObject, f_localsplus) + Py_MEMBER_SIZE(PyFrameObject, f_localsplus)),\
      (void)(__pyx_pyframe_localsplus_offset = ((size_t)PyFrame_Type.tp_basicsize) - Py_MEMBER_SIZE(PyFrameObject, f_localsplus)))
   #define __Pyx_PyFrame_GetLocalsplus(frame)\
     (assert(__pyx_pyframe_localsplus_offset), (PyObject **)(((char *)(frame)) + __pyx_pyframe_localsplus_offset))
+#endif // CYTHON_FAST_PYCALL
 #endif
 
 /* PyObjectCall.proto */
 #if CYTHON_COMPILING_IN_CPYTHON
 static CYTHON_INLINE PyObject* __Pyx_PyObject_Call(PyObject *func, PyObject *arg, PyObject *kw);
 #else
 #define __Pyx_PyObject_Call(func, arg, kw) PyObject_Call(func, arg, kw)
@@ -4964,14 +5028,17 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
+  #if PY_VERSION_HEX >= 0x030B00A2
+  0, /*tp_inline_values_offset*/
+  #endif
 };
 
 static struct __pyx_obj_11resiliparse_9itertools___pyx_scope_struct_1_exc_loop *__pyx_freelist_11resiliparse_9itertools___pyx_scope_struct_1_exc_loop[8];
 static int __pyx_freecount_11resiliparse_9itertools___pyx_scope_struct_1_exc_loop = 0;
 
 static PyObject *__pyx_tp_new_11resiliparse_9itertools___pyx_scope_struct_1_exc_loop(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
   PyObject *o;
@@ -5102,14 +5169,17 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
+  #if PY_VERSION_HEX >= 0x030B00A2
+  0, /*tp_inline_values_offset*/
+  #endif
 };
 
 static struct __pyx_obj_11resiliparse_9itertools___pyx_scope_struct_2_warc_retry *__pyx_freelist_11resiliparse_9itertools___pyx_scope_struct_2_warc_retry[8];
 static int __pyx_freecount_11resiliparse_9itertools___pyx_scope_struct_2_warc_retry = 0;
 
 static PyObject *__pyx_tp_new_11resiliparse_9itertools___pyx_scope_struct_2_warc_retry(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
   PyObject *o;
@@ -5256,14 +5326,17 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
+  #if PY_VERSION_HEX >= 0x030B00A2
+  0, /*tp_inline_values_offset*/
+  #endif
 };
 
 static PyMethodDef __pyx_methods[] = {
   {0, 0, 0, 0}
 };
 
 #if PY_MAJOR_VERSION >= 3
@@ -7093,15 +7166,15 @@
       } else {
         PyErr_Clear();
         use_cline = NULL;
       }
     }
     if (!use_cline) {
         c_line = 0;
-        PyObject_SetAttr(__pyx_cython_runtime, __pyx_n_s_cline_in_traceback, Py_False);
+        (void) PyObject_SetAttr(__pyx_cython_runtime, __pyx_n_s_cline_in_traceback, Py_False);
     }
     else if (use_cline == Py_False || (use_cline != Py_True && PyObject_Not(use_cline) != 0)) {
         c_line = 0;
     }
     __Pyx_ErrRestoreInState(tstate, ptype, pvalue, ptraceback);
     return c_line;
 }
@@ -7190,38 +7263,39 @@
 /* AddTraceback */
 #include "compile.h"
 #include "frameobject.h"
 #include "traceback.h"
 static PyCodeObject* __Pyx_CreateCodeObjectForTraceback(
             const char *funcname, int c_line,
             int py_line, const char *filename) {
-    PyCodeObject *py_code = 0;
-    PyObject *py_srcfile = 0;
-    PyObject *py_funcname = 0;
+    PyCodeObject *py_code = NULL;
+    PyObject *py_funcname = NULL;
     #if PY_MAJOR_VERSION < 3
+    PyObject *py_srcfile = NULL;
     py_srcfile = PyString_FromString(filename);
-    #else
-    py_srcfile = PyUnicode_FromString(filename);
-    #endif
     if (!py_srcfile) goto bad;
+    #endif
     if (c_line) {
         #if PY_MAJOR_VERSION < 3
         py_funcname = PyString_FromFormat( "%s (%s:%d)", funcname, __pyx_cfilenm, c_line);
+        if (!py_funcname) goto bad;
         #else
         py_funcname = PyUnicode_FromFormat( "%s (%s:%d)", funcname, __pyx_cfilenm, c_line);
+        if (!py_funcname) goto bad;
+        funcname = PyUnicode_AsUTF8(py_funcname);
+        if (!funcname) goto bad;
         #endif
     }
     else {
         #if PY_MAJOR_VERSION < 3
         py_funcname = PyString_FromString(funcname);
-        #else
-        py_funcname = PyUnicode_FromString(funcname);
+        if (!py_funcname) goto bad;
         #endif
     }
-    if (!py_funcname) goto bad;
+    #if PY_MAJOR_VERSION < 3
     py_code = __Pyx_PyCode_New(
         0,
         0,
         0,
         0,
         0,
         __pyx_empty_bytes, /*PyObject *code,*/
@@ -7232,19 +7306,24 @@
         __pyx_empty_tuple, /*PyObject *cellvars,*/
         py_srcfile,   /*PyObject *filename,*/
         py_funcname,  /*PyObject *name,*/
         py_line,
         __pyx_empty_bytes  /*PyObject *lnotab*/
     );
     Py_DECREF(py_srcfile);
-    Py_DECREF(py_funcname);
+    #else
+    py_code = PyCode_NewEmpty(filename, funcname, py_line);
+    #endif
+    Py_XDECREF(py_funcname);  // XDECREF since it's only set on Py3 if cline
     return py_code;
 bad:
-    Py_XDECREF(py_srcfile);
     Py_XDECREF(py_funcname);
+    #if PY_MAJOR_VERSION < 3
+    Py_XDECREF(py_srcfile);
+    #endif
     return NULL;
 }
 static void __Pyx_AddTraceback(const char *funcname, int c_line,
                                int py_line, const char *filename) {
     PyCodeObject *py_code = 0;
     PyFrameObject *py_frame = 0;
     PyThreadState *tstate = __Pyx_PyThreadState_Current;
@@ -8343,17 +8422,21 @@
     exc_state = &self->gi_exc_state;
     if (exc_state->exc_type) {
         #if CYTHON_COMPILING_IN_PYPY || CYTHON_COMPILING_IN_PYSTON
         #else
         if (exc_state->exc_traceback) {
             PyTracebackObject *tb = (PyTracebackObject *) exc_state->exc_traceback;
             PyFrameObject *f = tb->tb_frame;
-            Py_XINCREF(tstate->frame);
             assert(f->f_back == NULL);
+            #if PY_VERSION_HEX >= 0x030B00A1
+            f->f_back = PyThreadState_GetFrame(tstate);
+            #else
+            Py_XINCREF(tstate->frame);
             f->f_back = tstate->frame;
+            #endif
         }
         #endif
     }
 #if CYTHON_USE_EXC_INFO_STACK
     exc_state->previous_item = tstate->exc_info;
     tstate->exc_info = exc_state;
 #else
@@ -9139,14 +9222,17 @@
 #endif
 #if PY_VERSION_HEX >= 0x030800b1
     0,
 #endif
 #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
     0,
 #endif
+#if PY_VERSION_HEX >= 0x030B00A2
+    0,
+#endif
 };
 static int __pyx_Generator_init(void) {
     __pyx_GeneratorType_type.tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
     __pyx_GeneratorType_type.tp_iter = PyObject_SelfIter;
     __pyx_GeneratorType = __Pyx_FetchCommonType(&__pyx_GeneratorType_type);
     if (unlikely(!__pyx_GeneratorType)) {
         return -1;
@@ -9468,14 +9554,31 @@
   }
   x = PyNumber_Index(b);
   if (!x) return -1;
   ival = PyInt_AsSsize_t(x);
   Py_DECREF(x);
   return ival;
 }
+static CYTHON_INLINE Py_hash_t __Pyx_PyIndex_AsHash_t(PyObject* o) {
+  if (sizeof(Py_hash_t) == sizeof(Py_ssize_t)) {
+    return (Py_hash_t) __Pyx_PyIndex_AsSsize_t(o);
+#if PY_MAJOR_VERSION < 3
+  } else if (likely(PyInt_CheckExact(o))) {
+    return PyInt_AS_LONG(o);
+#endif
+  } else {
+    Py_ssize_t ival;
+    PyObject *x;
+    x = PyNumber_Index(o);
+    if (!x) return -1;
+    ival = PyInt_AsLong(x);
+    Py_DECREF(x);
+    return ival;
+  }
+}
 static CYTHON_INLINE PyObject * __Pyx_PyBool_FromLong(long b) {
   return b ? __Pyx_NewRef(Py_True) : __Pyx_NewRef(Py_False);
 }
 static CYTHON_INLINE PyObject * __Pyx_PyInt_FromSize_t(size_t ival) {
     return PyInt_FromSize_t(ival);
 }
```

### Comparing `Resiliparse-0.8.1/resiliparse/itertools.pxd` & `Resiliparse-0.9.0/resiliparse/itertools.pxd`

 * *Files identical despite different names*

### Comparing `Resiliparse-0.8.1/resiliparse/itertools.pyx` & `Resiliparse-0.9.0/resiliparse/itertools.pyx`

 * *Files identical despite different names*

### Comparing `Resiliparse-0.8.1/resiliparse/parse/__init__.pxd` & `Resiliparse-0.9.0/resiliparse/parse/__init__.pxd`

 * *Files identical despite different names*

### Comparing `Resiliparse-0.8.1/resiliparse/parse/__init__.py` & `Resiliparse-0.9.0/resiliparse/parse/__init__.py`

 * *Files identical despite different names*

### Comparing `Resiliparse-0.8.1/resiliparse/parse/encoding.cpp` & `Resiliparse-0.9.0/resiliparse/parse/encoding.cpp`

 * *Files 2% similar despite different names*

```diff
@@ -1,8 +1,8 @@
-/* Generated by Cython 0.29.24 */
+/* Generated by Cython 0.29.25 */
 
 /* BEGIN: Cython Metadata
 {
     "distutils": {
         "depends": [
             "resiliparse/parse/encoding.h"
         ],
@@ -40,16 +40,16 @@
 #endif /* PY_SSIZE_T_CLEAN */
 #include "Python.h"
 #ifndef Py_PYTHON_H
     #error Python headers needed to compile C extensions, please install development version of Python.
 #elif PY_VERSION_HEX < 0x02060000 || (0x03000000 <= PY_VERSION_HEX && PY_VERSION_HEX < 0x03030000)
     #error Cython requires Python 2.6+ or Python 3.3+.
 #else
-#define CYTHON_ABI "0_29_24"
-#define CYTHON_HEX_VERSION 0x001D18F0
+#define CYTHON_ABI "0_29_25"
+#define CYTHON_HEX_VERSION 0x001D19F0
 #define CYTHON_FUTURE_DIVISION 1
 #include <stddef.h>
 #ifndef offsetof
   #define offsetof(type, member) ( (size_t) & ((type*)0) -> member )
 #endif
 #if !defined(WIN32) && !defined(MS_WINDOWS)
   #ifndef __stdcall
@@ -188,15 +188,15 @@
   #endif
   #ifndef CYTHON_USE_PYLIST_INTERNALS
     #define CYTHON_USE_PYLIST_INTERNALS 1
   #endif
   #ifndef CYTHON_USE_UNICODE_INTERNALS
     #define CYTHON_USE_UNICODE_INTERNALS 1
   #endif
-  #if PY_VERSION_HEX < 0x030300F0
+  #if PY_VERSION_HEX < 0x030300F0 || PY_VERSION_HEX >= 0x030B00A2
     #undef CYTHON_USE_UNICODE_WRITER
     #define CYTHON_USE_UNICODE_WRITER 0
   #elif !defined(CYTHON_USE_UNICODE_WRITER)
     #define CYTHON_USE_UNICODE_WRITER 1
   #endif
   #ifndef CYTHON_AVOID_BORROWED_REFS
     #define CYTHON_AVOID_BORROWED_REFS 0
@@ -207,15 +207,15 @@
   #ifndef CYTHON_UNPACK_METHODS
     #define CYTHON_UNPACK_METHODS 1
   #endif
   #ifndef CYTHON_FAST_THREAD_STATE
     #define CYTHON_FAST_THREAD_STATE 1
   #endif
   #ifndef CYTHON_FAST_PYCALL
-    #define CYTHON_FAST_PYCALL 1
+    #define CYTHON_FAST_PYCALL (PY_VERSION_HEX < 0x030B00A1)
   #endif
   #ifndef CYTHON_PEP489_MULTI_PHASE_INIT
     #define CYTHON_PEP489_MULTI_PHASE_INIT (PY_VERSION_HEX >= 0x03050000)
   #endif
   #ifndef CYTHON_USE_TP_FINALIZE
     #define CYTHON_USE_TP_FINALIZE (PY_VERSION_HEX >= 0x030400a1)
   #endif
@@ -226,15 +226,17 @@
     #define CYTHON_USE_EXC_INFO_STACK (PY_VERSION_HEX >= 0x030700A3)
   #endif
 #endif
 #if !defined(CYTHON_FAST_PYCCALL)
 #define CYTHON_FAST_PYCCALL  (CYTHON_FAST_PYCALL && PY_VERSION_HEX >= 0x030600B1)
 #endif
 #if CYTHON_USE_PYLONG_INTERNALS
-  #include "longintrepr.h"
+  #if PY_MAJOR_VERSION < 3
+    #include "longintrepr.h"
+  #endif
   #undef SHIFT
   #undef BASE
   #undef MASK
   #ifdef SIZEOF_VOID_P
     enum { __pyx_check_sizeof_voidp = 1 / (int)(SIZEOF_VOID_P == sizeof(void*)) };
   #endif
 #endif
@@ -357,17 +359,76 @@
 #if PY_MAJOR_VERSION < 3
   #define __Pyx_BUILTIN_MODULE_NAME "__builtin__"
   #define __Pyx_PyCode_New(a, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)\
           PyCode_New(a+k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)
   #define __Pyx_DefaultClassType PyClass_Type
 #else
   #define __Pyx_BUILTIN_MODULE_NAME "builtins"
-#if PY_VERSION_HEX >= 0x030800A4 && PY_VERSION_HEX < 0x030800B2
-  #define __Pyx_PyCode_New(a, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)\
-          PyCode_New(a, 0, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)
+  #define __Pyx_DefaultClassType PyType_Type
+#if PY_VERSION_HEX >= 0x030B00A1
+    static CYTHON_INLINE PyCodeObject* __Pyx_PyCode_New(int a, int k, int l, int s, int f,
+                                                    PyObject *code, PyObject *c, PyObject* n, PyObject *v,
+                                                    PyObject *fv, PyObject *cell, PyObject* fn,
+                                                    PyObject *name, int fline, PyObject *lnos) {
+        PyObject *kwds=NULL, *argcount=NULL, *posonlyargcount=NULL, *kwonlyargcount=NULL;
+        PyObject *nlocals=NULL, *stacksize=NULL, *flags=NULL, *replace=NULL, *call_result=NULL, *empty=NULL;
+        const char *fn_cstr=NULL;
+        const char *name_cstr=NULL;
+        PyCodeObject* co=NULL;
+        PyObject *type, *value, *traceback;
+        PyErr_Fetch(&type, &value, &traceback);
+        if (!(kwds=PyDict_New())) goto end;
+        if (!(argcount=PyLong_FromLong(a))) goto end;
+        if (PyDict_SetItemString(kwds, "co_argcount", argcount) != 0) goto end;
+        if (!(posonlyargcount=PyLong_FromLong(0))) goto end;
+        if (PyDict_SetItemString(kwds, "co_posonlyargcount", posonlyargcount) != 0) goto end;
+        if (!(kwonlyargcount=PyLong_FromLong(k))) goto end;
+        if (PyDict_SetItemString(kwds, "co_kwonlyargcount", kwonlyargcount) != 0) goto end;
+        if (!(nlocals=PyLong_FromLong(l))) goto end;
+        if (PyDict_SetItemString(kwds, "co_nlocals", nlocals) != 0) goto end;
+        if (!(stacksize=PyLong_FromLong(s))) goto end;
+        if (PyDict_SetItemString(kwds, "co_stacksize", stacksize) != 0) goto end;
+        if (!(flags=PyLong_FromLong(f))) goto end;
+        if (PyDict_SetItemString(kwds, "co_flags", flags) != 0) goto end;
+        if (PyDict_SetItemString(kwds, "co_code", code) != 0) goto end;
+        if (PyDict_SetItemString(kwds, "co_consts", c) != 0) goto end;
+        if (PyDict_SetItemString(kwds, "co_names", n) != 0) goto end;
+        if (PyDict_SetItemString(kwds, "co_varnames", v) != 0) goto end;
+        if (PyDict_SetItemString(kwds, "co_freevars", fv) != 0) goto end;
+        if (PyDict_SetItemString(kwds, "co_cellvars", cell) != 0) goto end;
+        if (PyDict_SetItemString(kwds, "co_linetable", lnos) != 0) goto end;
+        if (!(fn_cstr=PyUnicode_AsUTF8AndSize(fn, NULL))) goto end;
+        if (!(name_cstr=PyUnicode_AsUTF8AndSize(name, NULL))) goto end;
+        if (!(co = PyCode_NewEmpty(fn_cstr, name_cstr, fline))) goto end;
+        if (!(replace = PyObject_GetAttrString((PyObject*)co, "replace"))) goto cleanup_code_too;
+        if (!(empty = PyTuple_New(0))) goto cleanup_code_too; // unfortunately __pyx_empty_tuple isn't available here
+        if (!(call_result = PyObject_Call(replace, empty, kwds))) goto cleanup_code_too;
+        Py_XDECREF((PyObject*)co);
+        co = (PyCodeObject*)call_result;
+        call_result = NULL;
+        if (0) {
+            cleanup_code_too:
+            Py_XDECREF((PyObject*)co);
+            co = NULL;
+        }
+        end:
+        Py_XDECREF(kwds);
+        Py_XDECREF(argcount);
+        Py_XDECREF(posonlyargcount);
+        Py_XDECREF(kwonlyargcount);
+        Py_XDECREF(nlocals);
+        Py_XDECREF(stacksize);
+        Py_XDECREF(replace);
+        Py_XDECREF(call_result);
+        Py_XDECREF(empty);
+        if (type) {
+            PyErr_Restore(type, value, traceback);
+        }
+        return co;
+    }
 #else
   #define __Pyx_PyCode_New(a, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)\
           PyCode_New(a, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)
 #endif
   #define __Pyx_DefaultClassType PyType_Type
 #endif
 #ifndef Py_TPFLAGS_CHECKTYPES
@@ -597,18 +658,18 @@
   #ifndef PyUnicode_InternFromString
     #define PyUnicode_InternFromString(s) PyUnicode_FromString(s)
   #endif
 #endif
 #if PY_VERSION_HEX < 0x030200A4
   typedef long Py_hash_t;
   #define __Pyx_PyInt_FromHash_t PyInt_FromLong
-  #define __Pyx_PyInt_AsHash_t   PyInt_AsLong
+  #define __Pyx_PyInt_AsHash_t   __Pyx_PyIndex_AsHash_t
 #else
   #define __Pyx_PyInt_FromHash_t PyInt_FromSsize_t
-  #define __Pyx_PyInt_AsHash_t   PyInt_AsSsize_t
+  #define __Pyx_PyInt_AsHash_t   __Pyx_PyIndex_AsSsize_t
 #endif
 #if PY_MAJOR_VERSION >= 3
   #define __Pyx_PyMethod_New(func, self, klass) ((self) ? ((void)(klass), PyMethod_New(func, self)) : __Pyx_NewRef(func))
 #else
   #define __Pyx_PyMethod_New(func, self, klass) PyMethod_New(func, self, klass)
 #endif
 #if CYTHON_USE_ASYNC_SLOTS
@@ -777,14 +838,15 @@
 static CYTHON_INLINE int __Pyx_PyObject_IsTrue(PyObject*);
 static CYTHON_INLINE int __Pyx_PyObject_IsTrueAndDecref(PyObject*);
 static CYTHON_INLINE PyObject* __Pyx_PyNumber_IntOrLong(PyObject* x);
 #define __Pyx_PySequence_Tuple(obj)\
     (likely(PyTuple_CheckExact(obj)) ? __Pyx_NewRef(obj) : PySequence_Tuple(obj))
 static CYTHON_INLINE Py_ssize_t __Pyx_PyIndex_AsSsize_t(PyObject*);
 static CYTHON_INLINE PyObject * __Pyx_PyInt_FromSize_t(size_t);
+static CYTHON_INLINE Py_hash_t __Pyx_PyIndex_AsHash_t(PyObject*);
 #if CYTHON_ASSUME_SAFE_MACROS
 #define __pyx_PyFloat_AsDouble(x) (PyFloat_CheckExact(x) ? PyFloat_AS_DOUBLE(x) : PyFloat_AsDouble(x))
 #else
 #define __pyx_PyFloat_AsDouble(x) PyFloat_AsDouble(x)
 #endif
 #define __pyx_PyFloat_AsFloat(x) ((float) __pyx_PyFloat_AsDouble(x))
 #if PY_MAJOR_VERSION >= 3
@@ -959,15 +1021,15 @@
 };
 
 /* "resiliparse/parse/encoding.pyx":355
  * 
  * 
  * cpdef str detect_mime(bytes data, float max_unprintable=0.05):             # <<<<<<<<<<<<<<
  *     """
- *     detect_mime(data)
+ *     detect_mime(data, max_unprintable=0.05)
  */
 struct __pyx_opt_args_11resiliparse_5parse_8encoding_detect_mime {
   int __pyx_n;
   float max_unprintable;
 };
 
 /* "resiliparse/parse/encoding.pxd":19
@@ -1123,21 +1185,23 @@
 #define __Pyx_PyFunction_FastCallDict(func, args, nargs, kwargs) _PyFunction_FastCallDict(func, args, nargs, kwargs)
 #endif
 #define __Pyx_BUILD_ASSERT_EXPR(cond)\
     (sizeof(char [1 - 2*!(cond)]) - 1)
 #ifndef Py_MEMBER_SIZE
 #define Py_MEMBER_SIZE(type, member) sizeof(((type *)0)->member)
 #endif
+#if CYTHON_FAST_PYCALL
   static size_t __pyx_pyframe_localsplus_offset = 0;
   #include "frameobject.h"
   #define __Pxy_PyFrame_Initialize_Offsets()\
     ((void)__Pyx_BUILD_ASSERT_EXPR(sizeof(PyFrameObject) == offsetof(PyFrameObject, f_localsplus) + Py_MEMBER_SIZE(PyFrameObject, f_localsplus)),\
      (void)(__pyx_pyframe_localsplus_offset = ((size_t)PyFrame_Type.tp_basicsize) - Py_MEMBER_SIZE(PyFrameObject, f_localsplus)))
   #define __Pyx_PyFrame_GetLocalsplus(frame)\
     (assert(__pyx_pyframe_localsplus_offset), (PyObject **)(((char *)(frame)) + __pyx_pyframe_localsplus_offset))
+#endif // CYTHON_FAST_PYCALL
 #endif
 
 /* PyObjectCall.proto */
 #if CYTHON_COMPILING_IN_CPYTHON
 static CYTHON_INLINE PyObject* __Pyx_PyObject_Call(PyObject *func, PyObject *arg, PyObject *kw);
 #else
 #define __Pyx_PyObject_Call(func, arg, kw) PyObject_Call(func, arg, kw)
@@ -1561,14 +1625,15 @@
 static const char __pyx_k_l6[] = "l6";
 static const char __pyx_k_l9[] = "l9";
 static const char __pyx_k_866[] = "866";
 static const char __pyx_k_gbk[] = "gbk";
 static const char __pyx_k_get[] = "get";
 static const char __pyx_k_koi[] = "koi";
 static const char __pyx_k_mac[] = "mac";
+static const char __pyx_k_svg[] = "<svg ";
 static const char __pyx_k_big5[] = "big5";
 static const char __pyx_k_data[] = "data";
 static const char __pyx_k_find[] = "find";
 static const char __pyx_k_koi8[] = "koi8";
 static const char __pyx_k_main[] = "__main__";
 static const char __pyx_k_name[] = "name";
 static const char __pyx_k_sjis[] = "sjis";
@@ -2076,14 +2141,15 @@
 static PyObject *__pyx_n_s_setstate_cython;
 static PyObject *__pyx_n_u_shift_jis;
 static PyObject *__pyx_kp_u_shift_jis_2;
 static PyObject *__pyx_n_u_sjis;
 static PyObject *__pyx_n_s_strip;
 static PyObject *__pyx_n_s_strip_bom;
 static PyObject *__pyx_n_u_sun_eu_greek;
+static PyObject *__pyx_kp_b_svg;
 static PyObject *__pyx_n_s_t;
 static PyObject *__pyx_n_s_test;
 static PyObject *__pyx_kp_u_text_plain;
 static PyObject *__pyx_kp_u_tis_620;
 static PyObject *__pyx_n_s_typing;
 static PyObject *__pyx_kp_u_ucs_2;
 static PyObject *__pyx_n_u_unicode;
@@ -4605,15 +4671,15 @@
 }
 
 /* "resiliparse/parse/encoding.pyx":355
  * 
  * 
  * cpdef str detect_mime(bytes data, float max_unprintable=0.05):             # <<<<<<<<<<<<<<
  *     """
- *     detect_mime(data)
+ *     detect_mime(data, max_unprintable=0.05)
  */
 
 static PyObject *__pyx_pw_11resiliparse_5parse_8encoding_9detect_mime(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
 static PyObject *__pyx_f_11resiliparse_5parse_8encoding_detect_mime(PyObject *__pyx_v_data, CYTHON_UNUSED int __pyx_skip_dispatch, struct __pyx_opt_args_11resiliparse_5parse_8encoding_detect_mime *__pyx_optional_args) {
   float __pyx_v_max_unprintable = ((float)0.05);
   size_t __pyx_v_i;
   PyObject *__pyx_v_data_strip = 0;
@@ -4678,26 +4744,26 @@
   __pyx_t_1 = 0;
 
   /* "resiliparse/parse/encoding.pyx":374
  *     cdef size_t i
  *     cdef bytes data_strip = data[:128].lstrip()
  *     for i in range(MIME_BYTES.size()):             # <<<<<<<<<<<<<<
  *         if data.startswith(MIME_BYTES[i].magic_bytes) or data_strip.startswith(MIME_BYTES[i].magic_bytes):
- *             if MIME_BYTES[i].mime_type in [b'application/xml', b'text/html']:
+ *             if MIME_BYTES[i].mime_type in [b'text/html', b'application/xml']:
  */
   __pyx_t_4 = MIME_BYTES.size();
   __pyx_t_5 = __pyx_t_4;
   for (__pyx_t_6 = 0; __pyx_t_6 < __pyx_t_5; __pyx_t_6+=1) {
     __pyx_v_i = __pyx_t_6;
 
     /* "resiliparse/parse/encoding.pyx":375
  *     cdef bytes data_strip = data[:128].lstrip()
  *     for i in range(MIME_BYTES.size()):
  *         if data.startswith(MIME_BYTES[i].magic_bytes) or data_strip.startswith(MIME_BYTES[i].magic_bytes):             # <<<<<<<<<<<<<<
- *             if MIME_BYTES[i].mime_type in [b'application/xml', b'text/html']:
+ *             if MIME_BYTES[i].mime_type in [b'text/html', b'application/xml']:
  *                 if data_strip.find(b'"-//W3C//DTD XHTML') > -1:
  */
     if (unlikely(__pyx_v_data == Py_None)) {
       PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "startswith");
       __PYX_ERR(0, 375, __pyx_L1_error)
     }
     __pyx_t_1 = __pyx_convert_PyBytes_string_to_py_std__in_string((MIME_BYTES[__pyx_v_i]).magic_bytes); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 375, __pyx_L1_error)
@@ -4720,277 +4786,309 @@
     __pyx_t_7 = (__pyx_t_8 != 0);
     __pyx_L6_bool_binop_done:;
     if (__pyx_t_7) {
 
       /* "resiliparse/parse/encoding.pyx":376
  *     for i in range(MIME_BYTES.size()):
  *         if data.startswith(MIME_BYTES[i].magic_bytes) or data_strip.startswith(MIME_BYTES[i].magic_bytes):
- *             if MIME_BYTES[i].mime_type in [b'application/xml', b'text/html']:             # <<<<<<<<<<<<<<
+ *             if MIME_BYTES[i].mime_type in [b'text/html', b'application/xml']:             # <<<<<<<<<<<<<<
  *                 if data_strip.find(b'"-//W3C//DTD XHTML') > -1:
  *                     return 'application/xhtml+xml'
  */
       __pyx_t_9 = (MIME_BYTES[__pyx_v_i]).mime_type;
-      __pyx_t_8 = ((__pyx_t_9 == ((char const *)"application/xml")) != 0);
+      __pyx_t_8 = ((__pyx_t_9 == ((char const *)"text/html")) != 0);
       if (!__pyx_t_8) {
       } else {
         __pyx_t_7 = __pyx_t_8;
         goto __pyx_L9_bool_binop_done;
       }
-      __pyx_t_8 = ((__pyx_t_9 == ((char const *)"text/html")) != 0);
+      __pyx_t_8 = ((__pyx_t_9 == ((char const *)"application/xml")) != 0);
       __pyx_t_7 = __pyx_t_8;
       __pyx_L9_bool_binop_done:;
       __pyx_t_8 = (__pyx_t_7 != 0);
       if (__pyx_t_8) {
 
         /* "resiliparse/parse/encoding.pyx":377
  *         if data.startswith(MIME_BYTES[i].magic_bytes) or data_strip.startswith(MIME_BYTES[i].magic_bytes):
- *             if MIME_BYTES[i].mime_type in [b'application/xml', b'text/html']:
+ *             if MIME_BYTES[i].mime_type in [b'text/html', b'application/xml']:
  *                 if data_strip.find(b'"-//W3C//DTD XHTML') > -1:             # <<<<<<<<<<<<<<
  *                     return 'application/xhtml+xml'
- *                 if data_strip.find(b'"-//W3C//DTD SVG') > -1:
+ *                 if MIME_BYTES[i].mime_type == b'application/xml':
  */
         __pyx_t_1 = __Pyx_CallUnboundCMethod1(&__pyx_umethod_PyBytes_Type_find, __pyx_v_data_strip, __pyx_kp_b_W3C_DTD_XHTML); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 377, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
         __pyx_t_3 = PyObject_RichCompare(__pyx_t_1, __pyx_int_neg_1, Py_GT); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 377, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 377, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         if (__pyx_t_8) {
 
           /* "resiliparse/parse/encoding.pyx":378
- *             if MIME_BYTES[i].mime_type in [b'application/xml', b'text/html']:
+ *             if MIME_BYTES[i].mime_type in [b'text/html', b'application/xml']:
  *                 if data_strip.find(b'"-//W3C//DTD XHTML') > -1:
  *                     return 'application/xhtml+xml'             # <<<<<<<<<<<<<<
- *                 if data_strip.find(b'"-//W3C//DTD SVG') > -1:
- *                     return 'image/svg+xml'
+ *                 if MIME_BYTES[i].mime_type == b'application/xml':
+ *                     if data_strip.find(b'<svg ') > -1 or data_strip.find(b'"-//W3C//DTD SVG') > -1:
  */
           __Pyx_XDECREF(__pyx_r);
           __Pyx_INCREF(__pyx_kp_u_application_xhtml_xml);
           __pyx_r = __pyx_kp_u_application_xhtml_xml;
           goto __pyx_L0;
 
           /* "resiliparse/parse/encoding.pyx":377
  *         if data.startswith(MIME_BYTES[i].magic_bytes) or data_strip.startswith(MIME_BYTES[i].magic_bytes):
- *             if MIME_BYTES[i].mime_type in [b'application/xml', b'text/html']:
+ *             if MIME_BYTES[i].mime_type in [b'text/html', b'application/xml']:
  *                 if data_strip.find(b'"-//W3C//DTD XHTML') > -1:             # <<<<<<<<<<<<<<
  *                     return 'application/xhtml+xml'
- *                 if data_strip.find(b'"-//W3C//DTD SVG') > -1:
+ *                 if MIME_BYTES[i].mime_type == b'application/xml':
  */
         }
 
         /* "resiliparse/parse/encoding.pyx":379
  *                 if data_strip.find(b'"-//W3C//DTD XHTML') > -1:
  *                     return 'application/xhtml+xml'
- *                 if data_strip.find(b'"-//W3C//DTD SVG') > -1:             # <<<<<<<<<<<<<<
- *                     return 'image/svg+xml'
- *             return MIME_BYTES[i].mime_type.decode()
+ *                 if MIME_BYTES[i].mime_type == b'application/xml':             # <<<<<<<<<<<<<<
+ *                     if data_strip.find(b'<svg ') > -1 or data_strip.find(b'"-//W3C//DTD SVG') > -1:
+ *                         return 'image/svg+xml'
  */
-        __pyx_t_3 = __Pyx_CallUnboundCMethod1(&__pyx_umethod_PyBytes_Type_find, __pyx_v_data_strip, __pyx_kp_b_W3C_DTD_SVG); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 379, __pyx_L1_error)
-        __Pyx_GOTREF(__pyx_t_3);
-        __pyx_t_1 = PyObject_RichCompare(__pyx_t_3, __pyx_int_neg_1, Py_GT); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 379, __pyx_L1_error)
-        __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __pyx_t_8 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_8 < 0)) __PYX_ERR(0, 379, __pyx_L1_error)
-        __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+        __pyx_t_8 = (((MIME_BYTES[__pyx_v_i]).mime_type == ((char const *)"application/xml")) != 0);
         if (__pyx_t_8) {
 
           /* "resiliparse/parse/encoding.pyx":380
  *                     return 'application/xhtml+xml'
- *                 if data_strip.find(b'"-//W3C//DTD SVG') > -1:
- *                     return 'image/svg+xml'             # <<<<<<<<<<<<<<
+ *                 if MIME_BYTES[i].mime_type == b'application/xml':
+ *                     if data_strip.find(b'<svg ') > -1 or data_strip.find(b'"-//W3C//DTD SVG') > -1:             # <<<<<<<<<<<<<<
+ *                         return 'image/svg+xml'
+ *             return MIME_BYTES[i].mime_type.decode()
+ */
+          __pyx_t_3 = __Pyx_CallUnboundCMethod1(&__pyx_umethod_PyBytes_Type_find, __pyx_v_data_strip, __pyx_kp_b_svg); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 380, __pyx_L1_error)
+          __Pyx_GOTREF(__pyx_t_3);
+          __pyx_t_1 = PyObject_RichCompare(__pyx_t_3, __pyx_int_neg_1, Py_GT); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 380, __pyx_L1_error)
+          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+          __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 380, __pyx_L1_error)
+          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+          if (!__pyx_t_7) {
+          } else {
+            __pyx_t_8 = __pyx_t_7;
+            goto __pyx_L14_bool_binop_done;
+          }
+          __pyx_t_1 = __Pyx_CallUnboundCMethod1(&__pyx_umethod_PyBytes_Type_find, __pyx_v_data_strip, __pyx_kp_b_W3C_DTD_SVG); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 380, __pyx_L1_error)
+          __Pyx_GOTREF(__pyx_t_1);
+          __pyx_t_3 = PyObject_RichCompare(__pyx_t_1, __pyx_int_neg_1, Py_GT); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 380, __pyx_L1_error)
+          __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+          __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 380, __pyx_L1_error)
+          __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+          __pyx_t_8 = __pyx_t_7;
+          __pyx_L14_bool_binop_done:;
+          if (__pyx_t_8) {
+
+            /* "resiliparse/parse/encoding.pyx":381
+ *                 if MIME_BYTES[i].mime_type == b'application/xml':
+ *                     if data_strip.find(b'<svg ') > -1 or data_strip.find(b'"-//W3C//DTD SVG') > -1:
+ *                         return 'image/svg+xml'             # <<<<<<<<<<<<<<
  *             return MIME_BYTES[i].mime_type.decode()
  * 
  */
-          __Pyx_XDECREF(__pyx_r);
-          __Pyx_INCREF(__pyx_kp_u_image_svg_xml);
-          __pyx_r = __pyx_kp_u_image_svg_xml;
-          goto __pyx_L0;
+            __Pyx_XDECREF(__pyx_r);
+            __Pyx_INCREF(__pyx_kp_u_image_svg_xml);
+            __pyx_r = __pyx_kp_u_image_svg_xml;
+            goto __pyx_L0;
+
+            /* "resiliparse/parse/encoding.pyx":380
+ *                     return 'application/xhtml+xml'
+ *                 if MIME_BYTES[i].mime_type == b'application/xml':
+ *                     if data_strip.find(b'<svg ') > -1 or data_strip.find(b'"-//W3C//DTD SVG') > -1:             # <<<<<<<<<<<<<<
+ *                         return 'image/svg+xml'
+ *             return MIME_BYTES[i].mime_type.decode()
+ */
+          }
 
           /* "resiliparse/parse/encoding.pyx":379
  *                 if data_strip.find(b'"-//W3C//DTD XHTML') > -1:
  *                     return 'application/xhtml+xml'
- *                 if data_strip.find(b'"-//W3C//DTD SVG') > -1:             # <<<<<<<<<<<<<<
- *                     return 'image/svg+xml'
- *             return MIME_BYTES[i].mime_type.decode()
+ *                 if MIME_BYTES[i].mime_type == b'application/xml':             # <<<<<<<<<<<<<<
+ *                     if data_strip.find(b'<svg ') > -1 or data_strip.find(b'"-//W3C//DTD SVG') > -1:
+ *                         return 'image/svg+xml'
  */
         }
 
         /* "resiliparse/parse/encoding.pyx":376
  *     for i in range(MIME_BYTES.size()):
  *         if data.startswith(MIME_BYTES[i].magic_bytes) or data_strip.startswith(MIME_BYTES[i].magic_bytes):
- *             if MIME_BYTES[i].mime_type in [b'application/xml', b'text/html']:             # <<<<<<<<<<<<<<
+ *             if MIME_BYTES[i].mime_type in [b'text/html', b'application/xml']:             # <<<<<<<<<<<<<<
  *                 if data_strip.find(b'"-//W3C//DTD XHTML') > -1:
  *                     return 'application/xhtml+xml'
  */
       }
 
-      /* "resiliparse/parse/encoding.pyx":381
- *                 if data_strip.find(b'"-//W3C//DTD SVG') > -1:
- *                     return 'image/svg+xml'
+      /* "resiliparse/parse/encoding.pyx":382
+ *                     if data_strip.find(b'<svg ') > -1 or data_strip.find(b'"-//W3C//DTD SVG') > -1:
+ *                         return 'image/svg+xml'
  *             return MIME_BYTES[i].mime_type.decode()             # <<<<<<<<<<<<<<
  * 
  *     cdef size_t unprintable = 0
  */
       __Pyx_XDECREF(__pyx_r);
-      __pyx_t_1 = __Pyx_decode_cpp_string((MIME_BYTES[__pyx_v_i]).mime_type, 0, PY_SSIZE_T_MAX, NULL, NULL, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 381, __pyx_L1_error)
-      __Pyx_GOTREF(__pyx_t_1);
-      __pyx_r = ((PyObject*)__pyx_t_1);
-      __pyx_t_1 = 0;
+      __pyx_t_3 = __Pyx_decode_cpp_string((MIME_BYTES[__pyx_v_i]).mime_type, 0, PY_SSIZE_T_MAX, NULL, NULL, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 382, __pyx_L1_error)
+      __Pyx_GOTREF(__pyx_t_3);
+      __pyx_r = ((PyObject*)__pyx_t_3);
+      __pyx_t_3 = 0;
       goto __pyx_L0;
 
       /* "resiliparse/parse/encoding.pyx":375
  *     cdef bytes data_strip = data[:128].lstrip()
  *     for i in range(MIME_BYTES.size()):
  *         if data.startswith(MIME_BYTES[i].magic_bytes) or data_strip.startswith(MIME_BYTES[i].magic_bytes):             # <<<<<<<<<<<<<<
- *             if MIME_BYTES[i].mime_type in [b'application/xml', b'text/html']:
+ *             if MIME_BYTES[i].mime_type in [b'text/html', b'application/xml']:
  *                 if data_strip.find(b'"-//W3C//DTD XHTML') > -1:
  */
     }
   }
 
-  /* "resiliparse/parse/encoding.pyx":383
+  /* "resiliparse/parse/encoding.pyx":384
  *             return MIME_BYTES[i].mime_type.decode()
  * 
  *     cdef size_t unprintable = 0             # <<<<<<<<<<<<<<
  *     for i in range(<size_t>len(data)):
  *         if 0x00 <= data[i] <= 0x1f or 0x7f <= data[i] <= 0xff:
  */
   __pyx_v_unprintable = 0;
 
-  /* "resiliparse/parse/encoding.pyx":384
+  /* "resiliparse/parse/encoding.pyx":385
  * 
  *     cdef size_t unprintable = 0
  *     for i in range(<size_t>len(data)):             # <<<<<<<<<<<<<<
  *         if 0x00 <= data[i] <= 0x1f or 0x7f <= data[i] <= 0xff:
  *             preinc(unprintable)
  */
   if (unlikely(__pyx_v_data == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-    __PYX_ERR(0, 384, __pyx_L1_error)
+    __PYX_ERR(0, 385, __pyx_L1_error)
   }
-  __pyx_t_10 = PyBytes_GET_SIZE(__pyx_v_data); if (unlikely(__pyx_t_10 == ((Py_ssize_t)-1))) __PYX_ERR(0, 384, __pyx_L1_error)
+  __pyx_t_10 = PyBytes_GET_SIZE(__pyx_v_data); if (unlikely(__pyx_t_10 == ((Py_ssize_t)-1))) __PYX_ERR(0, 385, __pyx_L1_error)
   __pyx_t_6 = ((size_t)__pyx_t_10);
   __pyx_t_11 = __pyx_t_6;
   for (__pyx_t_12 = 0; __pyx_t_12 < __pyx_t_11; __pyx_t_12+=1) {
     __pyx_v_i = __pyx_t_12;
 
-    /* "resiliparse/parse/encoding.pyx":385
+    /* "resiliparse/parse/encoding.pyx":386
  *     cdef size_t unprintable = 0
  *     for i in range(<size_t>len(data)):
  *         if 0x00 <= data[i] <= 0x1f or 0x7f <= data[i] <= 0xff:             # <<<<<<<<<<<<<<
  *             preinc(unprintable)
  *         if unprintable > 0 and unprintable > <size_t>(len(data) * max_unprintable):
  */
-    __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_data, __pyx_v_i, size_t, 0, __Pyx_PyInt_FromSize_t, 0, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 385, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_3 = PyObject_RichCompare(__pyx_int_0, __pyx_t_1, Py_LE); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 385, __pyx_L1_error)
-    if (__Pyx_PyObject_IsTrue(__pyx_t_3)) {
-      __Pyx_DECREF(__pyx_t_3);
-      __pyx_t_3 = PyObject_RichCompare(__pyx_t_1, __pyx_int_31, Py_LE); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 385, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_data, __pyx_v_i, size_t, 0, __Pyx_PyInt_FromSize_t, 0, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 386, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_3);
+    __pyx_t_1 = PyObject_RichCompare(__pyx_int_0, __pyx_t_3, Py_LE); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 386, __pyx_L1_error)
+    if (__Pyx_PyObject_IsTrue(__pyx_t_1)) {
+      __Pyx_DECREF(__pyx_t_1);
+      __pyx_t_1 = PyObject_RichCompare(__pyx_t_3, __pyx_int_31, Py_LE); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 386, __pyx_L1_error)
     }
-    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 385, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 386, __pyx_L1_error)
+    __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     if (!__pyx_t_7) {
     } else {
       __pyx_t_8 = __pyx_t_7;
-      goto __pyx_L16_bool_binop_done;
+      goto __pyx_L19_bool_binop_done;
     }
-    __pyx_t_3 = __Pyx_GetItemInt(__pyx_v_data, __pyx_v_i, size_t, 0, __Pyx_PyInt_FromSize_t, 0, 0, 0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 385, __pyx_L1_error)
-    __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_1 = PyObject_RichCompare(__pyx_int_127, __pyx_t_3, Py_LE); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 385, __pyx_L1_error)
-    if (__Pyx_PyObject_IsTrue(__pyx_t_1)) {
-      __Pyx_DECREF(__pyx_t_1);
-      __pyx_t_1 = PyObject_RichCompare(__pyx_t_3, __pyx_int_255, Py_LE); __Pyx_XGOTREF(__pyx_t_1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 385, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_data, __pyx_v_i, size_t, 0, __Pyx_PyInt_FromSize_t, 0, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 386, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_1);
+    __pyx_t_3 = PyObject_RichCompare(__pyx_int_127, __pyx_t_1, Py_LE); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 386, __pyx_L1_error)
+    if (__Pyx_PyObject_IsTrue(__pyx_t_3)) {
+      __Pyx_DECREF(__pyx_t_3);
+      __pyx_t_3 = PyObject_RichCompare(__pyx_t_1, __pyx_int_255, Py_LE); __Pyx_XGOTREF(__pyx_t_3); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 386, __pyx_L1_error)
     }
-    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_1); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 385, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+    __pyx_t_7 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_7 < 0)) __PYX_ERR(0, 386, __pyx_L1_error)
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_t_8 = __pyx_t_7;
-    __pyx_L16_bool_binop_done:;
+    __pyx_L19_bool_binop_done:;
     if (__pyx_t_8) {
 
-      /* "resiliparse/parse/encoding.pyx":386
+      /* "resiliparse/parse/encoding.pyx":387
  *     for i in range(<size_t>len(data)):
  *         if 0x00 <= data[i] <= 0x1f or 0x7f <= data[i] <= 0xff:
  *             preinc(unprintable)             # <<<<<<<<<<<<<<
  *         if unprintable > 0 and unprintable > <size_t>(len(data) * max_unprintable):
  *             return 'application/octet-stream'
  */
       (void)((++__pyx_v_unprintable));
 
-      /* "resiliparse/parse/encoding.pyx":385
+      /* "resiliparse/parse/encoding.pyx":386
  *     cdef size_t unprintable = 0
  *     for i in range(<size_t>len(data)):
  *         if 0x00 <= data[i] <= 0x1f or 0x7f <= data[i] <= 0xff:             # <<<<<<<<<<<<<<
  *             preinc(unprintable)
  *         if unprintable > 0 and unprintable > <size_t>(len(data) * max_unprintable):
  */
     }
 
-    /* "resiliparse/parse/encoding.pyx":387
+    /* "resiliparse/parse/encoding.pyx":388
  *         if 0x00 <= data[i] <= 0x1f or 0x7f <= data[i] <= 0xff:
  *             preinc(unprintable)
  *         if unprintable > 0 and unprintable > <size_t>(len(data) * max_unprintable):             # <<<<<<<<<<<<<<
  *             return 'application/octet-stream'
  * 
  */
     __pyx_t_7 = ((__pyx_v_unprintable > 0) != 0);
     if (__pyx_t_7) {
     } else {
       __pyx_t_8 = __pyx_t_7;
-      goto __pyx_L19_bool_binop_done;
+      goto __pyx_L22_bool_binop_done;
     }
     if (unlikely(__pyx_v_data == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-      __PYX_ERR(0, 387, __pyx_L1_error)
+      __PYX_ERR(0, 388, __pyx_L1_error)
     }
-    __pyx_t_10 = PyBytes_GET_SIZE(__pyx_v_data); if (unlikely(__pyx_t_10 == ((Py_ssize_t)-1))) __PYX_ERR(0, 387, __pyx_L1_error)
+    __pyx_t_10 = PyBytes_GET_SIZE(__pyx_v_data); if (unlikely(__pyx_t_10 == ((Py_ssize_t)-1))) __PYX_ERR(0, 388, __pyx_L1_error)
     __pyx_t_7 = ((__pyx_v_unprintable > ((size_t)(__pyx_t_10 * __pyx_v_max_unprintable))) != 0);
     __pyx_t_8 = __pyx_t_7;
-    __pyx_L19_bool_binop_done:;
+    __pyx_L22_bool_binop_done:;
     if (__pyx_t_8) {
 
-      /* "resiliparse/parse/encoding.pyx":388
+      /* "resiliparse/parse/encoding.pyx":389
  *             preinc(unprintable)
  *         if unprintable > 0 and unprintable > <size_t>(len(data) * max_unprintable):
  *             return 'application/octet-stream'             # <<<<<<<<<<<<<<
  * 
  *     return 'text/plain'
  */
       __Pyx_XDECREF(__pyx_r);
       __Pyx_INCREF(__pyx_kp_u_application_octet_stream);
       __pyx_r = __pyx_kp_u_application_octet_stream;
       goto __pyx_L0;
 
-      /* "resiliparse/parse/encoding.pyx":387
+      /* "resiliparse/parse/encoding.pyx":388
  *         if 0x00 <= data[i] <= 0x1f or 0x7f <= data[i] <= 0xff:
  *             preinc(unprintable)
  *         if unprintable > 0 and unprintable > <size_t>(len(data) * max_unprintable):             # <<<<<<<<<<<<<<
  *             return 'application/octet-stream'
  * 
  */
     }
   }
 
-  /* "resiliparse/parse/encoding.pyx":390
+  /* "resiliparse/parse/encoding.pyx":391
  *             return 'application/octet-stream'
  * 
  *     return 'text/plain'             # <<<<<<<<<<<<<<
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_kp_u_text_plain);
   __pyx_r = __pyx_kp_u_text_plain;
   goto __pyx_L0;
 
   /* "resiliparse/parse/encoding.pyx":355
  * 
  * 
  * cpdef str detect_mime(bytes data, float max_unprintable=0.05):             # <<<<<<<<<<<<<<
  *     """
- *     detect_mime(data)
+ *     detect_mime(data, max_unprintable=0.05)
  */
 
   /* function exit code */
   __pyx_L1_error:;
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_XDECREF(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_3);
@@ -5001,15 +5099,15 @@
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* Python wrapper */
 static PyObject *__pyx_pw_11resiliparse_5parse_8encoding_9detect_mime(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
-static char __pyx_doc_11resiliparse_5parse_8encoding_8detect_mime[] = "\n    detect_mime(data)\n    \n    Try to detect common internet MIME types based on the initial magic byte sequence of ``data``.\n    \n    The check is very basic and only checks the starting bytes as well as the number of unprintable\n    bytes. It does not replace a full-blown MIME type detection engine like Apache Tika at the moment.\n    \n    :param data: input bytes\n    :type data: bytes\n    :param max_unprintable: maximum allowable ratio of unprintable characters for text\n    :type max_unprintable: float\n    :return: detected MIME type\n    :rtype: str\n    ";
+static char __pyx_doc_11resiliparse_5parse_8encoding_8detect_mime[] = "\n    detect_mime(data, max_unprintable=0.05)\n    \n    Try to detect common internet MIME types based on the initial magic byte sequence of ``data``.\n    \n    The check is very basic and only checks the starting bytes as well as the number of unprintable\n    bytes. It does not replace a full-blown MIME type detection engine like Apache Tika at the moment.\n    \n    :param data: input bytes\n    :type data: bytes\n    :param max_unprintable: maximum allowable ratio of unprintable characters for text\n    :type max_unprintable: float\n    :return: detected MIME type\n    :rtype: str\n    ";
 static PyObject *__pyx_pw_11resiliparse_5parse_8encoding_9detect_mime(PyObject *__pyx_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
   PyObject *__pyx_v_data = 0;
   float __pyx_v_max_unprintable;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
@@ -5530,14 +5628,17 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
+  #if PY_VERSION_HEX >= 0x030B00A2
+  0, /*tp_inline_values_offset*/
+  #endif
 };
 
 static PyMethodDef __pyx_methods[] = {
   {"detect_encoding", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_11resiliparse_5parse_8encoding_3detect_encoding, METH_VARARGS|METH_KEYWORDS, __pyx_doc_11resiliparse_5parse_8encoding_2detect_encoding},
   {"map_encoding_to_html5", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_11resiliparse_5parse_8encoding_5map_encoding_to_html5, METH_VARARGS|METH_KEYWORDS, __pyx_doc_11resiliparse_5parse_8encoding_4map_encoding_to_html5},
   {"bytes_to_str", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_11resiliparse_5parse_8encoding_7bytes_to_str, METH_VARARGS|METH_KEYWORDS, __pyx_doc_11resiliparse_5parse_8encoding_6bytes_to_str},
   {"detect_mime", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_11resiliparse_5parse_8encoding_9detect_mime, METH_VARARGS|METH_KEYWORDS, __pyx_doc_11resiliparse_5parse_8encoding_8detect_mime},
@@ -5820,14 +5921,15 @@
   {&__pyx_n_s_setstate_cython, __pyx_k_setstate_cython, sizeof(__pyx_k_setstate_cython), 0, 0, 1, 1},
   {&__pyx_n_u_shift_jis, __pyx_k_shift_jis, sizeof(__pyx_k_shift_jis), 0, 1, 0, 1},
   {&__pyx_kp_u_shift_jis_2, __pyx_k_shift_jis_2, sizeof(__pyx_k_shift_jis_2), 0, 1, 0, 0},
   {&__pyx_n_u_sjis, __pyx_k_sjis, sizeof(__pyx_k_sjis), 0, 1, 0, 1},
   {&__pyx_n_s_strip, __pyx_k_strip, sizeof(__pyx_k_strip), 0, 0, 1, 1},
   {&__pyx_n_s_strip_bom, __pyx_k_strip_bom, sizeof(__pyx_k_strip_bom), 0, 0, 1, 1},
   {&__pyx_n_u_sun_eu_greek, __pyx_k_sun_eu_greek, sizeof(__pyx_k_sun_eu_greek), 0, 1, 0, 1},
+  {&__pyx_kp_b_svg, __pyx_k_svg, sizeof(__pyx_k_svg), 0, 0, 0, 0},
   {&__pyx_n_s_t, __pyx_k_t, sizeof(__pyx_k_t), 0, 0, 1, 1},
   {&__pyx_n_s_test, __pyx_k_test, sizeof(__pyx_k_test), 0, 0, 1, 1},
   {&__pyx_kp_u_text_plain, __pyx_k_text_plain, sizeof(__pyx_k_text_plain), 0, 1, 0, 0},
   {&__pyx_kp_u_tis_620, __pyx_k_tis_620, sizeof(__pyx_k_tis_620), 0, 1, 0, 0},
   {&__pyx_n_s_typing, __pyx_k_typing, sizeof(__pyx_k_typing), 0, 0, 1, 1},
   {&__pyx_kp_u_ucs_2, __pyx_k_ucs_2, sizeof(__pyx_k_ucs_2), 0, 1, 0, 0},
   {&__pyx_n_u_unicode, __pyx_k_unicode, sizeof(__pyx_k_unicode), 0, 1, 0, 1},
@@ -8555,15 +8657,15 @@
       } else {
         PyErr_Clear();
         use_cline = NULL;
       }
     }
     if (!use_cline) {
         c_line = 0;
-        PyObject_SetAttr(__pyx_cython_runtime, __pyx_n_s_cline_in_traceback, Py_False);
+        (void) PyObject_SetAttr(__pyx_cython_runtime, __pyx_n_s_cline_in_traceback, Py_False);
     }
     else if (use_cline == Py_False || (use_cline != Py_True && PyObject_Not(use_cline) != 0)) {
         c_line = 0;
     }
     __Pyx_ErrRestoreInState(tstate, ptype, pvalue, ptraceback);
     return c_line;
 }
@@ -8652,38 +8754,39 @@
 /* AddTraceback */
 #include "compile.h"
 #include "frameobject.h"
 #include "traceback.h"
 static PyCodeObject* __Pyx_CreateCodeObjectForTraceback(
             const char *funcname, int c_line,
             int py_line, const char *filename) {
-    PyCodeObject *py_code = 0;
-    PyObject *py_srcfile = 0;
-    PyObject *py_funcname = 0;
+    PyCodeObject *py_code = NULL;
+    PyObject *py_funcname = NULL;
     #if PY_MAJOR_VERSION < 3
+    PyObject *py_srcfile = NULL;
     py_srcfile = PyString_FromString(filename);
-    #else
-    py_srcfile = PyUnicode_FromString(filename);
-    #endif
     if (!py_srcfile) goto bad;
+    #endif
     if (c_line) {
         #if PY_MAJOR_VERSION < 3
         py_funcname = PyString_FromFormat( "%s (%s:%d)", funcname, __pyx_cfilenm, c_line);
+        if (!py_funcname) goto bad;
         #else
         py_funcname = PyUnicode_FromFormat( "%s (%s:%d)", funcname, __pyx_cfilenm, c_line);
+        if (!py_funcname) goto bad;
+        funcname = PyUnicode_AsUTF8(py_funcname);
+        if (!funcname) goto bad;
         #endif
     }
     else {
         #if PY_MAJOR_VERSION < 3
         py_funcname = PyString_FromString(funcname);
-        #else
-        py_funcname = PyUnicode_FromString(funcname);
+        if (!py_funcname) goto bad;
         #endif
     }
-    if (!py_funcname) goto bad;
+    #if PY_MAJOR_VERSION < 3
     py_code = __Pyx_PyCode_New(
         0,
         0,
         0,
         0,
         0,
         __pyx_empty_bytes, /*PyObject *code,*/
@@ -8694,19 +8797,24 @@
         __pyx_empty_tuple, /*PyObject *cellvars,*/
         py_srcfile,   /*PyObject *filename,*/
         py_funcname,  /*PyObject *name,*/
         py_line,
         __pyx_empty_bytes  /*PyObject *lnotab*/
     );
     Py_DECREF(py_srcfile);
-    Py_DECREF(py_funcname);
+    #else
+    py_code = PyCode_NewEmpty(filename, funcname, py_line);
+    #endif
+    Py_XDECREF(py_funcname);  // XDECREF since it's only set on Py3 if cline
     return py_code;
 bad:
-    Py_XDECREF(py_srcfile);
     Py_XDECREF(py_funcname);
+    #if PY_MAJOR_VERSION < 3
+    Py_XDECREF(py_srcfile);
+    #endif
     return NULL;
 }
 static void __Pyx_AddTraceback(const char *funcname, int c_line,
                                int py_line, const char *filename) {
     PyCodeObject *py_code = 0;
     PyFrameObject *py_frame = 0;
     PyThreadState *tstate = __Pyx_PyThreadState_Current;
@@ -9779,14 +9887,31 @@
   }
   x = PyNumber_Index(b);
   if (!x) return -1;
   ival = PyInt_AsSsize_t(x);
   Py_DECREF(x);
   return ival;
 }
+static CYTHON_INLINE Py_hash_t __Pyx_PyIndex_AsHash_t(PyObject* o) {
+  if (sizeof(Py_hash_t) == sizeof(Py_ssize_t)) {
+    return (Py_hash_t) __Pyx_PyIndex_AsSsize_t(o);
+#if PY_MAJOR_VERSION < 3
+  } else if (likely(PyInt_CheckExact(o))) {
+    return PyInt_AS_LONG(o);
+#endif
+  } else {
+    Py_ssize_t ival;
+    PyObject *x;
+    x = PyNumber_Index(o);
+    if (!x) return -1;
+    ival = PyInt_AsLong(x);
+    Py_DECREF(x);
+    return ival;
+  }
+}
 static CYTHON_INLINE PyObject * __Pyx_PyBool_FromLong(long b) {
   return b ? __Pyx_NewRef(Py_True) : __Pyx_NewRef(Py_False);
 }
 static CYTHON_INLINE PyObject * __Pyx_PyInt_FromSize_t(size_t ival) {
     return PyInt_FromSize_t(ival);
 }
```

### Comparing `Resiliparse-0.8.1/resiliparse/parse/encoding.h` & `Resiliparse-0.9.0/resiliparse/parse/encoding.h`

 * *Files identical despite different names*

### Comparing `Resiliparse-0.8.1/resiliparse/parse/encoding.pxd` & `Resiliparse-0.9.0/resiliparse/parse/encoding.pxd`

 * *Files identical despite different names*

### Comparing `Resiliparse-0.8.1/resiliparse/parse/encoding.pyx` & `Resiliparse-0.9.0/resiliparse/parse/encoding.pyx`

 * *Files 1% similar despite different names*

```diff
@@ -350,15 +350,15 @@
             pass
 
     return data.decode(__map_utf(encoding, data, strip_bom), errors=errors).encode(errors=errors).decode()
 
 
 cpdef str detect_mime(bytes data, float max_unprintable=0.05):
     """
-    detect_mime(data)
+    detect_mime(data, max_unprintable=0.05)
     
     Try to detect common internet MIME types based on the initial magic byte sequence of ``data``.
     
     The check is very basic and only checks the starting bytes as well as the number of unprintable
     bytes. It does not replace a full-blown MIME type detection engine like Apache Tika at the moment.
     
     :param data: input bytes
@@ -369,19 +369,20 @@
     :rtype: str
     """
 
     cdef size_t i
     cdef bytes data_strip = data[:128].lstrip()
     for i in range(MIME_BYTES.size()):
         if data.startswith(MIME_BYTES[i].magic_bytes) or data_strip.startswith(MIME_BYTES[i].magic_bytes):
-            if MIME_BYTES[i].mime_type in [b'application/xml', b'text/html']:
+            if MIME_BYTES[i].mime_type in [b'text/html', b'application/xml']:
                 if data_strip.find(b'"-//W3C//DTD XHTML') > -1:
                     return 'application/xhtml+xml'
-                if data_strip.find(b'"-//W3C//DTD SVG') > -1:
-                    return 'image/svg+xml'
+                if MIME_BYTES[i].mime_type == b'application/xml':
+                    if data_strip.find(b'<svg ') > -1 or data_strip.find(b'"-//W3C//DTD SVG') > -1:
+                        return 'image/svg+xml'
             return MIME_BYTES[i].mime_type.decode()
 
     cdef size_t unprintable = 0
     for i in range(<size_t>len(data)):
         if 0x00 <= data[i] <= 0x1f or 0x7f <= data[i] <= 0xff:
             preinc(unprintable)
         if unprintable > 0 and unprintable > <size_t>(len(data) * max_unprintable):
```

### Comparing `Resiliparse-0.8.1/resiliparse/parse/html.cpp` & `Resiliparse-0.9.0/resiliparse/parse/html.cpp`

 * *Files 0% similar despite different names*

```diff
@@ -1,8 +1,8 @@
-/* Generated by Cython 0.29.24 */
+/* Generated by Cython 0.29.25 */
 
 /* BEGIN: Cython Metadata
 {
     "distutils": {
         "depends": [
             "resiliparse/parse/encoding.h",
             "resiliparse/parse/html.h"
@@ -41,16 +41,16 @@
 #endif /* PY_SSIZE_T_CLEAN */
 #include "Python.h"
 #ifndef Py_PYTHON_H
     #error Python headers needed to compile C extensions, please install development version of Python.
 #elif PY_VERSION_HEX < 0x02060000 || (0x03000000 <= PY_VERSION_HEX && PY_VERSION_HEX < 0x03030000)
     #error Cython requires Python 2.6+ or Python 3.3+.
 #else
-#define CYTHON_ABI "0_29_24"
-#define CYTHON_HEX_VERSION 0x001D18F0
+#define CYTHON_ABI "0_29_25"
+#define CYTHON_HEX_VERSION 0x001D19F0
 #define CYTHON_FUTURE_DIVISION 1
 #include <stddef.h>
 #ifndef offsetof
   #define offsetof(type, member) ( (size_t) & ((type*)0) -> member )
 #endif
 #if !defined(WIN32) && !defined(MS_WINDOWS)
   #ifndef __stdcall
@@ -189,15 +189,15 @@
   #endif
   #ifndef CYTHON_USE_PYLIST_INTERNALS
     #define CYTHON_USE_PYLIST_INTERNALS 1
   #endif
   #ifndef CYTHON_USE_UNICODE_INTERNALS
     #define CYTHON_USE_UNICODE_INTERNALS 1
   #endif
-  #if PY_VERSION_HEX < 0x030300F0
+  #if PY_VERSION_HEX < 0x030300F0 || PY_VERSION_HEX >= 0x030B00A2
     #undef CYTHON_USE_UNICODE_WRITER
     #define CYTHON_USE_UNICODE_WRITER 0
   #elif !defined(CYTHON_USE_UNICODE_WRITER)
     #define CYTHON_USE_UNICODE_WRITER 1
   #endif
   #ifndef CYTHON_AVOID_BORROWED_REFS
     #define CYTHON_AVOID_BORROWED_REFS 0
@@ -208,15 +208,15 @@
   #ifndef CYTHON_UNPACK_METHODS
     #define CYTHON_UNPACK_METHODS 1
   #endif
   #ifndef CYTHON_FAST_THREAD_STATE
     #define CYTHON_FAST_THREAD_STATE 1
   #endif
   #ifndef CYTHON_FAST_PYCALL
-    #define CYTHON_FAST_PYCALL 1
+    #define CYTHON_FAST_PYCALL (PY_VERSION_HEX < 0x030B00A1)
   #endif
   #ifndef CYTHON_PEP489_MULTI_PHASE_INIT
     #define CYTHON_PEP489_MULTI_PHASE_INIT (PY_VERSION_HEX >= 0x03050000)
   #endif
   #ifndef CYTHON_USE_TP_FINALIZE
     #define CYTHON_USE_TP_FINALIZE (PY_VERSION_HEX >= 0x030400a1)
   #endif
@@ -227,15 +227,17 @@
     #define CYTHON_USE_EXC_INFO_STACK (PY_VERSION_HEX >= 0x030700A3)
   #endif
 #endif
 #if !defined(CYTHON_FAST_PYCCALL)
 #define CYTHON_FAST_PYCCALL  (CYTHON_FAST_PYCALL && PY_VERSION_HEX >= 0x030600B1)
 #endif
 #if CYTHON_USE_PYLONG_INTERNALS
-  #include "longintrepr.h"
+  #if PY_MAJOR_VERSION < 3
+    #include "longintrepr.h"
+  #endif
   #undef SHIFT
   #undef BASE
   #undef MASK
   #ifdef SIZEOF_VOID_P
     enum { __pyx_check_sizeof_voidp = 1 / (int)(SIZEOF_VOID_P == sizeof(void*)) };
   #endif
 #endif
@@ -358,17 +360,76 @@
 #if PY_MAJOR_VERSION < 3
   #define __Pyx_BUILTIN_MODULE_NAME "__builtin__"
   #define __Pyx_PyCode_New(a, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)\
           PyCode_New(a+k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)
   #define __Pyx_DefaultClassType PyClass_Type
 #else
   #define __Pyx_BUILTIN_MODULE_NAME "builtins"
-#if PY_VERSION_HEX >= 0x030800A4 && PY_VERSION_HEX < 0x030800B2
-  #define __Pyx_PyCode_New(a, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)\
-          PyCode_New(a, 0, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)
+  #define __Pyx_DefaultClassType PyType_Type
+#if PY_VERSION_HEX >= 0x030B00A1
+    static CYTHON_INLINE PyCodeObject* __Pyx_PyCode_New(int a, int k, int l, int s, int f,
+                                                    PyObject *code, PyObject *c, PyObject* n, PyObject *v,
+                                                    PyObject *fv, PyObject *cell, PyObject* fn,
+                                                    PyObject *name, int fline, PyObject *lnos) {
+        PyObject *kwds=NULL, *argcount=NULL, *posonlyargcount=NULL, *kwonlyargcount=NULL;
+        PyObject *nlocals=NULL, *stacksize=NULL, *flags=NULL, *replace=NULL, *call_result=NULL, *empty=NULL;
+        const char *fn_cstr=NULL;
+        const char *name_cstr=NULL;
+        PyCodeObject* co=NULL;
+        PyObject *type, *value, *traceback;
+        PyErr_Fetch(&type, &value, &traceback);
+        if (!(kwds=PyDict_New())) goto end;
+        if (!(argcount=PyLong_FromLong(a))) goto end;
+        if (PyDict_SetItemString(kwds, "co_argcount", argcount) != 0) goto end;
+        if (!(posonlyargcount=PyLong_FromLong(0))) goto end;
+        if (PyDict_SetItemString(kwds, "co_posonlyargcount", posonlyargcount) != 0) goto end;
+        if (!(kwonlyargcount=PyLong_FromLong(k))) goto end;
+        if (PyDict_SetItemString(kwds, "co_kwonlyargcount", kwonlyargcount) != 0) goto end;
+        if (!(nlocals=PyLong_FromLong(l))) goto end;
+        if (PyDict_SetItemString(kwds, "co_nlocals", nlocals) != 0) goto end;
+        if (!(stacksize=PyLong_FromLong(s))) goto end;
+        if (PyDict_SetItemString(kwds, "co_stacksize", stacksize) != 0) goto end;
+        if (!(flags=PyLong_FromLong(f))) goto end;
+        if (PyDict_SetItemString(kwds, "co_flags", flags) != 0) goto end;
+        if (PyDict_SetItemString(kwds, "co_code", code) != 0) goto end;
+        if (PyDict_SetItemString(kwds, "co_consts", c) != 0) goto end;
+        if (PyDict_SetItemString(kwds, "co_names", n) != 0) goto end;
+        if (PyDict_SetItemString(kwds, "co_varnames", v) != 0) goto end;
+        if (PyDict_SetItemString(kwds, "co_freevars", fv) != 0) goto end;
+        if (PyDict_SetItemString(kwds, "co_cellvars", cell) != 0) goto end;
+        if (PyDict_SetItemString(kwds, "co_linetable", lnos) != 0) goto end;
+        if (!(fn_cstr=PyUnicode_AsUTF8AndSize(fn, NULL))) goto end;
+        if (!(name_cstr=PyUnicode_AsUTF8AndSize(name, NULL))) goto end;
+        if (!(co = PyCode_NewEmpty(fn_cstr, name_cstr, fline))) goto end;
+        if (!(replace = PyObject_GetAttrString((PyObject*)co, "replace"))) goto cleanup_code_too;
+        if (!(empty = PyTuple_New(0))) goto cleanup_code_too; // unfortunately __pyx_empty_tuple isn't available here
+        if (!(call_result = PyObject_Call(replace, empty, kwds))) goto cleanup_code_too;
+        Py_XDECREF((PyObject*)co);
+        co = (PyCodeObject*)call_result;
+        call_result = NULL;
+        if (0) {
+            cleanup_code_too:
+            Py_XDECREF((PyObject*)co);
+            co = NULL;
+        }
+        end:
+        Py_XDECREF(kwds);
+        Py_XDECREF(argcount);
+        Py_XDECREF(posonlyargcount);
+        Py_XDECREF(kwonlyargcount);
+        Py_XDECREF(nlocals);
+        Py_XDECREF(stacksize);
+        Py_XDECREF(replace);
+        Py_XDECREF(call_result);
+        Py_XDECREF(empty);
+        if (type) {
+            PyErr_Restore(type, value, traceback);
+        }
+        return co;
+    }
 #else
   #define __Pyx_PyCode_New(a, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)\
           PyCode_New(a, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)
 #endif
   #define __Pyx_DefaultClassType PyType_Type
 #endif
 #ifndef Py_TPFLAGS_CHECKTYPES
@@ -598,18 +659,18 @@
   #ifndef PyUnicode_InternFromString
     #define PyUnicode_InternFromString(s) PyUnicode_FromString(s)
   #endif
 #endif
 #if PY_VERSION_HEX < 0x030200A4
   typedef long Py_hash_t;
   #define __Pyx_PyInt_FromHash_t PyInt_FromLong
-  #define __Pyx_PyInt_AsHash_t   PyInt_AsLong
+  #define __Pyx_PyInt_AsHash_t   __Pyx_PyIndex_AsHash_t
 #else
   #define __Pyx_PyInt_FromHash_t PyInt_FromSsize_t
-  #define __Pyx_PyInt_AsHash_t   PyInt_AsSsize_t
+  #define __Pyx_PyInt_AsHash_t   __Pyx_PyIndex_AsSsize_t
 #endif
 #if PY_MAJOR_VERSION >= 3
   #define __Pyx_PyMethod_New(func, self, klass) ((self) ? ((void)(klass), PyMethod_New(func, self)) : __Pyx_NewRef(func))
 #else
   #define __Pyx_PyMethod_New(func, self, klass) PyMethod_New(func, self, klass)
 #endif
 #if CYTHON_USE_ASYNC_SLOTS
@@ -670,15 +731,16 @@
 #include "ios"
 #include "new"
 #include "stdexcept"
 #include "typeinfo"
 #include <stdint.h>
 #include <utility>
 
-    #if __cplusplus > 199711L
+    #if __cplusplus >= 201103L || (defined(_MSC_VER) && _MSC_VER >= 1600)
+    // move should be defined for these versions of MSVC, but __cplusplus isn't set usefully
     #include <type_traits>
 
     namespace cython_std {
     template <typename T> typename std::remove_reference<T>::type&& move(T& t) noexcept { return std::move(t); }
     template <typename T> typename std::remove_reference<T>::type&& move(T&& t) noexcept { return std::move(t); }
     }
 
@@ -834,14 +896,15 @@
 static CYTHON_INLINE int __Pyx_PyObject_IsTrue(PyObject*);
 static CYTHON_INLINE int __Pyx_PyObject_IsTrueAndDecref(PyObject*);
 static CYTHON_INLINE PyObject* __Pyx_PyNumber_IntOrLong(PyObject* x);
 #define __Pyx_PySequence_Tuple(obj)\
     (likely(PyTuple_CheckExact(obj)) ? __Pyx_NewRef(obj) : PySequence_Tuple(obj))
 static CYTHON_INLINE Py_ssize_t __Pyx_PyIndex_AsSsize_t(PyObject*);
 static CYTHON_INLINE PyObject * __Pyx_PyInt_FromSize_t(size_t);
+static CYTHON_INLINE Py_hash_t __Pyx_PyIndex_AsHash_t(PyObject*);
 #if CYTHON_ASSUME_SAFE_MACROS
 #define __pyx_PyFloat_AsDouble(x) (PyFloat_CheckExact(x) ? PyFloat_AS_DOUBLE(x) : PyFloat_AsDouble(x))
 #else
 #define __pyx_PyFloat_AsDouble(x) PyFloat_AsDouble(x)
 #endif
 #define __pyx_PyFloat_AsFloat(x) ((float) __pyx_PyFloat_AsDouble(x))
 #if PY_MAJOR_VERSION >= 3
@@ -1051,15 +1114,15 @@
 struct __pyx_opt_args_11resiliparse_5parse_4html_7DOMNode_get_elements_by_class_name;
 struct __pyx_opt_args_11resiliparse_5parse_4html_13DOMCollection_get_element_by_id;
 struct __pyx_opt_args_11resiliparse_5parse_4html_13DOMCollection_get_elements_by_attr;
 struct __pyx_opt_args_11resiliparse_5parse_4html_13DOMCollection_get_elements_by_class_name;
 struct __pyx_opt_args_11resiliparse_5parse_4html_create_html_tree;
 struct __pyx_t_11resiliparse_5parse_4html_element_by_id_match_ctx;
 
-/* "resiliparse/parse/html.pxd":123
+/* "resiliparse/parse/html.pxd":131
  * 
  * # noinspection DuplicatedCode
  * cpdef enum NodeType:             # <<<<<<<<<<<<<<
  *     ELEMENT = 0x01,
  *     ATTRIBUTE = 0x02,
  */
 enum __pyx_t_11resiliparse_5parse_4html_NodeType {
@@ -1074,213 +1137,213 @@
   __pyx_e_11resiliparse_5parse_4html_DOCUMENT = 0x09,
   __pyx_e_11resiliparse_5parse_4html_DOCUMENT_TYPE = 0x0A,
   __pyx_e_11resiliparse_5parse_4html_DOCUMENT_FRAGMENT = 0x0B,
   __pyx_e_11resiliparse_5parse_4html_NOTATION = 0x0C,
   __pyx_e_11resiliparse_5parse_4html_LAST_ENTRY = 0x0D
 };
 
-/* "resiliparse/parse/html.pxd":26
- * 
+/* "resiliparse/parse/html.pxd":33
+ *                                                   size_t selector_len) except NULL
  * 
  * cdef lxb_dom_node_t* next_node(const lxb_dom_node_t* root_node, lxb_dom_node_t* node,             # <<<<<<<<<<<<<<
  *                                size_t* depth=*, bint* end_tag=*) nogil
  * 
  */
 struct __pyx_opt_args_11resiliparse_5parse_4html_next_node {
   int __pyx_n;
   size_t *depth;
   int *end_tag;
 };
 
-/* "resiliparse/parse/html.pxd":29
+/* "resiliparse/parse/html.pxd":36
  *                                size_t* depth=*, bint* end_tag=*) nogil
  * 
  * cdef inline lxb_dom_node_t* next_element_node(const lxb_dom_node_t* root_node, lxb_dom_node_t* node,             # <<<<<<<<<<<<<<
  *                                               size_t* depth=NULL, bint* end_tag=NULL) nogil:
  *     node = next_node(root_node, node, depth, end_tag)
  */
 struct __pyx_opt_args_11resiliparse_5parse_4html_next_element_node {
   int __pyx_n;
   size_t *depth;
   int *end_tag;
 };
 
-/* "resiliparse/parse/html.pxd":52
+/* "resiliparse/parse/html.pxd":59
  * cdef string get_node_text(lxb_dom_node_t* node) nogil
  * 
  * cdef lxb_dom_node_t* get_element_by_id_impl(lxb_dom_node_t* node, bytes id_value, bint case_insensitive=*)             # <<<<<<<<<<<<<<
  * cdef lxb_dom_collection_t* get_elements_by_attr_impl(lxb_dom_node_t* node, bytes attr_name, bytes attr_value,
  *                                                      size_t init_size=*, bint case_insensitive=*)
  */
 struct __pyx_opt_args_11resiliparse_5parse_4html_get_element_by_id_impl {
   int __pyx_n;
   int case_insensitive;
 };
 
-/* "resiliparse/parse/html.pxd":53
+/* "resiliparse/parse/html.pxd":60
  * 
  * cdef lxb_dom_node_t* get_element_by_id_impl(lxb_dom_node_t* node, bytes id_value, bint case_insensitive=*)
  * cdef lxb_dom_collection_t* get_elements_by_attr_impl(lxb_dom_node_t* node, bytes attr_name, bytes attr_value,             # <<<<<<<<<<<<<<
  *                                                      size_t init_size=*, bint case_insensitive=*)
  * cdef lxb_dom_collection_t* get_elements_by_class_name_impl(lxb_dom_node_t* node, bytes class_name, size_t init_size=*)
  */
 struct __pyx_opt_args_11resiliparse_5parse_4html_get_elements_by_attr_impl {
   int __pyx_n;
   size_t init_size;
   int case_insensitive;
 };
 
-/* "resiliparse/parse/html.pxd":55
+/* "resiliparse/parse/html.pxd":62
  * cdef lxb_dom_collection_t* get_elements_by_attr_impl(lxb_dom_node_t* node, bytes attr_name, bytes attr_value,
  *                                                      size_t init_size=*, bint case_insensitive=*)
  * cdef lxb_dom_collection_t* get_elements_by_class_name_impl(lxb_dom_node_t* node, bytes class_name, size_t init_size=*)             # <<<<<<<<<<<<<<
  * cdef lxb_dom_collection_t* get_elements_by_tag_name_impl(lxb_dom_node_t* node, bytes tag_name)
- * cdef lxb_dom_node_t* query_selector_impl(lxb_dom_node_t* node, HTMLTree tree, bytes selector)
+ * cdef lxb_dom_node_t* query_selector_impl(lxb_dom_node_t* node, HTMLTree tree,
  */
 struct __pyx_opt_args_11resiliparse_5parse_4html_get_elements_by_class_name_impl {
   int __pyx_n;
   size_t init_size;
 };
 
-/* "resiliparse/parse/html.pxd":58
- * cdef lxb_dom_collection_t* get_elements_by_tag_name_impl(lxb_dom_node_t* node, bytes tag_name)
- * cdef lxb_dom_node_t* query_selector_impl(lxb_dom_node_t* node, HTMLTree tree, bytes selector)
+/* "resiliparse/parse/html.pxd":66
+ * cdef lxb_dom_node_t* query_selector_impl(lxb_dom_node_t* node, HTMLTree tree,
+ *                                          bytes selector) except <lxb_dom_node_t*>-1
  * cdef lxb_dom_collection_t* query_selector_all_impl(lxb_dom_node_t* node, HTMLTree tree, bytes selector,             # <<<<<<<<<<<<<<
- *                                                    size_t init_size=*)
+ *                                                    size_t init_size=*) except <lxb_dom_collection_t*>-1
  * cdef bint matches_impl(lxb_dom_node_t* node, HTMLTree tree, bytes selector)
  */
 struct __pyx_opt_args_11resiliparse_5parse_4html_query_selector_all_impl {
   int __pyx_n;
   size_t init_size;
 };
 
-/* "resiliparse/parse/html.pxd":82
+/* "resiliparse/parse/html.pxd":90
  * 
  *     cpdef bint hasattr(self, str attr_name) except -1
  *     cdef str _getattr_impl(self, const string& attr_name, bint raise_if_not_exists=*)             # <<<<<<<<<<<<<<
  *     cpdef str getattr(self, str attr_name, str default_value=*)
  *     cdef bint _setattr_impl(self, bytes attr_name, bytes attr_value)  except -1
  */
 struct __pyx_opt_args_11resiliparse_5parse_4html_7DOMNode__getattr_impl {
   int __pyx_n;
   int raise_if_not_exists;
 };
 
-/* "resiliparse/parse/html.pxd":83
+/* "resiliparse/parse/html.pxd":91
  *     cpdef bint hasattr(self, str attr_name) except -1
  *     cdef str _getattr_impl(self, const string& attr_name, bint raise_if_not_exists=*)
  *     cpdef str getattr(self, str attr_name, str default_value=*)             # <<<<<<<<<<<<<<
  *     cdef bint _setattr_impl(self, bytes attr_name, bytes attr_value)  except -1
  *     cpdef setattr(self, str attr_name, str attr_value)
  */
 struct __pyx_opt_args_11resiliparse_5parse_4html_7DOMNode_getattr {
   int __pyx_n;
   PyObject *default_value;
 };
 
-/* "resiliparse/parse/html.pxd":89
+/* "resiliparse/parse/html.pxd":97
  *     cpdef delattr(self, str attr_name)
  * 
  *     cpdef DOMNode get_element_by_id(self, str element_id, bint case_insensitive=*)             # <<<<<<<<<<<<<<
  *     cpdef DOMCollection get_elements_by_attr(self, str attr_name, str attr_value, bint case_insensitive=*)
  *     cpdef DOMCollection get_elements_by_class_name(self, str class_name, bint case_insensitive=*)
  */
 struct __pyx_opt_args_11resiliparse_5parse_4html_7DOMNode_get_element_by_id {
   int __pyx_n;
   int case_insensitive;
 };
 
-/* "resiliparse/parse/html.pxd":90
+/* "resiliparse/parse/html.pxd":98
  * 
  *     cpdef DOMNode get_element_by_id(self, str element_id, bint case_insensitive=*)
  *     cpdef DOMCollection get_elements_by_attr(self, str attr_name, str attr_value, bint case_insensitive=*)             # <<<<<<<<<<<<<<
  *     cpdef DOMCollection get_elements_by_class_name(self, str class_name, bint case_insensitive=*)
  *     cpdef DOMCollection get_elements_by_tag_name(self, str tag_name)
  */
 struct __pyx_opt_args_11resiliparse_5parse_4html_7DOMNode_get_elements_by_attr {
   int __pyx_n;
   int case_insensitive;
 };
 
-/* "resiliparse/parse/html.pxd":91
+/* "resiliparse/parse/html.pxd":99
  *     cpdef DOMNode get_element_by_id(self, str element_id, bint case_insensitive=*)
  *     cpdef DOMCollection get_elements_by_attr(self, str attr_name, str attr_value, bint case_insensitive=*)
  *     cpdef DOMCollection get_elements_by_class_name(self, str class_name, bint case_insensitive=*)             # <<<<<<<<<<<<<<
  *     cpdef DOMCollection get_elements_by_tag_name(self, str tag_name)
  * 
  */
 struct __pyx_opt_args_11resiliparse_5parse_4html_7DOMNode_get_elements_by_class_name {
   int __pyx_n;
   int case_insensitive;
 };
 
-/* "resiliparse/parse/html.pxd":112
+/* "resiliparse/parse/html.pxd":120
  *     cdef DOMCollection _forward_collection_match(self, bytes func, attrs)
  * 
  *     cpdef DOMNode get_element_by_id(self, str element_id, bint case_insensitive=*)             # <<<<<<<<<<<<<<
  *     cpdef DOMCollection get_elements_by_attr(self, str attr_name, str attr_value, bint case_insensitive=*)
  *     cpdef DOMCollection get_elements_by_class_name(self, str class_name, bint case_insensitive=*)
  */
 struct __pyx_opt_args_11resiliparse_5parse_4html_13DOMCollection_get_element_by_id {
   int __pyx_n;
   int case_insensitive;
 };
 
-/* "resiliparse/parse/html.pxd":113
+/* "resiliparse/parse/html.pxd":121
  * 
  *     cpdef DOMNode get_element_by_id(self, str element_id, bint case_insensitive=*)
  *     cpdef DOMCollection get_elements_by_attr(self, str attr_name, str attr_value, bint case_insensitive=*)             # <<<<<<<<<<<<<<
  *     cpdef DOMCollection get_elements_by_class_name(self, str class_name, bint case_insensitive=*)
  *     cpdef DOMCollection get_elements_by_tag_name(self, str tag_name)
  */
 struct __pyx_opt_args_11resiliparse_5parse_4html_13DOMCollection_get_elements_by_attr {
   int __pyx_n;
   int case_insensitive;
 };
 
-/* "resiliparse/parse/html.pxd":114
+/* "resiliparse/parse/html.pxd":122
  *     cpdef DOMNode get_element_by_id(self, str element_id, bint case_insensitive=*)
  *     cpdef DOMCollection get_elements_by_attr(self, str attr_name, str attr_value, bint case_insensitive=*)
  *     cpdef DOMCollection get_elements_by_class_name(self, str class_name, bint case_insensitive=*)             # <<<<<<<<<<<<<<
  *     cpdef DOMCollection get_elements_by_tag_name(self, str tag_name)
  * 
  */
 struct __pyx_opt_args_11resiliparse_5parse_4html_13DOMCollection_get_elements_by_class_name {
   int __pyx_n;
   int case_insensitive;
 };
 
-/* "resiliparse/parse/html.pxd":139
+/* "resiliparse/parse/html.pxd":147
  * 
  * 
  * cdef HTMLTree create_html_tree(bytes document, bint reencode=*, str encoding=*, str errors=*)             # <<<<<<<<<<<<<<
  * 
  * cdef class HTMLTree:
  */
 struct __pyx_opt_args_11resiliparse_5parse_4html_create_html_tree {
   int __pyx_n;
   int reencode;
   PyObject *encoding;
   PyObject *errors;
 };
 
-/* "resiliparse/parse/html.pyx":117
+/* "resiliparse/parse/html.pyx":165
  * 
  * 
  * cdef struct element_by_id_match_ctx:             # <<<<<<<<<<<<<<
  *     const lxb_char_t* id_val
  *     size_t id_val_len
  */
 struct __pyx_t_11resiliparse_5parse_4html_element_by_id_match_ctx {
   lxb_char_t const *id_val;
   size_t id_val_len;
   lxb_dom_node_t *result_node;
 };
 
-/* "resiliparse/parse/html.pyx":122
+/* "resiliparse/parse/html.pyx":170
  *     lxb_dom_node_t* result_node
  * 
  * ctypedef element_by_id_match_ctx element_by_id_match_ctx_t             # <<<<<<<<<<<<<<
  * 
  * 
  */
 typedef struct __pyx_t_11resiliparse_5parse_4html_element_by_id_match_ctx __pyx_t_11resiliparse_5parse_4html_element_by_id_match_ctx_t;
@@ -1295,29 +1358,29 @@
 struct __pyx_obj_11resiliparse_5parse_8encoding_EncodingDetector {
   PyObject_HEAD
   struct __pyx_vtabstruct_11resiliparse_5parse_8encoding_EncodingDetector *__pyx_vtab;
   uchardet_t d;
 };
 
 
-/* "resiliparse/parse/html.pxd":67
+/* "resiliparse/parse/html.pxd":75
  * 
  * 
  * cdef class DOMElementClassList:             # <<<<<<<<<<<<<<
  *     cdef DOMNode node
  * 
  */
 struct __pyx_obj_11resiliparse_5parse_4html_DOMElementClassList {
   PyObject_HEAD
   struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMElementClassList *__pyx_vtab;
   struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *node;
 };
 
 
-/* "resiliparse/parse/html.pxd":76
+/* "resiliparse/parse/html.pxd":84
  * 
  * 
  * cdef class DOMNode:             # <<<<<<<<<<<<<<
  *     cdef HTMLTree tree
  *     cdef lxb_dom_node_t* node
  */
 struct __pyx_obj_11resiliparse_5parse_4html_DOMNode {
@@ -1325,30 +1388,30 @@
   struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMNode *__pyx_vtab;
   struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *tree;
   lxb_dom_node_t *node;
   struct __pyx_obj_11resiliparse_5parse_4html_DOMElementClassList *class_list_singleton;
 };
 
 
-/* "resiliparse/parse/html.pxd":105
+/* "resiliparse/parse/html.pxd":113
  * 
  * 
  * cdef class DOMCollection:             # <<<<<<<<<<<<<<
  *     cdef HTMLTree tree
  *     cdef lxb_dom_collection_t* coll
  */
 struct __pyx_obj_11resiliparse_5parse_4html_DOMCollection {
   PyObject_HEAD
   struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMCollection *__pyx_vtab;
   struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *tree;
   lxb_dom_collection_t *coll;
 };
 
 
-/* "resiliparse/parse/html.pxd":141
+/* "resiliparse/parse/html.pxd":149
  * cdef HTMLTree create_html_tree(bytes document, bint reencode=*, str encoding=*, str errors=*)
  * 
  * cdef class HTMLTree:             # <<<<<<<<<<<<<<
  *     cdef lxb_html_document_t* dom_document
  *     cdef str encoding
  */
 struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree {
@@ -1358,56 +1421,56 @@
   PyObject *encoding;
   lxb_css_parser_t *css_parser;
   lxb_selectors_t *selectors;
   lxb_css_selectors_t *css_selectors;
 };
 
 
-/* "resiliparse/parse/html.pyx":445
+/* "resiliparse/parse/html.pyx":491
  *         self.node = NULL
  * 
  *     def __iter__(self):             # <<<<<<<<<<<<<<
  *         """
  *         __iter__(self)
  */
 struct __pyx_obj_11resiliparse_5parse_4html___pyx_scope_struct____iter__ {
   PyObject_HEAD
   lxb_dom_node_t *__pyx_v_node;
   struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *__pyx_v_self;
 };
 
 
-/* "resiliparse/parse/html.pyx":1194
+/* "resiliparse/parse/html.pyx":1240
  *         self.tree = None
  * 
  *     def __repr__(self):             # <<<<<<<<<<<<<<
  *         if not check_node(self):
  *             return '<INVALID ELEMENT>'
  */
 struct __pyx_obj_11resiliparse_5parse_4html___pyx_scope_struct_1___repr__ {
   PyObject_HEAD
   struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *__pyx_v_self;
 };
 
 
-/* "resiliparse/parse/html.pyx":1199
+/* "resiliparse/parse/html.pyx":1245
  * 
  *         if self.node.type == LXB_DOM_NODE_TYPE_ELEMENT:
  *             attrs = ' '.join(f'{a}="{self[a]}"' for a in self.attrs)             # <<<<<<<<<<<<<<
  *             if attrs:
  *                 attrs = ' ' + attrs
  */
 struct __pyx_obj_11resiliparse_5parse_4html___pyx_scope_struct_2_genexpr {
   PyObject_HEAD
   struct __pyx_obj_11resiliparse_5parse_4html___pyx_scope_struct_1___repr__ *__pyx_outer_scope;
   PyObject *__pyx_v_a;
 };
 
 
-/* "resiliparse/parse/html.pyx":1443
+/* "resiliparse/parse/html.pyx":1489
  *         return False
  * 
  *     def __iter__(self):             # <<<<<<<<<<<<<<
  *         """
  *         __iter__(self)
  */
 struct __pyx_obj_11resiliparse_5parse_4html___pyx_scope_struct_3___iter__ {
@@ -1416,28 +1479,28 @@
   struct __pyx_obj_11resiliparse_5parse_4html_DOMCollection *__pyx_v_self;
   size_t __pyx_t_0;
   size_t __pyx_t_1;
   size_t __pyx_t_2;
 };
 
 
-/* "resiliparse/parse/html.pyx":1521
+/* "resiliparse/parse/html.pyx":1567
  *         return _create_dom_node(self.tree, lxb_dom_collection_node(self.coll, self._wrap_idx(key)))
  * 
  *     def __repr__(self):             # <<<<<<<<<<<<<<
  *         return f'{{{", ".join(repr(n) for n in self)}}}'
  * 
  */
 struct __pyx_obj_11resiliparse_5parse_4html___pyx_scope_struct_4___repr__ {
   PyObject_HEAD
   struct __pyx_obj_11resiliparse_5parse_4html_DOMCollection *__pyx_v_self;
 };
 
 
-/* "resiliparse/parse/html.pyx":1522
+/* "resiliparse/parse/html.pyx":1568
  * 
  *     def __repr__(self):
  *         return f'{{{", ".join(repr(n) for n in self)}}}'             # <<<<<<<<<<<<<<
  * 
  *     def __str__(self):
  */
 struct __pyx_obj_11resiliparse_5parse_4html___pyx_scope_struct_5_genexpr {
@@ -1471,15 +1534,15 @@
 struct __pyx_vtabstruct_11resiliparse_5parse_8encoding_EncodingDetector {
   void (*update)(struct __pyx_obj_11resiliparse_5parse_8encoding_EncodingDetector *, std::string const &, int __pyx_skip_dispatch);
   PyObject *(*encoding)(struct __pyx_obj_11resiliparse_5parse_8encoding_EncodingDetector *, int __pyx_skip_dispatch, struct __pyx_opt_args_11resiliparse_5parse_8encoding_16EncodingDetector_encoding *__pyx_optional_args);
 };
 static struct __pyx_vtabstruct_11resiliparse_5parse_8encoding_EncodingDetector *__pyx_vtabptr_11resiliparse_5parse_8encoding_EncodingDetector;
 
 
-/* "resiliparse/parse/html.pyx":296
+/* "resiliparse/parse/html.pyx":342
  * 
  * 
  * cdef class DOMElementClassList:             # <<<<<<<<<<<<<<
  *     """Class name list of an Element DOM node."""
  * 
  */
 
@@ -1489,15 +1552,15 @@
   void (*add)(struct __pyx_obj_11resiliparse_5parse_4html_DOMElementClassList *, PyObject *, int __pyx_skip_dispatch);
   void (*remove)(struct __pyx_obj_11resiliparse_5parse_4html_DOMElementClassList *, PyObject *, int __pyx_skip_dispatch);
 };
 static struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMElementClassList *__pyx_vtabptr_11resiliparse_5parse_4html_DOMElementClassList;
 static CYTHON_INLINE PyObject *__pyx_f_11resiliparse_5parse_4html_19DOMElementClassList__class_name_bytes(struct __pyx_obj_11resiliparse_5parse_4html_DOMElementClassList *);
 
 
-/* "resiliparse/parse/html.pyx":417
+/* "resiliparse/parse/html.pyx":463
  * 
  * 
  * cdef class DOMNode:             # <<<<<<<<<<<<<<
  *     """
  *     __init__(self)
  */
 
@@ -1521,15 +1584,15 @@
   struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *(*replace_child)(struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *, struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *, struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *, int __pyx_skip_dispatch);
   struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *(*remove_child)(struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *, struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *, int __pyx_skip_dispatch);
   PyObject *(*decompose)(struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *, int __pyx_skip_dispatch);
 };
 static struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMNode *__pyx_vtabptr_11resiliparse_5parse_4html_DOMNode;
 
 
-/* "resiliparse/parse/html.pyx":1240
+/* "resiliparse/parse/html.pyx":1286
  * 
  * 
  * cdef class DOMCollection:             # <<<<<<<<<<<<<<
  *     """
  *     __init__(self)
  */
 
@@ -1544,28 +1607,29 @@
   struct __pyx_obj_11resiliparse_5parse_4html_DOMCollection *(*query_selector_all)(struct __pyx_obj_11resiliparse_5parse_4html_DOMCollection *, PyObject *, int __pyx_skip_dispatch);
   int (*matches)(struct __pyx_obj_11resiliparse_5parse_4html_DOMCollection *, PyObject *, int __pyx_skip_dispatch);
 };
 static struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMCollection *__pyx_vtabptr_11resiliparse_5parse_4html_DOMCollection;
 static CYTHON_INLINE size_t __pyx_f_11resiliparse_5parse_4html_13DOMCollection__wrap_idx(struct __pyx_obj_11resiliparse_5parse_4html_DOMCollection *, Py_ssize_t);
 
 
-/* "resiliparse/parse/html.pyx":1552
+/* "resiliparse/parse/html.pyx":1598
  * 
  * 
  * cdef class HTMLTree:             # <<<<<<<<<<<<<<
  *     """
  *     __init__(self)
  */
 
 struct __pyx_vtabstruct_11resiliparse_5parse_4html_HTMLTree {
   struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *(*create_element)(struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *, PyObject *, int __pyx_skip_dispatch);
   struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *(*create_text_node)(struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *, PyObject *, int __pyx_skip_dispatch);
   void (*init_css_parser)(struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *);
 };
 static struct __pyx_vtabstruct_11resiliparse_5parse_4html_HTMLTree *__pyx_vtabptr_11resiliparse_5parse_4html_HTMLTree;
+static void __pyx_f_11resiliparse_5parse_4html_8HTMLTree_init_css_parser(struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *);
 
 /* --- Runtime support code (head) --- */
 /* Refnanny.proto */
 #ifndef CYTHON_REFNANNY
   #define CYTHON_REFNANNY 0
 #endif
 #if CYTHON_REFNANNY
@@ -1633,14 +1697,21 @@
 #else
 #define __Pyx_PyObject_GetAttrStr(o,n) PyObject_GetAttr(o,n)
 #endif
 
 /* GetBuiltinName.proto */
 static PyObject *__Pyx_GetBuiltinName(PyObject *name);
 
+/* PyObjectCall.proto */
+#if CYTHON_COMPILING_IN_CPYTHON
+static CYTHON_INLINE PyObject* __Pyx_PyObject_Call(PyObject *func, PyObject *arg, PyObject *kw);
+#else
+#define __Pyx_PyObject_Call(func, arg, kw) PyObject_Call(func, arg, kw)
+#endif
+
 /* PyThreadStateGet.proto */
 #if CYTHON_FAST_THREAD_STATE
 #define __Pyx_PyThreadState_declare  PyThreadState *__pyx_tstate;
 #define __Pyx_PyThreadState_assign  __pyx_tstate = __Pyx_PyThreadState_Current;
 #define __Pyx_PyErr_Occurred()  __pyx_tstate->curexc_type
 #else
 #define __Pyx_PyThreadState_declare
@@ -1669,28 +1740,122 @@
 #define __Pyx_ErrFetchWithState(type, value, tb)  PyErr_Fetch(type, value, tb)
 #define __Pyx_ErrRestoreInState(tstate, type, value, tb)  PyErr_Restore(type, value, tb)
 #define __Pyx_ErrFetchInState(tstate, type, value, tb)  PyErr_Fetch(type, value, tb)
 #define __Pyx_ErrRestore(type, value, tb)  PyErr_Restore(type, value, tb)
 #define __Pyx_ErrFetch(type, value, tb)  PyErr_Fetch(type, value, tb)
 #endif
 
+/* RaiseException.proto */
+static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb, PyObject *cause);
+
 /* WriteUnraisableException.proto */
 static void __Pyx_WriteUnraisable(const char *name, int clineno,
                                   int lineno, const char *filename,
                                   int full_traceback, int nogil);
 
-/* PyObjectCall.proto */
+/* IncludeCppStringH.proto */
+#include <string>
+
+/* decode_c_string_utf16.proto */
+static CYTHON_INLINE PyObject *__Pyx_PyUnicode_DecodeUTF16(const char *s, Py_ssize_t size, const char *errors) {
+    int byteorder = 0;
+    return PyUnicode_DecodeUTF16(s, size, errors, &byteorder);
+}
+static CYTHON_INLINE PyObject *__Pyx_PyUnicode_DecodeUTF16LE(const char *s, Py_ssize_t size, const char *errors) {
+    int byteorder = -1;
+    return PyUnicode_DecodeUTF16(s, size, errors, &byteorder);
+}
+static CYTHON_INLINE PyObject *__Pyx_PyUnicode_DecodeUTF16BE(const char *s, Py_ssize_t size, const char *errors) {
+    int byteorder = 1;
+    return PyUnicode_DecodeUTF16(s, size, errors, &byteorder);
+}
+
+/* decode_c_bytes.proto */
+static CYTHON_INLINE PyObject* __Pyx_decode_c_bytes(
+         const char* cstring, Py_ssize_t length, Py_ssize_t start, Py_ssize_t stop,
+         const char* encoding, const char* errors,
+         PyObject* (*decode_func)(const char *s, Py_ssize_t size, const char *errors));
+
+/* decode_cpp_string.proto */
+static CYTHON_INLINE PyObject* __Pyx_decode_cpp_string(
+         std::string cppstring, Py_ssize_t start, Py_ssize_t stop,
+         const char* encoding, const char* errors,
+         PyObject* (*decode_func)(const char *s, Py_ssize_t size, const char *errors)) {
+    return __Pyx_decode_c_bytes(
+        cppstring.data(), cppstring.size(), start, stop, encoding, errors, decode_func);
+}
+
+/* PyFunctionFastCall.proto */
+#if CYTHON_FAST_PYCALL
+#define __Pyx_PyFunction_FastCall(func, args, nargs)\
+    __Pyx_PyFunction_FastCallDict((func), (args), (nargs), NULL)
+#if 1 || PY_VERSION_HEX < 0x030600B1
+static PyObject *__Pyx_PyFunction_FastCallDict(PyObject *func, PyObject **args, Py_ssize_t nargs, PyObject *kwargs);
+#else
+#define __Pyx_PyFunction_FastCallDict(func, args, nargs, kwargs) _PyFunction_FastCallDict(func, args, nargs, kwargs)
+#endif
+#define __Pyx_BUILD_ASSERT_EXPR(cond)\
+    (sizeof(char [1 - 2*!(cond)]) - 1)
+#ifndef Py_MEMBER_SIZE
+#define Py_MEMBER_SIZE(type, member) sizeof(((type *)0)->member)
+#endif
+#if CYTHON_FAST_PYCALL
+  static size_t __pyx_pyframe_localsplus_offset = 0;
+  #include "frameobject.h"
+  #define __Pxy_PyFrame_Initialize_Offsets()\
+    ((void)__Pyx_BUILD_ASSERT_EXPR(sizeof(PyFrameObject) == offsetof(PyFrameObject, f_localsplus) + Py_MEMBER_SIZE(PyFrameObject, f_localsplus)),\
+     (void)(__pyx_pyframe_localsplus_offset = ((size_t)PyFrame_Type.tp_basicsize) - Py_MEMBER_SIZE(PyFrameObject, f_localsplus)))
+  #define __Pyx_PyFrame_GetLocalsplus(frame)\
+    (assert(__pyx_pyframe_localsplus_offset), (PyObject **)(((char *)(frame)) + __pyx_pyframe_localsplus_offset))
+#endif // CYTHON_FAST_PYCALL
+#endif
+
+/* PyObjectCallMethO.proto */
 #if CYTHON_COMPILING_IN_CPYTHON
-static CYTHON_INLINE PyObject* __Pyx_PyObject_Call(PyObject *func, PyObject *arg, PyObject *kw);
+static CYTHON_INLINE PyObject* __Pyx_PyObject_CallMethO(PyObject *func, PyObject *arg);
+#endif
+
+/* PyObjectCallNoArg.proto */
+#if CYTHON_COMPILING_IN_CPYTHON
+static CYTHON_INLINE PyObject* __Pyx_PyObject_CallNoArg(PyObject *func);
 #else
-#define __Pyx_PyObject_Call(func, arg, kw) PyObject_Call(func, arg, kw)
+#define __Pyx_PyObject_CallNoArg(func) __Pyx_PyObject_Call(func, __pyx_empty_tuple, NULL)
 #endif
 
-/* RaiseException.proto */
-static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb, PyObject *cause);
+/* PyCFunctionFastCall.proto */
+#if CYTHON_FAST_PYCCALL
+static CYTHON_INLINE PyObject *__Pyx_PyCFunction_FastCall(PyObject *func, PyObject **args, Py_ssize_t nargs);
+#else
+#define __Pyx_PyCFunction_FastCall(func, args, nargs)  (assert(0), NULL)
+#endif
+
+/* PyObjectCallOneArg.proto */
+static CYTHON_INLINE PyObject* __Pyx_PyObject_CallOneArg(PyObject *func, PyObject *arg);
+
+/* PyObjectFormatSimple.proto */
+#if CYTHON_COMPILING_IN_PYPY
+    #define __Pyx_PyObject_FormatSimple(s, f) (\
+        likely(PyUnicode_CheckExact(s)) ? (Py_INCREF(s), s) :\
+        PyObject_Format(s, f))
+#elif PY_MAJOR_VERSION < 3
+    #define __Pyx_PyObject_FormatSimple(s, f) (\
+        likely(PyUnicode_CheckExact(s)) ? (Py_INCREF(s), s) :\
+        likely(PyString_CheckExact(s)) ? PyUnicode_FromEncodedObject(s, NULL, "strict") :\
+        PyObject_Format(s, f))
+#elif CYTHON_USE_TYPE_SLOTS
+    #define __Pyx_PyObject_FormatSimple(s, f) (\
+        likely(PyUnicode_CheckExact(s)) ? (Py_INCREF(s), s) :\
+        likely(PyLong_CheckExact(s)) ? PyLong_Type.tp_str(s) :\
+        likely(PyFloat_CheckExact(s)) ? PyFloat_Type.tp_str(s) :\
+        PyObject_Format(s, f))
+#else
+    #define __Pyx_PyObject_FormatSimple(s, f) (\
+        likely(PyUnicode_CheckExact(s)) ? (Py_INCREF(s), s) :\
+        PyObject_Format(s, f))
+#endif
 
 /* RaiseDoubleKeywords.proto */
 static void __Pyx_RaiseDoubleKeywordsError(const char* func_name, PyObject* kw_name);
 
 /* ParseKeywords.proto */
 static int __Pyx_ParseOptionalKeywords(PyObject *kwds, PyObject **argnames[],\
     PyObject *kwds2, PyObject *values[], Py_ssize_t num_pos_args,\
@@ -1722,28 +1887,14 @@
 #else
 #define __Pyx_PyList_Append(L,x) PyList_Append(L,x)
 #endif
 
 /* IncludeStringH.proto */
 #include <string.h>
 
-/* decode_c_string_utf16.proto */
-static CYTHON_INLINE PyObject *__Pyx_PyUnicode_DecodeUTF16(const char *s, Py_ssize_t size, const char *errors) {
-    int byteorder = 0;
-    return PyUnicode_DecodeUTF16(s, size, errors, &byteorder);
-}
-static CYTHON_INLINE PyObject *__Pyx_PyUnicode_DecodeUTF16LE(const char *s, Py_ssize_t size, const char *errors) {
-    int byteorder = -1;
-    return PyUnicode_DecodeUTF16(s, size, errors, &byteorder);
-}
-static CYTHON_INLINE PyObject *__Pyx_PyUnicode_DecodeUTF16BE(const char *s, Py_ssize_t size, const char *errors) {
-    int byteorder = 1;
-    return PyUnicode_DecodeUTF16(s, size, errors, &byteorder);
-}
-
 /* decode_c_string.proto */
 static CYTHON_INLINE PyObject* __Pyx_decode_c_string(
          const char* cstring, Py_ssize_t start, Py_ssize_t stop,
          const char* encoding, const char* errors,
          PyObject* (*decode_func)(const char *s, Py_ssize_t size, const char *errors));
 
 /* PyDictVersioning.proto */
@@ -1768,55 +1919,17 @@
 static CYTHON_INLINE int __Pyx_object_dict_version_matches(PyObject* obj, PY_UINT64_T tp_dict_version, PY_UINT64_T obj_dict_version);
 #else
 #define __PYX_GET_DICT_VERSION(dict)  (0)
 #define __PYX_UPDATE_DICT_CACHE(dict, value, cache_var, version_var)
 #define __PYX_PY_DICT_LOOKUP_IF_MODIFIED(VAR, DICT, LOOKUP)  (VAR) = (LOOKUP);
 #endif
 
-/* PyCFunctionFastCall.proto */
-#if CYTHON_FAST_PYCCALL
-static CYTHON_INLINE PyObject *__Pyx_PyCFunction_FastCall(PyObject *func, PyObject **args, Py_ssize_t nargs);
-#else
-#define __Pyx_PyCFunction_FastCall(func, args, nargs)  (assert(0), NULL)
-#endif
-
-/* PyFunctionFastCall.proto */
-#if CYTHON_FAST_PYCALL
-#define __Pyx_PyFunction_FastCall(func, args, nargs)\
-    __Pyx_PyFunction_FastCallDict((func), (args), (nargs), NULL)
-#if 1 || PY_VERSION_HEX < 0x030600B1
-static PyObject *__Pyx_PyFunction_FastCallDict(PyObject *func, PyObject **args, Py_ssize_t nargs, PyObject *kwargs);
-#else
-#define __Pyx_PyFunction_FastCallDict(func, args, nargs, kwargs) _PyFunction_FastCallDict(func, args, nargs, kwargs)
-#endif
-#define __Pyx_BUILD_ASSERT_EXPR(cond)\
-    (sizeof(char [1 - 2*!(cond)]) - 1)
-#ifndef Py_MEMBER_SIZE
-#define Py_MEMBER_SIZE(type, member) sizeof(((type *)0)->member)
-#endif
-  static size_t __pyx_pyframe_localsplus_offset = 0;
-  #include "frameobject.h"
-  #define __Pxy_PyFrame_Initialize_Offsets()\
-    ((void)__Pyx_BUILD_ASSERT_EXPR(sizeof(PyFrameObject) == offsetof(PyFrameObject, f_localsplus) + Py_MEMBER_SIZE(PyFrameObject, f_localsplus)),\
-     (void)(__pyx_pyframe_localsplus_offset = ((size_t)PyFrame_Type.tp_basicsize) - Py_MEMBER_SIZE(PyFrameObject, f_localsplus)))
-  #define __Pyx_PyFrame_GetLocalsplus(frame)\
-    (assert(__pyx_pyframe_localsplus_offset), (PyObject **)(((char *)(frame)) + __pyx_pyframe_localsplus_offset))
-#endif
-
 /* PyObjectCall2Args.proto */
 static CYTHON_UNUSED PyObject* __Pyx_PyObject_Call2Args(PyObject* function, PyObject* arg1, PyObject* arg2);
 
-/* PyObjectCallMethO.proto */
-#if CYTHON_COMPILING_IN_CPYTHON
-static CYTHON_INLINE PyObject* __Pyx_PyObject_CallMethO(PyObject *func, PyObject *arg);
-#endif
-
-/* PyObjectCallOneArg.proto */
-static CYTHON_INLINE PyObject* __Pyx_PyObject_CallOneArg(PyObject *func, PyObject *arg);
-
 /* PySequenceContains.proto */
 static CYTHON_INLINE int __Pyx_PySequence_ContainsTF(PyObject* item, PyObject* seq, int eq) {
     int result = PySequence_Contains(seq, item);
     return unlikely(result < 0) ? result : (result == (eq == Py_EQ));
 }
 
 /* GetItemInt.proto */
@@ -1878,46 +1991,21 @@
     #else
     #define __Pyx_PyBytes_Join _PyBytes_Join
     #endif
 #else
 static CYTHON_INLINE PyObject* __Pyx_PyBytes_Join(PyObject* sep, PyObject* values);
 #endif
 
-/* PyObjectCallNoArg.proto */
-#if CYTHON_COMPILING_IN_CPYTHON
-static CYTHON_INLINE PyObject* __Pyx_PyObject_CallNoArg(PyObject *func);
-#else
-#define __Pyx_PyObject_CallNoArg(func) __Pyx_PyObject_Call(func, __pyx_empty_tuple, NULL)
-#endif
-
 /* ObjectGetItem.proto */
 #if CYTHON_USE_TYPE_SLOTS
 static CYTHON_INLINE PyObject *__Pyx_PyObject_GetItem(PyObject *obj, PyObject* key);
 #else
 #define __Pyx_PyObject_GetItem(obj, key)  PyObject_GetItem(obj, key)
 #endif
 
-/* IncludeCppStringH.proto */
-#include <string>
-
-/* decode_c_bytes.proto */
-static CYTHON_INLINE PyObject* __Pyx_decode_c_bytes(
-         const char* cstring, Py_ssize_t length, Py_ssize_t start, Py_ssize_t stop,
-         const char* encoding, const char* errors,
-         PyObject* (*decode_func)(const char *s, Py_ssize_t size, const char *errors));
-
-/* decode_cpp_string.proto */
-static CYTHON_INLINE PyObject* __Pyx_decode_cpp_string(
-         std::string cppstring, Py_ssize_t start, Py_ssize_t stop,
-         const char* encoding, const char* errors,
-         PyObject* (*decode_func)(const char *s, Py_ssize_t size, const char *errors)) {
-    return __Pyx_decode_c_bytes(
-        cppstring.data(), cppstring.size(), start, stop, encoding, errors, decode_func);
-}
-
 /* GetTopmostException.proto */
 #if CYTHON_USE_EXC_INFO_STACK
 static _PyErr_StackItem * __Pyx_PyErr_GetTopmostException(PyThreadState *tstate);
 #endif
 
 /* SaveResetException.proto */
 #if CYTHON_FAST_THREAD_STATE
@@ -1951,36 +2039,14 @@
 
 /* ExtTypeTest.proto */
 static CYTHON_INLINE int __Pyx_TypeTest(PyObject *obj, PyTypeObject *type);
 
 /* None.proto */
 static CYTHON_INLINE void __Pyx_RaiseClosureNameError(const char *varname);
 
-/* PyObjectFormatSimple.proto */
-#if CYTHON_COMPILING_IN_PYPY
-    #define __Pyx_PyObject_FormatSimple(s, f) (\
-        likely(PyUnicode_CheckExact(s)) ? (Py_INCREF(s), s) :\
-        PyObject_Format(s, f))
-#elif PY_MAJOR_VERSION < 3
-    #define __Pyx_PyObject_FormatSimple(s, f) (\
-        likely(PyUnicode_CheckExact(s)) ? (Py_INCREF(s), s) :\
-        likely(PyString_CheckExact(s)) ? PyUnicode_FromEncodedObject(s, NULL, "strict") :\
-        PyObject_Format(s, f))
-#elif CYTHON_USE_TYPE_SLOTS
-    #define __Pyx_PyObject_FormatSimple(s, f) (\
-        likely(PyUnicode_CheckExact(s)) ? (Py_INCREF(s), s) :\
-        likely(PyLong_CheckExact(s)) ? PyLong_Type.tp_str(s) :\
-        likely(PyFloat_CheckExact(s)) ? PyFloat_Type.tp_str(s) :\
-        PyObject_Format(s, f))
-#else
-    #define __Pyx_PyObject_FormatSimple(s, f) (\
-        likely(PyUnicode_CheckExact(s)) ? (Py_INCREF(s), s) :\
-        PyObject_Format(s, f))
-#endif
-
 /* JoinPyUnicode.proto */
 static PyObject* __Pyx_PyUnicode_Join(PyObject* value_tuple, Py_ssize_t value_count, Py_ssize_t result_ulength,
                                       Py_UCS4 max_char);
 
 /* None.proto */
 static CYTHON_INLINE Py_ssize_t __Pyx_mod_Py_ssize_t(Py_ssize_t, Py_ssize_t);
 
@@ -2254,21 +2320,21 @@
 #if defined(__GNUC__) && (__GNUC__ > 4 || (__GNUC__ == 4 && __GNUC_MINOR__ >= 6))
 #define __Pyx_HAS_GCC_DIAGNOSTIC
 #endif
 
 /* CIntFromPy.proto */
 static CYTHON_INLINE size_t __Pyx_PyInt_As_size_t(PyObject *);
 
-/* CIntToPy.proto */
-static CYTHON_INLINE PyObject* __Pyx_PyInt_From_long(long value);
-
 /* CIntFromPy.proto */
 static CYTHON_INLINE char __Pyx_PyInt_As_char(PyObject *);
 
 /* CIntToPy.proto */
+static CYTHON_INLINE PyObject* __Pyx_PyInt_From_long(long value);
+
+/* CIntToPy.proto */
 static CYTHON_INLINE PyObject* __Pyx_PyInt_From_enum____pyx_t_11resiliparse_5parse_4html_NodeType(enum __pyx_t_11resiliparse_5parse_4html_NodeType value);
 
 /* CIntFromPy.proto */
 static CYTHON_INLINE long __Pyx_PyInt_As_long(PyObject *);
 
 /* CIntFromPy.proto */
 static CYTHON_INLINE int __Pyx_PyInt_As_int(PyObject *);
@@ -2476,27 +2542,33 @@
 static PyTypeObject *__pyx_ptype_11resiliparse_5parse_4html___pyx_scope_struct_4___repr__ = 0;
 static PyTypeObject *__pyx_ptype_11resiliparse_5parse_4html___pyx_scope_struct_5_genexpr = 0;
 static PyTypeObject *__pyx_ptype___Pyx_EnumMeta = 0;
 static PyObject *__Pyx_OrderedDict = 0;
 static PyObject *__Pyx_EnumBase = 0;
 static PyObject *__Pyx_globals = 0;
 static CYTHON_INLINE int __pyx_f_11resiliparse_5parse_4html_check_node(struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *); /*proto*/
+static int __pyx_f_11resiliparse_5parse_4html_init_css_parser(lxb_css_parser_t **); /*proto*/
+static void __pyx_f_11resiliparse_5parse_4html_destroy_css_parser(lxb_css_parser_t *); /*proto*/
+static int __pyx_f_11resiliparse_5parse_4html_init_css_selectors(lxb_css_parser_t *, lxb_css_selectors_t **, lxb_selectors_t **); /*proto*/
+static void __pyx_f_11resiliparse_5parse_4html_destroy_css_selectors(lxb_css_selectors_t *, lxb_selectors_t *); /*proto*/
+static lxb_css_selector_list_t *__pyx_f_11resiliparse_5parse_4html_parse_css_selectors(lxb_css_parser_t *, lxb_char_t const *, size_t); /*proto*/
 static CYTHON_INLINE lxb_dom_node_t *__pyx_f_11resiliparse_5parse_4html_next_node(lxb_dom_node_t const *, lxb_dom_node_t *, struct __pyx_opt_args_11resiliparse_5parse_4html_next_node *__pyx_optional_args); /*proto*/
 static CYTHON_INLINE lxb_dom_node_t *__pyx_f_11resiliparse_5parse_4html_next_element_node(lxb_dom_node_t const *, lxb_dom_node_t *, struct __pyx_opt_args_11resiliparse_5parse_4html_next_element_node *__pyx_optional_args); /*proto*/
 static CYTHON_INLINE std::string __pyx_f_11resiliparse_5parse_4html_get_node_text(lxb_dom_node_t *); /*proto*/
 static lxb_dom_node_t *__pyx_f_11resiliparse_5parse_4html_get_element_by_id_impl(lxb_dom_node_t *, PyObject *, struct __pyx_opt_args_11resiliparse_5parse_4html_get_element_by_id_impl *__pyx_optional_args); /*proto*/
 static lxb_dom_collection_t *__pyx_f_11resiliparse_5parse_4html_get_elements_by_attr_impl(lxb_dom_node_t *, PyObject *, PyObject *, struct __pyx_opt_args_11resiliparse_5parse_4html_get_elements_by_attr_impl *__pyx_optional_args); /*proto*/
 static lxb_dom_collection_t *__pyx_f_11resiliparse_5parse_4html_get_elements_by_class_name_impl(lxb_dom_node_t *, PyObject *, struct __pyx_opt_args_11resiliparse_5parse_4html_get_elements_by_class_name_impl *__pyx_optional_args); /*proto*/
 static lxb_dom_collection_t *__pyx_f_11resiliparse_5parse_4html_get_elements_by_tag_name_impl(lxb_dom_node_t *, PyObject *); /*proto*/
 static lxb_dom_node_t *__pyx_f_11resiliparse_5parse_4html_query_selector_impl(lxb_dom_node_t *, struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *, PyObject *); /*proto*/
 static lxb_dom_collection_t *__pyx_f_11resiliparse_5parse_4html_query_selector_all_impl(lxb_dom_node_t *, struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *, PyObject *, struct __pyx_opt_args_11resiliparse_5parse_4html_query_selector_all_impl *__pyx_optional_args); /*proto*/
 static int __pyx_f_11resiliparse_5parse_4html_matches_impl(lxb_dom_node_t *, struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *, PyObject *); /*proto*/
 static struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *__pyx_f_11resiliparse_5parse_4html_create_html_tree(PyObject *, struct __pyx_opt_args_11resiliparse_5parse_4html_create_html_tree *__pyx_optional_args); /*proto*/
 static CYTHON_INLINE struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *__pyx_f_11resiliparse_5parse_4html__create_dom_node(struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *, lxb_dom_node_t *); /*proto*/
 static CYTHON_INLINE struct __pyx_obj_11resiliparse_5parse_4html_DOMCollection *__pyx_f_11resiliparse_5parse_4html__create_dom_collection(struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *, lxb_dom_collection_t *); /*proto*/
+static CYTHON_INLINE void __pyx_f_11resiliparse_5parse_4html__log_serialize_cb(lxb_char_t const *, size_t, void *); /*proto*/
 static CYTHON_INLINE lexbor_action_t __pyx_f_11resiliparse_5parse_4html_element_by_id_callback(lxb_dom_node_t *, void *); /*proto*/
 static CYTHON_INLINE lxb_status_t __pyx_f_11resiliparse_5parse_4html_css_select_callback(lxb_dom_node_t *, lxb_css_selector_specificity_t *, void *); /*proto*/
 static CYTHON_INLINE lxb_status_t __pyx_f_11resiliparse_5parse_4html_css_select_callback_single(lxb_dom_node_t *, lxb_css_selector_specificity_t *, void *); /*proto*/
 static CYTHON_INLINE lxb_status_t __pyx_f_11resiliparse_5parse_4html_css_match_callback(lxb_dom_node_t *, lxb_css_selector_specificity_t *, void *); /*proto*/
 static CYTHON_INLINE int __pyx_f_11resiliparse_5parse_4html_is_whitespace(char const ); /*proto*/
 static CYTHON_INLINE void __pyx_f_11resiliparse_5parse_4html__join_collections(lxb_dom_collection_t *, lxb_dom_collection_t *); /*proto*/
 static CYTHON_INLINE PyObject *__pyx_convert_PyObject_string_to_py_std__in_string(std::string const &); /*proto*/
@@ -2508,32 +2580,32 @@
 static PyObject *__pyx_unpickle___Pyx_EnumMeta__set_state(struct __pyx_obj___Pyx_EnumMeta *, PyObject *); /*proto*/
 #define __Pyx_MODULE_NAME "resiliparse.parse.html"
 extern int __pyx_module_is_main_resiliparse__parse__html;
 int __pyx_module_is_main_resiliparse__parse__html = 0;
 
 /* Implementation of 'resiliparse.parse.html' */
 static PyObject *__pyx_builtin_RuntimeError;
+static PyObject *__pyx_builtin_ValueError;
 static PyObject *__pyx_builtin_range;
 static PyObject *__pyx_builtin_TypeError;
-static PyObject *__pyx_builtin_ValueError;
 static PyObject *__pyx_builtin_KeyError;
 static PyObject *__pyx_builtin_IndexError;
 static PyObject *__pyx_builtin_SyntaxError;
 static const char __pyx_k_t[] = "t";
 static const char __pyx_k_v[] = "v";
-static const char __pyx_k__2[] = "";
-static const char __pyx_k__3[] = " ";
+static const char __pyx_k__5[] = "";
+static const char __pyx_k__6[] = " ";
 static const char __pyx_k_id[] = "id";
-static const char __pyx_k__19[] = "=\"";
-static const char __pyx_k__20[] = "\"";
-static const char __pyx_k__21[] = "<";
-static const char __pyx_k__22[] = ">";
-static const char __pyx_k__28[] = "{";
-  static const char __pyx_k__29[] = ", ";
-static const char __pyx_k__30[] = "}";
+static const char __pyx_k__22[] = "=\"";
+static const char __pyx_k__23[] = "\"";
+static const char __pyx_k__24[] = "<";
+static const char __pyx_k__25[] = ">";
+static const char __pyx_k__31[] = "{";
+  static const char __pyx_k__32[] = ", ";
+static const char __pyx_k__33[] = "}";
 static const char __pyx_k_add[] = "add";
 static const char __pyx_k_cls[] = "cls";
 static const char __pyx_k_dct[] = "dct";
 static const char __pyx_k_doc[] = "__doc__";
 static const char __pyx_k_new[] = "__new__";
 static const char __pyx_k_res[] = "res";
 static const char __pyx_k_s_s[] = "%s.%s";
@@ -2565,14 +2637,15 @@
 static const char __pyx_k_close[] = "close";
 static const char __pyx_k_depth[] = "depth";
 static const char __pyx_k_lower[] = "lower";
 static const char __pyx_k_parse[] = "parse";
 static const char __pyx_k_range[] = "range";
 static const char __pyx_k_s_s_d[] = "<%s.%s: %d>";
 static const char __pyx_k_start[] = "start";
+static const char __pyx_k_strip[] = "strip";
 static const char __pyx_k_throw[] = "throw";
 static const char __pyx_k_title[] = "title";
 static const char __pyx_k_utf_8[] = "utf-8";
 static const char __pyx_k_value[] = "value";
 static const char __pyx_k_ENTITY[] = "ENTITY";
 static const char __pyx_k_by_tag[] = "by_tag";
 static const char __pyx_k_encode[] = "encode";
@@ -2666,14 +2739,15 @@
 static const char __pyx_k_create_element[] = "create_element";
 static const char __pyx_k_is_end_tag_ptr[] = "is_end_tag_ptr";
 static const char __pyx_k_query_selector[] = "query_selector";
 static const char __pyx_k_start_callback[] = "start_callback";
 static const char __pyx_k_INVALID_ELEMENT[] = "<INVALID ELEMENT>";
 static const char __pyx_k_pyx_PickleError[] = "__pyx_PickleError";
 static const char __pyx_k_setstate_cython[] = "__setstate_cython__";
+static const char __pyx_k_CSS_parser_error[] = "CSS parser error: ";
 static const char __pyx_k_ENTITY_REFERENCE[] = "ENTITY_REFERENCE";
 static const char __pyx_k_Invalid_key_type[] = "Invalid key type: ";
 static const char __pyx_k_case_insensitive[] = "case_insensitive";
 static const char __pyx_k_create_text_node[] = "create_text_node";
 static const char __pyx_k_parse_from_bytes[] = "parse_from_bytes";
 static const char __pyx_k_DOCUMENT_FRAGMENT[] = "DOCUMENT_FRAGMENT";
 static const char __pyx_k_DOMContext___init[] = "DOMContext.__init__";
@@ -2697,18 +2771,21 @@
 static const char __pyx_k_resiliparse_parse_html_pyx[] = "resiliparse/parse/html.pyx";
 static const char __pyx_k_pyx_unpickle___Pyx_EnumMeta[] = "__pyx_unpickle___Pyx_EnumMeta";
 static const char __pyx_k_Node_ist_not_an_Element_node[] = "Node ist not an Element node.";
 static const char __pyx_k_Failed_to_parse_HTML_document[] = "Failed to parse HTML document";
 static const char __pyx_k_init___DOM_node_traversal_con[] = "\n    __init__()\n\n    DOM node traversal context object.\n\n    The context object has two attributes that are set by the traversal function for\n    keeping track of the current :class:`DOMNode` and the current traversal depth.\n    Besides these, the context object is arbitrarily mutable and can be used for\n    maintaining custom state.\n\n    :ivar DOMNode node: the current :class:`DOMNode`\n    :ivar int depth: the current traversal depth\n    ";
 static const char __pyx_k_Cannot_create_instance_directly[] = "Cannot create instance directly. Use HTMLParser.parse() or HTMLParser.parse_from_bytes()";
 static const char __pyx_k_Failed_to_create_DOM_collection[] = "Failed to create DOM collection";
+static const char __pyx_k_Failed_to_initialize_CSS_parser[] = "Failed to initialize CSS parser.";
 static const char __pyx_k_Failed_to_match_elements_by_CSS[] = "Failed to match elements by CSS selector";
 static const char __pyx_k_Append_operation_on_uninitialize[] = "Append operation on uninitialized node";
 static const char __pyx_k_Decompose_operation_on_uninitial[] = "Decompose operation on uninitialized node";
 static const char __pyx_k_Failed_to_allocate_HTML_document[] = "Failed to allocate HTML document";
+static const char __pyx_k_Failed_to_initialize_CSS_selecto[] = "Failed to initialize CSS selectors.";
+static const char __pyx_k_Failed_to_initialize_elemetn_sel[] = "Failed to initialize elemetn selectors.";
 static const char __pyx_k_Incompatible_checksums_s_vs_0xd4[] = "Incompatible checksums (%s vs 0xd41d8cd = ())";
 static const char __pyx_k_Insert_operation_on_uninitialize[] = "Insert operation on uninitialized node";
 static const char __pyx_k_Node_is_not_a_child_of_the_curre[] = "Node is not a child of the current node";
 static const char __pyx_k_Reference_node_must_be_a_child_n[] = "Reference node must be a child node";
 static const char __pyx_k_Remove_operation_on_uninitialize[] = "Remove operation on uninitialized node";
 static const char __pyx_k_Replace_operation_on_uninitializ[] = "Replace operation on uninitialized node";
 static const char __pyx_k_Trying_to_append_child_to_itself[] = "Trying to append child to itself";
@@ -2720,14 +2797,15 @@
 static const char __pyx_k_Trying_to_set_HTML_contents_of_u[] = "Trying to set HTML contents of uninitialized DOM node";
 static const char __pyx_k_Trying_to_set_text_contents_of_u[] = "Trying to set text contents of uninitialized DOM node";
 static const char __pyx_k_no_default___reduce___due_to_non[] = "no default __reduce__ due to non-trivial __cinit__";
 static PyObject *__pyx_n_s_ATTRIBUTE;
 static PyObject *__pyx_kp_u_Append_operation_on_uninitialize;
 static PyObject *__pyx_n_s_CDATA_SECTION;
 static PyObject *__pyx_n_s_COMMENT;
+static PyObject *__pyx_kp_u_CSS_parser_error;
 static PyObject *__pyx_kp_u_Cannot_create_instance_directly;
 static PyObject *__pyx_kp_u_DOCTYPE_html;
 static PyObject *__pyx_n_s_DOCUMENT;
 static PyObject *__pyx_n_s_DOCUMENT_FRAGMENT;
 static PyObject *__pyx_n_s_DOCUMENT_TYPE;
 static PyObject *__pyx_n_s_DOMCollection;
 static PyObject *__pyx_n_s_DOMCollection___iter;
@@ -2741,14 +2819,17 @@
 static PyObject *__pyx_n_s_ENTITY;
 static PyObject *__pyx_n_s_ENTITY_REFERENCE;
 static PyObject *__pyx_kp_u_Element;
 static PyObject *__pyx_n_s_EnumBase;
 static PyObject *__pyx_n_s_EnumType;
 static PyObject *__pyx_kp_u_Failed_to_allocate_HTML_document;
 static PyObject *__pyx_kp_u_Failed_to_create_DOM_collection;
+static PyObject *__pyx_kp_u_Failed_to_initialize_CSS_parser;
+static PyObject *__pyx_kp_u_Failed_to_initialize_CSS_selecto;
+static PyObject *__pyx_kp_u_Failed_to_initialize_elemetn_sel;
 static PyObject *__pyx_kp_u_Failed_to_match_elements_by_CSS;
 static PyObject *__pyx_kp_u_Failed_to_parse_HTML_document;
 static PyObject *__pyx_n_s_HTMLTree;
 static PyObject *__pyx_kp_u_HTML_Document;
 static PyObject *__pyx_kp_u_INVALID_ELEMENT;
 static PyObject *__pyx_kp_s_Incompatible_checksums_s_vs_0xd4;
 static PyObject *__pyx_n_s_IndexError;
@@ -2784,25 +2865,25 @@
 static PyObject *__pyx_kp_u_Trying_to_insert_node_as_its_own;
 static PyObject *__pyx_kp_u_Trying_to_select_items_from_unin;
 static PyObject *__pyx_kp_u_Trying_to_set_HTML_contents_of_u;
 static PyObject *__pyx_kp_u_Trying_to_set_text_contents_of_u;
 static PyObject *__pyx_n_s_TypeError;
 static PyObject *__pyx_kp_s_Unknown_enum_value_s;
 static PyObject *__pyx_n_s_ValueError;
-static PyObject *__pyx_kp_u__19;
-static PyObject *__pyx_kp_b__2;
-static PyObject *__pyx_kp_u__2;
-static PyObject *__pyx_kp_u__20;
-static PyObject *__pyx_kp_u__21;
 static PyObject *__pyx_kp_u__22;
-static PyObject *__pyx_kp_u__28;
-static PyObject *__pyx_kp_u__29;
-static PyObject *__pyx_kp_b__3;
-static PyObject *__pyx_kp_u__3;
-static PyObject *__pyx_kp_u__30;
+static PyObject *__pyx_kp_u__23;
+static PyObject *__pyx_kp_u__24;
+static PyObject *__pyx_kp_u__25;
+static PyObject *__pyx_kp_u__31;
+static PyObject *__pyx_kp_u__32;
+static PyObject *__pyx_kp_u__33;
+static PyObject *__pyx_kp_b__5;
+static PyObject *__pyx_kp_u__5;
+static PyObject *__pyx_kp_b__6;
+static PyObject *__pyx_kp_u__6;
 static PyObject *__pyx_n_s_add;
 static PyObject *__pyx_n_s_append_child;
 static PyObject *__pyx_n_s_args;
 static PyObject *__pyx_n_s_attr_name;
 static PyObject *__pyx_n_s_attr_value;
 static PyObject *__pyx_n_s_attrs;
 static PyObject *__pyx_n_s_base_node;
@@ -2906,14 +2987,15 @@
 static PyObject *__pyx_n_s_setstate_cython;
 static PyObject *__pyx_n_s_start;
 static PyObject *__pyx_n_s_start_callback;
 static PyObject *__pyx_n_s_step;
 static PyObject *__pyx_n_s_stop;
 static PyObject *__pyx_n_s_str;
 static PyObject *__pyx_kp_s_stringsource;
+static PyObject *__pyx_n_s_strip;
 static PyObject *__pyx_n_s_t;
 static PyObject *__pyx_n_s_tag;
 static PyObject *__pyx_n_s_test;
 static PyObject *__pyx_n_s_text;
 static PyObject *__pyx_n_s_throw;
 static PyObject *__pyx_n_u_title;
 static PyObject *__pyx_n_s_traverse_dom;
@@ -3043,56 +3125,59 @@
 static PyObject *__pyx_tp_new___Pyx_EnumMeta(PyTypeObject *t, PyObject *a, PyObject *k); /*proto*/
 static PyObject *__pyx_int_0;
 static PyObject *__pyx_int_1;
 static PyObject *__pyx_int_10;
 static PyObject *__pyx_int_222419149;
 static PyObject *__pyx_int_neg_1;
 static PyObject *__pyx_tuple_;
+static PyObject *__pyx_tuple__2;
+static PyObject *__pyx_tuple__3;
 static PyObject *__pyx_tuple__4;
-static PyObject *__pyx_tuple__5;
-static PyObject *__pyx_tuple__6;
 static PyObject *__pyx_tuple__7;
 static PyObject *__pyx_tuple__8;
 static PyObject *__pyx_tuple__9;
 static PyObject *__pyx_tuple__10;
 static PyObject *__pyx_tuple__11;
 static PyObject *__pyx_tuple__12;
 static PyObject *__pyx_tuple__13;
 static PyObject *__pyx_tuple__14;
 static PyObject *__pyx_tuple__15;
 static PyObject *__pyx_tuple__16;
 static PyObject *__pyx_tuple__17;
 static PyObject *__pyx_tuple__18;
-static PyObject *__pyx_tuple__23;
-static PyObject *__pyx_tuple__24;
-static PyObject *__pyx_tuple__25;
+static PyObject *__pyx_tuple__19;
+static PyObject *__pyx_tuple__20;
+static PyObject *__pyx_tuple__21;
 static PyObject *__pyx_tuple__26;
 static PyObject *__pyx_tuple__27;
-static PyObject *__pyx_tuple__31;
-static PyObject *__pyx_tuple__32;
-static PyObject *__pyx_tuple__33;
+static PyObject *__pyx_tuple__28;
+static PyObject *__pyx_tuple__29;
+static PyObject *__pyx_tuple__30;
 static PyObject *__pyx_tuple__34;
 static PyObject *__pyx_tuple__35;
 static PyObject *__pyx_tuple__36;
 static PyObject *__pyx_tuple__37;
 static PyObject *__pyx_tuple__38;
 static PyObject *__pyx_tuple__39;
 static PyObject *__pyx_tuple__40;
+static PyObject *__pyx_tuple__41;
 static PyObject *__pyx_tuple__42;
-static PyObject *__pyx_tuple__44;
-static PyObject *__pyx_tuple__46;
+static PyObject *__pyx_tuple__43;
+static PyObject *__pyx_tuple__45;
 static PyObject *__pyx_tuple__47;
 static PyObject *__pyx_tuple__49;
-static PyObject *__pyx_tuple__51;
-static PyObject *__pyx_codeobj__41;
-static PyObject *__pyx_codeobj__43;
-static PyObject *__pyx_codeobj__45;
+static PyObject *__pyx_tuple__50;
+static PyObject *__pyx_tuple__52;
+static PyObject *__pyx_tuple__54;
+static PyObject *__pyx_codeobj__44;
+static PyObject *__pyx_codeobj__46;
 static PyObject *__pyx_codeobj__48;
-static PyObject *__pyx_codeobj__50;
-static PyObject *__pyx_codeobj__52;
+static PyObject *__pyx_codeobj__51;
+static PyObject *__pyx_codeobj__53;
+static PyObject *__pyx_codeobj__55;
 /* Late includes */
 
 /* "resiliparse/parse/html.pyx":27
  * 
  * 
  * cdef inline DOMNode _create_dom_node(HTMLTree tree, lxb_dom_node_t* dom_node):             # <<<<<<<<<<<<<<
  *     if not dom_node:
@@ -3319,22 +3404,551 @@
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
 /* "resiliparse/parse/html.pyx":44
  * 
  * 
+ * cdef bint init_css_parser(lxb_css_parser_t** parser) except 0:             # <<<<<<<<<<<<<<
+ *     parser[0] = lxb_css_parser_create()
+ *     if lxb_css_parser_init(parser[0], NULL, NULL) != LXB_STATUS_OK:
+ */
+
+static int __pyx_f_11resiliparse_5parse_4html_init_css_parser(lxb_css_parser_t **__pyx_v_parser) {
+  int __pyx_r;
+  __Pyx_RefNannyDeclarations
+  int __pyx_t_1;
+  PyObject *__pyx_t_2 = NULL;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("init_css_parser", 0);
+
+  /* "resiliparse/parse/html.pyx":45
+ * 
+ * cdef bint init_css_parser(lxb_css_parser_t** parser) except 0:
+ *     parser[0] = lxb_css_parser_create()             # <<<<<<<<<<<<<<
+ *     if lxb_css_parser_init(parser[0], NULL, NULL) != LXB_STATUS_OK:
+ *         raise RuntimeError('Failed to initialize CSS parser.')
+ */
+  (__pyx_v_parser[0]) = lxb_css_parser_create();
+
+  /* "resiliparse/parse/html.pyx":46
+ * cdef bint init_css_parser(lxb_css_parser_t** parser) except 0:
+ *     parser[0] = lxb_css_parser_create()
+ *     if lxb_css_parser_init(parser[0], NULL, NULL) != LXB_STATUS_OK:             # <<<<<<<<<<<<<<
+ *         raise RuntimeError('Failed to initialize CSS parser.')
+ *     return True
+ */
+  __pyx_t_1 = ((lxb_css_parser_init((__pyx_v_parser[0]), NULL, NULL) != LXB_STATUS_OK) != 0);
+  if (unlikely(__pyx_t_1)) {
+
+    /* "resiliparse/parse/html.pyx":47
+ *     parser[0] = lxb_css_parser_create()
+ *     if lxb_css_parser_init(parser[0], NULL, NULL) != LXB_STATUS_OK:
+ *         raise RuntimeError('Failed to initialize CSS parser.')             # <<<<<<<<<<<<<<
+ *     return True
+ * 
+ */
+    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_RuntimeError, __pyx_tuple_, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 47, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_2);
+    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
+    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+    __PYX_ERR(0, 47, __pyx_L1_error)
+
+    /* "resiliparse/parse/html.pyx":46
+ * cdef bint init_css_parser(lxb_css_parser_t** parser) except 0:
+ *     parser[0] = lxb_css_parser_create()
+ *     if lxb_css_parser_init(parser[0], NULL, NULL) != LXB_STATUS_OK:             # <<<<<<<<<<<<<<
+ *         raise RuntimeError('Failed to initialize CSS parser.')
+ *     return True
+ */
+  }
+
+  /* "resiliparse/parse/html.pyx":48
+ *     if lxb_css_parser_init(parser[0], NULL, NULL) != LXB_STATUS_OK:
+ *         raise RuntimeError('Failed to initialize CSS parser.')
+ *     return True             # <<<<<<<<<<<<<<
+ * 
+ * 
+ */
+  __pyx_r = 1;
+  goto __pyx_L0;
+
+  /* "resiliparse/parse/html.pyx":44
+ * 
+ * 
+ * cdef bint init_css_parser(lxb_css_parser_t** parser) except 0:             # <<<<<<<<<<<<<<
+ *     parser[0] = lxb_css_parser_create()
+ *     if lxb_css_parser_init(parser[0], NULL, NULL) != LXB_STATUS_OK:
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_AddTraceback("resiliparse.parse.html.init_css_parser", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = 0;
+  __pyx_L0:;
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "resiliparse/parse/html.pyx":51
+ * 
+ * 
+ * cdef void destroy_css_parser(lxb_css_parser_t* parser) nogil:             # <<<<<<<<<<<<<<
+ *     if parser:
+ *         lxb_css_parser_destroy(parser, True)
+ */
+
+static void __pyx_f_11resiliparse_5parse_4html_destroy_css_parser(lxb_css_parser_t *__pyx_v_parser) {
+  int __pyx_t_1;
+
+  /* "resiliparse/parse/html.pyx":52
+ * 
+ * cdef void destroy_css_parser(lxb_css_parser_t* parser) nogil:
+ *     if parser:             # <<<<<<<<<<<<<<
+ *         lxb_css_parser_destroy(parser, True)
+ * 
+ */
+  __pyx_t_1 = (__pyx_v_parser != 0);
+  if (__pyx_t_1) {
+
+    /* "resiliparse/parse/html.pyx":53
+ * cdef void destroy_css_parser(lxb_css_parser_t* parser) nogil:
+ *     if parser:
+ *         lxb_css_parser_destroy(parser, True)             # <<<<<<<<<<<<<<
+ * 
+ * 
+ */
+    (void)(lxb_css_parser_destroy(__pyx_v_parser, 1));
+
+    /* "resiliparse/parse/html.pyx":52
+ * 
+ * cdef void destroy_css_parser(lxb_css_parser_t* parser) nogil:
+ *     if parser:             # <<<<<<<<<<<<<<
+ *         lxb_css_parser_destroy(parser, True)
+ * 
+ */
+  }
+
+  /* "resiliparse/parse/html.pyx":51
+ * 
+ * 
+ * cdef void destroy_css_parser(lxb_css_parser_t* parser) nogil:             # <<<<<<<<<<<<<<
+ *     if parser:
+ *         lxb_css_parser_destroy(parser, True)
+ */
+
+  /* function exit code */
+}
+
+/* "resiliparse/parse/html.pyx":56
+ * 
+ * 
+ * cdef bint init_css_selectors(lxb_css_parser_t* parser, lxb_css_selectors_t** css_selectors,             # <<<<<<<<<<<<<<
+ *                              lxb_selectors_t** selectors) except 0:
+ *     css_selectors[0] = lxb_css_selectors_create()
+ */
+
+static int __pyx_f_11resiliparse_5parse_4html_init_css_selectors(lxb_css_parser_t *__pyx_v_parser, lxb_css_selectors_t **__pyx_v_css_selectors, lxb_selectors_t **__pyx_v_selectors) {
+  int __pyx_r;
+  __Pyx_RefNannyDeclarations
+  int __pyx_t_1;
+  PyObject *__pyx_t_2 = NULL;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("init_css_selectors", 0);
+
+  /* "resiliparse/parse/html.pyx":58
+ * cdef bint init_css_selectors(lxb_css_parser_t* parser, lxb_css_selectors_t** css_selectors,
+ *                              lxb_selectors_t** selectors) except 0:
+ *     css_selectors[0] = lxb_css_selectors_create()             # <<<<<<<<<<<<<<
+ *     if lxb_css_selectors_init(css_selectors[0], 32) != LXB_STATUS_OK:
+ *         raise RuntimeError('Failed to initialize CSS selectors.')
+ */
+  (__pyx_v_css_selectors[0]) = lxb_css_selectors_create();
+
+  /* "resiliparse/parse/html.pyx":59
+ *                              lxb_selectors_t** selectors) except 0:
+ *     css_selectors[0] = lxb_css_selectors_create()
+ *     if lxb_css_selectors_init(css_selectors[0], 32) != LXB_STATUS_OK:             # <<<<<<<<<<<<<<
+ *         raise RuntimeError('Failed to initialize CSS selectors.')
+ * 
+ */
+  __pyx_t_1 = ((lxb_css_selectors_init((__pyx_v_css_selectors[0]), 32) != LXB_STATUS_OK) != 0);
+  if (unlikely(__pyx_t_1)) {
+
+    /* "resiliparse/parse/html.pyx":60
+ *     css_selectors[0] = lxb_css_selectors_create()
+ *     if lxb_css_selectors_init(css_selectors[0], 32) != LXB_STATUS_OK:
+ *         raise RuntimeError('Failed to initialize CSS selectors.')             # <<<<<<<<<<<<<<
+ * 
+ *     lxb_css_parser_selectors_set(parser, css_selectors[0])
+ */
+    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_RuntimeError, __pyx_tuple__2, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 60, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_2);
+    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
+    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+    __PYX_ERR(0, 60, __pyx_L1_error)
+
+    /* "resiliparse/parse/html.pyx":59
+ *                              lxb_selectors_t** selectors) except 0:
+ *     css_selectors[0] = lxb_css_selectors_create()
+ *     if lxb_css_selectors_init(css_selectors[0], 32) != LXB_STATUS_OK:             # <<<<<<<<<<<<<<
+ *         raise RuntimeError('Failed to initialize CSS selectors.')
+ * 
+ */
+  }
+
+  /* "resiliparse/parse/html.pyx":62
+ *         raise RuntimeError('Failed to initialize CSS selectors.')
+ * 
+ *     lxb_css_parser_selectors_set(parser, css_selectors[0])             # <<<<<<<<<<<<<<
+ * 
+ *     selectors[0] = lxb_selectors_create()
+ */
+  lxb_css_parser_selectors_set(__pyx_v_parser, (__pyx_v_css_selectors[0]));
+
+  /* "resiliparse/parse/html.pyx":64
+ *     lxb_css_parser_selectors_set(parser, css_selectors[0])
+ * 
+ *     selectors[0] = lxb_selectors_create()             # <<<<<<<<<<<<<<
+ *     if lxb_selectors_init(selectors[0]) != LXB_STATUS_OK:
+ *         raise RuntimeError('Failed to initialize elemetn selectors.')
+ */
+  (__pyx_v_selectors[0]) = lxb_selectors_create();
+
+  /* "resiliparse/parse/html.pyx":65
+ * 
+ *     selectors[0] = lxb_selectors_create()
+ *     if lxb_selectors_init(selectors[0]) != LXB_STATUS_OK:             # <<<<<<<<<<<<<<
+ *         raise RuntimeError('Failed to initialize elemetn selectors.')
+ * 
+ */
+  __pyx_t_1 = ((lxb_selectors_init((__pyx_v_selectors[0])) != LXB_STATUS_OK) != 0);
+  if (unlikely(__pyx_t_1)) {
+
+    /* "resiliparse/parse/html.pyx":66
+ *     selectors[0] = lxb_selectors_create()
+ *     if lxb_selectors_init(selectors[0]) != LXB_STATUS_OK:
+ *         raise RuntimeError('Failed to initialize elemetn selectors.')             # <<<<<<<<<<<<<<
+ * 
+ *     return True
+ */
+    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_RuntimeError, __pyx_tuple__3, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 66, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_2);
+    __Pyx_Raise(__pyx_t_2, 0, 0, 0);
+    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+    __PYX_ERR(0, 66, __pyx_L1_error)
+
+    /* "resiliparse/parse/html.pyx":65
+ * 
+ *     selectors[0] = lxb_selectors_create()
+ *     if lxb_selectors_init(selectors[0]) != LXB_STATUS_OK:             # <<<<<<<<<<<<<<
+ *         raise RuntimeError('Failed to initialize elemetn selectors.')
+ * 
+ */
+  }
+
+  /* "resiliparse/parse/html.pyx":68
+ *         raise RuntimeError('Failed to initialize elemetn selectors.')
+ * 
+ *     return True             # <<<<<<<<<<<<<<
+ * 
+ * 
+ */
+  __pyx_r = 1;
+  goto __pyx_L0;
+
+  /* "resiliparse/parse/html.pyx":56
+ * 
+ * 
+ * cdef bint init_css_selectors(lxb_css_parser_t* parser, lxb_css_selectors_t** css_selectors,             # <<<<<<<<<<<<<<
+ *                              lxb_selectors_t** selectors) except 0:
+ *     css_selectors[0] = lxb_css_selectors_create()
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_AddTraceback("resiliparse.parse.html.init_css_selectors", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = 0;
+  __pyx_L0:;
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "resiliparse/parse/html.pyx":71
+ * 
+ * 
+ * cdef void destroy_css_selectors(lxb_css_selectors_t* css_selectors, lxb_selectors_t* selectors) nogil:             # <<<<<<<<<<<<<<
+ *     if selectors:
+ *         lxb_selectors_destroy(selectors, True)
+ */
+
+static void __pyx_f_11resiliparse_5parse_4html_destroy_css_selectors(lxb_css_selectors_t *__pyx_v_css_selectors, lxb_selectors_t *__pyx_v_selectors) {
+  int __pyx_t_1;
+
+  /* "resiliparse/parse/html.pyx":72
+ * 
+ * cdef void destroy_css_selectors(lxb_css_selectors_t* css_selectors, lxb_selectors_t* selectors) nogil:
+ *     if selectors:             # <<<<<<<<<<<<<<
+ *         lxb_selectors_destroy(selectors, True)
+ *     if css_selectors:
+ */
+  __pyx_t_1 = (__pyx_v_selectors != 0);
+  if (__pyx_t_1) {
+
+    /* "resiliparse/parse/html.pyx":73
+ * cdef void destroy_css_selectors(lxb_css_selectors_t* css_selectors, lxb_selectors_t* selectors) nogil:
+ *     if selectors:
+ *         lxb_selectors_destroy(selectors, True)             # <<<<<<<<<<<<<<
+ *     if css_selectors:
+ *         lxb_css_selectors_destroy(css_selectors, True, True)
+ */
+    (void)(lxb_selectors_destroy(__pyx_v_selectors, 1));
+
+    /* "resiliparse/parse/html.pyx":72
+ * 
+ * cdef void destroy_css_selectors(lxb_css_selectors_t* css_selectors, lxb_selectors_t* selectors) nogil:
+ *     if selectors:             # <<<<<<<<<<<<<<
+ *         lxb_selectors_destroy(selectors, True)
+ *     if css_selectors:
+ */
+  }
+
+  /* "resiliparse/parse/html.pyx":74
+ *     if selectors:
+ *         lxb_selectors_destroy(selectors, True)
+ *     if css_selectors:             # <<<<<<<<<<<<<<
+ *         lxb_css_selectors_destroy(css_selectors, True, True)
+ * 
+ */
+  __pyx_t_1 = (__pyx_v_css_selectors != 0);
+  if (__pyx_t_1) {
+
+    /* "resiliparse/parse/html.pyx":75
+ *         lxb_selectors_destroy(selectors, True)
+ *     if css_selectors:
+ *         lxb_css_selectors_destroy(css_selectors, True, True)             # <<<<<<<<<<<<<<
+ * 
+ * 
+ */
+    (void)(lxb_css_selectors_destroy(__pyx_v_css_selectors, 1, 1));
+
+    /* "resiliparse/parse/html.pyx":74
+ *     if selectors:
+ *         lxb_selectors_destroy(selectors, True)
+ *     if css_selectors:             # <<<<<<<<<<<<<<
+ *         lxb_css_selectors_destroy(css_selectors, True, True)
+ * 
+ */
+  }
+
+  /* "resiliparse/parse/html.pyx":71
+ * 
+ * 
+ * cdef void destroy_css_selectors(lxb_css_selectors_t* css_selectors, lxb_selectors_t* selectors) nogil:             # <<<<<<<<<<<<<<
+ *     if selectors:
+ *         lxb_selectors_destroy(selectors, True)
+ */
+
+  /* function exit code */
+}
+
+/* "resiliparse/parse/html.pyx":78
+ * 
+ * 
+ * cdef inline void _log_serialize_cb(const lxb_char_t *data, size_t len, void *ctx) nogil:             # <<<<<<<<<<<<<<
+ *     (<string*>ctx).append(<const char*>data, len)
+ * 
+ */
+
+static CYTHON_INLINE void __pyx_f_11resiliparse_5parse_4html__log_serialize_cb(lxb_char_t const *__pyx_v_data, size_t __pyx_v_len, void *__pyx_v_ctx) {
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+
+  /* "resiliparse/parse/html.pyx":79
+ * 
+ * cdef inline void _log_serialize_cb(const lxb_char_t *data, size_t len, void *ctx) nogil:
+ *     (<string*>ctx).append(<const char*>data, len)             # <<<<<<<<<<<<<<
+ * 
+ * 
+ */
+  try {
+    ((std::string *)__pyx_v_ctx)->append(((char const *)__pyx_v_data), __pyx_v_len);
+  } catch(...) {
+    #ifdef WITH_THREAD
+    PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
+    #endif
+    __Pyx_CppExn2PyErr();
+    #ifdef WITH_THREAD
+    __Pyx_PyGILState_Release(__pyx_gilstate_save);
+    #endif
+    __PYX_ERR(0, 79, __pyx_L1_error)
+  }
+
+  /* "resiliparse/parse/html.pyx":78
+ * 
+ * 
+ * cdef inline void _log_serialize_cb(const lxb_char_t *data, size_t len, void *ctx) nogil:             # <<<<<<<<<<<<<<
+ *     (<string*>ctx).append(<const char*>data, len)
+ * 
+ */
+
+  /* function exit code */
+  goto __pyx_L0;
+  __pyx_L1_error:;
+  __Pyx_WriteUnraisable("resiliparse.parse.html._log_serialize_cb", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 1);
+  __pyx_L0:;
+}
+
+/* "resiliparse/parse/html.pyx":82
+ * 
+ * 
+ * cdef lxb_css_selector_list_t* parse_css_selectors(lxb_css_parser_t* css_parser, const lxb_char_t* selector,             # <<<<<<<<<<<<<<
+ *                                                   size_t selector_len) except NULL:
+ *     cdef lxb_css_selector_list_t* sel_list = lxb_css_selectors_parse(css_parser, selector, selector_len)
+ */
+
+static lxb_css_selector_list_t *__pyx_f_11resiliparse_5parse_4html_parse_css_selectors(lxb_css_parser_t *__pyx_v_css_parser, lxb_char_t const *__pyx_v_selector, size_t __pyx_v_selector_len) {
+  lxb_css_selector_list_t *__pyx_v_sel_list;
+  std::string __pyx_v_err;
+  lxb_css_selector_list_t *__pyx_r;
+  __Pyx_RefNannyDeclarations
+  int __pyx_t_1;
+  PyObject *__pyx_t_2 = NULL;
+  PyObject *__pyx_t_3 = NULL;
+  PyObject *__pyx_t_4 = NULL;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
+  __Pyx_RefNannySetupContext("parse_css_selectors", 0);
+
+  /* "resiliparse/parse/html.pyx":84
+ * cdef lxb_css_selector_list_t* parse_css_selectors(lxb_css_parser_t* css_parser, const lxb_char_t* selector,
+ *                                                   size_t selector_len) except NULL:
+ *     cdef lxb_css_selector_list_t* sel_list = lxb_css_selectors_parse(css_parser, selector, selector_len)             # <<<<<<<<<<<<<<
+ *     cdef string err
+ *     if css_parser.status != LXB_STATUS_OK:
+ */
+  __pyx_v_sel_list = lxb_css_selectors_parse(__pyx_v_css_parser, __pyx_v_selector, __pyx_v_selector_len);
+
+  /* "resiliparse/parse/html.pyx":86
+ *     cdef lxb_css_selector_list_t* sel_list = lxb_css_selectors_parse(css_parser, selector, selector_len)
+ *     cdef string err
+ *     if css_parser.status != LXB_STATUS_OK:             # <<<<<<<<<<<<<<
+ *         lxb_css_log_serialize(css_parser.log, <lexbor_serialize_cb_f>_log_serialize_cb, &err, <lxb_char_t*>b'', 0)
+ *         raise ValueError(f'CSS parser error: {err.decode().strip()}')
+ */
+  __pyx_t_1 = ((__pyx_v_css_parser->status != LXB_STATUS_OK) != 0);
+  if (unlikely(__pyx_t_1)) {
+
+    /* "resiliparse/parse/html.pyx":87
+ *     cdef string err
+ *     if css_parser.status != LXB_STATUS_OK:
+ *         lxb_css_log_serialize(css_parser.log, <lexbor_serialize_cb_f>_log_serialize_cb, &err, <lxb_char_t*>b'', 0)             # <<<<<<<<<<<<<<
+ *         raise ValueError(f'CSS parser error: {err.decode().strip()}')
+ *     return sel_list
+ */
+    (void)(lxb_css_log_serialize(__pyx_v_css_parser->log, ((lexbor_serialize_cb_f)__pyx_f_11resiliparse_5parse_4html__log_serialize_cb), (&__pyx_v_err), ((lxb_char_t *)((lxb_char_t *)((char const *)""))), 0));
+
+    /* "resiliparse/parse/html.pyx":88
+ *     if css_parser.status != LXB_STATUS_OK:
+ *         lxb_css_log_serialize(css_parser.log, <lexbor_serialize_cb_f>_log_serialize_cb, &err, <lxb_char_t*>b'', 0)
+ *         raise ValueError(f'CSS parser error: {err.decode().strip()}')             # <<<<<<<<<<<<<<
+ *     return sel_list
+ * 
+ */
+    __pyx_t_3 = __Pyx_decode_cpp_string(__pyx_v_err, 0, PY_SSIZE_T_MAX, NULL, NULL, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_3);
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_strip); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
+    __pyx_t_3 = NULL;
+    if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
+      __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_4);
+      if (likely(__pyx_t_3)) {
+        PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
+        __Pyx_INCREF(__pyx_t_3);
+        __Pyx_INCREF(function);
+        __Pyx_DECREF_SET(__pyx_t_4, function);
+      }
+    }
+    __pyx_t_2 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_4);
+    __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
+    if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_2);
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    __pyx_t_4 = __Pyx_PyObject_FormatSimple(__pyx_t_2, __pyx_empty_unicode); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+    __pyx_t_2 = __Pyx_PyUnicode_Concat(__pyx_kp_u_CSS_parser_error, __pyx_t_4); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_2);
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    __pyx_t_4 = __Pyx_PyObject_CallOneArg(__pyx_builtin_ValueError, __pyx_t_2); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 88, __pyx_L1_error)
+    __Pyx_GOTREF(__pyx_t_4);
+    __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+    __Pyx_Raise(__pyx_t_4, 0, 0, 0);
+    __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+    __PYX_ERR(0, 88, __pyx_L1_error)
+
+    /* "resiliparse/parse/html.pyx":86
+ *     cdef lxb_css_selector_list_t* sel_list = lxb_css_selectors_parse(css_parser, selector, selector_len)
+ *     cdef string err
+ *     if css_parser.status != LXB_STATUS_OK:             # <<<<<<<<<<<<<<
+ *         lxb_css_log_serialize(css_parser.log, <lexbor_serialize_cb_f>_log_serialize_cb, &err, <lxb_char_t*>b'', 0)
+ *         raise ValueError(f'CSS parser error: {err.decode().strip()}')
+ */
+  }
+
+  /* "resiliparse/parse/html.pyx":89
+ *         lxb_css_log_serialize(css_parser.log, <lexbor_serialize_cb_f>_log_serialize_cb, &err, <lxb_char_t*>b'', 0)
+ *         raise ValueError(f'CSS parser error: {err.decode().strip()}')
+ *     return sel_list             # <<<<<<<<<<<<<<
+ * 
+ * 
+ */
+  __pyx_r = __pyx_v_sel_list;
+  goto __pyx_L0;
+
+  /* "resiliparse/parse/html.pyx":82
+ * 
+ * 
+ * cdef lxb_css_selector_list_t* parse_css_selectors(lxb_css_parser_t* css_parser, const lxb_char_t* selector,             # <<<<<<<<<<<<<<
+ *                                                   size_t selector_len) except NULL:
+ *     cdef lxb_css_selector_list_t* sel_list = lxb_css_selectors_parse(css_parser, selector, selector_len)
+ */
+
+  /* function exit code */
+  __pyx_L1_error:;
+  __Pyx_XDECREF(__pyx_t_2);
+  __Pyx_XDECREF(__pyx_t_3);
+  __Pyx_XDECREF(__pyx_t_4);
+  __Pyx_AddTraceback("resiliparse.parse.html.parse_css_selectors", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = NULL;
+  __pyx_L0:;
+  __Pyx_RefNannyFinishContext();
+  return __pyx_r;
+}
+
+/* "resiliparse/parse/html.pyx":92
+ * 
+ * 
  * cdef inline lxb_dom_node_t* next_node(const lxb_dom_node_t* root_node, lxb_dom_node_t* node,             # <<<<<<<<<<<<<<
  *                                       size_t* depth=NULL, bint* end_tag=NULL) nogil:
  *     """
  */
 
 static CYTHON_INLINE lxb_dom_node_t *__pyx_f_11resiliparse_5parse_4html_next_node(lxb_dom_node_t const *__pyx_v_root_node, lxb_dom_node_t *__pyx_v_node, struct __pyx_opt_args_11resiliparse_5parse_4html_next_node *__pyx_optional_args) {
 
-  /* "resiliparse/parse/html.pyx":45
+  /* "resiliparse/parse/html.pyx":93
  * 
  * cdef inline lxb_dom_node_t* next_node(const lxb_dom_node_t* root_node, lxb_dom_node_t* node,
  *                                       size_t* depth=NULL, bint* end_tag=NULL) nogil:             # <<<<<<<<<<<<<<
  *     """
  *     DOM tree pre-order traversal primitive.
  */
   size_t *__pyx_v_depth = ((size_t *)NULL);
@@ -3349,15 +3963,15 @@
       __pyx_v_depth = __pyx_optional_args->depth;
       if (__pyx_optional_args->__pyx_n > 1) {
         __pyx_v_end_tag = __pyx_optional_args->end_tag;
       }
     }
   }
 
-  /* "resiliparse/parse/html.pyx":59
+  /* "resiliparse/parse/html.pyx":107
  *     :returns: next node or ``NULL`` if done
  *     """
  *     cdef bint is_end = end_tag and end_tag[0]             # <<<<<<<<<<<<<<
  * 
  *     if not is_end and node.first_child:
  */
   __pyx_t_2 = (__pyx_v_end_tag != 0);
@@ -3367,15 +3981,15 @@
     goto __pyx_L3_bool_binop_done;
   }
   __pyx_t_2 = ((__pyx_v_end_tag[0]) != 0);
   __pyx_t_1 = __pyx_t_2;
   __pyx_L3_bool_binop_done:;
   __pyx_v_is_end = __pyx_t_1;
 
-  /* "resiliparse/parse/html.pyx":61
+  /* "resiliparse/parse/html.pyx":109
  *     cdef bint is_end = end_tag and end_tag[0]
  * 
  *     if not is_end and node.first_child:             # <<<<<<<<<<<<<<
  *         if depth:
  *             preinc(depth[0])
  */
   __pyx_t_2 = ((!(__pyx_v_is_end != 0)) != 0);
@@ -3385,62 +3999,62 @@
     goto __pyx_L6_bool_binop_done;
   }
   __pyx_t_2 = (__pyx_v_node->first_child != 0);
   __pyx_t_1 = __pyx_t_2;
   __pyx_L6_bool_binop_done:;
   if (__pyx_t_1) {
 
-    /* "resiliparse/parse/html.pyx":62
+    /* "resiliparse/parse/html.pyx":110
  * 
  *     if not is_end and node.first_child:
  *         if depth:             # <<<<<<<<<<<<<<
  *             preinc(depth[0])
  *         return node.first_child
  */
     __pyx_t_1 = (__pyx_v_depth != 0);
     if (__pyx_t_1) {
 
-      /* "resiliparse/parse/html.pyx":63
+      /* "resiliparse/parse/html.pyx":111
  *     if not is_end and node.first_child:
  *         if depth:
  *             preinc(depth[0])             # <<<<<<<<<<<<<<
  *         return node.first_child
  *     else:
  */
       (void)((++(__pyx_v_depth[0])));
 
-      /* "resiliparse/parse/html.pyx":62
+      /* "resiliparse/parse/html.pyx":110
  * 
  *     if not is_end and node.first_child:
  *         if depth:             # <<<<<<<<<<<<<<
  *             preinc(depth[0])
  *         return node.first_child
  */
     }
 
-    /* "resiliparse/parse/html.pyx":64
+    /* "resiliparse/parse/html.pyx":112
  *         if depth:
  *             preinc(depth[0])
  *         return node.first_child             # <<<<<<<<<<<<<<
  *     else:
  *         while not node.next and node != root_node:
  */
     __pyx_r = __pyx_v_node->first_child;
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":61
+    /* "resiliparse/parse/html.pyx":109
  *     cdef bint is_end = end_tag and end_tag[0]
  * 
  *     if not is_end and node.first_child:             # <<<<<<<<<<<<<<
  *         if depth:
  *             preinc(depth[0])
  */
   }
 
-  /* "resiliparse/parse/html.pyx":66
+  /* "resiliparse/parse/html.pyx":114
  *         return node.first_child
  *     else:
  *         while not node.next and node != root_node:             # <<<<<<<<<<<<<<
  *             node = node.parent
  *             if depth:
  */
   /*else*/ {
@@ -3452,173 +4066,173 @@
         goto __pyx_L11_bool_binop_done;
       }
       __pyx_t_2 = ((__pyx_v_node != __pyx_v_root_node) != 0);
       __pyx_t_1 = __pyx_t_2;
       __pyx_L11_bool_binop_done:;
       if (!__pyx_t_1) break;
 
-      /* "resiliparse/parse/html.pyx":67
+      /* "resiliparse/parse/html.pyx":115
  *     else:
  *         while not node.next and node != root_node:
  *             node = node.parent             # <<<<<<<<<<<<<<
  *             if depth:
  *                 predec(depth[0])
  */
       __pyx_t_3 = __pyx_v_node->parent;
       __pyx_v_node = __pyx_t_3;
 
-      /* "resiliparse/parse/html.pyx":68
+      /* "resiliparse/parse/html.pyx":116
  *         while not node.next and node != root_node:
  *             node = node.parent
  *             if depth:             # <<<<<<<<<<<<<<
  *                 predec(depth[0])
  *             if end_tag:
  */
       __pyx_t_1 = (__pyx_v_depth != 0);
       if (__pyx_t_1) {
 
-        /* "resiliparse/parse/html.pyx":69
+        /* "resiliparse/parse/html.pyx":117
  *             node = node.parent
  *             if depth:
  *                 predec(depth[0])             # <<<<<<<<<<<<<<
  *             if end_tag:
  *                 end_tag[0] = True
  */
         (void)((--(__pyx_v_depth[0])));
 
-        /* "resiliparse/parse/html.pyx":68
+        /* "resiliparse/parse/html.pyx":116
  *         while not node.next and node != root_node:
  *             node = node.parent
  *             if depth:             # <<<<<<<<<<<<<<
  *                 predec(depth[0])
  *             if end_tag:
  */
       }
 
-      /* "resiliparse/parse/html.pyx":70
+      /* "resiliparse/parse/html.pyx":118
  *             if depth:
  *                 predec(depth[0])
  *             if end_tag:             # <<<<<<<<<<<<<<
  *                 end_tag[0] = True
  *                 return node
  */
       __pyx_t_1 = (__pyx_v_end_tag != 0);
       if (__pyx_t_1) {
 
-        /* "resiliparse/parse/html.pyx":71
+        /* "resiliparse/parse/html.pyx":119
  *                 predec(depth[0])
  *             if end_tag:
  *                 end_tag[0] = True             # <<<<<<<<<<<<<<
  *                 return node
  * 
  */
         (__pyx_v_end_tag[0]) = 1;
 
-        /* "resiliparse/parse/html.pyx":72
+        /* "resiliparse/parse/html.pyx":120
  *             if end_tag:
  *                 end_tag[0] = True
  *                 return node             # <<<<<<<<<<<<<<
  * 
  *         if end_tag:
  */
         __pyx_r = __pyx_v_node;
         goto __pyx_L0;
 
-        /* "resiliparse/parse/html.pyx":70
+        /* "resiliparse/parse/html.pyx":118
  *             if depth:
  *                 predec(depth[0])
  *             if end_tag:             # <<<<<<<<<<<<<<
  *                 end_tag[0] = True
  *                 return node
  */
       }
     }
 
-    /* "resiliparse/parse/html.pyx":74
+    /* "resiliparse/parse/html.pyx":122
  *                 return node
  * 
  *         if end_tag:             # <<<<<<<<<<<<<<
  *             end_tag[0] = False
  *         if node == root_node:
  */
     __pyx_t_1 = (__pyx_v_end_tag != 0);
     if (__pyx_t_1) {
 
-      /* "resiliparse/parse/html.pyx":75
+      /* "resiliparse/parse/html.pyx":123
  * 
  *         if end_tag:
  *             end_tag[0] = False             # <<<<<<<<<<<<<<
  *         if node == root_node:
  *             return NULL
  */
       (__pyx_v_end_tag[0]) = 0;
 
-      /* "resiliparse/parse/html.pyx":74
+      /* "resiliparse/parse/html.pyx":122
  *                 return node
  * 
  *         if end_tag:             # <<<<<<<<<<<<<<
  *             end_tag[0] = False
  *         if node == root_node:
  */
     }
 
-    /* "resiliparse/parse/html.pyx":76
+    /* "resiliparse/parse/html.pyx":124
  *         if end_tag:
  *             end_tag[0] = False
  *         if node == root_node:             # <<<<<<<<<<<<<<
  *             return NULL
  *         return node.next
  */
     __pyx_t_1 = ((__pyx_v_node == __pyx_v_root_node) != 0);
     if (__pyx_t_1) {
 
-      /* "resiliparse/parse/html.pyx":77
+      /* "resiliparse/parse/html.pyx":125
  *             end_tag[0] = False
  *         if node == root_node:
  *             return NULL             # <<<<<<<<<<<<<<
  *         return node.next
  * 
  */
       __pyx_r = NULL;
       goto __pyx_L0;
 
-      /* "resiliparse/parse/html.pyx":76
+      /* "resiliparse/parse/html.pyx":124
  *         if end_tag:
  *             end_tag[0] = False
  *         if node == root_node:             # <<<<<<<<<<<<<<
  *             return NULL
  *         return node.next
  */
     }
 
-    /* "resiliparse/parse/html.pyx":78
+    /* "resiliparse/parse/html.pyx":126
  *         if node == root_node:
  *             return NULL
  *         return node.next             # <<<<<<<<<<<<<<
  * 
  * 
  */
     __pyx_r = __pyx_v_node->next;
     goto __pyx_L0;
   }
 
-  /* "resiliparse/parse/html.pyx":44
+  /* "resiliparse/parse/html.pyx":92
  * 
  * 
  * cdef inline lxb_dom_node_t* next_node(const lxb_dom_node_t* root_node, lxb_dom_node_t* node,             # <<<<<<<<<<<<<<
  *                                       size_t* depth=NULL, bint* end_tag=NULL) nogil:
  *     """
  */
 
   /* function exit code */
   __pyx_L0:;
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":81
+/* "resiliparse/parse/html.pyx":129
  * 
  * 
  * cdef inline string get_node_text(lxb_dom_node_t* node) nogil:             # <<<<<<<<<<<<<<
  *     """Get node inner text."""
  *     cdef size_t text_len = 0
  */
 
@@ -3630,33 +4244,33 @@
   int __pyx_t_1;
   int __pyx_t_2;
   std::string __pyx_t_3;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
 
-  /* "resiliparse/parse/html.pyx":83
+  /* "resiliparse/parse/html.pyx":131
  * cdef inline string get_node_text(lxb_dom_node_t* node) nogil:
  *     """Get node inner text."""
  *     cdef size_t text_len = 0             # <<<<<<<<<<<<<<
  *     cdef lxb_char_t* text = lxb_dom_node_text_content(node, &text_len)
  *     if not text or not text_len:
  */
   __pyx_v_text_len = 0;
 
-  /* "resiliparse/parse/html.pyx":84
+  /* "resiliparse/parse/html.pyx":132
  *     """Get node inner text."""
  *     cdef size_t text_len = 0
  *     cdef lxb_char_t* text = lxb_dom_node_text_content(node, &text_len)             # <<<<<<<<<<<<<<
  *     if not text or not text_len:
  *         return string()
  */
   __pyx_v_text = lxb_dom_node_text_content(__pyx_v_node, (&__pyx_v_text_len));
 
-  /* "resiliparse/parse/html.pyx":85
+  /* "resiliparse/parse/html.pyx":133
  *     cdef size_t text_len = 0
  *     cdef lxb_char_t* text = lxb_dom_node_text_content(node, &text_len)
  *     if not text or not text_len:             # <<<<<<<<<<<<<<
  *         return string()
  *     cdef string text_str = string(<const char*>text, text_len)
  */
   __pyx_t_2 = ((!(__pyx_v_text != 0)) != 0);
@@ -3666,15 +4280,15 @@
     goto __pyx_L4_bool_binop_done;
   }
   __pyx_t_2 = ((!(__pyx_v_text_len != 0)) != 0);
   __pyx_t_1 = __pyx_t_2;
   __pyx_L4_bool_binop_done:;
   if (__pyx_t_1) {
 
-    /* "resiliparse/parse/html.pyx":86
+    /* "resiliparse/parse/html.pyx":134
  *     cdef lxb_char_t* text = lxb_dom_node_text_content(node, &text_len)
  *     if not text or not text_len:
  *         return string()             # <<<<<<<<<<<<<<
  *     cdef string text_str = string(<const char*>text, text_len)
  *     lxb_dom_document_destroy_text(node.owner_document, text)
  */
     try {
@@ -3683,29 +4297,29 @@
       #ifdef WITH_THREAD
       PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
       #endif
       __Pyx_CppExn2PyErr();
       #ifdef WITH_THREAD
       __Pyx_PyGILState_Release(__pyx_gilstate_save);
       #endif
-      __PYX_ERR(0, 86, __pyx_L1_error)
+      __PYX_ERR(0, 134, __pyx_L1_error)
     }
     __pyx_r = __pyx_t_3;
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":85
+    /* "resiliparse/parse/html.pyx":133
  *     cdef size_t text_len = 0
  *     cdef lxb_char_t* text = lxb_dom_node_text_content(node, &text_len)
  *     if not text or not text_len:             # <<<<<<<<<<<<<<
  *         return string()
  *     cdef string text_str = string(<const char*>text, text_len)
  */
   }
 
-  /* "resiliparse/parse/html.pyx":87
+  /* "resiliparse/parse/html.pyx":135
  *     if not text or not text_len:
  *         return string()
  *     cdef string text_str = string(<const char*>text, text_len)             # <<<<<<<<<<<<<<
  *     lxb_dom_document_destroy_text(node.owner_document, text)
  *     return text_str
  */
   try {
@@ -3714,38 +4328,38 @@
     #ifdef WITH_THREAD
     PyGILState_STATE __pyx_gilstate_save = __Pyx_PyGILState_Ensure();
     #endif
     __Pyx_CppExn2PyErr();
     #ifdef WITH_THREAD
     __Pyx_PyGILState_Release(__pyx_gilstate_save);
     #endif
-    __PYX_ERR(0, 87, __pyx_L1_error)
+    __PYX_ERR(0, 135, __pyx_L1_error)
   }
   __pyx_v_text_str = __pyx_t_3;
 
-  /* "resiliparse/parse/html.pyx":88
+  /* "resiliparse/parse/html.pyx":136
  *         return string()
  *     cdef string text_str = string(<const char*>text, text_len)
  *     lxb_dom_document_destroy_text(node.owner_document, text)             # <<<<<<<<<<<<<<
  *     return text_str
  * 
  */
   (void)(lxb_dom_document_destroy_text(__pyx_v_node->owner_document, __pyx_v_text));
 
-  /* "resiliparse/parse/html.pyx":89
+  /* "resiliparse/parse/html.pyx":137
  *     cdef string text_str = string(<const char*>text, text_len)
  *     lxb_dom_document_destroy_text(node.owner_document, text)
  *     return text_str             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __pyx_r = __pyx_v_text_str;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":81
+  /* "resiliparse/parse/html.pyx":129
  * 
  * 
  * cdef inline string get_node_text(lxb_dom_node_t* node) nogil:             # <<<<<<<<<<<<<<
  *     """Get node inner text."""
  *     cdef size_t text_len = 0
  */
 
@@ -3753,15 +4367,15 @@
   __pyx_L1_error:;
   __Pyx_WriteUnraisable("resiliparse.parse.html.get_node_text", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 1);
   __Pyx_pretend_to_initialize(&__pyx_r);
   __pyx_L0:;
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":92
+/* "resiliparse/parse/html.pyx":140
  * 
  * 
  * cdef lxb_dom_collection_t* get_elements_by_class_name_impl(lxb_dom_node_t* node, bytes class_name, size_t init_size=5):             # <<<<<<<<<<<<<<
  *     """
  *     Return a collection of elements matching the given attribute name and value.
  */
 
@@ -3780,128 +4394,128 @@
   __Pyx_RefNannySetupContext("get_elements_by_class_name_impl", 0);
   if (__pyx_optional_args) {
     if (__pyx_optional_args->__pyx_n > 0) {
       __pyx_v_init_size = __pyx_optional_args->init_size;
     }
   }
 
-  /* "resiliparse/parse/html.pyx":103
+  /* "resiliparse/parse/html.pyx":151
  *     :return: pointer to created DOM collection or ``NULL`` if error occurred
  *     """
  *     cdef lxb_dom_collection_t * coll = lxb_dom_collection_make(node.owner_document, init_size)             # <<<<<<<<<<<<<<
  *     if not coll:
  *         return NULL
  */
   __pyx_v_coll = lxb_dom_collection_make(__pyx_v_node->owner_document, __pyx_v_init_size);
 
-  /* "resiliparse/parse/html.pyx":104
+  /* "resiliparse/parse/html.pyx":152
  *     """
  *     cdef lxb_dom_collection_t * coll = lxb_dom_collection_make(node.owner_document, init_size)
  *     if not coll:             # <<<<<<<<<<<<<<
  *         return NULL
  * 
  */
   __pyx_t_1 = ((!(__pyx_v_coll != 0)) != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/parse/html.pyx":105
+    /* "resiliparse/parse/html.pyx":153
  *     cdef lxb_dom_collection_t * coll = lxb_dom_collection_make(node.owner_document, init_size)
  *     if not coll:
  *         return NULL             # <<<<<<<<<<<<<<
  * 
  *     cdef lxb_status_t status = lxb_dom_elements_by_class_name(<lxb_dom_element_t*>node, coll,
  */
     __pyx_r = NULL;
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":104
+    /* "resiliparse/parse/html.pyx":152
  *     """
  *     cdef lxb_dom_collection_t * coll = lxb_dom_collection_make(node.owner_document, init_size)
  *     if not coll:             # <<<<<<<<<<<<<<
  *         return NULL
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":108
+  /* "resiliparse/parse/html.pyx":156
  * 
  *     cdef lxb_status_t status = lxb_dom_elements_by_class_name(<lxb_dom_element_t*>node, coll,
  *                                                               <lxb_char_t*>class_name, len(class_name))             # <<<<<<<<<<<<<<
  * 
  *     if status != LXB_STATUS_OK:
  */
   if (unlikely(__pyx_v_class_name == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "expected bytes, NoneType found");
-    __PYX_ERR(0, 108, __pyx_L1_error)
+    __PYX_ERR(0, 156, __pyx_L1_error)
   }
-  __pyx_t_2 = __Pyx_PyBytes_AsWritableUString(__pyx_v_class_name); if (unlikely((!__pyx_t_2) && PyErr_Occurred())) __PYX_ERR(0, 108, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyBytes_AsWritableUString(__pyx_v_class_name); if (unlikely((!__pyx_t_2) && PyErr_Occurred())) __PYX_ERR(0, 156, __pyx_L1_error)
   if (unlikely(__pyx_v_class_name == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-    __PYX_ERR(0, 108, __pyx_L1_error)
+    __PYX_ERR(0, 156, __pyx_L1_error)
   }
-  __pyx_t_3 = PyBytes_GET_SIZE(__pyx_v_class_name); if (unlikely(__pyx_t_3 == ((Py_ssize_t)-1))) __PYX_ERR(0, 108, __pyx_L1_error)
+  __pyx_t_3 = PyBytes_GET_SIZE(__pyx_v_class_name); if (unlikely(__pyx_t_3 == ((Py_ssize_t)-1))) __PYX_ERR(0, 156, __pyx_L1_error)
 
-  /* "resiliparse/parse/html.pyx":107
+  /* "resiliparse/parse/html.pyx":155
  *         return NULL
  * 
  *     cdef lxb_status_t status = lxb_dom_elements_by_class_name(<lxb_dom_element_t*>node, coll,             # <<<<<<<<<<<<<<
  *                                                               <lxb_char_t*>class_name, len(class_name))
  * 
  */
   __pyx_v_status = lxb_dom_elements_by_class_name(((lxb_dom_element_t *)__pyx_v_node), __pyx_v_coll, ((lxb_char_t *)__pyx_t_2), __pyx_t_3);
 
-  /* "resiliparse/parse/html.pyx":110
+  /* "resiliparse/parse/html.pyx":158
  *                                                               <lxb_char_t*>class_name, len(class_name))
  * 
  *     if status != LXB_STATUS_OK:             # <<<<<<<<<<<<<<
  *         lxb_dom_collection_destroy(coll, True)
  *         return NULL
  */
   __pyx_t_1 = ((__pyx_v_status != LXB_STATUS_OK) != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/parse/html.pyx":111
+    /* "resiliparse/parse/html.pyx":159
  * 
  *     if status != LXB_STATUS_OK:
  *         lxb_dom_collection_destroy(coll, True)             # <<<<<<<<<<<<<<
  *         return NULL
  * 
  */
     (void)(lxb_dom_collection_destroy(__pyx_v_coll, 1));
 
-    /* "resiliparse/parse/html.pyx":112
+    /* "resiliparse/parse/html.pyx":160
  *     if status != LXB_STATUS_OK:
  *         lxb_dom_collection_destroy(coll, True)
  *         return NULL             # <<<<<<<<<<<<<<
  * 
  *     return coll
  */
     __pyx_r = NULL;
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":110
+    /* "resiliparse/parse/html.pyx":158
  *                                                               <lxb_char_t*>class_name, len(class_name))
  * 
  *     if status != LXB_STATUS_OK:             # <<<<<<<<<<<<<<
  *         lxb_dom_collection_destroy(coll, True)
  *         return NULL
  */
   }
 
-  /* "resiliparse/parse/html.pyx":114
+  /* "resiliparse/parse/html.pyx":162
  *         return NULL
  * 
  *     return coll             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __pyx_r = __pyx_v_coll;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":92
+  /* "resiliparse/parse/html.pyx":140
  * 
  * 
  * cdef lxb_dom_collection_t* get_elements_by_class_name_impl(lxb_dom_node_t* node, bytes class_name, size_t init_size=5):             # <<<<<<<<<<<<<<
  *     """
  *     Return a collection of elements matching the given attribute name and value.
  */
 
@@ -3910,15 +4524,15 @@
   __Pyx_WriteUnraisable("resiliparse.parse.html.get_elements_by_class_name_impl", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":125
+/* "resiliparse/parse/html.pyx":173
  * 
  * 
  * cdef inline lexbor_action_t element_by_id_callback(lxb_dom_node_t* node, void* ctx) nogil:             # <<<<<<<<<<<<<<
  *     if node.type != LXB_DOM_NODE_TYPE_ELEMENT:
  *         return LEXBOR_ACTION_OK
  */
 
@@ -3926,71 +4540,71 @@
   __pyx_t_11resiliparse_5parse_4html_element_by_id_match_ctx_t *__pyx_v_match_ctx;
   lxb_char_t const *__pyx_v_id_val;
   size_t __pyx_v_id_val_len;
   lexbor_action_t __pyx_r;
   int __pyx_t_1;
   int __pyx_t_2;
 
-  /* "resiliparse/parse/html.pyx":126
+  /* "resiliparse/parse/html.pyx":174
  * 
  * cdef inline lexbor_action_t element_by_id_callback(lxb_dom_node_t* node, void* ctx) nogil:
  *     if node.type != LXB_DOM_NODE_TYPE_ELEMENT:             # <<<<<<<<<<<<<<
  *         return LEXBOR_ACTION_OK
  * 
  */
   __pyx_t_1 = ((__pyx_v_node->type != LXB_DOM_NODE_TYPE_ELEMENT) != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/parse/html.pyx":127
+    /* "resiliparse/parse/html.pyx":175
  * cdef inline lexbor_action_t element_by_id_callback(lxb_dom_node_t* node, void* ctx) nogil:
  *     if node.type != LXB_DOM_NODE_TYPE_ELEMENT:
  *         return LEXBOR_ACTION_OK             # <<<<<<<<<<<<<<
  * 
  *     cdef element_by_id_match_ctx_t* match_ctx = <element_by_id_match_ctx_t*>ctx
  */
     __pyx_r = LEXBOR_ACTION_OK;
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":126
+    /* "resiliparse/parse/html.pyx":174
  * 
  * cdef inline lexbor_action_t element_by_id_callback(lxb_dom_node_t* node, void* ctx) nogil:
  *     if node.type != LXB_DOM_NODE_TYPE_ELEMENT:             # <<<<<<<<<<<<<<
  *         return LEXBOR_ACTION_OK
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":129
+  /* "resiliparse/parse/html.pyx":177
  *         return LEXBOR_ACTION_OK
  * 
  *     cdef element_by_id_match_ctx_t* match_ctx = <element_by_id_match_ctx_t*>ctx             # <<<<<<<<<<<<<<
  *     cdef const lxb_char_t* id_val
  *     cdef size_t id_val_len = 0
  */
   __pyx_v_match_ctx = ((__pyx_t_11resiliparse_5parse_4html_element_by_id_match_ctx_t *)__pyx_v_ctx);
 
-  /* "resiliparse/parse/html.pyx":131
+  /* "resiliparse/parse/html.pyx":179
  *     cdef element_by_id_match_ctx_t* match_ctx = <element_by_id_match_ctx_t*>ctx
  *     cdef const lxb_char_t* id_val
  *     cdef size_t id_val_len = 0             # <<<<<<<<<<<<<<
  * 
  *     id_val = lxb_dom_element_id(<lxb_dom_element_t*>node, &id_val_len)
  */
   __pyx_v_id_val_len = 0;
 
-  /* "resiliparse/parse/html.pyx":133
+  /* "resiliparse/parse/html.pyx":181
  *     cdef size_t id_val_len = 0
  * 
  *     id_val = lxb_dom_element_id(<lxb_dom_element_t*>node, &id_val_len)             # <<<<<<<<<<<<<<
  *     if not id_val or id_val_len != match_ctx.id_val_len:
  *         return LEXBOR_ACTION_OK
  */
   __pyx_v_id_val = lxb_dom_element_id(((lxb_dom_element_t *)__pyx_v_node), (&__pyx_v_id_val_len));
 
-  /* "resiliparse/parse/html.pyx":134
+  /* "resiliparse/parse/html.pyx":182
  * 
  *     id_val = lxb_dom_element_id(<lxb_dom_element_t*>node, &id_val_len)
  *     if not id_val or id_val_len != match_ctx.id_val_len:             # <<<<<<<<<<<<<<
  *         return LEXBOR_ACTION_OK
  * 
  */
   __pyx_t_2 = ((!(__pyx_v_id_val != 0)) != 0);
@@ -4000,95 +4614,95 @@
     goto __pyx_L5_bool_binop_done;
   }
   __pyx_t_2 = ((__pyx_v_id_val_len != __pyx_v_match_ctx->id_val_len) != 0);
   __pyx_t_1 = __pyx_t_2;
   __pyx_L5_bool_binop_done:;
   if (__pyx_t_1) {
 
-    /* "resiliparse/parse/html.pyx":135
+    /* "resiliparse/parse/html.pyx":183
  *     id_val = lxb_dom_element_id(<lxb_dom_element_t*>node, &id_val_len)
  *     if not id_val or id_val_len != match_ctx.id_val_len:
  *         return LEXBOR_ACTION_OK             # <<<<<<<<<<<<<<
  * 
  *     if lexbor_str_data_ncmp(id_val, match_ctx.id_val, id_val_len):
  */
     __pyx_r = LEXBOR_ACTION_OK;
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":134
+    /* "resiliparse/parse/html.pyx":182
  * 
  *     id_val = lxb_dom_element_id(<lxb_dom_element_t*>node, &id_val_len)
  *     if not id_val or id_val_len != match_ctx.id_val_len:             # <<<<<<<<<<<<<<
  *         return LEXBOR_ACTION_OK
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":137
+  /* "resiliparse/parse/html.pyx":185
  *         return LEXBOR_ACTION_OK
  * 
  *     if lexbor_str_data_ncmp(id_val, match_ctx.id_val, id_val_len):             # <<<<<<<<<<<<<<
  *         match_ctx.result_node = node
  *         return LEXBOR_ACTION_STOP
  */
   __pyx_t_1 = (lexbor_str_data_ncmp(__pyx_v_id_val, __pyx_v_match_ctx->id_val, __pyx_v_id_val_len) != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/parse/html.pyx":138
+    /* "resiliparse/parse/html.pyx":186
  * 
  *     if lexbor_str_data_ncmp(id_val, match_ctx.id_val, id_val_len):
  *         match_ctx.result_node = node             # <<<<<<<<<<<<<<
  *         return LEXBOR_ACTION_STOP
  * 
  */
     __pyx_v_match_ctx->result_node = __pyx_v_node;
 
-    /* "resiliparse/parse/html.pyx":139
+    /* "resiliparse/parse/html.pyx":187
  *     if lexbor_str_data_ncmp(id_val, match_ctx.id_val, id_val_len):
  *         match_ctx.result_node = node
  *         return LEXBOR_ACTION_STOP             # <<<<<<<<<<<<<<
  * 
  *     return LEXBOR_ACTION_OK
  */
     __pyx_r = LEXBOR_ACTION_STOP;
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":137
+    /* "resiliparse/parse/html.pyx":185
  *         return LEXBOR_ACTION_OK
  * 
  *     if lexbor_str_data_ncmp(id_val, match_ctx.id_val, id_val_len):             # <<<<<<<<<<<<<<
  *         match_ctx.result_node = node
  *         return LEXBOR_ACTION_STOP
  */
   }
 
-  /* "resiliparse/parse/html.pyx":141
+  /* "resiliparse/parse/html.pyx":189
  *         return LEXBOR_ACTION_STOP
  * 
  *     return LEXBOR_ACTION_OK             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __pyx_r = LEXBOR_ACTION_OK;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":125
+  /* "resiliparse/parse/html.pyx":173
  * 
  * 
  * cdef inline lexbor_action_t element_by_id_callback(lxb_dom_node_t* node, void* ctx) nogil:             # <<<<<<<<<<<<<<
  *     if node.type != LXB_DOM_NODE_TYPE_ELEMENT:
  *         return LEXBOR_ACTION_OK
  */
 
   /* function exit code */
   __pyx_L0:;
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":144
+/* "resiliparse/parse/html.pyx":192
  * 
  * 
  * cdef lxb_dom_node_t* get_element_by_id_impl(lxb_dom_node_t* node, bytes id_value, bint case_insensitive=False):             # <<<<<<<<<<<<<<
  *     """
  *     Return a pointer to the first element matching the given ID or NULL.
  */
 
@@ -4102,56 +4716,56 @@
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("get_element_by_id_impl", 0);
   if (__pyx_optional_args) {
   }
 
-  /* "resiliparse/parse/html.pyx":154
+  /* "resiliparse/parse/html.pyx":202
  *     """
  * 
  *     cdef element_by_id_match_ctx ctx = [<const lxb_char_t*>id_value, len(id_value), NULL]             # <<<<<<<<<<<<<<
  *     lxb_dom_node_simple_walk(node, <lxb_dom_node_simple_walker_f>element_by_id_callback, &ctx)
  *     return ctx.result_node
  */
   if (unlikely(__pyx_v_id_value == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "expected bytes, NoneType found");
-    __PYX_ERR(0, 154, __pyx_L1_error)
+    __PYX_ERR(0, 202, __pyx_L1_error)
   }
-  __pyx_t_1 = __Pyx_PyBytes_AsUString(__pyx_v_id_value); if (unlikely((!__pyx_t_1) && PyErr_Occurred())) __PYX_ERR(0, 154, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyBytes_AsUString(__pyx_v_id_value); if (unlikely((!__pyx_t_1) && PyErr_Occurred())) __PYX_ERR(0, 202, __pyx_L1_error)
   if (unlikely(__pyx_v_id_value == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-    __PYX_ERR(0, 154, __pyx_L1_error)
+    __PYX_ERR(0, 202, __pyx_L1_error)
   }
-  __pyx_t_2 = PyBytes_GET_SIZE(__pyx_v_id_value); if (unlikely(__pyx_t_2 == ((Py_ssize_t)-1))) __PYX_ERR(0, 154, __pyx_L1_error)
+  __pyx_t_2 = PyBytes_GET_SIZE(__pyx_v_id_value); if (unlikely(__pyx_t_2 == ((Py_ssize_t)-1))) __PYX_ERR(0, 202, __pyx_L1_error)
   __pyx_t_3.id_val = ((lxb_char_t const *)__pyx_t_1);
   __pyx_t_3.id_val_len = __pyx_t_2;
   __pyx_t_3.result_node = NULL;
   __pyx_v_ctx = __pyx_t_3;
 
-  /* "resiliparse/parse/html.pyx":155
+  /* "resiliparse/parse/html.pyx":203
  * 
  *     cdef element_by_id_match_ctx ctx = [<const lxb_char_t*>id_value, len(id_value), NULL]
  *     lxb_dom_node_simple_walk(node, <lxb_dom_node_simple_walker_f>element_by_id_callback, &ctx)             # <<<<<<<<<<<<<<
  *     return ctx.result_node
  * 
  */
   lxb_dom_node_simple_walk(__pyx_v_node, ((lxb_dom_node_simple_walker_f)__pyx_f_11resiliparse_5parse_4html_element_by_id_callback), (&__pyx_v_ctx));
 
-  /* "resiliparse/parse/html.pyx":156
+  /* "resiliparse/parse/html.pyx":204
  *     cdef element_by_id_match_ctx ctx = [<const lxb_char_t*>id_value, len(id_value), NULL]
  *     lxb_dom_node_simple_walk(node, <lxb_dom_node_simple_walker_f>element_by_id_callback, &ctx)
  *     return ctx.result_node             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __pyx_r = __pyx_v_ctx.result_node;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":144
+  /* "resiliparse/parse/html.pyx":192
  * 
  * 
  * cdef lxb_dom_node_t* get_element_by_id_impl(lxb_dom_node_t* node, bytes id_value, bint case_insensitive=False):             # <<<<<<<<<<<<<<
  *     """
  *     Return a pointer to the first element matching the given ID or NULL.
  */
 
@@ -4160,26 +4774,26 @@
   __Pyx_WriteUnraisable("resiliparse.parse.html.get_element_by_id_impl", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":159
+/* "resiliparse/parse/html.pyx":207
  * 
  * 
  * cdef lxb_dom_collection_t* get_elements_by_attr_impl(lxb_dom_node_t* node, bytes attr_name, bytes attr_value,             # <<<<<<<<<<<<<<
  *                                                      size_t init_size=5, bint case_insensitive=False):
  *     """
  */
 
 static lxb_dom_collection_t *__pyx_f_11resiliparse_5parse_4html_get_elements_by_attr_impl(lxb_dom_node_t *__pyx_v_node, PyObject *__pyx_v_attr_name, PyObject *__pyx_v_attr_value, struct __pyx_opt_args_11resiliparse_5parse_4html_get_elements_by_attr_impl *__pyx_optional_args) {
   size_t __pyx_v_init_size = ((size_t)5);
 
-  /* "resiliparse/parse/html.pyx":160
+  /* "resiliparse/parse/html.pyx":208
  * 
  * cdef lxb_dom_collection_t* get_elements_by_attr_impl(lxb_dom_node_t* node, bytes attr_name, bytes attr_value,
  *                                                      size_t init_size=5, bint case_insensitive=False):             # <<<<<<<<<<<<<<
  *     """
  *     Return a collection of elements matching the given attribute name and value.
  */
   int __pyx_v_case_insensitive = ((int)0);
@@ -4201,146 +4815,146 @@
       __pyx_v_init_size = __pyx_optional_args->init_size;
       if (__pyx_optional_args->__pyx_n > 1) {
         __pyx_v_case_insensitive = __pyx_optional_args->case_insensitive;
       }
     }
   }
 
-  /* "resiliparse/parse/html.pyx":173
+  /* "resiliparse/parse/html.pyx":221
  *     :return: pointer to created DOM collection or ``NULL`` if error occurred
  *     """
  *     cdef lxb_dom_collection_t * coll = lxb_dom_collection_make(node.owner_document, init_size)             # <<<<<<<<<<<<<<
  *     if not coll:
  *         return NULL
  */
   __pyx_v_coll = lxb_dom_collection_make(__pyx_v_node->owner_document, __pyx_v_init_size);
 
-  /* "resiliparse/parse/html.pyx":174
+  /* "resiliparse/parse/html.pyx":222
  *     """
  *     cdef lxb_dom_collection_t * coll = lxb_dom_collection_make(node.owner_document, init_size)
  *     if not coll:             # <<<<<<<<<<<<<<
  *         return NULL
  * 
  */
   __pyx_t_1 = ((!(__pyx_v_coll != 0)) != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/parse/html.pyx":175
+    /* "resiliparse/parse/html.pyx":223
  *     cdef lxb_dom_collection_t * coll = lxb_dom_collection_make(node.owner_document, init_size)
  *     if not coll:
  *         return NULL             # <<<<<<<<<<<<<<
  * 
  *     cdef lxb_status_t status = lxb_dom_elements_by_attr(<lxb_dom_element_t*>node, coll,
  */
     __pyx_r = NULL;
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":174
+    /* "resiliparse/parse/html.pyx":222
  *     """
  *     cdef lxb_dom_collection_t * coll = lxb_dom_collection_make(node.owner_document, init_size)
  *     if not coll:             # <<<<<<<<<<<<<<
  *         return NULL
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":178
+  /* "resiliparse/parse/html.pyx":226
  * 
  *     cdef lxb_status_t status = lxb_dom_elements_by_attr(<lxb_dom_element_t*>node, coll,
  *                                                         <lxb_char_t*>attr_name, len(attr_name),             # <<<<<<<<<<<<<<
  *                                                         <lxb_char_t*>attr_value, len(attr_value),
  *                                                         case_insensitive)
  */
   if (unlikely(__pyx_v_attr_name == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "expected bytes, NoneType found");
-    __PYX_ERR(0, 178, __pyx_L1_error)
+    __PYX_ERR(0, 226, __pyx_L1_error)
   }
-  __pyx_t_2 = __Pyx_PyBytes_AsWritableUString(__pyx_v_attr_name); if (unlikely((!__pyx_t_2) && PyErr_Occurred())) __PYX_ERR(0, 178, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyBytes_AsWritableUString(__pyx_v_attr_name); if (unlikely((!__pyx_t_2) && PyErr_Occurred())) __PYX_ERR(0, 226, __pyx_L1_error)
   if (unlikely(__pyx_v_attr_name == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-    __PYX_ERR(0, 178, __pyx_L1_error)
+    __PYX_ERR(0, 226, __pyx_L1_error)
   }
-  __pyx_t_3 = PyBytes_GET_SIZE(__pyx_v_attr_name); if (unlikely(__pyx_t_3 == ((Py_ssize_t)-1))) __PYX_ERR(0, 178, __pyx_L1_error)
+  __pyx_t_3 = PyBytes_GET_SIZE(__pyx_v_attr_name); if (unlikely(__pyx_t_3 == ((Py_ssize_t)-1))) __PYX_ERR(0, 226, __pyx_L1_error)
 
-  /* "resiliparse/parse/html.pyx":179
+  /* "resiliparse/parse/html.pyx":227
  *     cdef lxb_status_t status = lxb_dom_elements_by_attr(<lxb_dom_element_t*>node, coll,
  *                                                         <lxb_char_t*>attr_name, len(attr_name),
  *                                                         <lxb_char_t*>attr_value, len(attr_value),             # <<<<<<<<<<<<<<
  *                                                         case_insensitive)
  * 
  */
   if (unlikely(__pyx_v_attr_value == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "expected bytes, NoneType found");
-    __PYX_ERR(0, 179, __pyx_L1_error)
+    __PYX_ERR(0, 227, __pyx_L1_error)
   }
-  __pyx_t_4 = __Pyx_PyBytes_AsWritableUString(__pyx_v_attr_value); if (unlikely((!__pyx_t_4) && PyErr_Occurred())) __PYX_ERR(0, 179, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyBytes_AsWritableUString(__pyx_v_attr_value); if (unlikely((!__pyx_t_4) && PyErr_Occurred())) __PYX_ERR(0, 227, __pyx_L1_error)
   if (unlikely(__pyx_v_attr_value == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-    __PYX_ERR(0, 179, __pyx_L1_error)
+    __PYX_ERR(0, 227, __pyx_L1_error)
   }
-  __pyx_t_5 = PyBytes_GET_SIZE(__pyx_v_attr_value); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 179, __pyx_L1_error)
+  __pyx_t_5 = PyBytes_GET_SIZE(__pyx_v_attr_value); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 227, __pyx_L1_error)
 
-  /* "resiliparse/parse/html.pyx":177
+  /* "resiliparse/parse/html.pyx":225
  *         return NULL
  * 
  *     cdef lxb_status_t status = lxb_dom_elements_by_attr(<lxb_dom_element_t*>node, coll,             # <<<<<<<<<<<<<<
  *                                                         <lxb_char_t*>attr_name, len(attr_name),
  *                                                         <lxb_char_t*>attr_value, len(attr_value),
  */
   __pyx_v_status = lxb_dom_elements_by_attr(((lxb_dom_element_t *)__pyx_v_node), __pyx_v_coll, ((lxb_char_t *)__pyx_t_2), __pyx_t_3, ((lxb_char_t *)__pyx_t_4), __pyx_t_5, __pyx_v_case_insensitive);
 
-  /* "resiliparse/parse/html.pyx":182
+  /* "resiliparse/parse/html.pyx":230
  *                                                         case_insensitive)
  * 
  *     if status != LXB_STATUS_OK:             # <<<<<<<<<<<<<<
  *         lxb_dom_collection_destroy(coll, True)
  *         return NULL
  */
   __pyx_t_1 = ((__pyx_v_status != LXB_STATUS_OK) != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/parse/html.pyx":183
+    /* "resiliparse/parse/html.pyx":231
  * 
  *     if status != LXB_STATUS_OK:
  *         lxb_dom_collection_destroy(coll, True)             # <<<<<<<<<<<<<<
  *         return NULL
  * 
  */
     (void)(lxb_dom_collection_destroy(__pyx_v_coll, 1));
 
-    /* "resiliparse/parse/html.pyx":184
+    /* "resiliparse/parse/html.pyx":232
  *     if status != LXB_STATUS_OK:
  *         lxb_dom_collection_destroy(coll, True)
  *         return NULL             # <<<<<<<<<<<<<<
  * 
  *     return coll
  */
     __pyx_r = NULL;
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":182
+    /* "resiliparse/parse/html.pyx":230
  *                                                         case_insensitive)
  * 
  *     if status != LXB_STATUS_OK:             # <<<<<<<<<<<<<<
  *         lxb_dom_collection_destroy(coll, True)
  *         return NULL
  */
   }
 
-  /* "resiliparse/parse/html.pyx":186
+  /* "resiliparse/parse/html.pyx":234
  *         return NULL
  * 
  *     return coll             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __pyx_r = __pyx_v_coll;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":159
+  /* "resiliparse/parse/html.pyx":207
  * 
  * 
  * cdef lxb_dom_collection_t* get_elements_by_attr_impl(lxb_dom_node_t* node, bytes attr_name, bytes attr_value,             # <<<<<<<<<<<<<<
  *                                                      size_t init_size=5, bint case_insensitive=False):
  *     """
  */
 
@@ -4349,15 +4963,15 @@
   __Pyx_WriteUnraisable("resiliparse.parse.html.get_elements_by_attr_impl", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":189
+/* "resiliparse/parse/html.pyx":237
  * 
  * 
  * cdef lxb_dom_collection_t* get_elements_by_tag_name_impl(lxb_dom_node_t* node, bytes tag_name):             # <<<<<<<<<<<<<<
  *     """
  *     Return a collection of elements matching the given tag name.
  */
 
@@ -4371,93 +4985,93 @@
   lxb_char_t *__pyx_t_3;
   Py_ssize_t __pyx_t_4;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("get_elements_by_tag_name_impl", 0);
 
-  /* "resiliparse/parse/html.pyx":198
+  /* "resiliparse/parse/html.pyx":246
  *     :param tag_name: tag name as UTF-8 bytes
  *     """
  *     cdef lxb_dom_collection_t* coll = lxb_dom_collection_make(node.owner_document, 20)             # <<<<<<<<<<<<<<
  *     if not coll:
  *         raise RuntimeError('Failed to create DOM collection')
  */
   __pyx_v_coll = lxb_dom_collection_make(__pyx_v_node->owner_document, 20);
 
-  /* "resiliparse/parse/html.pyx":199
+  /* "resiliparse/parse/html.pyx":247
  *     """
  *     cdef lxb_dom_collection_t* coll = lxb_dom_collection_make(node.owner_document, 20)
  *     if not coll:             # <<<<<<<<<<<<<<
  *         raise RuntimeError('Failed to create DOM collection')
  * 
  */
   __pyx_t_1 = ((!(__pyx_v_coll != 0)) != 0);
   if (unlikely(__pyx_t_1)) {
 
-    /* "resiliparse/parse/html.pyx":200
+    /* "resiliparse/parse/html.pyx":248
  *     cdef lxb_dom_collection_t* coll = lxb_dom_collection_make(node.owner_document, 20)
  *     if not coll:
  *         raise RuntimeError('Failed to create DOM collection')             # <<<<<<<<<<<<<<
  * 
  *     cdef lxb_status_t status = lxb_dom_elements_by_tag_name(<lxb_dom_element_t*>node,
  */
-    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_RuntimeError, __pyx_tuple_, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 200, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_RuntimeError, __pyx_tuple__4, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 248, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_Raise(__pyx_t_2, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __PYX_ERR(0, 200, __pyx_L1_error)
+    __PYX_ERR(0, 248, __pyx_L1_error)
 
-    /* "resiliparse/parse/html.pyx":199
+    /* "resiliparse/parse/html.pyx":247
  *     """
  *     cdef lxb_dom_collection_t* coll = lxb_dom_collection_make(node.owner_document, 20)
  *     if not coll:             # <<<<<<<<<<<<<<
  *         raise RuntimeError('Failed to create DOM collection')
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":203
+  /* "resiliparse/parse/html.pyx":251
  * 
  *     cdef lxb_status_t status = lxb_dom_elements_by_tag_name(<lxb_dom_element_t*>node,
  *                                                             coll, <lxb_char_t*>tag_name, len(tag_name))             # <<<<<<<<<<<<<<
  *     return coll
  * 
  */
   if (unlikely(__pyx_v_tag_name == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "expected bytes, NoneType found");
-    __PYX_ERR(0, 203, __pyx_L1_error)
+    __PYX_ERR(0, 251, __pyx_L1_error)
   }
-  __pyx_t_3 = __Pyx_PyBytes_AsWritableUString(__pyx_v_tag_name); if (unlikely((!__pyx_t_3) && PyErr_Occurred())) __PYX_ERR(0, 203, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyBytes_AsWritableUString(__pyx_v_tag_name); if (unlikely((!__pyx_t_3) && PyErr_Occurred())) __PYX_ERR(0, 251, __pyx_L1_error)
   if (unlikely(__pyx_v_tag_name == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-    __PYX_ERR(0, 203, __pyx_L1_error)
+    __PYX_ERR(0, 251, __pyx_L1_error)
   }
-  __pyx_t_4 = PyBytes_GET_SIZE(__pyx_v_tag_name); if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 203, __pyx_L1_error)
+  __pyx_t_4 = PyBytes_GET_SIZE(__pyx_v_tag_name); if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 251, __pyx_L1_error)
 
-  /* "resiliparse/parse/html.pyx":202
+  /* "resiliparse/parse/html.pyx":250
  *         raise RuntimeError('Failed to create DOM collection')
  * 
  *     cdef lxb_status_t status = lxb_dom_elements_by_tag_name(<lxb_dom_element_t*>node,             # <<<<<<<<<<<<<<
  *                                                             coll, <lxb_char_t*>tag_name, len(tag_name))
  *     return coll
  */
   __pyx_v_status = lxb_dom_elements_by_tag_name(((lxb_dom_element_t *)__pyx_v_node), __pyx_v_coll, ((lxb_char_t *)__pyx_t_3), __pyx_t_4);
 
-  /* "resiliparse/parse/html.pyx":204
+  /* "resiliparse/parse/html.pyx":252
  *     cdef lxb_status_t status = lxb_dom_elements_by_tag_name(<lxb_dom_element_t*>node,
  *                                                             coll, <lxb_char_t*>tag_name, len(tag_name))
  *     return coll             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __pyx_r = __pyx_v_coll;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":189
+  /* "resiliparse/parse/html.pyx":237
  * 
  * 
  * cdef lxb_dom_collection_t* get_elements_by_tag_name_impl(lxb_dom_node_t* node, bytes tag_name):             # <<<<<<<<<<<<<<
  *     """
  *     Return a collection of elements matching the given tag name.
  */
 
@@ -4467,523 +5081,505 @@
   __Pyx_WriteUnraisable("resiliparse.parse.html.get_elements_by_tag_name_impl", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":207
+/* "resiliparse/parse/html.pyx":255
  * 
  * 
  * cdef inline lxb_status_t css_select_callback(lxb_dom_node_t* node, lxb_css_selector_specificity_t* spec,             # <<<<<<<<<<<<<<
  *                                              void* ctx) nogil:
  *     lxb_dom_collection_append(<lxb_dom_collection_t*>ctx, node)
  */
 
 static CYTHON_INLINE lxb_status_t __pyx_f_11resiliparse_5parse_4html_css_select_callback(lxb_dom_node_t *__pyx_v_node, CYTHON_UNUSED lxb_css_selector_specificity_t *__pyx_v_spec, void *__pyx_v_ctx) {
   lxb_status_t __pyx_r;
 
-  /* "resiliparse/parse/html.pyx":209
+  /* "resiliparse/parse/html.pyx":257
  * cdef inline lxb_status_t css_select_callback(lxb_dom_node_t* node, lxb_css_selector_specificity_t* spec,
  *                                              void* ctx) nogil:
  *     lxb_dom_collection_append(<lxb_dom_collection_t*>ctx, node)             # <<<<<<<<<<<<<<
  *     return LXB_STATUS_OK
  * 
  */
   (void)(lxb_dom_collection_append(((lxb_dom_collection_t *)__pyx_v_ctx), __pyx_v_node));
 
-  /* "resiliparse/parse/html.pyx":210
+  /* "resiliparse/parse/html.pyx":258
  *                                              void* ctx) nogil:
  *     lxb_dom_collection_append(<lxb_dom_collection_t*>ctx, node)
  *     return LXB_STATUS_OK             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __pyx_r = LXB_STATUS_OK;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":207
+  /* "resiliparse/parse/html.pyx":255
  * 
  * 
  * cdef inline lxb_status_t css_select_callback(lxb_dom_node_t* node, lxb_css_selector_specificity_t* spec,             # <<<<<<<<<<<<<<
  *                                              void* ctx) nogil:
  *     lxb_dom_collection_append(<lxb_dom_collection_t*>ctx, node)
  */
 
   /* function exit code */
   __pyx_L0:;
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":213
+/* "resiliparse/parse/html.pyx":261
  * 
  * 
  * cdef inline lxb_status_t css_select_callback_single(lxb_dom_node_t* node, lxb_css_selector_specificity_t* spec,             # <<<<<<<<<<<<<<
  *                                                     void* ctx) nogil:
  *     (<lxb_dom_node_t**>ctx)[0] = node
  */
 
 static CYTHON_INLINE lxb_status_t __pyx_f_11resiliparse_5parse_4html_css_select_callback_single(lxb_dom_node_t *__pyx_v_node, CYTHON_UNUSED lxb_css_selector_specificity_t *__pyx_v_spec, void *__pyx_v_ctx) {
   lxb_status_t __pyx_r;
 
-  /* "resiliparse/parse/html.pyx":215
+  /* "resiliparse/parse/html.pyx":263
  * cdef inline lxb_status_t css_select_callback_single(lxb_dom_node_t* node, lxb_css_selector_specificity_t* spec,
  *                                                     void* ctx) nogil:
  *     (<lxb_dom_node_t**>ctx)[0] = node             # <<<<<<<<<<<<<<
  *     return LXB_STATUS_STOP
  * 
  */
   (((lxb_dom_node_t **)__pyx_v_ctx)[0]) = __pyx_v_node;
 
-  /* "resiliparse/parse/html.pyx":216
+  /* "resiliparse/parse/html.pyx":264
  *                                                     void* ctx) nogil:
  *     (<lxb_dom_node_t**>ctx)[0] = node
  *     return LXB_STATUS_STOP             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __pyx_r = LXB_STATUS_STOP;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":213
+  /* "resiliparse/parse/html.pyx":261
  * 
  * 
  * cdef inline lxb_status_t css_select_callback_single(lxb_dom_node_t* node, lxb_css_selector_specificity_t* spec,             # <<<<<<<<<<<<<<
  *                                                     void* ctx) nogil:
  *     (<lxb_dom_node_t**>ctx)[0] = node
  */
 
   /* function exit code */
   __pyx_L0:;
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":219
+/* "resiliparse/parse/html.pyx":267
  * 
  * 
- * cdef lxb_dom_node_t* query_selector_impl(lxb_dom_node_t* node, HTMLTree tree, bytes selector):             # <<<<<<<<<<<<<<
+ * cdef lxb_dom_node_t* query_selector_impl(lxb_dom_node_t* node, HTMLTree tree,             # <<<<<<<<<<<<<<
+ *                                          bytes selector) except <lxb_dom_node_t*>-1:
  *     """
- *     Return a pointer to the first element matching the given CSS selector.
  */
 
 static lxb_dom_node_t *__pyx_f_11resiliparse_5parse_4html_query_selector_impl(lxb_dom_node_t *__pyx_v_node, struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *__pyx_v_tree, PyObject *__pyx_v_selector) {
   lxb_css_selector_list_t *__pyx_v_sel_list;
   lxb_dom_node_t *__pyx_v_result_node;
   lxb_dom_node_t *__pyx_r;
   __Pyx_RefNannyDeclarations
   lxb_char_t *__pyx_t_1;
   Py_ssize_t __pyx_t_2;
-  int __pyx_t_3;
+  lxb_css_selector_list_t *__pyx_t_3;
+  int __pyx_t_4;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("query_selector_impl", 0);
 
-  /* "resiliparse/parse/html.pyx":228
+  /* "resiliparse/parse/html.pyx":277
  *     :return: pointer to created DOM collection or ``NULL`` if error occurred
  *     """
  *     tree.init_css_parser()             # <<<<<<<<<<<<<<
  * 
- *     cdef lxb_css_selector_list_t* sel_list = lxb_css_selectors_parse(tree.css_parser,
+ *     cdef lxb_css_selector_list_t* sel_list = parse_css_selectors(tree.css_parser, <lxb_char_t*>selector, len(selector))
  */
-  ((struct __pyx_vtabstruct_11resiliparse_5parse_4html_HTMLTree *)__pyx_v_tree->__pyx_vtab)->init_css_parser(__pyx_v_tree);
+  __pyx_f_11resiliparse_5parse_4html_8HTMLTree_init_css_parser(__pyx_v_tree);
 
-  /* "resiliparse/parse/html.pyx":231
+  /* "resiliparse/parse/html.pyx":279
+ *     tree.init_css_parser()
  * 
- *     cdef lxb_css_selector_list_t* sel_list = lxb_css_selectors_parse(tree.css_parser,
- *                                                                      <lxb_char_t*>selector, len(selector))             # <<<<<<<<<<<<<<
+ *     cdef lxb_css_selector_list_t* sel_list = parse_css_selectors(tree.css_parser, <lxb_char_t*>selector, len(selector))             # <<<<<<<<<<<<<<
  *     cdef lxb_dom_node_t* result_node = NULL
  *     if lxb_selectors_find(tree.selectors, node, sel_list,
  */
   if (unlikely(__pyx_v_selector == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "expected bytes, NoneType found");
-    __PYX_ERR(0, 231, __pyx_L1_error)
+    __PYX_ERR(0, 279, __pyx_L1_error)
   }
-  __pyx_t_1 = __Pyx_PyBytes_AsWritableUString(__pyx_v_selector); if (unlikely((!__pyx_t_1) && PyErr_Occurred())) __PYX_ERR(0, 231, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyBytes_AsWritableUString(__pyx_v_selector); if (unlikely((!__pyx_t_1) && PyErr_Occurred())) __PYX_ERR(0, 279, __pyx_L1_error)
   if (unlikely(__pyx_v_selector == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-    __PYX_ERR(0, 231, __pyx_L1_error)
+    __PYX_ERR(0, 279, __pyx_L1_error)
   }
-  __pyx_t_2 = PyBytes_GET_SIZE(__pyx_v_selector); if (unlikely(__pyx_t_2 == ((Py_ssize_t)-1))) __PYX_ERR(0, 231, __pyx_L1_error)
+  __pyx_t_2 = PyBytes_GET_SIZE(__pyx_v_selector); if (unlikely(__pyx_t_2 == ((Py_ssize_t)-1))) __PYX_ERR(0, 279, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_11resiliparse_5parse_4html_parse_css_selectors(__pyx_v_tree->css_parser, ((lxb_char_t *)__pyx_t_1), __pyx_t_2); if (unlikely(__pyx_t_3 == ((lxb_css_selector_list_t *)NULL))) __PYX_ERR(0, 279, __pyx_L1_error)
+  __pyx_v_sel_list = __pyx_t_3;
 
-  /* "resiliparse/parse/html.pyx":230
- *     tree.init_css_parser()
+  /* "resiliparse/parse/html.pyx":280
  * 
- *     cdef lxb_css_selector_list_t* sel_list = lxb_css_selectors_parse(tree.css_parser,             # <<<<<<<<<<<<<<
- *                                                                      <lxb_char_t*>selector, len(selector))
- *     cdef lxb_dom_node_t* result_node = NULL
- */
-  __pyx_v_sel_list = lxb_css_selectors_parse(__pyx_v_tree->css_parser, ((lxb_char_t *)__pyx_t_1), __pyx_t_2);
-
-  /* "resiliparse/parse/html.pyx":232
- *     cdef lxb_css_selector_list_t* sel_list = lxb_css_selectors_parse(tree.css_parser,
- *                                                                      <lxb_char_t*>selector, len(selector))
+ *     cdef lxb_css_selector_list_t* sel_list = parse_css_selectors(tree.css_parser, <lxb_char_t*>selector, len(selector))
  *     cdef lxb_dom_node_t* result_node = NULL             # <<<<<<<<<<<<<<
  *     if lxb_selectors_find(tree.selectors, node, sel_list,
  *                           <lxb_selectors_cb_f>css_select_callback_single, &result_node) != LXB_STATUS_OK:
  */
   __pyx_v_result_node = NULL;
 
-  /* "resiliparse/parse/html.pyx":234
+  /* "resiliparse/parse/html.pyx":282
  *     cdef lxb_dom_node_t* result_node = NULL
  *     if lxb_selectors_find(tree.selectors, node, sel_list,
  *                           <lxb_selectors_cb_f>css_select_callback_single, &result_node) != LXB_STATUS_OK:             # <<<<<<<<<<<<<<
  *         return NULL
  * 
  */
-  __pyx_t_3 = ((lxb_selectors_find(__pyx_v_tree->selectors, __pyx_v_node, __pyx_v_sel_list, ((lxb_selectors_cb_f)__pyx_f_11resiliparse_5parse_4html_css_select_callback_single), (&__pyx_v_result_node)) != LXB_STATUS_OK) != 0);
+  __pyx_t_4 = ((lxb_selectors_find(__pyx_v_tree->selectors, __pyx_v_node, __pyx_v_sel_list, ((lxb_selectors_cb_f)__pyx_f_11resiliparse_5parse_4html_css_select_callback_single), (&__pyx_v_result_node)) != LXB_STATUS_OK) != 0);
 
-  /* "resiliparse/parse/html.pyx":233
- *                                                                      <lxb_char_t*>selector, len(selector))
+  /* "resiliparse/parse/html.pyx":281
+ *     cdef lxb_css_selector_list_t* sel_list = parse_css_selectors(tree.css_parser, <lxb_char_t*>selector, len(selector))
  *     cdef lxb_dom_node_t* result_node = NULL
  *     if lxb_selectors_find(tree.selectors, node, sel_list,             # <<<<<<<<<<<<<<
  *                           <lxb_selectors_cb_f>css_select_callback_single, &result_node) != LXB_STATUS_OK:
  *         return NULL
  */
-  if (__pyx_t_3) {
+  if (__pyx_t_4) {
 
-    /* "resiliparse/parse/html.pyx":235
+    /* "resiliparse/parse/html.pyx":283
  *     if lxb_selectors_find(tree.selectors, node, sel_list,
  *                           <lxb_selectors_cb_f>css_select_callback_single, &result_node) != LXB_STATUS_OK:
  *         return NULL             # <<<<<<<<<<<<<<
  * 
  *     return result_node
  */
     __pyx_r = NULL;
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":233
- *                                                                      <lxb_char_t*>selector, len(selector))
+    /* "resiliparse/parse/html.pyx":281
+ *     cdef lxb_css_selector_list_t* sel_list = parse_css_selectors(tree.css_parser, <lxb_char_t*>selector, len(selector))
  *     cdef lxb_dom_node_t* result_node = NULL
  *     if lxb_selectors_find(tree.selectors, node, sel_list,             # <<<<<<<<<<<<<<
  *                           <lxb_selectors_cb_f>css_select_callback_single, &result_node) != LXB_STATUS_OK:
  *         return NULL
  */
   }
 
-  /* "resiliparse/parse/html.pyx":237
+  /* "resiliparse/parse/html.pyx":285
  *         return NULL
  * 
  *     return result_node             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __pyx_r = __pyx_v_result_node;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":219
+  /* "resiliparse/parse/html.pyx":267
  * 
  * 
- * cdef lxb_dom_node_t* query_selector_impl(lxb_dom_node_t* node, HTMLTree tree, bytes selector):             # <<<<<<<<<<<<<<
+ * cdef lxb_dom_node_t* query_selector_impl(lxb_dom_node_t* node, HTMLTree tree,             # <<<<<<<<<<<<<<
+ *                                          bytes selector) except <lxb_dom_node_t*>-1:
  *     """
- *     Return a pointer to the first element matching the given CSS selector.
  */
 
   /* function exit code */
   __pyx_L1_error:;
-  __Pyx_WriteUnraisable("resiliparse.parse.html.query_selector_impl", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
-  __pyx_r = 0;
+  __Pyx_AddTraceback("resiliparse.parse.html.query_selector_impl", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = ((lxb_dom_node_t *)-1L);
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":240
+/* "resiliparse/parse/html.pyx":288
  * 
  * 
  * cdef lxb_dom_collection_t* query_selector_all_impl(lxb_dom_node_t* node, HTMLTree tree, bytes selector,             # <<<<<<<<<<<<<<
- *                                                    size_t init_size=32):
+ *                                                    size_t init_size=32) except <lxb_dom_collection_t*>-1:
  *     """
  */
 
 static lxb_dom_collection_t *__pyx_f_11resiliparse_5parse_4html_query_selector_all_impl(lxb_dom_node_t *__pyx_v_node, struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *__pyx_v_tree, PyObject *__pyx_v_selector, struct __pyx_opt_args_11resiliparse_5parse_4html_query_selector_all_impl *__pyx_optional_args) {
   size_t __pyx_v_init_size = ((size_t)32);
   lxb_css_selector_list_t *__pyx_v_sel_list;
   lxb_dom_collection_t *__pyx_v_coll;
   lxb_dom_collection_t *__pyx_r;
   __Pyx_RefNannyDeclarations
   lxb_char_t *__pyx_t_1;
   Py_ssize_t __pyx_t_2;
-  int __pyx_t_3;
+  lxb_css_selector_list_t *__pyx_t_3;
+  int __pyx_t_4;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("query_selector_all_impl", 0);
   if (__pyx_optional_args) {
     if (__pyx_optional_args->__pyx_n > 0) {
       __pyx_v_init_size = __pyx_optional_args->init_size;
     }
   }
 
-  /* "resiliparse/parse/html.pyx":253
+  /* "resiliparse/parse/html.pyx":301
  *     :return: pointer to created DOM collection or ``NULL`` if error occurred
  *     """
  *     tree.init_css_parser()             # <<<<<<<<<<<<<<
  * 
- *     cdef lxb_css_selector_list_t* sel_list = lxb_css_selectors_parse(tree.css_parser,
+ *     cdef lxb_css_selector_list_t* sel_list = parse_css_selectors(tree.css_parser, <lxb_char_t*>selector, len(selector))
  */
-  ((struct __pyx_vtabstruct_11resiliparse_5parse_4html_HTMLTree *)__pyx_v_tree->__pyx_vtab)->init_css_parser(__pyx_v_tree);
+  __pyx_f_11resiliparse_5parse_4html_8HTMLTree_init_css_parser(__pyx_v_tree);
 
-  /* "resiliparse/parse/html.pyx":256
+  /* "resiliparse/parse/html.pyx":303
+ *     tree.init_css_parser()
  * 
- *     cdef lxb_css_selector_list_t* sel_list = lxb_css_selectors_parse(tree.css_parser,
- *                                                                      <lxb_char_t*>selector, len(selector))             # <<<<<<<<<<<<<<
+ *     cdef lxb_css_selector_list_t* sel_list = parse_css_selectors(tree.css_parser, <lxb_char_t*>selector, len(selector))             # <<<<<<<<<<<<<<
  *     cdef lxb_dom_collection_t* coll = lxb_dom_collection_make(node.owner_document, init_size)
  *     if lxb_selectors_find(tree.selectors, node, sel_list,
  */
   if (unlikely(__pyx_v_selector == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "expected bytes, NoneType found");
-    __PYX_ERR(0, 256, __pyx_L1_error)
+    __PYX_ERR(0, 303, __pyx_L1_error)
   }
-  __pyx_t_1 = __Pyx_PyBytes_AsWritableUString(__pyx_v_selector); if (unlikely((!__pyx_t_1) && PyErr_Occurred())) __PYX_ERR(0, 256, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyBytes_AsWritableUString(__pyx_v_selector); if (unlikely((!__pyx_t_1) && PyErr_Occurred())) __PYX_ERR(0, 303, __pyx_L1_error)
   if (unlikely(__pyx_v_selector == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-    __PYX_ERR(0, 256, __pyx_L1_error)
+    __PYX_ERR(0, 303, __pyx_L1_error)
   }
-  __pyx_t_2 = PyBytes_GET_SIZE(__pyx_v_selector); if (unlikely(__pyx_t_2 == ((Py_ssize_t)-1))) __PYX_ERR(0, 256, __pyx_L1_error)
+  __pyx_t_2 = PyBytes_GET_SIZE(__pyx_v_selector); if (unlikely(__pyx_t_2 == ((Py_ssize_t)-1))) __PYX_ERR(0, 303, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_11resiliparse_5parse_4html_parse_css_selectors(__pyx_v_tree->css_parser, ((lxb_char_t *)__pyx_t_1), __pyx_t_2); if (unlikely(__pyx_t_3 == ((lxb_css_selector_list_t *)NULL))) __PYX_ERR(0, 303, __pyx_L1_error)
+  __pyx_v_sel_list = __pyx_t_3;
 
-  /* "resiliparse/parse/html.pyx":255
- *     tree.init_css_parser()
+  /* "resiliparse/parse/html.pyx":304
  * 
- *     cdef lxb_css_selector_list_t* sel_list = lxb_css_selectors_parse(tree.css_parser,             # <<<<<<<<<<<<<<
- *                                                                      <lxb_char_t*>selector, len(selector))
- *     cdef lxb_dom_collection_t* coll = lxb_dom_collection_make(node.owner_document, init_size)
- */
-  __pyx_v_sel_list = lxb_css_selectors_parse(__pyx_v_tree->css_parser, ((lxb_char_t *)__pyx_t_1), __pyx_t_2);
-
-  /* "resiliparse/parse/html.pyx":257
- *     cdef lxb_css_selector_list_t* sel_list = lxb_css_selectors_parse(tree.css_parser,
- *                                                                      <lxb_char_t*>selector, len(selector))
+ *     cdef lxb_css_selector_list_t* sel_list = parse_css_selectors(tree.css_parser, <lxb_char_t*>selector, len(selector))
  *     cdef lxb_dom_collection_t* coll = lxb_dom_collection_make(node.owner_document, init_size)             # <<<<<<<<<<<<<<
  *     if lxb_selectors_find(tree.selectors, node, sel_list,
  *                           <lxb_selectors_cb_f>css_select_callback, coll) != LXB_STATUS_OK:
  */
   __pyx_v_coll = lxb_dom_collection_make(__pyx_v_node->owner_document, __pyx_v_init_size);
 
-  /* "resiliparse/parse/html.pyx":259
+  /* "resiliparse/parse/html.pyx":306
  *     cdef lxb_dom_collection_t* coll = lxb_dom_collection_make(node.owner_document, init_size)
  *     if lxb_selectors_find(tree.selectors, node, sel_list,
  *                           <lxb_selectors_cb_f>css_select_callback, coll) != LXB_STATUS_OK:             # <<<<<<<<<<<<<<
  *         return NULL
  * 
  */
-  __pyx_t_3 = ((lxb_selectors_find(__pyx_v_tree->selectors, __pyx_v_node, __pyx_v_sel_list, ((lxb_selectors_cb_f)__pyx_f_11resiliparse_5parse_4html_css_select_callback), __pyx_v_coll) != LXB_STATUS_OK) != 0);
+  __pyx_t_4 = ((lxb_selectors_find(__pyx_v_tree->selectors, __pyx_v_node, __pyx_v_sel_list, ((lxb_selectors_cb_f)__pyx_f_11resiliparse_5parse_4html_css_select_callback), __pyx_v_coll) != LXB_STATUS_OK) != 0);
 
-  /* "resiliparse/parse/html.pyx":258
- *                                                                      <lxb_char_t*>selector, len(selector))
+  /* "resiliparse/parse/html.pyx":305
+ *     cdef lxb_css_selector_list_t* sel_list = parse_css_selectors(tree.css_parser, <lxb_char_t*>selector, len(selector))
  *     cdef lxb_dom_collection_t* coll = lxb_dom_collection_make(node.owner_document, init_size)
  *     if lxb_selectors_find(tree.selectors, node, sel_list,             # <<<<<<<<<<<<<<
  *                           <lxb_selectors_cb_f>css_select_callback, coll) != LXB_STATUS_OK:
  *         return NULL
  */
-  if (__pyx_t_3) {
+  if (__pyx_t_4) {
 
-    /* "resiliparse/parse/html.pyx":260
+    /* "resiliparse/parse/html.pyx":307
  *     if lxb_selectors_find(tree.selectors, node, sel_list,
  *                           <lxb_selectors_cb_f>css_select_callback, coll) != LXB_STATUS_OK:
  *         return NULL             # <<<<<<<<<<<<<<
  * 
  *     return coll
  */
     __pyx_r = NULL;
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":258
- *                                                                      <lxb_char_t*>selector, len(selector))
+    /* "resiliparse/parse/html.pyx":305
+ *     cdef lxb_css_selector_list_t* sel_list = parse_css_selectors(tree.css_parser, <lxb_char_t*>selector, len(selector))
  *     cdef lxb_dom_collection_t* coll = lxb_dom_collection_make(node.owner_document, init_size)
  *     if lxb_selectors_find(tree.selectors, node, sel_list,             # <<<<<<<<<<<<<<
  *                           <lxb_selectors_cb_f>css_select_callback, coll) != LXB_STATUS_OK:
  *         return NULL
  */
   }
 
-  /* "resiliparse/parse/html.pyx":262
+  /* "resiliparse/parse/html.pyx":309
  *         return NULL
  * 
  *     return coll             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __pyx_r = __pyx_v_coll;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":240
+  /* "resiliparse/parse/html.pyx":288
  * 
  * 
  * cdef lxb_dom_collection_t* query_selector_all_impl(lxb_dom_node_t* node, HTMLTree tree, bytes selector,             # <<<<<<<<<<<<<<
- *                                                    size_t init_size=32):
+ *                                                    size_t init_size=32) except <lxb_dom_collection_t*>-1:
  *     """
  */
 
   /* function exit code */
   __pyx_L1_error:;
-  __Pyx_WriteUnraisable("resiliparse.parse.html.query_selector_all_impl", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
-  __pyx_r = 0;
+  __Pyx_AddTraceback("resiliparse.parse.html.query_selector_all_impl", __pyx_clineno, __pyx_lineno, __pyx_filename);
+  __pyx_r = ((lxb_dom_collection_t *)-1L);
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":265
+/* "resiliparse/parse/html.pyx":312
  * 
  * 
  * cdef inline lxb_status_t css_match_callback(lxb_dom_node_t* node, lxb_css_selector_specificity_t* spec,             # <<<<<<<<<<<<<<
  *                                             void* ctx) nogil:
  *     (<bint*>ctx)[0] = True
  */
 
 static CYTHON_INLINE lxb_status_t __pyx_f_11resiliparse_5parse_4html_css_match_callback(CYTHON_UNUSED lxb_dom_node_t *__pyx_v_node, CYTHON_UNUSED lxb_css_selector_specificity_t *__pyx_v_spec, void *__pyx_v_ctx) {
   lxb_status_t __pyx_r;
 
-  /* "resiliparse/parse/html.pyx":267
+  /* "resiliparse/parse/html.pyx":314
  * cdef inline lxb_status_t css_match_callback(lxb_dom_node_t* node, lxb_css_selector_specificity_t* spec,
  *                                             void* ctx) nogil:
  *     (<bint*>ctx)[0] = True             # <<<<<<<<<<<<<<
  *     return LXB_STATUS_STOP
  * 
  */
   (((int *)__pyx_v_ctx)[0]) = 1;
 
-  /* "resiliparse/parse/html.pyx":268
+  /* "resiliparse/parse/html.pyx":315
  *                                             void* ctx) nogil:
  *     (<bint*>ctx)[0] = True
  *     return LXB_STATUS_STOP             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __pyx_r = LXB_STATUS_STOP;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":265
+  /* "resiliparse/parse/html.pyx":312
  * 
  * 
  * cdef inline lxb_status_t css_match_callback(lxb_dom_node_t* node, lxb_css_selector_specificity_t* spec,             # <<<<<<<<<<<<<<
  *                                             void* ctx) nogil:
  *     (<bint*>ctx)[0] = True
  */
 
   /* function exit code */
   __pyx_L0:;
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":271
+/* "resiliparse/parse/html.pyx":318
  * 
  * 
  * cdef bint matches_impl(lxb_dom_node_t* node, HTMLTree tree, bytes selector):             # <<<<<<<<<<<<<<
  *     """
  *     Check whether any element in the DOM subtree matches the given CSS selector.
  */
 
 static int __pyx_f_11resiliparse_5parse_4html_matches_impl(lxb_dom_node_t *__pyx_v_node, struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *__pyx_v_tree, PyObject *__pyx_v_selector) {
   lxb_css_selector_list_t *__pyx_v_sel_list;
   int __pyx_v_matches;
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   lxb_char_t *__pyx_t_1;
   Py_ssize_t __pyx_t_2;
-  int __pyx_t_3;
+  lxb_css_selector_list_t *__pyx_t_3;
+  int __pyx_t_4;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("matches_impl", 0);
 
-  /* "resiliparse/parse/html.pyx":280
+  /* "resiliparse/parse/html.pyx":327
  *     :return: boolean value indicating whether a matching element exists
  *     """
  *     tree.init_css_parser()             # <<<<<<<<<<<<<<
  * 
- *     cdef lxb_css_selector_list_t* sel_list = lxb_css_selectors_parse(tree.css_parser,
+ *     cdef lxb_css_selector_list_t* sel_list = parse_css_selectors(tree.css_parser, <lxb_char_t*>selector, len(selector))
  */
-  ((struct __pyx_vtabstruct_11resiliparse_5parse_4html_HTMLTree *)__pyx_v_tree->__pyx_vtab)->init_css_parser(__pyx_v_tree);
+  __pyx_f_11resiliparse_5parse_4html_8HTMLTree_init_css_parser(__pyx_v_tree);
 
-  /* "resiliparse/parse/html.pyx":283
+  /* "resiliparse/parse/html.pyx":329
+ *     tree.init_css_parser()
  * 
- *     cdef lxb_css_selector_list_t* sel_list = lxb_css_selectors_parse(tree.css_parser,
- *                                                                      <lxb_char_t*>selector, len(selector))             # <<<<<<<<<<<<<<
+ *     cdef lxb_css_selector_list_t* sel_list = parse_css_selectors(tree.css_parser, <lxb_char_t*>selector, len(selector))             # <<<<<<<<<<<<<<
  *     cdef bint matches = False
  *     if lxb_selectors_find(tree.selectors, node, sel_list,
  */
   if (unlikely(__pyx_v_selector == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "expected bytes, NoneType found");
-    __PYX_ERR(0, 283, __pyx_L1_error)
+    __PYX_ERR(0, 329, __pyx_L1_error)
   }
-  __pyx_t_1 = __Pyx_PyBytes_AsWritableUString(__pyx_v_selector); if (unlikely((!__pyx_t_1) && PyErr_Occurred())) __PYX_ERR(0, 283, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyBytes_AsWritableUString(__pyx_v_selector); if (unlikely((!__pyx_t_1) && PyErr_Occurred())) __PYX_ERR(0, 329, __pyx_L1_error)
   if (unlikely(__pyx_v_selector == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-    __PYX_ERR(0, 283, __pyx_L1_error)
+    __PYX_ERR(0, 329, __pyx_L1_error)
   }
-  __pyx_t_2 = PyBytes_GET_SIZE(__pyx_v_selector); if (unlikely(__pyx_t_2 == ((Py_ssize_t)-1))) __PYX_ERR(0, 283, __pyx_L1_error)
+  __pyx_t_2 = PyBytes_GET_SIZE(__pyx_v_selector); if (unlikely(__pyx_t_2 == ((Py_ssize_t)-1))) __PYX_ERR(0, 329, __pyx_L1_error)
+  __pyx_t_3 = __pyx_f_11resiliparse_5parse_4html_parse_css_selectors(__pyx_v_tree->css_parser, ((lxb_char_t *)__pyx_t_1), __pyx_t_2); if (unlikely(__pyx_t_3 == ((lxb_css_selector_list_t *)NULL))) __PYX_ERR(0, 329, __pyx_L1_error)
+  __pyx_v_sel_list = __pyx_t_3;
 
-  /* "resiliparse/parse/html.pyx":282
- *     tree.init_css_parser()
+  /* "resiliparse/parse/html.pyx":330
  * 
- *     cdef lxb_css_selector_list_t* sel_list = lxb_css_selectors_parse(tree.css_parser,             # <<<<<<<<<<<<<<
- *                                                                      <lxb_char_t*>selector, len(selector))
- *     cdef bint matches = False
- */
-  __pyx_v_sel_list = lxb_css_selectors_parse(__pyx_v_tree->css_parser, ((lxb_char_t *)__pyx_t_1), __pyx_t_2);
-
-  /* "resiliparse/parse/html.pyx":284
- *     cdef lxb_css_selector_list_t* sel_list = lxb_css_selectors_parse(tree.css_parser,
- *                                                                      <lxb_char_t*>selector, len(selector))
+ *     cdef lxb_css_selector_list_t* sel_list = parse_css_selectors(tree.css_parser, <lxb_char_t*>selector, len(selector))
  *     cdef bint matches = False             # <<<<<<<<<<<<<<
  *     if lxb_selectors_find(tree.selectors, node, sel_list,
  *                           <lxb_selectors_cb_f>css_match_callback, <void*>&matches) != LXB_STATUS_OK:
  */
   __pyx_v_matches = 0;
 
-  /* "resiliparse/parse/html.pyx":286
+  /* "resiliparse/parse/html.pyx":332
  *     cdef bint matches = False
  *     if lxb_selectors_find(tree.selectors, node, sel_list,
  *                           <lxb_selectors_cb_f>css_match_callback, <void*>&matches) != LXB_STATUS_OK:             # <<<<<<<<<<<<<<
  *         return False
  * 
  */
-  __pyx_t_3 = ((lxb_selectors_find(__pyx_v_tree->selectors, __pyx_v_node, __pyx_v_sel_list, ((lxb_selectors_cb_f)__pyx_f_11resiliparse_5parse_4html_css_match_callback), ((void *)(&__pyx_v_matches))) != LXB_STATUS_OK) != 0);
+  __pyx_t_4 = ((lxb_selectors_find(__pyx_v_tree->selectors, __pyx_v_node, __pyx_v_sel_list, ((lxb_selectors_cb_f)__pyx_f_11resiliparse_5parse_4html_css_match_callback), ((void *)(&__pyx_v_matches))) != LXB_STATUS_OK) != 0);
 
-  /* "resiliparse/parse/html.pyx":285
- *                                                                      <lxb_char_t*>selector, len(selector))
+  /* "resiliparse/parse/html.pyx":331
+ *     cdef lxb_css_selector_list_t* sel_list = parse_css_selectors(tree.css_parser, <lxb_char_t*>selector, len(selector))
  *     cdef bint matches = False
  *     if lxb_selectors_find(tree.selectors, node, sel_list,             # <<<<<<<<<<<<<<
  *                           <lxb_selectors_cb_f>css_match_callback, <void*>&matches) != LXB_STATUS_OK:
  *         return False
  */
-  if (__pyx_t_3) {
+  if (__pyx_t_4) {
 
-    /* "resiliparse/parse/html.pyx":287
+    /* "resiliparse/parse/html.pyx":333
  *     if lxb_selectors_find(tree.selectors, node, sel_list,
  *                           <lxb_selectors_cb_f>css_match_callback, <void*>&matches) != LXB_STATUS_OK:
  *         return False             # <<<<<<<<<<<<<<
  * 
  *     return matches
  */
     __pyx_r = 0;
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":285
- *                                                                      <lxb_char_t*>selector, len(selector))
+    /* "resiliparse/parse/html.pyx":331
+ *     cdef lxb_css_selector_list_t* sel_list = parse_css_selectors(tree.css_parser, <lxb_char_t*>selector, len(selector))
  *     cdef bint matches = False
  *     if lxb_selectors_find(tree.selectors, node, sel_list,             # <<<<<<<<<<<<<<
  *                           <lxb_selectors_cb_f>css_match_callback, <void*>&matches) != LXB_STATUS_OK:
  *         return False
  */
   }
 
-  /* "resiliparse/parse/html.pyx":289
+  /* "resiliparse/parse/html.pyx":335
  *         return False
  * 
  *     return matches             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __pyx_r = __pyx_v_matches;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":271
+  /* "resiliparse/parse/html.pyx":318
  * 
  * 
  * cdef bint matches_impl(lxb_dom_node_t* node, HTMLTree tree, bytes selector):             # <<<<<<<<<<<<<<
  *     """
  *     Check whether any element in the DOM subtree matches the given CSS selector.
  */
 
@@ -4992,29 +5588,29 @@
   __Pyx_WriteUnraisable("resiliparse.parse.html.matches_impl", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":292
+/* "resiliparse/parse/html.pyx":338
  * 
  * 
  * cdef inline bint is_whitespace(const char c):             # <<<<<<<<<<<<<<
  *     return c == b' ' or c == b'\t' or c == b'\n' or c == b'\f' or c == b'\r'
  * 
  */
 
 static CYTHON_INLINE int __pyx_f_11resiliparse_5parse_4html_is_whitespace(char const __pyx_v_c) {
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   int __pyx_t_1;
   __Pyx_RefNannySetupContext("is_whitespace", 0);
 
-  /* "resiliparse/parse/html.pyx":293
+  /* "resiliparse/parse/html.pyx":339
  * 
  * cdef inline bint is_whitespace(const char c):
  *     return c == b' ' or c == b'\t' or c == b'\n' or c == b'\f' or c == b'\r'             # <<<<<<<<<<<<<<
  * 
  * 
  */
   switch (__pyx_v_c) {
@@ -5028,29 +5624,29 @@
     default:
     __pyx_t_1 = 0;
     break;
   }
   __pyx_r = __pyx_t_1;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":292
+  /* "resiliparse/parse/html.pyx":338
  * 
  * 
  * cdef inline bint is_whitespace(const char c):             # <<<<<<<<<<<<<<
  *     return c == b' ' or c == b'\t' or c == b'\n' or c == b'\f' or c == b'\r'
  * 
  */
 
   /* function exit code */
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":299
+/* "resiliparse/parse/html.pyx":345
  *     """Class name list of an Element DOM node."""
  * 
  *     def __cinit__(self, DOMNode node):             # <<<<<<<<<<<<<<
  *         self.node = node
  * 
  */
 
@@ -5079,32 +5675,32 @@
       kw_args = PyDict_Size(__pyx_kwds);
       switch (pos_args) {
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_node)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__cinit__") < 0)) __PYX_ERR(0, 299, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__cinit__") < 0)) __PYX_ERR(0, 345, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 1) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
     }
     __pyx_v_node = ((struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *)values[0]);
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__cinit__", 1, 1, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 299, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__cinit__", 1, 1, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 345, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("resiliparse.parse.html.DOMElementClassList.__cinit__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return -1;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_node), __pyx_ptype_11resiliparse_5parse_4html_DOMNode, 1, "node", 0))) __PYX_ERR(0, 299, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_node), __pyx_ptype_11resiliparse_5parse_4html_DOMNode, 1, "node", 0))) __PYX_ERR(0, 345, __pyx_L1_error)
   __pyx_r = __pyx_pf_11resiliparse_5parse_4html_19DOMElementClassList___cinit__(((struct __pyx_obj_11resiliparse_5parse_4html_DOMElementClassList *)__pyx_v_self), __pyx_v_node);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = -1;
   __pyx_L0:;
@@ -5113,42 +5709,42 @@
 }
 
 static int __pyx_pf_11resiliparse_5parse_4html_19DOMElementClassList___cinit__(struct __pyx_obj_11resiliparse_5parse_4html_DOMElementClassList *__pyx_v_self, struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *__pyx_v_node) {
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__cinit__", 0);
 
-  /* "resiliparse/parse/html.pyx":300
+  /* "resiliparse/parse/html.pyx":346
  * 
  *     def __cinit__(self, DOMNode node):
  *         self.node = node             # <<<<<<<<<<<<<<
  * 
  *     cdef list _create_list(self):
  */
   __Pyx_INCREF(((PyObject *)__pyx_v_node));
   __Pyx_GIVEREF(((PyObject *)__pyx_v_node));
   __Pyx_GOTREF(__pyx_v_self->node);
   __Pyx_DECREF(((PyObject *)__pyx_v_self->node));
   __pyx_v_self->node = __pyx_v_node;
 
-  /* "resiliparse/parse/html.pyx":299
+  /* "resiliparse/parse/html.pyx":345
  *     """Class name list of an Element DOM node."""
  * 
  *     def __cinit__(self, DOMNode node):             # <<<<<<<<<<<<<<
  *         self.node = node
  * 
  */
 
   /* function exit code */
   __pyx_r = 0;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":302
+/* "resiliparse/parse/html.pyx":348
  *         self.node = node
  * 
  *     cdef list _create_list(self):             # <<<<<<<<<<<<<<
  *         if self.node is None or not self.node.node:
  *             return []
  */
 
@@ -5174,15 +5770,15 @@
   Py_ssize_t __pyx_t_11;
   int __pyx_t_12;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_create_list", 0);
 
-  /* "resiliparse/parse/html.pyx":303
+  /* "resiliparse/parse/html.pyx":349
  * 
  *     cdef list _create_list(self):
  *         if self.node is None or not self.node.node:             # <<<<<<<<<<<<<<
  *             return []
  * 
  */
   __pyx_t_2 = (((PyObject *)__pyx_v_self->node) == Py_None);
@@ -5193,166 +5789,166 @@
     goto __pyx_L4_bool_binop_done;
   }
   __pyx_t_3 = ((!(__pyx_v_self->node->node != 0)) != 0);
   __pyx_t_1 = __pyx_t_3;
   __pyx_L4_bool_binop_done:;
   if (__pyx_t_1) {
 
-    /* "resiliparse/parse/html.pyx":304
+    /* "resiliparse/parse/html.pyx":350
  *     cdef list _create_list(self):
  *         if self.node is None or not self.node.node:
  *             return []             # <<<<<<<<<<<<<<
  * 
  *         cdef size_t class_name_len = 0
  */
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_4 = PyList_New(0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 304, __pyx_L1_error)
+    __pyx_t_4 = PyList_New(0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 350, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __pyx_r = ((PyObject*)__pyx_t_4);
     __pyx_t_4 = 0;
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":303
+    /* "resiliparse/parse/html.pyx":349
  * 
  *     cdef list _create_list(self):
  *         if self.node is None or not self.node.node:             # <<<<<<<<<<<<<<
  *             return []
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":306
+  /* "resiliparse/parse/html.pyx":352
  *             return []
  * 
  *         cdef size_t class_name_len = 0             # <<<<<<<<<<<<<<
  *         cdef const lxb_char_t* class_name = lxb_dom_element_class(<lxb_dom_element_t*>self.node.node, &class_name_len)
  *         if not class_name:
  */
   __pyx_v_class_name_len = 0;
 
-  /* "resiliparse/parse/html.pyx":307
+  /* "resiliparse/parse/html.pyx":353
  * 
  *         cdef size_t class_name_len = 0
  *         cdef const lxb_char_t* class_name = lxb_dom_element_class(<lxb_dom_element_t*>self.node.node, &class_name_len)             # <<<<<<<<<<<<<<
  *         if not class_name:
  *             return []
  */
   __pyx_v_class_name = lxb_dom_element_class(((lxb_dom_element_t *)__pyx_v_self->node->node), (&__pyx_v_class_name_len));
 
-  /* "resiliparse/parse/html.pyx":308
+  /* "resiliparse/parse/html.pyx":354
  *         cdef size_t class_name_len = 0
  *         cdef const lxb_char_t* class_name = lxb_dom_element_class(<lxb_dom_element_t*>self.node.node, &class_name_len)
  *         if not class_name:             # <<<<<<<<<<<<<<
  *             return []
  * 
  */
   __pyx_t_1 = ((!(__pyx_v_class_name != 0)) != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/parse/html.pyx":309
+    /* "resiliparse/parse/html.pyx":355
  *         cdef const lxb_char_t* class_name = lxb_dom_element_class(<lxb_dom_element_t*>self.node.node, &class_name_len)
  *         if not class_name:
  *             return []             # <<<<<<<<<<<<<<
  * 
  *         cdef list class_list = []
  */
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_4 = PyList_New(0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 309, __pyx_L1_error)
+    __pyx_t_4 = PyList_New(0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 355, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __pyx_r = ((PyObject*)__pyx_t_4);
     __pyx_t_4 = 0;
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":308
+    /* "resiliparse/parse/html.pyx":354
  *         cdef size_t class_name_len = 0
  *         cdef const lxb_char_t* class_name = lxb_dom_element_class(<lxb_dom_element_t*>self.node.node, &class_name_len)
  *         if not class_name:             # <<<<<<<<<<<<<<
  *             return []
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":311
+  /* "resiliparse/parse/html.pyx":357
  *             return []
  * 
  *         cdef list class_list = []             # <<<<<<<<<<<<<<
  *         cdef start = 0, end = 0
  *         cdef size_t i
  */
-  __pyx_t_4 = PyList_New(0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 311, __pyx_L1_error)
+  __pyx_t_4 = PyList_New(0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 357, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __pyx_v_class_list = ((PyObject*)__pyx_t_4);
   __pyx_t_4 = 0;
 
-  /* "resiliparse/parse/html.pyx":312
+  /* "resiliparse/parse/html.pyx":358
  * 
  *         cdef list class_list = []
  *         cdef start = 0, end = 0             # <<<<<<<<<<<<<<
  *         cdef size_t i
  *         for i in range(class_name_len):
  */
   __Pyx_INCREF(__pyx_int_0);
   __pyx_v_start = __pyx_int_0;
   __Pyx_INCREF(__pyx_int_0);
   __pyx_v_end = __pyx_int_0;
 
-  /* "resiliparse/parse/html.pyx":314
+  /* "resiliparse/parse/html.pyx":360
  *         cdef start = 0, end = 0
  *         cdef size_t i
  *         for i in range(class_name_len):             # <<<<<<<<<<<<<<
  * 
  *             if is_whitespace(class_name[start]):
  */
   __pyx_t_5 = __pyx_v_class_name_len;
   __pyx_t_6 = __pyx_t_5;
   for (__pyx_t_7 = 0; __pyx_t_7 < __pyx_t_6; __pyx_t_7+=1) {
     __pyx_v_i = __pyx_t_7;
 
-    /* "resiliparse/parse/html.pyx":316
+    /* "resiliparse/parse/html.pyx":362
  *         for i in range(class_name_len):
  * 
  *             if is_whitespace(class_name[start]):             # <<<<<<<<<<<<<<
  *                 start = i + 1
  *                 continue
  */
-    __pyx_t_8 = __Pyx_PyIndex_AsSsize_t(__pyx_v_start); if (unlikely((__pyx_t_8 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 316, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyIndex_AsSsize_t(__pyx_v_start); if (unlikely((__pyx_t_8 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 362, __pyx_L1_error)
     __pyx_t_1 = (__pyx_f_11resiliparse_5parse_4html_is_whitespace((__pyx_v_class_name[__pyx_t_8])) != 0);
     if (__pyx_t_1) {
 
-      /* "resiliparse/parse/html.pyx":317
+      /* "resiliparse/parse/html.pyx":363
  * 
  *             if is_whitespace(class_name[start]):
  *                 start = i + 1             # <<<<<<<<<<<<<<
  *                 continue
  * 
  */
-      __pyx_t_4 = __Pyx_PyInt_FromSize_t((__pyx_v_i + 1)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 317, __pyx_L1_error)
+      __pyx_t_4 = __Pyx_PyInt_FromSize_t((__pyx_v_i + 1)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 363, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
       __Pyx_DECREF_SET(__pyx_v_start, __pyx_t_4);
       __pyx_t_4 = 0;
 
-      /* "resiliparse/parse/html.pyx":318
+      /* "resiliparse/parse/html.pyx":364
  *             if is_whitespace(class_name[start]):
  *                 start = i + 1
  *                 continue             # <<<<<<<<<<<<<<
  * 
  *             if is_whitespace(class_name[i]) or i == class_name_len - 1:
  */
       goto __pyx_L7_continue;
 
-      /* "resiliparse/parse/html.pyx":316
+      /* "resiliparse/parse/html.pyx":362
  *         for i in range(class_name_len):
  * 
  *             if is_whitespace(class_name[start]):             # <<<<<<<<<<<<<<
  *                 start = i + 1
  *                 continue
  */
     }
 
-    /* "resiliparse/parse/html.pyx":320
+    /* "resiliparse/parse/html.pyx":366
  *                 continue
  * 
  *             if is_whitespace(class_name[i]) or i == class_name_len - 1:             # <<<<<<<<<<<<<<
  *                 end = i if i < class_name_len - 1 else i + 1
  *                 if start < end:
  */
     __pyx_t_3 = (__pyx_f_11resiliparse_5parse_4html_is_whitespace((__pyx_v_class_name[__pyx_v_i])) != 0);
@@ -5362,124 +5958,124 @@
       goto __pyx_L11_bool_binop_done;
     }
     __pyx_t_3 = ((__pyx_v_i == (__pyx_v_class_name_len - 1)) != 0);
     __pyx_t_1 = __pyx_t_3;
     __pyx_L11_bool_binop_done:;
     if (__pyx_t_1) {
 
-      /* "resiliparse/parse/html.pyx":321
+      /* "resiliparse/parse/html.pyx":367
  * 
  *             if is_whitespace(class_name[i]) or i == class_name_len - 1:
  *                 end = i if i < class_name_len - 1 else i + 1             # <<<<<<<<<<<<<<
  *                 if start < end:
  *                     class_list.append(class_name[start:end].decode())
  */
       if (((__pyx_v_i < (__pyx_v_class_name_len - 1)) != 0)) {
-        __pyx_t_9 = __Pyx_PyInt_FromSize_t(__pyx_v_i); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 321, __pyx_L1_error)
+        __pyx_t_9 = __Pyx_PyInt_FromSize_t(__pyx_v_i); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 367, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_9);
         __pyx_t_4 = __pyx_t_9;
         __pyx_t_9 = 0;
       } else {
-        __pyx_t_9 = __Pyx_PyInt_FromSize_t((__pyx_v_i + 1)); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 321, __pyx_L1_error)
+        __pyx_t_9 = __Pyx_PyInt_FromSize_t((__pyx_v_i + 1)); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 367, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_9);
         __pyx_t_4 = __pyx_t_9;
         __pyx_t_9 = 0;
       }
       __Pyx_DECREF_SET(__pyx_v_end, __pyx_t_4);
       __pyx_t_4 = 0;
 
-      /* "resiliparse/parse/html.pyx":322
+      /* "resiliparse/parse/html.pyx":368
  *             if is_whitespace(class_name[i]) or i == class_name_len - 1:
  *                 end = i if i < class_name_len - 1 else i + 1
  *                 if start < end:             # <<<<<<<<<<<<<<
  *                     class_list.append(class_name[start:end].decode())
  *                     start = i + 1
  */
-      __pyx_t_4 = PyObject_RichCompare(__pyx_v_start, __pyx_v_end, Py_LT); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 322, __pyx_L1_error)
-      __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 322, __pyx_L1_error)
+      __pyx_t_4 = PyObject_RichCompare(__pyx_v_start, __pyx_v_end, Py_LT); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 368, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 368, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
       if (__pyx_t_1) {
 
-        /* "resiliparse/parse/html.pyx":323
+        /* "resiliparse/parse/html.pyx":369
  *                 end = i if i < class_name_len - 1 else i + 1
  *                 if start < end:
  *                     class_list.append(class_name[start:end].decode())             # <<<<<<<<<<<<<<
  *                     start = i + 1
  * 
  */
         __Pyx_INCREF(__pyx_v_start);
         __pyx_t_4 = __pyx_v_start;
         __pyx_t_1 = (__pyx_t_4 == Py_None);
         if (__pyx_t_1) {
           __pyx_t_8 = 0;
         } else {
-          __pyx_t_10 = __Pyx_PyIndex_AsSsize_t(__pyx_t_4); if (unlikely((__pyx_t_10 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 323, __pyx_L1_error)
+          __pyx_t_10 = __Pyx_PyIndex_AsSsize_t(__pyx_t_4); if (unlikely((__pyx_t_10 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 369, __pyx_L1_error)
           __pyx_t_8 = __pyx_t_10;
         }
         __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
         __Pyx_INCREF(__pyx_v_end);
         __pyx_t_4 = __pyx_v_end;
         __pyx_t_1 = (__pyx_t_4 == Py_None);
         if (__pyx_t_1) {
           __pyx_t_10 = PY_SSIZE_T_MAX;
         } else {
-          __pyx_t_11 = __Pyx_PyIndex_AsSsize_t(__pyx_t_4); if (unlikely((__pyx_t_11 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 323, __pyx_L1_error)
+          __pyx_t_11 = __Pyx_PyIndex_AsSsize_t(__pyx_t_4); if (unlikely((__pyx_t_11 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 369, __pyx_L1_error)
           __pyx_t_10 = __pyx_t_11;
         }
         __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-        __pyx_t_4 = __Pyx_decode_c_string(((char const *)__pyx_v_class_name), __pyx_t_8, __pyx_t_10, NULL, NULL, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 323, __pyx_L1_error)
+        __pyx_t_4 = __Pyx_decode_c_string(((char const *)__pyx_v_class_name), __pyx_t_8, __pyx_t_10, NULL, NULL, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 369, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
-        __pyx_t_12 = __Pyx_PyList_Append(__pyx_v_class_list, __pyx_t_4); if (unlikely(__pyx_t_12 == ((int)-1))) __PYX_ERR(0, 323, __pyx_L1_error)
+        __pyx_t_12 = __Pyx_PyList_Append(__pyx_v_class_list, __pyx_t_4); if (unlikely(__pyx_t_12 == ((int)-1))) __PYX_ERR(0, 369, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-        /* "resiliparse/parse/html.pyx":324
+        /* "resiliparse/parse/html.pyx":370
  *                 if start < end:
  *                     class_list.append(class_name[start:end].decode())
  *                     start = i + 1             # <<<<<<<<<<<<<<
  * 
  *         return class_list
  */
-        __pyx_t_4 = __Pyx_PyInt_FromSize_t((__pyx_v_i + 1)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 324, __pyx_L1_error)
+        __pyx_t_4 = __Pyx_PyInt_FromSize_t((__pyx_v_i + 1)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 370, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
         __Pyx_DECREF_SET(__pyx_v_start, __pyx_t_4);
         __pyx_t_4 = 0;
 
-        /* "resiliparse/parse/html.pyx":322
+        /* "resiliparse/parse/html.pyx":368
  *             if is_whitespace(class_name[i]) or i == class_name_len - 1:
  *                 end = i if i < class_name_len - 1 else i + 1
  *                 if start < end:             # <<<<<<<<<<<<<<
  *                     class_list.append(class_name[start:end].decode())
  *                     start = i + 1
  */
       }
 
-      /* "resiliparse/parse/html.pyx":320
+      /* "resiliparse/parse/html.pyx":366
  *                 continue
  * 
  *             if is_whitespace(class_name[i]) or i == class_name_len - 1:             # <<<<<<<<<<<<<<
  *                 end = i if i < class_name_len - 1 else i + 1
  *                 if start < end:
  */
     }
     __pyx_L7_continue:;
   }
 
-  /* "resiliparse/parse/html.pyx":326
+  /* "resiliparse/parse/html.pyx":372
  *                     start = i + 1
  * 
  *         return class_list             # <<<<<<<<<<<<<<
  * 
  *     cdef inline bytes _class_name_bytes(self):
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_class_list);
   __pyx_r = __pyx_v_class_list;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":302
+  /* "resiliparse/parse/html.pyx":348
  *         self.node = node
  * 
  *     cdef list _create_list(self):             # <<<<<<<<<<<<<<
  *         if self.node is None or not self.node.node:
  *             return []
  */
 
@@ -5494,15 +6090,15 @@
   __Pyx_XDECREF(__pyx_v_start);
   __Pyx_XDECREF(__pyx_v_end);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":328
+/* "resiliparse/parse/html.pyx":374
  *         return class_list
  * 
  *     cdef inline bytes _class_name_bytes(self):             # <<<<<<<<<<<<<<
  *         cdef size_t class_name_len = 0
  *         cdef const lxb_char_t* class_name = lxb_dom_element_class(<lxb_dom_element_t*>self.node.node, &class_name_len)
  */
 
@@ -5514,78 +6110,78 @@
   int __pyx_t_1;
   PyObject *__pyx_t_2 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_class_name_bytes", 0);
 
-  /* "resiliparse/parse/html.pyx":329
+  /* "resiliparse/parse/html.pyx":375
  * 
  *     cdef inline bytes _class_name_bytes(self):
  *         cdef size_t class_name_len = 0             # <<<<<<<<<<<<<<
  *         cdef const lxb_char_t* class_name = lxb_dom_element_class(<lxb_dom_element_t*>self.node.node, &class_name_len)
  *         if not class_name:
  */
   __pyx_v_class_name_len = 0;
 
-  /* "resiliparse/parse/html.pyx":330
+  /* "resiliparse/parse/html.pyx":376
  *     cdef inline bytes _class_name_bytes(self):
  *         cdef size_t class_name_len = 0
  *         cdef const lxb_char_t* class_name = lxb_dom_element_class(<lxb_dom_element_t*>self.node.node, &class_name_len)             # <<<<<<<<<<<<<<
  *         if not class_name:
  *             return b''
  */
   __pyx_v_class_name = lxb_dom_element_class(((lxb_dom_element_t *)__pyx_v_self->node->node), (&__pyx_v_class_name_len));
 
-  /* "resiliparse/parse/html.pyx":331
+  /* "resiliparse/parse/html.pyx":377
  *         cdef size_t class_name_len = 0
  *         cdef const lxb_char_t* class_name = lxb_dom_element_class(<lxb_dom_element_t*>self.node.node, &class_name_len)
  *         if not class_name:             # <<<<<<<<<<<<<<
  *             return b''
  *         return class_name[:class_name_len]
  */
   __pyx_t_1 = ((!(__pyx_v_class_name != 0)) != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/parse/html.pyx":332
+    /* "resiliparse/parse/html.pyx":378
  *         cdef const lxb_char_t* class_name = lxb_dom_element_class(<lxb_dom_element_t*>self.node.node, &class_name_len)
  *         if not class_name:
  *             return b''             # <<<<<<<<<<<<<<
  *         return class_name[:class_name_len]
  * 
  */
     __Pyx_XDECREF(__pyx_r);
-    __Pyx_INCREF(__pyx_kp_b__2);
-    __pyx_r = __pyx_kp_b__2;
+    __Pyx_INCREF(__pyx_kp_b__5);
+    __pyx_r = __pyx_kp_b__5;
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":331
+    /* "resiliparse/parse/html.pyx":377
  *         cdef size_t class_name_len = 0
  *         cdef const lxb_char_t* class_name = lxb_dom_element_class(<lxb_dom_element_t*>self.node.node, &class_name_len)
  *         if not class_name:             # <<<<<<<<<<<<<<
  *             return b''
  *         return class_name[:class_name_len]
  */
   }
 
-  /* "resiliparse/parse/html.pyx":333
+  /* "resiliparse/parse/html.pyx":379
  *         if not class_name:
  *             return b''
  *         return class_name[:class_name_len]             # <<<<<<<<<<<<<<
  * 
  *     cpdef void add(self, str class_name):
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_2 = __Pyx_PyBytes_FromStringAndSize(((const char*)__pyx_v_class_name) + 0, __pyx_v_class_name_len - 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 333, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyBytes_FromStringAndSize(((const char*)__pyx_v_class_name) + 0, __pyx_v_class_name_len - 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 379, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_r = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":328
+  /* "resiliparse/parse/html.pyx":374
  *         return class_list
  * 
  *     cdef inline bytes _class_name_bytes(self):             # <<<<<<<<<<<<<<
  *         cdef size_t class_name_len = 0
  *         cdef const lxb_char_t* class_name = lxb_dom_element_class(<lxb_dom_element_t*>self.node.node, &class_name_len)
  */
 
@@ -5596,15 +6192,15 @@
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":335
+/* "resiliparse/parse/html.pyx":381
  *         return class_name[:class_name_len]
  * 
  *     cpdef void add(self, str class_name):             # <<<<<<<<<<<<<<
  *         """
  *         add(self, class_name)
  */
 
@@ -5631,15 +6227,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_add); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 335, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_add); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 381, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_11resiliparse_5parse_4html_19DOMElementClassList_3add)) {
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_4)) {
@@ -5647,15 +6243,15 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_v_class_name) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_class_name);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 335, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 381, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
@@ -5667,15 +6263,15 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "resiliparse/parse/html.pyx":344
+  /* "resiliparse/parse/html.pyx":390
  *         :type class_name: str
  *         """
  *         if self.node is None or not self.node.node:             # <<<<<<<<<<<<<<
  *             return
  * 
  */
   __pyx_t_6 = (((PyObject *)__pyx_v_self->node) == Py_None);
@@ -5686,150 +6282,150 @@
     goto __pyx_L4_bool_binop_done;
   }
   __pyx_t_7 = ((!(__pyx_v_self->node->node != 0)) != 0);
   __pyx_t_5 = __pyx_t_7;
   __pyx_L4_bool_binop_done:;
   if (__pyx_t_5) {
 
-    /* "resiliparse/parse/html.pyx":345
+    /* "resiliparse/parse/html.pyx":391
  *         """
  *         if self.node is None or not self.node.node:
  *             return             # <<<<<<<<<<<<<<
  * 
  *         cdef list l = self._create_list()
  */
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":344
+    /* "resiliparse/parse/html.pyx":390
  *         :type class_name: str
  *         """
  *         if self.node is None or not self.node.node:             # <<<<<<<<<<<<<<
  *             return
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":347
+  /* "resiliparse/parse/html.pyx":393
  *             return
  * 
  *         cdef list l = self._create_list()             # <<<<<<<<<<<<<<
  *         if class_name in l:
  *             return
  */
-  __pyx_t_1 = ((struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMElementClassList *)__pyx_v_self->__pyx_vtab)->_create_list(__pyx_v_self); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 347, __pyx_L1_error)
+  __pyx_t_1 = ((struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMElementClassList *)__pyx_v_self->__pyx_vtab)->_create_list(__pyx_v_self); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 393, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_l = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "resiliparse/parse/html.pyx":348
+  /* "resiliparse/parse/html.pyx":394
  * 
  *         cdef list l = self._create_list()
  *         if class_name in l:             # <<<<<<<<<<<<<<
  *             return
  * 
  */
-  __pyx_t_5 = (__Pyx_PySequence_ContainsTF(__pyx_v_class_name, __pyx_v_l, Py_EQ)); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 348, __pyx_L1_error)
+  __pyx_t_5 = (__Pyx_PySequence_ContainsTF(__pyx_v_class_name, __pyx_v_l, Py_EQ)); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 394, __pyx_L1_error)
   __pyx_t_7 = (__pyx_t_5 != 0);
   if (__pyx_t_7) {
 
-    /* "resiliparse/parse/html.pyx":349
+    /* "resiliparse/parse/html.pyx":395
  *         cdef list l = self._create_list()
  *         if class_name in l:
  *             return             # <<<<<<<<<<<<<<
  * 
  *         cdef bytes new_class_name = self._class_name_bytes()
  */
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":348
+    /* "resiliparse/parse/html.pyx":394
  * 
  *         cdef list l = self._create_list()
  *         if class_name in l:             # <<<<<<<<<<<<<<
  *             return
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":351
+  /* "resiliparse/parse/html.pyx":397
  *             return
  * 
  *         cdef bytes new_class_name = self._class_name_bytes()             # <<<<<<<<<<<<<<
  *         if not is_whitespace(new_class_name[-1]):
  *             class_name = ' ' + class_name
  */
-  __pyx_t_1 = __pyx_f_11resiliparse_5parse_4html_19DOMElementClassList__class_name_bytes(__pyx_v_self); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 351, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_11resiliparse_5parse_4html_19DOMElementClassList__class_name_bytes(__pyx_v_self); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 397, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_new_class_name = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "resiliparse/parse/html.pyx":352
+  /* "resiliparse/parse/html.pyx":398
  * 
  *         cdef bytes new_class_name = self._class_name_bytes()
  *         if not is_whitespace(new_class_name[-1]):             # <<<<<<<<<<<<<<
  *             class_name = ' ' + class_name
  *         new_class_name = new_class_name + class_name.encode()
  */
-  __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_new_class_name, -1L, long, 1, __Pyx_PyInt_From_long, 0, 1, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 352, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_GetItemInt(__pyx_v_new_class_name, -1L, long, 1, __Pyx_PyInt_From_long, 0, 1, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 398, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_8 = __Pyx_PyInt_As_char(__pyx_t_1); if (unlikely((__pyx_t_8 == (char)-1) && PyErr_Occurred())) __PYX_ERR(0, 352, __pyx_L1_error)
+  __pyx_t_8 = __Pyx_PyInt_As_char(__pyx_t_1); if (unlikely((__pyx_t_8 == (char)-1) && PyErr_Occurred())) __PYX_ERR(0, 398, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_t_7 = ((!(__pyx_f_11resiliparse_5parse_4html_is_whitespace(__pyx_t_8) != 0)) != 0);
   if (__pyx_t_7) {
 
-    /* "resiliparse/parse/html.pyx":353
+    /* "resiliparse/parse/html.pyx":399
  *         cdef bytes new_class_name = self._class_name_bytes()
  *         if not is_whitespace(new_class_name[-1]):
  *             class_name = ' ' + class_name             # <<<<<<<<<<<<<<
  *         new_class_name = new_class_name + class_name.encode()
  *         # noinspection PyProtectedMember
  */
-    __pyx_t_1 = __Pyx_PyUnicode_ConcatSafe(__pyx_kp_u__3, __pyx_v_class_name); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 353, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyUnicode_ConcatSafe(__pyx_kp_u__6, __pyx_v_class_name); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 399, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF_SET(__pyx_v_class_name, ((PyObject*)__pyx_t_1));
     __pyx_t_1 = 0;
 
-    /* "resiliparse/parse/html.pyx":352
+    /* "resiliparse/parse/html.pyx":398
  * 
  *         cdef bytes new_class_name = self._class_name_bytes()
  *         if not is_whitespace(new_class_name[-1]):             # <<<<<<<<<<<<<<
  *             class_name = ' ' + class_name
  *         new_class_name = new_class_name + class_name.encode()
  */
   }
 
-  /* "resiliparse/parse/html.pyx":354
+  /* "resiliparse/parse/html.pyx":400
  *         if not is_whitespace(new_class_name[-1]):
  *             class_name = ' ' + class_name
  *         new_class_name = new_class_name + class_name.encode()             # <<<<<<<<<<<<<<
  *         # noinspection PyProtectedMember
  *         self.node._setattr_impl(b'class', new_class_name)
  */
   if (unlikely(__pyx_v_class_name == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "encode");
-    __PYX_ERR(0, 354, __pyx_L1_error)
+    __PYX_ERR(0, 400, __pyx_L1_error)
   }
-  __pyx_t_1 = PyUnicode_AsEncodedString(__pyx_v_class_name, NULL, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 354, __pyx_L1_error)
+  __pyx_t_1 = PyUnicode_AsEncodedString(__pyx_v_class_name, NULL, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 400, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = PyNumber_Add(__pyx_v_new_class_name, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 354, __pyx_L1_error)
+  __pyx_t_2 = PyNumber_Add(__pyx_v_new_class_name, __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 400, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  if (!(likely(PyBytes_CheckExact(__pyx_t_2))||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_2)->tp_name), 0))) __PYX_ERR(0, 354, __pyx_L1_error)
+  if (!(likely(PyBytes_CheckExact(__pyx_t_2))||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_2)->tp_name), 0))) __PYX_ERR(0, 400, __pyx_L1_error)
   __Pyx_DECREF_SET(__pyx_v_new_class_name, ((PyObject*)__pyx_t_2));
   __pyx_t_2 = 0;
 
-  /* "resiliparse/parse/html.pyx":356
+  /* "resiliparse/parse/html.pyx":402
  *         new_class_name = new_class_name + class_name.encode()
  *         # noinspection PyProtectedMember
  *         self.node._setattr_impl(b'class', new_class_name)             # <<<<<<<<<<<<<<
  * 
  *     cpdef void remove(self, str class_name):
  */
-  __pyx_t_7 = ((struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMNode *)__pyx_v_self->node->__pyx_vtab)->_setattr_impl(__pyx_v_self->node, __pyx_n_b_class, __pyx_v_new_class_name); if (unlikely(__pyx_t_7 == ((int)-1))) __PYX_ERR(0, 356, __pyx_L1_error)
+  __pyx_t_7 = ((struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMNode *)__pyx_v_self->node->__pyx_vtab)->_setattr_impl(__pyx_v_self->node, __pyx_n_b_class, __pyx_v_new_class_name); if (unlikely(__pyx_t_7 == ((int)-1))) __PYX_ERR(0, 402, __pyx_L1_error)
 
-  /* "resiliparse/parse/html.pyx":335
+  /* "resiliparse/parse/html.pyx":381
  *         return class_name[:class_name_len]
  * 
  *     cpdef void add(self, str class_name):             # <<<<<<<<<<<<<<
  *         """
  *         add(self, class_name)
  */
 
@@ -5854,15 +6450,15 @@
 static PyObject *__pyx_pw_11resiliparse_5parse_4html_19DOMElementClassList_3add(PyObject *__pyx_v_self, PyObject *__pyx_v_class_name) {
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("add (wrapper)", 0);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_class_name), (&PyUnicode_Type), 1, "class_name", 1))) __PYX_ERR(0, 335, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_class_name), (&PyUnicode_Type), 1, "class_name", 1))) __PYX_ERR(0, 381, __pyx_L1_error)
   __pyx_r = __pyx_pf_11resiliparse_5parse_4html_19DOMElementClassList_2add(((struct __pyx_obj_11resiliparse_5parse_4html_DOMElementClassList *)__pyx_v_self), ((PyObject*)__pyx_v_class_name));
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -5875,15 +6471,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("add", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_void_to_None(__pyx_f_11resiliparse_5parse_4html_19DOMElementClassList_add(__pyx_v_self, __pyx_v_class_name, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 335, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_void_to_None(__pyx_f_11resiliparse_5parse_4html_19DOMElementClassList_add(__pyx_v_self, __pyx_v_class_name, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 381, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -5892,15 +6488,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":358
+/* "resiliparse/parse/html.pyx":404
  *         self.node._setattr_impl(b'class', new_class_name)
  * 
  *     cpdef void remove(self, str class_name):             # <<<<<<<<<<<<<<
  *         """
  *         remove(self, class_name)
  */
 
@@ -5928,15 +6524,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_remove); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 358, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_remove); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 404, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_11resiliparse_5parse_4html_19DOMElementClassList_5remove)) {
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_4)) {
@@ -5944,15 +6540,15 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_v_class_name) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_class_name);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 358, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 404, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
@@ -5964,15 +6560,15 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "resiliparse/parse/html.pyx":367
+  /* "resiliparse/parse/html.pyx":413
  *         :type class_name: str
  *         """
  *         if self.node is None or not self.node.node:             # <<<<<<<<<<<<<<
  *             return
  * 
  */
   __pyx_t_6 = (((PyObject *)__pyx_v_self->node) == Py_None);
@@ -5983,133 +6579,133 @@
     goto __pyx_L4_bool_binop_done;
   }
   __pyx_t_7 = ((!(__pyx_v_self->node->node != 0)) != 0);
   __pyx_t_5 = __pyx_t_7;
   __pyx_L4_bool_binop_done:;
   if (__pyx_t_5) {
 
-    /* "resiliparse/parse/html.pyx":368
+    /* "resiliparse/parse/html.pyx":414
  *         """
  *         if self.node is None or not self.node.node:
  *             return             # <<<<<<<<<<<<<<
  * 
  *         cdef list l = [c for c in self._create_list() if c != class_name]
  */
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":367
+    /* "resiliparse/parse/html.pyx":413
  *         :type class_name: str
  *         """
  *         if self.node is None or not self.node.node:             # <<<<<<<<<<<<<<
  *             return
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":370
+  /* "resiliparse/parse/html.pyx":416
  *             return
  * 
  *         cdef list l = [c for c in self._create_list() if c != class_name]             # <<<<<<<<<<<<<<
  *         # noinspection PyProtectedMember
  *         self.node._setattr_impl(b'class', b' '.join([c.encode() for c in l]))
  */
   { /* enter inner scope */
-    __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 370, __pyx_L8_error)
+    __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 416, __pyx_L8_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_2 = ((struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMElementClassList *)__pyx_v_self->__pyx_vtab)->_create_list(__pyx_v_self); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 370, __pyx_L8_error)
+    __pyx_t_2 = ((struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMElementClassList *)__pyx_v_self->__pyx_vtab)->_create_list(__pyx_v_self); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 416, __pyx_L8_error)
     __Pyx_GOTREF(__pyx_t_2);
     if (unlikely(__pyx_t_2 == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "'NoneType' object is not iterable");
-      __PYX_ERR(0, 370, __pyx_L8_error)
+      __PYX_ERR(0, 416, __pyx_L8_error)
     }
     __pyx_t_3 = __pyx_t_2; __Pyx_INCREF(__pyx_t_3); __pyx_t_8 = 0;
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     for (;;) {
       if (__pyx_t_8 >= PyList_GET_SIZE(__pyx_t_3)) break;
       #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-      __pyx_t_2 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_8); __Pyx_INCREF(__pyx_t_2); __pyx_t_8++; if (unlikely(0 < 0)) __PYX_ERR(0, 370, __pyx_L8_error)
+      __pyx_t_2 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_8); __Pyx_INCREF(__pyx_t_2); __pyx_t_8++; if (unlikely(0 < 0)) __PYX_ERR(0, 416, __pyx_L8_error)
       #else
-      __pyx_t_2 = PySequence_ITEM(__pyx_t_3, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 370, __pyx_L8_error)
+      __pyx_t_2 = PySequence_ITEM(__pyx_t_3, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 416, __pyx_L8_error)
       __Pyx_GOTREF(__pyx_t_2);
       #endif
       __Pyx_XDECREF_SET(__pyx_7genexpr__pyx_v_c, __pyx_t_2);
       __pyx_t_2 = 0;
-      __pyx_t_5 = (__Pyx_PyUnicode_Equals(__pyx_7genexpr__pyx_v_c, __pyx_v_class_name, Py_NE)); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 370, __pyx_L8_error)
+      __pyx_t_5 = (__Pyx_PyUnicode_Equals(__pyx_7genexpr__pyx_v_c, __pyx_v_class_name, Py_NE)); if (unlikely(__pyx_t_5 < 0)) __PYX_ERR(0, 416, __pyx_L8_error)
       if (__pyx_t_5) {
-        if (unlikely(__Pyx_ListComp_Append(__pyx_t_1, (PyObject*)__pyx_7genexpr__pyx_v_c))) __PYX_ERR(0, 370, __pyx_L8_error)
+        if (unlikely(__Pyx_ListComp_Append(__pyx_t_1, (PyObject*)__pyx_7genexpr__pyx_v_c))) __PYX_ERR(0, 416, __pyx_L8_error)
       }
     }
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_XDECREF(__pyx_7genexpr__pyx_v_c); __pyx_7genexpr__pyx_v_c = 0;
     goto __pyx_L12_exit_scope;
     __pyx_L8_error:;
     __Pyx_XDECREF(__pyx_7genexpr__pyx_v_c); __pyx_7genexpr__pyx_v_c = 0;
     goto __pyx_L1_error;
     __pyx_L12_exit_scope:;
   } /* exit inner scope */
   __pyx_v_l = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "resiliparse/parse/html.pyx":372
+  /* "resiliparse/parse/html.pyx":418
  *         cdef list l = [c for c in self._create_list() if c != class_name]
  *         # noinspection PyProtectedMember
  *         self.node._setattr_impl(b'class', b' '.join([c.encode() for c in l]))             # <<<<<<<<<<<<<<
  * 
  *     def __contains__(self, item):
  */
   { /* enter inner scope */
-    __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 372, __pyx_L15_error)
+    __pyx_t_1 = PyList_New(0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 418, __pyx_L15_error)
     __Pyx_GOTREF(__pyx_t_1);
     __pyx_t_3 = __pyx_v_l; __Pyx_INCREF(__pyx_t_3); __pyx_t_8 = 0;
     for (;;) {
       if (__pyx_t_8 >= PyList_GET_SIZE(__pyx_t_3)) break;
       #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-      __pyx_t_2 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_8); __Pyx_INCREF(__pyx_t_2); __pyx_t_8++; if (unlikely(0 < 0)) __PYX_ERR(0, 372, __pyx_L15_error)
+      __pyx_t_2 = PyList_GET_ITEM(__pyx_t_3, __pyx_t_8); __Pyx_INCREF(__pyx_t_2); __pyx_t_8++; if (unlikely(0 < 0)) __PYX_ERR(0, 418, __pyx_L15_error)
       #else
-      __pyx_t_2 = PySequence_ITEM(__pyx_t_3, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 372, __pyx_L15_error)
+      __pyx_t_2 = PySequence_ITEM(__pyx_t_3, __pyx_t_8); __pyx_t_8++; if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 418, __pyx_L15_error)
       __Pyx_GOTREF(__pyx_t_2);
       #endif
       __Pyx_XDECREF_SET(__pyx_8genexpr1__pyx_v_c, __pyx_t_2);
       __pyx_t_2 = 0;
-      __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_8genexpr1__pyx_v_c, __pyx_n_s_encode); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 372, __pyx_L15_error)
+      __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_8genexpr1__pyx_v_c, __pyx_n_s_encode); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 418, __pyx_L15_error)
       __Pyx_GOTREF(__pyx_t_4);
       __pyx_t_9 = NULL;
       if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
         __pyx_t_9 = PyMethod_GET_SELF(__pyx_t_4);
         if (likely(__pyx_t_9)) {
           PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
           __Pyx_INCREF(__pyx_t_9);
           __Pyx_INCREF(function);
           __Pyx_DECREF_SET(__pyx_t_4, function);
         }
       }
       __pyx_t_2 = (__pyx_t_9) ? __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_9) : __Pyx_PyObject_CallNoArg(__pyx_t_4);
       __Pyx_XDECREF(__pyx_t_9); __pyx_t_9 = 0;
-      if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 372, __pyx_L15_error)
+      if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 418, __pyx_L15_error)
       __Pyx_GOTREF(__pyx_t_2);
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-      if (unlikely(__Pyx_ListComp_Append(__pyx_t_1, (PyObject*)__pyx_t_2))) __PYX_ERR(0, 372, __pyx_L15_error)
+      if (unlikely(__Pyx_ListComp_Append(__pyx_t_1, (PyObject*)__pyx_t_2))) __PYX_ERR(0, 418, __pyx_L15_error)
       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
     }
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_XDECREF(__pyx_8genexpr1__pyx_v_c); __pyx_8genexpr1__pyx_v_c = 0;
     goto __pyx_L18_exit_scope;
     __pyx_L15_error:;
     __Pyx_XDECREF(__pyx_8genexpr1__pyx_v_c); __pyx_8genexpr1__pyx_v_c = 0;
     goto __pyx_L1_error;
     __pyx_L18_exit_scope:;
   } /* exit inner scope */
-  __pyx_t_3 = __Pyx_PyBytes_Join(__pyx_kp_b__3, __pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 372, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyBytes_Join(__pyx_kp_b__6, __pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 418, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  if (!(likely(PyBytes_CheckExact(__pyx_t_3))||((__pyx_t_3) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_3)->tp_name), 0))) __PYX_ERR(0, 372, __pyx_L1_error)
-  __pyx_t_5 = ((struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMNode *)__pyx_v_self->node->__pyx_vtab)->_setattr_impl(__pyx_v_self->node, __pyx_n_b_class, ((PyObject*)__pyx_t_3)); if (unlikely(__pyx_t_5 == ((int)-1))) __PYX_ERR(0, 372, __pyx_L1_error)
+  if (!(likely(PyBytes_CheckExact(__pyx_t_3))||((__pyx_t_3) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_3)->tp_name), 0))) __PYX_ERR(0, 418, __pyx_L1_error)
+  __pyx_t_5 = ((struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMNode *)__pyx_v_self->node->__pyx_vtab)->_setattr_impl(__pyx_v_self->node, __pyx_n_b_class, ((PyObject*)__pyx_t_3)); if (unlikely(__pyx_t_5 == ((int)-1))) __PYX_ERR(0, 418, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "resiliparse/parse/html.pyx":358
+  /* "resiliparse/parse/html.pyx":404
  *         self.node._setattr_impl(b'class', new_class_name)
  * 
  *     cpdef void remove(self, str class_name):             # <<<<<<<<<<<<<<
  *         """
  *         remove(self, class_name)
  */
 
@@ -6135,15 +6731,15 @@
 static PyObject *__pyx_pw_11resiliparse_5parse_4html_19DOMElementClassList_5remove(PyObject *__pyx_v_self, PyObject *__pyx_v_class_name) {
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("remove (wrapper)", 0);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_class_name), (&PyUnicode_Type), 1, "class_name", 1))) __PYX_ERR(0, 358, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_class_name), (&PyUnicode_Type), 1, "class_name", 1))) __PYX_ERR(0, 404, __pyx_L1_error)
   __pyx_r = __pyx_pf_11resiliparse_5parse_4html_19DOMElementClassList_4remove(((struct __pyx_obj_11resiliparse_5parse_4html_DOMElementClassList *)__pyx_v_self), ((PyObject*)__pyx_v_class_name));
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -6156,15 +6752,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("remove", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_void_to_None(__pyx_f_11resiliparse_5parse_4html_19DOMElementClassList_remove(__pyx_v_self, __pyx_v_class_name, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 358, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_void_to_None(__pyx_f_11resiliparse_5parse_4html_19DOMElementClassList_remove(__pyx_v_self, __pyx_v_class_name, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 404, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -6173,15 +6769,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":374
+/* "resiliparse/parse/html.pyx":420
  *         self.node._setattr_impl(b'class', b' '.join([c.encode() for c in l]))
  * 
  *     def __contains__(self, item):             # <<<<<<<<<<<<<<
  *         """
  *         __contains__(self, item):
  */
 
@@ -6208,29 +6804,29 @@
   PyObject *__pyx_t_1 = NULL;
   int __pyx_t_2;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__contains__", 0);
 
-  /* "resiliparse/parse/html.pyx":378
+  /* "resiliparse/parse/html.pyx":424
  *         __contains__(self, item):
  *         """
  *         return item in self._create_list()             # <<<<<<<<<<<<<<
  * 
  *     def __getitem__(self, item):
  */
-  __pyx_t_1 = ((struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMElementClassList *)__pyx_v_self->__pyx_vtab)->_create_list(__pyx_v_self); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 378, __pyx_L1_error)
+  __pyx_t_1 = ((struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMElementClassList *)__pyx_v_self->__pyx_vtab)->_create_list(__pyx_v_self); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 424, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = (__Pyx_PySequence_ContainsTF(__pyx_v_item, __pyx_t_1, Py_EQ)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 378, __pyx_L1_error)
+  __pyx_t_2 = (__Pyx_PySequence_ContainsTF(__pyx_v_item, __pyx_t_1, Py_EQ)); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 424, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_r = __pyx_t_2;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":374
+  /* "resiliparse/parse/html.pyx":420
  *         self.node._setattr_impl(b'class', b' '.join([c.encode() for c in l]))
  * 
  *     def __contains__(self, item):             # <<<<<<<<<<<<<<
  *         """
  *         __contains__(self, item):
  */
 
@@ -6240,15 +6836,15 @@
   __Pyx_AddTraceback("resiliparse.parse.html.DOMElementClassList.__contains__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = -1;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":380
+/* "resiliparse/parse/html.pyx":426
  *         return item in self._create_list()
  * 
  *     def __getitem__(self, item):             # <<<<<<<<<<<<<<
  *         """
  *         __contains__(self, item)
  */
 
@@ -6275,36 +6871,36 @@
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__getitem__", 0);
 
-  /* "resiliparse/parse/html.pyx":384
+  /* "resiliparse/parse/html.pyx":430
  *         __contains__(self, item)
  *         """
  *         return self._create_list()[item]             # <<<<<<<<<<<<<<
  * 
  *     def __eq__(self, other):
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = ((struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMElementClassList *)__pyx_v_self->__pyx_vtab)->_create_list(__pyx_v_self); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 384, __pyx_L1_error)
+  __pyx_t_1 = ((struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMElementClassList *)__pyx_v_self->__pyx_vtab)->_create_list(__pyx_v_self); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 430, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   if (unlikely(__pyx_t_1 == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "'NoneType' object is not subscriptable");
-    __PYX_ERR(0, 384, __pyx_L1_error)
+    __PYX_ERR(0, 430, __pyx_L1_error)
   }
-  __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_v_item); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 384, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetItem(__pyx_t_1, __pyx_v_item); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 430, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_r = __pyx_t_2;
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":380
+  /* "resiliparse/parse/html.pyx":426
  *         return item in self._create_list()
  * 
  *     def __getitem__(self, item):             # <<<<<<<<<<<<<<
  *         """
  *         __contains__(self, item)
  */
 
@@ -6316,15 +6912,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":386
+/* "resiliparse/parse/html.pyx":432
  *         return self._create_list()[item]
  * 
  *     def __eq__(self, other):             # <<<<<<<<<<<<<<
  *         """
  *         __eq__(self, other)
  */
 
@@ -6351,31 +6947,31 @@
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__eq__", 0);
 
-  /* "resiliparse/parse/html.pyx":390
+  /* "resiliparse/parse/html.pyx":436
  *         __eq__(self, other)
  *         """
  *         return other == self._create_list()             # <<<<<<<<<<<<<<
  * 
  *     def __len__(self):
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = ((struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMElementClassList *)__pyx_v_self->__pyx_vtab)->_create_list(__pyx_v_self); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 390, __pyx_L1_error)
+  __pyx_t_1 = ((struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMElementClassList *)__pyx_v_self->__pyx_vtab)->_create_list(__pyx_v_self); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 436, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = PyObject_RichCompare(__pyx_v_other, __pyx_t_1, Py_EQ); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 390, __pyx_L1_error)
+  __pyx_t_2 = PyObject_RichCompare(__pyx_v_other, __pyx_t_1, Py_EQ); __Pyx_XGOTREF(__pyx_t_2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 436, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_r = __pyx_t_2;
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":386
+  /* "resiliparse/parse/html.pyx":432
  *         return self._create_list()[item]
  * 
  *     def __eq__(self, other):             # <<<<<<<<<<<<<<
  *         """
  *         __eq__(self, other)
  */
 
@@ -6387,15 +6983,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":392
+/* "resiliparse/parse/html.pyx":438
  *         return other == self._create_list()
  * 
  *     def __len__(self):             # <<<<<<<<<<<<<<
  *         """
  *         __len__(self)
  */
 
@@ -6422,33 +7018,33 @@
   PyObject *__pyx_t_1 = NULL;
   Py_ssize_t __pyx_t_2;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__len__", 0);
 
-  /* "resiliparse/parse/html.pyx":396
+  /* "resiliparse/parse/html.pyx":442
  *         __len__(self)
  *         """
  *         return len(self._create_list())             # <<<<<<<<<<<<<<
  * 
  *     def __iter__(self):
  */
-  __pyx_t_1 = ((struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMElementClassList *)__pyx_v_self->__pyx_vtab)->_create_list(__pyx_v_self); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 396, __pyx_L1_error)
+  __pyx_t_1 = ((struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMElementClassList *)__pyx_v_self->__pyx_vtab)->_create_list(__pyx_v_self); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 442, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   if (unlikely(__pyx_t_1 == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-    __PYX_ERR(0, 396, __pyx_L1_error)
+    __PYX_ERR(0, 442, __pyx_L1_error)
   }
-  __pyx_t_2 = PyList_GET_SIZE(__pyx_t_1); if (unlikely(__pyx_t_2 == ((Py_ssize_t)-1))) __PYX_ERR(0, 396, __pyx_L1_error)
+  __pyx_t_2 = PyList_GET_SIZE(__pyx_t_1); if (unlikely(__pyx_t_2 == ((Py_ssize_t)-1))) __PYX_ERR(0, 442, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_r = __pyx_t_2;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":392
+  /* "resiliparse/parse/html.pyx":438
  *         return other == self._create_list()
  * 
  *     def __len__(self):             # <<<<<<<<<<<<<<
  *         """
  *         __len__(self)
  */
 
@@ -6458,15 +7054,15 @@
   __Pyx_AddTraceback("resiliparse.parse.html.DOMElementClassList.__len__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = -1;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":398
+/* "resiliparse/parse/html.pyx":444
  *         return len(self._create_list())
  * 
  *     def __iter__(self):             # <<<<<<<<<<<<<<
  *         """
  *         __iter__(self)
  */
 
@@ -6493,32 +7089,32 @@
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__iter__", 0);
 
-  /* "resiliparse/parse/html.pyx":402
+  /* "resiliparse/parse/html.pyx":448
  *         __iter__(self)
  *         """
  *         return iter(self._create_list())             # <<<<<<<<<<<<<<
  * 
  *     def __repr__(self):
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = ((struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMElementClassList *)__pyx_v_self->__pyx_vtab)->_create_list(__pyx_v_self); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 402, __pyx_L1_error)
+  __pyx_t_1 = ((struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMElementClassList *)__pyx_v_self->__pyx_vtab)->_create_list(__pyx_v_self); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 448, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 402, __pyx_L1_error)
+  __pyx_t_2 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 448, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_r = __pyx_t_2;
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":398
+  /* "resiliparse/parse/html.pyx":444
  *         return len(self._create_list())
  * 
  *     def __iter__(self):             # <<<<<<<<<<<<<<
  *         """
  *         __iter__(self)
  */
 
@@ -6530,15 +7126,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":404
+/* "resiliparse/parse/html.pyx":450
  *         return iter(self._create_list())
  * 
  *     def __repr__(self):             # <<<<<<<<<<<<<<
  *         """
  *         __repr__(self)
  */
 
@@ -6565,32 +7161,32 @@
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__repr__", 0);
 
-  /* "resiliparse/parse/html.pyx":408
+  /* "resiliparse/parse/html.pyx":454
  *         __repr__(self)
  *         """
  *         return repr(self._create_list())             # <<<<<<<<<<<<<<
  * 
  *     def __str__(self):
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = ((struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMElementClassList *)__pyx_v_self->__pyx_vtab)->_create_list(__pyx_v_self); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 408, __pyx_L1_error)
+  __pyx_t_1 = ((struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMElementClassList *)__pyx_v_self->__pyx_vtab)->_create_list(__pyx_v_self); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 454, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = PyObject_Repr(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 408, __pyx_L1_error)
+  __pyx_t_2 = PyObject_Repr(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 454, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_r = __pyx_t_2;
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":404
+  /* "resiliparse/parse/html.pyx":450
  *         return iter(self._create_list())
  * 
  *     def __repr__(self):             # <<<<<<<<<<<<<<
  *         """
  *         __repr__(self)
  */
 
@@ -6602,15 +7198,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":410
+/* "resiliparse/parse/html.pyx":456
  *         return repr(self._create_list())
  * 
  *     def __str__(self):             # <<<<<<<<<<<<<<
  *         """
  *         __str__(self)
  */
 
@@ -6637,32 +7233,32 @@
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__str__", 0);
 
-  /* "resiliparse/parse/html.pyx":414
+  /* "resiliparse/parse/html.pyx":460
  *         __str__(self)
  *         """
  *         return str(self._create_list())             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = ((struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMElementClassList *)__pyx_v_self->__pyx_vtab)->_create_list(__pyx_v_self); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 414, __pyx_L1_error)
+  __pyx_t_1 = ((struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMElementClassList *)__pyx_v_self->__pyx_vtab)->_create_list(__pyx_v_self); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 460, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = __Pyx_PyObject_CallOneArg(((PyObject *)(&PyUnicode_Type)), __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 414, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_CallOneArg(((PyObject *)(&PyUnicode_Type)), __pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 460, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_r = __pyx_t_2;
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":410
+  /* "resiliparse/parse/html.pyx":456
  *         return repr(self._create_list())
  * 
  *     def __str__(self):             # <<<<<<<<<<<<<<
  *         """
  *         __str__(self)
  */
 
@@ -6708,15 +7304,15 @@
 
   /* "(tree fragment)":2
  * def __reduce_cython__(self):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")             # <<<<<<<<<<<<<<
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  */
-  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__4, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 2, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__7, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 2, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_Raise(__pyx_t_1, 0, 0, 0);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __PYX_ERR(1, 2, __pyx_L1_error)
 
   /* "(tree fragment)":1
  * def __reduce_cython__(self):             # <<<<<<<<<<<<<<
@@ -6764,15 +7360,15 @@
   __Pyx_RefNannySetupContext("__setstate_cython__", 0);
 
   /* "(tree fragment)":4
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")             # <<<<<<<<<<<<<<
  */
-  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__5, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 4, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__8, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 4, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_Raise(__pyx_t_1, 0, 0, 0);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __PYX_ERR(1, 4, __pyx_L1_error)
 
   /* "(tree fragment)":3
  * def __reduce_cython__(self):
@@ -6787,15 +7383,15 @@
   __Pyx_AddTraceback("resiliparse.parse.html.DOMElementClassList.__setstate_cython__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":428
+/* "resiliparse/parse/html.pyx":474
  *     """
  * 
  *     def __cinit__(self, HTMLTree tree):             # <<<<<<<<<<<<<<
  *         self.tree = tree
  *         self.node = NULL
  */
 
@@ -6824,32 +7420,32 @@
       kw_args = PyDict_Size(__pyx_kwds);
       switch (pos_args) {
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_tree)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__cinit__") < 0)) __PYX_ERR(0, 428, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__cinit__") < 0)) __PYX_ERR(0, 474, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 1) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
     }
     __pyx_v_tree = ((struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *)values[0]);
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__cinit__", 1, 1, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 428, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__cinit__", 1, 1, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 474, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("resiliparse.parse.html.DOMNode.__cinit__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return -1;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_tree), __pyx_ptype_11resiliparse_5parse_4html_HTMLTree, 1, "tree", 0))) __PYX_ERR(0, 428, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_tree), __pyx_ptype_11resiliparse_5parse_4html_HTMLTree, 1, "tree", 0))) __PYX_ERR(0, 474, __pyx_L1_error)
   __pyx_r = __pyx_pf_11resiliparse_5parse_4html_7DOMNode___cinit__(((struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *)__pyx_v_self), __pyx_v_tree);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = -1;
   __pyx_L0:;
@@ -6858,64 +7454,64 @@
 }
 
 static int __pyx_pf_11resiliparse_5parse_4html_7DOMNode___cinit__(struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *__pyx_v_self, struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *__pyx_v_tree) {
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__cinit__", 0);
 
-  /* "resiliparse/parse/html.pyx":429
+  /* "resiliparse/parse/html.pyx":475
  * 
  *     def __cinit__(self, HTMLTree tree):
  *         self.tree = tree             # <<<<<<<<<<<<<<
  *         self.node = NULL
  *         self.class_list_singleton = None
  */
   __Pyx_INCREF(((PyObject *)__pyx_v_tree));
   __Pyx_GIVEREF(((PyObject *)__pyx_v_tree));
   __Pyx_GOTREF(__pyx_v_self->tree);
   __Pyx_DECREF(((PyObject *)__pyx_v_self->tree));
   __pyx_v_self->tree = __pyx_v_tree;
 
-  /* "resiliparse/parse/html.pyx":430
+  /* "resiliparse/parse/html.pyx":476
  *     def __cinit__(self, HTMLTree tree):
  *         self.tree = tree
  *         self.node = NULL             # <<<<<<<<<<<<<<
  *         self.class_list_singleton = None
  * 
  */
   __pyx_v_self->node = NULL;
 
-  /* "resiliparse/parse/html.pyx":431
+  /* "resiliparse/parse/html.pyx":477
  *         self.tree = tree
  *         self.node = NULL
  *         self.class_list_singleton = None             # <<<<<<<<<<<<<<
  * 
  *     def __dealloc__(self):
  */
   __Pyx_INCREF(Py_None);
   __Pyx_GIVEREF(Py_None);
   __Pyx_GOTREF(__pyx_v_self->class_list_singleton);
   __Pyx_DECREF(((PyObject *)__pyx_v_self->class_list_singleton));
   __pyx_v_self->class_list_singleton = ((struct __pyx_obj_11resiliparse_5parse_4html_DOMElementClassList *)Py_None);
 
-  /* "resiliparse/parse/html.pyx":428
+  /* "resiliparse/parse/html.pyx":474
  *     """
  * 
  *     def __cinit__(self, HTMLTree tree):             # <<<<<<<<<<<<<<
  *         self.tree = tree
  *         self.node = NULL
  */
 
   /* function exit code */
   __pyx_r = 0;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":433
+/* "resiliparse/parse/html.pyx":479
  *         self.class_list_singleton = None
  * 
  *     def __dealloc__(self):             # <<<<<<<<<<<<<<
  *         if not self.node or self.tree is None:
  *             return
  */
 
@@ -6933,15 +7529,15 @@
 static void __pyx_pf_11resiliparse_5parse_4html_7DOMNode_2__dealloc__(struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *__pyx_v_self) {
   __Pyx_RefNannyDeclarations
   int __pyx_t_1;
   int __pyx_t_2;
   int __pyx_t_3;
   __Pyx_RefNannySetupContext("__dealloc__", 0);
 
-  /* "resiliparse/parse/html.pyx":434
+  /* "resiliparse/parse/html.pyx":480
  * 
  *     def __dealloc__(self):
  *         if not self.node or self.tree is None:             # <<<<<<<<<<<<<<
  *             return
  * 
  */
   __pyx_t_2 = ((!(__pyx_v_self->node != 0)) != 0);
@@ -6952,65 +7548,65 @@
   }
   __pyx_t_2 = (((PyObject *)__pyx_v_self->tree) == Py_None);
   __pyx_t_3 = (__pyx_t_2 != 0);
   __pyx_t_1 = __pyx_t_3;
   __pyx_L4_bool_binop_done:;
   if (__pyx_t_1) {
 
-    /* "resiliparse/parse/html.pyx":435
+    /* "resiliparse/parse/html.pyx":481
  *     def __dealloc__(self):
  *         if not self.node or self.tree is None:
  *             return             # <<<<<<<<<<<<<<
  * 
  *         self.node.user = NULL
  */
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":434
+    /* "resiliparse/parse/html.pyx":480
  * 
  *     def __dealloc__(self):
  *         if not self.node or self.tree is None:             # <<<<<<<<<<<<<<
  *             return
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":437
+  /* "resiliparse/parse/html.pyx":483
  *             return
  * 
  *         self.node.user = NULL             # <<<<<<<<<<<<<<
  * 
  *         # Cannot be done until https://github.com/lexbor/lexbor/issues/132 is fixed
  */
   __pyx_v_self->node->user = NULL;
 
-  /* "resiliparse/parse/html.pyx":443
+  /* "resiliparse/parse/html.pyx":489
  *         # if not self.node.parent and self.node != <lxb_dom_node_t*>self.node.owner_document:
  *         #     lxb_dom_node_destroy_deep(self.node)
  *         self.node = NULL             # <<<<<<<<<<<<<<
  * 
  *     def __iter__(self):
  */
   __pyx_v_self->node = NULL;
 
-  /* "resiliparse/parse/html.pyx":433
+  /* "resiliparse/parse/html.pyx":479
  *         self.class_list_singleton = None
  * 
  *     def __dealloc__(self):             # <<<<<<<<<<<<<<
  *         if not self.node or self.tree is None:
  *             return
  */
 
   /* function exit code */
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
 }
 static PyObject *__pyx_gb_11resiliparse_5parse_4html_7DOMNode_6generator(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value); /* proto */
 
-/* "resiliparse/parse/html.pyx":445
+/* "resiliparse/parse/html.pyx":491
  *         self.node = NULL
  * 
  *     def __iter__(self):             # <<<<<<<<<<<<<<
  *         """
  *         __iter__(self)
  */
 
@@ -7039,23 +7635,23 @@
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__iter__", 0);
   __pyx_cur_scope = (struct __pyx_obj_11resiliparse_5parse_4html___pyx_scope_struct____iter__ *)__pyx_tp_new_11resiliparse_5parse_4html___pyx_scope_struct____iter__(__pyx_ptype_11resiliparse_5parse_4html___pyx_scope_struct____iter__, __pyx_empty_tuple, NULL);
   if (unlikely(!__pyx_cur_scope)) {
     __pyx_cur_scope = ((struct __pyx_obj_11resiliparse_5parse_4html___pyx_scope_struct____iter__ *)Py_None);
     __Pyx_INCREF(Py_None);
-    __PYX_ERR(0, 445, __pyx_L1_error)
+    __PYX_ERR(0, 491, __pyx_L1_error)
   } else {
     __Pyx_GOTREF(__pyx_cur_scope);
   }
   __pyx_cur_scope->__pyx_v_self = __pyx_v_self;
   __Pyx_INCREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
   __Pyx_GIVEREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
   {
-    __pyx_CoroutineObject *gen = __Pyx_Generator_New((__pyx_coroutine_body_t) __pyx_gb_11resiliparse_5parse_4html_7DOMNode_6generator, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_iter, __pyx_n_s_DOMNode___iter, __pyx_n_s_resiliparse_parse_html); if (unlikely(!gen)) __PYX_ERR(0, 445, __pyx_L1_error)
+    __pyx_CoroutineObject *gen = __Pyx_Generator_New((__pyx_coroutine_body_t) __pyx_gb_11resiliparse_5parse_4html_7DOMNode_6generator, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_iter, __pyx_n_s_DOMNode___iter, __pyx_n_s_resiliparse_parse_html); if (unlikely(!gen)) __PYX_ERR(0, 491, __pyx_L1_error)
     __Pyx_DECREF(__pyx_cur_scope);
     __Pyx_RefNannyFinishContext();
     return (PyObject *) gen;
   }
 
   /* function exit code */
   __pyx_L1_error:;
@@ -7085,47 +7681,47 @@
     case 1: goto __pyx_L5_resume_from_yield;
     case 2: goto __pyx_L9_resume_from_yield;
     default: /* CPython raises the right error here */
     __Pyx_RefNannyFinishContext();
     return NULL;
   }
   __pyx_L3_first_run:;
-  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 445, __pyx_L1_error)
+  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 491, __pyx_L1_error)
 
-  /* "resiliparse/parse/html.pyx":453
+  /* "resiliparse/parse/html.pyx":499
  *         :rtype: t.Iterable[DOMNode]
  *         """
  *         if not check_node(self):             # <<<<<<<<<<<<<<
  *             return
  * 
  */
   __pyx_t_1 = ((!(__pyx_f_11resiliparse_5parse_4html_check_node(__pyx_cur_scope->__pyx_v_self) != 0)) != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/parse/html.pyx":454
+    /* "resiliparse/parse/html.pyx":500
  *         """
  *         if not check_node(self):
  *             return             # <<<<<<<<<<<<<<
  * 
  *         yield self
  */
     __Pyx_XDECREF(__pyx_r);
     __pyx_r = NULL;
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":453
+    /* "resiliparse/parse/html.pyx":499
  *         :rtype: t.Iterable[DOMNode]
  *         """
  *         if not check_node(self):             # <<<<<<<<<<<<<<
  *             return
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":456
+  /* "resiliparse/parse/html.pyx":502
  *             return
  * 
  *         yield self             # <<<<<<<<<<<<<<
  *         cdef lxb_dom_node_t* node = self.node
  *         while True:
  */
   __Pyx_INCREF(((PyObject *)__pyx_cur_scope->__pyx_v_self));
@@ -7133,100 +7729,100 @@
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
   /* return from generator, yielding value */
   __pyx_generator->resume_label = 1;
   return __pyx_r;
   __pyx_L5_resume_from_yield:;
-  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 456, __pyx_L1_error)
+  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 502, __pyx_L1_error)
 
-  /* "resiliparse/parse/html.pyx":457
+  /* "resiliparse/parse/html.pyx":503
  * 
  *         yield self
  *         cdef lxb_dom_node_t* node = self.node             # <<<<<<<<<<<<<<
  *         while True:
  *             node = next_node(self.node, node)
  */
   __pyx_t_2 = __pyx_cur_scope->__pyx_v_self->node;
   __pyx_cur_scope->__pyx_v_node = __pyx_t_2;
 
-  /* "resiliparse/parse/html.pyx":458
+  /* "resiliparse/parse/html.pyx":504
  *         yield self
  *         cdef lxb_dom_node_t* node = self.node
  *         while True:             # <<<<<<<<<<<<<<
  *             node = next_node(self.node, node)
  *             if not node:
  */
   while (1) {
 
-    /* "resiliparse/parse/html.pyx":459
+    /* "resiliparse/parse/html.pyx":505
  *         cdef lxb_dom_node_t* node = self.node
  *         while True:
  *             node = next_node(self.node, node)             # <<<<<<<<<<<<<<
  *             if not node:
  *                 return
  */
     __pyx_cur_scope->__pyx_v_node = __pyx_f_11resiliparse_5parse_4html_next_node(__pyx_cur_scope->__pyx_v_self->node, __pyx_cur_scope->__pyx_v_node, NULL);
 
-    /* "resiliparse/parse/html.pyx":460
+    /* "resiliparse/parse/html.pyx":506
  *         while True:
  *             node = next_node(self.node, node)
  *             if not node:             # <<<<<<<<<<<<<<
  *                 return
  *             yield _create_dom_node(self.tree, node)
  */
     __pyx_t_1 = ((!(__pyx_cur_scope->__pyx_v_node != 0)) != 0);
     if (__pyx_t_1) {
 
-      /* "resiliparse/parse/html.pyx":461
+      /* "resiliparse/parse/html.pyx":507
  *             node = next_node(self.node, node)
  *             if not node:
  *                 return             # <<<<<<<<<<<<<<
  *             yield _create_dom_node(self.tree, node)
  * 
  */
       __Pyx_XDECREF(__pyx_r);
       __pyx_r = NULL;
       goto __pyx_L0;
 
-      /* "resiliparse/parse/html.pyx":460
+      /* "resiliparse/parse/html.pyx":506
  *         while True:
  *             node = next_node(self.node, node)
  *             if not node:             # <<<<<<<<<<<<<<
  *                 return
  *             yield _create_dom_node(self.tree, node)
  */
     }
 
-    /* "resiliparse/parse/html.pyx":462
+    /* "resiliparse/parse/html.pyx":508
  *             if not node:
  *                 return
  *             yield _create_dom_node(self.tree, node)             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
     __pyx_t_3 = ((PyObject *)__pyx_cur_scope->__pyx_v_self->tree);
     __Pyx_INCREF(__pyx_t_3);
-    __pyx_t_4 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html__create_dom_node(((struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *)__pyx_t_3), __pyx_cur_scope->__pyx_v_node)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 462, __pyx_L1_error)
+    __pyx_t_4 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html__create_dom_node(((struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *)__pyx_t_3), __pyx_cur_scope->__pyx_v_node)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 508, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_r = __pyx_t_4;
     __pyx_t_4 = 0;
     __Pyx_XGIVEREF(__pyx_r);
     __Pyx_RefNannyFinishContext();
     __Pyx_Coroutine_ResetAndClearException(__pyx_generator);
     /* return from generator, yielding value */
     __pyx_generator->resume_label = 2;
     return __pyx_r;
     __pyx_L9_resume_from_yield:;
-    if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 462, __pyx_L1_error)
+    if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 508, __pyx_L1_error)
   }
   CYTHON_MAYBE_UNUSED_VAR(__pyx_cur_scope);
 
-  /* "resiliparse/parse/html.pyx":445
+  /* "resiliparse/parse/html.pyx":491
  *         self.node = NULL
  * 
  *     def __iter__(self):             # <<<<<<<<<<<<<<
  *         """
  *         __iter__(self)
  */
 
@@ -7244,15 +7840,15 @@
   #endif
   __pyx_generator->resume_label = -1;
   __Pyx_Coroutine_clear((PyObject*)__pyx_generator);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":465
+/* "resiliparse/parse/html.pyx":511
  * 
  *     @property
  *     def type(self):             # <<<<<<<<<<<<<<
  *         """
  *         DOM node type.
  */
 
@@ -7275,59 +7871,59 @@
   int __pyx_t_1;
   PyObject *__pyx_t_2 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
 
-  /* "resiliparse/parse/html.pyx":471
+  /* "resiliparse/parse/html.pyx":517
  *         :type: NodeType
  *         """
  *         if not check_node(self):             # <<<<<<<<<<<<<<
  *             return None
  *         return <NodeType>self.node.type
  */
   __pyx_t_1 = ((!(__pyx_f_11resiliparse_5parse_4html_check_node(__pyx_v_self) != 0)) != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/parse/html.pyx":472
+    /* "resiliparse/parse/html.pyx":518
  *         """
  *         if not check_node(self):
  *             return None             # <<<<<<<<<<<<<<
  *         return <NodeType>self.node.type
  * 
  */
     __Pyx_XDECREF(__pyx_r);
     __pyx_r = Py_None; __Pyx_INCREF(Py_None);
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":471
+    /* "resiliparse/parse/html.pyx":517
  *         :type: NodeType
  *         """
  *         if not check_node(self):             # <<<<<<<<<<<<<<
  *             return None
  *         return <NodeType>self.node.type
  */
   }
 
-  /* "resiliparse/parse/html.pyx":473
+  /* "resiliparse/parse/html.pyx":519
  *         if not check_node(self):
  *             return None
  *         return <NodeType>self.node.type             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_2 = __Pyx_PyInt_From_enum____pyx_t_11resiliparse_5parse_4html_NodeType(((enum __pyx_t_11resiliparse_5parse_4html_NodeType)__pyx_v_self->node->type)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 473, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyInt_From_enum____pyx_t_11resiliparse_5parse_4html_NodeType(((enum __pyx_t_11resiliparse_5parse_4html_NodeType)__pyx_v_self->node->type)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 519, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_r = __pyx_t_2;
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":465
+  /* "resiliparse/parse/html.pyx":511
  * 
  *     @property
  *     def type(self):             # <<<<<<<<<<<<<<
  *         """
  *         DOM node type.
  */
 
@@ -7338,15 +7934,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":476
+/* "resiliparse/parse/html.pyx":522
  * 
  *     @property
  *     def tag(self):             # <<<<<<<<<<<<<<
  *         """
  *         DOM element tag or node name.
  */
 
@@ -7373,125 +7969,125 @@
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
 
-  /* "resiliparse/parse/html.pyx":482
+  /* "resiliparse/parse/html.pyx":528
  *         :type: str or None
  *         """
  *         if not check_node(self):             # <<<<<<<<<<<<<<
  *             return None
  * 
  */
   __pyx_t_1 = ((!(__pyx_f_11resiliparse_5parse_4html_check_node(__pyx_v_self) != 0)) != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/parse/html.pyx":483
+    /* "resiliparse/parse/html.pyx":529
  *         """
  *         if not check_node(self):
  *             return None             # <<<<<<<<<<<<<<
  * 
  *         cdef size_t name_len = 0
  */
     __Pyx_XDECREF(__pyx_r);
     __pyx_r = Py_None; __Pyx_INCREF(Py_None);
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":482
+    /* "resiliparse/parse/html.pyx":528
  *         :type: str or None
  *         """
  *         if not check_node(self):             # <<<<<<<<<<<<<<
  *             return None
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":485
+  /* "resiliparse/parse/html.pyx":531
  *             return None
  * 
  *         cdef size_t name_len = 0             # <<<<<<<<<<<<<<
  *         cdef const lxb_char_t* name = lxb_dom_node_name(self.node, &name_len)
  *         if not name:
  */
   __pyx_v_name_len = 0;
 
-  /* "resiliparse/parse/html.pyx":486
+  /* "resiliparse/parse/html.pyx":532
  * 
  *         cdef size_t name_len = 0
  *         cdef const lxb_char_t* name = lxb_dom_node_name(self.node, &name_len)             # <<<<<<<<<<<<<<
  *         if not name:
  *             return None
  */
   __pyx_v_name = lxb_dom_node_name(__pyx_v_self->node, (&__pyx_v_name_len));
 
-  /* "resiliparse/parse/html.pyx":487
+  /* "resiliparse/parse/html.pyx":533
  *         cdef size_t name_len = 0
  *         cdef const lxb_char_t* name = lxb_dom_node_name(self.node, &name_len)
  *         if not name:             # <<<<<<<<<<<<<<
  *             return None
  *         return name[:name_len].decode().lower()
  */
   __pyx_t_1 = ((!(__pyx_v_name != 0)) != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/parse/html.pyx":488
+    /* "resiliparse/parse/html.pyx":534
  *         cdef const lxb_char_t* name = lxb_dom_node_name(self.node, &name_len)
  *         if not name:
  *             return None             # <<<<<<<<<<<<<<
  *         return name[:name_len].decode().lower()
  * 
  */
     __Pyx_XDECREF(__pyx_r);
     __pyx_r = Py_None; __Pyx_INCREF(Py_None);
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":487
+    /* "resiliparse/parse/html.pyx":533
  *         cdef size_t name_len = 0
  *         cdef const lxb_char_t* name = lxb_dom_node_name(self.node, &name_len)
  *         if not name:             # <<<<<<<<<<<<<<
  *             return None
  *         return name[:name_len].decode().lower()
  */
   }
 
-  /* "resiliparse/parse/html.pyx":489
+  /* "resiliparse/parse/html.pyx":535
  *         if not name:
  *             return None
  *         return name[:name_len].decode().lower()             # <<<<<<<<<<<<<<
  * 
  *     # noinspection DuplicatedCode
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_3 = __Pyx_decode_c_string(((char const *)__pyx_v_name), 0, __pyx_v_name_len, NULL, NULL, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 489, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_decode_c_string(((char const *)__pyx_v_name), 0, __pyx_v_name_len, NULL, NULL, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 535, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_lower); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 489, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_t_3, __pyx_n_s_lower); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 535, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_t_3 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_4))) {
     __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_4);
     if (likely(__pyx_t_3)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_4);
       __Pyx_INCREF(__pyx_t_3);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_4, function);
     }
   }
   __pyx_t_2 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_4, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_4);
   __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 489, __pyx_L1_error)
+  if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 535, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_r = __pyx_t_2;
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":476
+  /* "resiliparse/parse/html.pyx":522
  * 
  *     @property
  *     def tag(self):             # <<<<<<<<<<<<<<
  *         """
  *         DOM element tag or node name.
  */
 
@@ -7504,15 +8100,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":493
+/* "resiliparse/parse/html.pyx":539
  *     # noinspection DuplicatedCode
  *     @property
  *     def first_child(self):             # <<<<<<<<<<<<<<
  *         """
  *         First child element of this DOM node.
  */
 
@@ -7536,62 +8132,62 @@
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
 
-  /* "resiliparse/parse/html.pyx":499
+  /* "resiliparse/parse/html.pyx":545
  *         :type: DOMNode or None
  *         """
  *         if not check_node(self):             # <<<<<<<<<<<<<<
  *             return None
  *         return _create_dom_node(self.tree, self.node.first_child)
  */
   __pyx_t_1 = ((!(__pyx_f_11resiliparse_5parse_4html_check_node(__pyx_v_self) != 0)) != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/parse/html.pyx":500
+    /* "resiliparse/parse/html.pyx":546
  *         """
  *         if not check_node(self):
  *             return None             # <<<<<<<<<<<<<<
  *         return _create_dom_node(self.tree, self.node.first_child)
  * 
  */
     __Pyx_XDECREF(__pyx_r);
     __pyx_r = Py_None; __Pyx_INCREF(Py_None);
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":499
+    /* "resiliparse/parse/html.pyx":545
  *         :type: DOMNode or None
  *         """
  *         if not check_node(self):             # <<<<<<<<<<<<<<
  *             return None
  *         return _create_dom_node(self.tree, self.node.first_child)
  */
   }
 
-  /* "resiliparse/parse/html.pyx":501
+  /* "resiliparse/parse/html.pyx":547
  *         if not check_node(self):
  *             return None
  *         return _create_dom_node(self.tree, self.node.first_child)             # <<<<<<<<<<<<<<
  * 
  *     # noinspection DuplicatedCode
  */
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_2 = ((PyObject *)__pyx_v_self->tree);
   __Pyx_INCREF(__pyx_t_2);
-  __pyx_t_3 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html__create_dom_node(((struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *)__pyx_t_2), __pyx_v_self->node->first_child)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 501, __pyx_L1_error)
+  __pyx_t_3 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html__create_dom_node(((struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *)__pyx_t_2), __pyx_v_self->node->first_child)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 547, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_r = __pyx_t_3;
   __pyx_t_3 = 0;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":493
+  /* "resiliparse/parse/html.pyx":539
  *     # noinspection DuplicatedCode
  *     @property
  *     def first_child(self):             # <<<<<<<<<<<<<<
  *         """
  *         First child element of this DOM node.
  */
 
@@ -7603,15 +8199,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":505
+/* "resiliparse/parse/html.pyx":551
  *     # noinspection DuplicatedCode
  *     @property
  *     def last_child(self):             # <<<<<<<<<<<<<<
  *         """
  *         Last child element of this DOM node.
  */
 
@@ -7635,62 +8231,62 @@
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
 
-  /* "resiliparse/parse/html.pyx":511
+  /* "resiliparse/parse/html.pyx":557
  *         :type: DOMNode or None
  *         """
  *         if not check_node(self):             # <<<<<<<<<<<<<<
  *             return None
  *         return _create_dom_node(self.tree, self.node.last_child)
  */
   __pyx_t_1 = ((!(__pyx_f_11resiliparse_5parse_4html_check_node(__pyx_v_self) != 0)) != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/parse/html.pyx":512
+    /* "resiliparse/parse/html.pyx":558
  *         """
  *         if not check_node(self):
  *             return None             # <<<<<<<<<<<<<<
  *         return _create_dom_node(self.tree, self.node.last_child)
  * 
  */
     __Pyx_XDECREF(__pyx_r);
     __pyx_r = Py_None; __Pyx_INCREF(Py_None);
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":511
+    /* "resiliparse/parse/html.pyx":557
  *         :type: DOMNode or None
  *         """
  *         if not check_node(self):             # <<<<<<<<<<<<<<
  *             return None
  *         return _create_dom_node(self.tree, self.node.last_child)
  */
   }
 
-  /* "resiliparse/parse/html.pyx":513
+  /* "resiliparse/parse/html.pyx":559
  *         if not check_node(self):
  *             return None
  *         return _create_dom_node(self.tree, self.node.last_child)             # <<<<<<<<<<<<<<
  * 
  *     # noinspection DuplicatedCode
  */
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_2 = ((PyObject *)__pyx_v_self->tree);
   __Pyx_INCREF(__pyx_t_2);
-  __pyx_t_3 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html__create_dom_node(((struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *)__pyx_t_2), __pyx_v_self->node->last_child)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 513, __pyx_L1_error)
+  __pyx_t_3 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html__create_dom_node(((struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *)__pyx_t_2), __pyx_v_self->node->last_child)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 559, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_r = __pyx_t_3;
   __pyx_t_3 = 0;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":505
+  /* "resiliparse/parse/html.pyx":551
  *     # noinspection DuplicatedCode
  *     @property
  *     def last_child(self):             # <<<<<<<<<<<<<<
  *         """
  *         Last child element of this DOM node.
  */
 
@@ -7702,15 +8298,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":517
+/* "resiliparse/parse/html.pyx":563
  *     # noinspection DuplicatedCode
  *     @property
  *     def first_element_child(self):             # <<<<<<<<<<<<<<
  *         """
  *         First element child of this DOM node.
  */
 
@@ -7737,55 +8333,55 @@
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
 
-  /* "resiliparse/parse/html.pyx":523
+  /* "resiliparse/parse/html.pyx":569
  *         :type: DOMNode or None
  *         """
  *         if not check_node(self):             # <<<<<<<<<<<<<<
  *             return None
  *         cdef lxb_dom_node_t* child_node = self.node.first_child
  */
   __pyx_t_1 = ((!(__pyx_f_11resiliparse_5parse_4html_check_node(__pyx_v_self) != 0)) != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/parse/html.pyx":524
+    /* "resiliparse/parse/html.pyx":570
  *         """
  *         if not check_node(self):
  *             return None             # <<<<<<<<<<<<<<
  *         cdef lxb_dom_node_t* child_node = self.node.first_child
  *         while child_node and child_node.type != LXB_DOM_NODE_TYPE_ELEMENT:
  */
     __Pyx_XDECREF(__pyx_r);
     __pyx_r = Py_None; __Pyx_INCREF(Py_None);
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":523
+    /* "resiliparse/parse/html.pyx":569
  *         :type: DOMNode or None
  *         """
  *         if not check_node(self):             # <<<<<<<<<<<<<<
  *             return None
  *         cdef lxb_dom_node_t* child_node = self.node.first_child
  */
   }
 
-  /* "resiliparse/parse/html.pyx":525
+  /* "resiliparse/parse/html.pyx":571
  *         if not check_node(self):
  *             return None
  *         cdef lxb_dom_node_t* child_node = self.node.first_child             # <<<<<<<<<<<<<<
  *         while child_node and child_node.type != LXB_DOM_NODE_TYPE_ELEMENT:
  *             child_node = child_node.next
  */
   __pyx_t_2 = __pyx_v_self->node->first_child;
   __pyx_v_child_node = __pyx_t_2;
 
-  /* "resiliparse/parse/html.pyx":526
+  /* "resiliparse/parse/html.pyx":572
  *             return None
  *         cdef lxb_dom_node_t* child_node = self.node.first_child
  *         while child_node and child_node.type != LXB_DOM_NODE_TYPE_ELEMENT:             # <<<<<<<<<<<<<<
  *             child_node = child_node.next
  *         return _create_dom_node(self.tree, child_node)
  */
   while (1) {
@@ -7796,43 +8392,43 @@
       goto __pyx_L6_bool_binop_done;
     }
     __pyx_t_3 = ((__pyx_v_child_node->type != LXB_DOM_NODE_TYPE_ELEMENT) != 0);
     __pyx_t_1 = __pyx_t_3;
     __pyx_L6_bool_binop_done:;
     if (!__pyx_t_1) break;
 
-    /* "resiliparse/parse/html.pyx":527
+    /* "resiliparse/parse/html.pyx":573
  *         cdef lxb_dom_node_t* child_node = self.node.first_child
  *         while child_node and child_node.type != LXB_DOM_NODE_TYPE_ELEMENT:
  *             child_node = child_node.next             # <<<<<<<<<<<<<<
  *         return _create_dom_node(self.tree, child_node)
  * 
  */
     __pyx_t_2 = __pyx_v_child_node->next;
     __pyx_v_child_node = __pyx_t_2;
   }
 
-  /* "resiliparse/parse/html.pyx":528
+  /* "resiliparse/parse/html.pyx":574
  *         while child_node and child_node.type != LXB_DOM_NODE_TYPE_ELEMENT:
  *             child_node = child_node.next
  *         return _create_dom_node(self.tree, child_node)             # <<<<<<<<<<<<<<
  * 
  *     # noinspection DuplicatedCode
  */
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_4 = ((PyObject *)__pyx_v_self->tree);
   __Pyx_INCREF(__pyx_t_4);
-  __pyx_t_5 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html__create_dom_node(((struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *)__pyx_t_4), __pyx_v_child_node)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 528, __pyx_L1_error)
+  __pyx_t_5 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html__create_dom_node(((struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *)__pyx_t_4), __pyx_v_child_node)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 574, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_r = __pyx_t_5;
   __pyx_t_5 = 0;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":517
+  /* "resiliparse/parse/html.pyx":563
  *     # noinspection DuplicatedCode
  *     @property
  *     def first_element_child(self):             # <<<<<<<<<<<<<<
  *         """
  *         First element child of this DOM node.
  */
 
@@ -7844,15 +8440,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":532
+/* "resiliparse/parse/html.pyx":578
  *     # noinspection DuplicatedCode
  *     @property
  *     def last_element_child(self):             # <<<<<<<<<<<<<<
  *         """
  *         Last element child element of this DOM node.
  */
 
@@ -7879,55 +8475,55 @@
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
 
-  /* "resiliparse/parse/html.pyx":538
+  /* "resiliparse/parse/html.pyx":584
  *         :type: DOMNode or None
  *         """
  *         if not check_node(self):             # <<<<<<<<<<<<<<
  *             return None
  *         cdef lxb_dom_node_t* child_node = self.node.last_child
  */
   __pyx_t_1 = ((!(__pyx_f_11resiliparse_5parse_4html_check_node(__pyx_v_self) != 0)) != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/parse/html.pyx":539
+    /* "resiliparse/parse/html.pyx":585
  *         """
  *         if not check_node(self):
  *             return None             # <<<<<<<<<<<<<<
  *         cdef lxb_dom_node_t* child_node = self.node.last_child
  *         while child_node and child_node.type != LXB_DOM_NODE_TYPE_ELEMENT:
  */
     __Pyx_XDECREF(__pyx_r);
     __pyx_r = Py_None; __Pyx_INCREF(Py_None);
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":538
+    /* "resiliparse/parse/html.pyx":584
  *         :type: DOMNode or None
  *         """
  *         if not check_node(self):             # <<<<<<<<<<<<<<
  *             return None
  *         cdef lxb_dom_node_t* child_node = self.node.last_child
  */
   }
 
-  /* "resiliparse/parse/html.pyx":540
+  /* "resiliparse/parse/html.pyx":586
  *         if not check_node(self):
  *             return None
  *         cdef lxb_dom_node_t* child_node = self.node.last_child             # <<<<<<<<<<<<<<
  *         while child_node and child_node.type != LXB_DOM_NODE_TYPE_ELEMENT:
  *             child_node = child_node.prev
  */
   __pyx_t_2 = __pyx_v_self->node->last_child;
   __pyx_v_child_node = __pyx_t_2;
 
-  /* "resiliparse/parse/html.pyx":541
+  /* "resiliparse/parse/html.pyx":587
  *             return None
  *         cdef lxb_dom_node_t* child_node = self.node.last_child
  *         while child_node and child_node.type != LXB_DOM_NODE_TYPE_ELEMENT:             # <<<<<<<<<<<<<<
  *             child_node = child_node.prev
  *         return _create_dom_node(self.tree, child_node)
  */
   while (1) {
@@ -7938,43 +8534,43 @@
       goto __pyx_L6_bool_binop_done;
     }
     __pyx_t_3 = ((__pyx_v_child_node->type != LXB_DOM_NODE_TYPE_ELEMENT) != 0);
     __pyx_t_1 = __pyx_t_3;
     __pyx_L6_bool_binop_done:;
     if (!__pyx_t_1) break;
 
-    /* "resiliparse/parse/html.pyx":542
+    /* "resiliparse/parse/html.pyx":588
  *         cdef lxb_dom_node_t* child_node = self.node.last_child
  *         while child_node and child_node.type != LXB_DOM_NODE_TYPE_ELEMENT:
  *             child_node = child_node.prev             # <<<<<<<<<<<<<<
  *         return _create_dom_node(self.tree, child_node)
  * 
  */
     __pyx_t_2 = __pyx_v_child_node->prev;
     __pyx_v_child_node = __pyx_t_2;
   }
 
-  /* "resiliparse/parse/html.pyx":543
+  /* "resiliparse/parse/html.pyx":589
  *         while child_node and child_node.type != LXB_DOM_NODE_TYPE_ELEMENT:
  *             child_node = child_node.prev
  *         return _create_dom_node(self.tree, child_node)             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_4 = ((PyObject *)__pyx_v_self->tree);
   __Pyx_INCREF(__pyx_t_4);
-  __pyx_t_5 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html__create_dom_node(((struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *)__pyx_t_4), __pyx_v_child_node)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 543, __pyx_L1_error)
+  __pyx_t_5 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html__create_dom_node(((struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *)__pyx_t_4), __pyx_v_child_node)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 589, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_r = __pyx_t_5;
   __pyx_t_5 = 0;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":532
+  /* "resiliparse/parse/html.pyx":578
  *     # noinspection DuplicatedCode
  *     @property
  *     def last_element_child(self):             # <<<<<<<<<<<<<<
  *         """
  *         Last element child element of this DOM node.
  */
 
@@ -7986,15 +8582,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":546
+/* "resiliparse/parse/html.pyx":592
  * 
  *     @property
  *     def child_nodes(self):             # <<<<<<<<<<<<<<
  *         """
  *         List of child nodes.
  */
 
@@ -8022,116 +8618,116 @@
   PyObject *__pyx_t_4 = NULL;
   int __pyx_t_5;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
 
-  /* "resiliparse/parse/html.pyx":552
+  /* "resiliparse/parse/html.pyx":598
  *         :type: t.List[DOMNode]
  *         """
  *         if not check_node(self):             # <<<<<<<<<<<<<<
  *             return
  * 
  */
   __pyx_t_1 = ((!(__pyx_f_11resiliparse_5parse_4html_check_node(__pyx_v_self) != 0)) != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/parse/html.pyx":553
+    /* "resiliparse/parse/html.pyx":599
  *         """
  *         if not check_node(self):
  *             return             # <<<<<<<<<<<<<<
  * 
  *         cdef lxb_dom_node_t* child = self.node.first_child
  */
     __Pyx_XDECREF(__pyx_r);
     __pyx_r = Py_None; __Pyx_INCREF(Py_None);
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":552
+    /* "resiliparse/parse/html.pyx":598
  *         :type: t.List[DOMNode]
  *         """
  *         if not check_node(self):             # <<<<<<<<<<<<<<
  *             return
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":555
+  /* "resiliparse/parse/html.pyx":601
  *             return
  * 
  *         cdef lxb_dom_node_t* child = self.node.first_child             # <<<<<<<<<<<<<<
  *         child_nodes = []
  *         while child:
  */
   __pyx_t_2 = __pyx_v_self->node->first_child;
   __pyx_v_child = __pyx_t_2;
 
-  /* "resiliparse/parse/html.pyx":556
+  /* "resiliparse/parse/html.pyx":602
  * 
  *         cdef lxb_dom_node_t* child = self.node.first_child
  *         child_nodes = []             # <<<<<<<<<<<<<<
  *         while child:
  *             child_nodes.append(_create_dom_node(self.tree, child))
  */
-  __pyx_t_3 = PyList_New(0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 556, __pyx_L1_error)
+  __pyx_t_3 = PyList_New(0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 602, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_v_child_nodes = ((PyObject*)__pyx_t_3);
   __pyx_t_3 = 0;
 
-  /* "resiliparse/parse/html.pyx":557
+  /* "resiliparse/parse/html.pyx":603
  *         cdef lxb_dom_node_t* child = self.node.first_child
  *         child_nodes = []
  *         while child:             # <<<<<<<<<<<<<<
  *             child_nodes.append(_create_dom_node(self.tree, child))
  *             child = child.next
  */
   while (1) {
     __pyx_t_1 = (__pyx_v_child != 0);
     if (!__pyx_t_1) break;
 
-    /* "resiliparse/parse/html.pyx":558
+    /* "resiliparse/parse/html.pyx":604
  *         child_nodes = []
  *         while child:
  *             child_nodes.append(_create_dom_node(self.tree, child))             # <<<<<<<<<<<<<<
  *             child = child.next
  *         return child_nodes
  */
     __pyx_t_3 = ((PyObject *)__pyx_v_self->tree);
     __Pyx_INCREF(__pyx_t_3);
-    __pyx_t_4 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html__create_dom_node(((struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *)__pyx_t_3), __pyx_v_child)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 558, __pyx_L1_error)
+    __pyx_t_4 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html__create_dom_node(((struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *)__pyx_t_3), __pyx_v_child)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 604, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_5 = __Pyx_PyList_Append(__pyx_v_child_nodes, __pyx_t_4); if (unlikely(__pyx_t_5 == ((int)-1))) __PYX_ERR(0, 558, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyList_Append(__pyx_v_child_nodes, __pyx_t_4); if (unlikely(__pyx_t_5 == ((int)-1))) __PYX_ERR(0, 604, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-    /* "resiliparse/parse/html.pyx":559
+    /* "resiliparse/parse/html.pyx":605
  *         while child:
  *             child_nodes.append(_create_dom_node(self.tree, child))
  *             child = child.next             # <<<<<<<<<<<<<<
  *         return child_nodes
  * 
  */
     __pyx_t_2 = __pyx_v_child->next;
     __pyx_v_child = __pyx_t_2;
   }
 
-  /* "resiliparse/parse/html.pyx":560
+  /* "resiliparse/parse/html.pyx":606
  *             child_nodes.append(_create_dom_node(self.tree, child))
  *             child = child.next
  *         return child_nodes             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_child_nodes);
   __pyx_r = __pyx_v_child_nodes;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":546
+  /* "resiliparse/parse/html.pyx":592
  * 
  *     @property
  *     def child_nodes(self):             # <<<<<<<<<<<<<<
  *         """
  *         List of child nodes.
  */
 
@@ -8144,15 +8740,15 @@
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_v_child_nodes);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":563
+/* "resiliparse/parse/html.pyx":609
  * 
  *     @property
  *     def parent(self):             # <<<<<<<<<<<<<<
  *         """
  *         Parent of this node.
  */
 
@@ -8176,62 +8772,62 @@
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
 
-  /* "resiliparse/parse/html.pyx":569
+  /* "resiliparse/parse/html.pyx":615
  *         :type: DOMNode or None
  *         """
  *         if not check_node(self):             # <<<<<<<<<<<<<<
  *             return None
  *         return _create_dom_node(self.tree, self.node.parent)
  */
   __pyx_t_1 = ((!(__pyx_f_11resiliparse_5parse_4html_check_node(__pyx_v_self) != 0)) != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/parse/html.pyx":570
+    /* "resiliparse/parse/html.pyx":616
  *         """
  *         if not check_node(self):
  *             return None             # <<<<<<<<<<<<<<
  *         return _create_dom_node(self.tree, self.node.parent)
  * 
  */
     __Pyx_XDECREF(__pyx_r);
     __pyx_r = Py_None; __Pyx_INCREF(Py_None);
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":569
+    /* "resiliparse/parse/html.pyx":615
  *         :type: DOMNode or None
  *         """
  *         if not check_node(self):             # <<<<<<<<<<<<<<
  *             return None
  *         return _create_dom_node(self.tree, self.node.parent)
  */
   }
 
-  /* "resiliparse/parse/html.pyx":571
+  /* "resiliparse/parse/html.pyx":617
  *         if not check_node(self):
  *             return None
  *         return _create_dom_node(self.tree, self.node.parent)             # <<<<<<<<<<<<<<
  * 
  *     # noinspection DuplicatedCode
  */
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_2 = ((PyObject *)__pyx_v_self->tree);
   __Pyx_INCREF(__pyx_t_2);
-  __pyx_t_3 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html__create_dom_node(((struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *)__pyx_t_2), __pyx_v_self->node->parent)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 571, __pyx_L1_error)
+  __pyx_t_3 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html__create_dom_node(((struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *)__pyx_t_2), __pyx_v_self->node->parent)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 617, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_r = __pyx_t_3;
   __pyx_t_3 = 0;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":563
+  /* "resiliparse/parse/html.pyx":609
  * 
  *     @property
  *     def parent(self):             # <<<<<<<<<<<<<<
  *         """
  *         Parent of this node.
  */
 
@@ -8243,15 +8839,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":575
+/* "resiliparse/parse/html.pyx":621
  *     # noinspection DuplicatedCode
  *     @property
  *     def next(self):             # <<<<<<<<<<<<<<
  *         """
  *         Next sibling node.
  */
 
@@ -8275,62 +8871,62 @@
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
 
-  /* "resiliparse/parse/html.pyx":581
+  /* "resiliparse/parse/html.pyx":627
  *         :type: DOMNode or None
  *         """
  *         if not check_node(self):             # <<<<<<<<<<<<<<
  *             return None
  *         return _create_dom_node(self.tree, self.node.next)
  */
   __pyx_t_1 = ((!(__pyx_f_11resiliparse_5parse_4html_check_node(__pyx_v_self) != 0)) != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/parse/html.pyx":582
+    /* "resiliparse/parse/html.pyx":628
  *         """
  *         if not check_node(self):
  *             return None             # <<<<<<<<<<<<<<
  *         return _create_dom_node(self.tree, self.node.next)
  * 
  */
     __Pyx_XDECREF(__pyx_r);
     __pyx_r = Py_None; __Pyx_INCREF(Py_None);
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":581
+    /* "resiliparse/parse/html.pyx":627
  *         :type: DOMNode or None
  *         """
  *         if not check_node(self):             # <<<<<<<<<<<<<<
  *             return None
  *         return _create_dom_node(self.tree, self.node.next)
  */
   }
 
-  /* "resiliparse/parse/html.pyx":583
+  /* "resiliparse/parse/html.pyx":629
  *         if not check_node(self):
  *             return None
  *         return _create_dom_node(self.tree, self.node.next)             # <<<<<<<<<<<<<<
  * 
  *     # noinspection DuplicatedCode
  */
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_2 = ((PyObject *)__pyx_v_self->tree);
   __Pyx_INCREF(__pyx_t_2);
-  __pyx_t_3 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html__create_dom_node(((struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *)__pyx_t_2), __pyx_v_self->node->next)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 583, __pyx_L1_error)
+  __pyx_t_3 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html__create_dom_node(((struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *)__pyx_t_2), __pyx_v_self->node->next)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 629, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_r = __pyx_t_3;
   __pyx_t_3 = 0;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":575
+  /* "resiliparse/parse/html.pyx":621
  *     # noinspection DuplicatedCode
  *     @property
  *     def next(self):             # <<<<<<<<<<<<<<
  *         """
  *         Next sibling node.
  */
 
@@ -8342,15 +8938,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":587
+/* "resiliparse/parse/html.pyx":633
  *     # noinspection DuplicatedCode
  *     @property
  *     def prev(self):             # <<<<<<<<<<<<<<
  *         """
  *         Previous sibling node.
  */
 
@@ -8374,62 +8970,62 @@
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
 
-  /* "resiliparse/parse/html.pyx":593
+  /* "resiliparse/parse/html.pyx":639
  *         :type: DOMNode or None
  *         """
  *         if not check_node(self):             # <<<<<<<<<<<<<<
  *             return None
  *         return _create_dom_node(self.tree, self.node.prev)
  */
   __pyx_t_1 = ((!(__pyx_f_11resiliparse_5parse_4html_check_node(__pyx_v_self) != 0)) != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/parse/html.pyx":594
+    /* "resiliparse/parse/html.pyx":640
  *         """
  *         if not check_node(self):
  *             return None             # <<<<<<<<<<<<<<
  *         return _create_dom_node(self.tree, self.node.prev)
  * 
  */
     __Pyx_XDECREF(__pyx_r);
     __pyx_r = Py_None; __Pyx_INCREF(Py_None);
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":593
+    /* "resiliparse/parse/html.pyx":639
  *         :type: DOMNode or None
  *         """
  *         if not check_node(self):             # <<<<<<<<<<<<<<
  *             return None
  *         return _create_dom_node(self.tree, self.node.prev)
  */
   }
 
-  /* "resiliparse/parse/html.pyx":595
+  /* "resiliparse/parse/html.pyx":641
  *         if not check_node(self):
  *             return None
  *         return _create_dom_node(self.tree, self.node.prev)             # <<<<<<<<<<<<<<
  * 
  *     # noinspection DuplicatedCode
  */
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_2 = ((PyObject *)__pyx_v_self->tree);
   __Pyx_INCREF(__pyx_t_2);
-  __pyx_t_3 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html__create_dom_node(((struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *)__pyx_t_2), __pyx_v_self->node->prev)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 595, __pyx_L1_error)
+  __pyx_t_3 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html__create_dom_node(((struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *)__pyx_t_2), __pyx_v_self->node->prev)); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 641, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_r = __pyx_t_3;
   __pyx_t_3 = 0;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":587
+  /* "resiliparse/parse/html.pyx":633
  *     # noinspection DuplicatedCode
  *     @property
  *     def prev(self):             # <<<<<<<<<<<<<<
  *         """
  *         Previous sibling node.
  */
 
@@ -8441,15 +9037,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":599
+/* "resiliparse/parse/html.pyx":645
  *     # noinspection DuplicatedCode
  *     @property
  *     def next_element(self):             # <<<<<<<<<<<<<<
  *         """
  *         Next sibling element node.
  */
 
@@ -8476,55 +9072,55 @@
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
 
-  /* "resiliparse/parse/html.pyx":605
+  /* "resiliparse/parse/html.pyx":651
  *         :type: DOMNode or None
  *         """
  *         if not check_node(self):             # <<<<<<<<<<<<<<
  *             return None
  * 
  */
   __pyx_t_1 = ((!(__pyx_f_11resiliparse_5parse_4html_check_node(__pyx_v_self) != 0)) != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/parse/html.pyx":606
+    /* "resiliparse/parse/html.pyx":652
  *         """
  *         if not check_node(self):
  *             return None             # <<<<<<<<<<<<<<
  * 
  *         cdef lxb_dom_node_t* next_node = self.node.next
  */
     __Pyx_XDECREF(__pyx_r);
     __pyx_r = Py_None; __Pyx_INCREF(Py_None);
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":605
+    /* "resiliparse/parse/html.pyx":651
  *         :type: DOMNode or None
  *         """
  *         if not check_node(self):             # <<<<<<<<<<<<<<
  *             return None
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":608
+  /* "resiliparse/parse/html.pyx":654
  *             return None
  * 
  *         cdef lxb_dom_node_t* next_node = self.node.next             # <<<<<<<<<<<<<<
  *         while next_node and next_node.type != LXB_DOM_NODE_TYPE_ELEMENT:
  *             next_node = next_node.next
  */
   __pyx_t_2 = __pyx_v_self->node->next;
   __pyx_v_next_node = __pyx_t_2;
 
-  /* "resiliparse/parse/html.pyx":609
+  /* "resiliparse/parse/html.pyx":655
  * 
  *         cdef lxb_dom_node_t* next_node = self.node.next
  *         while next_node and next_node.type != LXB_DOM_NODE_TYPE_ELEMENT:             # <<<<<<<<<<<<<<
  *             next_node = next_node.next
  *         return _create_dom_node(self.tree, next_node)
  */
   while (1) {
@@ -8535,43 +9131,43 @@
       goto __pyx_L6_bool_binop_done;
     }
     __pyx_t_3 = ((__pyx_v_next_node->type != LXB_DOM_NODE_TYPE_ELEMENT) != 0);
     __pyx_t_1 = __pyx_t_3;
     __pyx_L6_bool_binop_done:;
     if (!__pyx_t_1) break;
 
-    /* "resiliparse/parse/html.pyx":610
+    /* "resiliparse/parse/html.pyx":656
  *         cdef lxb_dom_node_t* next_node = self.node.next
  *         while next_node and next_node.type != LXB_DOM_NODE_TYPE_ELEMENT:
  *             next_node = next_node.next             # <<<<<<<<<<<<<<
  *         return _create_dom_node(self.tree, next_node)
  * 
  */
     __pyx_t_2 = __pyx_v_next_node->next;
     __pyx_v_next_node = __pyx_t_2;
   }
 
-  /* "resiliparse/parse/html.pyx":611
+  /* "resiliparse/parse/html.pyx":657
  *         while next_node and next_node.type != LXB_DOM_NODE_TYPE_ELEMENT:
  *             next_node = next_node.next
  *         return _create_dom_node(self.tree, next_node)             # <<<<<<<<<<<<<<
  * 
  *     # noinspection DuplicatedCode
  */
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_4 = ((PyObject *)__pyx_v_self->tree);
   __Pyx_INCREF(__pyx_t_4);
-  __pyx_t_5 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html__create_dom_node(((struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *)__pyx_t_4), __pyx_v_next_node)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 611, __pyx_L1_error)
+  __pyx_t_5 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html__create_dom_node(((struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *)__pyx_t_4), __pyx_v_next_node)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 657, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_r = __pyx_t_5;
   __pyx_t_5 = 0;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":599
+  /* "resiliparse/parse/html.pyx":645
  *     # noinspection DuplicatedCode
  *     @property
  *     def next_element(self):             # <<<<<<<<<<<<<<
  *         """
  *         Next sibling element node.
  */
 
@@ -8583,15 +9179,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":615
+/* "resiliparse/parse/html.pyx":661
  *     # noinspection DuplicatedCode
  *     @property
  *     def prev_element(self):             # <<<<<<<<<<<<<<
  *         """
  *         Previous sibling element node.
  */
 
@@ -8618,55 +9214,55 @@
   PyObject *__pyx_t_4 = NULL;
   PyObject *__pyx_t_5 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
 
-  /* "resiliparse/parse/html.pyx":621
+  /* "resiliparse/parse/html.pyx":667
  *         :type: DOMNode or None
  *         """
  *         if not check_node(self):             # <<<<<<<<<<<<<<
  *             return None
  * 
  */
   __pyx_t_1 = ((!(__pyx_f_11resiliparse_5parse_4html_check_node(__pyx_v_self) != 0)) != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/parse/html.pyx":622
+    /* "resiliparse/parse/html.pyx":668
  *         """
  *         if not check_node(self):
  *             return None             # <<<<<<<<<<<<<<
  * 
  *         cdef lxb_dom_node_t* prev_node = self.node.prev
  */
     __Pyx_XDECREF(__pyx_r);
     __pyx_r = Py_None; __Pyx_INCREF(Py_None);
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":621
+    /* "resiliparse/parse/html.pyx":667
  *         :type: DOMNode or None
  *         """
  *         if not check_node(self):             # <<<<<<<<<<<<<<
  *             return None
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":624
+  /* "resiliparse/parse/html.pyx":670
  *             return None
  * 
  *         cdef lxb_dom_node_t* prev_node = self.node.prev             # <<<<<<<<<<<<<<
  *         while prev_node and prev_node.type != LXB_DOM_NODE_TYPE_ELEMENT:
  *             prev_node = prev_node.prev
  */
   __pyx_t_2 = __pyx_v_self->node->prev;
   __pyx_v_prev_node = __pyx_t_2;
 
-  /* "resiliparse/parse/html.pyx":625
+  /* "resiliparse/parse/html.pyx":671
  * 
  *         cdef lxb_dom_node_t* prev_node = self.node.prev
  *         while prev_node and prev_node.type != LXB_DOM_NODE_TYPE_ELEMENT:             # <<<<<<<<<<<<<<
  *             prev_node = prev_node.prev
  *         return _create_dom_node(self.tree, prev_node)
  */
   while (1) {
@@ -8677,43 +9273,43 @@
       goto __pyx_L6_bool_binop_done;
     }
     __pyx_t_3 = ((__pyx_v_prev_node->type != LXB_DOM_NODE_TYPE_ELEMENT) != 0);
     __pyx_t_1 = __pyx_t_3;
     __pyx_L6_bool_binop_done:;
     if (!__pyx_t_1) break;
 
-    /* "resiliparse/parse/html.pyx":626
+    /* "resiliparse/parse/html.pyx":672
  *         cdef lxb_dom_node_t* prev_node = self.node.prev
  *         while prev_node and prev_node.type != LXB_DOM_NODE_TYPE_ELEMENT:
  *             prev_node = prev_node.prev             # <<<<<<<<<<<<<<
  *         return _create_dom_node(self.tree, prev_node)
  * 
  */
     __pyx_t_2 = __pyx_v_prev_node->prev;
     __pyx_v_prev_node = __pyx_t_2;
   }
 
-  /* "resiliparse/parse/html.pyx":627
+  /* "resiliparse/parse/html.pyx":673
  *         while prev_node and prev_node.type != LXB_DOM_NODE_TYPE_ELEMENT:
  *             prev_node = prev_node.prev
  *         return _create_dom_node(self.tree, prev_node)             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_4 = ((PyObject *)__pyx_v_self->tree);
   __Pyx_INCREF(__pyx_t_4);
-  __pyx_t_5 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html__create_dom_node(((struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *)__pyx_t_4), __pyx_v_prev_node)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 627, __pyx_L1_error)
+  __pyx_t_5 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html__create_dom_node(((struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *)__pyx_t_4), __pyx_v_prev_node)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 673, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_r = __pyx_t_5;
   __pyx_t_5 = 0;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":615
+  /* "resiliparse/parse/html.pyx":661
  *     # noinspection DuplicatedCode
  *     @property
  *     def prev_element(self):             # <<<<<<<<<<<<<<
  *         """
  *         Previous sibling element node.
  */
 
@@ -8725,15 +9321,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":630
+/* "resiliparse/parse/html.pyx":676
  * 
  *     @property
  *     def value(self):             # <<<<<<<<<<<<<<
  *         """
  *         Node text value.
  */
 
@@ -8758,35 +9354,35 @@
   int __pyx_t_2;
   PyObject *__pyx_t_3 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
 
-  /* "resiliparse/parse/html.pyx":636
+  /* "resiliparse/parse/html.pyx":682
  *         :type: str or None
  *         """
  *         if self.node.type not in [LXB_DOM_NODE_TYPE_TEXT,             # <<<<<<<<<<<<<<
  *                                   LXB_DOM_NODE_TYPE_PROCESSING_INSTRUCTION,
  *                                   LXB_DOM_NODE_TYPE_COMMENT]:
  */
   switch (__pyx_v_self->node->type) {
     case LXB_DOM_NODE_TYPE_TEXT:
     case LXB_DOM_NODE_TYPE_PROCESSING_INSTRUCTION:
 
-    /* "resiliparse/parse/html.pyx":637
+    /* "resiliparse/parse/html.pyx":683
  *         """
  *         if self.node.type not in [LXB_DOM_NODE_TYPE_TEXT,
  *                                   LXB_DOM_NODE_TYPE_PROCESSING_INSTRUCTION,             # <<<<<<<<<<<<<<
  *                                   LXB_DOM_NODE_TYPE_COMMENT]:
  *             return None
  */
     case LXB_DOM_NODE_TYPE_COMMENT:
 
-    /* "resiliparse/parse/html.pyx":636
+    /* "resiliparse/parse/html.pyx":682
  *         :type: str or None
  *         """
  *         if self.node.type not in [LXB_DOM_NODE_TYPE_TEXT,             # <<<<<<<<<<<<<<
  *                                   LXB_DOM_NODE_TYPE_PROCESSING_INSTRUCTION,
  *                                   LXB_DOM_NODE_TYPE_COMMENT]:
  */
     __pyx_t_1 = 0;
@@ -8794,58 +9390,58 @@
     default:
     __pyx_t_1 = 1;
     break;
   }
   __pyx_t_2 = (__pyx_t_1 != 0);
   if (__pyx_t_2) {
 
-    /* "resiliparse/parse/html.pyx":639
+    /* "resiliparse/parse/html.pyx":685
  *                                   LXB_DOM_NODE_TYPE_PROCESSING_INSTRUCTION,
  *                                   LXB_DOM_NODE_TYPE_COMMENT]:
  *             return None             # <<<<<<<<<<<<<<
  * 
  *         cdef lxb_dom_character_data_t* cd = <lxb_dom_character_data_t*>self.node
  */
     __Pyx_XDECREF(__pyx_r);
     __pyx_r = Py_None; __Pyx_INCREF(Py_None);
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":636
+    /* "resiliparse/parse/html.pyx":682
  *         :type: str or None
  *         """
  *         if self.node.type not in [LXB_DOM_NODE_TYPE_TEXT,             # <<<<<<<<<<<<<<
  *                                   LXB_DOM_NODE_TYPE_PROCESSING_INSTRUCTION,
  *                                   LXB_DOM_NODE_TYPE_COMMENT]:
  */
   }
 
-  /* "resiliparse/parse/html.pyx":641
+  /* "resiliparse/parse/html.pyx":687
  *             return None
  * 
  *         cdef lxb_dom_character_data_t* cd = <lxb_dom_character_data_t*>self.node             # <<<<<<<<<<<<<<
  *         return cd.data.data[:cd.data.length].decode()
  * 
  */
   __pyx_v_cd = ((lxb_dom_character_data_t *)__pyx_v_self->node);
 
-  /* "resiliparse/parse/html.pyx":642
+  /* "resiliparse/parse/html.pyx":688
  * 
  *         cdef lxb_dom_character_data_t* cd = <lxb_dom_character_data_t*>self.node
  *         return cd.data.data[:cd.data.length].decode()             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_3 = __Pyx_decode_c_string(((char const *)__pyx_v_cd->data.data), 0, __pyx_v_cd->data.length, NULL, NULL, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 642, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_decode_c_string(((char const *)__pyx_v_cd->data.data), 0, __pyx_v_cd->data.length, NULL, NULL, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 688, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_r = __pyx_t_3;
   __pyx_t_3 = 0;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":630
+  /* "resiliparse/parse/html.pyx":676
  * 
  *     @property
  *     def value(self):             # <<<<<<<<<<<<<<
  *         """
  *         Node text value.
  */
 
@@ -8856,15 +9452,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":645
+/* "resiliparse/parse/html.pyx":691
  * 
  *     @property
  *     def text(self):             # <<<<<<<<<<<<<<
  *         """
  *         Text contents of this DOM node and its children.
  */
 
@@ -8887,59 +9483,59 @@
   int __pyx_t_1;
   PyObject *__pyx_t_2 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
 
-  /* "resiliparse/parse/html.pyx":653
+  /* "resiliparse/parse/html.pyx":699
  *         :type: str
  *         """
  *         if not check_node(self):             # <<<<<<<<<<<<<<
  *             return None
  * 
  */
   __pyx_t_1 = ((!(__pyx_f_11resiliparse_5parse_4html_check_node(__pyx_v_self) != 0)) != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/parse/html.pyx":654
+    /* "resiliparse/parse/html.pyx":700
  *         """
  *         if not check_node(self):
  *             return None             # <<<<<<<<<<<<<<
  * 
  *         return get_node_text(self.node).decode()
  */
     __Pyx_XDECREF(__pyx_r);
     __pyx_r = Py_None; __Pyx_INCREF(Py_None);
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":653
+    /* "resiliparse/parse/html.pyx":699
  *         :type: str
  *         """
  *         if not check_node(self):             # <<<<<<<<<<<<<<
  *             return None
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":656
+  /* "resiliparse/parse/html.pyx":702
  *             return None
  * 
  *         return get_node_text(self.node).decode()             # <<<<<<<<<<<<<<
  * 
  *     @text.setter
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_2 = __Pyx_decode_cpp_string(__pyx_f_11resiliparse_5parse_4html_get_node_text(__pyx_v_self->node), 0, PY_SSIZE_T_MAX, NULL, NULL, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 656, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_decode_cpp_string(__pyx_f_11resiliparse_5parse_4html_get_node_text(__pyx_v_self->node), 0, PY_SSIZE_T_MAX, NULL, NULL, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 702, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_r = __pyx_t_2;
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":645
+  /* "resiliparse/parse/html.pyx":691
  * 
  *     @property
  *     def text(self):             # <<<<<<<<<<<<<<
  *         """
  *         Text contents of this DOM node and its children.
  */
 
@@ -8950,15 +9546,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":659
+/* "resiliparse/parse/html.pyx":705
  * 
  *     @text.setter
  *     def text(self, str text):             # <<<<<<<<<<<<<<
  *         if not check_node(self):
  *             raise RuntimeError('Trying to set text contents of uninitialized DOM node')
  */
 
@@ -8967,15 +9563,15 @@
 static int __pyx_pw_11resiliparse_5parse_4html_7DOMNode_4text_3__set__(PyObject *__pyx_v_self, PyObject *__pyx_v_text) {
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__set__ (wrapper)", 0);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_text), (&PyUnicode_Type), 1, "text", 1))) __PYX_ERR(0, 659, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_text), (&PyUnicode_Type), 1, "text", 1))) __PYX_ERR(0, 705, __pyx_L1_error)
   __pyx_r = __pyx_pf_11resiliparse_5parse_4html_7DOMNode_4text_2__set__(((struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *)__pyx_v_self), ((PyObject*)__pyx_v_text));
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = -1;
   __pyx_L0:;
@@ -8992,82 +9588,82 @@
   lxb_char_t *__pyx_t_3;
   Py_ssize_t __pyx_t_4;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__set__", 0);
 
-  /* "resiliparse/parse/html.pyx":660
+  /* "resiliparse/parse/html.pyx":706
  *     @text.setter
  *     def text(self, str text):
  *         if not check_node(self):             # <<<<<<<<<<<<<<
  *             raise RuntimeError('Trying to set text contents of uninitialized DOM node')
  * 
  */
   __pyx_t_1 = ((!(__pyx_f_11resiliparse_5parse_4html_check_node(__pyx_v_self) != 0)) != 0);
   if (unlikely(__pyx_t_1)) {
 
-    /* "resiliparse/parse/html.pyx":661
+    /* "resiliparse/parse/html.pyx":707
  *     def text(self, str text):
  *         if not check_node(self):
  *             raise RuntimeError('Trying to set text contents of uninitialized DOM node')             # <<<<<<<<<<<<<<
  * 
  *         cdef bytes text_bytes = text.encode()
  */
-    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_RuntimeError, __pyx_tuple__6, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 661, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_RuntimeError, __pyx_tuple__9, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 707, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_Raise(__pyx_t_2, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __PYX_ERR(0, 661, __pyx_L1_error)
+    __PYX_ERR(0, 707, __pyx_L1_error)
 
-    /* "resiliparse/parse/html.pyx":660
+    /* "resiliparse/parse/html.pyx":706
  *     @text.setter
  *     def text(self, str text):
  *         if not check_node(self):             # <<<<<<<<<<<<<<
  *             raise RuntimeError('Trying to set text contents of uninitialized DOM node')
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":663
+  /* "resiliparse/parse/html.pyx":709
  *             raise RuntimeError('Trying to set text contents of uninitialized DOM node')
  * 
  *         cdef bytes text_bytes = text.encode()             # <<<<<<<<<<<<<<
  *         lxb_dom_node_text_content_set(self.node, <lxb_char_t*>text_bytes, len(text_bytes))
  * 
  */
   if (unlikely(__pyx_v_text == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "encode");
-    __PYX_ERR(0, 663, __pyx_L1_error)
+    __PYX_ERR(0, 709, __pyx_L1_error)
   }
-  __pyx_t_2 = PyUnicode_AsEncodedString(__pyx_v_text, NULL, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 663, __pyx_L1_error)
+  __pyx_t_2 = PyUnicode_AsEncodedString(__pyx_v_text, NULL, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 709, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_v_text_bytes = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "resiliparse/parse/html.pyx":664
+  /* "resiliparse/parse/html.pyx":710
  * 
  *         cdef bytes text_bytes = text.encode()
  *         lxb_dom_node_text_content_set(self.node, <lxb_char_t*>text_bytes, len(text_bytes))             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
   if (unlikely(__pyx_v_text_bytes == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "expected bytes, NoneType found");
-    __PYX_ERR(0, 664, __pyx_L1_error)
+    __PYX_ERR(0, 710, __pyx_L1_error)
   }
-  __pyx_t_3 = __Pyx_PyBytes_AsWritableUString(__pyx_v_text_bytes); if (unlikely((!__pyx_t_3) && PyErr_Occurred())) __PYX_ERR(0, 664, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyBytes_AsWritableUString(__pyx_v_text_bytes); if (unlikely((!__pyx_t_3) && PyErr_Occurred())) __PYX_ERR(0, 710, __pyx_L1_error)
   if (unlikely(__pyx_v_text_bytes == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-    __PYX_ERR(0, 664, __pyx_L1_error)
+    __PYX_ERR(0, 710, __pyx_L1_error)
   }
-  __pyx_t_4 = PyBytes_GET_SIZE(__pyx_v_text_bytes); if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 664, __pyx_L1_error)
+  __pyx_t_4 = PyBytes_GET_SIZE(__pyx_v_text_bytes); if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 710, __pyx_L1_error)
   (void)(lxb_dom_node_text_content_set(__pyx_v_self->node, ((lxb_char_t *)__pyx_t_3), __pyx_t_4));
 
-  /* "resiliparse/parse/html.pyx":659
+  /* "resiliparse/parse/html.pyx":705
  * 
  *     @text.setter
  *     def text(self, str text):             # <<<<<<<<<<<<<<
  *         if not check_node(self):
  *             raise RuntimeError('Trying to set text contents of uninitialized DOM node')
  */
 
@@ -9080,15 +9676,15 @@
   __pyx_r = -1;
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_v_text_bytes);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":667
+/* "resiliparse/parse/html.pyx":713
  * 
  *     @property
  *     def html(self):             # <<<<<<<<<<<<<<
  *         """
  *         HTML contents of this DOM node and its children.
  */
 
@@ -9113,96 +9709,96 @@
   int __pyx_t_1;
   PyObject *__pyx_t_2 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
 
-  /* "resiliparse/parse/html.pyx":675
+  /* "resiliparse/parse/html.pyx":721
  *         :type: str
  *         """
  *         if not check_node(self):             # <<<<<<<<<<<<<<
  *             return None
  * 
  */
   __pyx_t_1 = ((!(__pyx_f_11resiliparse_5parse_4html_check_node(__pyx_v_self) != 0)) != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/parse/html.pyx":676
+    /* "resiliparse/parse/html.pyx":722
  *         """
  *         if not check_node(self):
  *             return None             # <<<<<<<<<<<<<<
  * 
  *         cdef lexbor_str_t* html_str = lexbor_str_create()
  */
     __Pyx_XDECREF(__pyx_r);
     __pyx_r = Py_None; __Pyx_INCREF(Py_None);
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":675
+    /* "resiliparse/parse/html.pyx":721
  *         :type: str
  *         """
  *         if not check_node(self):             # <<<<<<<<<<<<<<
  *             return None
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":678
+  /* "resiliparse/parse/html.pyx":724
  *             return None
  * 
  *         cdef lexbor_str_t* html_str = lexbor_str_create()             # <<<<<<<<<<<<<<
  *         lxb_html_serialize_tree_str(self.node, html_str)
  *         cdef str py_text = html_str.data[:html_str.length].decode()
  */
   __pyx_v_html_str = lexbor_str_create();
 
-  /* "resiliparse/parse/html.pyx":679
+  /* "resiliparse/parse/html.pyx":725
  * 
  *         cdef lexbor_str_t* html_str = lexbor_str_create()
  *         lxb_html_serialize_tree_str(self.node, html_str)             # <<<<<<<<<<<<<<
  *         cdef str py_text = html_str.data[:html_str.length].decode()
  *         lexbor_str_destroy(html_str, self.node.owner_document.text, True)
  */
   (void)(lxb_html_serialize_tree_str(__pyx_v_self->node, __pyx_v_html_str));
 
-  /* "resiliparse/parse/html.pyx":680
+  /* "resiliparse/parse/html.pyx":726
  *         cdef lexbor_str_t* html_str = lexbor_str_create()
  *         lxb_html_serialize_tree_str(self.node, html_str)
  *         cdef str py_text = html_str.data[:html_str.length].decode()             # <<<<<<<<<<<<<<
  *         lexbor_str_destroy(html_str, self.node.owner_document.text, True)
  *         return py_text
  */
-  __pyx_t_2 = __Pyx_decode_c_string(((char const *)__pyx_v_html_str->data), 0, __pyx_v_html_str->length, NULL, NULL, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 680, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_decode_c_string(((char const *)__pyx_v_html_str->data), 0, __pyx_v_html_str->length, NULL, NULL, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 726, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_v_py_text = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "resiliparse/parse/html.pyx":681
+  /* "resiliparse/parse/html.pyx":727
  *         lxb_html_serialize_tree_str(self.node, html_str)
  *         cdef str py_text = html_str.data[:html_str.length].decode()
  *         lexbor_str_destroy(html_str, self.node.owner_document.text, True)             # <<<<<<<<<<<<<<
  *         return py_text
  * 
  */
   (void)(lexbor_str_destroy(__pyx_v_html_str, __pyx_v_self->node->owner_document->text, 1));
 
-  /* "resiliparse/parse/html.pyx":682
+  /* "resiliparse/parse/html.pyx":728
  *         cdef str py_text = html_str.data[:html_str.length].decode()
  *         lexbor_str_destroy(html_str, self.node.owner_document.text, True)
  *         return py_text             # <<<<<<<<<<<<<<
  * 
  *     @html.setter
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_py_text);
   __pyx_r = __pyx_v_py_text;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":667
+  /* "resiliparse/parse/html.pyx":713
  * 
  *     @property
  *     def html(self):             # <<<<<<<<<<<<<<
  *         """
  *         HTML contents of this DOM node and its children.
  */
 
@@ -9214,15 +9810,15 @@
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_v_py_text);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":685
+/* "resiliparse/parse/html.pyx":731
  * 
  *     @html.setter
  *     def html(self, str html):             # <<<<<<<<<<<<<<
  *         if not check_node(self):
  *             raise RuntimeError('Trying to set HTML contents of uninitialized DOM node')
  */
 
@@ -9231,15 +9827,15 @@
 static int __pyx_pw_11resiliparse_5parse_4html_7DOMNode_4html_3__set__(PyObject *__pyx_v_self, PyObject *__pyx_v_html) {
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__set__ (wrapper)", 0);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_html), (&PyUnicode_Type), 1, "html", 1))) __PYX_ERR(0, 685, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_html), (&PyUnicode_Type), 1, "html", 1))) __PYX_ERR(0, 731, __pyx_L1_error)
   __pyx_r = __pyx_pf_11resiliparse_5parse_4html_7DOMNode_4html_2__set__(((struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *)__pyx_v_self), ((PyObject*)__pyx_v_html));
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = -1;
   __pyx_L0:;
@@ -9256,82 +9852,82 @@
   lxb_char_t *__pyx_t_3;
   Py_ssize_t __pyx_t_4;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__set__", 0);
 
-  /* "resiliparse/parse/html.pyx":686
+  /* "resiliparse/parse/html.pyx":732
  *     @html.setter
  *     def html(self, str html):
  *         if not check_node(self):             # <<<<<<<<<<<<<<
  *             raise RuntimeError('Trying to set HTML contents of uninitialized DOM node')
  * 
  */
   __pyx_t_1 = ((!(__pyx_f_11resiliparse_5parse_4html_check_node(__pyx_v_self) != 0)) != 0);
   if (unlikely(__pyx_t_1)) {
 
-    /* "resiliparse/parse/html.pyx":687
+    /* "resiliparse/parse/html.pyx":733
  *     def html(self, str html):
  *         if not check_node(self):
  *             raise RuntimeError('Trying to set HTML contents of uninitialized DOM node')             # <<<<<<<<<<<<<<
  * 
  *         cdef bytes html_bytes = html.encode()
  */
-    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_RuntimeError, __pyx_tuple__7, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 687, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_RuntimeError, __pyx_tuple__10, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 733, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_Raise(__pyx_t_2, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __PYX_ERR(0, 687, __pyx_L1_error)
+    __PYX_ERR(0, 733, __pyx_L1_error)
 
-    /* "resiliparse/parse/html.pyx":686
+    /* "resiliparse/parse/html.pyx":732
  *     @html.setter
  *     def html(self, str html):
  *         if not check_node(self):             # <<<<<<<<<<<<<<
  *             raise RuntimeError('Trying to set HTML contents of uninitialized DOM node')
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":689
+  /* "resiliparse/parse/html.pyx":735
  *             raise RuntimeError('Trying to set HTML contents of uninitialized DOM node')
  * 
  *         cdef bytes html_bytes = html.encode()             # <<<<<<<<<<<<<<
  *         lxb_html_element_inner_html_set(<lxb_html_element_t*>self.node, <lxb_char_t*>html_bytes, len(html_bytes))
  * 
  */
   if (unlikely(__pyx_v_html == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "encode");
-    __PYX_ERR(0, 689, __pyx_L1_error)
+    __PYX_ERR(0, 735, __pyx_L1_error)
   }
-  __pyx_t_2 = PyUnicode_AsEncodedString(__pyx_v_html, NULL, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 689, __pyx_L1_error)
+  __pyx_t_2 = PyUnicode_AsEncodedString(__pyx_v_html, NULL, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 735, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_v_html_bytes = ((PyObject*)__pyx_t_2);
   __pyx_t_2 = 0;
 
-  /* "resiliparse/parse/html.pyx":690
+  /* "resiliparse/parse/html.pyx":736
  * 
  *         cdef bytes html_bytes = html.encode()
  *         lxb_html_element_inner_html_set(<lxb_html_element_t*>self.node, <lxb_char_t*>html_bytes, len(html_bytes))             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
   if (unlikely(__pyx_v_html_bytes == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "expected bytes, NoneType found");
-    __PYX_ERR(0, 690, __pyx_L1_error)
+    __PYX_ERR(0, 736, __pyx_L1_error)
   }
-  __pyx_t_3 = __Pyx_PyBytes_AsWritableUString(__pyx_v_html_bytes); if (unlikely((!__pyx_t_3) && PyErr_Occurred())) __PYX_ERR(0, 690, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyBytes_AsWritableUString(__pyx_v_html_bytes); if (unlikely((!__pyx_t_3) && PyErr_Occurred())) __PYX_ERR(0, 736, __pyx_L1_error)
   if (unlikely(__pyx_v_html_bytes == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-    __PYX_ERR(0, 690, __pyx_L1_error)
+    __PYX_ERR(0, 736, __pyx_L1_error)
   }
-  __pyx_t_4 = PyBytes_GET_SIZE(__pyx_v_html_bytes); if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 690, __pyx_L1_error)
+  __pyx_t_4 = PyBytes_GET_SIZE(__pyx_v_html_bytes); if (unlikely(__pyx_t_4 == ((Py_ssize_t)-1))) __PYX_ERR(0, 736, __pyx_L1_error)
   (void)(lxb_html_element_inner_html_set(((lxb_html_element_t *)__pyx_v_self->node), ((lxb_char_t *)__pyx_t_3), __pyx_t_4));
 
-  /* "resiliparse/parse/html.pyx":685
+  /* "resiliparse/parse/html.pyx":731
  * 
  *     @html.setter
  *     def html(self, str html):             # <<<<<<<<<<<<<<
  *         if not check_node(self):
  *             raise RuntimeError('Trying to set HTML contents of uninitialized DOM node')
  */
 
@@ -9344,15 +9940,15 @@
   __pyx_r = -1;
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_v_html_bytes);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":693
+/* "resiliparse/parse/html.pyx":739
  * 
  *     @property
  *     def id(self):             # <<<<<<<<<<<<<<
  *         """
  *         ID attribute of this Element node (empty string if unset).
  */
 
@@ -9378,15 +9974,15 @@
   int __pyx_t_2;
   PyObject *__pyx_t_3 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
 
-  /* "resiliparse/parse/html.pyx":699
+  /* "resiliparse/parse/html.pyx":745
  *         :type: str
  *         """
  *         if not check_node(self) or self.node.type != LXB_DOM_NODE_TYPE_ELEMENT:             # <<<<<<<<<<<<<<
  *             return None
  * 
  */
   __pyx_t_2 = ((!(__pyx_f_11resiliparse_5parse_4html_check_node(__pyx_v_self) != 0)) != 0);
@@ -9396,98 +9992,98 @@
     goto __pyx_L4_bool_binop_done;
   }
   __pyx_t_2 = ((__pyx_v_self->node->type != LXB_DOM_NODE_TYPE_ELEMENT) != 0);
   __pyx_t_1 = __pyx_t_2;
   __pyx_L4_bool_binop_done:;
   if (__pyx_t_1) {
 
-    /* "resiliparse/parse/html.pyx":700
+    /* "resiliparse/parse/html.pyx":746
  *         """
  *         if not check_node(self) or self.node.type != LXB_DOM_NODE_TYPE_ELEMENT:
  *             return None             # <<<<<<<<<<<<<<
  * 
  *         cdef size_t value_len = 0
  */
     __Pyx_XDECREF(__pyx_r);
     __pyx_r = Py_None; __Pyx_INCREF(Py_None);
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":699
+    /* "resiliparse/parse/html.pyx":745
  *         :type: str
  *         """
  *         if not check_node(self) or self.node.type != LXB_DOM_NODE_TYPE_ELEMENT:             # <<<<<<<<<<<<<<
  *             return None
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":702
+  /* "resiliparse/parse/html.pyx":748
  *             return None
  * 
  *         cdef size_t value_len = 0             # <<<<<<<<<<<<<<
  *         cdef const lxb_char_t* value = lxb_dom_element_id(<lxb_dom_element_t*>self.node, &value_len)
  *         if not value:
  */
   __pyx_v_value_len = 0;
 
-  /* "resiliparse/parse/html.pyx":703
+  /* "resiliparse/parse/html.pyx":749
  * 
  *         cdef size_t value_len = 0
  *         cdef const lxb_char_t* value = lxb_dom_element_id(<lxb_dom_element_t*>self.node, &value_len)             # <<<<<<<<<<<<<<
  *         if not value:
  *             return ''
  */
   __pyx_v_value = lxb_dom_element_id(((lxb_dom_element_t *)__pyx_v_self->node), (&__pyx_v_value_len));
 
-  /* "resiliparse/parse/html.pyx":704
+  /* "resiliparse/parse/html.pyx":750
  *         cdef size_t value_len = 0
  *         cdef const lxb_char_t* value = lxb_dom_element_id(<lxb_dom_element_t*>self.node, &value_len)
  *         if not value:             # <<<<<<<<<<<<<<
  *             return ''
  *         return value[:value_len].decode()
  */
   __pyx_t_1 = ((!(__pyx_v_value != 0)) != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/parse/html.pyx":705
+    /* "resiliparse/parse/html.pyx":751
  *         cdef const lxb_char_t* value = lxb_dom_element_id(<lxb_dom_element_t*>self.node, &value_len)
  *         if not value:
  *             return ''             # <<<<<<<<<<<<<<
  *         return value[:value_len].decode()
  * 
  */
     __Pyx_XDECREF(__pyx_r);
-    __Pyx_INCREF(__pyx_kp_u__2);
-    __pyx_r = __pyx_kp_u__2;
+    __Pyx_INCREF(__pyx_kp_u__5);
+    __pyx_r = __pyx_kp_u__5;
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":704
+    /* "resiliparse/parse/html.pyx":750
  *         cdef size_t value_len = 0
  *         cdef const lxb_char_t* value = lxb_dom_element_id(<lxb_dom_element_t*>self.node, &value_len)
  *         if not value:             # <<<<<<<<<<<<<<
  *             return ''
  *         return value[:value_len].decode()
  */
   }
 
-  /* "resiliparse/parse/html.pyx":706
+  /* "resiliparse/parse/html.pyx":752
  *         if not value:
  *             return ''
  *         return value[:value_len].decode()             # <<<<<<<<<<<<<<
  * 
  *     @id.setter
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_3 = __Pyx_decode_c_string(((char const *)__pyx_v_value), 0, __pyx_v_value_len, NULL, NULL, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 706, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_decode_c_string(((char const *)__pyx_v_value), 0, __pyx_v_value_len, NULL, NULL, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 752, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_r = __pyx_t_3;
   __pyx_t_3 = 0;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":693
+  /* "resiliparse/parse/html.pyx":739
  * 
  *     @property
  *     def id(self):             # <<<<<<<<<<<<<<
  *         """
  *         ID attribute of this Element node (empty string if unset).
  */
 
@@ -9498,15 +10094,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":709
+/* "resiliparse/parse/html.pyx":755
  * 
  *     @id.setter
  *     def id(self, str class_name):             # <<<<<<<<<<<<<<
  *         self._setattr_impl(b'id', class_name.encode())
  * 
  */
 
@@ -9515,15 +10111,15 @@
 static int __pyx_pw_11resiliparse_5parse_4html_7DOMNode_2id_3__set__(PyObject *__pyx_v_self, PyObject *__pyx_v_class_name) {
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__set__ (wrapper)", 0);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_class_name), (&PyUnicode_Type), 1, "class_name", 1))) __PYX_ERR(0, 709, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_class_name), (&PyUnicode_Type), 1, "class_name", 1))) __PYX_ERR(0, 755, __pyx_L1_error)
   __pyx_r = __pyx_pf_11resiliparse_5parse_4html_7DOMNode_2id_2__set__(((struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *)__pyx_v_self), ((PyObject*)__pyx_v_class_name));
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = -1;
   __pyx_L0:;
@@ -9537,31 +10133,31 @@
   PyObject *__pyx_t_1 = NULL;
   int __pyx_t_2;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__set__", 0);
 
-  /* "resiliparse/parse/html.pyx":710
+  /* "resiliparse/parse/html.pyx":756
  *     @id.setter
  *     def id(self, str class_name):
  *         self._setattr_impl(b'id', class_name.encode())             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
   if (unlikely(__pyx_v_class_name == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "encode");
-    __PYX_ERR(0, 710, __pyx_L1_error)
+    __PYX_ERR(0, 756, __pyx_L1_error)
   }
-  __pyx_t_1 = PyUnicode_AsEncodedString(__pyx_v_class_name, NULL, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 710, __pyx_L1_error)
+  __pyx_t_1 = PyUnicode_AsEncodedString(__pyx_v_class_name, NULL, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 756, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = ((struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMNode *)__pyx_v_self->__pyx_vtab)->_setattr_impl(__pyx_v_self, __pyx_n_b_id, ((PyObject*)__pyx_t_1)); if (unlikely(__pyx_t_2 == ((int)-1))) __PYX_ERR(0, 710, __pyx_L1_error)
+  __pyx_t_2 = ((struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMNode *)__pyx_v_self->__pyx_vtab)->_setattr_impl(__pyx_v_self, __pyx_n_b_id, ((PyObject*)__pyx_t_1)); if (unlikely(__pyx_t_2 == ((int)-1))) __PYX_ERR(0, 756, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "resiliparse/parse/html.pyx":709
+  /* "resiliparse/parse/html.pyx":755
  * 
  *     @id.setter
  *     def id(self, str class_name):             # <<<<<<<<<<<<<<
  *         self._setattr_impl(b'id', class_name.encode())
  * 
  */
 
@@ -9573,15 +10169,15 @@
   __Pyx_AddTraceback("resiliparse.parse.html.DOMNode.id.__set__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = -1;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":713
+/* "resiliparse/parse/html.pyx":759
  * 
  *     @property
  *     def class_name(self):             # <<<<<<<<<<<<<<
  *         """
  *         Class name attribute of this Element node (empty string if unset).
  */
 
@@ -9607,15 +10203,15 @@
   int __pyx_t_2;
   PyObject *__pyx_t_3 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
 
-  /* "resiliparse/parse/html.pyx":719
+  /* "resiliparse/parse/html.pyx":765
  *         :type: str
  *         """
  *         if not check_node(self) or self.node.type != LXB_DOM_NODE_TYPE_ELEMENT:             # <<<<<<<<<<<<<<
  *             return None
  * 
  */
   __pyx_t_2 = ((!(__pyx_f_11resiliparse_5parse_4html_check_node(__pyx_v_self) != 0)) != 0);
@@ -9625,98 +10221,98 @@
     goto __pyx_L4_bool_binop_done;
   }
   __pyx_t_2 = ((__pyx_v_self->node->type != LXB_DOM_NODE_TYPE_ELEMENT) != 0);
   __pyx_t_1 = __pyx_t_2;
   __pyx_L4_bool_binop_done:;
   if (__pyx_t_1) {
 
-    /* "resiliparse/parse/html.pyx":720
+    /* "resiliparse/parse/html.pyx":766
  *         """
  *         if not check_node(self) or self.node.type != LXB_DOM_NODE_TYPE_ELEMENT:
  *             return None             # <<<<<<<<<<<<<<
  * 
  *         cdef size_t value_len = 0
  */
     __Pyx_XDECREF(__pyx_r);
     __pyx_r = Py_None; __Pyx_INCREF(Py_None);
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":719
+    /* "resiliparse/parse/html.pyx":765
  *         :type: str
  *         """
  *         if not check_node(self) or self.node.type != LXB_DOM_NODE_TYPE_ELEMENT:             # <<<<<<<<<<<<<<
  *             return None
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":722
+  /* "resiliparse/parse/html.pyx":768
  *             return None
  * 
  *         cdef size_t value_len = 0             # <<<<<<<<<<<<<<
  *         cdef const lxb_char_t* value = lxb_dom_element_class(<lxb_dom_element_t*>self.node, &value_len)
  *         if not value:
  */
   __pyx_v_value_len = 0;
 
-  /* "resiliparse/parse/html.pyx":723
+  /* "resiliparse/parse/html.pyx":769
  * 
  *         cdef size_t value_len = 0
  *         cdef const lxb_char_t* value = lxb_dom_element_class(<lxb_dom_element_t*>self.node, &value_len)             # <<<<<<<<<<<<<<
  *         if not value:
  *             return ''
  */
   __pyx_v_value = lxb_dom_element_class(((lxb_dom_element_t *)__pyx_v_self->node), (&__pyx_v_value_len));
 
-  /* "resiliparse/parse/html.pyx":724
+  /* "resiliparse/parse/html.pyx":770
  *         cdef size_t value_len = 0
  *         cdef const lxb_char_t* value = lxb_dom_element_class(<lxb_dom_element_t*>self.node, &value_len)
  *         if not value:             # <<<<<<<<<<<<<<
  *             return ''
  *         return value[:value_len].decode()
  */
   __pyx_t_1 = ((!(__pyx_v_value != 0)) != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/parse/html.pyx":725
+    /* "resiliparse/parse/html.pyx":771
  *         cdef const lxb_char_t* value = lxb_dom_element_class(<lxb_dom_element_t*>self.node, &value_len)
  *         if not value:
  *             return ''             # <<<<<<<<<<<<<<
  *         return value[:value_len].decode()
  * 
  */
     __Pyx_XDECREF(__pyx_r);
-    __Pyx_INCREF(__pyx_kp_u__2);
-    __pyx_r = __pyx_kp_u__2;
+    __Pyx_INCREF(__pyx_kp_u__5);
+    __pyx_r = __pyx_kp_u__5;
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":724
+    /* "resiliparse/parse/html.pyx":770
  *         cdef size_t value_len = 0
  *         cdef const lxb_char_t* value = lxb_dom_element_class(<lxb_dom_element_t*>self.node, &value_len)
  *         if not value:             # <<<<<<<<<<<<<<
  *             return ''
  *         return value[:value_len].decode()
  */
   }
 
-  /* "resiliparse/parse/html.pyx":726
+  /* "resiliparse/parse/html.pyx":772
  *         if not value:
  *             return ''
  *         return value[:value_len].decode()             # <<<<<<<<<<<<<<
  * 
  *     @class_name.setter
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_3 = __Pyx_decode_c_string(((char const *)__pyx_v_value), 0, __pyx_v_value_len, NULL, NULL, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 726, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_decode_c_string(((char const *)__pyx_v_value), 0, __pyx_v_value_len, NULL, NULL, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 772, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_r = __pyx_t_3;
   __pyx_t_3 = 0;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":713
+  /* "resiliparse/parse/html.pyx":759
  * 
  *     @property
  *     def class_name(self):             # <<<<<<<<<<<<<<
  *         """
  *         Class name attribute of this Element node (empty string if unset).
  */
 
@@ -9727,15 +10323,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":729
+/* "resiliparse/parse/html.pyx":775
  * 
  *     @class_name.setter
  *     def class_name(self, str class_name):             # <<<<<<<<<<<<<<
  *         self._setattr_impl(b'class', class_name.encode())
  * 
  */
 
@@ -9744,15 +10340,15 @@
 static int __pyx_pw_11resiliparse_5parse_4html_7DOMNode_10class_name_3__set__(PyObject *__pyx_v_self, PyObject *__pyx_v_class_name) {
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__set__ (wrapper)", 0);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_class_name), (&PyUnicode_Type), 1, "class_name", 1))) __PYX_ERR(0, 729, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_class_name), (&PyUnicode_Type), 1, "class_name", 1))) __PYX_ERR(0, 775, __pyx_L1_error)
   __pyx_r = __pyx_pf_11resiliparse_5parse_4html_7DOMNode_10class_name_2__set__(((struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *)__pyx_v_self), ((PyObject*)__pyx_v_class_name));
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = -1;
   __pyx_L0:;
@@ -9766,31 +10362,31 @@
   PyObject *__pyx_t_1 = NULL;
   int __pyx_t_2;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__set__", 0);
 
-  /* "resiliparse/parse/html.pyx":730
+  /* "resiliparse/parse/html.pyx":776
  *     @class_name.setter
  *     def class_name(self, str class_name):
  *         self._setattr_impl(b'class', class_name.encode())             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
   if (unlikely(__pyx_v_class_name == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "encode");
-    __PYX_ERR(0, 730, __pyx_L1_error)
+    __PYX_ERR(0, 776, __pyx_L1_error)
   }
-  __pyx_t_1 = PyUnicode_AsEncodedString(__pyx_v_class_name, NULL, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 730, __pyx_L1_error)
+  __pyx_t_1 = PyUnicode_AsEncodedString(__pyx_v_class_name, NULL, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 776, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = ((struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMNode *)__pyx_v_self->__pyx_vtab)->_setattr_impl(__pyx_v_self, __pyx_n_b_class, ((PyObject*)__pyx_t_1)); if (unlikely(__pyx_t_2 == ((int)-1))) __PYX_ERR(0, 730, __pyx_L1_error)
+  __pyx_t_2 = ((struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMNode *)__pyx_v_self->__pyx_vtab)->_setattr_impl(__pyx_v_self, __pyx_n_b_class, ((PyObject*)__pyx_t_1)); if (unlikely(__pyx_t_2 == ((int)-1))) __PYX_ERR(0, 776, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "resiliparse/parse/html.pyx":729
+  /* "resiliparse/parse/html.pyx":775
  * 
  *     @class_name.setter
  *     def class_name(self, str class_name):             # <<<<<<<<<<<<<<
  *         self._setattr_impl(b'class', class_name.encode())
  * 
  */
 
@@ -9802,15 +10398,15 @@
   __Pyx_AddTraceback("resiliparse.parse.html.DOMNode.class_name.__set__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = -1;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":733
+/* "resiliparse/parse/html.pyx":779
  * 
  *     @property
  *     def class_list(self):             # <<<<<<<<<<<<<<
  *         """
  *         List of class names set on this Element node.
  */
 
@@ -9835,15 +10431,15 @@
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
 
-  /* "resiliparse/parse/html.pyx":739
+  /* "resiliparse/parse/html.pyx":785
  *         :type: DOMElementClassList
  *         """
  *         if not check_node(self) or self.node.type != LXB_DOM_NODE_TYPE_ELEMENT:             # <<<<<<<<<<<<<<
  *             return None
  * 
  */
   __pyx_t_2 = ((!(__pyx_f_11resiliparse_5parse_4html_check_node(__pyx_v_self) != 0)) != 0);
@@ -9853,88 +10449,88 @@
     goto __pyx_L4_bool_binop_done;
   }
   __pyx_t_2 = ((__pyx_v_self->node->type != LXB_DOM_NODE_TYPE_ELEMENT) != 0);
   __pyx_t_1 = __pyx_t_2;
   __pyx_L4_bool_binop_done:;
   if (__pyx_t_1) {
 
-    /* "resiliparse/parse/html.pyx":740
+    /* "resiliparse/parse/html.pyx":786
  *         """
  *         if not check_node(self) or self.node.type != LXB_DOM_NODE_TYPE_ELEMENT:
  *             return None             # <<<<<<<<<<<<<<
  * 
  *         if self.class_list_singleton is None:
  */
     __Pyx_XDECREF(__pyx_r);
     __pyx_r = Py_None; __Pyx_INCREF(Py_None);
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":739
+    /* "resiliparse/parse/html.pyx":785
  *         :type: DOMElementClassList
  *         """
  *         if not check_node(self) or self.node.type != LXB_DOM_NODE_TYPE_ELEMENT:             # <<<<<<<<<<<<<<
  *             return None
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":742
+  /* "resiliparse/parse/html.pyx":788
  *             return None
  * 
  *         if self.class_list_singleton is None:             # <<<<<<<<<<<<<<
  *             # noinspection PyAttributeOutsideInit
  *             self.class_list_singleton = DOMElementClassList.__new__(DOMElementClassList, self)
  */
   __pyx_t_1 = (((PyObject *)__pyx_v_self->class_list_singleton) == Py_None);
   __pyx_t_2 = (__pyx_t_1 != 0);
   if (__pyx_t_2) {
 
-    /* "resiliparse/parse/html.pyx":744
+    /* "resiliparse/parse/html.pyx":790
  *         if self.class_list_singleton is None:
  *             # noinspection PyAttributeOutsideInit
  *             self.class_list_singleton = DOMElementClassList.__new__(DOMElementClassList, self)             # <<<<<<<<<<<<<<
  *         return self.class_list_singleton
  * 
  */
-    __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 744, __pyx_L1_error)
+    __pyx_t_3 = PyTuple_New(1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 790, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_INCREF(((PyObject *)__pyx_v_self));
     __Pyx_GIVEREF(((PyObject *)__pyx_v_self));
     PyTuple_SET_ITEM(__pyx_t_3, 0, ((PyObject *)__pyx_v_self));
-    __pyx_t_4 = ((PyObject *)__pyx_tp_new_11resiliparse_5parse_4html_DOMElementClassList(((PyTypeObject *)__pyx_ptype_11resiliparse_5parse_4html_DOMElementClassList), __pyx_t_3, NULL)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 744, __pyx_L1_error)
+    __pyx_t_4 = ((PyObject *)__pyx_tp_new_11resiliparse_5parse_4html_DOMElementClassList(((PyTypeObject *)__pyx_ptype_11resiliparse_5parse_4html_DOMElementClassList), __pyx_t_3, NULL)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 790, __pyx_L1_error)
     __Pyx_GOTREF(((PyObject *)__pyx_t_4));
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_GIVEREF(((PyObject *)__pyx_t_4));
     __Pyx_GOTREF(__pyx_v_self->class_list_singleton);
     __Pyx_DECREF(((PyObject *)__pyx_v_self->class_list_singleton));
     __pyx_v_self->class_list_singleton = ((struct __pyx_obj_11resiliparse_5parse_4html_DOMElementClassList *)__pyx_t_4);
     __pyx_t_4 = 0;
 
-    /* "resiliparse/parse/html.pyx":742
+    /* "resiliparse/parse/html.pyx":788
  *             return None
  * 
  *         if self.class_list_singleton is None:             # <<<<<<<<<<<<<<
  *             # noinspection PyAttributeOutsideInit
  *             self.class_list_singleton = DOMElementClassList.__new__(DOMElementClassList, self)
  */
   }
 
-  /* "resiliparse/parse/html.pyx":745
+  /* "resiliparse/parse/html.pyx":791
  *             # noinspection PyAttributeOutsideInit
  *             self.class_list_singleton = DOMElementClassList.__new__(DOMElementClassList, self)
  *         return self.class_list_singleton             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(((PyObject *)__pyx_v_self->class_list_singleton));
   __pyx_r = ((PyObject *)__pyx_v_self->class_list_singleton);
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":733
+  /* "resiliparse/parse/html.pyx":779
  * 
  *     @property
  *     def class_list(self):             # <<<<<<<<<<<<<<
  *         """
  *         List of class names set on this Element node.
  */
 
@@ -9946,15 +10542,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":748
+/* "resiliparse/parse/html.pyx":794
  * 
  *     @property
  *     def attrs(self):             # <<<<<<<<<<<<<<
  *         """
  *         List of attribute names if node is an Element node.
  */
 
@@ -9984,15 +10580,15 @@
   int __pyx_t_4;
   lxb_dom_attr_t *__pyx_t_5;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
 
-  /* "resiliparse/parse/html.pyx":754
+  /* "resiliparse/parse/html.pyx":800
  *         :type: t.List[str] or None
  *         """
  *         if not check_node(self) or self.node.type != LXB_DOM_NODE_TYPE_ELEMENT:             # <<<<<<<<<<<<<<
  *             return None
  * 
  */
   __pyx_t_2 = ((!(__pyx_f_11resiliparse_5parse_4html_check_node(__pyx_v_self) != 0)) != 0);
@@ -10002,120 +10598,120 @@
     goto __pyx_L4_bool_binop_done;
   }
   __pyx_t_2 = ((__pyx_v_self->node->type != LXB_DOM_NODE_TYPE_ELEMENT) != 0);
   __pyx_t_1 = __pyx_t_2;
   __pyx_L4_bool_binop_done:;
   if (__pyx_t_1) {
 
-    /* "resiliparse/parse/html.pyx":755
+    /* "resiliparse/parse/html.pyx":801
  *         """
  *         if not check_node(self) or self.node.type != LXB_DOM_NODE_TYPE_ELEMENT:
  *             return None             # <<<<<<<<<<<<<<
  * 
  *         cdef lxb_dom_attr_t* attr = lxb_dom_element_first_attribute(<lxb_dom_element_t*>self.node)
  */
     __Pyx_XDECREF(__pyx_r);
     __pyx_r = Py_None; __Pyx_INCREF(Py_None);
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":754
+    /* "resiliparse/parse/html.pyx":800
  *         :type: t.List[str] or None
  *         """
  *         if not check_node(self) or self.node.type != LXB_DOM_NODE_TYPE_ELEMENT:             # <<<<<<<<<<<<<<
  *             return None
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":757
+  /* "resiliparse/parse/html.pyx":803
  *             return None
  * 
  *         cdef lxb_dom_attr_t* attr = lxb_dom_element_first_attribute(<lxb_dom_element_t*>self.node)             # <<<<<<<<<<<<<<
  *         cdef const lxb_char_t* local_name
  *         cdef size_t local_name_len = 0
  */
   __pyx_v_attr = lxb_dom_element_first_attribute(((lxb_dom_element_t *)__pyx_v_self->node));
 
-  /* "resiliparse/parse/html.pyx":759
+  /* "resiliparse/parse/html.pyx":805
  *         cdef lxb_dom_attr_t* attr = lxb_dom_element_first_attribute(<lxb_dom_element_t*>self.node)
  *         cdef const lxb_char_t* local_name
  *         cdef size_t local_name_len = 0             # <<<<<<<<<<<<<<
  * 
  *         attrs = []
  */
   __pyx_v_local_name_len = 0;
 
-  /* "resiliparse/parse/html.pyx":761
+  /* "resiliparse/parse/html.pyx":807
  *         cdef size_t local_name_len = 0
  * 
  *         attrs = []             # <<<<<<<<<<<<<<
  *         while attr:
  *             local_name = lxb_dom_attr_local_name(attr, &local_name_len)
  */
-  __pyx_t_3 = PyList_New(0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 761, __pyx_L1_error)
+  __pyx_t_3 = PyList_New(0); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 807, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_v_attrs = ((PyObject*)__pyx_t_3);
   __pyx_t_3 = 0;
 
-  /* "resiliparse/parse/html.pyx":762
+  /* "resiliparse/parse/html.pyx":808
  * 
  *         attrs = []
  *         while attr:             # <<<<<<<<<<<<<<
  *             local_name = lxb_dom_attr_local_name(attr, &local_name_len)
  *             attrs.append(local_name[:local_name_len].decode())
  */
   while (1) {
     __pyx_t_1 = (__pyx_v_attr != 0);
     if (!__pyx_t_1) break;
 
-    /* "resiliparse/parse/html.pyx":763
+    /* "resiliparse/parse/html.pyx":809
  *         attrs = []
  *         while attr:
  *             local_name = lxb_dom_attr_local_name(attr, &local_name_len)             # <<<<<<<<<<<<<<
  *             attrs.append(local_name[:local_name_len].decode())
  *             attr = attr.next
  */
     __pyx_v_local_name = lxb_dom_attr_local_name(__pyx_v_attr, (&__pyx_v_local_name_len));
 
-    /* "resiliparse/parse/html.pyx":764
+    /* "resiliparse/parse/html.pyx":810
  *         while attr:
  *             local_name = lxb_dom_attr_local_name(attr, &local_name_len)
  *             attrs.append(local_name[:local_name_len].decode())             # <<<<<<<<<<<<<<
  *             attr = attr.next
  * 
  */
-    __pyx_t_3 = __Pyx_decode_c_string(((char const *)__pyx_v_local_name), 0, __pyx_v_local_name_len, NULL, NULL, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 764, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_decode_c_string(((char const *)__pyx_v_local_name), 0, __pyx_v_local_name_len, NULL, NULL, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 810, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_4 = __Pyx_PyList_Append(__pyx_v_attrs, __pyx_t_3); if (unlikely(__pyx_t_4 == ((int)-1))) __PYX_ERR(0, 764, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyList_Append(__pyx_v_attrs, __pyx_t_3); if (unlikely(__pyx_t_4 == ((int)-1))) __PYX_ERR(0, 810, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-    /* "resiliparse/parse/html.pyx":765
+    /* "resiliparse/parse/html.pyx":811
  *             local_name = lxb_dom_attr_local_name(attr, &local_name_len)
  *             attrs.append(local_name[:local_name_len].decode())
  *             attr = attr.next             # <<<<<<<<<<<<<<
  * 
  *         return attrs
  */
     __pyx_t_5 = __pyx_v_attr->next;
     __pyx_v_attr = __pyx_t_5;
   }
 
-  /* "resiliparse/parse/html.pyx":767
+  /* "resiliparse/parse/html.pyx":813
  *             attr = attr.next
  * 
  *         return attrs             # <<<<<<<<<<<<<<
  * 
  *     cpdef bint hasattr(self, str attr_name) except -1:
  */
   __Pyx_XDECREF(__pyx_r);
   __Pyx_INCREF(__pyx_v_attrs);
   __pyx_r = __pyx_v_attrs;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":748
+  /* "resiliparse/parse/html.pyx":794
  * 
  *     @property
  *     def attrs(self):             # <<<<<<<<<<<<<<
  *         """
  *         List of attribute names if node is an Element node.
  */
 
@@ -10127,15 +10723,15 @@
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_v_attrs);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":769
+/* "resiliparse/parse/html.pyx":815
  *         return attrs
  * 
  *     cpdef bint hasattr(self, str attr_name) except -1:             # <<<<<<<<<<<<<<
  *         """
  *         hasattr(self, attr_name)
  */
 
@@ -10161,15 +10757,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_hasattr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 769, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_hasattr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 815, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_11resiliparse_5parse_4html_7DOMNode_8hasattr)) {
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_4)) {
@@ -10177,18 +10773,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_v_attr_name) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_attr_name);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 769, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 815, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_5 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 769, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_5 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 815, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __pyx_r = __pyx_t_5;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -10199,15 +10795,15 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "resiliparse/parse/html.pyx":780
+  /* "resiliparse/parse/html.pyx":826
  *         :raises ValueError: if node is not an Element node
  *         """
  *         if not check_node(self) or self.node.type != LXB_DOM_NODE_TYPE_ELEMENT:             # <<<<<<<<<<<<<<
  *             raise ValueError('Node ist not an Element node.')
  * 
  */
   __pyx_t_6 = ((!(__pyx_f_11resiliparse_5parse_4html_check_node(__pyx_v_self) != 0)) != 0);
@@ -10217,81 +10813,81 @@
     goto __pyx_L4_bool_binop_done;
   }
   __pyx_t_6 = ((__pyx_v_self->node->type != LXB_DOM_NODE_TYPE_ELEMENT) != 0);
   __pyx_t_5 = __pyx_t_6;
   __pyx_L4_bool_binop_done:;
   if (unlikely(__pyx_t_5)) {
 
-    /* "resiliparse/parse/html.pyx":781
+    /* "resiliparse/parse/html.pyx":827
  *         """
  *         if not check_node(self) or self.node.type != LXB_DOM_NODE_TYPE_ELEMENT:
  *             raise ValueError('Node ist not an Element node.')             # <<<<<<<<<<<<<<
  * 
  *         cdef bytes attr_name_bytes = attr_name.encode()
  */
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__8, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 781, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__11, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 827, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 781, __pyx_L1_error)
+    __PYX_ERR(0, 827, __pyx_L1_error)
 
-    /* "resiliparse/parse/html.pyx":780
+    /* "resiliparse/parse/html.pyx":826
  *         :raises ValueError: if node is not an Element node
  *         """
  *         if not check_node(self) or self.node.type != LXB_DOM_NODE_TYPE_ELEMENT:             # <<<<<<<<<<<<<<
  *             raise ValueError('Node ist not an Element node.')
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":783
+  /* "resiliparse/parse/html.pyx":829
  *             raise ValueError('Node ist not an Element node.')
  * 
  *         cdef bytes attr_name_bytes = attr_name.encode()             # <<<<<<<<<<<<<<
  *         return <bint>lxb_dom_element_has_attribute(<lxb_dom_element_t*>self.node,
  *                                                    <lxb_char_t*>attr_name_bytes, len(attr_name_bytes))
  */
   if (unlikely(__pyx_v_attr_name == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "encode");
-    __PYX_ERR(0, 783, __pyx_L1_error)
+    __PYX_ERR(0, 829, __pyx_L1_error)
   }
-  __pyx_t_1 = PyUnicode_AsEncodedString(__pyx_v_attr_name, NULL, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 783, __pyx_L1_error)
+  __pyx_t_1 = PyUnicode_AsEncodedString(__pyx_v_attr_name, NULL, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 829, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_attr_name_bytes = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "resiliparse/parse/html.pyx":785
+  /* "resiliparse/parse/html.pyx":831
  *         cdef bytes attr_name_bytes = attr_name.encode()
  *         return <bint>lxb_dom_element_has_attribute(<lxb_dom_element_t*>self.node,
  *                                                    <lxb_char_t*>attr_name_bytes, len(attr_name_bytes))             # <<<<<<<<<<<<<<
  * 
  *     cdef str _getattr_impl(self, const string& attr_name, bint raise_if_not_exists=True):
  */
   if (unlikely(__pyx_v_attr_name_bytes == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "expected bytes, NoneType found");
-    __PYX_ERR(0, 785, __pyx_L1_error)
+    __PYX_ERR(0, 831, __pyx_L1_error)
   }
-  __pyx_t_7 = __Pyx_PyBytes_AsWritableUString(__pyx_v_attr_name_bytes); if (unlikely((!__pyx_t_7) && PyErr_Occurred())) __PYX_ERR(0, 785, __pyx_L1_error)
+  __pyx_t_7 = __Pyx_PyBytes_AsWritableUString(__pyx_v_attr_name_bytes); if (unlikely((!__pyx_t_7) && PyErr_Occurred())) __PYX_ERR(0, 831, __pyx_L1_error)
   if (unlikely(__pyx_v_attr_name_bytes == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-    __PYX_ERR(0, 785, __pyx_L1_error)
+    __PYX_ERR(0, 831, __pyx_L1_error)
   }
-  __pyx_t_8 = PyBytes_GET_SIZE(__pyx_v_attr_name_bytes); if (unlikely(__pyx_t_8 == ((Py_ssize_t)-1))) __PYX_ERR(0, 785, __pyx_L1_error)
+  __pyx_t_8 = PyBytes_GET_SIZE(__pyx_v_attr_name_bytes); if (unlikely(__pyx_t_8 == ((Py_ssize_t)-1))) __PYX_ERR(0, 831, __pyx_L1_error)
 
-  /* "resiliparse/parse/html.pyx":784
+  /* "resiliparse/parse/html.pyx":830
  * 
  *         cdef bytes attr_name_bytes = attr_name.encode()
  *         return <bint>lxb_dom_element_has_attribute(<lxb_dom_element_t*>self.node,             # <<<<<<<<<<<<<<
  *                                                    <lxb_char_t*>attr_name_bytes, len(attr_name_bytes))
  * 
  */
   __pyx_r = (lxb_dom_element_has_attribute(((lxb_dom_element_t *)__pyx_v_self->node), ((lxb_char_t *)__pyx_t_7), __pyx_t_8) != 0);
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":769
+  /* "resiliparse/parse/html.pyx":815
  *         return attrs
  * 
  *     cpdef bint hasattr(self, str attr_name) except -1:             # <<<<<<<<<<<<<<
  *         """
  *         hasattr(self, attr_name)
  */
 
@@ -10315,15 +10911,15 @@
 static PyObject *__pyx_pw_11resiliparse_5parse_4html_7DOMNode_8hasattr(PyObject *__pyx_v_self, PyObject *__pyx_v_attr_name) {
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("hasattr (wrapper)", 0);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_attr_name), (&PyUnicode_Type), 1, "attr_name", 1))) __PYX_ERR(0, 769, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_attr_name), (&PyUnicode_Type), 1, "attr_name", 1))) __PYX_ERR(0, 815, __pyx_L1_error)
   __pyx_r = __pyx_pf_11resiliparse_5parse_4html_7DOMNode_7hasattr(((struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *)__pyx_v_self), ((PyObject*)__pyx_v_attr_name));
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -10337,16 +10933,16 @@
   int __pyx_t_1;
   PyObject *__pyx_t_2 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("hasattr", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __pyx_f_11resiliparse_5parse_4html_7DOMNode_hasattr(__pyx_v_self, __pyx_v_attr_name, 1); if (unlikely(__pyx_t_1 == ((int)-1))) __PYX_ERR(0, 769, __pyx_L1_error)
-  __pyx_t_2 = __Pyx_PyBool_FromLong(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 769, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_11resiliparse_5parse_4html_7DOMNode_hasattr(__pyx_v_self, __pyx_v_attr_name, 1); if (unlikely(__pyx_t_1 == ((int)-1))) __PYX_ERR(0, 815, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyBool_FromLong(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 815, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_r = __pyx_t_2;
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -10355,15 +10951,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":787
+/* "resiliparse/parse/html.pyx":833
  *                                                    <lxb_char_t*>attr_name_bytes, len(attr_name_bytes))
  * 
  *     cdef str _getattr_impl(self, const string& attr_name, bint raise_if_not_exists=True):             # <<<<<<<<<<<<<<
  *         """
  *         Get an attribute value as string.
  */
 
@@ -10383,15 +10979,15 @@
   __Pyx_RefNannySetupContext("_getattr_impl", 0);
   if (__pyx_optional_args) {
     if (__pyx_optional_args->__pyx_n > 0) {
       __pyx_v_raise_if_not_exists = __pyx_optional_args->raise_if_not_exists;
     }
   }
 
-  /* "resiliparse/parse/html.pyx":795
+  /* "resiliparse/parse/html.pyx":841
  *         :raises KeyError: if attribute does not exist
  *         """
  *         if not check_node(self) or self.node.type != LXB_DOM_NODE_TYPE_ELEMENT:             # <<<<<<<<<<<<<<
  *             raise ValueError('Node ist not an Element node.')
  * 
  */
   __pyx_t_2 = ((!(__pyx_f_11resiliparse_5parse_4html_check_node(__pyx_v_self) != 0)) != 0);
@@ -10401,122 +10997,122 @@
     goto __pyx_L4_bool_binop_done;
   }
   __pyx_t_2 = ((__pyx_v_self->node->type != LXB_DOM_NODE_TYPE_ELEMENT) != 0);
   __pyx_t_1 = __pyx_t_2;
   __pyx_L4_bool_binop_done:;
   if (unlikely(__pyx_t_1)) {
 
-    /* "resiliparse/parse/html.pyx":796
+    /* "resiliparse/parse/html.pyx":842
  *         """
  *         if not check_node(self) or self.node.type != LXB_DOM_NODE_TYPE_ELEMENT:
  *             raise ValueError('Node ist not an Element node.')             # <<<<<<<<<<<<<<
  * 
  *         if raise_if_not_exists and not lxb_dom_element_has_attribute(
  */
-    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__8, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 796, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__11, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 842, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_Raise(__pyx_t_3, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __PYX_ERR(0, 796, __pyx_L1_error)
+    __PYX_ERR(0, 842, __pyx_L1_error)
 
-    /* "resiliparse/parse/html.pyx":795
+    /* "resiliparse/parse/html.pyx":841
  *         :raises KeyError: if attribute does not exist
  *         """
  *         if not check_node(self) or self.node.type != LXB_DOM_NODE_TYPE_ELEMENT:             # <<<<<<<<<<<<<<
  *             raise ValueError('Node ist not an Element node.')
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":798
+  /* "resiliparse/parse/html.pyx":844
  *             raise ValueError('Node ist not an Element node.')
  * 
  *         if raise_if_not_exists and not lxb_dom_element_has_attribute(             # <<<<<<<<<<<<<<
  *                 <lxb_dom_element_t*>self.node, <lxb_char_t*>attr_name.data(), attr_name.size()):
  *             raise KeyError(f'No such attribute: {attr_name.decode()}')
  */
   __pyx_t_2 = (__pyx_v_raise_if_not_exists != 0);
   if (__pyx_t_2) {
   } else {
     __pyx_t_1 = __pyx_t_2;
     goto __pyx_L7_bool_binop_done;
   }
 
-  /* "resiliparse/parse/html.pyx":799
+  /* "resiliparse/parse/html.pyx":845
  * 
  *         if raise_if_not_exists and not lxb_dom_element_has_attribute(
  *                 <lxb_dom_element_t*>self.node, <lxb_char_t*>attr_name.data(), attr_name.size()):             # <<<<<<<<<<<<<<
  *             raise KeyError(f'No such attribute: {attr_name.decode()}')
  * 
  */
   __pyx_t_2 = ((!(lxb_dom_element_has_attribute(((lxb_dom_element_t *)__pyx_v_self->node), ((lxb_char_t *)__pyx_v_attr_name.data()), __pyx_v_attr_name.size()) != 0)) != 0);
   __pyx_t_1 = __pyx_t_2;
   __pyx_L7_bool_binop_done:;
 
-  /* "resiliparse/parse/html.pyx":798
+  /* "resiliparse/parse/html.pyx":844
  *             raise ValueError('Node ist not an Element node.')
  * 
  *         if raise_if_not_exists and not lxb_dom_element_has_attribute(             # <<<<<<<<<<<<<<
  *                 <lxb_dom_element_t*>self.node, <lxb_char_t*>attr_name.data(), attr_name.size()):
  *             raise KeyError(f'No such attribute: {attr_name.decode()}')
  */
   if (unlikely(__pyx_t_1)) {
 
-    /* "resiliparse/parse/html.pyx":800
+    /* "resiliparse/parse/html.pyx":846
  *         if raise_if_not_exists and not lxb_dom_element_has_attribute(
  *                 <lxb_dom_element_t*>self.node, <lxb_char_t*>attr_name.data(), attr_name.size()):
  *             raise KeyError(f'No such attribute: {attr_name.decode()}')             # <<<<<<<<<<<<<<
  * 
  *         cdef size_t node_attr_len
  */
-    __pyx_t_3 = __Pyx_decode_cpp_string(__pyx_v_attr_name, 0, PY_SSIZE_T_MAX, NULL, NULL, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 800, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_decode_cpp_string(__pyx_v_attr_name, 0, PY_SSIZE_T_MAX, NULL, NULL, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 846, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_4 = __Pyx_PyUnicode_Concat(__pyx_kp_u_No_such_attribute, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 800, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyUnicode_Concat(__pyx_kp_u_No_such_attribute, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 846, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_builtin_KeyError, __pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 800, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_CallOneArg(__pyx_builtin_KeyError, __pyx_t_4); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 846, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_Raise(__pyx_t_3, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __PYX_ERR(0, 800, __pyx_L1_error)
+    __PYX_ERR(0, 846, __pyx_L1_error)
 
-    /* "resiliparse/parse/html.pyx":798
+    /* "resiliparse/parse/html.pyx":844
  *             raise ValueError('Node ist not an Element node.')
  * 
  *         if raise_if_not_exists and not lxb_dom_element_has_attribute(             # <<<<<<<<<<<<<<
  *                 <lxb_dom_element_t*>self.node, <lxb_char_t*>attr_name.data(), attr_name.size()):
  *             raise KeyError(f'No such attribute: {attr_name.decode()}')
  */
   }
 
-  /* "resiliparse/parse/html.pyx":803
+  /* "resiliparse/parse/html.pyx":849
  * 
  *         cdef size_t node_attr_len
  *         cdef const lxb_char_t* node_attr_data = lxb_dom_element_get_attribute(             # <<<<<<<<<<<<<<
  *             <lxb_dom_element_t*>self.node, <const lxb_char_t*>attr_name.data(), attr_name.size(), &node_attr_len)
  *         return node_attr_data[:node_attr_len].decode()
  */
   __pyx_v_node_attr_data = lxb_dom_element_get_attribute(((lxb_dom_element_t *)__pyx_v_self->node), ((lxb_char_t const *)__pyx_v_attr_name.data()), __pyx_v_attr_name.size(), (&__pyx_v_node_attr_len));
 
-  /* "resiliparse/parse/html.pyx":805
+  /* "resiliparse/parse/html.pyx":851
  *         cdef const lxb_char_t* node_attr_data = lxb_dom_element_get_attribute(
  *             <lxb_dom_element_t*>self.node, <const lxb_char_t*>attr_name.data(), attr_name.size(), &node_attr_len)
  *         return node_attr_data[:node_attr_len].decode()             # <<<<<<<<<<<<<<
  * 
  *     cpdef str getattr(self, str attr_name, str default_value=None):
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_3 = __Pyx_decode_c_string(((char const *)__pyx_v_node_attr_data), 0, __pyx_v_node_attr_len, NULL, NULL, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 805, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_decode_c_string(((char const *)__pyx_v_node_attr_data), 0, __pyx_v_node_attr_len, NULL, NULL, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 851, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_r = ((PyObject*)__pyx_t_3);
   __pyx_t_3 = 0;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":787
+  /* "resiliparse/parse/html.pyx":833
  *                                                    <lxb_char_t*>attr_name_bytes, len(attr_name_bytes))
  * 
  *     cdef str _getattr_impl(self, const string& attr_name, bint raise_if_not_exists=True):             # <<<<<<<<<<<<<<
  *         """
  *         Get an attribute value as string.
  */
 
@@ -10528,15 +11124,15 @@
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":807
+/* "resiliparse/parse/html.pyx":853
  *         return node_attr_data[:node_attr_len].decode()
  * 
  *     cpdef str getattr(self, str attr_name, str default_value=None):             # <<<<<<<<<<<<<<
  *         """
  *         getattr(self, attr_name, default_value=None)
  */
 
@@ -10570,15 +11166,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_getattr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 807, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_getattr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 853, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_11resiliparse_5parse_4html_7DOMNode_10getattr)) {
         __Pyx_XDECREF(__pyx_r);
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         __pyx_t_5 = 0;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
@@ -10590,45 +11186,45 @@
             __Pyx_DECREF_SET(__pyx_t_3, function);
             __pyx_t_5 = 1;
           }
         }
         #if CYTHON_FAST_PYCALL
         if (PyFunction_Check(__pyx_t_3)) {
           PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_v_attr_name, __pyx_v_default_value};
-          __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 807, __pyx_L1_error)
+          __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 853, __pyx_L1_error)
           __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
           __Pyx_GOTREF(__pyx_t_2);
         } else
         #endif
         #if CYTHON_FAST_PYCCALL
         if (__Pyx_PyFastCFunction_Check(__pyx_t_3)) {
           PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_v_attr_name, __pyx_v_default_value};
-          __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 807, __pyx_L1_error)
+          __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 853, __pyx_L1_error)
           __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
           __Pyx_GOTREF(__pyx_t_2);
         } else
         #endif
         {
-          __pyx_t_6 = PyTuple_New(2+__pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 807, __pyx_L1_error)
+          __pyx_t_6 = PyTuple_New(2+__pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 853, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
           if (__pyx_t_4) {
             __Pyx_GIVEREF(__pyx_t_4); PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_4); __pyx_t_4 = NULL;
           }
           __Pyx_INCREF(__pyx_v_attr_name);
           __Pyx_GIVEREF(__pyx_v_attr_name);
           PyTuple_SET_ITEM(__pyx_t_6, 0+__pyx_t_5, __pyx_v_attr_name);
           __Pyx_INCREF(__pyx_v_default_value);
           __Pyx_GIVEREF(__pyx_v_default_value);
           PyTuple_SET_ITEM(__pyx_t_6, 1+__pyx_t_5, __pyx_v_default_value);
-          __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_6, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 807, __pyx_L1_error)
+          __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_6, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 853, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_2);
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         }
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        if (!(likely(PyUnicode_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "unicode", Py_TYPE(__pyx_t_2)->tp_name), 0))) __PYX_ERR(0, 807, __pyx_L1_error)
+        if (!(likely(PyUnicode_CheckExact(__pyx_t_2))||((__pyx_t_2) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "unicode", Py_TYPE(__pyx_t_2)->tp_name), 0))) __PYX_ERR(0, 853, __pyx_L1_error)
         __pyx_r = ((PyObject*)__pyx_t_2);
         __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -10639,45 +11235,45 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "resiliparse/parse/html.pyx":821
+  /* "resiliparse/parse/html.pyx":867
  *         :raises ValueError: if node is not an Element node
  *         """
  *         if not check_node(self):             # <<<<<<<<<<<<<<
  *             return None
  * 
  */
   __pyx_t_7 = ((!(__pyx_f_11resiliparse_5parse_4html_check_node(__pyx_v_self) != 0)) != 0);
   if (__pyx_t_7) {
 
-    /* "resiliparse/parse/html.pyx":822
+    /* "resiliparse/parse/html.pyx":868
  *         """
  *         if not check_node(self):
  *             return None             # <<<<<<<<<<<<<<
  * 
  *         try:
  */
     __Pyx_XDECREF(__pyx_r);
     __pyx_r = ((PyObject*)Py_None); __Pyx_INCREF(Py_None);
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":821
+    /* "resiliparse/parse/html.pyx":867
  *         :raises ValueError: if node is not an Element node
  *         """
  *         if not check_node(self):             # <<<<<<<<<<<<<<
  *             return None
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":824
+  /* "resiliparse/parse/html.pyx":870
  *             return None
  * 
  *         try:             # <<<<<<<<<<<<<<
  *             return self._getattr_impl(attr_name.encode())
  *         except KeyError:
  */
   {
@@ -10685,67 +11281,67 @@
     __Pyx_PyThreadState_assign
     __Pyx_ExceptionSave(&__pyx_t_8, &__pyx_t_9, &__pyx_t_10);
     __Pyx_XGOTREF(__pyx_t_8);
     __Pyx_XGOTREF(__pyx_t_9);
     __Pyx_XGOTREF(__pyx_t_10);
     /*try:*/ {
 
-      /* "resiliparse/parse/html.pyx":825
+      /* "resiliparse/parse/html.pyx":871
  * 
  *         try:
  *             return self._getattr_impl(attr_name.encode())             # <<<<<<<<<<<<<<
  *         except KeyError:
  *             return default_value
  */
       __Pyx_XDECREF(__pyx_r);
       if (unlikely(__pyx_v_attr_name == Py_None)) {
         PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "encode");
-        __PYX_ERR(0, 825, __pyx_L4_error)
+        __PYX_ERR(0, 871, __pyx_L4_error)
       }
-      __pyx_t_1 = PyUnicode_AsEncodedString(__pyx_v_attr_name, NULL, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 825, __pyx_L4_error)
+      __pyx_t_1 = PyUnicode_AsEncodedString(__pyx_v_attr_name, NULL, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 871, __pyx_L4_error)
       __Pyx_GOTREF(__pyx_t_1);
-      __pyx_t_11 = __pyx_convert_string_from_py_std__in_string(__pyx_t_1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 825, __pyx_L4_error)
+      __pyx_t_11 = __pyx_convert_string_from_py_std__in_string(__pyx_t_1); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 871, __pyx_L4_error)
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-      __pyx_t_1 = ((struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMNode *)__pyx_v_self->__pyx_vtab)->_getattr_impl(__pyx_v_self, __pyx_t_11, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 825, __pyx_L4_error)
+      __pyx_t_1 = ((struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMNode *)__pyx_v_self->__pyx_vtab)->_getattr_impl(__pyx_v_self, __pyx_t_11, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 871, __pyx_L4_error)
       __Pyx_GOTREF(__pyx_t_1);
       __pyx_r = ((PyObject*)__pyx_t_1);
       __pyx_t_1 = 0;
       goto __pyx_L8_try_return;
 
-      /* "resiliparse/parse/html.pyx":824
+      /* "resiliparse/parse/html.pyx":870
  *             return None
  * 
  *         try:             # <<<<<<<<<<<<<<
  *             return self._getattr_impl(attr_name.encode())
  *         except KeyError:
  */
     }
     __pyx_L4_error:;
     __Pyx_XDECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_XDECREF(__pyx_t_2); __pyx_t_2 = 0;
     __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_XDECREF(__pyx_t_6); __pyx_t_6 = 0;
 
-    /* "resiliparse/parse/html.pyx":826
+    /* "resiliparse/parse/html.pyx":872
  *         try:
  *             return self._getattr_impl(attr_name.encode())
  *         except KeyError:             # <<<<<<<<<<<<<<
  *             return default_value
  * 
  */
     __pyx_t_5 = __Pyx_PyErr_ExceptionMatches(__pyx_builtin_KeyError);
     if (__pyx_t_5) {
       __Pyx_AddTraceback("resiliparse.parse.html.DOMNode.getattr", __pyx_clineno, __pyx_lineno, __pyx_filename);
-      if (__Pyx_GetException(&__pyx_t_1, &__pyx_t_2, &__pyx_t_3) < 0) __PYX_ERR(0, 826, __pyx_L6_except_error)
+      if (__Pyx_GetException(&__pyx_t_1, &__pyx_t_2, &__pyx_t_3) < 0) __PYX_ERR(0, 872, __pyx_L6_except_error)
       __Pyx_GOTREF(__pyx_t_1);
       __Pyx_GOTREF(__pyx_t_2);
       __Pyx_GOTREF(__pyx_t_3);
 
-      /* "resiliparse/parse/html.pyx":827
+      /* "resiliparse/parse/html.pyx":873
  *             return self._getattr_impl(attr_name.encode())
  *         except KeyError:
  *             return default_value             # <<<<<<<<<<<<<<
  * 
  *     def __getitem__(self, str attr_name):
  */
       __Pyx_XDECREF(__pyx_r);
@@ -10755,15 +11351,15 @@
       __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
       __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
       goto __pyx_L7_except_return;
     }
     goto __pyx_L6_except_error;
     __pyx_L6_except_error:;
 
-    /* "resiliparse/parse/html.pyx":824
+    /* "resiliparse/parse/html.pyx":870
  *             return None
  * 
  *         try:             # <<<<<<<<<<<<<<
  *             return self._getattr_impl(attr_name.encode())
  *         except KeyError:
  */
     __Pyx_XGIVEREF(__pyx_t_8);
@@ -10781,15 +11377,15 @@
     __Pyx_XGIVEREF(__pyx_t_8);
     __Pyx_XGIVEREF(__pyx_t_9);
     __Pyx_XGIVEREF(__pyx_t_10);
     __Pyx_ExceptionReset(__pyx_t_8, __pyx_t_9, __pyx_t_10);
     goto __pyx_L0;
   }
 
-  /* "resiliparse/parse/html.pyx":807
+  /* "resiliparse/parse/html.pyx":853
  *         return node_attr_data[:node_attr_len].decode()
  * 
  *     cpdef str getattr(self, str attr_name, str default_value=None):             # <<<<<<<<<<<<<<
  *         """
  *         getattr(self, attr_name, default_value=None)
  */
 
@@ -10844,15 +11440,15 @@
         case  1:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_default_value);
           if (value) { values[1] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "getattr") < 0)) __PYX_ERR(0, 807, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "getattr") < 0)) __PYX_ERR(0, 853, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
         CYTHON_FALLTHROUGH;
         case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
         break;
@@ -10860,22 +11456,22 @@
       }
     }
     __pyx_v_attr_name = ((PyObject*)values[0]);
     __pyx_v_default_value = ((PyObject*)values[1]);
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("getattr", 0, 1, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 807, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("getattr", 0, 1, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 853, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("resiliparse.parse.html.DOMNode.getattr", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_attr_name), (&PyUnicode_Type), 1, "attr_name", 1))) __PYX_ERR(0, 807, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_default_value), (&PyUnicode_Type), 1, "default_value", 1))) __PYX_ERR(0, 807, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_attr_name), (&PyUnicode_Type), 1, "attr_name", 1))) __PYX_ERR(0, 853, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_default_value), (&PyUnicode_Type), 1, "default_value", 1))) __PYX_ERR(0, 853, __pyx_L1_error)
   __pyx_r = __pyx_pf_11resiliparse_5parse_4html_7DOMNode_9getattr(((struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *)__pyx_v_self), __pyx_v_attr_name, __pyx_v_default_value);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -10891,15 +11487,15 @@
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("getattr", 0);
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_2.__pyx_n = 1;
   __pyx_t_2.default_value = __pyx_v_default_value;
-  __pyx_t_1 = __pyx_vtabptr_11resiliparse_5parse_4html_DOMNode->getattr(__pyx_v_self, __pyx_v_attr_name, 1, &__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 807, __pyx_L1_error)
+  __pyx_t_1 = __pyx_vtabptr_11resiliparse_5parse_4html_DOMNode->getattr(__pyx_v_self, __pyx_v_attr_name, 1, &__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 853, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -10908,15 +11504,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":829
+/* "resiliparse/parse/html.pyx":875
  *             return default_value
  * 
  *     def __getitem__(self, str attr_name):             # <<<<<<<<<<<<<<
  *         """
  *         __getitem__(self, attr_name)
  */
 
@@ -10929,15 +11525,15 @@
 static PyObject *__pyx_pw_11resiliparse_5parse_4html_7DOMNode_12__getitem__(PyObject *__pyx_v_self, PyObject *__pyx_v_attr_name) {
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__getitem__ (wrapper)", 0);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_attr_name), (&PyUnicode_Type), 1, "attr_name", 1))) __PYX_ERR(0, 829, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_attr_name), (&PyUnicode_Type), 1, "attr_name", 1))) __PYX_ERR(0, 875, __pyx_L1_error)
   __pyx_r = __pyx_pf_11resiliparse_5parse_4html_7DOMNode_11__getitem__(((struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *)__pyx_v_self), ((PyObject*)__pyx_v_attr_name));
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -10952,67 +11548,67 @@
   PyObject *__pyx_t_2 = NULL;
   std::string __pyx_t_3;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__getitem__", 0);
 
-  /* "resiliparse/parse/html.pyx":840
+  /* "resiliparse/parse/html.pyx":886
  *         :raises ValueError: if node is not an Element node
  *         """
  *         if not check_node(self):             # <<<<<<<<<<<<<<
  *             return None
  * 
  */
   __pyx_t_1 = ((!(__pyx_f_11resiliparse_5parse_4html_check_node(__pyx_v_self) != 0)) != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/parse/html.pyx":841
+    /* "resiliparse/parse/html.pyx":887
  *         """
  *         if not check_node(self):
  *             return None             # <<<<<<<<<<<<<<
  * 
  *         return self._getattr_impl(attr_name.encode())
  */
     __Pyx_XDECREF(__pyx_r);
     __pyx_r = Py_None; __Pyx_INCREF(Py_None);
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":840
+    /* "resiliparse/parse/html.pyx":886
  *         :raises ValueError: if node is not an Element node
  *         """
  *         if not check_node(self):             # <<<<<<<<<<<<<<
  *             return None
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":843
+  /* "resiliparse/parse/html.pyx":889
  *             return None
  * 
  *         return self._getattr_impl(attr_name.encode())             # <<<<<<<<<<<<<<
  * 
  *     cdef bint _setattr_impl(self, bytes attr_name, bytes attr_value) except -1:
  */
   __Pyx_XDECREF(__pyx_r);
   if (unlikely(__pyx_v_attr_name == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "encode");
-    __PYX_ERR(0, 843, __pyx_L1_error)
+    __PYX_ERR(0, 889, __pyx_L1_error)
   }
-  __pyx_t_2 = PyUnicode_AsEncodedString(__pyx_v_attr_name, NULL, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 843, __pyx_L1_error)
+  __pyx_t_2 = PyUnicode_AsEncodedString(__pyx_v_attr_name, NULL, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 889, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = __pyx_convert_string_from_py_std__in_string(__pyx_t_2); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 843, __pyx_L1_error)
+  __pyx_t_3 = __pyx_convert_string_from_py_std__in_string(__pyx_t_2); if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 889, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = ((struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMNode *)__pyx_v_self->__pyx_vtab)->_getattr_impl(__pyx_v_self, __pyx_t_3, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 843, __pyx_L1_error)
+  __pyx_t_2 = ((struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMNode *)__pyx_v_self->__pyx_vtab)->_getattr_impl(__pyx_v_self, __pyx_t_3, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 889, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_r = __pyx_t_2;
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":829
+  /* "resiliparse/parse/html.pyx":875
  *             return default_value
  * 
  *     def __getitem__(self, str attr_name):             # <<<<<<<<<<<<<<
  *         """
  *         __getitem__(self, attr_name)
  */
 
@@ -11023,15 +11619,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":845
+/* "resiliparse/parse/html.pyx":891
  *         return self._getattr_impl(attr_name.encode())
  * 
  *     cdef bint _setattr_impl(self, bytes attr_name, bytes attr_value) except -1:             # <<<<<<<<<<<<<<
  *         """
  *         Insert or update an attribute with the given value.
  */
 
@@ -11047,15 +11643,15 @@
   lxb_char_t *__pyx_t_6;
   Py_ssize_t __pyx_t_7;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_setattr_impl", 0);
 
-  /* "resiliparse/parse/html.pyx":853
+  /* "resiliparse/parse/html.pyx":899
  *         :return: attribute value or None
  *         """
  *         if not check_node(self) or self.node.type != LXB_DOM_NODE_TYPE_ELEMENT:             # <<<<<<<<<<<<<<
  *             raise ValueError('Node ist not an Element node.')
  * 
  */
   __pyx_t_2 = ((!(__pyx_f_11resiliparse_5parse_4html_check_node(__pyx_v_self) != 0)) != 0);
@@ -11065,167 +11661,167 @@
     goto __pyx_L4_bool_binop_done;
   }
   __pyx_t_2 = ((__pyx_v_self->node->type != LXB_DOM_NODE_TYPE_ELEMENT) != 0);
   __pyx_t_1 = __pyx_t_2;
   __pyx_L4_bool_binop_done:;
   if (unlikely(__pyx_t_1)) {
 
-    /* "resiliparse/parse/html.pyx":854
+    /* "resiliparse/parse/html.pyx":900
  *         """
  *         if not check_node(self) or self.node.type != LXB_DOM_NODE_TYPE_ELEMENT:
  *             raise ValueError('Node ist not an Element node.')             # <<<<<<<<<<<<<<
  * 
  *         # Lexbor's check of existing attributes is buggy
  */
-    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__8, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 854, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__11, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 900, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_Raise(__pyx_t_3, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __PYX_ERR(0, 854, __pyx_L1_error)
+    __PYX_ERR(0, 900, __pyx_L1_error)
 
-    /* "resiliparse/parse/html.pyx":853
+    /* "resiliparse/parse/html.pyx":899
  *         :return: attribute value or None
  *         """
  *         if not check_node(self) or self.node.type != LXB_DOM_NODE_TYPE_ELEMENT:             # <<<<<<<<<<<<<<
  *             raise ValueError('Node ist not an Element node.')
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":858
+  /* "resiliparse/parse/html.pyx":904
  *         # Lexbor's check of existing attributes is buggy
  *         cdef lxb_dom_attr_t* attr = lxb_dom_element_attr_is_exist(<lxb_dom_element_t*>self.node,
  *                                                                   <lxb_char_t*>attr_name, len(attr_name))             # <<<<<<<<<<<<<<
  * 
  *         if attr:
  */
   if (unlikely(__pyx_v_attr_name == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "expected bytes, NoneType found");
-    __PYX_ERR(0, 858, __pyx_L1_error)
+    __PYX_ERR(0, 904, __pyx_L1_error)
   }
-  __pyx_t_4 = __Pyx_PyBytes_AsWritableUString(__pyx_v_attr_name); if (unlikely((!__pyx_t_4) && PyErr_Occurred())) __PYX_ERR(0, 858, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyBytes_AsWritableUString(__pyx_v_attr_name); if (unlikely((!__pyx_t_4) && PyErr_Occurred())) __PYX_ERR(0, 904, __pyx_L1_error)
   if (unlikely(__pyx_v_attr_name == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-    __PYX_ERR(0, 858, __pyx_L1_error)
+    __PYX_ERR(0, 904, __pyx_L1_error)
   }
-  __pyx_t_5 = PyBytes_GET_SIZE(__pyx_v_attr_name); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 858, __pyx_L1_error)
+  __pyx_t_5 = PyBytes_GET_SIZE(__pyx_v_attr_name); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 904, __pyx_L1_error)
 
-  /* "resiliparse/parse/html.pyx":857
+  /* "resiliparse/parse/html.pyx":903
  * 
  *         # Lexbor's check of existing attributes is buggy
  *         cdef lxb_dom_attr_t* attr = lxb_dom_element_attr_is_exist(<lxb_dom_element_t*>self.node,             # <<<<<<<<<<<<<<
  *                                                                   <lxb_char_t*>attr_name, len(attr_name))
  * 
  */
   __pyx_v_attr = lxb_dom_element_attr_is_exist(((lxb_dom_element_t *)__pyx_v_self->node), ((lxb_char_t *)__pyx_t_4), __pyx_t_5);
 
-  /* "resiliparse/parse/html.pyx":860
+  /* "resiliparse/parse/html.pyx":906
  *                                                                   <lxb_char_t*>attr_name, len(attr_name))
  * 
  *         if attr:             # <<<<<<<<<<<<<<
  *             lxb_dom_attr_set_value(attr, <lxb_char_t*>attr_value, len(attr_value))
  *             return True
  */
   __pyx_t_1 = (__pyx_v_attr != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/parse/html.pyx":861
+    /* "resiliparse/parse/html.pyx":907
  * 
  *         if attr:
  *             lxb_dom_attr_set_value(attr, <lxb_char_t*>attr_value, len(attr_value))             # <<<<<<<<<<<<<<
  *             return True
  * 
  */
     if (unlikely(__pyx_v_attr_value == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "expected bytes, NoneType found");
-      __PYX_ERR(0, 861, __pyx_L1_error)
+      __PYX_ERR(0, 907, __pyx_L1_error)
     }
-    __pyx_t_4 = __Pyx_PyBytes_AsWritableUString(__pyx_v_attr_value); if (unlikely((!__pyx_t_4) && PyErr_Occurred())) __PYX_ERR(0, 861, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyBytes_AsWritableUString(__pyx_v_attr_value); if (unlikely((!__pyx_t_4) && PyErr_Occurred())) __PYX_ERR(0, 907, __pyx_L1_error)
     if (unlikely(__pyx_v_attr_value == Py_None)) {
       PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-      __PYX_ERR(0, 861, __pyx_L1_error)
+      __PYX_ERR(0, 907, __pyx_L1_error)
     }
-    __pyx_t_5 = PyBytes_GET_SIZE(__pyx_v_attr_value); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 861, __pyx_L1_error)
+    __pyx_t_5 = PyBytes_GET_SIZE(__pyx_v_attr_value); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 907, __pyx_L1_error)
     (void)(lxb_dom_attr_set_value(__pyx_v_attr, ((lxb_char_t *)__pyx_t_4), __pyx_t_5));
 
-    /* "resiliparse/parse/html.pyx":862
+    /* "resiliparse/parse/html.pyx":908
  *         if attr:
  *             lxb_dom_attr_set_value(attr, <lxb_char_t*>attr_value, len(attr_value))
  *             return True             # <<<<<<<<<<<<<<
  * 
  *         lxb_dom_element_set_attribute(<lxb_dom_element_t*>self.node,
  */
     __pyx_r = 1;
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":860
+    /* "resiliparse/parse/html.pyx":906
  *                                                                   <lxb_char_t*>attr_name, len(attr_name))
  * 
  *         if attr:             # <<<<<<<<<<<<<<
  *             lxb_dom_attr_set_value(attr, <lxb_char_t*>attr_value, len(attr_value))
  *             return True
  */
   }
 
-  /* "resiliparse/parse/html.pyx":865
+  /* "resiliparse/parse/html.pyx":911
  * 
  *         lxb_dom_element_set_attribute(<lxb_dom_element_t*>self.node,
  *                                       <lxb_char_t*>attr_name, len(attr_name),             # <<<<<<<<<<<<<<
  *                                       <lxb_char_t*>attr_value, len(attr_value))
  *         return True
  */
   if (unlikely(__pyx_v_attr_name == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "expected bytes, NoneType found");
-    __PYX_ERR(0, 865, __pyx_L1_error)
+    __PYX_ERR(0, 911, __pyx_L1_error)
   }
-  __pyx_t_4 = __Pyx_PyBytes_AsWritableUString(__pyx_v_attr_name); if (unlikely((!__pyx_t_4) && PyErr_Occurred())) __PYX_ERR(0, 865, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyBytes_AsWritableUString(__pyx_v_attr_name); if (unlikely((!__pyx_t_4) && PyErr_Occurred())) __PYX_ERR(0, 911, __pyx_L1_error)
   if (unlikely(__pyx_v_attr_name == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-    __PYX_ERR(0, 865, __pyx_L1_error)
+    __PYX_ERR(0, 911, __pyx_L1_error)
   }
-  __pyx_t_5 = PyBytes_GET_SIZE(__pyx_v_attr_name); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 865, __pyx_L1_error)
+  __pyx_t_5 = PyBytes_GET_SIZE(__pyx_v_attr_name); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 911, __pyx_L1_error)
 
-  /* "resiliparse/parse/html.pyx":866
+  /* "resiliparse/parse/html.pyx":912
  *         lxb_dom_element_set_attribute(<lxb_dom_element_t*>self.node,
  *                                       <lxb_char_t*>attr_name, len(attr_name),
  *                                       <lxb_char_t*>attr_value, len(attr_value))             # <<<<<<<<<<<<<<
  *         return True
  * 
  */
   if (unlikely(__pyx_v_attr_value == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "expected bytes, NoneType found");
-    __PYX_ERR(0, 866, __pyx_L1_error)
+    __PYX_ERR(0, 912, __pyx_L1_error)
   }
-  __pyx_t_6 = __Pyx_PyBytes_AsWritableUString(__pyx_v_attr_value); if (unlikely((!__pyx_t_6) && PyErr_Occurred())) __PYX_ERR(0, 866, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyBytes_AsWritableUString(__pyx_v_attr_value); if (unlikely((!__pyx_t_6) && PyErr_Occurred())) __PYX_ERR(0, 912, __pyx_L1_error)
   if (unlikely(__pyx_v_attr_value == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-    __PYX_ERR(0, 866, __pyx_L1_error)
+    __PYX_ERR(0, 912, __pyx_L1_error)
   }
-  __pyx_t_7 = PyBytes_GET_SIZE(__pyx_v_attr_value); if (unlikely(__pyx_t_7 == ((Py_ssize_t)-1))) __PYX_ERR(0, 866, __pyx_L1_error)
+  __pyx_t_7 = PyBytes_GET_SIZE(__pyx_v_attr_value); if (unlikely(__pyx_t_7 == ((Py_ssize_t)-1))) __PYX_ERR(0, 912, __pyx_L1_error)
 
-  /* "resiliparse/parse/html.pyx":864
+  /* "resiliparse/parse/html.pyx":910
  *             return True
  * 
  *         lxb_dom_element_set_attribute(<lxb_dom_element_t*>self.node,             # <<<<<<<<<<<<<<
  *                                       <lxb_char_t*>attr_name, len(attr_name),
  *                                       <lxb_char_t*>attr_value, len(attr_value))
  */
   (void)(lxb_dom_element_set_attribute(((lxb_dom_element_t *)__pyx_v_self->node), ((lxb_char_t *)__pyx_t_4), __pyx_t_5, ((lxb_char_t *)__pyx_t_6), __pyx_t_7));
 
-  /* "resiliparse/parse/html.pyx":867
+  /* "resiliparse/parse/html.pyx":913
  *                                       <lxb_char_t*>attr_name, len(attr_name),
  *                                       <lxb_char_t*>attr_value, len(attr_value))
  *         return True             # <<<<<<<<<<<<<<
  * 
  *     cpdef setattr(self, str attr_name, str attr_value):
  */
   __pyx_r = 1;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":845
+  /* "resiliparse/parse/html.pyx":891
  *         return self._getattr_impl(attr_name.encode())
  * 
  *     cdef bint _setattr_impl(self, bytes attr_name, bytes attr_value) except -1:             # <<<<<<<<<<<<<<
  *         """
  *         Insert or update an attribute with the given value.
  */
 
@@ -11235,15 +11831,15 @@
   __Pyx_AddTraceback("resiliparse.parse.html.DOMNode._setattr_impl", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = -1;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":869
+/* "resiliparse/parse/html.pyx":915
  *         return True
  * 
  *     cpdef setattr(self, str attr_name, str attr_value):             # <<<<<<<<<<<<<<
  *         """
  *         setattr(self, attr_name, attr_value)
  */
 
@@ -11267,15 +11863,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_setattr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 869, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_setattr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 915, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_11resiliparse_5parse_4html_7DOMNode_14setattr)) {
         __Pyx_XDECREF(__pyx_r);
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         __pyx_t_5 = 0;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
@@ -11287,40 +11883,40 @@
             __Pyx_DECREF_SET(__pyx_t_3, function);
             __pyx_t_5 = 1;
           }
         }
         #if CYTHON_FAST_PYCALL
         if (PyFunction_Check(__pyx_t_3)) {
           PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_v_attr_name, __pyx_v_attr_value};
-          __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 869, __pyx_L1_error)
+          __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 915, __pyx_L1_error)
           __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
           __Pyx_GOTREF(__pyx_t_2);
         } else
         #endif
         #if CYTHON_FAST_PYCCALL
         if (__Pyx_PyFastCFunction_Check(__pyx_t_3)) {
           PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_v_attr_name, __pyx_v_attr_value};
-          __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 869, __pyx_L1_error)
+          __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 915, __pyx_L1_error)
           __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
           __Pyx_GOTREF(__pyx_t_2);
         } else
         #endif
         {
-          __pyx_t_6 = PyTuple_New(2+__pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 869, __pyx_L1_error)
+          __pyx_t_6 = PyTuple_New(2+__pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 915, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
           if (__pyx_t_4) {
             __Pyx_GIVEREF(__pyx_t_4); PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_4); __pyx_t_4 = NULL;
           }
           __Pyx_INCREF(__pyx_v_attr_name);
           __Pyx_GIVEREF(__pyx_v_attr_name);
           PyTuple_SET_ITEM(__pyx_t_6, 0+__pyx_t_5, __pyx_v_attr_name);
           __Pyx_INCREF(__pyx_v_attr_value);
           __Pyx_GIVEREF(__pyx_v_attr_value);
           PyTuple_SET_ITEM(__pyx_t_6, 1+__pyx_t_5, __pyx_v_attr_value);
-          __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_6, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 869, __pyx_L1_error)
+          __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_6, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 915, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_2);
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         }
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         __pyx_r = __pyx_t_2;
         __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
@@ -11335,68 +11931,68 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "resiliparse/parse/html.pyx":882
+  /* "resiliparse/parse/html.pyx":928
  *         :raises ValueError: if node is not an Element node
  *         """
  *         if not check_node(self):             # <<<<<<<<<<<<<<
  *             return
  * 
  */
   __pyx_t_7 = ((!(__pyx_f_11resiliparse_5parse_4html_check_node(__pyx_v_self) != 0)) != 0);
   if (__pyx_t_7) {
 
-    /* "resiliparse/parse/html.pyx":883
+    /* "resiliparse/parse/html.pyx":929
  *         """
  *         if not check_node(self):
  *             return             # <<<<<<<<<<<<<<
  * 
  *         self._setattr_impl(attr_name.encode(), attr_value.encode())
  */
     __Pyx_XDECREF(__pyx_r);
     __pyx_r = Py_None; __Pyx_INCREF(Py_None);
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":882
+    /* "resiliparse/parse/html.pyx":928
  *         :raises ValueError: if node is not an Element node
  *         """
  *         if not check_node(self):             # <<<<<<<<<<<<<<
  *             return
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":885
+  /* "resiliparse/parse/html.pyx":931
  *             return
  * 
  *         self._setattr_impl(attr_name.encode(), attr_value.encode())             # <<<<<<<<<<<<<<
  * 
  *     def __setitem__(self, str attr_name, str attr_value):
  */
   if (unlikely(__pyx_v_attr_name == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "encode");
-    __PYX_ERR(0, 885, __pyx_L1_error)
+    __PYX_ERR(0, 931, __pyx_L1_error)
   }
-  __pyx_t_1 = PyUnicode_AsEncodedString(__pyx_v_attr_name, NULL, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 885, __pyx_L1_error)
+  __pyx_t_1 = PyUnicode_AsEncodedString(__pyx_v_attr_name, NULL, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 931, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   if (unlikely(__pyx_v_attr_value == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "encode");
-    __PYX_ERR(0, 885, __pyx_L1_error)
+    __PYX_ERR(0, 931, __pyx_L1_error)
   }
-  __pyx_t_2 = PyUnicode_AsEncodedString(__pyx_v_attr_value, NULL, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 885, __pyx_L1_error)
+  __pyx_t_2 = PyUnicode_AsEncodedString(__pyx_v_attr_value, NULL, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 931, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_7 = ((struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMNode *)__pyx_v_self->__pyx_vtab)->_setattr_impl(__pyx_v_self, ((PyObject*)__pyx_t_1), ((PyObject*)__pyx_t_2)); if (unlikely(__pyx_t_7 == ((int)-1))) __PYX_ERR(0, 885, __pyx_L1_error)
+  __pyx_t_7 = ((struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMNode *)__pyx_v_self->__pyx_vtab)->_setattr_impl(__pyx_v_self, ((PyObject*)__pyx_t_1), ((PyObject*)__pyx_t_2)); if (unlikely(__pyx_t_7 == ((int)-1))) __PYX_ERR(0, 931, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "resiliparse/parse/html.pyx":869
+  /* "resiliparse/parse/html.pyx":915
  *         return True
  * 
  *     cpdef setattr(self, str attr_name, str attr_value):             # <<<<<<<<<<<<<<
  *         """
  *         setattr(self, attr_name, attr_value)
  */
 
@@ -11448,39 +12044,39 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_attr_name)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_attr_value)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("setattr", 1, 2, 2, 1); __PYX_ERR(0, 869, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("setattr", 1, 2, 2, 1); __PYX_ERR(0, 915, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "setattr") < 0)) __PYX_ERR(0, 869, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "setattr") < 0)) __PYX_ERR(0, 915, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
     }
     __pyx_v_attr_name = ((PyObject*)values[0]);
     __pyx_v_attr_value = ((PyObject*)values[1]);
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("setattr", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 869, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("setattr", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 915, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("resiliparse.parse.html.DOMNode.setattr", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_attr_name), (&PyUnicode_Type), 1, "attr_name", 1))) __PYX_ERR(0, 869, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_attr_value), (&PyUnicode_Type), 1, "attr_value", 1))) __PYX_ERR(0, 869, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_attr_name), (&PyUnicode_Type), 1, "attr_name", 1))) __PYX_ERR(0, 915, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_attr_value), (&PyUnicode_Type), 1, "attr_value", 1))) __PYX_ERR(0, 915, __pyx_L1_error)
   __pyx_r = __pyx_pf_11resiliparse_5parse_4html_7DOMNode_13setattr(((struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *)__pyx_v_self), __pyx_v_attr_name, __pyx_v_attr_value);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -11493,15 +12089,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("setattr", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __pyx_f_11resiliparse_5parse_4html_7DOMNode_setattr(__pyx_v_self, __pyx_v_attr_name, __pyx_v_attr_value, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 869, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_11resiliparse_5parse_4html_7DOMNode_setattr(__pyx_v_self, __pyx_v_attr_name, __pyx_v_attr_value, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 915, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -11510,15 +12106,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":887
+/* "resiliparse/parse/html.pyx":933
  *         self._setattr_impl(attr_name.encode(), attr_value.encode())
  * 
  *     def __setitem__(self, str attr_name, str attr_value):             # <<<<<<<<<<<<<<
  *         """
  *         __setitem__(self, attr_name, attr_value)
  */
 
@@ -11531,16 +12127,16 @@
 static int __pyx_pw_11resiliparse_5parse_4html_7DOMNode_16__setitem__(PyObject *__pyx_v_self, PyObject *__pyx_v_attr_name, PyObject *__pyx_v_attr_value) {
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__setitem__ (wrapper)", 0);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_attr_name), (&PyUnicode_Type), 1, "attr_name", 1))) __PYX_ERR(0, 887, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_attr_value), (&PyUnicode_Type), 1, "attr_value", 1))) __PYX_ERR(0, 887, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_attr_name), (&PyUnicode_Type), 1, "attr_name", 1))) __PYX_ERR(0, 933, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_attr_value), (&PyUnicode_Type), 1, "attr_value", 1))) __PYX_ERR(0, 933, __pyx_L1_error)
   __pyx_r = __pyx_pf_11resiliparse_5parse_4html_7DOMNode_15__setitem__(((struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *)__pyx_v_self), ((PyObject*)__pyx_v_attr_name), ((PyObject*)__pyx_v_attr_value));
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = -1;
   __pyx_L0:;
@@ -11555,67 +12151,67 @@
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__setitem__", 0);
 
-  /* "resiliparse/parse/html.pyx":900
+  /* "resiliparse/parse/html.pyx":946
  *         :raises ValueError: if node is not an Element node
  *         """
  *         if not check_node(self):             # <<<<<<<<<<<<<<
  *             return
  * 
  */
   __pyx_t_1 = ((!(__pyx_f_11resiliparse_5parse_4html_check_node(__pyx_v_self) != 0)) != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/parse/html.pyx":901
+    /* "resiliparse/parse/html.pyx":947
  *         """
  *         if not check_node(self):
  *             return             # <<<<<<<<<<<<<<
  * 
  *         self._setattr_impl(attr_name.encode(), attr_value.encode())
  */
     __pyx_r = 0;
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":900
+    /* "resiliparse/parse/html.pyx":946
  *         :raises ValueError: if node is not an Element node
  *         """
  *         if not check_node(self):             # <<<<<<<<<<<<<<
  *             return
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":903
+  /* "resiliparse/parse/html.pyx":949
  *             return
  * 
  *         self._setattr_impl(attr_name.encode(), attr_value.encode())             # <<<<<<<<<<<<<<
  * 
  *     cdef bint _delattr_impl(self, bytes attr_name) except -1:
  */
   if (unlikely(__pyx_v_attr_name == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "encode");
-    __PYX_ERR(0, 903, __pyx_L1_error)
+    __PYX_ERR(0, 949, __pyx_L1_error)
   }
-  __pyx_t_2 = PyUnicode_AsEncodedString(__pyx_v_attr_name, NULL, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 903, __pyx_L1_error)
+  __pyx_t_2 = PyUnicode_AsEncodedString(__pyx_v_attr_name, NULL, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 949, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   if (unlikely(__pyx_v_attr_value == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "encode");
-    __PYX_ERR(0, 903, __pyx_L1_error)
+    __PYX_ERR(0, 949, __pyx_L1_error)
   }
-  __pyx_t_3 = PyUnicode_AsEncodedString(__pyx_v_attr_value, NULL, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 903, __pyx_L1_error)
+  __pyx_t_3 = PyUnicode_AsEncodedString(__pyx_v_attr_value, NULL, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 949, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_1 = ((struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMNode *)__pyx_v_self->__pyx_vtab)->_setattr_impl(__pyx_v_self, ((PyObject*)__pyx_t_2), ((PyObject*)__pyx_t_3)); if (unlikely(__pyx_t_1 == ((int)-1))) __PYX_ERR(0, 903, __pyx_L1_error)
+  __pyx_t_1 = ((struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMNode *)__pyx_v_self->__pyx_vtab)->_setattr_impl(__pyx_v_self, ((PyObject*)__pyx_t_2), ((PyObject*)__pyx_t_3)); if (unlikely(__pyx_t_1 == ((int)-1))) __PYX_ERR(0, 949, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
 
-  /* "resiliparse/parse/html.pyx":887
+  /* "resiliparse/parse/html.pyx":933
  *         self._setattr_impl(attr_name.encode(), attr_value.encode())
  * 
  *     def __setitem__(self, str attr_name, str attr_value):             # <<<<<<<<<<<<<<
  *         """
  *         __setitem__(self, attr_name, attr_value)
  */
 
@@ -11628,15 +12224,15 @@
   __Pyx_AddTraceback("resiliparse.parse.html.DOMNode.__setitem__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = -1;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":905
+/* "resiliparse/parse/html.pyx":951
  *         self._setattr_impl(attr_name.encode(), attr_value.encode())
  * 
  *     cdef bint _delattr_impl(self, bytes attr_name) except -1:             # <<<<<<<<<<<<<<
  *         """
  *         Remove the given attribute.
  */
 
@@ -11650,15 +12246,15 @@
   lxb_char_t *__pyx_t_4;
   Py_ssize_t __pyx_t_5;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_delattr_impl", 0);
 
-  /* "resiliparse/parse/html.pyx":911
+  /* "resiliparse/parse/html.pyx":957
  *         :param attr_name: attribute to remove
  *         """
  *         if not check_node(self) or self.node.type != LXB_DOM_NODE_TYPE_ELEMENT:             # <<<<<<<<<<<<<<
  *             raise ValueError('Node ist not an Element node.')
  * 
  */
   __pyx_t_2 = ((!(__pyx_f_11resiliparse_5parse_4html_check_node(__pyx_v_self) != 0)) != 0);
@@ -11668,112 +12264,112 @@
     goto __pyx_L4_bool_binop_done;
   }
   __pyx_t_2 = ((__pyx_v_self->node->type != LXB_DOM_NODE_TYPE_ELEMENT) != 0);
   __pyx_t_1 = __pyx_t_2;
   __pyx_L4_bool_binop_done:;
   if (unlikely(__pyx_t_1)) {
 
-    /* "resiliparse/parse/html.pyx":912
+    /* "resiliparse/parse/html.pyx":958
  *         """
  *         if not check_node(self) or self.node.type != LXB_DOM_NODE_TYPE_ELEMENT:
  *             raise ValueError('Node ist not an Element node.')             # <<<<<<<<<<<<<<
  * 
  *         cdef lxb_dom_attr_t* attr = lxb_dom_element_attr_is_exist(<lxb_dom_element_t*>self.node,
  */
-    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__8, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 912, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__11, NULL); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 958, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_Raise(__pyx_t_3, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-    __PYX_ERR(0, 912, __pyx_L1_error)
+    __PYX_ERR(0, 958, __pyx_L1_error)
 
-    /* "resiliparse/parse/html.pyx":911
+    /* "resiliparse/parse/html.pyx":957
  *         :param attr_name: attribute to remove
  *         """
  *         if not check_node(self) or self.node.type != LXB_DOM_NODE_TYPE_ELEMENT:             # <<<<<<<<<<<<<<
  *             raise ValueError('Node ist not an Element node.')
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":915
+  /* "resiliparse/parse/html.pyx":961
  * 
  *         cdef lxb_dom_attr_t* attr = lxb_dom_element_attr_is_exist(<lxb_dom_element_t*>self.node,
  *                                                                   <lxb_char_t*>attr_name, len(attr_name))             # <<<<<<<<<<<<<<
  *         if not attr:
  *             return False
  */
   if (unlikely(__pyx_v_attr_name == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "expected bytes, NoneType found");
-    __PYX_ERR(0, 915, __pyx_L1_error)
+    __PYX_ERR(0, 961, __pyx_L1_error)
   }
-  __pyx_t_4 = __Pyx_PyBytes_AsWritableUString(__pyx_v_attr_name); if (unlikely((!__pyx_t_4) && PyErr_Occurred())) __PYX_ERR(0, 915, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyBytes_AsWritableUString(__pyx_v_attr_name); if (unlikely((!__pyx_t_4) && PyErr_Occurred())) __PYX_ERR(0, 961, __pyx_L1_error)
   if (unlikely(__pyx_v_attr_name == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-    __PYX_ERR(0, 915, __pyx_L1_error)
+    __PYX_ERR(0, 961, __pyx_L1_error)
   }
-  __pyx_t_5 = PyBytes_GET_SIZE(__pyx_v_attr_name); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 915, __pyx_L1_error)
+  __pyx_t_5 = PyBytes_GET_SIZE(__pyx_v_attr_name); if (unlikely(__pyx_t_5 == ((Py_ssize_t)-1))) __PYX_ERR(0, 961, __pyx_L1_error)
 
-  /* "resiliparse/parse/html.pyx":914
+  /* "resiliparse/parse/html.pyx":960
  *             raise ValueError('Node ist not an Element node.')
  * 
  *         cdef lxb_dom_attr_t* attr = lxb_dom_element_attr_is_exist(<lxb_dom_element_t*>self.node,             # <<<<<<<<<<<<<<
  *                                                                   <lxb_char_t*>attr_name, len(attr_name))
  *         if not attr:
  */
   __pyx_v_attr = lxb_dom_element_attr_is_exist(((lxb_dom_element_t *)__pyx_v_self->node), ((lxb_char_t *)__pyx_t_4), __pyx_t_5);
 
-  /* "resiliparse/parse/html.pyx":916
+  /* "resiliparse/parse/html.pyx":962
  *         cdef lxb_dom_attr_t* attr = lxb_dom_element_attr_is_exist(<lxb_dom_element_t*>self.node,
  *                                                                   <lxb_char_t*>attr_name, len(attr_name))
  *         if not attr:             # <<<<<<<<<<<<<<
  *             return False
  * 
  */
   __pyx_t_1 = ((!(__pyx_v_attr != 0)) != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/parse/html.pyx":917
+    /* "resiliparse/parse/html.pyx":963
  *                                                                   <lxb_char_t*>attr_name, len(attr_name))
  *         if not attr:
  *             return False             # <<<<<<<<<<<<<<
  * 
  *         lxb_dom_element_attr_remove(<lxb_dom_element_t*>self.node, attr)
  */
     __pyx_r = 0;
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":916
+    /* "resiliparse/parse/html.pyx":962
  *         cdef lxb_dom_attr_t* attr = lxb_dom_element_attr_is_exist(<lxb_dom_element_t*>self.node,
  *                                                                   <lxb_char_t*>attr_name, len(attr_name))
  *         if not attr:             # <<<<<<<<<<<<<<
  *             return False
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":919
+  /* "resiliparse/parse/html.pyx":965
  *             return False
  * 
  *         lxb_dom_element_attr_remove(<lxb_dom_element_t*>self.node, attr)             # <<<<<<<<<<<<<<
  *         return True
  * 
  */
   (void)(lxb_dom_element_attr_remove(((lxb_dom_element_t *)__pyx_v_self->node), __pyx_v_attr));
 
-  /* "resiliparse/parse/html.pyx":920
+  /* "resiliparse/parse/html.pyx":966
  * 
  *         lxb_dom_element_attr_remove(<lxb_dom_element_t*>self.node, attr)
  *         return True             # <<<<<<<<<<<<<<
  * 
  *     cpdef delattr(self, str attr_name):
  */
   __pyx_r = 1;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":905
+  /* "resiliparse/parse/html.pyx":951
  *         self._setattr_impl(attr_name.encode(), attr_value.encode())
  * 
  *     cdef bint _delattr_impl(self, bytes attr_name) except -1:             # <<<<<<<<<<<<<<
  *         """
  *         Remove the given attribute.
  */
 
@@ -11783,15 +12379,15 @@
   __Pyx_AddTraceback("resiliparse.parse.html.DOMNode._delattr_impl", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = -1;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":922
+/* "resiliparse/parse/html.pyx":968
  *         return True
  * 
  *     cpdef delattr(self, str attr_name):             # <<<<<<<<<<<<<<
  *         """
  *         delattr(self, attr_name)
  */
 
@@ -11813,15 +12409,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_delattr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 922, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_delattr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 968, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_11resiliparse_5parse_4html_7DOMNode_18delattr)) {
         __Pyx_XDECREF(__pyx_r);
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
@@ -11830,15 +12426,15 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_v_attr_name) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_attr_name);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 922, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 968, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         __pyx_r = __pyx_t_2;
         __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
@@ -11851,31 +12447,31 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "resiliparse/parse/html.pyx":932
+  /* "resiliparse/parse/html.pyx":978
  *         :raises ValueError: if node is not an Element node
  *         """
  *         self._delattr_impl(attr_name.encode())             # <<<<<<<<<<<<<<
  * 
  *     def __delitem__(self, str attr_name):
  */
   if (unlikely(__pyx_v_attr_name == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "encode");
-    __PYX_ERR(0, 932, __pyx_L1_error)
+    __PYX_ERR(0, 978, __pyx_L1_error)
   }
-  __pyx_t_1 = PyUnicode_AsEncodedString(__pyx_v_attr_name, NULL, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 932, __pyx_L1_error)
+  __pyx_t_1 = PyUnicode_AsEncodedString(__pyx_v_attr_name, NULL, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 978, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_5 = ((struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMNode *)__pyx_v_self->__pyx_vtab)->_delattr_impl(__pyx_v_self, ((PyObject*)__pyx_t_1)); if (unlikely(__pyx_t_5 == ((int)-1))) __PYX_ERR(0, 932, __pyx_L1_error)
+  __pyx_t_5 = ((struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMNode *)__pyx_v_self->__pyx_vtab)->_delattr_impl(__pyx_v_self, ((PyObject*)__pyx_t_1)); if (unlikely(__pyx_t_5 == ((int)-1))) __PYX_ERR(0, 978, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "resiliparse/parse/html.pyx":922
+  /* "resiliparse/parse/html.pyx":968
  *         return True
  * 
  *     cpdef delattr(self, str attr_name):             # <<<<<<<<<<<<<<
  *         """
  *         delattr(self, attr_name)
  */
 
@@ -11901,15 +12497,15 @@
 static PyObject *__pyx_pw_11resiliparse_5parse_4html_7DOMNode_18delattr(PyObject *__pyx_v_self, PyObject *__pyx_v_attr_name) {
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("delattr (wrapper)", 0);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_attr_name), (&PyUnicode_Type), 1, "attr_name", 1))) __PYX_ERR(0, 922, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_attr_name), (&PyUnicode_Type), 1, "attr_name", 1))) __PYX_ERR(0, 968, __pyx_L1_error)
   __pyx_r = __pyx_pf_11resiliparse_5parse_4html_7DOMNode_17delattr(((struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *)__pyx_v_self), ((PyObject*)__pyx_v_attr_name));
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -11922,15 +12518,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("delattr", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __pyx_f_11resiliparse_5parse_4html_7DOMNode_delattr(__pyx_v_self, __pyx_v_attr_name, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 922, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_11resiliparse_5parse_4html_7DOMNode_delattr(__pyx_v_self, __pyx_v_attr_name, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 968, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -11939,15 +12535,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":934
+/* "resiliparse/parse/html.pyx":980
  *         self._delattr_impl(attr_name.encode())
  * 
  *     def __delitem__(self, str attr_name):             # <<<<<<<<<<<<<<
  *         """
  *         __delitem__(self, attr_name)
  */
 
@@ -11960,15 +12556,15 @@
 static int __pyx_pw_11resiliparse_5parse_4html_7DOMNode_20__delitem__(PyObject *__pyx_v_self, PyObject *__pyx_v_attr_name) {
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__delitem__ (wrapper)", 0);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_attr_name), (&PyUnicode_Type), 1, "attr_name", 1))) __PYX_ERR(0, 934, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_attr_name), (&PyUnicode_Type), 1, "attr_name", 1))) __PYX_ERR(0, 980, __pyx_L1_error)
   __pyx_r = __pyx_pf_11resiliparse_5parse_4html_7DOMNode_19__delitem__(((struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *)__pyx_v_self), ((PyObject*)__pyx_v_attr_name));
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = -1;
   __pyx_L0:;
@@ -11984,70 +12580,70 @@
   int __pyx_t_2;
   PyObject *__pyx_t_3 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__delitem__", 0);
 
-  /* "resiliparse/parse/html.pyx":945
+  /* "resiliparse/parse/html.pyx":991
  *         :raises KeyError: if node
  *         """
  *         cdef bint ret = self._delattr_impl(attr_name.encode())             # <<<<<<<<<<<<<<
  *         if not ret:
  *             raise KeyError(f'No such attribute: {attr_name}')
  */
   if (unlikely(__pyx_v_attr_name == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "encode");
-    __PYX_ERR(0, 945, __pyx_L1_error)
+    __PYX_ERR(0, 991, __pyx_L1_error)
   }
-  __pyx_t_1 = PyUnicode_AsEncodedString(__pyx_v_attr_name, NULL, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 945, __pyx_L1_error)
+  __pyx_t_1 = PyUnicode_AsEncodedString(__pyx_v_attr_name, NULL, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 991, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = ((struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMNode *)__pyx_v_self->__pyx_vtab)->_delattr_impl(__pyx_v_self, ((PyObject*)__pyx_t_1)); if (unlikely(__pyx_t_2 == ((int)-1))) __PYX_ERR(0, 945, __pyx_L1_error)
+  __pyx_t_2 = ((struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMNode *)__pyx_v_self->__pyx_vtab)->_delattr_impl(__pyx_v_self, ((PyObject*)__pyx_t_1)); if (unlikely(__pyx_t_2 == ((int)-1))) __PYX_ERR(0, 991, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_ret = __pyx_t_2;
 
-  /* "resiliparse/parse/html.pyx":946
+  /* "resiliparse/parse/html.pyx":992
  *         """
  *         cdef bint ret = self._delattr_impl(attr_name.encode())
  *         if not ret:             # <<<<<<<<<<<<<<
  *             raise KeyError(f'No such attribute: {attr_name}')
  * 
  */
   __pyx_t_2 = ((!(__pyx_v_ret != 0)) != 0);
   if (unlikely(__pyx_t_2)) {
 
-    /* "resiliparse/parse/html.pyx":947
+    /* "resiliparse/parse/html.pyx":993
  *         cdef bint ret = self._delattr_impl(attr_name.encode())
  *         if not ret:
  *             raise KeyError(f'No such attribute: {attr_name}')             # <<<<<<<<<<<<<<
  * 
  *     cpdef DOMNode query_selector(self, str selector):
  */
-    __pyx_t_1 = __Pyx_PyUnicode_Unicode(__pyx_v_attr_name); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 947, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyUnicode_Unicode(__pyx_v_attr_name); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 993, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_3 = __Pyx_PyUnicode_Concat(__pyx_kp_u_No_such_attribute, __pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 947, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyUnicode_Concat(__pyx_kp_u_No_such_attribute, __pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 993, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_builtin_KeyError, __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 947, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_CallOneArg(__pyx_builtin_KeyError, __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 993, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 947, __pyx_L1_error)
+    __PYX_ERR(0, 993, __pyx_L1_error)
 
-    /* "resiliparse/parse/html.pyx":946
+    /* "resiliparse/parse/html.pyx":992
  *         """
  *         cdef bint ret = self._delattr_impl(attr_name.encode())
  *         if not ret:             # <<<<<<<<<<<<<<
  *             raise KeyError(f'No such attribute: {attr_name}')
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":934
+  /* "resiliparse/parse/html.pyx":980
  *         self._delattr_impl(attr_name.encode())
  * 
  *     def __delitem__(self, str attr_name):             # <<<<<<<<<<<<<<
  *         """
  *         __delitem__(self, attr_name)
  */
 
@@ -12060,15 +12656,15 @@
   __Pyx_AddTraceback("resiliparse.parse.html.DOMNode.__delitem__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = -1;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":949
+/* "resiliparse/parse/html.pyx":995
  *             raise KeyError(f'No such attribute: {attr_name}')
  * 
  *     cpdef DOMNode query_selector(self, str selector):             # <<<<<<<<<<<<<<
  *         """
  *         query_selector(self, selector)
  */
 
@@ -12077,29 +12673,30 @@
   lxb_dom_node_t *__pyx_v_node;
   struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
-  int __pyx_t_5;
+  lxb_dom_node_t *__pyx_t_5;
+  int __pyx_t_6;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("query_selector", 0);
   /* Check if called by wrapper */
   if (unlikely(__pyx_skip_dispatch)) ;
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_query_selector); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 949, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_query_selector); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 995, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_11resiliparse_5parse_4html_7DOMNode_22query_selector)) {
         __Pyx_XDECREF(((PyObject *)__pyx_r));
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
@@ -12108,18 +12705,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_v_selector) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_selector);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 949, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 995, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_11resiliparse_5parse_4html_DOMNode))))) __PYX_ERR(0, 949, __pyx_L1_error)
+        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_11resiliparse_5parse_4html_DOMNode))))) __PYX_ERR(0, 995, __pyx_L1_error)
         __pyx_r = ((struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *)__pyx_t_2);
         __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -12130,81 +12727,82 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "resiliparse/parse/html.pyx":961
+  /* "resiliparse/parse/html.pyx":1007
  *         :rtype: DOMNode or None
  *         """
  *         cdef lxb_dom_node_t* node = query_selector_impl(self.node, self.tree, selector.encode())             # <<<<<<<<<<<<<<
  *         if not node:
  *             return None
  */
   __pyx_t_1 = ((PyObject *)__pyx_v_self->tree);
   __Pyx_INCREF(__pyx_t_1);
   if (unlikely(__pyx_v_selector == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "encode");
-    __PYX_ERR(0, 961, __pyx_L1_error)
+    __PYX_ERR(0, 1007, __pyx_L1_error)
   }
-  __pyx_t_2 = PyUnicode_AsEncodedString(__pyx_v_selector, NULL, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 961, __pyx_L1_error)
+  __pyx_t_2 = PyUnicode_AsEncodedString(__pyx_v_selector, NULL, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1007, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_v_node = __pyx_f_11resiliparse_5parse_4html_query_selector_impl(__pyx_v_self->node, ((struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *)__pyx_t_1), ((PyObject*)__pyx_t_2));
+  __pyx_t_5 = __pyx_f_11resiliparse_5parse_4html_query_selector_impl(__pyx_v_self->node, ((struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *)__pyx_t_1), ((PyObject*)__pyx_t_2)); if (unlikely(__pyx_t_5 == ((lxb_dom_node_t *)((lxb_dom_node_t *)-1L)))) __PYX_ERR(0, 1007, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_v_node = __pyx_t_5;
 
-  /* "resiliparse/parse/html.pyx":962
+  /* "resiliparse/parse/html.pyx":1008
  *         """
  *         cdef lxb_dom_node_t* node = query_selector_impl(self.node, self.tree, selector.encode())
  *         if not node:             # <<<<<<<<<<<<<<
  *             return None
  *         return _create_dom_node(self.tree, node)
  */
-  __pyx_t_5 = ((!(__pyx_v_node != 0)) != 0);
-  if (__pyx_t_5) {
+  __pyx_t_6 = ((!(__pyx_v_node != 0)) != 0);
+  if (__pyx_t_6) {
 
-    /* "resiliparse/parse/html.pyx":963
+    /* "resiliparse/parse/html.pyx":1009
  *         cdef lxb_dom_node_t* node = query_selector_impl(self.node, self.tree, selector.encode())
  *         if not node:
  *             return None             # <<<<<<<<<<<<<<
  *         return _create_dom_node(self.tree, node)
  * 
  */
     __Pyx_XDECREF(((PyObject *)__pyx_r));
     __pyx_r = ((struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *)Py_None); __Pyx_INCREF(Py_None);
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":962
+    /* "resiliparse/parse/html.pyx":1008
  *         """
  *         cdef lxb_dom_node_t* node = query_selector_impl(self.node, self.tree, selector.encode())
  *         if not node:             # <<<<<<<<<<<<<<
  *             return None
  *         return _create_dom_node(self.tree, node)
  */
   }
 
-  /* "resiliparse/parse/html.pyx":964
+  /* "resiliparse/parse/html.pyx":1010
  *         if not node:
  *             return None
  *         return _create_dom_node(self.tree, node)             # <<<<<<<<<<<<<<
  * 
  *     cpdef DOMCollection query_selector_all(self, str selector):
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
   __pyx_t_2 = ((PyObject *)__pyx_v_self->tree);
   __Pyx_INCREF(__pyx_t_2);
-  __pyx_t_1 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html__create_dom_node(((struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *)__pyx_t_2), __pyx_v_node)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 964, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html__create_dom_node(((struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *)__pyx_t_2), __pyx_v_node)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1010, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_r = ((struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *)__pyx_t_1);
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":949
+  /* "resiliparse/parse/html.pyx":995
  *             raise KeyError(f'No such attribute: {attr_name}')
  * 
  *     cpdef DOMNode query_selector(self, str selector):             # <<<<<<<<<<<<<<
  *         """
  *         query_selector(self, selector)
  */
 
@@ -12228,15 +12826,15 @@
 static PyObject *__pyx_pw_11resiliparse_5parse_4html_7DOMNode_22query_selector(PyObject *__pyx_v_self, PyObject *__pyx_v_selector) {
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("query_selector (wrapper)", 0);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_selector), (&PyUnicode_Type), 1, "selector", 1))) __PYX_ERR(0, 949, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_selector), (&PyUnicode_Type), 1, "selector", 1))) __PYX_ERR(0, 995, __pyx_L1_error)
   __pyx_r = __pyx_pf_11resiliparse_5parse_4html_7DOMNode_21query_selector(((struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *)__pyx_v_self), ((PyObject*)__pyx_v_selector));
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -12249,15 +12847,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("query_selector", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html_7DOMNode_query_selector(__pyx_v_self, __pyx_v_selector, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 949, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html_7DOMNode_query_selector(__pyx_v_self, __pyx_v_selector, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 995, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -12266,15 +12864,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":966
+/* "resiliparse/parse/html.pyx":1012
  *         return _create_dom_node(self.tree, node)
  * 
  *     cpdef DOMCollection query_selector_all(self, str selector):             # <<<<<<<<<<<<<<
  *         """
  *         query_selector_all(self, selector)
  */
 
@@ -12283,29 +12881,30 @@
   lxb_dom_collection_t *__pyx_v_coll;
   struct __pyx_obj_11resiliparse_5parse_4html_DOMCollection *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   PyObject *__pyx_t_4 = NULL;
-  int __pyx_t_5;
+  lxb_dom_collection_t *__pyx_t_5;
+  int __pyx_t_6;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("query_selector_all", 0);
   /* Check if called by wrapper */
   if (unlikely(__pyx_skip_dispatch)) ;
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_query_selector_all); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 966, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_query_selector_all); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1012, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_11resiliparse_5parse_4html_7DOMNode_24query_selector_all)) {
         __Pyx_XDECREF(((PyObject *)__pyx_r));
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
@@ -12314,18 +12913,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_v_selector) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_selector);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 966, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1012, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_11resiliparse_5parse_4html_DOMCollection))))) __PYX_ERR(0, 966, __pyx_L1_error)
+        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_11resiliparse_5parse_4html_DOMCollection))))) __PYX_ERR(0, 1012, __pyx_L1_error)
         __pyx_r = ((struct __pyx_obj_11resiliparse_5parse_4html_DOMCollection *)__pyx_t_2);
         __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -12336,83 +12935,84 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "resiliparse/parse/html.pyx":977
+  /* "resiliparse/parse/html.pyx":1023
  *         :rtype: DOMCollection
  *         """
  *         cdef lxb_dom_collection_t* coll = query_selector_all_impl(self.node, self.tree, selector.encode())             # <<<<<<<<<<<<<<
  *         if not coll:
  *             raise RuntimeError('Failed to match elements by CSS selector')
  */
   __pyx_t_1 = ((PyObject *)__pyx_v_self->tree);
   __Pyx_INCREF(__pyx_t_1);
   if (unlikely(__pyx_v_selector == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "encode");
-    __PYX_ERR(0, 977, __pyx_L1_error)
+    __PYX_ERR(0, 1023, __pyx_L1_error)
   }
-  __pyx_t_2 = PyUnicode_AsEncodedString(__pyx_v_selector, NULL, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 977, __pyx_L1_error)
+  __pyx_t_2 = PyUnicode_AsEncodedString(__pyx_v_selector, NULL, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1023, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_v_coll = __pyx_f_11resiliparse_5parse_4html_query_selector_all_impl(__pyx_v_self->node, ((struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *)__pyx_t_1), ((PyObject*)__pyx_t_2), NULL);
+  __pyx_t_5 = __pyx_f_11resiliparse_5parse_4html_query_selector_all_impl(__pyx_v_self->node, ((struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *)__pyx_t_1), ((PyObject*)__pyx_t_2), NULL); if (unlikely(__pyx_t_5 == ((lxb_dom_collection_t *)((lxb_dom_collection_t *)-1L)))) __PYX_ERR(0, 1023, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
+  __pyx_v_coll = __pyx_t_5;
 
-  /* "resiliparse/parse/html.pyx":978
+  /* "resiliparse/parse/html.pyx":1024
  *         """
  *         cdef lxb_dom_collection_t* coll = query_selector_all_impl(self.node, self.tree, selector.encode())
  *         if not coll:             # <<<<<<<<<<<<<<
  *             raise RuntimeError('Failed to match elements by CSS selector')
  * 
  */
-  __pyx_t_5 = ((!(__pyx_v_coll != 0)) != 0);
-  if (unlikely(__pyx_t_5)) {
+  __pyx_t_6 = ((!(__pyx_v_coll != 0)) != 0);
+  if (unlikely(__pyx_t_6)) {
 
-    /* "resiliparse/parse/html.pyx":979
+    /* "resiliparse/parse/html.pyx":1025
  *         cdef lxb_dom_collection_t* coll = query_selector_all_impl(self.node, self.tree, selector.encode())
  *         if not coll:
  *             raise RuntimeError('Failed to match elements by CSS selector')             # <<<<<<<<<<<<<<
  * 
  *         return _create_dom_collection(self.tree, coll)
  */
-    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_RuntimeError, __pyx_tuple__9, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 979, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_RuntimeError, __pyx_tuple__12, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1025, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_Raise(__pyx_t_2, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __PYX_ERR(0, 979, __pyx_L1_error)
+    __PYX_ERR(0, 1025, __pyx_L1_error)
 
-    /* "resiliparse/parse/html.pyx":978
+    /* "resiliparse/parse/html.pyx":1024
  *         """
  *         cdef lxb_dom_collection_t* coll = query_selector_all_impl(self.node, self.tree, selector.encode())
  *         if not coll:             # <<<<<<<<<<<<<<
  *             raise RuntimeError('Failed to match elements by CSS selector')
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":981
+  /* "resiliparse/parse/html.pyx":1027
  *             raise RuntimeError('Failed to match elements by CSS selector')
  * 
  *         return _create_dom_collection(self.tree, coll)             # <<<<<<<<<<<<<<
  * 
  *     cpdef bint matches(self, str selector) except -1:
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
   __pyx_t_2 = ((PyObject *)__pyx_v_self->tree);
   __Pyx_INCREF(__pyx_t_2);
-  __pyx_t_1 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html__create_dom_collection(((struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *)__pyx_t_2), __pyx_v_coll)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 981, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html__create_dom_collection(((struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *)__pyx_t_2), __pyx_v_coll)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1027, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_r = ((struct __pyx_obj_11resiliparse_5parse_4html_DOMCollection *)__pyx_t_1);
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":966
+  /* "resiliparse/parse/html.pyx":1012
  *         return _create_dom_node(self.tree, node)
  * 
  *     cpdef DOMCollection query_selector_all(self, str selector):             # <<<<<<<<<<<<<<
  *         """
  *         query_selector_all(self, selector)
  */
 
@@ -12436,15 +13036,15 @@
 static PyObject *__pyx_pw_11resiliparse_5parse_4html_7DOMNode_24query_selector_all(PyObject *__pyx_v_self, PyObject *__pyx_v_selector) {
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("query_selector_all (wrapper)", 0);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_selector), (&PyUnicode_Type), 1, "selector", 1))) __PYX_ERR(0, 966, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_selector), (&PyUnicode_Type), 1, "selector", 1))) __PYX_ERR(0, 1012, __pyx_L1_error)
   __pyx_r = __pyx_pf_11resiliparse_5parse_4html_7DOMNode_23query_selector_all(((struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *)__pyx_v_self), ((PyObject*)__pyx_v_selector));
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -12457,15 +13057,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("query_selector_all", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html_7DOMNode_query_selector_all(__pyx_v_self, __pyx_v_selector, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 966, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html_7DOMNode_query_selector_all(__pyx_v_self, __pyx_v_selector, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1012, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -12474,15 +13074,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":983
+/* "resiliparse/parse/html.pyx":1029
  *         return _create_dom_collection(self.tree, coll)
  * 
  *     cpdef bint matches(self, str selector) except -1:             # <<<<<<<<<<<<<<
  *         """
  *         matches(self, selector)
  */
 
@@ -12504,15 +13104,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_matches); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 983, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_matches); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1029, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_11resiliparse_5parse_4html_7DOMNode_26matches)) {
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_4)) {
@@ -12520,18 +13120,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_v_selector) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_selector);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 983, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1029, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_5 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 983, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_5 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 1029, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __pyx_r = __pyx_t_5;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -12542,44 +13142,44 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "resiliparse/parse/html.pyx":995
+  /* "resiliparse/parse/html.pyx":1041
  *         :rtype: bool
  *         """
  *         self.tree.init_css_parser()             # <<<<<<<<<<<<<<
  *         return matches_impl(self.node, self.tree, selector.encode())
  * 
  */
-  ((struct __pyx_vtabstruct_11resiliparse_5parse_4html_HTMLTree *)__pyx_v_self->tree->__pyx_vtab)->init_css_parser(__pyx_v_self->tree);
+  __pyx_f_11resiliparse_5parse_4html_8HTMLTree_init_css_parser(__pyx_v_self->tree);
 
-  /* "resiliparse/parse/html.pyx":996
+  /* "resiliparse/parse/html.pyx":1042
  *         """
  *         self.tree.init_css_parser()
  *         return matches_impl(self.node, self.tree, selector.encode())             # <<<<<<<<<<<<<<
  * 
  *     cpdef DOMCollection get_elements_by_attr(self, str attr_name, str attr_value, bint case_insensitive=False):
  */
   __pyx_t_1 = ((PyObject *)__pyx_v_self->tree);
   __Pyx_INCREF(__pyx_t_1);
   if (unlikely(__pyx_v_selector == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "encode");
-    __PYX_ERR(0, 996, __pyx_L1_error)
+    __PYX_ERR(0, 1042, __pyx_L1_error)
   }
-  __pyx_t_2 = PyUnicode_AsEncodedString(__pyx_v_selector, NULL, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 996, __pyx_L1_error)
+  __pyx_t_2 = PyUnicode_AsEncodedString(__pyx_v_selector, NULL, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1042, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_r = __pyx_f_11resiliparse_5parse_4html_matches_impl(__pyx_v_self->node, ((struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *)__pyx_t_1), ((PyObject*)__pyx_t_2));
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":983
+  /* "resiliparse/parse/html.pyx":1029
  *         return _create_dom_collection(self.tree, coll)
  * 
  *     cpdef bint matches(self, str selector) except -1:             # <<<<<<<<<<<<<<
  *         """
  *         matches(self, selector)
  */
 
@@ -12602,15 +13202,15 @@
 static PyObject *__pyx_pw_11resiliparse_5parse_4html_7DOMNode_26matches(PyObject *__pyx_v_self, PyObject *__pyx_v_selector) {
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("matches (wrapper)", 0);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_selector), (&PyUnicode_Type), 1, "selector", 1))) __PYX_ERR(0, 983, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_selector), (&PyUnicode_Type), 1, "selector", 1))) __PYX_ERR(0, 1029, __pyx_L1_error)
   __pyx_r = __pyx_pf_11resiliparse_5parse_4html_7DOMNode_25matches(((struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *)__pyx_v_self), ((PyObject*)__pyx_v_selector));
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -12624,16 +13224,16 @@
   int __pyx_t_1;
   PyObject *__pyx_t_2 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("matches", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __pyx_f_11resiliparse_5parse_4html_7DOMNode_matches(__pyx_v_self, __pyx_v_selector, 1); if (unlikely(__pyx_t_1 == ((int)-1))) __PYX_ERR(0, 983, __pyx_L1_error)
-  __pyx_t_2 = __Pyx_PyBool_FromLong(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 983, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_11resiliparse_5parse_4html_7DOMNode_matches(__pyx_v_self, __pyx_v_selector, 1); if (unlikely(__pyx_t_1 == ((int)-1))) __PYX_ERR(0, 1029, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyBool_FromLong(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1029, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_r = __pyx_t_2;
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -12642,15 +13242,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":998
+/* "resiliparse/parse/html.pyx":1044
  *         return matches_impl(self.node, self.tree, selector.encode())
  * 
  *     cpdef DOMCollection get_elements_by_attr(self, str attr_name, str attr_value, bint case_insensitive=False):             # <<<<<<<<<<<<<<
  *         """
  *         get_elements_by_attr(self, attr_name, attr_value, case_insensitive=False)
  */
 
@@ -12683,19 +13283,19 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_get_elements_by_attr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 998, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_get_elements_by_attr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1044, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_11resiliparse_5parse_4html_7DOMNode_28get_elements_by_attr)) {
         __Pyx_XDECREF(((PyObject *)__pyx_r));
-        __pyx_t_3 = __Pyx_PyBool_FromLong(__pyx_v_case_insensitive); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 998, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyBool_FromLong(__pyx_v_case_insensitive); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1044, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_4 = __pyx_t_1; __pyx_t_5 = NULL;
         __pyx_t_6 = 0;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
           __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
           if (likely(__pyx_t_5)) {
@@ -12705,50 +13305,50 @@
             __Pyx_DECREF_SET(__pyx_t_4, function);
             __pyx_t_6 = 1;
           }
         }
         #if CYTHON_FAST_PYCALL
         if (PyFunction_Check(__pyx_t_4)) {
           PyObject *__pyx_temp[4] = {__pyx_t_5, __pyx_v_attr_name, __pyx_v_attr_value, __pyx_t_3};
-          __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_6, 3+__pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 998, __pyx_L1_error)
+          __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_6, 3+__pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1044, __pyx_L1_error)
           __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
           __Pyx_GOTREF(__pyx_t_2);
           __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         } else
         #endif
         #if CYTHON_FAST_PYCCALL
         if (__Pyx_PyFastCFunction_Check(__pyx_t_4)) {
           PyObject *__pyx_temp[4] = {__pyx_t_5, __pyx_v_attr_name, __pyx_v_attr_value, __pyx_t_3};
-          __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_6, 3+__pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 998, __pyx_L1_error)
+          __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_6, 3+__pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1044, __pyx_L1_error)
           __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
           __Pyx_GOTREF(__pyx_t_2);
           __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         } else
         #endif
         {
-          __pyx_t_7 = PyTuple_New(3+__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 998, __pyx_L1_error)
+          __pyx_t_7 = PyTuple_New(3+__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1044, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_7);
           if (__pyx_t_5) {
             __Pyx_GIVEREF(__pyx_t_5); PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_5); __pyx_t_5 = NULL;
           }
           __Pyx_INCREF(__pyx_v_attr_name);
           __Pyx_GIVEREF(__pyx_v_attr_name);
           PyTuple_SET_ITEM(__pyx_t_7, 0+__pyx_t_6, __pyx_v_attr_name);
           __Pyx_INCREF(__pyx_v_attr_value);
           __Pyx_GIVEREF(__pyx_v_attr_value);
           PyTuple_SET_ITEM(__pyx_t_7, 1+__pyx_t_6, __pyx_v_attr_value);
           __Pyx_GIVEREF(__pyx_t_3);
           PyTuple_SET_ITEM(__pyx_t_7, 2+__pyx_t_6, __pyx_t_3);
           __pyx_t_3 = 0;
-          __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_7, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 998, __pyx_L1_error)
+          __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_7, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1044, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_2);
           __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
         }
         __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_11resiliparse_5parse_4html_DOMCollection))))) __PYX_ERR(0, 998, __pyx_L1_error)
+        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_11resiliparse_5parse_4html_DOMCollection))))) __PYX_ERR(0, 1044, __pyx_L1_error)
         __pyx_r = ((struct __pyx_obj_11resiliparse_5parse_4html_DOMCollection *)__pyx_t_2);
         __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -12759,104 +13359,104 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "resiliparse/parse/html.pyx":1014
+  /* "resiliparse/parse/html.pyx":1060
  *         :rtype: DOMCollection or None
  *         """
  *         if not check_node(self):             # <<<<<<<<<<<<<<
  *             return None
  * 
  */
   __pyx_t_8 = ((!(__pyx_f_11resiliparse_5parse_4html_check_node(__pyx_v_self) != 0)) != 0);
   if (__pyx_t_8) {
 
-    /* "resiliparse/parse/html.pyx":1015
+    /* "resiliparse/parse/html.pyx":1061
  *         """
  *         if not check_node(self):
  *             return None             # <<<<<<<<<<<<<<
  * 
  *         return _create_dom_collection(self.tree,
  */
     __Pyx_XDECREF(((PyObject *)__pyx_r));
     __pyx_r = ((struct __pyx_obj_11resiliparse_5parse_4html_DOMCollection *)Py_None); __Pyx_INCREF(Py_None);
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":1014
+    /* "resiliparse/parse/html.pyx":1060
  *         :rtype: DOMCollection or None
  *         """
  *         if not check_node(self):             # <<<<<<<<<<<<<<
  *             return None
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":1017
+  /* "resiliparse/parse/html.pyx":1063
  *             return None
  * 
  *         return _create_dom_collection(self.tree,             # <<<<<<<<<<<<<<
  *                                       get_elements_by_attr_impl(self.node, attr_name.encode(), attr_value.encode(),
  *                                                                 10, case_insensitive))
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
   __pyx_t_1 = ((PyObject *)__pyx_v_self->tree);
   __Pyx_INCREF(__pyx_t_1);
 
-  /* "resiliparse/parse/html.pyx":1018
+  /* "resiliparse/parse/html.pyx":1064
  * 
  *         return _create_dom_collection(self.tree,
  *                                       get_elements_by_attr_impl(self.node, attr_name.encode(), attr_value.encode(),             # <<<<<<<<<<<<<<
  *                                                                 10, case_insensitive))
  * 
  */
   if (unlikely(__pyx_v_attr_name == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "encode");
-    __PYX_ERR(0, 1018, __pyx_L1_error)
+    __PYX_ERR(0, 1064, __pyx_L1_error)
   }
-  __pyx_t_2 = PyUnicode_AsEncodedString(__pyx_v_attr_name, NULL, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1018, __pyx_L1_error)
+  __pyx_t_2 = PyUnicode_AsEncodedString(__pyx_v_attr_name, NULL, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1064, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   if (unlikely(__pyx_v_attr_value == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "encode");
-    __PYX_ERR(0, 1018, __pyx_L1_error)
+    __PYX_ERR(0, 1064, __pyx_L1_error)
   }
-  __pyx_t_4 = PyUnicode_AsEncodedString(__pyx_v_attr_value, NULL, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1018, __pyx_L1_error)
+  __pyx_t_4 = PyUnicode_AsEncodedString(__pyx_v_attr_value, NULL, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1064, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
 
-  /* "resiliparse/parse/html.pyx":1019
+  /* "resiliparse/parse/html.pyx":1065
  *         return _create_dom_collection(self.tree,
  *                                       get_elements_by_attr_impl(self.node, attr_name.encode(), attr_value.encode(),
  *                                                                 10, case_insensitive))             # <<<<<<<<<<<<<<
  * 
  *     cpdef DOMNode get_element_by_id(self, str element_id, bint case_insensitive=False):
  */
   __pyx_t_10.__pyx_n = 2;
   __pyx_t_10.init_size = 10;
   __pyx_t_10.case_insensitive = __pyx_v_case_insensitive;
   __pyx_t_9 = __pyx_f_11resiliparse_5parse_4html_get_elements_by_attr_impl(__pyx_v_self->node, ((PyObject*)__pyx_t_2), ((PyObject*)__pyx_t_4), &__pyx_t_10); 
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-  /* "resiliparse/parse/html.pyx":1017
+  /* "resiliparse/parse/html.pyx":1063
  *             return None
  * 
  *         return _create_dom_collection(self.tree,             # <<<<<<<<<<<<<<
  *                                       get_elements_by_attr_impl(self.node, attr_name.encode(), attr_value.encode(),
  *                                                                 10, case_insensitive))
  */
-  __pyx_t_4 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html__create_dom_collection(((struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *)__pyx_t_1), __pyx_t_9)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1017, __pyx_L1_error)
+  __pyx_t_4 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html__create_dom_collection(((struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *)__pyx_t_1), __pyx_t_9)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1063, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_r = ((struct __pyx_obj_11resiliparse_5parse_4html_DOMCollection *)__pyx_t_4);
   __pyx_t_4 = 0;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":998
+  /* "resiliparse/parse/html.pyx":1044
  *         return matches_impl(self.node, self.tree, selector.encode())
  * 
  *     cpdef DOMCollection get_elements_by_attr(self, str attr_name, str attr_value, bint case_insensitive=False):             # <<<<<<<<<<<<<<
  *         """
  *         get_elements_by_attr(self, attr_name, attr_value, case_insensitive=False)
  */
 
@@ -12910,54 +13510,54 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_attr_name)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_attr_value)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("get_elements_by_attr", 0, 2, 3, 1); __PYX_ERR(0, 998, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("get_elements_by_attr", 0, 2, 3, 1); __PYX_ERR(0, 1044, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_case_insensitive);
           if (value) { values[2] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "get_elements_by_attr") < 0)) __PYX_ERR(0, 998, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "get_elements_by_attr") < 0)) __PYX_ERR(0, 1044, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
         CYTHON_FALLTHROUGH;
         case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
         values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
         break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_attr_name = ((PyObject*)values[0]);
     __pyx_v_attr_value = ((PyObject*)values[1]);
     if (values[2]) {
-      __pyx_v_case_insensitive = __Pyx_PyObject_IsTrue(values[2]); if (unlikely((__pyx_v_case_insensitive == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 998, __pyx_L3_error)
+      __pyx_v_case_insensitive = __Pyx_PyObject_IsTrue(values[2]); if (unlikely((__pyx_v_case_insensitive == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 1044, __pyx_L3_error)
     } else {
       __pyx_v_case_insensitive = ((int)0);
     }
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("get_elements_by_attr", 0, 2, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 998, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("get_elements_by_attr", 0, 2, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1044, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("resiliparse.parse.html.DOMNode.get_elements_by_attr", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_attr_name), (&PyUnicode_Type), 1, "attr_name", 1))) __PYX_ERR(0, 998, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_attr_value), (&PyUnicode_Type), 1, "attr_value", 1))) __PYX_ERR(0, 998, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_attr_name), (&PyUnicode_Type), 1, "attr_name", 1))) __PYX_ERR(0, 1044, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_attr_value), (&PyUnicode_Type), 1, "attr_value", 1))) __PYX_ERR(0, 1044, __pyx_L1_error)
   __pyx_r = __pyx_pf_11resiliparse_5parse_4html_7DOMNode_27get_elements_by_attr(((struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *)__pyx_v_self), __pyx_v_attr_name, __pyx_v_attr_value, __pyx_v_case_insensitive);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -12973,15 +13573,15 @@
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("get_elements_by_attr", 0);
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_2.__pyx_n = 1;
   __pyx_t_2.case_insensitive = __pyx_v_case_insensitive;
-  __pyx_t_1 = ((PyObject *)__pyx_vtabptr_11resiliparse_5parse_4html_DOMNode->get_elements_by_attr(__pyx_v_self, __pyx_v_attr_name, __pyx_v_attr_value, 1, &__pyx_t_2)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 998, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_vtabptr_11resiliparse_5parse_4html_DOMNode->get_elements_by_attr(__pyx_v_self, __pyx_v_attr_name, __pyx_v_attr_value, 1, &__pyx_t_2)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1044, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -12990,15 +13590,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":1021
+/* "resiliparse/parse/html.pyx":1067
  *                                                                 10, case_insensitive))
  * 
  *     cpdef DOMNode get_element_by_id(self, str element_id, bint case_insensitive=False):             # <<<<<<<<<<<<<<
  *         """
  *         get_element_by_id(self, element_id, case_insensitive=False)
  */
 
@@ -13032,19 +13632,19 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_get_element_by_id); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1021, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_get_element_by_id); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1067, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_11resiliparse_5parse_4html_7DOMNode_30get_element_by_id)) {
         __Pyx_XDECREF(((PyObject *)__pyx_r));
-        __pyx_t_3 = __Pyx_PyBool_FromLong(__pyx_v_case_insensitive); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1021, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyBool_FromLong(__pyx_v_case_insensitive); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1067, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_4 = __pyx_t_1; __pyx_t_5 = NULL;
         __pyx_t_6 = 0;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
           __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
           if (likely(__pyx_t_5)) {
@@ -13054,47 +13654,47 @@
             __Pyx_DECREF_SET(__pyx_t_4, function);
             __pyx_t_6 = 1;
           }
         }
         #if CYTHON_FAST_PYCALL
         if (PyFunction_Check(__pyx_t_4)) {
           PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_v_element_id, __pyx_t_3};
-          __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1021, __pyx_L1_error)
+          __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1067, __pyx_L1_error)
           __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
           __Pyx_GOTREF(__pyx_t_2);
           __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         } else
         #endif
         #if CYTHON_FAST_PYCCALL
         if (__Pyx_PyFastCFunction_Check(__pyx_t_4)) {
           PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_v_element_id, __pyx_t_3};
-          __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1021, __pyx_L1_error)
+          __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1067, __pyx_L1_error)
           __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
           __Pyx_GOTREF(__pyx_t_2);
           __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         } else
         #endif
         {
-          __pyx_t_7 = PyTuple_New(2+__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1021, __pyx_L1_error)
+          __pyx_t_7 = PyTuple_New(2+__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1067, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_7);
           if (__pyx_t_5) {
             __Pyx_GIVEREF(__pyx_t_5); PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_5); __pyx_t_5 = NULL;
           }
           __Pyx_INCREF(__pyx_v_element_id);
           __Pyx_GIVEREF(__pyx_v_element_id);
           PyTuple_SET_ITEM(__pyx_t_7, 0+__pyx_t_6, __pyx_v_element_id);
           __Pyx_GIVEREF(__pyx_t_3);
           PyTuple_SET_ITEM(__pyx_t_7, 1+__pyx_t_6, __pyx_t_3);
           __pyx_t_3 = 0;
-          __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_7, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1021, __pyx_L1_error)
+          __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_7, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1067, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_2);
           __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
         }
         __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_11resiliparse_5parse_4html_DOMNode))))) __PYX_ERR(0, 1021, __pyx_L1_error)
+        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_11resiliparse_5parse_4html_DOMNode))))) __PYX_ERR(0, 1067, __pyx_L1_error)
         __pyx_r = ((struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *)__pyx_t_2);
         __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -13105,111 +13705,111 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "resiliparse/parse/html.pyx":1034
+  /* "resiliparse/parse/html.pyx":1080
  *         :rtype: DOMNode or None
  *         """
  *         if not check_node(self):             # <<<<<<<<<<<<<<
  *             return None
  * 
  */
   __pyx_t_8 = ((!(__pyx_f_11resiliparse_5parse_4html_check_node(__pyx_v_self) != 0)) != 0);
   if (__pyx_t_8) {
 
-    /* "resiliparse/parse/html.pyx":1035
+    /* "resiliparse/parse/html.pyx":1081
  *         """
  *         if not check_node(self):
  *             return None             # <<<<<<<<<<<<<<
  * 
  *         cdef lxb_dom_node_t* result_node = get_element_by_id_impl(self.node, element_id.encode(), case_insensitive)
  */
     __Pyx_XDECREF(((PyObject *)__pyx_r));
     __pyx_r = ((struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *)Py_None); __Pyx_INCREF(Py_None);
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":1034
+    /* "resiliparse/parse/html.pyx":1080
  *         :rtype: DOMNode or None
  *         """
  *         if not check_node(self):             # <<<<<<<<<<<<<<
  *             return None
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":1037
+  /* "resiliparse/parse/html.pyx":1083
  *             return None
  * 
  *         cdef lxb_dom_node_t* result_node = get_element_by_id_impl(self.node, element_id.encode(), case_insensitive)             # <<<<<<<<<<<<<<
  *         if not result_node:
  *             return None
  */
   if (unlikely(__pyx_v_element_id == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "encode");
-    __PYX_ERR(0, 1037, __pyx_L1_error)
+    __PYX_ERR(0, 1083, __pyx_L1_error)
   }
-  __pyx_t_1 = PyUnicode_AsEncodedString(__pyx_v_element_id, NULL, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1037, __pyx_L1_error)
+  __pyx_t_1 = PyUnicode_AsEncodedString(__pyx_v_element_id, NULL, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1083, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_t_10.__pyx_n = 1;
   __pyx_t_10.case_insensitive = __pyx_v_case_insensitive;
   __pyx_t_9 = __pyx_f_11resiliparse_5parse_4html_get_element_by_id_impl(__pyx_v_self->node, ((PyObject*)__pyx_t_1), &__pyx_t_10); 
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_v_result_node = __pyx_t_9;
 
-  /* "resiliparse/parse/html.pyx":1038
+  /* "resiliparse/parse/html.pyx":1084
  * 
  *         cdef lxb_dom_node_t* result_node = get_element_by_id_impl(self.node, element_id.encode(), case_insensitive)
  *         if not result_node:             # <<<<<<<<<<<<<<
  *             return None
  *         return _create_dom_node(self.tree, result_node)
  */
   __pyx_t_8 = ((!(__pyx_v_result_node != 0)) != 0);
   if (__pyx_t_8) {
 
-    /* "resiliparse/parse/html.pyx":1039
+    /* "resiliparse/parse/html.pyx":1085
  *         cdef lxb_dom_node_t* result_node = get_element_by_id_impl(self.node, element_id.encode(), case_insensitive)
  *         if not result_node:
  *             return None             # <<<<<<<<<<<<<<
  *         return _create_dom_node(self.tree, result_node)
  * 
  */
     __Pyx_XDECREF(((PyObject *)__pyx_r));
     __pyx_r = ((struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *)Py_None); __Pyx_INCREF(Py_None);
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":1038
+    /* "resiliparse/parse/html.pyx":1084
  * 
  *         cdef lxb_dom_node_t* result_node = get_element_by_id_impl(self.node, element_id.encode(), case_insensitive)
  *         if not result_node:             # <<<<<<<<<<<<<<
  *             return None
  *         return _create_dom_node(self.tree, result_node)
  */
   }
 
-  /* "resiliparse/parse/html.pyx":1040
+  /* "resiliparse/parse/html.pyx":1086
  *         if not result_node:
  *             return None
  *         return _create_dom_node(self.tree, result_node)             # <<<<<<<<<<<<<<
  * 
  *     cpdef DOMCollection get_elements_by_class_name(self, str class_name, bint case_insensitive=False):
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
   __pyx_t_1 = ((PyObject *)__pyx_v_self->tree);
   __Pyx_INCREF(__pyx_t_1);
-  __pyx_t_2 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html__create_dom_node(((struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *)__pyx_t_1), __pyx_v_result_node)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1040, __pyx_L1_error)
+  __pyx_t_2 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html__create_dom_node(((struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *)__pyx_t_1), __pyx_v_result_node)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1086, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_r = ((struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *)__pyx_t_2);
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":1021
+  /* "resiliparse/parse/html.pyx":1067
  *                                                                 10, case_insensitive))
  * 
  *     cpdef DOMNode get_element_by_id(self, str element_id, bint case_insensitive=False):             # <<<<<<<<<<<<<<
  *         """
  *         get_element_by_id(self, element_id, case_insensitive=False)
  */
 
@@ -13264,41 +13864,41 @@
         case  1:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_case_insensitive);
           if (value) { values[1] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "get_element_by_id") < 0)) __PYX_ERR(0, 1021, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "get_element_by_id") < 0)) __PYX_ERR(0, 1067, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
         CYTHON_FALLTHROUGH;
         case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
         break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_element_id = ((PyObject*)values[0]);
     if (values[1]) {
-      __pyx_v_case_insensitive = __Pyx_PyObject_IsTrue(values[1]); if (unlikely((__pyx_v_case_insensitive == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 1021, __pyx_L3_error)
+      __pyx_v_case_insensitive = __Pyx_PyObject_IsTrue(values[1]); if (unlikely((__pyx_v_case_insensitive == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 1067, __pyx_L3_error)
     } else {
       __pyx_v_case_insensitive = ((int)0);
     }
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("get_element_by_id", 0, 1, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1021, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("get_element_by_id", 0, 1, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1067, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("resiliparse.parse.html.DOMNode.get_element_by_id", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_element_id), (&PyUnicode_Type), 1, "element_id", 1))) __PYX_ERR(0, 1021, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_element_id), (&PyUnicode_Type), 1, "element_id", 1))) __PYX_ERR(0, 1067, __pyx_L1_error)
   __pyx_r = __pyx_pf_11resiliparse_5parse_4html_7DOMNode_29get_element_by_id(((struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *)__pyx_v_self), __pyx_v_element_id, __pyx_v_case_insensitive);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -13314,15 +13914,15 @@
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("get_element_by_id", 0);
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_2.__pyx_n = 1;
   __pyx_t_2.case_insensitive = __pyx_v_case_insensitive;
-  __pyx_t_1 = ((PyObject *)__pyx_vtabptr_11resiliparse_5parse_4html_DOMNode->get_element_by_id(__pyx_v_self, __pyx_v_element_id, 1, &__pyx_t_2)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1021, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_vtabptr_11resiliparse_5parse_4html_DOMNode->get_element_by_id(__pyx_v_self, __pyx_v_element_id, 1, &__pyx_t_2)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1067, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -13331,15 +13931,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":1042
+/* "resiliparse/parse/html.pyx":1088
  *         return _create_dom_node(self.tree, result_node)
  * 
  *     cpdef DOMCollection get_elements_by_class_name(self, str class_name, bint case_insensitive=False):             # <<<<<<<<<<<<<<
  *         """
  *         get_elements_by_class_name(self, element_class, case_insensitive=False)
  */
 
@@ -13372,19 +13972,19 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_get_elements_by_class_name); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1042, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_get_elements_by_class_name); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1088, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_11resiliparse_5parse_4html_7DOMNode_32get_elements_by_class_name)) {
         __Pyx_XDECREF(((PyObject *)__pyx_r));
-        __pyx_t_3 = __Pyx_PyBool_FromLong(__pyx_v_case_insensitive); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1042, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyBool_FromLong(__pyx_v_case_insensitive); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1088, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_4 = __pyx_t_1; __pyx_t_5 = NULL;
         __pyx_t_6 = 0;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
           __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
           if (likely(__pyx_t_5)) {
@@ -13394,47 +13994,47 @@
             __Pyx_DECREF_SET(__pyx_t_4, function);
             __pyx_t_6 = 1;
           }
         }
         #if CYTHON_FAST_PYCALL
         if (PyFunction_Check(__pyx_t_4)) {
           PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_v_class_name, __pyx_t_3};
-          __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1042, __pyx_L1_error)
+          __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1088, __pyx_L1_error)
           __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
           __Pyx_GOTREF(__pyx_t_2);
           __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         } else
         #endif
         #if CYTHON_FAST_PYCCALL
         if (__Pyx_PyFastCFunction_Check(__pyx_t_4)) {
           PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_v_class_name, __pyx_t_3};
-          __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1042, __pyx_L1_error)
+          __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1088, __pyx_L1_error)
           __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
           __Pyx_GOTREF(__pyx_t_2);
           __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         } else
         #endif
         {
-          __pyx_t_7 = PyTuple_New(2+__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1042, __pyx_L1_error)
+          __pyx_t_7 = PyTuple_New(2+__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1088, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_7);
           if (__pyx_t_5) {
             __Pyx_GIVEREF(__pyx_t_5); PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_5); __pyx_t_5 = NULL;
           }
           __Pyx_INCREF(__pyx_v_class_name);
           __Pyx_GIVEREF(__pyx_v_class_name);
           PyTuple_SET_ITEM(__pyx_t_7, 0+__pyx_t_6, __pyx_v_class_name);
           __Pyx_GIVEREF(__pyx_t_3);
           PyTuple_SET_ITEM(__pyx_t_7, 1+__pyx_t_6, __pyx_t_3);
           __pyx_t_3 = 0;
-          __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_7, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1042, __pyx_L1_error)
+          __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_7, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1088, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_2);
           __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
         }
         __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_11resiliparse_5parse_4html_DOMCollection))))) __PYX_ERR(0, 1042, __pyx_L1_error)
+        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_11resiliparse_5parse_4html_DOMCollection))))) __PYX_ERR(0, 1088, __pyx_L1_error)
         __pyx_r = ((struct __pyx_obj_11resiliparse_5parse_4html_DOMCollection *)__pyx_t_2);
         __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -13445,72 +14045,72 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "resiliparse/parse/html.pyx":1055
+  /* "resiliparse/parse/html.pyx":1101
  *         :rtype: DOMCollection or None
  *         """
  *         if not check_node(self):             # <<<<<<<<<<<<<<
  *             return None
  * 
  */
   __pyx_t_8 = ((!(__pyx_f_11resiliparse_5parse_4html_check_node(__pyx_v_self) != 0)) != 0);
   if (__pyx_t_8) {
 
-    /* "resiliparse/parse/html.pyx":1056
+    /* "resiliparse/parse/html.pyx":1102
  *         """
  *         if not check_node(self):
  *             return None             # <<<<<<<<<<<<<<
  * 
  *         return _create_dom_collection(self.tree, get_elements_by_class_name_impl(self.node, class_name.encode(), 10))
  */
     __Pyx_XDECREF(((PyObject *)__pyx_r));
     __pyx_r = ((struct __pyx_obj_11resiliparse_5parse_4html_DOMCollection *)Py_None); __Pyx_INCREF(Py_None);
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":1055
+    /* "resiliparse/parse/html.pyx":1101
  *         :rtype: DOMCollection or None
  *         """
  *         if not check_node(self):             # <<<<<<<<<<<<<<
  *             return None
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":1058
+  /* "resiliparse/parse/html.pyx":1104
  *             return None
  * 
  *         return _create_dom_collection(self.tree, get_elements_by_class_name_impl(self.node, class_name.encode(), 10))             # <<<<<<<<<<<<<<
  * 
  *     cpdef DOMCollection get_elements_by_tag_name(self, str tag_name):
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
   __pyx_t_1 = ((PyObject *)__pyx_v_self->tree);
   __Pyx_INCREF(__pyx_t_1);
   if (unlikely(__pyx_v_class_name == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "encode");
-    __PYX_ERR(0, 1058, __pyx_L1_error)
+    __PYX_ERR(0, 1104, __pyx_L1_error)
   }
-  __pyx_t_2 = PyUnicode_AsEncodedString(__pyx_v_class_name, NULL, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1058, __pyx_L1_error)
+  __pyx_t_2 = PyUnicode_AsEncodedString(__pyx_v_class_name, NULL, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1104, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_10.__pyx_n = 1;
   __pyx_t_10.init_size = 10;
   __pyx_t_9 = __pyx_f_11resiliparse_5parse_4html_get_elements_by_class_name_impl(__pyx_v_self->node, ((PyObject*)__pyx_t_2), &__pyx_t_10); 
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  __pyx_t_2 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html__create_dom_collection(((struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *)__pyx_t_1), __pyx_t_9)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1058, __pyx_L1_error)
+  __pyx_t_2 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html__create_dom_collection(((struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *)__pyx_t_1), __pyx_t_9)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1104, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_r = ((struct __pyx_obj_11resiliparse_5parse_4html_DOMCollection *)__pyx_t_2);
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":1042
+  /* "resiliparse/parse/html.pyx":1088
  *         return _create_dom_node(self.tree, result_node)
  * 
  *     cpdef DOMCollection get_elements_by_class_name(self, str class_name, bint case_insensitive=False):             # <<<<<<<<<<<<<<
  *         """
  *         get_elements_by_class_name(self, element_class, case_insensitive=False)
  */
 
@@ -13565,41 +14165,41 @@
         case  1:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_case_insensitive);
           if (value) { values[1] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "get_elements_by_class_name") < 0)) __PYX_ERR(0, 1042, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "get_elements_by_class_name") < 0)) __PYX_ERR(0, 1088, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
         CYTHON_FALLTHROUGH;
         case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
         break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_class_name = ((PyObject*)values[0]);
     if (values[1]) {
-      __pyx_v_case_insensitive = __Pyx_PyObject_IsTrue(values[1]); if (unlikely((__pyx_v_case_insensitive == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 1042, __pyx_L3_error)
+      __pyx_v_case_insensitive = __Pyx_PyObject_IsTrue(values[1]); if (unlikely((__pyx_v_case_insensitive == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 1088, __pyx_L3_error)
     } else {
       __pyx_v_case_insensitive = ((int)0);
     }
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("get_elements_by_class_name", 0, 1, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1042, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("get_elements_by_class_name", 0, 1, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1088, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("resiliparse.parse.html.DOMNode.get_elements_by_class_name", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_class_name), (&PyUnicode_Type), 1, "class_name", 1))) __PYX_ERR(0, 1042, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_class_name), (&PyUnicode_Type), 1, "class_name", 1))) __PYX_ERR(0, 1088, __pyx_L1_error)
   __pyx_r = __pyx_pf_11resiliparse_5parse_4html_7DOMNode_31get_elements_by_class_name(((struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *)__pyx_v_self), __pyx_v_class_name, __pyx_v_case_insensitive);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -13615,15 +14215,15 @@
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("get_elements_by_class_name", 0);
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_2.__pyx_n = 1;
   __pyx_t_2.case_insensitive = __pyx_v_case_insensitive;
-  __pyx_t_1 = ((PyObject *)__pyx_vtabptr_11resiliparse_5parse_4html_DOMNode->get_elements_by_class_name(__pyx_v_self, __pyx_v_class_name, 1, &__pyx_t_2)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1042, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_vtabptr_11resiliparse_5parse_4html_DOMNode->get_elements_by_class_name(__pyx_v_self, __pyx_v_class_name, 1, &__pyx_t_2)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1088, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -13632,15 +14232,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":1060
+/* "resiliparse/parse/html.pyx":1106
  *         return _create_dom_collection(self.tree, get_elements_by_class_name_impl(self.node, class_name.encode(), 10))
  * 
  *     cpdef DOMCollection get_elements_by_tag_name(self, str tag_name):             # <<<<<<<<<<<<<<
  *         """
  *         get_elements_by_tag_name(self, tag_name)
  */
 
@@ -13662,15 +14262,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_get_elements_by_tag_name); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1060, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_get_elements_by_tag_name); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1106, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_11resiliparse_5parse_4html_7DOMNode_34get_elements_by_tag_name)) {
         __Pyx_XDECREF(((PyObject *)__pyx_r));
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
@@ -13679,18 +14279,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_v_tag_name) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_tag_name);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1060, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1106, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_11resiliparse_5parse_4html_DOMCollection))))) __PYX_ERR(0, 1060, __pyx_L1_error)
+        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_11resiliparse_5parse_4html_DOMCollection))))) __PYX_ERR(0, 1106, __pyx_L1_error)
         __pyx_r = ((struct __pyx_obj_11resiliparse_5parse_4html_DOMCollection *)__pyx_t_2);
         __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -13701,69 +14301,69 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "resiliparse/parse/html.pyx":1071
+  /* "resiliparse/parse/html.pyx":1117
  *         :rtype: DOMCollection
  *         """
  *         if not check_node(self):             # <<<<<<<<<<<<<<
  *             return None
  * 
  */
   __pyx_t_5 = ((!(__pyx_f_11resiliparse_5parse_4html_check_node(__pyx_v_self) != 0)) != 0);
   if (__pyx_t_5) {
 
-    /* "resiliparse/parse/html.pyx":1072
+    /* "resiliparse/parse/html.pyx":1118
  *         """
  *         if not check_node(self):
  *             return None             # <<<<<<<<<<<<<<
  * 
  *         return _create_dom_collection(self.tree, get_elements_by_tag_name_impl(self.node, tag_name.encode()))
  */
     __Pyx_XDECREF(((PyObject *)__pyx_r));
     __pyx_r = ((struct __pyx_obj_11resiliparse_5parse_4html_DOMCollection *)Py_None); __Pyx_INCREF(Py_None);
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":1071
+    /* "resiliparse/parse/html.pyx":1117
  *         :rtype: DOMCollection
  *         """
  *         if not check_node(self):             # <<<<<<<<<<<<<<
  *             return None
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":1074
+  /* "resiliparse/parse/html.pyx":1120
  *             return None
  * 
  *         return _create_dom_collection(self.tree, get_elements_by_tag_name_impl(self.node, tag_name.encode()))             # <<<<<<<<<<<<<<
  * 
  *     cpdef DOMNode append_child(self, DOMNode node):
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
   __pyx_t_1 = ((PyObject *)__pyx_v_self->tree);
   __Pyx_INCREF(__pyx_t_1);
   if (unlikely(__pyx_v_tag_name == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "encode");
-    __PYX_ERR(0, 1074, __pyx_L1_error)
+    __PYX_ERR(0, 1120, __pyx_L1_error)
   }
-  __pyx_t_2 = PyUnicode_AsEncodedString(__pyx_v_tag_name, NULL, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1074, __pyx_L1_error)
+  __pyx_t_2 = PyUnicode_AsEncodedString(__pyx_v_tag_name, NULL, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1120, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_3 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html__create_dom_collection(((struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *)__pyx_t_1), __pyx_f_11resiliparse_5parse_4html_get_elements_by_tag_name_impl(__pyx_v_self->node, ((PyObject*)__pyx_t_2)))); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1074, __pyx_L1_error)
+  __pyx_t_3 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html__create_dom_collection(((struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *)__pyx_t_1), __pyx_f_11resiliparse_5parse_4html_get_elements_by_tag_name_impl(__pyx_v_self->node, ((PyObject*)__pyx_t_2)))); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1120, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_r = ((struct __pyx_obj_11resiliparse_5parse_4html_DOMCollection *)__pyx_t_3);
   __pyx_t_3 = 0;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":1060
+  /* "resiliparse/parse/html.pyx":1106
  *         return _create_dom_collection(self.tree, get_elements_by_class_name_impl(self.node, class_name.encode(), 10))
  * 
  *     cpdef DOMCollection get_elements_by_tag_name(self, str tag_name):             # <<<<<<<<<<<<<<
  *         """
  *         get_elements_by_tag_name(self, tag_name)
  */
 
@@ -13787,15 +14387,15 @@
 static PyObject *__pyx_pw_11resiliparse_5parse_4html_7DOMNode_34get_elements_by_tag_name(PyObject *__pyx_v_self, PyObject *__pyx_v_tag_name) {
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("get_elements_by_tag_name (wrapper)", 0);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_tag_name), (&PyUnicode_Type), 1, "tag_name", 1))) __PYX_ERR(0, 1060, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_tag_name), (&PyUnicode_Type), 1, "tag_name", 1))) __PYX_ERR(0, 1106, __pyx_L1_error)
   __pyx_r = __pyx_pf_11resiliparse_5parse_4html_7DOMNode_33get_elements_by_tag_name(((struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *)__pyx_v_self), ((PyObject*)__pyx_v_tag_name));
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -13808,15 +14408,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("get_elements_by_tag_name", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html_7DOMNode_get_elements_by_tag_name(__pyx_v_self, __pyx_v_tag_name, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1060, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html_7DOMNode_get_elements_by_tag_name(__pyx_v_self, __pyx_v_tag_name, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1106, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -13825,15 +14425,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":1076
+/* "resiliparse/parse/html.pyx":1122
  *         return _create_dom_collection(self.tree, get_elements_by_tag_name_impl(self.node, tag_name.encode()))
  * 
  *     cpdef DOMNode append_child(self, DOMNode node):             # <<<<<<<<<<<<<<
  *         """
  *         append_child(self, node)
  */
 
@@ -13856,15 +14456,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_append_child); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1076, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_append_child); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1122, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_11resiliparse_5parse_4html_7DOMNode_36append_child)) {
         __Pyx_XDECREF(((PyObject *)__pyx_r));
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
@@ -13873,18 +14473,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, ((PyObject *)__pyx_v_node)) : __Pyx_PyObject_CallOneArg(__pyx_t_3, ((PyObject *)__pyx_v_node));
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1076, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1122, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_11resiliparse_5parse_4html_DOMNode))))) __PYX_ERR(0, 1076, __pyx_L1_error)
+        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_11resiliparse_5parse_4html_DOMNode))))) __PYX_ERR(0, 1122, __pyx_L1_error)
         __pyx_r = ((struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *)__pyx_t_2);
         __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -13895,15 +14495,15 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "resiliparse/parse/html.pyx":1088
+  /* "resiliparse/parse/html.pyx":1134
  *         :raises ValueError: if trying to append node to itself
  *         """
  *         if not check_node(self) or not check_node(node):             # <<<<<<<<<<<<<<
  *             raise RuntimeError('Append operation on uninitialized node')
  * 
  */
   __pyx_t_6 = ((!(__pyx_f_11resiliparse_5parse_4html_check_node(__pyx_v_self) != 0)) != 0);
@@ -13913,118 +14513,118 @@
     goto __pyx_L4_bool_binop_done;
   }
   __pyx_t_6 = ((!(__pyx_f_11resiliparse_5parse_4html_check_node(__pyx_v_node) != 0)) != 0);
   __pyx_t_5 = __pyx_t_6;
   __pyx_L4_bool_binop_done:;
   if (unlikely(__pyx_t_5)) {
 
-    /* "resiliparse/parse/html.pyx":1089
+    /* "resiliparse/parse/html.pyx":1135
  *         """
  *         if not check_node(self) or not check_node(node):
  *             raise RuntimeError('Append operation on uninitialized node')             # <<<<<<<<<<<<<<
  * 
  *         if node.node == self.node:
  */
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_RuntimeError, __pyx_tuple__10, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1089, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_RuntimeError, __pyx_tuple__13, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1135, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 1089, __pyx_L1_error)
+    __PYX_ERR(0, 1135, __pyx_L1_error)
 
-    /* "resiliparse/parse/html.pyx":1088
+    /* "resiliparse/parse/html.pyx":1134
  *         :raises ValueError: if trying to append node to itself
  *         """
  *         if not check_node(self) or not check_node(node):             # <<<<<<<<<<<<<<
  *             raise RuntimeError('Append operation on uninitialized node')
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":1091
+  /* "resiliparse/parse/html.pyx":1137
  *             raise RuntimeError('Append operation on uninitialized node')
  * 
  *         if node.node == self.node:             # <<<<<<<<<<<<<<
  *             raise ValueError('Trying to append child to itself')
  * 
  */
   __pyx_t_5 = ((__pyx_v_node->node == __pyx_v_self->node) != 0);
   if (unlikely(__pyx_t_5)) {
 
-    /* "resiliparse/parse/html.pyx":1092
+    /* "resiliparse/parse/html.pyx":1138
  * 
  *         if node.node == self.node:
  *             raise ValueError('Trying to append child to itself')             # <<<<<<<<<<<<<<
  * 
  *         if node.node.parent:
  */
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__11, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1092, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__14, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1138, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 1092, __pyx_L1_error)
+    __PYX_ERR(0, 1138, __pyx_L1_error)
 
-    /* "resiliparse/parse/html.pyx":1091
+    /* "resiliparse/parse/html.pyx":1137
  *             raise RuntimeError('Append operation on uninitialized node')
  * 
  *         if node.node == self.node:             # <<<<<<<<<<<<<<
  *             raise ValueError('Trying to append child to itself')
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":1094
+  /* "resiliparse/parse/html.pyx":1140
  *             raise ValueError('Trying to append child to itself')
  * 
  *         if node.node.parent:             # <<<<<<<<<<<<<<
  *             lxb_dom_node_remove(node.node)
  *         lxb_dom_node_insert_child(self.node, node.node)
  */
   __pyx_t_5 = (__pyx_v_node->node->parent != 0);
   if (__pyx_t_5) {
 
-    /* "resiliparse/parse/html.pyx":1095
+    /* "resiliparse/parse/html.pyx":1141
  * 
  *         if node.node.parent:
  *             lxb_dom_node_remove(node.node)             # <<<<<<<<<<<<<<
  *         lxb_dom_node_insert_child(self.node, node.node)
  *         return node
  */
     lxb_dom_node_remove(__pyx_v_node->node);
 
-    /* "resiliparse/parse/html.pyx":1094
+    /* "resiliparse/parse/html.pyx":1140
  *             raise ValueError('Trying to append child to itself')
  * 
  *         if node.node.parent:             # <<<<<<<<<<<<<<
  *             lxb_dom_node_remove(node.node)
  *         lxb_dom_node_insert_child(self.node, node.node)
  */
   }
 
-  /* "resiliparse/parse/html.pyx":1096
+  /* "resiliparse/parse/html.pyx":1142
  *         if node.node.parent:
  *             lxb_dom_node_remove(node.node)
  *         lxb_dom_node_insert_child(self.node, node.node)             # <<<<<<<<<<<<<<
  *         return node
  * 
  */
   lxb_dom_node_insert_child(__pyx_v_self->node, __pyx_v_node->node);
 
-  /* "resiliparse/parse/html.pyx":1097
+  /* "resiliparse/parse/html.pyx":1143
  *             lxb_dom_node_remove(node.node)
  *         lxb_dom_node_insert_child(self.node, node.node)
  *         return node             # <<<<<<<<<<<<<<
  * 
  *     cpdef DOMNode insert_before(self, DOMNode node, DOMNode reference):
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
   __Pyx_INCREF(((PyObject *)__pyx_v_node));
   __pyx_r = __pyx_v_node;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":1076
+  /* "resiliparse/parse/html.pyx":1122
  *         return _create_dom_collection(self.tree, get_elements_by_tag_name_impl(self.node, tag_name.encode()))
  * 
  *     cpdef DOMNode append_child(self, DOMNode node):             # <<<<<<<<<<<<<<
  *         """
  *         append_child(self, node)
  */
 
@@ -14048,15 +14648,15 @@
 static PyObject *__pyx_pw_11resiliparse_5parse_4html_7DOMNode_36append_child(PyObject *__pyx_v_self, PyObject *__pyx_v_node) {
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("append_child (wrapper)", 0);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_node), __pyx_ptype_11resiliparse_5parse_4html_DOMNode, 1, "node", 0))) __PYX_ERR(0, 1076, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_node), __pyx_ptype_11resiliparse_5parse_4html_DOMNode, 1, "node", 0))) __PYX_ERR(0, 1122, __pyx_L1_error)
   __pyx_r = __pyx_pf_11resiliparse_5parse_4html_7DOMNode_35append_child(((struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *)__pyx_v_self), ((struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *)__pyx_v_node));
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -14069,15 +14669,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("append_child", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html_7DOMNode_append_child(__pyx_v_self, __pyx_v_node, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1076, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html_7DOMNode_append_child(__pyx_v_self, __pyx_v_node, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1122, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -14086,15 +14686,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":1099
+/* "resiliparse/parse/html.pyx":1145
  *         return node
  * 
  *     cpdef DOMNode insert_before(self, DOMNode node, DOMNode reference):             # <<<<<<<<<<<<<<
  *         """
  *         insert_before(self, node, reference)
  */
 
@@ -14119,15 +14719,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_insert_before); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1099, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_insert_before); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1145, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_11resiliparse_5parse_4html_7DOMNode_38insert_before)) {
         __Pyx_XDECREF(((PyObject *)__pyx_r));
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         __pyx_t_5 = 0;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
@@ -14139,45 +14739,45 @@
             __Pyx_DECREF_SET(__pyx_t_3, function);
             __pyx_t_5 = 1;
           }
         }
         #if CYTHON_FAST_PYCALL
         if (PyFunction_Check(__pyx_t_3)) {
           PyObject *__pyx_temp[3] = {__pyx_t_4, ((PyObject *)__pyx_v_node), ((PyObject *)__pyx_v_reference)};
-          __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1099, __pyx_L1_error)
+          __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1145, __pyx_L1_error)
           __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
           __Pyx_GOTREF(__pyx_t_2);
         } else
         #endif
         #if CYTHON_FAST_PYCCALL
         if (__Pyx_PyFastCFunction_Check(__pyx_t_3)) {
           PyObject *__pyx_temp[3] = {__pyx_t_4, ((PyObject *)__pyx_v_node), ((PyObject *)__pyx_v_reference)};
-          __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1099, __pyx_L1_error)
+          __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1145, __pyx_L1_error)
           __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
           __Pyx_GOTREF(__pyx_t_2);
         } else
         #endif
         {
-          __pyx_t_6 = PyTuple_New(2+__pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1099, __pyx_L1_error)
+          __pyx_t_6 = PyTuple_New(2+__pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1145, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
           if (__pyx_t_4) {
             __Pyx_GIVEREF(__pyx_t_4); PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_4); __pyx_t_4 = NULL;
           }
           __Pyx_INCREF(((PyObject *)__pyx_v_node));
           __Pyx_GIVEREF(((PyObject *)__pyx_v_node));
           PyTuple_SET_ITEM(__pyx_t_6, 0+__pyx_t_5, ((PyObject *)__pyx_v_node));
           __Pyx_INCREF(((PyObject *)__pyx_v_reference));
           __Pyx_GIVEREF(((PyObject *)__pyx_v_reference));
           PyTuple_SET_ITEM(__pyx_t_6, 1+__pyx_t_5, ((PyObject *)__pyx_v_reference));
-          __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_6, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1099, __pyx_L1_error)
+          __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_6, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1145, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_2);
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         }
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_11resiliparse_5parse_4html_DOMNode))))) __PYX_ERR(0, 1099, __pyx_L1_error)
+        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_11resiliparse_5parse_4html_DOMNode))))) __PYX_ERR(0, 1145, __pyx_L1_error)
         __pyx_r = ((struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *)__pyx_t_2);
         __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -14188,15 +14788,15 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "resiliparse/parse/html.pyx":1115
+  /* "resiliparse/parse/html.pyx":1161
  *         :raises ValueError: if trying to add node as its own child or if ``reference`` is not a child
  *         """
  *         if not check_node(self) or not check_node(node) or not check_node(reference):             # <<<<<<<<<<<<<<
  *             raise RuntimeError('Insert operation on uninitialized node')
  * 
  */
   __pyx_t_8 = ((!(__pyx_f_11resiliparse_5parse_4html_check_node(__pyx_v_self) != 0)) != 0);
@@ -14212,150 +14812,150 @@
     goto __pyx_L4_bool_binop_done;
   }
   __pyx_t_8 = ((!(__pyx_f_11resiliparse_5parse_4html_check_node(__pyx_v_reference) != 0)) != 0);
   __pyx_t_7 = __pyx_t_8;
   __pyx_L4_bool_binop_done:;
   if (unlikely(__pyx_t_7)) {
 
-    /* "resiliparse/parse/html.pyx":1116
+    /* "resiliparse/parse/html.pyx":1162
  *         """
  *         if not check_node(self) or not check_node(node) or not check_node(reference):
  *             raise RuntimeError('Insert operation on uninitialized node')             # <<<<<<<<<<<<<<
  * 
  *         if node.node == self.node:
  */
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_RuntimeError, __pyx_tuple__12, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1116, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_RuntimeError, __pyx_tuple__15, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1162, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 1116, __pyx_L1_error)
+    __PYX_ERR(0, 1162, __pyx_L1_error)
 
-    /* "resiliparse/parse/html.pyx":1115
+    /* "resiliparse/parse/html.pyx":1161
  *         :raises ValueError: if trying to add node as its own child or if ``reference`` is not a child
  *         """
  *         if not check_node(self) or not check_node(node) or not check_node(reference):             # <<<<<<<<<<<<<<
  *             raise RuntimeError('Insert operation on uninitialized node')
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":1118
+  /* "resiliparse/parse/html.pyx":1164
  *             raise RuntimeError('Insert operation on uninitialized node')
  * 
  *         if node.node == self.node:             # <<<<<<<<<<<<<<
  *             raise ValueError('Trying to insert node as its own child')
  * 
  */
   __pyx_t_7 = ((__pyx_v_node->node == __pyx_v_self->node) != 0);
   if (unlikely(__pyx_t_7)) {
 
-    /* "resiliparse/parse/html.pyx":1119
+    /* "resiliparse/parse/html.pyx":1165
  * 
  *         if node.node == self.node:
  *             raise ValueError('Trying to insert node as its own child')             # <<<<<<<<<<<<<<
  * 
  *         if reference.node.parent != self.node:
  */
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__13, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1119, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__16, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1165, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 1119, __pyx_L1_error)
+    __PYX_ERR(0, 1165, __pyx_L1_error)
 
-    /* "resiliparse/parse/html.pyx":1118
+    /* "resiliparse/parse/html.pyx":1164
  *             raise RuntimeError('Insert operation on uninitialized node')
  * 
  *         if node.node == self.node:             # <<<<<<<<<<<<<<
  *             raise ValueError('Trying to insert node as its own child')
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":1121
+  /* "resiliparse/parse/html.pyx":1167
  *             raise ValueError('Trying to insert node as its own child')
  * 
  *         if reference.node.parent != self.node:             # <<<<<<<<<<<<<<
  *             raise ValueError('Reference node must be a child node')
  * 
  */
   __pyx_t_7 = ((__pyx_v_reference->node->parent != __pyx_v_self->node) != 0);
   if (unlikely(__pyx_t_7)) {
 
-    /* "resiliparse/parse/html.pyx":1122
+    /* "resiliparse/parse/html.pyx":1168
  * 
  *         if reference.node.parent != self.node:
  *             raise ValueError('Reference node must be a child node')             # <<<<<<<<<<<<<<
  * 
  *         if node.node.parent:
  */
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__14, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1122, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__17, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1168, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 1122, __pyx_L1_error)
+    __PYX_ERR(0, 1168, __pyx_L1_error)
 
-    /* "resiliparse/parse/html.pyx":1121
+    /* "resiliparse/parse/html.pyx":1167
  *             raise ValueError('Trying to insert node as its own child')
  * 
  *         if reference.node.parent != self.node:             # <<<<<<<<<<<<<<
  *             raise ValueError('Reference node must be a child node')
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":1124
+  /* "resiliparse/parse/html.pyx":1170
  *             raise ValueError('Reference node must be a child node')
  * 
  *         if node.node.parent:             # <<<<<<<<<<<<<<
  *             lxb_dom_node_remove(node.node)
  *         lxb_dom_node_insert_before(reference.node, node.node)
  */
   __pyx_t_7 = (__pyx_v_node->node->parent != 0);
   if (__pyx_t_7) {
 
-    /* "resiliparse/parse/html.pyx":1125
+    /* "resiliparse/parse/html.pyx":1171
  * 
  *         if node.node.parent:
  *             lxb_dom_node_remove(node.node)             # <<<<<<<<<<<<<<
  *         lxb_dom_node_insert_before(reference.node, node.node)
  *         return node
  */
     lxb_dom_node_remove(__pyx_v_node->node);
 
-    /* "resiliparse/parse/html.pyx":1124
+    /* "resiliparse/parse/html.pyx":1170
  *             raise ValueError('Reference node must be a child node')
  * 
  *         if node.node.parent:             # <<<<<<<<<<<<<<
  *             lxb_dom_node_remove(node.node)
  *         lxb_dom_node_insert_before(reference.node, node.node)
  */
   }
 
-  /* "resiliparse/parse/html.pyx":1126
+  /* "resiliparse/parse/html.pyx":1172
  *         if node.node.parent:
  *             lxb_dom_node_remove(node.node)
  *         lxb_dom_node_insert_before(reference.node, node.node)             # <<<<<<<<<<<<<<
  *         return node
  * 
  */
   lxb_dom_node_insert_before(__pyx_v_reference->node, __pyx_v_node->node);
 
-  /* "resiliparse/parse/html.pyx":1127
+  /* "resiliparse/parse/html.pyx":1173
  *             lxb_dom_node_remove(node.node)
  *         lxb_dom_node_insert_before(reference.node, node.node)
  *         return node             # <<<<<<<<<<<<<<
  * 
  *     cpdef DOMNode replace_child(self, DOMNode new_child, DOMNode old_child):
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
   __Pyx_INCREF(((PyObject *)__pyx_v_node));
   __pyx_r = __pyx_v_node;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":1099
+  /* "resiliparse/parse/html.pyx":1145
  *         return node
  * 
  *     cpdef DOMNode insert_before(self, DOMNode node, DOMNode reference):             # <<<<<<<<<<<<<<
  *         """
  *         insert_before(self, node, reference)
  */
 
@@ -14405,39 +15005,39 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_node)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_reference)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("insert_before", 1, 2, 2, 1); __PYX_ERR(0, 1099, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("insert_before", 1, 2, 2, 1); __PYX_ERR(0, 1145, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "insert_before") < 0)) __PYX_ERR(0, 1099, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "insert_before") < 0)) __PYX_ERR(0, 1145, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
     }
     __pyx_v_node = ((struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *)values[0]);
     __pyx_v_reference = ((struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *)values[1]);
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("insert_before", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1099, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("insert_before", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1145, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("resiliparse.parse.html.DOMNode.insert_before", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_node), __pyx_ptype_11resiliparse_5parse_4html_DOMNode, 1, "node", 0))) __PYX_ERR(0, 1099, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_reference), __pyx_ptype_11resiliparse_5parse_4html_DOMNode, 1, "reference", 0))) __PYX_ERR(0, 1099, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_node), __pyx_ptype_11resiliparse_5parse_4html_DOMNode, 1, "node", 0))) __PYX_ERR(0, 1145, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_reference), __pyx_ptype_11resiliparse_5parse_4html_DOMNode, 1, "reference", 0))) __PYX_ERR(0, 1145, __pyx_L1_error)
   __pyx_r = __pyx_pf_11resiliparse_5parse_4html_7DOMNode_37insert_before(((struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *)__pyx_v_self), __pyx_v_node, __pyx_v_reference);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -14450,15 +15050,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("insert_before", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html_7DOMNode_insert_before(__pyx_v_self, __pyx_v_node, __pyx_v_reference, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1099, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html_7DOMNode_insert_before(__pyx_v_self, __pyx_v_node, __pyx_v_reference, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1145, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -14467,15 +15067,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":1129
+/* "resiliparse/parse/html.pyx":1175
  *         return node
  * 
  *     cpdef DOMNode replace_child(self, DOMNode new_child, DOMNode old_child):             # <<<<<<<<<<<<<<
  *         """
  *         replace_child(self, new_child, old_child)
  */
 
@@ -14500,15 +15100,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_replace_child); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1129, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_replace_child); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1175, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_11resiliparse_5parse_4html_7DOMNode_40replace_child)) {
         __Pyx_XDECREF(((PyObject *)__pyx_r));
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         __pyx_t_5 = 0;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
@@ -14520,45 +15120,45 @@
             __Pyx_DECREF_SET(__pyx_t_3, function);
             __pyx_t_5 = 1;
           }
         }
         #if CYTHON_FAST_PYCALL
         if (PyFunction_Check(__pyx_t_3)) {
           PyObject *__pyx_temp[3] = {__pyx_t_4, ((PyObject *)__pyx_v_new_child), ((PyObject *)__pyx_v_old_child)};
-          __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1129, __pyx_L1_error)
+          __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1175, __pyx_L1_error)
           __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
           __Pyx_GOTREF(__pyx_t_2);
         } else
         #endif
         #if CYTHON_FAST_PYCCALL
         if (__Pyx_PyFastCFunction_Check(__pyx_t_3)) {
           PyObject *__pyx_temp[3] = {__pyx_t_4, ((PyObject *)__pyx_v_new_child), ((PyObject *)__pyx_v_old_child)};
-          __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1129, __pyx_L1_error)
+          __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_3, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1175, __pyx_L1_error)
           __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
           __Pyx_GOTREF(__pyx_t_2);
         } else
         #endif
         {
-          __pyx_t_6 = PyTuple_New(2+__pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1129, __pyx_L1_error)
+          __pyx_t_6 = PyTuple_New(2+__pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1175, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_6);
           if (__pyx_t_4) {
             __Pyx_GIVEREF(__pyx_t_4); PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_t_4); __pyx_t_4 = NULL;
           }
           __Pyx_INCREF(((PyObject *)__pyx_v_new_child));
           __Pyx_GIVEREF(((PyObject *)__pyx_v_new_child));
           PyTuple_SET_ITEM(__pyx_t_6, 0+__pyx_t_5, ((PyObject *)__pyx_v_new_child));
           __Pyx_INCREF(((PyObject *)__pyx_v_old_child));
           __Pyx_GIVEREF(((PyObject *)__pyx_v_old_child));
           PyTuple_SET_ITEM(__pyx_t_6, 1+__pyx_t_5, ((PyObject *)__pyx_v_old_child));
-          __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_6, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1129, __pyx_L1_error)
+          __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_3, __pyx_t_6, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1175, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_2);
           __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
         }
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_11resiliparse_5parse_4html_DOMNode))))) __PYX_ERR(0, 1129, __pyx_L1_error)
+        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_11resiliparse_5parse_4html_DOMNode))))) __PYX_ERR(0, 1175, __pyx_L1_error)
         __pyx_r = ((struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *)__pyx_t_2);
         __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -14569,15 +15169,15 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "resiliparse/parse/html.pyx":1143
+  /* "resiliparse/parse/html.pyx":1189
  *         :raises ValueError: if ``old_child`` is not a child of this node
  *         """
  *         if not check_node(self) or not check_node(new_child) or not check_node(old_child):             # <<<<<<<<<<<<<<
  *             raise RuntimeError('Replace operation on uninitialized node')
  * 
  */
   __pyx_t_8 = ((!(__pyx_f_11resiliparse_5parse_4html_check_node(__pyx_v_self) != 0)) != 0);
@@ -14593,158 +15193,158 @@
     goto __pyx_L4_bool_binop_done;
   }
   __pyx_t_8 = ((!(__pyx_f_11resiliparse_5parse_4html_check_node(__pyx_v_old_child) != 0)) != 0);
   __pyx_t_7 = __pyx_t_8;
   __pyx_L4_bool_binop_done:;
   if (unlikely(__pyx_t_7)) {
 
-    /* "resiliparse/parse/html.pyx":1144
+    /* "resiliparse/parse/html.pyx":1190
  *         """
  *         if not check_node(self) or not check_node(new_child) or not check_node(old_child):
  *             raise RuntimeError('Replace operation on uninitialized node')             # <<<<<<<<<<<<<<
  * 
  *         if old_child.node.parent != self.node:
  */
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_RuntimeError, __pyx_tuple__15, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1144, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_RuntimeError, __pyx_tuple__18, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1190, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 1144, __pyx_L1_error)
+    __PYX_ERR(0, 1190, __pyx_L1_error)
 
-    /* "resiliparse/parse/html.pyx":1143
+    /* "resiliparse/parse/html.pyx":1189
  *         :raises ValueError: if ``old_child`` is not a child of this node
  *         """
  *         if not check_node(self) or not check_node(new_child) or not check_node(old_child):             # <<<<<<<<<<<<<<
  *             raise RuntimeError('Replace operation on uninitialized node')
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":1146
+  /* "resiliparse/parse/html.pyx":1192
  *             raise RuntimeError('Replace operation on uninitialized node')
  * 
  *         if old_child.node.parent != self.node:             # <<<<<<<<<<<<<<
  *             raise ValueError('Node is not a child of the current node')
  * 
  */
   __pyx_t_7 = ((__pyx_v_old_child->node->parent != __pyx_v_self->node) != 0);
   if (unlikely(__pyx_t_7)) {
 
-    /* "resiliparse/parse/html.pyx":1147
+    /* "resiliparse/parse/html.pyx":1193
  * 
  *         if old_child.node.parent != self.node:
  *             raise ValueError('Node is not a child of the current node')             # <<<<<<<<<<<<<<
  * 
  *         if new_child.node == old_child.node:
  */
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__16, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1147, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__19, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1193, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 1147, __pyx_L1_error)
+    __PYX_ERR(0, 1193, __pyx_L1_error)
 
-    /* "resiliparse/parse/html.pyx":1146
+    /* "resiliparse/parse/html.pyx":1192
  *             raise RuntimeError('Replace operation on uninitialized node')
  * 
  *         if old_child.node.parent != self.node:             # <<<<<<<<<<<<<<
  *             raise ValueError('Node is not a child of the current node')
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":1149
+  /* "resiliparse/parse/html.pyx":1195
  *             raise ValueError('Node is not a child of the current node')
  * 
  *         if new_child.node == old_child.node:             # <<<<<<<<<<<<<<
  *             return old_child
  * 
  */
   __pyx_t_7 = ((__pyx_v_new_child->node == __pyx_v_old_child->node) != 0);
   if (__pyx_t_7) {
 
-    /* "resiliparse/parse/html.pyx":1150
+    /* "resiliparse/parse/html.pyx":1196
  * 
  *         if new_child.node == old_child.node:
  *             return old_child             # <<<<<<<<<<<<<<
  * 
  *         if new_child.node.parent:
  */
     __Pyx_XDECREF(((PyObject *)__pyx_r));
     __Pyx_INCREF(((PyObject *)__pyx_v_old_child));
     __pyx_r = __pyx_v_old_child;
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":1149
+    /* "resiliparse/parse/html.pyx":1195
  *             raise ValueError('Node is not a child of the current node')
  * 
  *         if new_child.node == old_child.node:             # <<<<<<<<<<<<<<
  *             return old_child
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":1152
+  /* "resiliparse/parse/html.pyx":1198
  *             return old_child
  * 
  *         if new_child.node.parent:             # <<<<<<<<<<<<<<
  *             lxb_dom_node_remove(new_child.node)
  *         lxb_dom_node_insert_after(old_child.node, new_child.node)
  */
   __pyx_t_7 = (__pyx_v_new_child->node->parent != 0);
   if (__pyx_t_7) {
 
-    /* "resiliparse/parse/html.pyx":1153
+    /* "resiliparse/parse/html.pyx":1199
  * 
  *         if new_child.node.parent:
  *             lxb_dom_node_remove(new_child.node)             # <<<<<<<<<<<<<<
  *         lxb_dom_node_insert_after(old_child.node, new_child.node)
  *         lxb_dom_node_remove(old_child.node)
  */
     lxb_dom_node_remove(__pyx_v_new_child->node);
 
-    /* "resiliparse/parse/html.pyx":1152
+    /* "resiliparse/parse/html.pyx":1198
  *             return old_child
  * 
  *         if new_child.node.parent:             # <<<<<<<<<<<<<<
  *             lxb_dom_node_remove(new_child.node)
  *         lxb_dom_node_insert_after(old_child.node, new_child.node)
  */
   }
 
-  /* "resiliparse/parse/html.pyx":1154
+  /* "resiliparse/parse/html.pyx":1200
  *         if new_child.node.parent:
  *             lxb_dom_node_remove(new_child.node)
  *         lxb_dom_node_insert_after(old_child.node, new_child.node)             # <<<<<<<<<<<<<<
  *         lxb_dom_node_remove(old_child.node)
  * 
  */
   lxb_dom_node_insert_after(__pyx_v_old_child->node, __pyx_v_new_child->node);
 
-  /* "resiliparse/parse/html.pyx":1155
+  /* "resiliparse/parse/html.pyx":1201
  *             lxb_dom_node_remove(new_child.node)
  *         lxb_dom_node_insert_after(old_child.node, new_child.node)
  *         lxb_dom_node_remove(old_child.node)             # <<<<<<<<<<<<<<
  * 
  *         return old_child
  */
   lxb_dom_node_remove(__pyx_v_old_child->node);
 
-  /* "resiliparse/parse/html.pyx":1157
+  /* "resiliparse/parse/html.pyx":1203
  *         lxb_dom_node_remove(old_child.node)
  * 
  *         return old_child             # <<<<<<<<<<<<<<
  * 
  *     cpdef DOMNode remove_child(self, DOMNode node):
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
   __Pyx_INCREF(((PyObject *)__pyx_v_old_child));
   __pyx_r = __pyx_v_old_child;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":1129
+  /* "resiliparse/parse/html.pyx":1175
  *         return node
  * 
  *     cpdef DOMNode replace_child(self, DOMNode new_child, DOMNode old_child):             # <<<<<<<<<<<<<<
  *         """
  *         replace_child(self, new_child, old_child)
  */
 
@@ -14794,39 +15394,39 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_new_child)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_old_child)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("replace_child", 1, 2, 2, 1); __PYX_ERR(0, 1129, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("replace_child", 1, 2, 2, 1); __PYX_ERR(0, 1175, __pyx_L3_error)
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "replace_child") < 0)) __PYX_ERR(0, 1129, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "replace_child") < 0)) __PYX_ERR(0, 1175, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 2) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
       values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
     }
     __pyx_v_new_child = ((struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *)values[0]);
     __pyx_v_old_child = ((struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *)values[1]);
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("replace_child", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1129, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("replace_child", 1, 2, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1175, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("resiliparse.parse.html.DOMNode.replace_child", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_new_child), __pyx_ptype_11resiliparse_5parse_4html_DOMNode, 1, "new_child", 0))) __PYX_ERR(0, 1129, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_old_child), __pyx_ptype_11resiliparse_5parse_4html_DOMNode, 1, "old_child", 0))) __PYX_ERR(0, 1129, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_new_child), __pyx_ptype_11resiliparse_5parse_4html_DOMNode, 1, "new_child", 0))) __PYX_ERR(0, 1175, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_old_child), __pyx_ptype_11resiliparse_5parse_4html_DOMNode, 1, "old_child", 0))) __PYX_ERR(0, 1175, __pyx_L1_error)
   __pyx_r = __pyx_pf_11resiliparse_5parse_4html_7DOMNode_39replace_child(((struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *)__pyx_v_self), __pyx_v_new_child, __pyx_v_old_child);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -14839,15 +15439,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("replace_child", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html_7DOMNode_replace_child(__pyx_v_self, __pyx_v_new_child, __pyx_v_old_child, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1129, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html_7DOMNode_replace_child(__pyx_v_self, __pyx_v_new_child, __pyx_v_old_child, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1175, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -14856,15 +15456,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":1159
+/* "resiliparse/parse/html.pyx":1205
  *         return old_child
  * 
  *     cpdef DOMNode remove_child(self, DOMNode node):             # <<<<<<<<<<<<<<
  *         """
  *         remove_child(self, node)
  */
 
@@ -14887,15 +15487,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_remove_child); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1159, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_remove_child); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1205, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_11resiliparse_5parse_4html_7DOMNode_42remove_child)) {
         __Pyx_XDECREF(((PyObject *)__pyx_r));
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
@@ -14904,18 +15504,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, ((PyObject *)__pyx_v_node)) : __Pyx_PyObject_CallOneArg(__pyx_t_3, ((PyObject *)__pyx_v_node));
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1159, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1205, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_11resiliparse_5parse_4html_DOMNode))))) __PYX_ERR(0, 1159, __pyx_L1_error)
+        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_11resiliparse_5parse_4html_DOMNode))))) __PYX_ERR(0, 1205, __pyx_L1_error)
         __pyx_r = ((struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *)__pyx_t_2);
         __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -14926,15 +15526,15 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "resiliparse/parse/html.pyx":1171
+  /* "resiliparse/parse/html.pyx":1217
  *         :raises ValueError: if ``node`` is not a child of this node
  *         """
  *         if not check_node(self) or not check_node(node):             # <<<<<<<<<<<<<<
  *             raise RuntimeError('Remove operation on uninitialized node')
  * 
  */
   __pyx_t_6 = ((!(__pyx_f_11resiliparse_5parse_4html_check_node(__pyx_v_self) != 0)) != 0);
@@ -14944,90 +15544,90 @@
     goto __pyx_L4_bool_binop_done;
   }
   __pyx_t_6 = ((!(__pyx_f_11resiliparse_5parse_4html_check_node(__pyx_v_node) != 0)) != 0);
   __pyx_t_5 = __pyx_t_6;
   __pyx_L4_bool_binop_done:;
   if (unlikely(__pyx_t_5)) {
 
-    /* "resiliparse/parse/html.pyx":1172
+    /* "resiliparse/parse/html.pyx":1218
  *         """
  *         if not check_node(self) or not check_node(node):
  *             raise RuntimeError('Remove operation on uninitialized node')             # <<<<<<<<<<<<<<
  * 
  *         if node.node.parent != self.node:
  */
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_RuntimeError, __pyx_tuple__17, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1172, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_RuntimeError, __pyx_tuple__20, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1218, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 1172, __pyx_L1_error)
+    __PYX_ERR(0, 1218, __pyx_L1_error)
 
-    /* "resiliparse/parse/html.pyx":1171
+    /* "resiliparse/parse/html.pyx":1217
  *         :raises ValueError: if ``node`` is not a child of this node
  *         """
  *         if not check_node(self) or not check_node(node):             # <<<<<<<<<<<<<<
  *             raise RuntimeError('Remove operation on uninitialized node')
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":1174
+  /* "resiliparse/parse/html.pyx":1220
  *             raise RuntimeError('Remove operation on uninitialized node')
  * 
  *         if node.node.parent != self.node:             # <<<<<<<<<<<<<<
  *             raise ValueError('Node is not a child of the current node')
  * 
  */
   __pyx_t_5 = ((__pyx_v_node->node->parent != __pyx_v_self->node) != 0);
   if (unlikely(__pyx_t_5)) {
 
-    /* "resiliparse/parse/html.pyx":1175
+    /* "resiliparse/parse/html.pyx":1221
  * 
  *         if node.node.parent != self.node:
  *             raise ValueError('Node is not a child of the current node')             # <<<<<<<<<<<<<<
  * 
  *         lxb_dom_node_remove(node.node)
  */
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__16, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1175, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__19, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1221, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 1175, __pyx_L1_error)
+    __PYX_ERR(0, 1221, __pyx_L1_error)
 
-    /* "resiliparse/parse/html.pyx":1174
+    /* "resiliparse/parse/html.pyx":1220
  *             raise RuntimeError('Remove operation on uninitialized node')
  * 
  *         if node.node.parent != self.node:             # <<<<<<<<<<<<<<
  *             raise ValueError('Node is not a child of the current node')
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":1177
+  /* "resiliparse/parse/html.pyx":1223
  *             raise ValueError('Node is not a child of the current node')
  * 
  *         lxb_dom_node_remove(node.node)             # <<<<<<<<<<<<<<
  *         return node
  * 
  */
   lxb_dom_node_remove(__pyx_v_node->node);
 
-  /* "resiliparse/parse/html.pyx":1178
+  /* "resiliparse/parse/html.pyx":1224
  * 
  *         lxb_dom_node_remove(node.node)
  *         return node             # <<<<<<<<<<<<<<
  * 
  *     # noinspection PyAttributeOutsideInit
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
   __Pyx_INCREF(((PyObject *)__pyx_v_node));
   __pyx_r = __pyx_v_node;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":1159
+  /* "resiliparse/parse/html.pyx":1205
  *         return old_child
  * 
  *     cpdef DOMNode remove_child(self, DOMNode node):             # <<<<<<<<<<<<<<
  *         """
  *         remove_child(self, node)
  */
 
@@ -15051,15 +15651,15 @@
 static PyObject *__pyx_pw_11resiliparse_5parse_4html_7DOMNode_42remove_child(PyObject *__pyx_v_self, PyObject *__pyx_v_node) {
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("remove_child (wrapper)", 0);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_node), __pyx_ptype_11resiliparse_5parse_4html_DOMNode, 1, "node", 0))) __PYX_ERR(0, 1159, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_node), __pyx_ptype_11resiliparse_5parse_4html_DOMNode, 1, "node", 0))) __PYX_ERR(0, 1205, __pyx_L1_error)
   __pyx_r = __pyx_pf_11resiliparse_5parse_4html_7DOMNode_41remove_child(((struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *)__pyx_v_self), ((struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *)__pyx_v_node));
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -15072,15 +15672,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("remove_child", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html_7DOMNode_remove_child(__pyx_v_self, __pyx_v_node, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1159, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html_7DOMNode_remove_child(__pyx_v_self, __pyx_v_node, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1205, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -15089,15 +15689,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":1181
+/* "resiliparse/parse/html.pyx":1227
  * 
  *     # noinspection PyAttributeOutsideInit
  *     cpdef decompose(self):             # <<<<<<<<<<<<<<
  *         """
  *         decompose(self)
  */
 
@@ -15119,15 +15719,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_decompose); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1181, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_decompose); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1227, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_11resiliparse_5parse_4html_7DOMNode_44decompose)) {
         __Pyx_XDECREF(__pyx_r);
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
@@ -15136,15 +15736,15 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_t_4) : __Pyx_PyObject_CallNoArg(__pyx_t_3);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1181, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1227, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         __pyx_r = __pyx_t_2;
         __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
@@ -15157,78 +15757,78 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "resiliparse/parse/html.pyx":1187
+  /* "resiliparse/parse/html.pyx":1233
  *         Delete the current node and all its children.
  *         """
  *         if not check_node(self):             # <<<<<<<<<<<<<<
  *             raise RuntimeError('Decompose operation on uninitialized node')
  * 
  */
   __pyx_t_5 = ((!(__pyx_f_11resiliparse_5parse_4html_check_node(__pyx_v_self) != 0)) != 0);
   if (unlikely(__pyx_t_5)) {
 
-    /* "resiliparse/parse/html.pyx":1188
+    /* "resiliparse/parse/html.pyx":1234
  *         """
  *         if not check_node(self):
  *             raise RuntimeError('Decompose operation on uninitialized node')             # <<<<<<<<<<<<<<
  * 
  *         lxb_dom_node_destroy_deep(self.node)
  */
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_RuntimeError, __pyx_tuple__18, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1188, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_RuntimeError, __pyx_tuple__21, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1234, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 1188, __pyx_L1_error)
+    __PYX_ERR(0, 1234, __pyx_L1_error)
 
-    /* "resiliparse/parse/html.pyx":1187
+    /* "resiliparse/parse/html.pyx":1233
  *         Delete the current node and all its children.
  *         """
  *         if not check_node(self):             # <<<<<<<<<<<<<<
  *             raise RuntimeError('Decompose operation on uninitialized node')
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":1190
+  /* "resiliparse/parse/html.pyx":1236
  *             raise RuntimeError('Decompose operation on uninitialized node')
  * 
  *         lxb_dom_node_destroy_deep(self.node)             # <<<<<<<<<<<<<<
  *         self.node = NULL
  *         self.tree = None
  */
   (void)(lxb_dom_node_destroy_deep(__pyx_v_self->node));
 
-  /* "resiliparse/parse/html.pyx":1191
+  /* "resiliparse/parse/html.pyx":1237
  * 
  *         lxb_dom_node_destroy_deep(self.node)
  *         self.node = NULL             # <<<<<<<<<<<<<<
  *         self.tree = None
  * 
  */
   __pyx_v_self->node = NULL;
 
-  /* "resiliparse/parse/html.pyx":1192
+  /* "resiliparse/parse/html.pyx":1238
  *         lxb_dom_node_destroy_deep(self.node)
  *         self.node = NULL
  *         self.tree = None             # <<<<<<<<<<<<<<
  * 
  *     def __repr__(self):
  */
   __Pyx_INCREF(Py_None);
   __Pyx_GIVEREF(Py_None);
   __Pyx_GOTREF(__pyx_v_self->tree);
   __Pyx_DECREF(((PyObject *)__pyx_v_self->tree));
   __pyx_v_self->tree = ((struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *)Py_None);
 
-  /* "resiliparse/parse/html.pyx":1181
+  /* "resiliparse/parse/html.pyx":1227
  * 
  *     # noinspection PyAttributeOutsideInit
  *     cpdef decompose(self):             # <<<<<<<<<<<<<<
  *         """
  *         decompose(self)
  */
 
@@ -15267,15 +15867,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("decompose", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __pyx_f_11resiliparse_5parse_4html_7DOMNode_decompose(__pyx_v_self, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1181, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_11resiliparse_5parse_4html_7DOMNode_decompose(__pyx_v_self, 1); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1227, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -15284,15 +15884,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":1194
+/* "resiliparse/parse/html.pyx":1240
  *         self.tree = None
  * 
  *     def __repr__(self):             # <<<<<<<<<<<<<<
  *         if not check_node(self):
  *             return '<INVALID ELEMENT>'
  */
 
@@ -15306,15 +15906,15 @@
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 static PyObject *__pyx_gb_11resiliparse_5parse_4html_7DOMNode_8__repr___2generator2(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value); /* proto */
 
-/* "resiliparse/parse/html.pyx":1199
+/* "resiliparse/parse/html.pyx":1245
  * 
  *         if self.node.type == LXB_DOM_NODE_TYPE_ELEMENT:
  *             attrs = ' '.join(f'{a}="{self[a]}"' for a in self.attrs)             # <<<<<<<<<<<<<<
  *             if attrs:
  *                 attrs = ' ' + attrs
  */
 
@@ -15326,23 +15926,23 @@
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("genexpr", 0);
   __pyx_cur_scope = (struct __pyx_obj_11resiliparse_5parse_4html___pyx_scope_struct_2_genexpr *)__pyx_tp_new_11resiliparse_5parse_4html___pyx_scope_struct_2_genexpr(__pyx_ptype_11resiliparse_5parse_4html___pyx_scope_struct_2_genexpr, __pyx_empty_tuple, NULL);
   if (unlikely(!__pyx_cur_scope)) {
     __pyx_cur_scope = ((struct __pyx_obj_11resiliparse_5parse_4html___pyx_scope_struct_2_genexpr *)Py_None);
     __Pyx_INCREF(Py_None);
-    __PYX_ERR(0, 1199, __pyx_L1_error)
+    __PYX_ERR(0, 1245, __pyx_L1_error)
   } else {
     __Pyx_GOTREF(__pyx_cur_scope);
   }
   __pyx_cur_scope->__pyx_outer_scope = (struct __pyx_obj_11resiliparse_5parse_4html___pyx_scope_struct_1___repr__ *) __pyx_self;
   __Pyx_INCREF(((PyObject *)__pyx_cur_scope->__pyx_outer_scope));
   __Pyx_GIVEREF(__pyx_cur_scope->__pyx_outer_scope);
   {
-    __pyx_CoroutineObject *gen = __Pyx_Generator_New((__pyx_coroutine_body_t) __pyx_gb_11resiliparse_5parse_4html_7DOMNode_8__repr___2generator2, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_genexpr, __pyx_n_s_repr___locals_genexpr, __pyx_n_s_resiliparse_parse_html); if (unlikely(!gen)) __PYX_ERR(0, 1199, __pyx_L1_error)
+    __pyx_CoroutineObject *gen = __Pyx_Generator_New((__pyx_coroutine_body_t) __pyx_gb_11resiliparse_5parse_4html_7DOMNode_8__repr___2generator2, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_genexpr, __pyx_n_s_repr___locals_genexpr, __pyx_n_s_resiliparse_parse_html); if (unlikely(!gen)) __PYX_ERR(0, 1245, __pyx_L1_error)
     __Pyx_DECREF(__pyx_cur_scope);
     __Pyx_RefNannyFinishContext();
     return (PyObject *) gen;
   }
 
   /* function exit code */
   __pyx_L1_error:;
@@ -15374,98 +15974,98 @@
   switch (__pyx_generator->resume_label) {
     case 0: goto __pyx_L3_first_run;
     default: /* CPython raises the right error here */
     __Pyx_RefNannyFinishContext();
     return NULL;
   }
   __pyx_L3_first_run:;
-  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1199, __pyx_L1_error)
-  __pyx_r = PyList_New(0); if (unlikely(!__pyx_r)) __PYX_ERR(0, 1199, __pyx_L1_error)
+  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1245, __pyx_L1_error)
+  __pyx_r = PyList_New(0); if (unlikely(!__pyx_r)) __PYX_ERR(0, 1245, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_r);
-  if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_self)) { __Pyx_RaiseClosureNameError("self"); __PYX_ERR(0, 1199, __pyx_L1_error) }
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_outer_scope->__pyx_v_self), __pyx_n_s_attrs); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1199, __pyx_L1_error)
+  if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_self)) { __Pyx_RaiseClosureNameError("self"); __PYX_ERR(0, 1245, __pyx_L1_error) }
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_outer_scope->__pyx_v_self), __pyx_n_s_attrs); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1245, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   if (likely(PyList_CheckExact(__pyx_t_1)) || PyTuple_CheckExact(__pyx_t_1)) {
     __pyx_t_2 = __pyx_t_1; __Pyx_INCREF(__pyx_t_2); __pyx_t_3 = 0;
     __pyx_t_4 = NULL;
   } else {
-    __pyx_t_3 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1199, __pyx_L1_error)
+    __pyx_t_3 = -1; __pyx_t_2 = PyObject_GetIter(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1245, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
-    __pyx_t_4 = Py_TYPE(__pyx_t_2)->tp_iternext; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1199, __pyx_L1_error)
+    __pyx_t_4 = Py_TYPE(__pyx_t_2)->tp_iternext; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1245, __pyx_L1_error)
   }
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   for (;;) {
     if (likely(!__pyx_t_4)) {
       if (likely(PyList_CheckExact(__pyx_t_2))) {
         if (__pyx_t_3 >= PyList_GET_SIZE(__pyx_t_2)) break;
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_1 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_3); __Pyx_INCREF(__pyx_t_1); __pyx_t_3++; if (unlikely(0 < 0)) __PYX_ERR(0, 1199, __pyx_L1_error)
+        __pyx_t_1 = PyList_GET_ITEM(__pyx_t_2, __pyx_t_3); __Pyx_INCREF(__pyx_t_1); __pyx_t_3++; if (unlikely(0 < 0)) __PYX_ERR(0, 1245, __pyx_L1_error)
         #else
-        __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_3); __pyx_t_3++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1199, __pyx_L1_error)
+        __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_3); __pyx_t_3++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1245, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
         #endif
       } else {
         if (__pyx_t_3 >= PyTuple_GET_SIZE(__pyx_t_2)) break;
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_3); __Pyx_INCREF(__pyx_t_1); __pyx_t_3++; if (unlikely(0 < 0)) __PYX_ERR(0, 1199, __pyx_L1_error)
+        __pyx_t_1 = PyTuple_GET_ITEM(__pyx_t_2, __pyx_t_3); __Pyx_INCREF(__pyx_t_1); __pyx_t_3++; if (unlikely(0 < 0)) __PYX_ERR(0, 1245, __pyx_L1_error)
         #else
-        __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_3); __pyx_t_3++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1199, __pyx_L1_error)
+        __pyx_t_1 = PySequence_ITEM(__pyx_t_2, __pyx_t_3); __pyx_t_3++; if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1245, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_1);
         #endif
       }
     } else {
       __pyx_t_1 = __pyx_t_4(__pyx_t_2);
       if (unlikely(!__pyx_t_1)) {
         PyObject* exc_type = PyErr_Occurred();
         if (exc_type) {
           if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-          else __PYX_ERR(0, 1199, __pyx_L1_error)
+          else __PYX_ERR(0, 1245, __pyx_L1_error)
         }
         break;
       }
       __Pyx_GOTREF(__pyx_t_1);
     }
     __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_a);
     __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_a, __pyx_t_1);
     __Pyx_GIVEREF(__pyx_t_1);
     __pyx_t_1 = 0;
-    __pyx_t_1 = PyTuple_New(4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1199, __pyx_L1_error)
+    __pyx_t_1 = PyTuple_New(4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1245, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __pyx_t_5 = 0;
     __pyx_t_6 = 127;
-    __pyx_t_7 = __Pyx_PyObject_FormatSimple(__pyx_cur_scope->__pyx_v_a, __pyx_empty_unicode); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1199, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyObject_FormatSimple(__pyx_cur_scope->__pyx_v_a, __pyx_empty_unicode); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1245, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
     __pyx_t_6 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_7) > __pyx_t_6) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_7) : __pyx_t_6;
     __pyx_t_5 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_7);
     __Pyx_GIVEREF(__pyx_t_7);
     PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_t_7);
     __pyx_t_7 = 0;
-    __Pyx_INCREF(__pyx_kp_u__19);
+    __Pyx_INCREF(__pyx_kp_u__22);
     __pyx_t_5 += 2;
-    __Pyx_GIVEREF(__pyx_kp_u__19);
-    PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_kp_u__19);
-    if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_self)) { __Pyx_RaiseClosureNameError("self"); __PYX_ERR(0, 1199, __pyx_L1_error) }
-    __pyx_t_7 = __Pyx_PyObject_GetItem(((PyObject *)__pyx_cur_scope->__pyx_outer_scope->__pyx_v_self), __pyx_cur_scope->__pyx_v_a); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1199, __pyx_L1_error)
+    __Pyx_GIVEREF(__pyx_kp_u__22);
+    PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_kp_u__22);
+    if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_self)) { __Pyx_RaiseClosureNameError("self"); __PYX_ERR(0, 1245, __pyx_L1_error) }
+    __pyx_t_7 = __Pyx_PyObject_GetItem(((PyObject *)__pyx_cur_scope->__pyx_outer_scope->__pyx_v_self), __pyx_cur_scope->__pyx_v_a); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1245, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
-    __pyx_t_8 = __Pyx_PyObject_FormatSimple(__pyx_t_7, __pyx_empty_unicode); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1199, __pyx_L1_error)
+    __pyx_t_8 = __Pyx_PyObject_FormatSimple(__pyx_t_7, __pyx_empty_unicode); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1245, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
     __pyx_t_6 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_8) > __pyx_t_6) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_8) : __pyx_t_6;
     __pyx_t_5 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_8);
     __Pyx_GIVEREF(__pyx_t_8);
     PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_t_8);
     __pyx_t_8 = 0;
-    __Pyx_INCREF(__pyx_kp_u__20);
+    __Pyx_INCREF(__pyx_kp_u__23);
     __pyx_t_5 += 1;
-    __Pyx_GIVEREF(__pyx_kp_u__20);
-    PyTuple_SET_ITEM(__pyx_t_1, 3, __pyx_kp_u__20);
-    __pyx_t_8 = __Pyx_PyUnicode_Join(__pyx_t_1, 4, __pyx_t_5, __pyx_t_6); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1199, __pyx_L1_error)
+    __Pyx_GIVEREF(__pyx_kp_u__23);
+    PyTuple_SET_ITEM(__pyx_t_1, 3, __pyx_kp_u__23);
+    __pyx_t_8 = __Pyx_PyUnicode_Join(__pyx_t_1, 4, __pyx_t_5, __pyx_t_6); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1245, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    if (unlikely(__Pyx_ListComp_Append(__pyx_r, (PyObject*)__pyx_t_8))) __PYX_ERR(0, 1199, __pyx_L1_error)
+    if (unlikely(__Pyx_ListComp_Append(__pyx_r, (PyObject*)__pyx_t_8))) __PYX_ERR(0, 1245, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
   }
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   CYTHON_MAYBE_UNUSED_VAR(__pyx_cur_scope);
 
   /* function exit code */
   goto __pyx_L0;
@@ -15483,15 +16083,15 @@
   #endif
   __pyx_generator->resume_label = -1;
   __Pyx_Coroutine_clear((PyObject*)__pyx_generator);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":1194
+/* "resiliparse/parse/html.pyx":1240
  *         self.tree = None
  * 
  *     def __repr__(self):             # <<<<<<<<<<<<<<
  *         if not check_node(self):
  *             return '<INVALID ELEMENT>'
  */
 
@@ -15511,279 +16111,279 @@
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__repr__", 0);
   __pyx_cur_scope = (struct __pyx_obj_11resiliparse_5parse_4html___pyx_scope_struct_1___repr__ *)__pyx_tp_new_11resiliparse_5parse_4html___pyx_scope_struct_1___repr__(__pyx_ptype_11resiliparse_5parse_4html___pyx_scope_struct_1___repr__, __pyx_empty_tuple, NULL);
   if (unlikely(!__pyx_cur_scope)) {
     __pyx_cur_scope = ((struct __pyx_obj_11resiliparse_5parse_4html___pyx_scope_struct_1___repr__ *)Py_None);
     __Pyx_INCREF(Py_None);
-    __PYX_ERR(0, 1194, __pyx_L1_error)
+    __PYX_ERR(0, 1240, __pyx_L1_error)
   } else {
     __Pyx_GOTREF(__pyx_cur_scope);
   }
   __pyx_cur_scope->__pyx_v_self = __pyx_v_self;
   __Pyx_INCREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
   __Pyx_GIVEREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
 
-  /* "resiliparse/parse/html.pyx":1195
+  /* "resiliparse/parse/html.pyx":1241
  * 
  *     def __repr__(self):
  *         if not check_node(self):             # <<<<<<<<<<<<<<
  *             return '<INVALID ELEMENT>'
  * 
  */
   __pyx_t_1 = ((PyObject *)__pyx_cur_scope->__pyx_v_self);
   __Pyx_INCREF(__pyx_t_1);
   __pyx_t_2 = ((!(__pyx_f_11resiliparse_5parse_4html_check_node(((struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *)__pyx_t_1)) != 0)) != 0);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   if (__pyx_t_2) {
 
-    /* "resiliparse/parse/html.pyx":1196
+    /* "resiliparse/parse/html.pyx":1242
  *     def __repr__(self):
  *         if not check_node(self):
  *             return '<INVALID ELEMENT>'             # <<<<<<<<<<<<<<
  * 
  *         if self.node.type == LXB_DOM_NODE_TYPE_ELEMENT:
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_kp_u_INVALID_ELEMENT);
     __pyx_r = __pyx_kp_u_INVALID_ELEMENT;
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":1195
+    /* "resiliparse/parse/html.pyx":1241
  * 
  *     def __repr__(self):
  *         if not check_node(self):             # <<<<<<<<<<<<<<
  *             return '<INVALID ELEMENT>'
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":1198
+  /* "resiliparse/parse/html.pyx":1244
  *             return '<INVALID ELEMENT>'
  * 
  *         if self.node.type == LXB_DOM_NODE_TYPE_ELEMENT:             # <<<<<<<<<<<<<<
  *             attrs = ' '.join(f'{a}="{self[a]}"' for a in self.attrs)
  *             if attrs:
  */
   switch (__pyx_cur_scope->__pyx_v_self->node->type) {
     case LXB_DOM_NODE_TYPE_ELEMENT:
 
-    /* "resiliparse/parse/html.pyx":1199
+    /* "resiliparse/parse/html.pyx":1245
  * 
  *         if self.node.type == LXB_DOM_NODE_TYPE_ELEMENT:
  *             attrs = ' '.join(f'{a}="{self[a]}"' for a in self.attrs)             # <<<<<<<<<<<<<<
  *             if attrs:
  *                 attrs = ' ' + attrs
  */
-    __pyx_t_1 = __pyx_pf_11resiliparse_5parse_4html_7DOMNode_8__repr___genexpr(((PyObject*)__pyx_cur_scope)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1199, __pyx_L1_error)
+    __pyx_t_1 = __pyx_pf_11resiliparse_5parse_4html_7DOMNode_8__repr___genexpr(((PyObject*)__pyx_cur_scope)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1245, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_3 = __Pyx_Generator_Next(__pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1199, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_Generator_Next(__pyx_t_1); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1245, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __pyx_t_1 = PyUnicode_Join(__pyx_kp_u__3, __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1199, __pyx_L1_error)
+    __pyx_t_1 = PyUnicode_Join(__pyx_kp_u__6, __pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1245, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_v_attrs = ((PyObject*)__pyx_t_1);
     __pyx_t_1 = 0;
 
-    /* "resiliparse/parse/html.pyx":1200
+    /* "resiliparse/parse/html.pyx":1246
  *         if self.node.type == LXB_DOM_NODE_TYPE_ELEMENT:
  *             attrs = ' '.join(f'{a}="{self[a]}"' for a in self.attrs)
  *             if attrs:             # <<<<<<<<<<<<<<
  *                 attrs = ' ' + attrs
  *             return f'<{self.tag}{attrs}>'
  */
     __pyx_t_2 = (__pyx_v_attrs != Py_None)&&(__Pyx_PyUnicode_IS_TRUE(__pyx_v_attrs) != 0);
     if (__pyx_t_2) {
 
-      /* "resiliparse/parse/html.pyx":1201
+      /* "resiliparse/parse/html.pyx":1247
  *             attrs = ' '.join(f'{a}="{self[a]}"' for a in self.attrs)
  *             if attrs:
  *                 attrs = ' ' + attrs             # <<<<<<<<<<<<<<
  *             return f'<{self.tag}{attrs}>'
  *         elif self.node.type == LXB_DOM_NODE_TYPE_TEXT:
  */
-      __pyx_t_1 = __Pyx_PyUnicode_ConcatSafe(__pyx_kp_u__3, __pyx_v_attrs); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1201, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyUnicode_ConcatSafe(__pyx_kp_u__6, __pyx_v_attrs); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1247, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       __Pyx_DECREF_SET(__pyx_v_attrs, ((PyObject*)__pyx_t_1));
       __pyx_t_1 = 0;
 
-      /* "resiliparse/parse/html.pyx":1200
+      /* "resiliparse/parse/html.pyx":1246
  *         if self.node.type == LXB_DOM_NODE_TYPE_ELEMENT:
  *             attrs = ' '.join(f'{a}="{self[a]}"' for a in self.attrs)
  *             if attrs:             # <<<<<<<<<<<<<<
  *                 attrs = ' ' + attrs
  *             return f'<{self.tag}{attrs}>'
  */
     }
 
-    /* "resiliparse/parse/html.pyx":1202
+    /* "resiliparse/parse/html.pyx":1248
  *             if attrs:
  *                 attrs = ' ' + attrs
  *             return f'<{self.tag}{attrs}>'             # <<<<<<<<<<<<<<
  *         elif self.node.type == LXB_DOM_NODE_TYPE_TEXT:
  *             return self.text
  */
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_1 = PyTuple_New(4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1202, __pyx_L1_error)
+    __pyx_t_1 = PyTuple_New(4); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1248, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __pyx_t_4 = 0;
     __pyx_t_5 = 127;
-    __Pyx_INCREF(__pyx_kp_u__21);
+    __Pyx_INCREF(__pyx_kp_u__24);
     __pyx_t_4 += 1;
-    __Pyx_GIVEREF(__pyx_kp_u__21);
-    PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_u__21);
-    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_tag); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1202, __pyx_L1_error)
+    __Pyx_GIVEREF(__pyx_kp_u__24);
+    PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_u__24);
+    __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_tag); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1248, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_3);
-    __pyx_t_6 = __Pyx_PyObject_FormatSimple(__pyx_t_3, __pyx_empty_unicode); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1202, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_FormatSimple(__pyx_t_3, __pyx_empty_unicode); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1248, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
     __pyx_t_5 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_6) > __pyx_t_5) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_6) : __pyx_t_5;
     __pyx_t_4 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_6);
     __Pyx_GIVEREF(__pyx_t_6);
     PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_6);
     __pyx_t_6 = 0;
-    __pyx_t_6 = __Pyx_PyUnicode_Unicode(__pyx_v_attrs); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1202, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyUnicode_Unicode(__pyx_v_attrs); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1248, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __pyx_t_5 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_6) > __pyx_t_5) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_6) : __pyx_t_5;
     __pyx_t_4 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_6);
     __Pyx_GIVEREF(__pyx_t_6);
     PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_t_6);
     __pyx_t_6 = 0;
-    __Pyx_INCREF(__pyx_kp_u__22);
+    __Pyx_INCREF(__pyx_kp_u__25);
     __pyx_t_4 += 1;
-    __Pyx_GIVEREF(__pyx_kp_u__22);
-    PyTuple_SET_ITEM(__pyx_t_1, 3, __pyx_kp_u__22);
-    __pyx_t_6 = __Pyx_PyUnicode_Join(__pyx_t_1, 4, __pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1202, __pyx_L1_error)
+    __Pyx_GIVEREF(__pyx_kp_u__25);
+    PyTuple_SET_ITEM(__pyx_t_1, 3, __pyx_kp_u__25);
+    __pyx_t_6 = __Pyx_PyUnicode_Join(__pyx_t_1, 4, __pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1248, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __pyx_r = __pyx_t_6;
     __pyx_t_6 = 0;
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":1198
+    /* "resiliparse/parse/html.pyx":1244
  *             return '<INVALID ELEMENT>'
  * 
  *         if self.node.type == LXB_DOM_NODE_TYPE_ELEMENT:             # <<<<<<<<<<<<<<
  *             attrs = ' '.join(f'{a}="{self[a]}"' for a in self.attrs)
  *             if attrs:
  */
     break;
     case LXB_DOM_NODE_TYPE_TEXT:
 
-    /* "resiliparse/parse/html.pyx":1204
+    /* "resiliparse/parse/html.pyx":1250
  *             return f'<{self.tag}{attrs}>'
  *         elif self.node.type == LXB_DOM_NODE_TYPE_TEXT:
  *             return self.text             # <<<<<<<<<<<<<<
  *         elif self.node.type == LXB_DOM_NODE_TYPE_DOCUMENT:
  *             return '[HTML Document]'
  */
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_text); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1204, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_text); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1250, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __pyx_r = __pyx_t_6;
     __pyx_t_6 = 0;
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":1203
+    /* "resiliparse/parse/html.pyx":1249
  *                 attrs = ' ' + attrs
  *             return f'<{self.tag}{attrs}>'
  *         elif self.node.type == LXB_DOM_NODE_TYPE_TEXT:             # <<<<<<<<<<<<<<
  *             return self.text
  *         elif self.node.type == LXB_DOM_NODE_TYPE_DOCUMENT:
  */
     break;
     case LXB_DOM_NODE_TYPE_DOCUMENT:
 
-    /* "resiliparse/parse/html.pyx":1206
+    /* "resiliparse/parse/html.pyx":1252
  *             return self.text
  *         elif self.node.type == LXB_DOM_NODE_TYPE_DOCUMENT:
  *             return '[HTML Document]'             # <<<<<<<<<<<<<<
  *         elif self.node.type == LXB_DOM_NODE_TYPE_DOCUMENT_TYPE:
  *             return '<!DOCTYPE html>'
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_kp_u_HTML_Document);
     __pyx_r = __pyx_kp_u_HTML_Document;
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":1205
+    /* "resiliparse/parse/html.pyx":1251
  *         elif self.node.type == LXB_DOM_NODE_TYPE_TEXT:
  *             return self.text
  *         elif self.node.type == LXB_DOM_NODE_TYPE_DOCUMENT:             # <<<<<<<<<<<<<<
  *             return '[HTML Document]'
  *         elif self.node.type == LXB_DOM_NODE_TYPE_DOCUMENT_TYPE:
  */
     break;
     case LXB_DOM_NODE_TYPE_DOCUMENT_TYPE:
 
-    /* "resiliparse/parse/html.pyx":1208
+    /* "resiliparse/parse/html.pyx":1254
  *             return '[HTML Document]'
  *         elif self.node.type == LXB_DOM_NODE_TYPE_DOCUMENT_TYPE:
  *             return '<!DOCTYPE html>'             # <<<<<<<<<<<<<<
  * 
  *         return f'<{self.__class__.__name__} Element>'
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(__pyx_kp_u_DOCTYPE_html);
     __pyx_r = __pyx_kp_u_DOCTYPE_html;
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":1207
+    /* "resiliparse/parse/html.pyx":1253
  *         elif self.node.type == LXB_DOM_NODE_TYPE_DOCUMENT:
  *             return '[HTML Document]'
  *         elif self.node.type == LXB_DOM_NODE_TYPE_DOCUMENT_TYPE:             # <<<<<<<<<<<<<<
  *             return '<!DOCTYPE html>'
  * 
  */
     break;
     default: break;
   }
 
-  /* "resiliparse/parse/html.pyx":1210
+  /* "resiliparse/parse/html.pyx":1256
  *             return '<!DOCTYPE html>'
  * 
  *         return f'<{self.__class__.__name__} Element>'             # <<<<<<<<<<<<<<
  * 
  *     def __str__(self):
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1210, __pyx_L1_error)
+  __pyx_t_6 = PyTuple_New(3); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1256, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __pyx_t_4 = 0;
   __pyx_t_5 = 127;
-  __Pyx_INCREF(__pyx_kp_u__21);
+  __Pyx_INCREF(__pyx_kp_u__24);
   __pyx_t_4 += 1;
-  __Pyx_GIVEREF(__pyx_kp_u__21);
-  PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_kp_u__21);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_class_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1210, __pyx_L1_error)
+  __Pyx_GIVEREF(__pyx_kp_u__24);
+  PyTuple_SET_ITEM(__pyx_t_6, 0, __pyx_kp_u__24);
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_cur_scope->__pyx_v_self), __pyx_n_s_class_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1256, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_name); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1210, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_t_1, __pyx_n_s_name); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1256, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __pyx_t_1 = __Pyx_PyObject_FormatSimple(__pyx_t_3, __pyx_empty_unicode); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1210, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_FormatSimple(__pyx_t_3, __pyx_empty_unicode); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1256, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_t_5 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_1) > __pyx_t_5) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_1) : __pyx_t_5;
   __pyx_t_4 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_6, 1, __pyx_t_1);
   __pyx_t_1 = 0;
   __Pyx_INCREF(__pyx_kp_u_Element);
   __pyx_t_4 += 9;
   __Pyx_GIVEREF(__pyx_kp_u_Element);
   PyTuple_SET_ITEM(__pyx_t_6, 2, __pyx_kp_u_Element);
-  __pyx_t_1 = __Pyx_PyUnicode_Join(__pyx_t_6, 3, __pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1210, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyUnicode_Join(__pyx_t_6, 3, __pyx_t_4, __pyx_t_5); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1256, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":1194
+  /* "resiliparse/parse/html.pyx":1240
  *         self.tree = None
  * 
  *     def __repr__(self):             # <<<<<<<<<<<<<<
  *         if not check_node(self):
  *             return '<INVALID ELEMENT>'
  */
 
@@ -15799,15 +16399,15 @@
   __Pyx_XDECREF(__pyx_gb_11resiliparse_5parse_4html_7DOMNode_8__repr___2generator2);
   __Pyx_DECREF(((PyObject *)__pyx_cur_scope));
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":1212
+/* "resiliparse/parse/html.pyx":1258
  *         return f'<{self.__class__.__name__} Element>'
  * 
  *     def __str__(self):             # <<<<<<<<<<<<<<
  *         return self.html
  * 
  */
 
@@ -15829,29 +16429,29 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__str__", 0);
 
-  /* "resiliparse/parse/html.pyx":1213
+  /* "resiliparse/parse/html.pyx":1259
  * 
  *     def __str__(self):
  *         return self.html             # <<<<<<<<<<<<<<
  * 
  *     def __eq__(self, other):
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_html); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1213, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_html); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1259, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":1212
+  /* "resiliparse/parse/html.pyx":1258
  *         return f'<{self.__class__.__name__} Element>'
  * 
  *     def __str__(self):             # <<<<<<<<<<<<<<
  *         return self.html
  * 
  */
 
@@ -15862,15 +16462,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":1215
+/* "resiliparse/parse/html.pyx":1261
  *         return self.html
  * 
  *     def __eq__(self, other):             # <<<<<<<<<<<<<<
  *         if not check_node(self) or not isinstance(other, DOMNode):
  *             return False
  */
 
@@ -15896,15 +16496,15 @@
   int __pyx_t_3;
   PyObject *__pyx_t_4 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__eq__", 0);
 
-  /* "resiliparse/parse/html.pyx":1216
+  /* "resiliparse/parse/html.pyx":1262
  * 
  *     def __eq__(self, other):
  *         if not check_node(self) or not isinstance(other, DOMNode):             # <<<<<<<<<<<<<<
  *             return False
  *         cdef DOMNode other_dom = <DOMNode>other
  */
   __pyx_t_2 = ((!(__pyx_f_11resiliparse_5parse_4html_check_node(__pyx_v_self) != 0)) != 0);
@@ -15915,62 +16515,62 @@
   }
   __pyx_t_2 = __Pyx_TypeCheck(__pyx_v_other, __pyx_ptype_11resiliparse_5parse_4html_DOMNode); 
   __pyx_t_3 = ((!(__pyx_t_2 != 0)) != 0);
   __pyx_t_1 = __pyx_t_3;
   __pyx_L4_bool_binop_done:;
   if (__pyx_t_1) {
 
-    /* "resiliparse/parse/html.pyx":1217
+    /* "resiliparse/parse/html.pyx":1263
  *     def __eq__(self, other):
  *         if not check_node(self) or not isinstance(other, DOMNode):
  *             return False             # <<<<<<<<<<<<<<
  *         cdef DOMNode other_dom = <DOMNode>other
  *         return other_dom.node == self.node
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(Py_False);
     __pyx_r = Py_False;
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":1216
+    /* "resiliparse/parse/html.pyx":1262
  * 
  *     def __eq__(self, other):
  *         if not check_node(self) or not isinstance(other, DOMNode):             # <<<<<<<<<<<<<<
  *             return False
  *         cdef DOMNode other_dom = <DOMNode>other
  */
   }
 
-  /* "resiliparse/parse/html.pyx":1218
+  /* "resiliparse/parse/html.pyx":1264
  *         if not check_node(self) or not isinstance(other, DOMNode):
  *             return False
  *         cdef DOMNode other_dom = <DOMNode>other             # <<<<<<<<<<<<<<
  *         return other_dom.node == self.node
  * 
  */
   __pyx_t_4 = __pyx_v_other;
   __Pyx_INCREF(__pyx_t_4);
   __pyx_v_other_dom = ((struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *)__pyx_t_4);
   __pyx_t_4 = 0;
 
-  /* "resiliparse/parse/html.pyx":1219
+  /* "resiliparse/parse/html.pyx":1265
  *             return False
  *         cdef DOMNode other_dom = <DOMNode>other
  *         return other_dom.node == self.node             # <<<<<<<<<<<<<<
  * 
  *     def __hash__(self):
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_4 = __Pyx_PyBool_FromLong((__pyx_v_other_dom->node == __pyx_v_self->node)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1219, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyBool_FromLong((__pyx_v_other_dom->node == __pyx_v_self->node)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1265, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __pyx_r = __pyx_t_4;
   __pyx_t_4 = 0;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":1215
+  /* "resiliparse/parse/html.pyx":1261
  *         return self.html
  * 
  *     def __eq__(self, other):             # <<<<<<<<<<<<<<
  *         if not check_node(self) or not isinstance(other, DOMNode):
  *             return False
  */
 
@@ -15982,15 +16582,15 @@
   __pyx_L0:;
   __Pyx_XDECREF((PyObject *)__pyx_v_other_dom);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":1221
+/* "resiliparse/parse/html.pyx":1267
  *         return other_dom.node == self.node
  * 
  *     def __hash__(self):             # <<<<<<<<<<<<<<
  *         if not check_node(self):
  *             return 0
  */
 
@@ -16009,54 +16609,54 @@
 
 static Py_hash_t __pyx_pf_11resiliparse_5parse_4html_7DOMNode_51__hash__(struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *__pyx_v_self) {
   Py_hash_t __pyx_r;
   __Pyx_RefNannyDeclarations
   int __pyx_t_1;
   __Pyx_RefNannySetupContext("__hash__", 0);
 
-  /* "resiliparse/parse/html.pyx":1222
+  /* "resiliparse/parse/html.pyx":1268
  * 
  *     def __hash__(self):
  *         if not check_node(self):             # <<<<<<<<<<<<<<
  *             return 0
  *         return <size_t>self.node
  */
   __pyx_t_1 = ((!(__pyx_f_11resiliparse_5parse_4html_check_node(__pyx_v_self) != 0)) != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/parse/html.pyx":1223
+    /* "resiliparse/parse/html.pyx":1269
  *     def __hash__(self):
  *         if not check_node(self):
  *             return 0             # <<<<<<<<<<<<<<
  *         return <size_t>self.node
  * 
  */
     __pyx_r = 0;
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":1222
+    /* "resiliparse/parse/html.pyx":1268
  * 
  *     def __hash__(self):
  *         if not check_node(self):             # <<<<<<<<<<<<<<
  *             return 0
  *         return <size_t>self.node
  */
   }
 
-  /* "resiliparse/parse/html.pyx":1224
+  /* "resiliparse/parse/html.pyx":1270
  *         if not check_node(self):
  *             return 0
  *         return <size_t>self.node             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __pyx_r = ((size_t)__pyx_v_self->node);
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":1221
+  /* "resiliparse/parse/html.pyx":1267
  *         return other_dom.node == self.node
  * 
  *     def __hash__(self):             # <<<<<<<<<<<<<<
  *         if not check_node(self):
  *             return 0
  */
 
@@ -16097,15 +16697,15 @@
 
   /* "(tree fragment)":2
  * def __reduce_cython__(self):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")             # <<<<<<<<<<<<<<
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  */
-  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__23, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 2, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__26, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 2, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_Raise(__pyx_t_1, 0, 0, 0);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __PYX_ERR(1, 2, __pyx_L1_error)
 
   /* "(tree fragment)":1
  * def __reduce_cython__(self):             # <<<<<<<<<<<<<<
@@ -16153,15 +16753,15 @@
   __Pyx_RefNannySetupContext("__setstate_cython__", 0);
 
   /* "(tree fragment)":4
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")             # <<<<<<<<<<<<<<
  */
-  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__24, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 4, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__27, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 4, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_Raise(__pyx_t_1, 0, 0, 0);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __PYX_ERR(1, 4, __pyx_L1_error)
 
   /* "(tree fragment)":3
  * def __reduce_cython__(self):
@@ -16176,15 +16776,15 @@
   __Pyx_AddTraceback("resiliparse.parse.html.DOMNode.__setstate_cython__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":1227
+/* "resiliparse/parse/html.pyx":1273
  * 
  * 
  * cdef inline void _join_collections(lxb_dom_collection_t* target, lxb_dom_collection_t* source):             # <<<<<<<<<<<<<<
  *     """
  *     Append elements from ``source` to ``target``.
  */
 
@@ -16192,58 +16792,58 @@
   size_t __pyx_v_i;
   __Pyx_RefNannyDeclarations
   size_t __pyx_t_1;
   size_t __pyx_t_2;
   size_t __pyx_t_3;
   __Pyx_RefNannySetupContext("_join_collections", 0);
 
-  /* "resiliparse/parse/html.pyx":1235
+  /* "resiliparse/parse/html.pyx":1281
  *     """
  * 
  *     cdef size_t i = 0             # <<<<<<<<<<<<<<
  *     for i in range(lxb_dom_collection_length(source)):
  *         lxb_dom_collection_append(target, lxb_dom_collection_element(source, i))
  */
   __pyx_v_i = 0;
 
-  /* "resiliparse/parse/html.pyx":1236
+  /* "resiliparse/parse/html.pyx":1282
  * 
  *     cdef size_t i = 0
  *     for i in range(lxb_dom_collection_length(source)):             # <<<<<<<<<<<<<<
  *         lxb_dom_collection_append(target, lxb_dom_collection_element(source, i))
  * 
  */
   __pyx_t_1 = lxb_dom_collection_length(__pyx_v_source);
   __pyx_t_2 = __pyx_t_1;
   for (__pyx_t_3 = 0; __pyx_t_3 < __pyx_t_2; __pyx_t_3+=1) {
     __pyx_v_i = __pyx_t_3;
 
-    /* "resiliparse/parse/html.pyx":1237
+    /* "resiliparse/parse/html.pyx":1283
  *     cdef size_t i = 0
  *     for i in range(lxb_dom_collection_length(source)):
  *         lxb_dom_collection_append(target, lxb_dom_collection_element(source, i))             # <<<<<<<<<<<<<<
  * 
  * 
  */
     (void)(lxb_dom_collection_append(__pyx_v_target, lxb_dom_collection_element(__pyx_v_source, __pyx_v_i)));
   }
 
-  /* "resiliparse/parse/html.pyx":1227
+  /* "resiliparse/parse/html.pyx":1273
  * 
  * 
  * cdef inline void _join_collections(lxb_dom_collection_t* target, lxb_dom_collection_t* source):             # <<<<<<<<<<<<<<
  *     """
  *     Append elements from ``source` to ``target``.
  */
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
 }
 
-/* "resiliparse/parse/html.pyx":1251
+/* "resiliparse/parse/html.pyx":1297
  *     """
  * 
  *     def __cinit__(self, HTMLTree tree):             # <<<<<<<<<<<<<<
  *         self.tree = tree
  *         self.coll = NULL
  */
 
@@ -16272,32 +16872,32 @@
       kw_args = PyDict_Size(__pyx_kwds);
       switch (pos_args) {
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_tree)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__cinit__") < 0)) __PYX_ERR(0, 1251, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__cinit__") < 0)) __PYX_ERR(0, 1297, __pyx_L3_error)
       }
     } else if (PyTuple_GET_SIZE(__pyx_args) != 1) {
       goto __pyx_L5_argtuple_error;
     } else {
       values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
     }
     __pyx_v_tree = ((struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *)values[0]);
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("__cinit__", 1, 1, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1251, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("__cinit__", 1, 1, 1, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1297, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("resiliparse.parse.html.DOMCollection.__cinit__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return -1;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_tree), __pyx_ptype_11resiliparse_5parse_4html_HTMLTree, 1, "tree", 0))) __PYX_ERR(0, 1251, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_tree), __pyx_ptype_11resiliparse_5parse_4html_HTMLTree, 1, "tree", 0))) __PYX_ERR(0, 1297, __pyx_L1_error)
   __pyx_r = __pyx_pf_11resiliparse_5parse_4html_13DOMCollection___cinit__(((struct __pyx_obj_11resiliparse_5parse_4html_DOMCollection *)__pyx_v_self), __pyx_v_tree);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = -1;
   __pyx_L0:;
@@ -16306,51 +16906,51 @@
 }
 
 static int __pyx_pf_11resiliparse_5parse_4html_13DOMCollection___cinit__(struct __pyx_obj_11resiliparse_5parse_4html_DOMCollection *__pyx_v_self, struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *__pyx_v_tree) {
   int __pyx_r;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__cinit__", 0);
 
-  /* "resiliparse/parse/html.pyx":1252
+  /* "resiliparse/parse/html.pyx":1298
  * 
  *     def __cinit__(self, HTMLTree tree):
  *         self.tree = tree             # <<<<<<<<<<<<<<
  *         self.coll = NULL
  * 
  */
   __Pyx_INCREF(((PyObject *)__pyx_v_tree));
   __Pyx_GIVEREF(((PyObject *)__pyx_v_tree));
   __Pyx_GOTREF(__pyx_v_self->tree);
   __Pyx_DECREF(((PyObject *)__pyx_v_self->tree));
   __pyx_v_self->tree = __pyx_v_tree;
 
-  /* "resiliparse/parse/html.pyx":1253
+  /* "resiliparse/parse/html.pyx":1299
  *     def __cinit__(self, HTMLTree tree):
  *         self.tree = tree
  *         self.coll = NULL             # <<<<<<<<<<<<<<
  * 
  *     def __dealloc__(self):
  */
   __pyx_v_self->coll = NULL;
 
-  /* "resiliparse/parse/html.pyx":1251
+  /* "resiliparse/parse/html.pyx":1297
  *     """
  * 
  *     def __cinit__(self, HTMLTree tree):             # <<<<<<<<<<<<<<
  *         self.tree = tree
  *         self.coll = NULL
  */
 
   /* function exit code */
   __pyx_r = 0;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":1255
+/* "resiliparse/parse/html.pyx":1301
  *         self.coll = NULL
  * 
  *     def __dealloc__(self):             # <<<<<<<<<<<<<<
  *         if self.coll:
  *             lxb_dom_collection_destroy(self.coll, True)
  */
 
@@ -16366,64 +16966,64 @@
 }
 
 static void __pyx_pf_11resiliparse_5parse_4html_13DOMCollection_2__dealloc__(struct __pyx_obj_11resiliparse_5parse_4html_DOMCollection *__pyx_v_self) {
   __Pyx_RefNannyDeclarations
   int __pyx_t_1;
   __Pyx_RefNannySetupContext("__dealloc__", 0);
 
-  /* "resiliparse/parse/html.pyx":1256
+  /* "resiliparse/parse/html.pyx":1302
  * 
  *     def __dealloc__(self):
  *         if self.coll:             # <<<<<<<<<<<<<<
  *             lxb_dom_collection_destroy(self.coll, True)
  *             self.coll = NULL
  */
   __pyx_t_1 = (__pyx_v_self->coll != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/parse/html.pyx":1257
+    /* "resiliparse/parse/html.pyx":1303
  *     def __dealloc__(self):
  *         if self.coll:
  *             lxb_dom_collection_destroy(self.coll, True)             # <<<<<<<<<<<<<<
  *             self.coll = NULL
  * 
  */
     (void)(lxb_dom_collection_destroy(__pyx_v_self->coll, 1));
 
-    /* "resiliparse/parse/html.pyx":1258
+    /* "resiliparse/parse/html.pyx":1304
  *         if self.coll:
  *             lxb_dom_collection_destroy(self.coll, True)
  *             self.coll = NULL             # <<<<<<<<<<<<<<
  * 
  *     @cython.cdivision(False)
  */
     __pyx_v_self->coll = NULL;
 
-    /* "resiliparse/parse/html.pyx":1256
+    /* "resiliparse/parse/html.pyx":1302
  * 
  *     def __dealloc__(self):
  *         if self.coll:             # <<<<<<<<<<<<<<
  *             lxb_dom_collection_destroy(self.coll, True)
  *             self.coll = NULL
  */
   }
 
-  /* "resiliparse/parse/html.pyx":1255
+  /* "resiliparse/parse/html.pyx":1301
  *         self.coll = NULL
  * 
  *     def __dealloc__(self):             # <<<<<<<<<<<<<<
  *         if self.coll:
  *             lxb_dom_collection_destroy(self.coll, True)
  */
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
 }
 
-/* "resiliparse/parse/html.pyx":1261
+/* "resiliparse/parse/html.pyx":1307
  * 
  *     @cython.cdivision(False)
  *     cdef inline size_t _wrap_idx(self, ssize_t idx):             # <<<<<<<<<<<<<<
  *         if idx >= 0:
  *             return idx
  */
 
@@ -16433,59 +17033,59 @@
   int __pyx_t_1;
   Py_ssize_t __pyx_t_2;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_wrap_idx", 0);
 
-  /* "resiliparse/parse/html.pyx":1262
+  /* "resiliparse/parse/html.pyx":1308
  *     @cython.cdivision(False)
  *     cdef inline size_t _wrap_idx(self, ssize_t idx):
  *         if idx >= 0:             # <<<<<<<<<<<<<<
  *             return idx
  *         return idx % <ssize_t>lxb_dom_collection_length(self.coll)
  */
   __pyx_t_1 = ((__pyx_v_idx >= 0) != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/parse/html.pyx":1263
+    /* "resiliparse/parse/html.pyx":1309
  *     cdef inline size_t _wrap_idx(self, ssize_t idx):
  *         if idx >= 0:
  *             return idx             # <<<<<<<<<<<<<<
  *         return idx % <ssize_t>lxb_dom_collection_length(self.coll)
  * 
  */
     __pyx_r = __pyx_v_idx;
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":1262
+    /* "resiliparse/parse/html.pyx":1308
  *     @cython.cdivision(False)
  *     cdef inline size_t _wrap_idx(self, ssize_t idx):
  *         if idx >= 0:             # <<<<<<<<<<<<<<
  *             return idx
  *         return idx % <ssize_t>lxb_dom_collection_length(self.coll)
  */
   }
 
-  /* "resiliparse/parse/html.pyx":1264
+  /* "resiliparse/parse/html.pyx":1310
  *         if idx >= 0:
  *             return idx
  *         return idx % <ssize_t>lxb_dom_collection_length(self.coll)             # <<<<<<<<<<<<<<
  * 
  *     cdef DOMCollection _forward_collection_match(self, bytes func, attrs):
  */
   __pyx_t_2 = ((Py_ssize_t)lxb_dom_collection_length(__pyx_v_self->coll));
   if (unlikely(__pyx_t_2 == 0)) {
     PyErr_SetString(PyExc_ZeroDivisionError, "integer division or modulo by zero");
-    __PYX_ERR(0, 1264, __pyx_L1_error)
+    __PYX_ERR(0, 1310, __pyx_L1_error)
   }
   __pyx_r = __Pyx_mod_Py_ssize_t(__pyx_v_idx, __pyx_t_2);
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":1261
+  /* "resiliparse/parse/html.pyx":1307
  * 
  *     @cython.cdivision(False)
  *     cdef inline size_t _wrap_idx(self, ssize_t idx):             # <<<<<<<<<<<<<<
  *         if idx >= 0:
  *             return idx
  */
 
@@ -16494,15 +17094,15 @@
   __Pyx_WriteUnraisable("resiliparse.parse.html.DOMCollection._wrap_idx", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":1266
+/* "resiliparse/parse/html.pyx":1312
  *         return idx % <ssize_t>lxb_dom_collection_length(self.coll)
  * 
  *     cdef DOMCollection _forward_collection_match(self, bytes func, attrs):             # <<<<<<<<<<<<<<
  *         """
  *         Forward DOM multi-element match operations to all items in the collection and aggregate the results.
  */
 
@@ -16527,15 +17127,15 @@
   struct __pyx_opt_args_11resiliparse_5parse_4html_get_elements_by_attr_impl __pyx_t_12;
   struct __pyx_opt_args_11resiliparse_5parse_4html_get_elements_by_class_name_impl __pyx_t_13;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("_forward_collection_match", 0);
 
-  /* "resiliparse/parse/html.pyx":1274
+  /* "resiliparse/parse/html.pyx":1320
  *         :return: aggregated collection or single element
  *         """
  *         if self.tree is None or not self.coll:             # <<<<<<<<<<<<<<
  *             raise RuntimeError('Trying to select items from uninitialized collection')
  * 
  */
   __pyx_t_2 = (((PyObject *)__pyx_v_self->tree) == Py_None);
@@ -16546,341 +17146,342 @@
     goto __pyx_L4_bool_binop_done;
   }
   __pyx_t_3 = ((!(__pyx_v_self->coll != 0)) != 0);
   __pyx_t_1 = __pyx_t_3;
   __pyx_L4_bool_binop_done:;
   if (unlikely(__pyx_t_1)) {
 
-    /* "resiliparse/parse/html.pyx":1275
+    /* "resiliparse/parse/html.pyx":1321
  *         """
  *         if self.tree is None or not self.coll:
  *             raise RuntimeError('Trying to select items from uninitialized collection')             # <<<<<<<<<<<<<<
  * 
  *         if not lxb_dom_collection_length(self.coll):
  */
-    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_builtin_RuntimeError, __pyx_tuple__25, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1275, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_builtin_RuntimeError, __pyx_tuple__28, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1321, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_Raise(__pyx_t_4, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __PYX_ERR(0, 1275, __pyx_L1_error)
+    __PYX_ERR(0, 1321, __pyx_L1_error)
 
-    /* "resiliparse/parse/html.pyx":1274
+    /* "resiliparse/parse/html.pyx":1320
  *         :return: aggregated collection or single element
  *         """
  *         if self.tree is None or not self.coll:             # <<<<<<<<<<<<<<
  *             raise RuntimeError('Trying to select items from uninitialized collection')
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":1277
+  /* "resiliparse/parse/html.pyx":1323
  *             raise RuntimeError('Trying to select items from uninitialized collection')
  * 
  *         if not lxb_dom_collection_length(self.coll):             # <<<<<<<<<<<<<<
  *             return self
  * 
  */
   __pyx_t_1 = ((!(lxb_dom_collection_length(__pyx_v_self->coll) != 0)) != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/parse/html.pyx":1278
+    /* "resiliparse/parse/html.pyx":1324
  * 
  *         if not lxb_dom_collection_length(self.coll):
  *             return self             # <<<<<<<<<<<<<<
  * 
  *         cdef lxb_dom_collection_t* joined_coll = lxb_dom_collection_make(self.coll.document,
  */
     __Pyx_XDECREF(((PyObject *)__pyx_r));
     __Pyx_INCREF(((PyObject *)__pyx_v_self));
     __pyx_r = __pyx_v_self;
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":1277
+    /* "resiliparse/parse/html.pyx":1323
  *             raise RuntimeError('Trying to select items from uninitialized collection')
  * 
  *         if not lxb_dom_collection_length(self.coll):             # <<<<<<<<<<<<<<
  *             return self
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":1280
+  /* "resiliparse/parse/html.pyx":1326
  *             return self
  * 
  *         cdef lxb_dom_collection_t* joined_coll = lxb_dom_collection_make(self.coll.document,             # <<<<<<<<<<<<<<
  *                                                                          lxb_dom_collection_length(self.coll) * 2)
  * 
  */
   __pyx_v_joined_coll = lxb_dom_collection_make(__pyx_v_self->coll->document, (lxb_dom_collection_length(__pyx_v_self->coll) * 2));
 
-  /* "resiliparse/parse/html.pyx":1283
+  /* "resiliparse/parse/html.pyx":1329
  *                                                                          lxb_dom_collection_length(self.coll) * 2)
  * 
  *         cdef lxb_dom_node_t* node = NULL             # <<<<<<<<<<<<<<
  *         cdef lxb_dom_collection_t* matches = NULL
  *         cdef size_t i = 0
  */
   __pyx_v_node = NULL;
 
-  /* "resiliparse/parse/html.pyx":1284
+  /* "resiliparse/parse/html.pyx":1330
  * 
  *         cdef lxb_dom_node_t* node = NULL
  *         cdef lxb_dom_collection_t* matches = NULL             # <<<<<<<<<<<<<<
  *         cdef size_t i = 0
  *         for i in range(lxb_dom_collection_length(self.coll)):
  */
   __pyx_v_matches = NULL;
 
-  /* "resiliparse/parse/html.pyx":1285
+  /* "resiliparse/parse/html.pyx":1331
  *         cdef lxb_dom_node_t* node = NULL
  *         cdef lxb_dom_collection_t* matches = NULL
  *         cdef size_t i = 0             # <<<<<<<<<<<<<<
  *         for i in range(lxb_dom_collection_length(self.coll)):
  *             node = lxb_dom_collection_node(self.coll, i)
  */
   __pyx_v_i = 0;
 
-  /* "resiliparse/parse/html.pyx":1286
+  /* "resiliparse/parse/html.pyx":1332
  *         cdef lxb_dom_collection_t* matches = NULL
  *         cdef size_t i = 0
  *         for i in range(lxb_dom_collection_length(self.coll)):             # <<<<<<<<<<<<<<
  *             node = lxb_dom_collection_node(self.coll, i)
  *             if func == b'by_attr':
  */
   __pyx_t_5 = lxb_dom_collection_length(__pyx_v_self->coll);
   __pyx_t_6 = __pyx_t_5;
   for (__pyx_t_7 = 0; __pyx_t_7 < __pyx_t_6; __pyx_t_7+=1) {
     __pyx_v_i = __pyx_t_7;
 
-    /* "resiliparse/parse/html.pyx":1287
+    /* "resiliparse/parse/html.pyx":1333
  *         cdef size_t i = 0
  *         for i in range(lxb_dom_collection_length(self.coll)):
  *             node = lxb_dom_collection_node(self.coll, i)             # <<<<<<<<<<<<<<
  *             if func == b'by_attr':
  *                 matches = get_elements_by_attr_impl(node, attrs[0], attrs[1], attrs[2], attrs[3])
  */
     __pyx_v_node = lxb_dom_collection_node(__pyx_v_self->coll, __pyx_v_i);
 
-    /* "resiliparse/parse/html.pyx":1288
+    /* "resiliparse/parse/html.pyx":1334
  *         for i in range(lxb_dom_collection_length(self.coll)):
  *             node = lxb_dom_collection_node(self.coll, i)
  *             if func == b'by_attr':             # <<<<<<<<<<<<<<
  *                 matches = get_elements_by_attr_impl(node, attrs[0], attrs[1], attrs[2], attrs[3])
  *             if func == b'by_class':
  */
-    __pyx_t_1 = (__Pyx_PyBytes_Equals(__pyx_v_func, __pyx_n_b_by_attr, Py_EQ)); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 1288, __pyx_L1_error)
+    __pyx_t_1 = (__Pyx_PyBytes_Equals(__pyx_v_func, __pyx_n_b_by_attr, Py_EQ)); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 1334, __pyx_L1_error)
     __pyx_t_3 = (__pyx_t_1 != 0);
     if (__pyx_t_3) {
 
-      /* "resiliparse/parse/html.pyx":1289
+      /* "resiliparse/parse/html.pyx":1335
  *             node = lxb_dom_collection_node(self.coll, i)
  *             if func == b'by_attr':
  *                 matches = get_elements_by_attr_impl(node, attrs[0], attrs[1], attrs[2], attrs[3])             # <<<<<<<<<<<<<<
  *             if func == b'by_class':
  *                 matches = get_elements_by_class_name_impl(node, attrs[0], attrs[1])
  */
-      __pyx_t_4 = __Pyx_GetItemInt(__pyx_v_attrs, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1289, __pyx_L1_error)
+      __pyx_t_4 = __Pyx_GetItemInt(__pyx_v_attrs, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1335, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
-      if (!(likely(PyBytes_CheckExact(__pyx_t_4))||((__pyx_t_4) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_4)->tp_name), 0))) __PYX_ERR(0, 1289, __pyx_L1_error)
-      __pyx_t_8 = __Pyx_GetItemInt(__pyx_v_attrs, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1289, __pyx_L1_error)
+      if (!(likely(PyBytes_CheckExact(__pyx_t_4))||((__pyx_t_4) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_4)->tp_name), 0))) __PYX_ERR(0, 1335, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_GetItemInt(__pyx_v_attrs, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1335, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      if (!(likely(PyBytes_CheckExact(__pyx_t_8))||((__pyx_t_8) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_8)->tp_name), 0))) __PYX_ERR(0, 1289, __pyx_L1_error)
-      __pyx_t_9 = __Pyx_GetItemInt(__pyx_v_attrs, 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1289, __pyx_L1_error)
+      if (!(likely(PyBytes_CheckExact(__pyx_t_8))||((__pyx_t_8) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_8)->tp_name), 0))) __PYX_ERR(0, 1335, __pyx_L1_error)
+      __pyx_t_9 = __Pyx_GetItemInt(__pyx_v_attrs, 2, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1335, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_9);
-      __pyx_t_10 = __Pyx_PyInt_As_size_t(__pyx_t_9); if (unlikely((__pyx_t_10 == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 1289, __pyx_L1_error)
+      __pyx_t_10 = __Pyx_PyInt_As_size_t(__pyx_t_9); if (unlikely((__pyx_t_10 == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 1335, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
-      __pyx_t_9 = __Pyx_GetItemInt(__pyx_v_attrs, 3, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1289, __pyx_L1_error)
+      __pyx_t_9 = __Pyx_GetItemInt(__pyx_v_attrs, 3, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 1335, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_9);
-      __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_9); if (unlikely((__pyx_t_3 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 1289, __pyx_L1_error)
+      __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_9); if (unlikely((__pyx_t_3 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 1335, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_9); __pyx_t_9 = 0;
       __pyx_t_12.__pyx_n = 2;
       __pyx_t_12.init_size = __pyx_t_10;
       __pyx_t_12.case_insensitive = __pyx_t_3;
       __pyx_t_11 = __pyx_f_11resiliparse_5parse_4html_get_elements_by_attr_impl(__pyx_v_node, ((PyObject*)__pyx_t_4), ((PyObject*)__pyx_t_8), &__pyx_t_12); 
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
       __pyx_v_matches = __pyx_t_11;
 
-      /* "resiliparse/parse/html.pyx":1288
+      /* "resiliparse/parse/html.pyx":1334
  *         for i in range(lxb_dom_collection_length(self.coll)):
  *             node = lxb_dom_collection_node(self.coll, i)
  *             if func == b'by_attr':             # <<<<<<<<<<<<<<
  *                 matches = get_elements_by_attr_impl(node, attrs[0], attrs[1], attrs[2], attrs[3])
  *             if func == b'by_class':
  */
     }
 
-    /* "resiliparse/parse/html.pyx":1290
+    /* "resiliparse/parse/html.pyx":1336
  *             if func == b'by_attr':
  *                 matches = get_elements_by_attr_impl(node, attrs[0], attrs[1], attrs[2], attrs[3])
  *             if func == b'by_class':             # <<<<<<<<<<<<<<
  *                 matches = get_elements_by_class_name_impl(node, attrs[0], attrs[1])
  *             elif func == b'by_tag':
  */
-    __pyx_t_3 = (__Pyx_PyBytes_Equals(__pyx_v_func, __pyx_n_b_by_class, Py_EQ)); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 1290, __pyx_L1_error)
+    __pyx_t_3 = (__Pyx_PyBytes_Equals(__pyx_v_func, __pyx_n_b_by_class, Py_EQ)); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 1336, __pyx_L1_error)
     __pyx_t_1 = (__pyx_t_3 != 0);
     if (__pyx_t_1) {
 
-      /* "resiliparse/parse/html.pyx":1291
+      /* "resiliparse/parse/html.pyx":1337
  *                 matches = get_elements_by_attr_impl(node, attrs[0], attrs[1], attrs[2], attrs[3])
  *             if func == b'by_class':
  *                 matches = get_elements_by_class_name_impl(node, attrs[0], attrs[1])             # <<<<<<<<<<<<<<
  *             elif func == b'by_tag':
  *                 matches = get_elements_by_tag_name_impl(node, attrs[0])
  */
-      __pyx_t_8 = __Pyx_GetItemInt(__pyx_v_attrs, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1291, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_GetItemInt(__pyx_v_attrs, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1337, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      if (!(likely(PyBytes_CheckExact(__pyx_t_8))||((__pyx_t_8) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_8)->tp_name), 0))) __PYX_ERR(0, 1291, __pyx_L1_error)
-      __pyx_t_4 = __Pyx_GetItemInt(__pyx_v_attrs, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1291, __pyx_L1_error)
+      if (!(likely(PyBytes_CheckExact(__pyx_t_8))||((__pyx_t_8) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_8)->tp_name), 0))) __PYX_ERR(0, 1337, __pyx_L1_error)
+      __pyx_t_4 = __Pyx_GetItemInt(__pyx_v_attrs, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1337, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
-      __pyx_t_10 = __Pyx_PyInt_As_size_t(__pyx_t_4); if (unlikely((__pyx_t_10 == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 1291, __pyx_L1_error)
+      __pyx_t_10 = __Pyx_PyInt_As_size_t(__pyx_t_4); if (unlikely((__pyx_t_10 == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 1337, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
       __pyx_t_13.__pyx_n = 1;
       __pyx_t_13.init_size = __pyx_t_10;
       __pyx_t_11 = __pyx_f_11resiliparse_5parse_4html_get_elements_by_class_name_impl(__pyx_v_node, ((PyObject*)__pyx_t_8), &__pyx_t_13); 
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
       __pyx_v_matches = __pyx_t_11;
 
-      /* "resiliparse/parse/html.pyx":1290
+      /* "resiliparse/parse/html.pyx":1336
  *             if func == b'by_attr':
  *                 matches = get_elements_by_attr_impl(node, attrs[0], attrs[1], attrs[2], attrs[3])
  *             if func == b'by_class':             # <<<<<<<<<<<<<<
  *                 matches = get_elements_by_class_name_impl(node, attrs[0], attrs[1])
  *             elif func == b'by_tag':
  */
       goto __pyx_L10;
     }
 
-    /* "resiliparse/parse/html.pyx":1292
+    /* "resiliparse/parse/html.pyx":1338
  *             if func == b'by_class':
  *                 matches = get_elements_by_class_name_impl(node, attrs[0], attrs[1])
  *             elif func == b'by_tag':             # <<<<<<<<<<<<<<
  *                 matches = get_elements_by_tag_name_impl(node, attrs[0])
  *             elif func == b'selector_all':
  */
-    __pyx_t_1 = (__Pyx_PyBytes_Equals(__pyx_v_func, __pyx_n_b_by_tag, Py_EQ)); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 1292, __pyx_L1_error)
+    __pyx_t_1 = (__Pyx_PyBytes_Equals(__pyx_v_func, __pyx_n_b_by_tag, Py_EQ)); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 1338, __pyx_L1_error)
     __pyx_t_3 = (__pyx_t_1 != 0);
     if (__pyx_t_3) {
 
-      /* "resiliparse/parse/html.pyx":1293
+      /* "resiliparse/parse/html.pyx":1339
  *                 matches = get_elements_by_class_name_impl(node, attrs[0], attrs[1])
  *             elif func == b'by_tag':
  *                 matches = get_elements_by_tag_name_impl(node, attrs[0])             # <<<<<<<<<<<<<<
  *             elif func == b'selector_all':
  *                 matches = query_selector_all_impl(node, self.tree, attrs[0])
  */
-      __pyx_t_8 = __Pyx_GetItemInt(__pyx_v_attrs, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1293, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_GetItemInt(__pyx_v_attrs, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1339, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      if (!(likely(PyBytes_CheckExact(__pyx_t_8))||((__pyx_t_8) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_8)->tp_name), 0))) __PYX_ERR(0, 1293, __pyx_L1_error)
+      if (!(likely(PyBytes_CheckExact(__pyx_t_8))||((__pyx_t_8) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_8)->tp_name), 0))) __PYX_ERR(0, 1339, __pyx_L1_error)
       __pyx_v_matches = __pyx_f_11resiliparse_5parse_4html_get_elements_by_tag_name_impl(__pyx_v_node, ((PyObject*)__pyx_t_8));
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
 
-      /* "resiliparse/parse/html.pyx":1292
+      /* "resiliparse/parse/html.pyx":1338
  *             if func == b'by_class':
  *                 matches = get_elements_by_class_name_impl(node, attrs[0], attrs[1])
  *             elif func == b'by_tag':             # <<<<<<<<<<<<<<
  *                 matches = get_elements_by_tag_name_impl(node, attrs[0])
  *             elif func == b'selector_all':
  */
       goto __pyx_L10;
     }
 
-    /* "resiliparse/parse/html.pyx":1294
+    /* "resiliparse/parse/html.pyx":1340
  *             elif func == b'by_tag':
  *                 matches = get_elements_by_tag_name_impl(node, attrs[0])
  *             elif func == b'selector_all':             # <<<<<<<<<<<<<<
  *                 matches = query_selector_all_impl(node, self.tree, attrs[0])
  * 
  */
-    __pyx_t_3 = (__Pyx_PyBytes_Equals(__pyx_v_func, __pyx_n_b_selector_all, Py_EQ)); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 1294, __pyx_L1_error)
+    __pyx_t_3 = (__Pyx_PyBytes_Equals(__pyx_v_func, __pyx_n_b_selector_all, Py_EQ)); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 1340, __pyx_L1_error)
     __pyx_t_1 = (__pyx_t_3 != 0);
     if (__pyx_t_1) {
 
-      /* "resiliparse/parse/html.pyx":1295
+      /* "resiliparse/parse/html.pyx":1341
  *                 matches = get_elements_by_tag_name_impl(node, attrs[0])
  *             elif func == b'selector_all':
  *                 matches = query_selector_all_impl(node, self.tree, attrs[0])             # <<<<<<<<<<<<<<
  * 
  *             if matches:
  */
       __pyx_t_8 = ((PyObject *)__pyx_v_self->tree);
       __Pyx_INCREF(__pyx_t_8);
-      __pyx_t_4 = __Pyx_GetItemInt(__pyx_v_attrs, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1295, __pyx_L1_error)
+      __pyx_t_4 = __Pyx_GetItemInt(__pyx_v_attrs, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1341, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
-      if (!(likely(PyBytes_CheckExact(__pyx_t_4))||((__pyx_t_4) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_4)->tp_name), 0))) __PYX_ERR(0, 1295, __pyx_L1_error)
-      __pyx_v_matches = __pyx_f_11resiliparse_5parse_4html_query_selector_all_impl(__pyx_v_node, ((struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *)__pyx_t_8), ((PyObject*)__pyx_t_4), NULL);
+      if (!(likely(PyBytes_CheckExact(__pyx_t_4))||((__pyx_t_4) == Py_None)||(PyErr_Format(PyExc_TypeError, "Expected %.16s, got %.200s", "bytes", Py_TYPE(__pyx_t_4)->tp_name), 0))) __PYX_ERR(0, 1341, __pyx_L1_error)
+      __pyx_t_11 = __pyx_f_11resiliparse_5parse_4html_query_selector_all_impl(__pyx_v_node, ((struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *)__pyx_t_8), ((PyObject*)__pyx_t_4), NULL); if (unlikely(__pyx_t_11 == ((lxb_dom_collection_t *)((lxb_dom_collection_t *)-1L)))) __PYX_ERR(0, 1341, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
+      __pyx_v_matches = __pyx_t_11;
 
-      /* "resiliparse/parse/html.pyx":1294
+      /* "resiliparse/parse/html.pyx":1340
  *             elif func == b'by_tag':
  *                 matches = get_elements_by_tag_name_impl(node, attrs[0])
  *             elif func == b'selector_all':             # <<<<<<<<<<<<<<
  *                 matches = query_selector_all_impl(node, self.tree, attrs[0])
  * 
  */
     }
     __pyx_L10:;
 
-    /* "resiliparse/parse/html.pyx":1297
+    /* "resiliparse/parse/html.pyx":1343
  *                 matches = query_selector_all_impl(node, self.tree, attrs[0])
  * 
  *             if matches:             # <<<<<<<<<<<<<<
  *                 _join_collections(joined_coll, matches)
  *                 lxb_dom_collection_destroy(matches, True)
  */
     __pyx_t_1 = (__pyx_v_matches != 0);
     if (__pyx_t_1) {
 
-      /* "resiliparse/parse/html.pyx":1298
+      /* "resiliparse/parse/html.pyx":1344
  * 
  *             if matches:
  *                 _join_collections(joined_coll, matches)             # <<<<<<<<<<<<<<
  *                 lxb_dom_collection_destroy(matches, True)
  * 
  */
       __pyx_f_11resiliparse_5parse_4html__join_collections(__pyx_v_joined_coll, __pyx_v_matches);
 
-      /* "resiliparse/parse/html.pyx":1299
+      /* "resiliparse/parse/html.pyx":1345
  *             if matches:
  *                 _join_collections(joined_coll, matches)
  *                 lxb_dom_collection_destroy(matches, True)             # <<<<<<<<<<<<<<
  * 
  *         return _create_dom_collection(self.tree, joined_coll)
  */
       (void)(lxb_dom_collection_destroy(__pyx_v_matches, 1));
 
-      /* "resiliparse/parse/html.pyx":1297
+      /* "resiliparse/parse/html.pyx":1343
  *                 matches = query_selector_all_impl(node, self.tree, attrs[0])
  * 
  *             if matches:             # <<<<<<<<<<<<<<
  *                 _join_collections(joined_coll, matches)
  *                 lxb_dom_collection_destroy(matches, True)
  */
     }
   }
 
-  /* "resiliparse/parse/html.pyx":1301
+  /* "resiliparse/parse/html.pyx":1347
  *                 lxb_dom_collection_destroy(matches, True)
  * 
  *         return _create_dom_collection(self.tree, joined_coll)             # <<<<<<<<<<<<<<
  * 
  *     cpdef DOMNode get_element_by_id(self, str element_id, bint case_insensitive=False):
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
   __pyx_t_4 = ((PyObject *)__pyx_v_self->tree);
   __Pyx_INCREF(__pyx_t_4);
-  __pyx_t_8 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html__create_dom_collection(((struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *)__pyx_t_4), __pyx_v_joined_coll)); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1301, __pyx_L1_error)
+  __pyx_t_8 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html__create_dom_collection(((struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *)__pyx_t_4), __pyx_v_joined_coll)); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1347, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_8);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_r = ((struct __pyx_obj_11resiliparse_5parse_4html_DOMCollection *)__pyx_t_8);
   __pyx_t_8 = 0;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":1266
+  /* "resiliparse/parse/html.pyx":1312
  *         return idx % <ssize_t>lxb_dom_collection_length(self.coll)
  * 
  *     cdef DOMCollection _forward_collection_match(self, bytes func, attrs):             # <<<<<<<<<<<<<<
  *         """
  *         Forward DOM multi-element match operations to all items in the collection and aggregate the results.
  */
 
@@ -16893,15 +17494,15 @@
   __pyx_r = 0;
   __pyx_L0:;
   __Pyx_XGIVEREF((PyObject *)__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":1303
+/* "resiliparse/parse/html.pyx":1349
  *         return _create_dom_collection(self.tree, joined_coll)
  * 
  *     cpdef DOMNode get_element_by_id(self, str element_id, bint case_insensitive=False):             # <<<<<<<<<<<<<<
  *         """
  *         get_element_by_id(self, element_id, case_insensitive=False)
  */
 
@@ -16942,19 +17543,19 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_get_element_by_id); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1303, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_get_element_by_id); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1349, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_11resiliparse_5parse_4html_13DOMCollection_5get_element_by_id)) {
         __Pyx_XDECREF(((PyObject *)__pyx_r));
-        __pyx_t_3 = __Pyx_PyBool_FromLong(__pyx_v_case_insensitive); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1303, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyBool_FromLong(__pyx_v_case_insensitive); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1349, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_4 = __pyx_t_1; __pyx_t_5 = NULL;
         __pyx_t_6 = 0;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
           __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
           if (likely(__pyx_t_5)) {
@@ -16964,47 +17565,47 @@
             __Pyx_DECREF_SET(__pyx_t_4, function);
             __pyx_t_6 = 1;
           }
         }
         #if CYTHON_FAST_PYCALL
         if (PyFunction_Check(__pyx_t_4)) {
           PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_v_element_id, __pyx_t_3};
-          __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1303, __pyx_L1_error)
+          __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1349, __pyx_L1_error)
           __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
           __Pyx_GOTREF(__pyx_t_2);
           __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         } else
         #endif
         #if CYTHON_FAST_PYCCALL
         if (__Pyx_PyFastCFunction_Check(__pyx_t_4)) {
           PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_v_element_id, __pyx_t_3};
-          __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1303, __pyx_L1_error)
+          __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1349, __pyx_L1_error)
           __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
           __Pyx_GOTREF(__pyx_t_2);
           __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         } else
         #endif
         {
-          __pyx_t_7 = PyTuple_New(2+__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1303, __pyx_L1_error)
+          __pyx_t_7 = PyTuple_New(2+__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1349, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_7);
           if (__pyx_t_5) {
             __Pyx_GIVEREF(__pyx_t_5); PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_5); __pyx_t_5 = NULL;
           }
           __Pyx_INCREF(__pyx_v_element_id);
           __Pyx_GIVEREF(__pyx_v_element_id);
           PyTuple_SET_ITEM(__pyx_t_7, 0+__pyx_t_6, __pyx_v_element_id);
           __Pyx_GIVEREF(__pyx_t_3);
           PyTuple_SET_ITEM(__pyx_t_7, 1+__pyx_t_6, __pyx_t_3);
           __pyx_t_3 = 0;
-          __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_7, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1303, __pyx_L1_error)
+          __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_7, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1349, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_2);
           __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
         }
         __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_11resiliparse_5parse_4html_DOMNode))))) __PYX_ERR(0, 1303, __pyx_L1_error)
+        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_11resiliparse_5parse_4html_DOMNode))))) __PYX_ERR(0, 1349, __pyx_L1_error)
         __pyx_r = ((struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *)__pyx_t_2);
         __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -17015,15 +17616,15 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "resiliparse/parse/html.pyx":1317
+  /* "resiliparse/parse/html.pyx":1363
  *         :rtype: DOMNode or None
  *         """
  *         if self.tree is None or not self.coll:             # <<<<<<<<<<<<<<
  *             raise RuntimeError('Trying to select items from uninitialized collection')
  * 
  */
   __pyx_t_9 = (((PyObject *)__pyx_v_self->tree) == Py_None);
@@ -17034,134 +17635,134 @@
     goto __pyx_L4_bool_binop_done;
   }
   __pyx_t_10 = ((!(__pyx_v_self->coll != 0)) != 0);
   __pyx_t_8 = __pyx_t_10;
   __pyx_L4_bool_binop_done:;
   if (unlikely(__pyx_t_8)) {
 
-    /* "resiliparse/parse/html.pyx":1318
+    /* "resiliparse/parse/html.pyx":1364
  *         """
  *         if self.tree is None or not self.coll:
  *             raise RuntimeError('Trying to select items from uninitialized collection')             # <<<<<<<<<<<<<<
  * 
  *         cdef lxb_dom_node_t* node
  */
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_RuntimeError, __pyx_tuple__25, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1318, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_RuntimeError, __pyx_tuple__28, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1364, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 1318, __pyx_L1_error)
+    __PYX_ERR(0, 1364, __pyx_L1_error)
 
-    /* "resiliparse/parse/html.pyx":1317
+    /* "resiliparse/parse/html.pyx":1363
  *         :rtype: DOMNode or None
  *         """
  *         if self.tree is None or not self.coll:             # <<<<<<<<<<<<<<
  *             raise RuntimeError('Trying to select items from uninitialized collection')
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":1321
+  /* "resiliparse/parse/html.pyx":1367
  * 
  *         cdef lxb_dom_node_t* node
  *         cdef size_t i = 0             # <<<<<<<<<<<<<<
  *         cdef bytes id_bytes = element_id.encode()
  *         for i in range(lxb_dom_collection_length(self.coll)):
  */
   __pyx_v_i = 0;
 
-  /* "resiliparse/parse/html.pyx":1322
+  /* "resiliparse/parse/html.pyx":1368
  *         cdef lxb_dom_node_t* node
  *         cdef size_t i = 0
  *         cdef bytes id_bytes = element_id.encode()             # <<<<<<<<<<<<<<
  *         for i in range(lxb_dom_collection_length(self.coll)):
  *             node = get_element_by_id_impl(lxb_dom_collection_node(self.coll, i), id_bytes, case_insensitive)
  */
   if (unlikely(__pyx_v_element_id == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "encode");
-    __PYX_ERR(0, 1322, __pyx_L1_error)
+    __PYX_ERR(0, 1368, __pyx_L1_error)
   }
-  __pyx_t_1 = PyUnicode_AsEncodedString(__pyx_v_element_id, NULL, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1322, __pyx_L1_error)
+  __pyx_t_1 = PyUnicode_AsEncodedString(__pyx_v_element_id, NULL, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1368, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_id_bytes = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "resiliparse/parse/html.pyx":1323
+  /* "resiliparse/parse/html.pyx":1369
  *         cdef size_t i = 0
  *         cdef bytes id_bytes = element_id.encode()
  *         for i in range(lxb_dom_collection_length(self.coll)):             # <<<<<<<<<<<<<<
  *             node = get_element_by_id_impl(lxb_dom_collection_node(self.coll, i), id_bytes, case_insensitive)
  *             if node:
  */
   __pyx_t_11 = lxb_dom_collection_length(__pyx_v_self->coll);
   __pyx_t_12 = __pyx_t_11;
   for (__pyx_t_13 = 0; __pyx_t_13 < __pyx_t_12; __pyx_t_13+=1) {
     __pyx_v_i = __pyx_t_13;
 
-    /* "resiliparse/parse/html.pyx":1324
+    /* "resiliparse/parse/html.pyx":1370
  *         cdef bytes id_bytes = element_id.encode()
  *         for i in range(lxb_dom_collection_length(self.coll)):
  *             node = get_element_by_id_impl(lxb_dom_collection_node(self.coll, i), id_bytes, case_insensitive)             # <<<<<<<<<<<<<<
  *             if node:
  *                 return _create_dom_node(self.tree, node)
  */
     __pyx_t_15.__pyx_n = 1;
     __pyx_t_15.case_insensitive = __pyx_v_case_insensitive;
     __pyx_t_14 = __pyx_f_11resiliparse_5parse_4html_get_element_by_id_impl(lxb_dom_collection_node(__pyx_v_self->coll, __pyx_v_i), __pyx_v_id_bytes, &__pyx_t_15); 
     __pyx_v_node = __pyx_t_14;
 
-    /* "resiliparse/parse/html.pyx":1325
+    /* "resiliparse/parse/html.pyx":1371
  *         for i in range(lxb_dom_collection_length(self.coll)):
  *             node = get_element_by_id_impl(lxb_dom_collection_node(self.coll, i), id_bytes, case_insensitive)
  *             if node:             # <<<<<<<<<<<<<<
  *                 return _create_dom_node(self.tree, node)
  * 
  */
     __pyx_t_8 = (__pyx_v_node != 0);
     if (__pyx_t_8) {
 
-      /* "resiliparse/parse/html.pyx":1326
+      /* "resiliparse/parse/html.pyx":1372
  *             node = get_element_by_id_impl(lxb_dom_collection_node(self.coll, i), id_bytes, case_insensitive)
  *             if node:
  *                 return _create_dom_node(self.tree, node)             # <<<<<<<<<<<<<<
  * 
  *         return None
  */
       __Pyx_XDECREF(((PyObject *)__pyx_r));
       __pyx_t_1 = ((PyObject *)__pyx_v_self->tree);
       __Pyx_INCREF(__pyx_t_1);
-      __pyx_t_2 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html__create_dom_node(((struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *)__pyx_t_1), __pyx_v_node)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1326, __pyx_L1_error)
+      __pyx_t_2 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html__create_dom_node(((struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *)__pyx_t_1), __pyx_v_node)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1372, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       __pyx_r = ((struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *)__pyx_t_2);
       __pyx_t_2 = 0;
       goto __pyx_L0;
 
-      /* "resiliparse/parse/html.pyx":1325
+      /* "resiliparse/parse/html.pyx":1371
  *         for i in range(lxb_dom_collection_length(self.coll)):
  *             node = get_element_by_id_impl(lxb_dom_collection_node(self.coll, i), id_bytes, case_insensitive)
  *             if node:             # <<<<<<<<<<<<<<
  *                 return _create_dom_node(self.tree, node)
  * 
  */
     }
   }
 
-  /* "resiliparse/parse/html.pyx":1328
+  /* "resiliparse/parse/html.pyx":1374
  *                 return _create_dom_node(self.tree, node)
  * 
  *         return None             # <<<<<<<<<<<<<<
  * 
  *     cpdef DOMCollection get_elements_by_attr(self, str attr_name, str attr_value, bint case_insensitive=False):
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
   __pyx_r = ((struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *)Py_None); __Pyx_INCREF(Py_None);
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":1303
+  /* "resiliparse/parse/html.pyx":1349
  *         return _create_dom_collection(self.tree, joined_coll)
  * 
  *     cpdef DOMNode get_element_by_id(self, str element_id, bint case_insensitive=False):             # <<<<<<<<<<<<<<
  *         """
  *         get_element_by_id(self, element_id, case_insensitive=False)
  */
 
@@ -17217,41 +17818,41 @@
         case  1:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_case_insensitive);
           if (value) { values[1] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "get_element_by_id") < 0)) __PYX_ERR(0, 1303, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "get_element_by_id") < 0)) __PYX_ERR(0, 1349, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
         CYTHON_FALLTHROUGH;
         case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
         break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_element_id = ((PyObject*)values[0]);
     if (values[1]) {
-      __pyx_v_case_insensitive = __Pyx_PyObject_IsTrue(values[1]); if (unlikely((__pyx_v_case_insensitive == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 1303, __pyx_L3_error)
+      __pyx_v_case_insensitive = __Pyx_PyObject_IsTrue(values[1]); if (unlikely((__pyx_v_case_insensitive == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 1349, __pyx_L3_error)
     } else {
       __pyx_v_case_insensitive = ((int)0);
     }
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("get_element_by_id", 0, 1, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1303, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("get_element_by_id", 0, 1, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1349, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("resiliparse.parse.html.DOMCollection.get_element_by_id", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_element_id), (&PyUnicode_Type), 1, "element_id", 1))) __PYX_ERR(0, 1303, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_element_id), (&PyUnicode_Type), 1, "element_id", 1))) __PYX_ERR(0, 1349, __pyx_L1_error)
   __pyx_r = __pyx_pf_11resiliparse_5parse_4html_13DOMCollection_4get_element_by_id(((struct __pyx_obj_11resiliparse_5parse_4html_DOMCollection *)__pyx_v_self), __pyx_v_element_id, __pyx_v_case_insensitive);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -17267,15 +17868,15 @@
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("get_element_by_id", 0);
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_2.__pyx_n = 1;
   __pyx_t_2.case_insensitive = __pyx_v_case_insensitive;
-  __pyx_t_1 = ((PyObject *)__pyx_vtabptr_11resiliparse_5parse_4html_DOMCollection->get_element_by_id(__pyx_v_self, __pyx_v_element_id, 1, &__pyx_t_2)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1303, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_vtabptr_11resiliparse_5parse_4html_DOMCollection->get_element_by_id(__pyx_v_self, __pyx_v_element_id, 1, &__pyx_t_2)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1349, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -17284,15 +17885,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":1330
+/* "resiliparse/parse/html.pyx":1376
  *         return None
  * 
  *     cpdef DOMCollection get_elements_by_attr(self, str attr_name, str attr_value, bint case_insensitive=False):             # <<<<<<<<<<<<<<
  *         """
  *         get_elements_by_attr(self, attr_name, attr_value, case_insensitive=False)
  */
 
@@ -17322,19 +17923,19 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_get_elements_by_attr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1330, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_get_elements_by_attr); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1376, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_11resiliparse_5parse_4html_13DOMCollection_7get_elements_by_attr)) {
         __Pyx_XDECREF(((PyObject *)__pyx_r));
-        __pyx_t_3 = __Pyx_PyBool_FromLong(__pyx_v_case_insensitive); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1330, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyBool_FromLong(__pyx_v_case_insensitive); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1376, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_4 = __pyx_t_1; __pyx_t_5 = NULL;
         __pyx_t_6 = 0;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
           __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
           if (likely(__pyx_t_5)) {
@@ -17344,50 +17945,50 @@
             __Pyx_DECREF_SET(__pyx_t_4, function);
             __pyx_t_6 = 1;
           }
         }
         #if CYTHON_FAST_PYCALL
         if (PyFunction_Check(__pyx_t_4)) {
           PyObject *__pyx_temp[4] = {__pyx_t_5, __pyx_v_attr_name, __pyx_v_attr_value, __pyx_t_3};
-          __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_6, 3+__pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1330, __pyx_L1_error)
+          __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_6, 3+__pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1376, __pyx_L1_error)
           __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
           __Pyx_GOTREF(__pyx_t_2);
           __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         } else
         #endif
         #if CYTHON_FAST_PYCCALL
         if (__Pyx_PyFastCFunction_Check(__pyx_t_4)) {
           PyObject *__pyx_temp[4] = {__pyx_t_5, __pyx_v_attr_name, __pyx_v_attr_value, __pyx_t_3};
-          __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_6, 3+__pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1330, __pyx_L1_error)
+          __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_6, 3+__pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1376, __pyx_L1_error)
           __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
           __Pyx_GOTREF(__pyx_t_2);
           __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         } else
         #endif
         {
-          __pyx_t_7 = PyTuple_New(3+__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1330, __pyx_L1_error)
+          __pyx_t_7 = PyTuple_New(3+__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1376, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_7);
           if (__pyx_t_5) {
             __Pyx_GIVEREF(__pyx_t_5); PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_5); __pyx_t_5 = NULL;
           }
           __Pyx_INCREF(__pyx_v_attr_name);
           __Pyx_GIVEREF(__pyx_v_attr_name);
           PyTuple_SET_ITEM(__pyx_t_7, 0+__pyx_t_6, __pyx_v_attr_name);
           __Pyx_INCREF(__pyx_v_attr_value);
           __Pyx_GIVEREF(__pyx_v_attr_value);
           PyTuple_SET_ITEM(__pyx_t_7, 1+__pyx_t_6, __pyx_v_attr_value);
           __Pyx_GIVEREF(__pyx_t_3);
           PyTuple_SET_ITEM(__pyx_t_7, 2+__pyx_t_6, __pyx_t_3);
           __pyx_t_3 = 0;
-          __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_7, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1330, __pyx_L1_error)
+          __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_7, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1376, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_2);
           __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
         }
         __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_11resiliparse_5parse_4html_DOMCollection))))) __PYX_ERR(0, 1330, __pyx_L1_error)
+        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_11resiliparse_5parse_4html_DOMCollection))))) __PYX_ERR(0, 1376, __pyx_L1_error)
         __pyx_r = ((struct __pyx_obj_11resiliparse_5parse_4html_DOMCollection *)__pyx_t_2);
         __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -17398,74 +17999,74 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "resiliparse/parse/html.pyx":1346
+  /* "resiliparse/parse/html.pyx":1392
  *         :rtype: DOMCollection or None
  *         """
  *         return self._forward_collection_match(b'by_attr',             # <<<<<<<<<<<<<<
  *                                               (attr_name.encode(), attr_value.encode(),  10, case_insensitive))
  * 
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
 
-  /* "resiliparse/parse/html.pyx":1347
+  /* "resiliparse/parse/html.pyx":1393
  *         """
  *         return self._forward_collection_match(b'by_attr',
  *                                               (attr_name.encode(), attr_value.encode(),  10, case_insensitive))             # <<<<<<<<<<<<<<
  * 
  *     cpdef DOMCollection get_elements_by_class_name(self, str class_name, bint case_insensitive=False):
  */
   if (unlikely(__pyx_v_attr_name == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "encode");
-    __PYX_ERR(0, 1347, __pyx_L1_error)
+    __PYX_ERR(0, 1393, __pyx_L1_error)
   }
-  __pyx_t_1 = PyUnicode_AsEncodedString(__pyx_v_attr_name, NULL, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1347, __pyx_L1_error)
+  __pyx_t_1 = PyUnicode_AsEncodedString(__pyx_v_attr_name, NULL, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1393, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   if (unlikely(__pyx_v_attr_value == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "encode");
-    __PYX_ERR(0, 1347, __pyx_L1_error)
+    __PYX_ERR(0, 1393, __pyx_L1_error)
   }
-  __pyx_t_2 = PyUnicode_AsEncodedString(__pyx_v_attr_value, NULL, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1347, __pyx_L1_error)
+  __pyx_t_2 = PyUnicode_AsEncodedString(__pyx_v_attr_value, NULL, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1393, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  __pyx_t_4 = __Pyx_PyBool_FromLong(__pyx_v_case_insensitive); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1347, __pyx_L1_error)
+  __pyx_t_4 = __Pyx_PyBool_FromLong(__pyx_v_case_insensitive); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1393, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_7 = PyTuple_New(4); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1347, __pyx_L1_error)
+  __pyx_t_7 = PyTuple_New(4); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1393, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_1);
   __Pyx_GIVEREF(__pyx_t_2);
   PyTuple_SET_ITEM(__pyx_t_7, 1, __pyx_t_2);
   __Pyx_INCREF(__pyx_int_10);
   __Pyx_GIVEREF(__pyx_int_10);
   PyTuple_SET_ITEM(__pyx_t_7, 2, __pyx_int_10);
   __Pyx_GIVEREF(__pyx_t_4);
   PyTuple_SET_ITEM(__pyx_t_7, 3, __pyx_t_4);
   __pyx_t_1 = 0;
   __pyx_t_2 = 0;
   __pyx_t_4 = 0;
 
-  /* "resiliparse/parse/html.pyx":1346
+  /* "resiliparse/parse/html.pyx":1392
  *         :rtype: DOMCollection or None
  *         """
  *         return self._forward_collection_match(b'by_attr',             # <<<<<<<<<<<<<<
  *                                               (attr_name.encode(), attr_value.encode(),  10, case_insensitive))
  * 
  */
-  __pyx_t_4 = ((PyObject *)((struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMCollection *)__pyx_v_self->__pyx_vtab)->_forward_collection_match(__pyx_v_self, __pyx_n_b_by_attr, __pyx_t_7)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1346, __pyx_L1_error)
+  __pyx_t_4 = ((PyObject *)((struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMCollection *)__pyx_v_self->__pyx_vtab)->_forward_collection_match(__pyx_v_self, __pyx_n_b_by_attr, __pyx_t_7)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1392, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __pyx_r = ((struct __pyx_obj_11resiliparse_5parse_4html_DOMCollection *)__pyx_t_4);
   __pyx_t_4 = 0;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":1330
+  /* "resiliparse/parse/html.pyx":1376
  *         return None
  * 
  *     cpdef DOMCollection get_elements_by_attr(self, str attr_name, str attr_value, bint case_insensitive=False):             # <<<<<<<<<<<<<<
  *         """
  *         get_elements_by_attr(self, attr_name, attr_value, case_insensitive=False)
  */
 
@@ -17519,54 +18120,54 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_attr_name)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_attr_value)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("get_elements_by_attr", 0, 2, 3, 1); __PYX_ERR(0, 1330, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("get_elements_by_attr", 0, 2, 3, 1); __PYX_ERR(0, 1376, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_case_insensitive);
           if (value) { values[2] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "get_elements_by_attr") < 0)) __PYX_ERR(0, 1330, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "get_elements_by_attr") < 0)) __PYX_ERR(0, 1376, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
         CYTHON_FALLTHROUGH;
         case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
         values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
         break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_attr_name = ((PyObject*)values[0]);
     __pyx_v_attr_value = ((PyObject*)values[1]);
     if (values[2]) {
-      __pyx_v_case_insensitive = __Pyx_PyObject_IsTrue(values[2]); if (unlikely((__pyx_v_case_insensitive == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 1330, __pyx_L3_error)
+      __pyx_v_case_insensitive = __Pyx_PyObject_IsTrue(values[2]); if (unlikely((__pyx_v_case_insensitive == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 1376, __pyx_L3_error)
     } else {
       __pyx_v_case_insensitive = ((int)0);
     }
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("get_elements_by_attr", 0, 2, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1330, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("get_elements_by_attr", 0, 2, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1376, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("resiliparse.parse.html.DOMCollection.get_elements_by_attr", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_attr_name), (&PyUnicode_Type), 1, "attr_name", 1))) __PYX_ERR(0, 1330, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_attr_value), (&PyUnicode_Type), 1, "attr_value", 1))) __PYX_ERR(0, 1330, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_attr_name), (&PyUnicode_Type), 1, "attr_name", 1))) __PYX_ERR(0, 1376, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_attr_value), (&PyUnicode_Type), 1, "attr_value", 1))) __PYX_ERR(0, 1376, __pyx_L1_error)
   __pyx_r = __pyx_pf_11resiliparse_5parse_4html_13DOMCollection_6get_elements_by_attr(((struct __pyx_obj_11resiliparse_5parse_4html_DOMCollection *)__pyx_v_self), __pyx_v_attr_name, __pyx_v_attr_value, __pyx_v_case_insensitive);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -17582,15 +18183,15 @@
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("get_elements_by_attr", 0);
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_2.__pyx_n = 1;
   __pyx_t_2.case_insensitive = __pyx_v_case_insensitive;
-  __pyx_t_1 = ((PyObject *)__pyx_vtabptr_11resiliparse_5parse_4html_DOMCollection->get_elements_by_attr(__pyx_v_self, __pyx_v_attr_name, __pyx_v_attr_value, 1, &__pyx_t_2)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1330, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_vtabptr_11resiliparse_5parse_4html_DOMCollection->get_elements_by_attr(__pyx_v_self, __pyx_v_attr_name, __pyx_v_attr_value, 1, &__pyx_t_2)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1376, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -17599,15 +18200,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":1349
+/* "resiliparse/parse/html.pyx":1395
  *                                               (attr_name.encode(), attr_value.encode(),  10, case_insensitive))
  * 
  *     cpdef DOMCollection get_elements_by_class_name(self, str class_name, bint case_insensitive=False):             # <<<<<<<<<<<<<<
  *         """
  *         get_elements_by_class_name(self, element_class, case_insensitive=False)
  */
 
@@ -17637,19 +18238,19 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_get_elements_by_class_name); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1349, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_get_elements_by_class_name); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1395, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_11resiliparse_5parse_4html_13DOMCollection_9get_elements_by_class_name)) {
         __Pyx_XDECREF(((PyObject *)__pyx_r));
-        __pyx_t_3 = __Pyx_PyBool_FromLong(__pyx_v_case_insensitive); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1349, __pyx_L1_error)
+        __pyx_t_3 = __Pyx_PyBool_FromLong(__pyx_v_case_insensitive); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1395, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_3);
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_4 = __pyx_t_1; __pyx_t_5 = NULL;
         __pyx_t_6 = 0;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_4))) {
           __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_4);
           if (likely(__pyx_t_5)) {
@@ -17659,47 +18260,47 @@
             __Pyx_DECREF_SET(__pyx_t_4, function);
             __pyx_t_6 = 1;
           }
         }
         #if CYTHON_FAST_PYCALL
         if (PyFunction_Check(__pyx_t_4)) {
           PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_v_class_name, __pyx_t_3};
-          __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1349, __pyx_L1_error)
+          __pyx_t_2 = __Pyx_PyFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1395, __pyx_L1_error)
           __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
           __Pyx_GOTREF(__pyx_t_2);
           __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         } else
         #endif
         #if CYTHON_FAST_PYCCALL
         if (__Pyx_PyFastCFunction_Check(__pyx_t_4)) {
           PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_v_class_name, __pyx_t_3};
-          __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1349, __pyx_L1_error)
+          __pyx_t_2 = __Pyx_PyCFunction_FastCall(__pyx_t_4, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1395, __pyx_L1_error)
           __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
           __Pyx_GOTREF(__pyx_t_2);
           __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
         } else
         #endif
         {
-          __pyx_t_7 = PyTuple_New(2+__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1349, __pyx_L1_error)
+          __pyx_t_7 = PyTuple_New(2+__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1395, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_7);
           if (__pyx_t_5) {
             __Pyx_GIVEREF(__pyx_t_5); PyTuple_SET_ITEM(__pyx_t_7, 0, __pyx_t_5); __pyx_t_5 = NULL;
           }
           __Pyx_INCREF(__pyx_v_class_name);
           __Pyx_GIVEREF(__pyx_v_class_name);
           PyTuple_SET_ITEM(__pyx_t_7, 0+__pyx_t_6, __pyx_v_class_name);
           __Pyx_GIVEREF(__pyx_t_3);
           PyTuple_SET_ITEM(__pyx_t_7, 1+__pyx_t_6, __pyx_t_3);
           __pyx_t_3 = 0;
-          __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_7, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1349, __pyx_L1_error)
+          __pyx_t_2 = __Pyx_PyObject_Call(__pyx_t_4, __pyx_t_7, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1395, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_2);
           __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
         }
         __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_11resiliparse_5parse_4html_DOMCollection))))) __PYX_ERR(0, 1349, __pyx_L1_error)
+        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_11resiliparse_5parse_4html_DOMCollection))))) __PYX_ERR(0, 1395, __pyx_L1_error)
         __pyx_r = ((struct __pyx_obj_11resiliparse_5parse_4html_DOMCollection *)__pyx_t_2);
         __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -17710,44 +18311,44 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "resiliparse/parse/html.pyx":1363
+  /* "resiliparse/parse/html.pyx":1409
  *         :rtype: DOMCollection or None
  *         """
  *         return self._forward_collection_match(b'by_class', (class_name.encode(), 10))             # <<<<<<<<<<<<<<
  * 
  *     cpdef DOMCollection get_elements_by_tag_name(self, str tag_name):
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
   if (unlikely(__pyx_v_class_name == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "encode");
-    __PYX_ERR(0, 1363, __pyx_L1_error)
+    __PYX_ERR(0, 1409, __pyx_L1_error)
   }
-  __pyx_t_1 = PyUnicode_AsEncodedString(__pyx_v_class_name, NULL, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1363, __pyx_L1_error)
+  __pyx_t_1 = PyUnicode_AsEncodedString(__pyx_v_class_name, NULL, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1409, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1363, __pyx_L1_error)
+  __pyx_t_2 = PyTuple_New(2); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1409, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_1);
   __Pyx_INCREF(__pyx_int_10);
   __Pyx_GIVEREF(__pyx_int_10);
   PyTuple_SET_ITEM(__pyx_t_2, 1, __pyx_int_10);
   __pyx_t_1 = 0;
-  __pyx_t_1 = ((PyObject *)((struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMCollection *)__pyx_v_self->__pyx_vtab)->_forward_collection_match(__pyx_v_self, __pyx_n_b_by_class, __pyx_t_2)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1363, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)((struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMCollection *)__pyx_v_self->__pyx_vtab)->_forward_collection_match(__pyx_v_self, __pyx_n_b_by_class, __pyx_t_2)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1409, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_r = ((struct __pyx_obj_11resiliparse_5parse_4html_DOMCollection *)__pyx_t_1);
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":1349
+  /* "resiliparse/parse/html.pyx":1395
  *                                               (attr_name.encode(), attr_value.encode(),  10, case_insensitive))
  * 
  *     cpdef DOMCollection get_elements_by_class_name(self, str class_name, bint case_insensitive=False):             # <<<<<<<<<<<<<<
  *         """
  *         get_elements_by_class_name(self, element_class, case_insensitive=False)
  */
 
@@ -17802,41 +18403,41 @@
         case  1:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_case_insensitive);
           if (value) { values[1] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "get_elements_by_class_name") < 0)) __PYX_ERR(0, 1349, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "get_elements_by_class_name") < 0)) __PYX_ERR(0, 1395, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
         CYTHON_FALLTHROUGH;
         case  1: values[0] = PyTuple_GET_ITEM(__pyx_args, 0);
         break;
         default: goto __pyx_L5_argtuple_error;
       }
     }
     __pyx_v_class_name = ((PyObject*)values[0]);
     if (values[1]) {
-      __pyx_v_case_insensitive = __Pyx_PyObject_IsTrue(values[1]); if (unlikely((__pyx_v_case_insensitive == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 1349, __pyx_L3_error)
+      __pyx_v_case_insensitive = __Pyx_PyObject_IsTrue(values[1]); if (unlikely((__pyx_v_case_insensitive == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 1395, __pyx_L3_error)
     } else {
       __pyx_v_case_insensitive = ((int)0);
     }
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("get_elements_by_class_name", 0, 1, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1349, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("get_elements_by_class_name", 0, 1, 2, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1395, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("resiliparse.parse.html.DOMCollection.get_elements_by_class_name", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_class_name), (&PyUnicode_Type), 1, "class_name", 1))) __PYX_ERR(0, 1349, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_class_name), (&PyUnicode_Type), 1, "class_name", 1))) __PYX_ERR(0, 1395, __pyx_L1_error)
   __pyx_r = __pyx_pf_11resiliparse_5parse_4html_13DOMCollection_8get_elements_by_class_name(((struct __pyx_obj_11resiliparse_5parse_4html_DOMCollection *)__pyx_v_self), __pyx_v_class_name, __pyx_v_case_insensitive);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -17852,15 +18453,15 @@
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("get_elements_by_class_name", 0);
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_2.__pyx_n = 1;
   __pyx_t_2.case_insensitive = __pyx_v_case_insensitive;
-  __pyx_t_1 = ((PyObject *)__pyx_vtabptr_11resiliparse_5parse_4html_DOMCollection->get_elements_by_class_name(__pyx_v_self, __pyx_v_class_name, 1, &__pyx_t_2)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1349, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_vtabptr_11resiliparse_5parse_4html_DOMCollection->get_elements_by_class_name(__pyx_v_self, __pyx_v_class_name, 1, &__pyx_t_2)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1395, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -17869,15 +18470,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":1365
+/* "resiliparse/parse/html.pyx":1411
  *         return self._forward_collection_match(b'by_class', (class_name.encode(), 10))
  * 
  *     cpdef DOMCollection get_elements_by_tag_name(self, str tag_name):             # <<<<<<<<<<<<<<
  *         """
  *         get_elements_by_tag_name(self, tag_name)
  */
 
@@ -17898,15 +18499,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_get_elements_by_tag_name); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1365, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_get_elements_by_tag_name); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1411, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_11resiliparse_5parse_4html_13DOMCollection_11get_elements_by_tag_name)) {
         __Pyx_XDECREF(((PyObject *)__pyx_r));
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
@@ -17915,18 +18516,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_v_tag_name) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_tag_name);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1365, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1411, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_11resiliparse_5parse_4html_DOMCollection))))) __PYX_ERR(0, 1365, __pyx_L1_error)
+        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_11resiliparse_5parse_4html_DOMCollection))))) __PYX_ERR(0, 1411, __pyx_L1_error)
         __pyx_r = ((struct __pyx_obj_11resiliparse_5parse_4html_DOMCollection *)__pyx_t_2);
         __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -17937,41 +18538,41 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "resiliparse/parse/html.pyx":1377
+  /* "resiliparse/parse/html.pyx":1423
  *         :rtype: DOMCollection
  *         """
  *         return self._forward_collection_match(b'by_tag', (tag_name.encode(),))             # <<<<<<<<<<<<<<
  * 
  *     cpdef DOMNode query_selector(self, str selector):
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
   if (unlikely(__pyx_v_tag_name == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "encode");
-    __PYX_ERR(0, 1377, __pyx_L1_error)
+    __PYX_ERR(0, 1423, __pyx_L1_error)
   }
-  __pyx_t_1 = PyUnicode_AsEncodedString(__pyx_v_tag_name, NULL, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1377, __pyx_L1_error)
+  __pyx_t_1 = PyUnicode_AsEncodedString(__pyx_v_tag_name, NULL, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1423, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1377, __pyx_L1_error)
+  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1423, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_1);
   __pyx_t_1 = 0;
-  __pyx_t_1 = ((PyObject *)((struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMCollection *)__pyx_v_self->__pyx_vtab)->_forward_collection_match(__pyx_v_self, __pyx_n_b_by_tag, __pyx_t_2)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1377, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)((struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMCollection *)__pyx_v_self->__pyx_vtab)->_forward_collection_match(__pyx_v_self, __pyx_n_b_by_tag, __pyx_t_2)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1423, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_r = ((struct __pyx_obj_11resiliparse_5parse_4html_DOMCollection *)__pyx_t_1);
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":1365
+  /* "resiliparse/parse/html.pyx":1411
  *         return self._forward_collection_match(b'by_class', (class_name.encode(), 10))
  * 
  *     cpdef DOMCollection get_elements_by_tag_name(self, str tag_name):             # <<<<<<<<<<<<<<
  *         """
  *         get_elements_by_tag_name(self, tag_name)
  */
 
@@ -17995,15 +18596,15 @@
 static PyObject *__pyx_pw_11resiliparse_5parse_4html_13DOMCollection_11get_elements_by_tag_name(PyObject *__pyx_v_self, PyObject *__pyx_v_tag_name) {
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("get_elements_by_tag_name (wrapper)", 0);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_tag_name), (&PyUnicode_Type), 1, "tag_name", 1))) __PYX_ERR(0, 1365, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_tag_name), (&PyUnicode_Type), 1, "tag_name", 1))) __PYX_ERR(0, 1411, __pyx_L1_error)
   __pyx_r = __pyx_pf_11resiliparse_5parse_4html_13DOMCollection_10get_elements_by_tag_name(((struct __pyx_obj_11resiliparse_5parse_4html_DOMCollection *)__pyx_v_self), ((PyObject*)__pyx_v_tag_name));
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -18016,15 +18617,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("get_elements_by_tag_name", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html_13DOMCollection_get_elements_by_tag_name(__pyx_v_self, __pyx_v_tag_name, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1365, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html_13DOMCollection_get_elements_by_tag_name(__pyx_v_self, __pyx_v_tag_name, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1411, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -18033,15 +18634,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":1379
+/* "resiliparse/parse/html.pyx":1425
  *         return self._forward_collection_match(b'by_tag', (tag_name.encode(),))
  * 
  *     cpdef DOMNode query_selector(self, str selector):             # <<<<<<<<<<<<<<
  *         """
  *         query_selector(self, selector)
  */
 
@@ -18058,28 +18659,29 @@
   PyObject *__pyx_t_4 = NULL;
   int __pyx_t_5;
   int __pyx_t_6;
   int __pyx_t_7;
   size_t __pyx_t_8;
   size_t __pyx_t_9;
   size_t __pyx_t_10;
+  lxb_dom_node_t *__pyx_t_11;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("query_selector", 0);
   /* Check if called by wrapper */
   if (unlikely(__pyx_skip_dispatch)) ;
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_query_selector); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1379, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_query_selector); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1425, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_11resiliparse_5parse_4html_13DOMCollection_13query_selector)) {
         __Pyx_XDECREF(((PyObject *)__pyx_r));
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
@@ -18088,18 +18690,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_v_selector) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_selector);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1379, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1425, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_11resiliparse_5parse_4html_DOMNode))))) __PYX_ERR(0, 1379, __pyx_L1_error)
+        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_11resiliparse_5parse_4html_DOMNode))))) __PYX_ERR(0, 1425, __pyx_L1_error)
         __pyx_r = ((struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *)__pyx_t_2);
         __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -18110,15 +18712,15 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "resiliparse/parse/html.pyx":1392
+  /* "resiliparse/parse/html.pyx":1438
  *         :rtype: DOMNode or None
  *         """
  *         if self.tree is None or not self.coll:             # <<<<<<<<<<<<<<
  *             raise RuntimeError('Trying to select items from uninitialized collection')
  * 
  */
   __pyx_t_6 = (((PyObject *)__pyx_v_self->tree) == Py_None);
@@ -18129,134 +18731,135 @@
     goto __pyx_L4_bool_binop_done;
   }
   __pyx_t_7 = ((!(__pyx_v_self->coll != 0)) != 0);
   __pyx_t_5 = __pyx_t_7;
   __pyx_L4_bool_binop_done:;
   if (unlikely(__pyx_t_5)) {
 
-    /* "resiliparse/parse/html.pyx":1393
+    /* "resiliparse/parse/html.pyx":1439
  *         """
  *         if self.tree is None or not self.coll:
  *             raise RuntimeError('Trying to select items from uninitialized collection')             # <<<<<<<<<<<<<<
  * 
  *         cdef lxb_dom_node_t* node
  */
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_RuntimeError, __pyx_tuple__25, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1393, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_RuntimeError, __pyx_tuple__28, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1439, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 1393, __pyx_L1_error)
+    __PYX_ERR(0, 1439, __pyx_L1_error)
 
-    /* "resiliparse/parse/html.pyx":1392
+    /* "resiliparse/parse/html.pyx":1438
  *         :rtype: DOMNode or None
  *         """
  *         if self.tree is None or not self.coll:             # <<<<<<<<<<<<<<
  *             raise RuntimeError('Trying to select items from uninitialized collection')
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":1396
+  /* "resiliparse/parse/html.pyx":1442
  * 
  *         cdef lxb_dom_node_t* node
  *         cdef size_t i = 0             # <<<<<<<<<<<<<<
  *         cdef bytes selector_bytes = selector.encode()
  *         for i in range(lxb_dom_collection_length(self.coll)):
  */
   __pyx_v_i = 0;
 
-  /* "resiliparse/parse/html.pyx":1397
+  /* "resiliparse/parse/html.pyx":1443
  *         cdef lxb_dom_node_t* node
  *         cdef size_t i = 0
  *         cdef bytes selector_bytes = selector.encode()             # <<<<<<<<<<<<<<
  *         for i in range(lxb_dom_collection_length(self.coll)):
  *             node = query_selector_impl(lxb_dom_collection_node(self.coll, i), self.tree, selector_bytes)
  */
   if (unlikely(__pyx_v_selector == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "encode");
-    __PYX_ERR(0, 1397, __pyx_L1_error)
+    __PYX_ERR(0, 1443, __pyx_L1_error)
   }
-  __pyx_t_1 = PyUnicode_AsEncodedString(__pyx_v_selector, NULL, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1397, __pyx_L1_error)
+  __pyx_t_1 = PyUnicode_AsEncodedString(__pyx_v_selector, NULL, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1443, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_selector_bytes = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "resiliparse/parse/html.pyx":1398
+  /* "resiliparse/parse/html.pyx":1444
  *         cdef size_t i = 0
  *         cdef bytes selector_bytes = selector.encode()
  *         for i in range(lxb_dom_collection_length(self.coll)):             # <<<<<<<<<<<<<<
  *             node = query_selector_impl(lxb_dom_collection_node(self.coll, i), self.tree, selector_bytes)
  *             if node:
  */
   __pyx_t_8 = lxb_dom_collection_length(__pyx_v_self->coll);
   __pyx_t_9 = __pyx_t_8;
   for (__pyx_t_10 = 0; __pyx_t_10 < __pyx_t_9; __pyx_t_10+=1) {
     __pyx_v_i = __pyx_t_10;
 
-    /* "resiliparse/parse/html.pyx":1399
+    /* "resiliparse/parse/html.pyx":1445
  *         cdef bytes selector_bytes = selector.encode()
  *         for i in range(lxb_dom_collection_length(self.coll)):
  *             node = query_selector_impl(lxb_dom_collection_node(self.coll, i), self.tree, selector_bytes)             # <<<<<<<<<<<<<<
  *             if node:
  *                 return _create_dom_node(self.tree, node)
  */
     __pyx_t_1 = ((PyObject *)__pyx_v_self->tree);
     __Pyx_INCREF(__pyx_t_1);
-    __pyx_v_node = __pyx_f_11resiliparse_5parse_4html_query_selector_impl(lxb_dom_collection_node(__pyx_v_self->coll, __pyx_v_i), ((struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *)__pyx_t_1), __pyx_v_selector_bytes);
+    __pyx_t_11 = __pyx_f_11resiliparse_5parse_4html_query_selector_impl(lxb_dom_collection_node(__pyx_v_self->coll, __pyx_v_i), ((struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *)__pyx_t_1), __pyx_v_selector_bytes); if (unlikely(__pyx_t_11 == ((lxb_dom_node_t *)((lxb_dom_node_t *)-1L)))) __PYX_ERR(0, 1445, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
+    __pyx_v_node = __pyx_t_11;
 
-    /* "resiliparse/parse/html.pyx":1400
+    /* "resiliparse/parse/html.pyx":1446
  *         for i in range(lxb_dom_collection_length(self.coll)):
  *             node = query_selector_impl(lxb_dom_collection_node(self.coll, i), self.tree, selector_bytes)
  *             if node:             # <<<<<<<<<<<<<<
  *                 return _create_dom_node(self.tree, node)
  * 
  */
     __pyx_t_5 = (__pyx_v_node != 0);
     if (__pyx_t_5) {
 
-      /* "resiliparse/parse/html.pyx":1401
+      /* "resiliparse/parse/html.pyx":1447
  *             node = query_selector_impl(lxb_dom_collection_node(self.coll, i), self.tree, selector_bytes)
  *             if node:
  *                 return _create_dom_node(self.tree, node)             # <<<<<<<<<<<<<<
  * 
  *         return None
  */
       __Pyx_XDECREF(((PyObject *)__pyx_r));
       __pyx_t_1 = ((PyObject *)__pyx_v_self->tree);
       __Pyx_INCREF(__pyx_t_1);
-      __pyx_t_2 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html__create_dom_node(((struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *)__pyx_t_1), __pyx_v_node)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1401, __pyx_L1_error)
+      __pyx_t_2 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html__create_dom_node(((struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *)__pyx_t_1), __pyx_v_node)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1447, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_2);
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       __pyx_r = ((struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *)__pyx_t_2);
       __pyx_t_2 = 0;
       goto __pyx_L0;
 
-      /* "resiliparse/parse/html.pyx":1400
+      /* "resiliparse/parse/html.pyx":1446
  *         for i in range(lxb_dom_collection_length(self.coll)):
  *             node = query_selector_impl(lxb_dom_collection_node(self.coll, i), self.tree, selector_bytes)
  *             if node:             # <<<<<<<<<<<<<<
  *                 return _create_dom_node(self.tree, node)
  * 
  */
     }
   }
 
-  /* "resiliparse/parse/html.pyx":1403
+  /* "resiliparse/parse/html.pyx":1449
  *                 return _create_dom_node(self.tree, node)
  * 
  *         return None             # <<<<<<<<<<<<<<
  * 
  *     cpdef DOMCollection query_selector_all(self, str selector):
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
   __pyx_r = ((struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *)Py_None); __Pyx_INCREF(Py_None);
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":1379
+  /* "resiliparse/parse/html.pyx":1425
  *         return self._forward_collection_match(b'by_tag', (tag_name.encode(),))
  * 
  *     cpdef DOMNode query_selector(self, str selector):             # <<<<<<<<<<<<<<
  *         """
  *         query_selector(self, selector)
  */
 
@@ -18281,15 +18884,15 @@
 static PyObject *__pyx_pw_11resiliparse_5parse_4html_13DOMCollection_13query_selector(PyObject *__pyx_v_self, PyObject *__pyx_v_selector) {
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("query_selector (wrapper)", 0);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_selector), (&PyUnicode_Type), 1, "selector", 1))) __PYX_ERR(0, 1379, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_selector), (&PyUnicode_Type), 1, "selector", 1))) __PYX_ERR(0, 1425, __pyx_L1_error)
   __pyx_r = __pyx_pf_11resiliparse_5parse_4html_13DOMCollection_12query_selector(((struct __pyx_obj_11resiliparse_5parse_4html_DOMCollection *)__pyx_v_self), ((PyObject*)__pyx_v_selector));
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -18302,15 +18905,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("query_selector", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html_13DOMCollection_query_selector(__pyx_v_self, __pyx_v_selector, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1379, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html_13DOMCollection_query_selector(__pyx_v_self, __pyx_v_selector, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1425, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -18319,15 +18922,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":1405
+/* "resiliparse/parse/html.pyx":1451
  *         return None
  * 
  *     cpdef DOMCollection query_selector_all(self, str selector):             # <<<<<<<<<<<<<<
  *         """
  *         query_selector_all(self, selector)
  */
 
@@ -18348,15 +18951,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_query_selector_all); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1405, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_query_selector_all); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1451, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_11resiliparse_5parse_4html_13DOMCollection_15query_selector_all)) {
         __Pyx_XDECREF(((PyObject *)__pyx_r));
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
@@ -18365,18 +18968,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_v_selector) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_selector);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1405, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1451, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_11resiliparse_5parse_4html_DOMCollection))))) __PYX_ERR(0, 1405, __pyx_L1_error)
+        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_11resiliparse_5parse_4html_DOMCollection))))) __PYX_ERR(0, 1451, __pyx_L1_error)
         __pyx_r = ((struct __pyx_obj_11resiliparse_5parse_4html_DOMCollection *)__pyx_t_2);
         __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -18387,41 +18990,41 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "resiliparse/parse/html.pyx":1417
+  /* "resiliparse/parse/html.pyx":1463
  *         :rtype: DOMCollection
  *         """
  *         return self._forward_collection_match(b'selector_all', (selector.encode(),))             # <<<<<<<<<<<<<<
  * 
  *     cpdef bint matches(self, str selector) except -1:
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
   if (unlikely(__pyx_v_selector == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "encode");
-    __PYX_ERR(0, 1417, __pyx_L1_error)
+    __PYX_ERR(0, 1463, __pyx_L1_error)
   }
-  __pyx_t_1 = PyUnicode_AsEncodedString(__pyx_v_selector, NULL, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1417, __pyx_L1_error)
+  __pyx_t_1 = PyUnicode_AsEncodedString(__pyx_v_selector, NULL, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1463, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1417, __pyx_L1_error)
+  __pyx_t_2 = PyTuple_New(1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1463, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_GIVEREF(__pyx_t_1);
   PyTuple_SET_ITEM(__pyx_t_2, 0, __pyx_t_1);
   __pyx_t_1 = 0;
-  __pyx_t_1 = ((PyObject *)((struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMCollection *)__pyx_v_self->__pyx_vtab)->_forward_collection_match(__pyx_v_self, __pyx_n_b_selector_all, __pyx_t_2)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1417, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)((struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMCollection *)__pyx_v_self->__pyx_vtab)->_forward_collection_match(__pyx_v_self, __pyx_n_b_selector_all, __pyx_t_2)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1463, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_r = ((struct __pyx_obj_11resiliparse_5parse_4html_DOMCollection *)__pyx_t_1);
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":1405
+  /* "resiliparse/parse/html.pyx":1451
  *         return None
  * 
  *     cpdef DOMCollection query_selector_all(self, str selector):             # <<<<<<<<<<<<<<
  *         """
  *         query_selector_all(self, selector)
  */
 
@@ -18445,15 +19048,15 @@
 static PyObject *__pyx_pw_11resiliparse_5parse_4html_13DOMCollection_15query_selector_all(PyObject *__pyx_v_self, PyObject *__pyx_v_selector) {
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("query_selector_all (wrapper)", 0);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_selector), (&PyUnicode_Type), 1, "selector", 1))) __PYX_ERR(0, 1405, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_selector), (&PyUnicode_Type), 1, "selector", 1))) __PYX_ERR(0, 1451, __pyx_L1_error)
   __pyx_r = __pyx_pf_11resiliparse_5parse_4html_13DOMCollection_14query_selector_all(((struct __pyx_obj_11resiliparse_5parse_4html_DOMCollection *)__pyx_v_self), ((PyObject*)__pyx_v_selector));
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -18466,15 +19069,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("query_selector_all", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html_13DOMCollection_query_selector_all(__pyx_v_self, __pyx_v_selector, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1405, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html_13DOMCollection_query_selector_all(__pyx_v_self, __pyx_v_selector, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1451, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -18483,15 +19086,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":1419
+/* "resiliparse/parse/html.pyx":1465
  *         return self._forward_collection_match(b'selector_all', (selector.encode(),))
  * 
  *     cpdef bint matches(self, str selector) except -1:             # <<<<<<<<<<<<<<
  *         """
  *         matches(self, selector)
  */
 
@@ -18520,15 +19123,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_matches); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1419, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_matches); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1465, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_11resiliparse_5parse_4html_13DOMCollection_17matches)) {
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
           if (likely(__pyx_t_4)) {
@@ -18536,18 +19139,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_v_selector) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_selector);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1419, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1465, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_5 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 1419, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyObject_IsTrue(__pyx_t_2); if (unlikely((__pyx_t_5 == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 1465, __pyx_L1_error)
         __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
         __pyx_r = __pyx_t_5;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -18558,15 +19161,15 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "resiliparse/parse/html.pyx":1432
+  /* "resiliparse/parse/html.pyx":1478
  *         :rtype: bool
  *         """
  *         if self.tree is None or not self.coll:             # <<<<<<<<<<<<<<
  *             raise RuntimeError('Trying to select items from uninitialized collection')
  * 
  */
   __pyx_t_6 = (((PyObject *)__pyx_v_self->tree) == Py_None);
@@ -18577,117 +19180,117 @@
     goto __pyx_L4_bool_binop_done;
   }
   __pyx_t_7 = ((!(__pyx_v_self->coll != 0)) != 0);
   __pyx_t_5 = __pyx_t_7;
   __pyx_L4_bool_binop_done:;
   if (unlikely(__pyx_t_5)) {
 
-    /* "resiliparse/parse/html.pyx":1433
+    /* "resiliparse/parse/html.pyx":1479
  *         """
  *         if self.tree is None or not self.coll:
  *             raise RuntimeError('Trying to select items from uninitialized collection')             # <<<<<<<<<<<<<<
  * 
  *         cdef size_t i = 0
  */
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_RuntimeError, __pyx_tuple__25, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1433, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_RuntimeError, __pyx_tuple__28, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1479, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 1433, __pyx_L1_error)
+    __PYX_ERR(0, 1479, __pyx_L1_error)
 
-    /* "resiliparse/parse/html.pyx":1432
+    /* "resiliparse/parse/html.pyx":1478
  *         :rtype: bool
  *         """
  *         if self.tree is None or not self.coll:             # <<<<<<<<<<<<<<
  *             raise RuntimeError('Trying to select items from uninitialized collection')
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":1435
+  /* "resiliparse/parse/html.pyx":1481
  *             raise RuntimeError('Trying to select items from uninitialized collection')
  * 
  *         cdef size_t i = 0             # <<<<<<<<<<<<<<
  *         cdef bytes selector_bytes = selector.encode()
  *         for i in range(lxb_dom_collection_length(self.coll)):
  */
   __pyx_v_i = 0;
 
-  /* "resiliparse/parse/html.pyx":1436
+  /* "resiliparse/parse/html.pyx":1482
  * 
  *         cdef size_t i = 0
  *         cdef bytes selector_bytes = selector.encode()             # <<<<<<<<<<<<<<
  *         for i in range(lxb_dom_collection_length(self.coll)):
  *             if matches_impl(lxb_dom_collection_node(self.coll, i), self.tree, selector_bytes):
  */
   if (unlikely(__pyx_v_selector == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "encode");
-    __PYX_ERR(0, 1436, __pyx_L1_error)
+    __PYX_ERR(0, 1482, __pyx_L1_error)
   }
-  __pyx_t_1 = PyUnicode_AsEncodedString(__pyx_v_selector, NULL, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1436, __pyx_L1_error)
+  __pyx_t_1 = PyUnicode_AsEncodedString(__pyx_v_selector, NULL, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1482, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_selector_bytes = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "resiliparse/parse/html.pyx":1437
+  /* "resiliparse/parse/html.pyx":1483
  *         cdef size_t i = 0
  *         cdef bytes selector_bytes = selector.encode()
  *         for i in range(lxb_dom_collection_length(self.coll)):             # <<<<<<<<<<<<<<
  *             if matches_impl(lxb_dom_collection_node(self.coll, i), self.tree, selector_bytes):
  *                 return True
  */
   __pyx_t_8 = lxb_dom_collection_length(__pyx_v_self->coll);
   __pyx_t_9 = __pyx_t_8;
   for (__pyx_t_10 = 0; __pyx_t_10 < __pyx_t_9; __pyx_t_10+=1) {
     __pyx_v_i = __pyx_t_10;
 
-    /* "resiliparse/parse/html.pyx":1438
+    /* "resiliparse/parse/html.pyx":1484
  *         cdef bytes selector_bytes = selector.encode()
  *         for i in range(lxb_dom_collection_length(self.coll)):
  *             if matches_impl(lxb_dom_collection_node(self.coll, i), self.tree, selector_bytes):             # <<<<<<<<<<<<<<
  *                 return True
  * 
  */
     __pyx_t_1 = ((PyObject *)__pyx_v_self->tree);
     __Pyx_INCREF(__pyx_t_1);
     __pyx_t_5 = (__pyx_f_11resiliparse_5parse_4html_matches_impl(lxb_dom_collection_node(__pyx_v_self->coll, __pyx_v_i), ((struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *)__pyx_t_1), __pyx_v_selector_bytes) != 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     if (__pyx_t_5) {
 
-      /* "resiliparse/parse/html.pyx":1439
+      /* "resiliparse/parse/html.pyx":1485
  *         for i in range(lxb_dom_collection_length(self.coll)):
  *             if matches_impl(lxb_dom_collection_node(self.coll, i), self.tree, selector_bytes):
  *                 return True             # <<<<<<<<<<<<<<
  * 
  *         return False
  */
       __pyx_r = 1;
       goto __pyx_L0;
 
-      /* "resiliparse/parse/html.pyx":1438
+      /* "resiliparse/parse/html.pyx":1484
  *         cdef bytes selector_bytes = selector.encode()
  *         for i in range(lxb_dom_collection_length(self.coll)):
  *             if matches_impl(lxb_dom_collection_node(self.coll, i), self.tree, selector_bytes):             # <<<<<<<<<<<<<<
  *                 return True
  * 
  */
     }
   }
 
-  /* "resiliparse/parse/html.pyx":1441
+  /* "resiliparse/parse/html.pyx":1487
  *                 return True
  * 
  *         return False             # <<<<<<<<<<<<<<
  * 
  *     def __iter__(self):
  */
   __pyx_r = 0;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":1419
+  /* "resiliparse/parse/html.pyx":1465
  *         return self._forward_collection_match(b'selector_all', (selector.encode(),))
  * 
  *     cpdef bint matches(self, str selector) except -1:             # <<<<<<<<<<<<<<
  *         """
  *         matches(self, selector)
  */
 
@@ -18711,15 +19314,15 @@
 static PyObject *__pyx_pw_11resiliparse_5parse_4html_13DOMCollection_17matches(PyObject *__pyx_v_self, PyObject *__pyx_v_selector) {
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("matches (wrapper)", 0);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_selector), (&PyUnicode_Type), 1, "selector", 1))) __PYX_ERR(0, 1419, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_selector), (&PyUnicode_Type), 1, "selector", 1))) __PYX_ERR(0, 1465, __pyx_L1_error)
   __pyx_r = __pyx_pf_11resiliparse_5parse_4html_13DOMCollection_16matches(((struct __pyx_obj_11resiliparse_5parse_4html_DOMCollection *)__pyx_v_self), ((PyObject*)__pyx_v_selector));
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -18733,16 +19336,16 @@
   int __pyx_t_1;
   PyObject *__pyx_t_2 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("matches", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = __pyx_f_11resiliparse_5parse_4html_13DOMCollection_matches(__pyx_v_self, __pyx_v_selector, 1); if (unlikely(__pyx_t_1 == ((int)-1))) __PYX_ERR(0, 1419, __pyx_L1_error)
-  __pyx_t_2 = __Pyx_PyBool_FromLong(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1419, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_11resiliparse_5parse_4html_13DOMCollection_matches(__pyx_v_self, __pyx_v_selector, 1); if (unlikely(__pyx_t_1 == ((int)-1))) __PYX_ERR(0, 1465, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyBool_FromLong(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1465, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_r = __pyx_t_2;
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -18752,15 +19355,15 @@
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 static PyObject *__pyx_gb_11resiliparse_5parse_4html_13DOMCollection_20generator1(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value); /* proto */
 
-/* "resiliparse/parse/html.pyx":1443
+/* "resiliparse/parse/html.pyx":1489
  *         return False
  * 
  *     def __iter__(self):             # <<<<<<<<<<<<<<
  *         """
  *         __iter__(self)
  */
 
@@ -18789,23 +19392,23 @@
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__iter__", 0);
   __pyx_cur_scope = (struct __pyx_obj_11resiliparse_5parse_4html___pyx_scope_struct_3___iter__ *)__pyx_tp_new_11resiliparse_5parse_4html___pyx_scope_struct_3___iter__(__pyx_ptype_11resiliparse_5parse_4html___pyx_scope_struct_3___iter__, __pyx_empty_tuple, NULL);
   if (unlikely(!__pyx_cur_scope)) {
     __pyx_cur_scope = ((struct __pyx_obj_11resiliparse_5parse_4html___pyx_scope_struct_3___iter__ *)Py_None);
     __Pyx_INCREF(Py_None);
-    __PYX_ERR(0, 1443, __pyx_L1_error)
+    __PYX_ERR(0, 1489, __pyx_L1_error)
   } else {
     __Pyx_GOTREF(__pyx_cur_scope);
   }
   __pyx_cur_scope->__pyx_v_self = __pyx_v_self;
   __Pyx_INCREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
   __Pyx_GIVEREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
   {
-    __pyx_CoroutineObject *gen = __Pyx_Generator_New((__pyx_coroutine_body_t) __pyx_gb_11resiliparse_5parse_4html_13DOMCollection_20generator1, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_iter, __pyx_n_s_DOMCollection___iter, __pyx_n_s_resiliparse_parse_html); if (unlikely(!gen)) __PYX_ERR(0, 1443, __pyx_L1_error)
+    __pyx_CoroutineObject *gen = __Pyx_Generator_New((__pyx_coroutine_body_t) __pyx_gb_11resiliparse_5parse_4html_13DOMCollection_20generator1, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_iter, __pyx_n_s_DOMCollection___iter, __pyx_n_s_resiliparse_parse_html); if (unlikely(!gen)) __PYX_ERR(0, 1489, __pyx_L1_error)
     __Pyx_DECREF(__pyx_cur_scope);
     __Pyx_RefNannyFinishContext();
     return (PyObject *) gen;
   }
 
   /* function exit code */
   __pyx_L1_error:;
@@ -18838,17 +19441,17 @@
     case 0: goto __pyx_L3_first_run;
     case 1: goto __pyx_L9_resume_from_yield;
     default: /* CPython raises the right error here */
     __Pyx_RefNannyFinishContext();
     return NULL;
   }
   __pyx_L3_first_run:;
-  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1443, __pyx_L1_error)
+  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1489, __pyx_L1_error)
 
-  /* "resiliparse/parse/html.pyx":1451
+  /* "resiliparse/parse/html.pyx":1497
  *         :rtype: t.Iterable[DOMNode]
  *         """
  *         if self.tree is None or not self.coll:             # <<<<<<<<<<<<<<
  *             raise RuntimeError('Trying to get item of uninitialized collection')
  * 
  */
   __pyx_t_2 = (((PyObject *)__pyx_cur_scope->__pyx_v_self->tree) == Py_None);
@@ -18859,67 +19462,67 @@
     goto __pyx_L5_bool_binop_done;
   }
   __pyx_t_3 = ((!(__pyx_cur_scope->__pyx_v_self->coll != 0)) != 0);
   __pyx_t_1 = __pyx_t_3;
   __pyx_L5_bool_binop_done:;
   if (unlikely(__pyx_t_1)) {
 
-    /* "resiliparse/parse/html.pyx":1452
+    /* "resiliparse/parse/html.pyx":1498
  *         """
  *         if self.tree is None or not self.coll:
  *             raise RuntimeError('Trying to get item of uninitialized collection')             # <<<<<<<<<<<<<<
  * 
  *         cdef size_t i = 0
  */
-    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_builtin_RuntimeError, __pyx_tuple__26, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1452, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_builtin_RuntimeError, __pyx_tuple__29, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1498, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_Raise(__pyx_t_4, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __PYX_ERR(0, 1452, __pyx_L1_error)
+    __PYX_ERR(0, 1498, __pyx_L1_error)
 
-    /* "resiliparse/parse/html.pyx":1451
+    /* "resiliparse/parse/html.pyx":1497
  *         :rtype: t.Iterable[DOMNode]
  *         """
  *         if self.tree is None or not self.coll:             # <<<<<<<<<<<<<<
  *             raise RuntimeError('Trying to get item of uninitialized collection')
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":1454
+  /* "resiliparse/parse/html.pyx":1500
  *             raise RuntimeError('Trying to get item of uninitialized collection')
  * 
  *         cdef size_t i = 0             # <<<<<<<<<<<<<<
  *         for i in range(lxb_dom_collection_length(self.coll)):
  *             yield _create_dom_node(self.tree, lxb_dom_collection_node(self.coll, i))
  */
   __pyx_cur_scope->__pyx_v_i = 0;
 
-  /* "resiliparse/parse/html.pyx":1455
+  /* "resiliparse/parse/html.pyx":1501
  * 
  *         cdef size_t i = 0
  *         for i in range(lxb_dom_collection_length(self.coll)):             # <<<<<<<<<<<<<<
  *             yield _create_dom_node(self.tree, lxb_dom_collection_node(self.coll, i))
  * 
  */
   __pyx_t_5 = lxb_dom_collection_length(__pyx_cur_scope->__pyx_v_self->coll);
   __pyx_t_6 = __pyx_t_5;
   for (__pyx_t_7 = 0; __pyx_t_7 < __pyx_t_6; __pyx_t_7+=1) {
     __pyx_cur_scope->__pyx_v_i = __pyx_t_7;
 
-    /* "resiliparse/parse/html.pyx":1456
+    /* "resiliparse/parse/html.pyx":1502
  *         cdef size_t i = 0
  *         for i in range(lxb_dom_collection_length(self.coll)):
  *             yield _create_dom_node(self.tree, lxb_dom_collection_node(self.coll, i))             # <<<<<<<<<<<<<<
  * 
  *     def __len__(self):
  */
     __pyx_t_4 = ((PyObject *)__pyx_cur_scope->__pyx_v_self->tree);
     __Pyx_INCREF(__pyx_t_4);
-    __pyx_t_8 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html__create_dom_node(((struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *)__pyx_t_4), lxb_dom_collection_node(__pyx_cur_scope->__pyx_v_self->coll, __pyx_cur_scope->__pyx_v_i))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1456, __pyx_L1_error)
+    __pyx_t_8 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html__create_dom_node(((struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *)__pyx_t_4), lxb_dom_collection_node(__pyx_cur_scope->__pyx_v_self->coll, __pyx_cur_scope->__pyx_v_i))); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1502, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_8);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __pyx_r = __pyx_t_8;
     __pyx_t_8 = 0;
     __pyx_cur_scope->__pyx_t_0 = __pyx_t_5;
     __pyx_cur_scope->__pyx_t_1 = __pyx_t_6;
     __pyx_cur_scope->__pyx_t_2 = __pyx_t_7;
@@ -18929,19 +19532,19 @@
     /* return from generator, yielding value */
     __pyx_generator->resume_label = 1;
     return __pyx_r;
     __pyx_L9_resume_from_yield:;
     __pyx_t_5 = __pyx_cur_scope->__pyx_t_0;
     __pyx_t_6 = __pyx_cur_scope->__pyx_t_1;
     __pyx_t_7 = __pyx_cur_scope->__pyx_t_2;
-    if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1456, __pyx_L1_error)
+    if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1502, __pyx_L1_error)
   }
   CYTHON_MAYBE_UNUSED_VAR(__pyx_cur_scope);
 
-  /* "resiliparse/parse/html.pyx":1443
+  /* "resiliparse/parse/html.pyx":1489
  *         return False
  * 
  *     def __iter__(self):             # <<<<<<<<<<<<<<
  *         """
  *         __iter__(self)
  */
 
@@ -18959,15 +19562,15 @@
   #endif
   __pyx_generator->resume_label = -1;
   __Pyx_Coroutine_clear((PyObject*)__pyx_generator);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":1458
+/* "resiliparse/parse/html.pyx":1504
  *             yield _create_dom_node(self.tree, lxb_dom_collection_node(self.coll, i))
  * 
  *     def __len__(self):             # <<<<<<<<<<<<<<
  *         """
  *         __len__(self)
  */
 
@@ -18992,15 +19595,15 @@
   Py_ssize_t __pyx_r;
   __Pyx_RefNannyDeclarations
   int __pyx_t_1;
   int __pyx_t_2;
   int __pyx_t_3;
   __Pyx_RefNannySetupContext("__len__", 0);
 
-  /* "resiliparse/parse/html.pyx":1466
+  /* "resiliparse/parse/html.pyx":1512
  *         :rtype: int
  *         """
  *         if self.tree is None or not self.coll:             # <<<<<<<<<<<<<<
  *             return 0
  *         return lxb_dom_collection_length(self.coll)
  */
   __pyx_t_2 = (((PyObject *)__pyx_v_self->tree) == Py_None);
@@ -19011,58 +19614,58 @@
     goto __pyx_L4_bool_binop_done;
   }
   __pyx_t_3 = ((!(__pyx_v_self->coll != 0)) != 0);
   __pyx_t_1 = __pyx_t_3;
   __pyx_L4_bool_binop_done:;
   if (__pyx_t_1) {
 
-    /* "resiliparse/parse/html.pyx":1467
+    /* "resiliparse/parse/html.pyx":1513
  *         """
  *         if self.tree is None or not self.coll:
  *             return 0             # <<<<<<<<<<<<<<
  *         return lxb_dom_collection_length(self.coll)
  * 
  */
     __pyx_r = 0;
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":1466
+    /* "resiliparse/parse/html.pyx":1512
  *         :rtype: int
  *         """
  *         if self.tree is None or not self.coll:             # <<<<<<<<<<<<<<
  *             return 0
  *         return lxb_dom_collection_length(self.coll)
  */
   }
 
-  /* "resiliparse/parse/html.pyx":1468
+  /* "resiliparse/parse/html.pyx":1514
  *         if self.tree is None or not self.coll:
  *             return 0
  *         return lxb_dom_collection_length(self.coll)             # <<<<<<<<<<<<<<
  * 
  *     def __getitem__(self, key):
  */
   __pyx_r = lxb_dom_collection_length(__pyx_v_self->coll);
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":1458
+  /* "resiliparse/parse/html.pyx":1504
  *             yield _create_dom_node(self.tree, lxb_dom_collection_node(self.coll, i))
  * 
  *     def __len__(self):             # <<<<<<<<<<<<<<
  *         """
  *         __len__(self)
  */
 
   /* function exit code */
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":1470
+/* "resiliparse/parse/html.pyx":1516
  *         return lxb_dom_collection_length(self.coll)
  * 
  *     def __getitem__(self, key):             # <<<<<<<<<<<<<<
  *         """
  *         __getitem__(self, key)
  */
 
@@ -19105,15 +19708,15 @@
   Py_ssize_t __pyx_t_10;
   PyObject *(*__pyx_t_11)(PyObject *);
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__getitem__", 0);
 
-  /* "resiliparse/parse/html.pyx":1482
+  /* "resiliparse/parse/html.pyx":1528
  *         :raises TypeError: if ``key`` is not an ``int`` or ``slice``
  *         """
  *         if self.tree is None or not self.coll:             # <<<<<<<<<<<<<<
  *             raise IndexError('Trying to get item of uninitialized collection')
  * 
  */
   __pyx_t_2 = (((PyObject *)__pyx_v_self->tree) == Py_None);
@@ -19124,535 +19727,535 @@
     goto __pyx_L4_bool_binop_done;
   }
   __pyx_t_3 = ((!(__pyx_v_self->coll != 0)) != 0);
   __pyx_t_1 = __pyx_t_3;
   __pyx_L4_bool_binop_done:;
   if (unlikely(__pyx_t_1)) {
 
-    /* "resiliparse/parse/html.pyx":1483
+    /* "resiliparse/parse/html.pyx":1529
  *         """
  *         if self.tree is None or not self.coll:
  *             raise IndexError('Trying to get item of uninitialized collection')             # <<<<<<<<<<<<<<
  * 
  *         cdef size_t coll_len = lxb_dom_collection_length(self.coll)
  */
-    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_builtin_IndexError, __pyx_tuple__26, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1483, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_builtin_IndexError, __pyx_tuple__29, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1529, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_Raise(__pyx_t_4, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __PYX_ERR(0, 1483, __pyx_L1_error)
+    __PYX_ERR(0, 1529, __pyx_L1_error)
 
-    /* "resiliparse/parse/html.pyx":1482
+    /* "resiliparse/parse/html.pyx":1528
  *         :raises TypeError: if ``key`` is not an ``int`` or ``slice``
  *         """
  *         if self.tree is None or not self.coll:             # <<<<<<<<<<<<<<
  *             raise IndexError('Trying to get item of uninitialized collection')
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":1485
+  /* "resiliparse/parse/html.pyx":1531
  *             raise IndexError('Trying to get item of uninitialized collection')
  * 
  *         cdef size_t coll_len = lxb_dom_collection_length(self.coll)             # <<<<<<<<<<<<<<
  * 
  *         cdef DOMCollection slice_coll
  */
   __pyx_v_coll_len = lxb_dom_collection_length(__pyx_v_self->coll);
 
-  /* "resiliparse/parse/html.pyx":1489
+  /* "resiliparse/parse/html.pyx":1535
  *         cdef DOMCollection slice_coll
  *         cdef lxb_dom_collection_t* dom_coll
  *         if isinstance(key, slice):             # <<<<<<<<<<<<<<
  *             start = key.start
  *             stop = key.stop
  */
   __pyx_t_1 = PySlice_Check(__pyx_v_key); 
   __pyx_t_3 = (__pyx_t_1 != 0);
   if (__pyx_t_3) {
 
-    /* "resiliparse/parse/html.pyx":1490
+    /* "resiliparse/parse/html.pyx":1536
  *         cdef lxb_dom_collection_t* dom_coll
  *         if isinstance(key, slice):
  *             start = key.start             # <<<<<<<<<<<<<<
  *             stop = key.stop
  *             step = key.step if key.step is not None else 1
  */
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_key, __pyx_n_s_start); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1490, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_key, __pyx_n_s_start); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1536, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __pyx_v_start = __pyx_t_4;
     __pyx_t_4 = 0;
 
-    /* "resiliparse/parse/html.pyx":1491
+    /* "resiliparse/parse/html.pyx":1537
  *         if isinstance(key, slice):
  *             start = key.start
  *             stop = key.stop             # <<<<<<<<<<<<<<
  *             step = key.step if key.step is not None else 1
  * 
  */
-    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_key, __pyx_n_s_stop); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1491, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_GetAttrStr(__pyx_v_key, __pyx_n_s_stop); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1537, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __pyx_v_stop = __pyx_t_4;
     __pyx_t_4 = 0;
 
-    /* "resiliparse/parse/html.pyx":1492
+    /* "resiliparse/parse/html.pyx":1538
  *             start = key.start
  *             stop = key.stop
  *             step = key.step if key.step is not None else 1             # <<<<<<<<<<<<<<
  * 
  *             if start is None:
  */
-    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_key, __pyx_n_s_step); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1492, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_key, __pyx_n_s_step); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1538, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __pyx_t_3 = (__pyx_t_5 != Py_None);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     if ((__pyx_t_3 != 0)) {
-      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_key, __pyx_n_s_step); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1492, __pyx_L1_error)
+      __pyx_t_5 = __Pyx_PyObject_GetAttrStr(__pyx_v_key, __pyx_n_s_step); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1538, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_5);
       __pyx_t_4 = __pyx_t_5;
       __pyx_t_5 = 0;
     } else {
       __Pyx_INCREF(__pyx_int_1);
       __pyx_t_4 = __pyx_int_1;
     }
     __pyx_v_step = __pyx_t_4;
     __pyx_t_4 = 0;
 
-    /* "resiliparse/parse/html.pyx":1494
+    /* "resiliparse/parse/html.pyx":1540
  *             step = key.step if key.step is not None else 1
  * 
  *             if start is None:             # <<<<<<<<<<<<<<
  *                 start = coll_len - 1 if step < 0 else 0
  *             else:
  */
     __pyx_t_3 = (__pyx_v_start == Py_None);
     __pyx_t_1 = (__pyx_t_3 != 0);
     if (__pyx_t_1) {
 
-      /* "resiliparse/parse/html.pyx":1495
+      /* "resiliparse/parse/html.pyx":1541
  * 
  *             if start is None:
  *                 start = coll_len - 1 if step < 0 else 0             # <<<<<<<<<<<<<<
  *             else:
  *                 start = self._wrap_idx(min(start, coll_len - 1))
  */
-      __pyx_t_5 = PyObject_RichCompare(__pyx_v_step, __pyx_int_0, Py_LT); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1495, __pyx_L1_error)
-      __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 1495, __pyx_L1_error)
+      __pyx_t_5 = PyObject_RichCompare(__pyx_v_step, __pyx_int_0, Py_LT); __Pyx_XGOTREF(__pyx_t_5); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1541, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_5); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 1541, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
       if (__pyx_t_1) {
-        __pyx_t_5 = __Pyx_PyInt_FromSize_t((__pyx_v_coll_len - 1)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1495, __pyx_L1_error)
+        __pyx_t_5 = __Pyx_PyInt_FromSize_t((__pyx_v_coll_len - 1)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1541, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_5);
         __pyx_t_4 = __pyx_t_5;
         __pyx_t_5 = 0;
       } else {
         __Pyx_INCREF(__pyx_int_0);
         __pyx_t_4 = __pyx_int_0;
       }
       __Pyx_DECREF_SET(__pyx_v_start, __pyx_t_4);
       __pyx_t_4 = 0;
 
-      /* "resiliparse/parse/html.pyx":1494
+      /* "resiliparse/parse/html.pyx":1540
  *             step = key.step if key.step is not None else 1
  * 
  *             if start is None:             # <<<<<<<<<<<<<<
  *                 start = coll_len - 1 if step < 0 else 0
  *             else:
  */
       goto __pyx_L7;
     }
 
-    /* "resiliparse/parse/html.pyx":1497
+    /* "resiliparse/parse/html.pyx":1543
  *                 start = coll_len - 1 if step < 0 else 0
  *             else:
  *                 start = self._wrap_idx(min(start, coll_len - 1))             # <<<<<<<<<<<<<<
  * 
  *             if stop is None:
  */
     /*else*/ {
       __pyx_t_6 = (__pyx_v_coll_len - 1);
       __Pyx_INCREF(__pyx_v_start);
       __pyx_t_4 = __pyx_v_start;
-      __pyx_t_7 = __Pyx_PyInt_FromSize_t(__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1497, __pyx_L1_error)
+      __pyx_t_7 = __Pyx_PyInt_FromSize_t(__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1543, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_7);
-      __pyx_t_8 = PyObject_RichCompare(__pyx_t_7, __pyx_t_4, Py_LT); __Pyx_XGOTREF(__pyx_t_8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1497, __pyx_L1_error)
+      __pyx_t_8 = PyObject_RichCompare(__pyx_t_7, __pyx_t_4, Py_LT); __Pyx_XGOTREF(__pyx_t_8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1543, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-      __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 1497, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 1543, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
       if (__pyx_t_1) {
-        __pyx_t_8 = __Pyx_PyInt_FromSize_t(__pyx_t_6); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1497, __pyx_L1_error)
+        __pyx_t_8 = __Pyx_PyInt_FromSize_t(__pyx_t_6); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1543, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_8);
         __pyx_t_5 = __pyx_t_8;
         __pyx_t_8 = 0;
       } else {
         __Pyx_INCREF(__pyx_t_4);
         __pyx_t_5 = __pyx_t_4;
       }
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-      __pyx_t_9 = PyInt_AsSsize_t(__pyx_t_5); if (unlikely((__pyx_t_9 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 1497, __pyx_L1_error)
+      __pyx_t_9 = PyInt_AsSsize_t(__pyx_t_5); if (unlikely((__pyx_t_9 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 1543, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-      __pyx_t_5 = __Pyx_PyInt_FromSize_t(__pyx_f_11resiliparse_5parse_4html_13DOMCollection__wrap_idx(__pyx_v_self, __pyx_t_9)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1497, __pyx_L1_error)
+      __pyx_t_5 = __Pyx_PyInt_FromSize_t(__pyx_f_11resiliparse_5parse_4html_13DOMCollection__wrap_idx(__pyx_v_self, __pyx_t_9)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1543, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_5);
       __Pyx_DECREF_SET(__pyx_v_start, __pyx_t_5);
       __pyx_t_5 = 0;
     }
     __pyx_L7:;
 
-    /* "resiliparse/parse/html.pyx":1499
+    /* "resiliparse/parse/html.pyx":1545
  *                 start = self._wrap_idx(min(start, coll_len - 1))
  * 
  *             if stop is None:             # <<<<<<<<<<<<<<
  *                 stop = -1 if step < 0 else coll_len
  *             else:
  */
     __pyx_t_1 = (__pyx_v_stop == Py_None);
     __pyx_t_3 = (__pyx_t_1 != 0);
     if (__pyx_t_3) {
 
-      /* "resiliparse/parse/html.pyx":1500
+      /* "resiliparse/parse/html.pyx":1546
  * 
  *             if stop is None:
  *                 stop = -1 if step < 0 else coll_len             # <<<<<<<<<<<<<<
  *             else:
  *                 stop = self._wrap_idx(min(stop, coll_len))
  */
-      __pyx_t_4 = PyObject_RichCompare(__pyx_v_step, __pyx_int_0, Py_LT); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1500, __pyx_L1_error)
-      __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 1500, __pyx_L1_error)
+      __pyx_t_4 = PyObject_RichCompare(__pyx_v_step, __pyx_int_0, Py_LT); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1546, __pyx_L1_error)
+      __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 1546, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
       if (__pyx_t_3) {
         __Pyx_INCREF(__pyx_int_neg_1);
         __pyx_t_5 = __pyx_int_neg_1;
       } else {
-        __pyx_t_4 = __Pyx_PyInt_FromSize_t(__pyx_v_coll_len); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1500, __pyx_L1_error)
+        __pyx_t_4 = __Pyx_PyInt_FromSize_t(__pyx_v_coll_len); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1546, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
         __pyx_t_5 = __pyx_t_4;
         __pyx_t_4 = 0;
       }
       __Pyx_DECREF_SET(__pyx_v_stop, __pyx_t_5);
       __pyx_t_5 = 0;
 
-      /* "resiliparse/parse/html.pyx":1499
+      /* "resiliparse/parse/html.pyx":1545
  *                 start = self._wrap_idx(min(start, coll_len - 1))
  * 
  *             if stop is None:             # <<<<<<<<<<<<<<
  *                 stop = -1 if step < 0 else coll_len
  *             else:
  */
       goto __pyx_L8;
     }
 
-    /* "resiliparse/parse/html.pyx":1502
+    /* "resiliparse/parse/html.pyx":1548
  *                 stop = -1 if step < 0 else coll_len
  *             else:
  *                 stop = self._wrap_idx(min(stop, coll_len))             # <<<<<<<<<<<<<<
  * 
  *             dom_coll = lxb_dom_collection_make(self.coll.document,
  */
     /*else*/ {
       __pyx_t_6 = __pyx_v_coll_len;
       __Pyx_INCREF(__pyx_v_stop);
       __pyx_t_5 = __pyx_v_stop;
-      __pyx_t_8 = __Pyx_PyInt_FromSize_t(__pyx_t_6); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1502, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyInt_FromSize_t(__pyx_t_6); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1548, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
-      __pyx_t_7 = PyObject_RichCompare(__pyx_t_8, __pyx_t_5, Py_LT); __Pyx_XGOTREF(__pyx_t_7); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1502, __pyx_L1_error)
+      __pyx_t_7 = PyObject_RichCompare(__pyx_t_8, __pyx_t_5, Py_LT); __Pyx_XGOTREF(__pyx_t_7); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1548, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
-      __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 1502, __pyx_L1_error)
+      __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_7); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 1548, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
       if (__pyx_t_3) {
-        __pyx_t_7 = __Pyx_PyInt_FromSize_t(__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1502, __pyx_L1_error)
+        __pyx_t_7 = __Pyx_PyInt_FromSize_t(__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1548, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_7);
         __pyx_t_4 = __pyx_t_7;
         __pyx_t_7 = 0;
       } else {
         __Pyx_INCREF(__pyx_t_5);
         __pyx_t_4 = __pyx_t_5;
       }
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-      __pyx_t_9 = PyInt_AsSsize_t(__pyx_t_4); if (unlikely((__pyx_t_9 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 1502, __pyx_L1_error)
+      __pyx_t_9 = PyInt_AsSsize_t(__pyx_t_4); if (unlikely((__pyx_t_9 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 1548, __pyx_L1_error)
       __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-      __pyx_t_4 = __Pyx_PyInt_FromSize_t(__pyx_f_11resiliparse_5parse_4html_13DOMCollection__wrap_idx(__pyx_v_self, __pyx_t_9)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1502, __pyx_L1_error)
+      __pyx_t_4 = __Pyx_PyInt_FromSize_t(__pyx_f_11resiliparse_5parse_4html_13DOMCollection__wrap_idx(__pyx_v_self, __pyx_t_9)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1548, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
       __Pyx_DECREF_SET(__pyx_v_stop, __pyx_t_4);
       __pyx_t_4 = 0;
     }
     __pyx_L8:;
 
-    /* "resiliparse/parse/html.pyx":1505
+    /* "resiliparse/parse/html.pyx":1551
  * 
  *             dom_coll = lxb_dom_collection_make(self.coll.document,
  *                                                min(coll_len, abs((stop - start) // step) + 1))             # <<<<<<<<<<<<<<
  *             for i in range(start, stop, step):
  *                 lxb_dom_collection_append(dom_coll, lxb_dom_collection_element(self.coll, i))
  */
-    __pyx_t_4 = PyNumber_Subtract(__pyx_v_stop, __pyx_v_start); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1505, __pyx_L1_error)
+    __pyx_t_4 = PyNumber_Subtract(__pyx_v_stop, __pyx_v_start); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1551, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    __pyx_t_5 = PyNumber_FloorDivide(__pyx_t_4, __pyx_v_step); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1505, __pyx_L1_error)
+    __pyx_t_5 = PyNumber_FloorDivide(__pyx_t_4, __pyx_v_step); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1551, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __pyx_t_4 = __Pyx_PyNumber_Absolute(__pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1505, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyNumber_Absolute(__pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1551, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __pyx_t_5 = __Pyx_PyInt_AddObjC(__pyx_t_4, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1505, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyInt_AddObjC(__pyx_t_4, __pyx_int_1, 1, 0, 0); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1551, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __pyx_t_6 = __pyx_v_coll_len;
-    __pyx_t_7 = __Pyx_PyInt_FromSize_t(__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1505, __pyx_L1_error)
+    __pyx_t_7 = __Pyx_PyInt_FromSize_t(__pyx_t_6); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1551, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_7);
-    __pyx_t_8 = PyObject_RichCompare(__pyx_t_5, __pyx_t_7, Py_LT); __Pyx_XGOTREF(__pyx_t_8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1505, __pyx_L1_error)
+    __pyx_t_8 = PyObject_RichCompare(__pyx_t_5, __pyx_t_7, Py_LT); __Pyx_XGOTREF(__pyx_t_8); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1551, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
-    __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 1505, __pyx_L1_error)
+    __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_t_8); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 1551, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_8); __pyx_t_8 = 0;
     if (__pyx_t_3) {
       __Pyx_INCREF(__pyx_t_5);
       __pyx_t_4 = __pyx_t_5;
     } else {
-      __pyx_t_8 = __Pyx_PyInt_FromSize_t(__pyx_t_6); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1505, __pyx_L1_error)
+      __pyx_t_8 = __Pyx_PyInt_FromSize_t(__pyx_t_6); if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 1551, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_8);
       __pyx_t_4 = __pyx_t_8;
       __pyx_t_8 = 0;
     }
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __pyx_t_6 = __Pyx_PyInt_As_size_t(__pyx_t_4); if (unlikely((__pyx_t_6 == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 1505, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyInt_As_size_t(__pyx_t_4); if (unlikely((__pyx_t_6 == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 1551, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-    /* "resiliparse/parse/html.pyx":1504
+    /* "resiliparse/parse/html.pyx":1550
  *                 stop = self._wrap_idx(min(stop, coll_len))
  * 
  *             dom_coll = lxb_dom_collection_make(self.coll.document,             # <<<<<<<<<<<<<<
  *                                                min(coll_len, abs((stop - start) // step) + 1))
  *             for i in range(start, stop, step):
  */
     __pyx_v_dom_coll = lxb_dom_collection_make(__pyx_v_self->coll->document, __pyx_t_6);
 
-    /* "resiliparse/parse/html.pyx":1506
+    /* "resiliparse/parse/html.pyx":1552
  *             dom_coll = lxb_dom_collection_make(self.coll.document,
  *                                                min(coll_len, abs((stop - start) // step) + 1))
  *             for i in range(start, stop, step):             # <<<<<<<<<<<<<<
  *                 lxb_dom_collection_append(dom_coll, lxb_dom_collection_element(self.coll, i))
  * 
  */
-    __pyx_t_4 = PyTuple_New(3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1506, __pyx_L1_error)
+    __pyx_t_4 = PyTuple_New(3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1552, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_INCREF(__pyx_v_start);
     __Pyx_GIVEREF(__pyx_v_start);
     PyTuple_SET_ITEM(__pyx_t_4, 0, __pyx_v_start);
     __Pyx_INCREF(__pyx_v_stop);
     __Pyx_GIVEREF(__pyx_v_stop);
     PyTuple_SET_ITEM(__pyx_t_4, 1, __pyx_v_stop);
     __Pyx_INCREF(__pyx_v_step);
     __Pyx_GIVEREF(__pyx_v_step);
     PyTuple_SET_ITEM(__pyx_t_4, 2, __pyx_v_step);
-    __pyx_t_5 = __Pyx_PyObject_Call(__pyx_builtin_range, __pyx_t_4, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1506, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_Call(__pyx_builtin_range, __pyx_t_4, NULL); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1552, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     if (likely(PyList_CheckExact(__pyx_t_5)) || PyTuple_CheckExact(__pyx_t_5)) {
       __pyx_t_4 = __pyx_t_5; __Pyx_INCREF(__pyx_t_4); __pyx_t_10 = 0;
       __pyx_t_11 = NULL;
     } else {
-      __pyx_t_10 = -1; __pyx_t_4 = PyObject_GetIter(__pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1506, __pyx_L1_error)
+      __pyx_t_10 = -1; __pyx_t_4 = PyObject_GetIter(__pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1552, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_4);
-      __pyx_t_11 = Py_TYPE(__pyx_t_4)->tp_iternext; if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1506, __pyx_L1_error)
+      __pyx_t_11 = Py_TYPE(__pyx_t_4)->tp_iternext; if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 1552, __pyx_L1_error)
     }
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
     for (;;) {
       if (likely(!__pyx_t_11)) {
         if (likely(PyList_CheckExact(__pyx_t_4))) {
           if (__pyx_t_10 >= PyList_GET_SIZE(__pyx_t_4)) break;
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-          __pyx_t_5 = PyList_GET_ITEM(__pyx_t_4, __pyx_t_10); __Pyx_INCREF(__pyx_t_5); __pyx_t_10++; if (unlikely(0 < 0)) __PYX_ERR(0, 1506, __pyx_L1_error)
+          __pyx_t_5 = PyList_GET_ITEM(__pyx_t_4, __pyx_t_10); __Pyx_INCREF(__pyx_t_5); __pyx_t_10++; if (unlikely(0 < 0)) __PYX_ERR(0, 1552, __pyx_L1_error)
           #else
-          __pyx_t_5 = PySequence_ITEM(__pyx_t_4, __pyx_t_10); __pyx_t_10++; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1506, __pyx_L1_error)
+          __pyx_t_5 = PySequence_ITEM(__pyx_t_4, __pyx_t_10); __pyx_t_10++; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1552, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_5);
           #endif
         } else {
           if (__pyx_t_10 >= PyTuple_GET_SIZE(__pyx_t_4)) break;
           #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-          __pyx_t_5 = PyTuple_GET_ITEM(__pyx_t_4, __pyx_t_10); __Pyx_INCREF(__pyx_t_5); __pyx_t_10++; if (unlikely(0 < 0)) __PYX_ERR(0, 1506, __pyx_L1_error)
+          __pyx_t_5 = PyTuple_GET_ITEM(__pyx_t_4, __pyx_t_10); __Pyx_INCREF(__pyx_t_5); __pyx_t_10++; if (unlikely(0 < 0)) __PYX_ERR(0, 1552, __pyx_L1_error)
           #else
-          __pyx_t_5 = PySequence_ITEM(__pyx_t_4, __pyx_t_10); __pyx_t_10++; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1506, __pyx_L1_error)
+          __pyx_t_5 = PySequence_ITEM(__pyx_t_4, __pyx_t_10); __pyx_t_10++; if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1552, __pyx_L1_error)
           __Pyx_GOTREF(__pyx_t_5);
           #endif
         }
       } else {
         __pyx_t_5 = __pyx_t_11(__pyx_t_4);
         if (unlikely(!__pyx_t_5)) {
           PyObject* exc_type = PyErr_Occurred();
           if (exc_type) {
             if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-            else __PYX_ERR(0, 1506, __pyx_L1_error)
+            else __PYX_ERR(0, 1552, __pyx_L1_error)
           }
           break;
         }
         __Pyx_GOTREF(__pyx_t_5);
       }
       __Pyx_XDECREF_SET(__pyx_v_i, __pyx_t_5);
       __pyx_t_5 = 0;
 
-      /* "resiliparse/parse/html.pyx":1507
+      /* "resiliparse/parse/html.pyx":1553
  *                                                min(coll_len, abs((stop - start) // step) + 1))
  *             for i in range(start, stop, step):
  *                 lxb_dom_collection_append(dom_coll, lxb_dom_collection_element(self.coll, i))             # <<<<<<<<<<<<<<
  * 
  *             slice_coll = DOMCollection.__new__(DOMCollection, self.tree)
  */
-      __pyx_t_6 = __Pyx_PyInt_As_size_t(__pyx_v_i); if (unlikely((__pyx_t_6 == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 1507, __pyx_L1_error)
+      __pyx_t_6 = __Pyx_PyInt_As_size_t(__pyx_v_i); if (unlikely((__pyx_t_6 == (size_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 1553, __pyx_L1_error)
       (void)(lxb_dom_collection_append(__pyx_v_dom_coll, lxb_dom_collection_element(__pyx_v_self->coll, __pyx_t_6)));
 
-      /* "resiliparse/parse/html.pyx":1506
+      /* "resiliparse/parse/html.pyx":1552
  *             dom_coll = lxb_dom_collection_make(self.coll.document,
  *                                                min(coll_len, abs((stop - start) // step) + 1))
  *             for i in range(start, stop, step):             # <<<<<<<<<<<<<<
  *                 lxb_dom_collection_append(dom_coll, lxb_dom_collection_element(self.coll, i))
  * 
  */
     }
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
 
-    /* "resiliparse/parse/html.pyx":1509
+    /* "resiliparse/parse/html.pyx":1555
  *                 lxb_dom_collection_append(dom_coll, lxb_dom_collection_element(self.coll, i))
  * 
  *             slice_coll = DOMCollection.__new__(DOMCollection, self.tree)             # <<<<<<<<<<<<<<
  *             slice_coll.coll = dom_coll
  *             return slice_coll
  */
-    __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1509, __pyx_L1_error)
+    __pyx_t_4 = PyTuple_New(1); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1555, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_INCREF(((PyObject *)__pyx_v_self->tree));
     __Pyx_GIVEREF(((PyObject *)__pyx_v_self->tree));
     PyTuple_SET_ITEM(__pyx_t_4, 0, ((PyObject *)__pyx_v_self->tree));
-    __pyx_t_5 = ((PyObject *)__pyx_tp_new_11resiliparse_5parse_4html_DOMCollection(((PyTypeObject *)__pyx_ptype_11resiliparse_5parse_4html_DOMCollection), __pyx_t_4, NULL)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1509, __pyx_L1_error)
+    __pyx_t_5 = ((PyObject *)__pyx_tp_new_11resiliparse_5parse_4html_DOMCollection(((PyTypeObject *)__pyx_ptype_11resiliparse_5parse_4html_DOMCollection), __pyx_t_4, NULL)); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1555, __pyx_L1_error)
     __Pyx_GOTREF(((PyObject *)__pyx_t_5));
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __pyx_v_slice_coll = ((struct __pyx_obj_11resiliparse_5parse_4html_DOMCollection *)__pyx_t_5);
     __pyx_t_5 = 0;
 
-    /* "resiliparse/parse/html.pyx":1510
+    /* "resiliparse/parse/html.pyx":1556
  * 
  *             slice_coll = DOMCollection.__new__(DOMCollection, self.tree)
  *             slice_coll.coll = dom_coll             # <<<<<<<<<<<<<<
  *             return slice_coll
  * 
  */
     __pyx_v_slice_coll->coll = __pyx_v_dom_coll;
 
-    /* "resiliparse/parse/html.pyx":1511
+    /* "resiliparse/parse/html.pyx":1557
  *             slice_coll = DOMCollection.__new__(DOMCollection, self.tree)
  *             slice_coll.coll = dom_coll
  *             return slice_coll             # <<<<<<<<<<<<<<
  * 
  *         if type(key) is not int:
  */
     __Pyx_XDECREF(__pyx_r);
     __Pyx_INCREF(((PyObject *)__pyx_v_slice_coll));
     __pyx_r = ((PyObject *)__pyx_v_slice_coll);
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":1489
+    /* "resiliparse/parse/html.pyx":1535
  *         cdef DOMCollection slice_coll
  *         cdef lxb_dom_collection_t* dom_coll
  *         if isinstance(key, slice):             # <<<<<<<<<<<<<<
  *             start = key.start
  *             stop = key.stop
  */
   }
 
-  /* "resiliparse/parse/html.pyx":1513
+  /* "resiliparse/parse/html.pyx":1559
  *             return slice_coll
  * 
  *         if type(key) is not int:             # <<<<<<<<<<<<<<
  *             raise TypeError(f'Invalid key type: {type(key)}')
  * 
  */
   __pyx_t_3 = (((PyObject *)Py_TYPE(__pyx_v_key)) != ((PyObject *)(&PyInt_Type)));
   __pyx_t_1 = (__pyx_t_3 != 0);
   if (unlikely(__pyx_t_1)) {
 
-    /* "resiliparse/parse/html.pyx":1514
+    /* "resiliparse/parse/html.pyx":1560
  * 
  *         if type(key) is not int:
  *             raise TypeError(f'Invalid key type: {type(key)}')             # <<<<<<<<<<<<<<
  * 
  *         if key >= coll_len:
  */
-    __pyx_t_5 = __Pyx_PyObject_FormatSimple(((PyObject *)Py_TYPE(__pyx_v_key)), __pyx_empty_unicode); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1514, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_FormatSimple(((PyObject *)Py_TYPE(__pyx_v_key)), __pyx_empty_unicode); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1560, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
-    __pyx_t_4 = __Pyx_PyUnicode_Concat(__pyx_kp_u_Invalid_key_type, __pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1514, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyUnicode_Concat(__pyx_kp_u_Invalid_key_type, __pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1560, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __pyx_t_5 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1514, __pyx_L1_error)
+    __pyx_t_5 = __Pyx_PyObject_CallOneArg(__pyx_builtin_TypeError, __pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1560, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_5);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
     __Pyx_Raise(__pyx_t_5, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    __PYX_ERR(0, 1514, __pyx_L1_error)
+    __PYX_ERR(0, 1560, __pyx_L1_error)
 
-    /* "resiliparse/parse/html.pyx":1513
+    /* "resiliparse/parse/html.pyx":1559
  *             return slice_coll
  * 
  *         if type(key) is not int:             # <<<<<<<<<<<<<<
  *             raise TypeError(f'Invalid key type: {type(key)}')
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":1516
+  /* "resiliparse/parse/html.pyx":1562
  *             raise TypeError(f'Invalid key type: {type(key)}')
  * 
  *         if key >= coll_len:             # <<<<<<<<<<<<<<
  *             raise IndexError('Index out of range')
  * 
  */
-  __pyx_t_5 = __Pyx_PyInt_FromSize_t(__pyx_v_coll_len); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1516, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyInt_FromSize_t(__pyx_v_coll_len); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1562, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_4 = PyObject_RichCompare(__pyx_v_key, __pyx_t_5, Py_GE); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1516, __pyx_L1_error)
+  __pyx_t_4 = PyObject_RichCompare(__pyx_v_key, __pyx_t_5, Py_GE); __Pyx_XGOTREF(__pyx_t_4); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1562, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 1516, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_IsTrue(__pyx_t_4); if (unlikely(__pyx_t_1 < 0)) __PYX_ERR(0, 1562, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   if (unlikely(__pyx_t_1)) {
 
-    /* "resiliparse/parse/html.pyx":1517
+    /* "resiliparse/parse/html.pyx":1563
  * 
  *         if key >= coll_len:
  *             raise IndexError('Index out of range')             # <<<<<<<<<<<<<<
  * 
  *         return _create_dom_node(self.tree, lxb_dom_collection_node(self.coll, self._wrap_idx(key)))
  */
-    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_builtin_IndexError, __pyx_tuple__27, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1517, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_builtin_IndexError, __pyx_tuple__30, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1563, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_Raise(__pyx_t_4, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __PYX_ERR(0, 1517, __pyx_L1_error)
+    __PYX_ERR(0, 1563, __pyx_L1_error)
 
-    /* "resiliparse/parse/html.pyx":1516
+    /* "resiliparse/parse/html.pyx":1562
  *             raise TypeError(f'Invalid key type: {type(key)}')
  * 
  *         if key >= coll_len:             # <<<<<<<<<<<<<<
  *             raise IndexError('Index out of range')
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":1519
+  /* "resiliparse/parse/html.pyx":1565
  *             raise IndexError('Index out of range')
  * 
  *         return _create_dom_node(self.tree, lxb_dom_collection_node(self.coll, self._wrap_idx(key)))             # <<<<<<<<<<<<<<
  * 
  *     def __repr__(self):
  */
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_4 = ((PyObject *)__pyx_v_self->tree);
   __Pyx_INCREF(__pyx_t_4);
-  __pyx_t_9 = PyInt_AsSsize_t(__pyx_v_key); if (unlikely((__pyx_t_9 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 1519, __pyx_L1_error)
-  __pyx_t_5 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html__create_dom_node(((struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *)__pyx_t_4), lxb_dom_collection_node(__pyx_v_self->coll, __pyx_f_11resiliparse_5parse_4html_13DOMCollection__wrap_idx(__pyx_v_self, __pyx_t_9)))); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1519, __pyx_L1_error)
+  __pyx_t_9 = PyInt_AsSsize_t(__pyx_v_key); if (unlikely((__pyx_t_9 == (Py_ssize_t)-1) && PyErr_Occurred())) __PYX_ERR(0, 1565, __pyx_L1_error)
+  __pyx_t_5 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html__create_dom_node(((struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *)__pyx_t_4), lxb_dom_collection_node(__pyx_v_self->coll, __pyx_f_11resiliparse_5parse_4html_13DOMCollection__wrap_idx(__pyx_v_self, __pyx_t_9)))); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1565, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   __pyx_r = __pyx_t_5;
   __pyx_t_5 = 0;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":1470
+  /* "resiliparse/parse/html.pyx":1516
  *         return lxb_dom_collection_length(self.coll)
  * 
  *     def __getitem__(self, key):             # <<<<<<<<<<<<<<
  *         """
  *         __getitem__(self, key)
  */
 
@@ -19671,15 +20274,15 @@
   __Pyx_XDECREF(__pyx_v_step);
   __Pyx_XDECREF(__pyx_v_i);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":1521
+/* "resiliparse/parse/html.pyx":1567
  *         return _create_dom_node(self.tree, lxb_dom_collection_node(self.coll, self._wrap_idx(key)))
  * 
  *     def __repr__(self):             # <<<<<<<<<<<<<<
  *         return f'{{{", ".join(repr(n) for n in self)}}}'
  * 
  */
 
@@ -19693,15 +20296,15 @@
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 static PyObject *__pyx_gb_11resiliparse_5parse_4html_13DOMCollection_8__repr___2generator3(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value); /* proto */
 
-/* "resiliparse/parse/html.pyx":1522
+/* "resiliparse/parse/html.pyx":1568
  * 
  *     def __repr__(self):
  *         return f'{{{", ".join(repr(n) for n in self)}}}'             # <<<<<<<<<<<<<<
  * 
  *     def __str__(self):
  */
 
@@ -19713,23 +20316,23 @@
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("genexpr", 0);
   __pyx_cur_scope = (struct __pyx_obj_11resiliparse_5parse_4html___pyx_scope_struct_5_genexpr *)__pyx_tp_new_11resiliparse_5parse_4html___pyx_scope_struct_5_genexpr(__pyx_ptype_11resiliparse_5parse_4html___pyx_scope_struct_5_genexpr, __pyx_empty_tuple, NULL);
   if (unlikely(!__pyx_cur_scope)) {
     __pyx_cur_scope = ((struct __pyx_obj_11resiliparse_5parse_4html___pyx_scope_struct_5_genexpr *)Py_None);
     __Pyx_INCREF(Py_None);
-    __PYX_ERR(0, 1522, __pyx_L1_error)
+    __PYX_ERR(0, 1568, __pyx_L1_error)
   } else {
     __Pyx_GOTREF(__pyx_cur_scope);
   }
   __pyx_cur_scope->__pyx_outer_scope = (struct __pyx_obj_11resiliparse_5parse_4html___pyx_scope_struct_4___repr__ *) __pyx_self;
   __Pyx_INCREF(((PyObject *)__pyx_cur_scope->__pyx_outer_scope));
   __Pyx_GIVEREF(__pyx_cur_scope->__pyx_outer_scope);
   {
-    __pyx_CoroutineObject *gen = __Pyx_Generator_New((__pyx_coroutine_body_t) __pyx_gb_11resiliparse_5parse_4html_13DOMCollection_8__repr___2generator3, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_genexpr, __pyx_n_s_repr___locals_genexpr, __pyx_n_s_resiliparse_parse_html); if (unlikely(!gen)) __PYX_ERR(0, 1522, __pyx_L1_error)
+    __pyx_CoroutineObject *gen = __Pyx_Generator_New((__pyx_coroutine_body_t) __pyx_gb_11resiliparse_5parse_4html_13DOMCollection_8__repr___2generator3, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_genexpr, __pyx_n_s_repr___locals_genexpr, __pyx_n_s_resiliparse_parse_html); if (unlikely(!gen)) __PYX_ERR(0, 1568, __pyx_L1_error)
     __Pyx_DECREF(__pyx_cur_scope);
     __Pyx_RefNannyFinishContext();
     return (PyObject *) gen;
   }
 
   /* function exit code */
   __pyx_L1_error:;
@@ -19757,64 +20360,64 @@
   switch (__pyx_generator->resume_label) {
     case 0: goto __pyx_L3_first_run;
     default: /* CPython raises the right error here */
     __Pyx_RefNannyFinishContext();
     return NULL;
   }
   __pyx_L3_first_run:;
-  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1522, __pyx_L1_error)
-  __pyx_r = PyList_New(0); if (unlikely(!__pyx_r)) __PYX_ERR(0, 1522, __pyx_L1_error)
+  if (unlikely(!__pyx_sent_value)) __PYX_ERR(0, 1568, __pyx_L1_error)
+  __pyx_r = PyList_New(0); if (unlikely(!__pyx_r)) __PYX_ERR(0, 1568, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_r);
-  if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_self)) { __Pyx_RaiseClosureNameError("self"); __PYX_ERR(0, 1522, __pyx_L1_error) }
+  if (unlikely(!__pyx_cur_scope->__pyx_outer_scope->__pyx_v_self)) { __Pyx_RaiseClosureNameError("self"); __PYX_ERR(0, 1568, __pyx_L1_error) }
   if (likely(PyList_CheckExact(((PyObject *)__pyx_cur_scope->__pyx_outer_scope->__pyx_v_self))) || PyTuple_CheckExact(((PyObject *)__pyx_cur_scope->__pyx_outer_scope->__pyx_v_self))) {
     __pyx_t_1 = ((PyObject *)__pyx_cur_scope->__pyx_outer_scope->__pyx_v_self); __Pyx_INCREF(__pyx_t_1); __pyx_t_2 = 0;
     __pyx_t_3 = NULL;
   } else {
-    __pyx_t_2 = -1; __pyx_t_1 = PyObject_GetIter(((PyObject *)__pyx_cur_scope->__pyx_outer_scope->__pyx_v_self)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1522, __pyx_L1_error)
+    __pyx_t_2 = -1; __pyx_t_1 = PyObject_GetIter(((PyObject *)__pyx_cur_scope->__pyx_outer_scope->__pyx_v_self)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1568, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
-    __pyx_t_3 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1522, __pyx_L1_error)
+    __pyx_t_3 = Py_TYPE(__pyx_t_1)->tp_iternext; if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1568, __pyx_L1_error)
   }
   for (;;) {
     if (likely(!__pyx_t_3)) {
       if (likely(PyList_CheckExact(__pyx_t_1))) {
         if (__pyx_t_2 >= PyList_GET_SIZE(__pyx_t_1)) break;
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_4 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 1522, __pyx_L1_error)
+        __pyx_t_4 = PyList_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 1568, __pyx_L1_error)
         #else
-        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1522, __pyx_L1_error)
+        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1568, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
         #endif
       } else {
         if (__pyx_t_2 >= PyTuple_GET_SIZE(__pyx_t_1)) break;
         #if CYTHON_ASSUME_SAFE_MACROS && !CYTHON_AVOID_BORROWED_REFS
-        __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 1522, __pyx_L1_error)
+        __pyx_t_4 = PyTuple_GET_ITEM(__pyx_t_1, __pyx_t_2); __Pyx_INCREF(__pyx_t_4); __pyx_t_2++; if (unlikely(0 < 0)) __PYX_ERR(0, 1568, __pyx_L1_error)
         #else
-        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1522, __pyx_L1_error)
+        __pyx_t_4 = PySequence_ITEM(__pyx_t_1, __pyx_t_2); __pyx_t_2++; if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1568, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_4);
         #endif
       }
     } else {
       __pyx_t_4 = __pyx_t_3(__pyx_t_1);
       if (unlikely(!__pyx_t_4)) {
         PyObject* exc_type = PyErr_Occurred();
         if (exc_type) {
           if (likely(__Pyx_PyErr_GivenExceptionMatches(exc_type, PyExc_StopIteration))) PyErr_Clear();
-          else __PYX_ERR(0, 1522, __pyx_L1_error)
+          else __PYX_ERR(0, 1568, __pyx_L1_error)
         }
         break;
       }
       __Pyx_GOTREF(__pyx_t_4);
     }
     __Pyx_XGOTREF(__pyx_cur_scope->__pyx_v_n);
     __Pyx_XDECREF_SET(__pyx_cur_scope->__pyx_v_n, __pyx_t_4);
     __Pyx_GIVEREF(__pyx_t_4);
     __pyx_t_4 = 0;
-    __pyx_t_4 = PyObject_Repr(__pyx_cur_scope->__pyx_v_n); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1522, __pyx_L1_error)
+    __pyx_t_4 = PyObject_Repr(__pyx_cur_scope->__pyx_v_n); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1568, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
-    if (unlikely(__Pyx_ListComp_Append(__pyx_r, (PyObject*)__pyx_t_4))) __PYX_ERR(0, 1522, __pyx_L1_error)
+    if (unlikely(__Pyx_ListComp_Append(__pyx_r, (PyObject*)__pyx_t_4))) __PYX_ERR(0, 1568, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
   }
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   CYTHON_MAYBE_UNUSED_VAR(__pyx_cur_scope);
 
   /* function exit code */
   goto __pyx_L0;
@@ -19830,15 +20433,15 @@
   #endif
   __pyx_generator->resume_label = -1;
   __Pyx_Coroutine_clear((PyObject*)__pyx_generator);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":1521
+/* "resiliparse/parse/html.pyx":1567
  *         return _create_dom_node(self.tree, lxb_dom_collection_node(self.coll, self._wrap_idx(key)))
  * 
  *     def __repr__(self):             # <<<<<<<<<<<<<<
  *         return f'{{{", ".join(repr(n) for n in self)}}}'
  * 
  */
 
@@ -19856,63 +20459,63 @@
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__repr__", 0);
   __pyx_cur_scope = (struct __pyx_obj_11resiliparse_5parse_4html___pyx_scope_struct_4___repr__ *)__pyx_tp_new_11resiliparse_5parse_4html___pyx_scope_struct_4___repr__(__pyx_ptype_11resiliparse_5parse_4html___pyx_scope_struct_4___repr__, __pyx_empty_tuple, NULL);
   if (unlikely(!__pyx_cur_scope)) {
     __pyx_cur_scope = ((struct __pyx_obj_11resiliparse_5parse_4html___pyx_scope_struct_4___repr__ *)Py_None);
     __Pyx_INCREF(Py_None);
-    __PYX_ERR(0, 1521, __pyx_L1_error)
+    __PYX_ERR(0, 1567, __pyx_L1_error)
   } else {
     __Pyx_GOTREF(__pyx_cur_scope);
   }
   __pyx_cur_scope->__pyx_v_self = __pyx_v_self;
   __Pyx_INCREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
   __Pyx_GIVEREF((PyObject *)__pyx_cur_scope->__pyx_v_self);
 
-  /* "resiliparse/parse/html.pyx":1522
+  /* "resiliparse/parse/html.pyx":1568
  * 
  *     def __repr__(self):
  *         return f'{{{", ".join(repr(n) for n in self)}}}'             # <<<<<<<<<<<<<<
  * 
  *     def __str__(self):
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1522, __pyx_L1_error)
+  __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1568, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_t_2 = 0;
   __pyx_t_3 = 127;
-  __Pyx_INCREF(__pyx_kp_u__28);
+  __Pyx_INCREF(__pyx_kp_u__31);
   __pyx_t_2 += 1;
-  __Pyx_GIVEREF(__pyx_kp_u__28);
-  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_u__28);
-  __pyx_t_4 = __pyx_pf_11resiliparse_5parse_4html_13DOMCollection_8__repr___genexpr(((PyObject*)__pyx_cur_scope)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1522, __pyx_L1_error)
+  __Pyx_GIVEREF(__pyx_kp_u__31);
+  PyTuple_SET_ITEM(__pyx_t_1, 0, __pyx_kp_u__31);
+  __pyx_t_4 = __pyx_pf_11resiliparse_5parse_4html_13DOMCollection_8__repr___genexpr(((PyObject*)__pyx_cur_scope)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1568, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
-  __pyx_t_5 = __Pyx_Generator_Next(__pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1522, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_Generator_Next(__pyx_t_4); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1568, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-  __pyx_t_4 = PyUnicode_Join(__pyx_kp_u__29, __pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1522, __pyx_L1_error)
+  __pyx_t_4 = PyUnicode_Join(__pyx_kp_u__32, __pyx_t_5); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1568, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __pyx_t_3 = (__Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_4) > __pyx_t_3) ? __Pyx_PyUnicode_MAX_CHAR_VALUE(__pyx_t_4) : __pyx_t_3;
   __pyx_t_2 += __Pyx_PyUnicode_GET_LENGTH(__pyx_t_4);
   __Pyx_GIVEREF(__pyx_t_4);
   PyTuple_SET_ITEM(__pyx_t_1, 1, __pyx_t_4);
   __pyx_t_4 = 0;
-  __Pyx_INCREF(__pyx_kp_u__30);
+  __Pyx_INCREF(__pyx_kp_u__33);
   __pyx_t_2 += 1;
-  __Pyx_GIVEREF(__pyx_kp_u__30);
-  PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_kp_u__30);
-  __pyx_t_4 = __Pyx_PyUnicode_Join(__pyx_t_1, 3, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1522, __pyx_L1_error)
+  __Pyx_GIVEREF(__pyx_kp_u__33);
+  PyTuple_SET_ITEM(__pyx_t_1, 2, __pyx_kp_u__33);
+  __pyx_t_4 = __Pyx_PyUnicode_Join(__pyx_t_1, 3, __pyx_t_2, __pyx_t_3); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1568, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_4);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_r = __pyx_t_4;
   __pyx_t_4 = 0;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":1521
+  /* "resiliparse/parse/html.pyx":1567
  *         return _create_dom_node(self.tree, lxb_dom_collection_node(self.coll, self._wrap_idx(key)))
  * 
  *     def __repr__(self):             # <<<<<<<<<<<<<<
  *         return f'{{{", ".join(repr(n) for n in self)}}}'
  * 
  */
 
@@ -19927,15 +20530,15 @@
   __Pyx_XDECREF(__pyx_gb_11resiliparse_5parse_4html_13DOMCollection_8__repr___2generator3);
   __Pyx_DECREF(((PyObject *)__pyx_cur_scope));
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":1524
+/* "resiliparse/parse/html.pyx":1570
  *         return f'{{{", ".join(repr(n) for n in self)}}}'
  * 
  *     def __str__(self):             # <<<<<<<<<<<<<<
  *         return self.__repr__()
  * 
  */
 
@@ -19959,44 +20562,44 @@
   PyObject *__pyx_t_2 = NULL;
   PyObject *__pyx_t_3 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__str__", 0);
 
-  /* "resiliparse/parse/html.pyx":1525
+  /* "resiliparse/parse/html.pyx":1571
  * 
  *     def __str__(self):
  *         return self.__repr__()             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_repr); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1525, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_repr); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1571, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_t_3 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_2))) {
     __pyx_t_3 = PyMethod_GET_SELF(__pyx_t_2);
     if (likely(__pyx_t_3)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_2);
       __Pyx_INCREF(__pyx_t_3);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_2, function);
     }
   }
   __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_CallOneArg(__pyx_t_2, __pyx_t_3) : __Pyx_PyObject_CallNoArg(__pyx_t_2);
   __Pyx_XDECREF(__pyx_t_3); __pyx_t_3 = 0;
-  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1525, __pyx_L1_error)
+  if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1571, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":1524
+  /* "resiliparse/parse/html.pyx":1570
  *         return f'{{{", ".join(repr(n) for n in self)}}}'
  * 
  *     def __str__(self):             # <<<<<<<<<<<<<<
  *         return self.__repr__()
  * 
  */
 
@@ -20043,15 +20646,15 @@
 
   /* "(tree fragment)":2
  * def __reduce_cython__(self):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")             # <<<<<<<<<<<<<<
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  */
-  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__31, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 2, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__34, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 2, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_Raise(__pyx_t_1, 0, 0, 0);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __PYX_ERR(1, 2, __pyx_L1_error)
 
   /* "(tree fragment)":1
  * def __reduce_cython__(self):             # <<<<<<<<<<<<<<
@@ -20099,15 +20702,15 @@
   __Pyx_RefNannySetupContext("__setstate_cython__", 0);
 
   /* "(tree fragment)":4
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")             # <<<<<<<<<<<<<<
  */
-  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__32, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 4, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__35, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 4, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_Raise(__pyx_t_1, 0, 0, 0);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __PYX_ERR(1, 4, __pyx_L1_error)
 
   /* "(tree fragment)":3
  * def __reduce_cython__(self):
@@ -20122,15 +20725,15 @@
   __Pyx_AddTraceback("resiliparse.parse.html.DOMCollection.__setstate_cython__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":1528
+/* "resiliparse/parse/html.pyx":1574
  * 
  * 
  * cdef HTMLTree create_html_tree(bytes document, bint reencode=True, str encoding='utf-8', str errors='ignore'):             # <<<<<<<<<<<<<<
  *     """
  *     Create :class:`HTMLTree` instance from bytes content.
  */
 
@@ -20164,133 +20767,133 @@
         }
       }
     }
   }
   __Pyx_INCREF(__pyx_v_document);
   __Pyx_INCREF(__pyx_v_encoding);
 
-  /* "resiliparse/parse/html.pyx":1538
+  /* "resiliparse/parse/html.pyx":1584
  *     :return: :class:`HTMLTree` instance
  *     """
  *     encoding = map_encoding_to_html5(encoding)             # <<<<<<<<<<<<<<
  *     if reencode:
  *         document = bytes_to_str(document, encoding, errors).encode()
  */
-  __pyx_t_1 = __pyx_f_11resiliparse_5parse_8encoding_map_encoding_to_html5(__pyx_v_encoding, 0, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1538, __pyx_L1_error)
+  __pyx_t_1 = __pyx_f_11resiliparse_5parse_8encoding_map_encoding_to_html5(__pyx_v_encoding, 0, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1584, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF_SET(__pyx_v_encoding, ((PyObject*)__pyx_t_1));
   __pyx_t_1 = 0;
 
-  /* "resiliparse/parse/html.pyx":1539
+  /* "resiliparse/parse/html.pyx":1585
  *     """
  *     encoding = map_encoding_to_html5(encoding)
  *     if reencode:             # <<<<<<<<<<<<<<
  *         document = bytes_to_str(document, encoding, errors).encode()
  *     cdef lxb_status_t status
  */
   __pyx_t_2 = (__pyx_v_reencode != 0);
   if (__pyx_t_2) {
 
-    /* "resiliparse/parse/html.pyx":1540
+    /* "resiliparse/parse/html.pyx":1586
  *     encoding = map_encoding_to_html5(encoding)
  *     if reencode:
  *         document = bytes_to_str(document, encoding, errors).encode()             # <<<<<<<<<<<<<<
  *     cdef lxb_status_t status
  *     cdef const lxb_char_t* html = <const lxb_char_t*>document
  */
     __pyx_t_3.__pyx_n = 2;
     __pyx_t_3.encoding = __pyx_v_encoding;
     __pyx_t_3.errors = __pyx_v_errors;
-    __pyx_t_1 = __pyx_f_11resiliparse_5parse_8encoding_bytes_to_str(__pyx_v_document, 0, &__pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1540, __pyx_L1_error)
+    __pyx_t_1 = __pyx_f_11resiliparse_5parse_8encoding_bytes_to_str(__pyx_v_document, 0, &__pyx_t_3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1586, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     if (unlikely(__pyx_t_1 == Py_None)) {
       PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "encode");
-      __PYX_ERR(0, 1540, __pyx_L1_error)
+      __PYX_ERR(0, 1586, __pyx_L1_error)
     }
-    __pyx_t_4 = PyUnicode_AsEncodedString(((PyObject*)__pyx_t_1), NULL, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1540, __pyx_L1_error)
+    __pyx_t_4 = PyUnicode_AsEncodedString(((PyObject*)__pyx_t_1), NULL, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1586, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
     __Pyx_DECREF_SET(__pyx_v_document, ((PyObject*)__pyx_t_4));
     __pyx_t_4 = 0;
 
-    /* "resiliparse/parse/html.pyx":1539
+    /* "resiliparse/parse/html.pyx":1585
  *     """
  *     encoding = map_encoding_to_html5(encoding)
  *     if reencode:             # <<<<<<<<<<<<<<
  *         document = bytes_to_str(document, encoding, errors).encode()
  *     cdef lxb_status_t status
  */
   }
 
-  /* "resiliparse/parse/html.pyx":1542
+  /* "resiliparse/parse/html.pyx":1588
  *         document = bytes_to_str(document, encoding, errors).encode()
  *     cdef lxb_status_t status
  *     cdef const lxb_char_t* html = <const lxb_char_t*>document             # <<<<<<<<<<<<<<
  *     cdef size_t html_len = len(document)
  *     cdef HTMLTree tree = HTMLTree.__new__(HTMLTree)
  */
   if (unlikely(__pyx_v_document == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "expected bytes, NoneType found");
-    __PYX_ERR(0, 1542, __pyx_L1_error)
+    __PYX_ERR(0, 1588, __pyx_L1_error)
   }
-  __pyx_t_5 = __Pyx_PyBytes_AsUString(__pyx_v_document); if (unlikely((!__pyx_t_5) && PyErr_Occurred())) __PYX_ERR(0, 1542, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyBytes_AsUString(__pyx_v_document); if (unlikely((!__pyx_t_5) && PyErr_Occurred())) __PYX_ERR(0, 1588, __pyx_L1_error)
   __pyx_v_html = ((lxb_char_t const *)__pyx_t_5);
 
-  /* "resiliparse/parse/html.pyx":1543
+  /* "resiliparse/parse/html.pyx":1589
  *     cdef lxb_status_t status
  *     cdef const lxb_char_t* html = <const lxb_char_t*>document
  *     cdef size_t html_len = len(document)             # <<<<<<<<<<<<<<
  *     cdef HTMLTree tree = HTMLTree.__new__(HTMLTree)
  *     with nogil:
  */
   if (unlikely(__pyx_v_document == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-    __PYX_ERR(0, 1543, __pyx_L1_error)
+    __PYX_ERR(0, 1589, __pyx_L1_error)
   }
-  __pyx_t_6 = PyBytes_GET_SIZE(__pyx_v_document); if (unlikely(__pyx_t_6 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1543, __pyx_L1_error)
+  __pyx_t_6 = PyBytes_GET_SIZE(__pyx_v_document); if (unlikely(__pyx_t_6 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1589, __pyx_L1_error)
   __pyx_v_html_len = __pyx_t_6;
 
-  /* "resiliparse/parse/html.pyx":1544
+  /* "resiliparse/parse/html.pyx":1590
  *     cdef const lxb_char_t* html = <const lxb_char_t*>document
  *     cdef size_t html_len = len(document)
  *     cdef HTMLTree tree = HTMLTree.__new__(HTMLTree)             # <<<<<<<<<<<<<<
  *     with nogil:
  *         status = lxb_html_document_parse(tree.dom_document, html, html_len)
  */
-  __pyx_t_4 = ((PyObject *)__pyx_tp_new_11resiliparse_5parse_4html_HTMLTree(((PyTypeObject *)__pyx_ptype_11resiliparse_5parse_4html_HTMLTree), __pyx_empty_tuple, NULL)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1544, __pyx_L1_error)
+  __pyx_t_4 = ((PyObject *)__pyx_tp_new_11resiliparse_5parse_4html_HTMLTree(((PyTypeObject *)__pyx_ptype_11resiliparse_5parse_4html_HTMLTree), __pyx_empty_tuple, NULL)); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1590, __pyx_L1_error)
   __Pyx_GOTREF(((PyObject *)__pyx_t_4));
   __pyx_v_tree = ((struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *)__pyx_t_4);
   __pyx_t_4 = 0;
 
-  /* "resiliparse/parse/html.pyx":1545
+  /* "resiliparse/parse/html.pyx":1591
  *     cdef size_t html_len = len(document)
  *     cdef HTMLTree tree = HTMLTree.__new__(HTMLTree)
  *     with nogil:             # <<<<<<<<<<<<<<
  *         status = lxb_html_document_parse(tree.dom_document, html, html_len)
  *     if status != LXB_STATUS_OK:
  */
   {
       #ifdef WITH_THREAD
       PyThreadState *_save;
       Py_UNBLOCK_THREADS
       __Pyx_FastGIL_Remember();
       #endif
       /*try:*/ {
 
-        /* "resiliparse/parse/html.pyx":1546
+        /* "resiliparse/parse/html.pyx":1592
  *     cdef HTMLTree tree = HTMLTree.__new__(HTMLTree)
  *     with nogil:
  *         status = lxb_html_document_parse(tree.dom_document, html, html_len)             # <<<<<<<<<<<<<<
  *     if status != LXB_STATUS_OK:
  *         raise ValueError('Failed to parse HTML document')
  */
         __pyx_v_status = lxb_html_document_parse(__pyx_v_tree->dom_document, __pyx_v_html, __pyx_v_html_len);
       }
 
-      /* "resiliparse/parse/html.pyx":1545
+      /* "resiliparse/parse/html.pyx":1591
  *     cdef size_t html_len = len(document)
  *     cdef HTMLTree tree = HTMLTree.__new__(HTMLTree)
  *     with nogil:             # <<<<<<<<<<<<<<
  *         status = lxb_html_document_parse(tree.dom_document, html, html_len)
  *     if status != LXB_STATUS_OK:
  */
       /*finally:*/ {
@@ -20301,59 +20904,59 @@
           #endif
           goto __pyx_L6;
         }
         __pyx_L6:;
       }
   }
 
-  /* "resiliparse/parse/html.pyx":1547
+  /* "resiliparse/parse/html.pyx":1593
  *     with nogil:
  *         status = lxb_html_document_parse(tree.dom_document, html, html_len)
  *     if status != LXB_STATUS_OK:             # <<<<<<<<<<<<<<
  *         raise ValueError('Failed to parse HTML document')
  *     return tree
  */
   __pyx_t_2 = ((__pyx_v_status != LXB_STATUS_OK) != 0);
   if (unlikely(__pyx_t_2)) {
 
-    /* "resiliparse/parse/html.pyx":1548
+    /* "resiliparse/parse/html.pyx":1594
  *         status = lxb_html_document_parse(tree.dom_document, html, html_len)
  *     if status != LXB_STATUS_OK:
  *         raise ValueError('Failed to parse HTML document')             # <<<<<<<<<<<<<<
  *     return tree
  * 
  */
-    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__33, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1548, __pyx_L1_error)
+    __pyx_t_4 = __Pyx_PyObject_Call(__pyx_builtin_ValueError, __pyx_tuple__36, NULL); if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 1594, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_4);
     __Pyx_Raise(__pyx_t_4, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_4); __pyx_t_4 = 0;
-    __PYX_ERR(0, 1548, __pyx_L1_error)
+    __PYX_ERR(0, 1594, __pyx_L1_error)
 
-    /* "resiliparse/parse/html.pyx":1547
+    /* "resiliparse/parse/html.pyx":1593
  *     with nogil:
  *         status = lxb_html_document_parse(tree.dom_document, html, html_len)
  *     if status != LXB_STATUS_OK:             # <<<<<<<<<<<<<<
  *         raise ValueError('Failed to parse HTML document')
  *     return tree
  */
   }
 
-  /* "resiliparse/parse/html.pyx":1549
+  /* "resiliparse/parse/html.pyx":1595
  *     if status != LXB_STATUS_OK:
  *         raise ValueError('Failed to parse HTML document')
  *     return tree             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
   __Pyx_INCREF(((PyObject *)__pyx_v_tree));
   __pyx_r = __pyx_v_tree;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":1528
+  /* "resiliparse/parse/html.pyx":1574
  * 
  * 
  * cdef HTMLTree create_html_tree(bytes document, bint reencode=True, str encoding='utf-8', str errors='ignore'):             # <<<<<<<<<<<<<<
  *     """
  *     Create :class:`HTMLTree` instance from bytes content.
  */
 
@@ -20368,15 +20971,15 @@
   __Pyx_XDECREF(__pyx_v_document);
   __Pyx_XDECREF(__pyx_v_encoding);
   __Pyx_XGIVEREF((PyObject *)__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":1559
+/* "resiliparse/parse/html.pyx":1605
  *     """
  * 
  *     def __init__(self, *args, **kwargs):             # <<<<<<<<<<<<<<
  *         raise SyntaxError('Cannot create instance directly. Use HTMLParser.parse() or HTMLParser.parse_from_bytes()')
  * 
  */
 
@@ -20405,28 +21008,28 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__init__", 0);
 
-  /* "resiliparse/parse/html.pyx":1560
+  /* "resiliparse/parse/html.pyx":1606
  * 
  *     def __init__(self, *args, **kwargs):
  *         raise SyntaxError('Cannot create instance directly. Use HTMLParser.parse() or HTMLParser.parse_from_bytes()')             # <<<<<<<<<<<<<<
  * 
  *     def __cinit__(self):
  */
-  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_SyntaxError, __pyx_tuple__34, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1560, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_SyntaxError, __pyx_tuple__37, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1606, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_Raise(__pyx_t_1, 0, 0, 0);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  __PYX_ERR(0, 1560, __pyx_L1_error)
+  __PYX_ERR(0, 1606, __pyx_L1_error)
 
-  /* "resiliparse/parse/html.pyx":1559
+  /* "resiliparse/parse/html.pyx":1605
  *     """
  * 
  *     def __init__(self, *args, **kwargs):             # <<<<<<<<<<<<<<
  *         raise SyntaxError('Cannot create instance directly. Use HTMLParser.parse() or HTMLParser.parse_from_bytes()')
  * 
  */
 
@@ -20435,15 +21038,15 @@
   __Pyx_XDECREF(__pyx_t_1);
   __Pyx_AddTraceback("resiliparse.parse.html.HTMLTree.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = -1;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":1562
+/* "resiliparse/parse/html.pyx":1608
  *         raise SyntaxError('Cannot create instance directly. Use HTMLParser.parse() or HTMLParser.parse_from_bytes()')
  * 
  *     def __cinit__(self):             # <<<<<<<<<<<<<<
  *         self.dom_document = lxb_html_document_create()
  *         if not self.dom_document:
  */
 
@@ -20469,83 +21072,83 @@
   int __pyx_t_1;
   PyObject *__pyx_t_2 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__cinit__", 0);
 
-  /* "resiliparse/parse/html.pyx":1563
+  /* "resiliparse/parse/html.pyx":1609
  * 
  *     def __cinit__(self):
  *         self.dom_document = lxb_html_document_create()             # <<<<<<<<<<<<<<
  *         if not self.dom_document:
  *             raise RuntimeError('Failed to allocate HTML document')
  */
   __pyx_v_self->dom_document = lxb_html_document_create();
 
-  /* "resiliparse/parse/html.pyx":1564
+  /* "resiliparse/parse/html.pyx":1610
  *     def __cinit__(self):
  *         self.dom_document = lxb_html_document_create()
  *         if not self.dom_document:             # <<<<<<<<<<<<<<
  *             raise RuntimeError('Failed to allocate HTML document')
  *         self.css_parser = NULL
  */
   __pyx_t_1 = ((!(__pyx_v_self->dom_document != 0)) != 0);
   if (unlikely(__pyx_t_1)) {
 
-    /* "resiliparse/parse/html.pyx":1565
+    /* "resiliparse/parse/html.pyx":1611
  *         self.dom_document = lxb_html_document_create()
  *         if not self.dom_document:
  *             raise RuntimeError('Failed to allocate HTML document')             # <<<<<<<<<<<<<<
  *         self.css_parser = NULL
  *         self.css_selectors = NULL
  */
-    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_RuntimeError, __pyx_tuple__35, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1565, __pyx_L1_error)
+    __pyx_t_2 = __Pyx_PyObject_Call(__pyx_builtin_RuntimeError, __pyx_tuple__38, NULL); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1611, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_2);
     __Pyx_Raise(__pyx_t_2, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-    __PYX_ERR(0, 1565, __pyx_L1_error)
+    __PYX_ERR(0, 1611, __pyx_L1_error)
 
-    /* "resiliparse/parse/html.pyx":1564
+    /* "resiliparse/parse/html.pyx":1610
  *     def __cinit__(self):
  *         self.dom_document = lxb_html_document_create()
  *         if not self.dom_document:             # <<<<<<<<<<<<<<
  *             raise RuntimeError('Failed to allocate HTML document')
  *         self.css_parser = NULL
  */
   }
 
-  /* "resiliparse/parse/html.pyx":1566
+  /* "resiliparse/parse/html.pyx":1612
  *         if not self.dom_document:
  *             raise RuntimeError('Failed to allocate HTML document')
  *         self.css_parser = NULL             # <<<<<<<<<<<<<<
  *         self.css_selectors = NULL
  *         self.selectors = NULL
  */
   __pyx_v_self->css_parser = NULL;
 
-  /* "resiliparse/parse/html.pyx":1567
+  /* "resiliparse/parse/html.pyx":1613
  *             raise RuntimeError('Failed to allocate HTML document')
  *         self.css_parser = NULL
  *         self.css_selectors = NULL             # <<<<<<<<<<<<<<
  *         self.selectors = NULL
  * 
  */
   __pyx_v_self->css_selectors = NULL;
 
-  /* "resiliparse/parse/html.pyx":1568
+  /* "resiliparse/parse/html.pyx":1614
  *         self.css_parser = NULL
  *         self.css_selectors = NULL
  *         self.selectors = NULL             # <<<<<<<<<<<<<<
  * 
  *     def __dealloc__(self):
  */
   __pyx_v_self->selectors = NULL;
 
-  /* "resiliparse/parse/html.pyx":1562
+  /* "resiliparse/parse/html.pyx":1608
  *         raise SyntaxError('Cannot create instance directly. Use HTMLParser.parse() or HTMLParser.parse_from_bytes()')
  * 
  *     def __cinit__(self):             # <<<<<<<<<<<<<<
  *         self.dom_document = lxb_html_document_create()
  *         if not self.dom_document:
  */
 
@@ -20557,15 +21160,15 @@
   __Pyx_AddTraceback("resiliparse.parse.html.HTMLTree.__cinit__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = -1;
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":1570
+/* "resiliparse/parse/html.pyx":1616
  *         self.selectors = NULL
  * 
  *     def __dealloc__(self):             # <<<<<<<<<<<<<<
  *         if self.dom_document:
  *             lxb_html_document_destroy(self.dom_document)
  */
 
@@ -20579,275 +21182,214 @@
   /* function exit code */
   __Pyx_RefNannyFinishContext();
 }
 
 static void __pyx_pf_11resiliparse_5parse_4html_8HTMLTree_4__dealloc__(struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *__pyx_v_self) {
   __Pyx_RefNannyDeclarations
   int __pyx_t_1;
+  int __pyx_t_2;
   __Pyx_RefNannySetupContext("__dealloc__", 0);
 
-  /* "resiliparse/parse/html.pyx":1571
+  /* "resiliparse/parse/html.pyx":1617
  * 
  *     def __dealloc__(self):
  *         if self.dom_document:             # <<<<<<<<<<<<<<
  *             lxb_html_document_destroy(self.dom_document)
  *             self.dom_document = NULL
  */
   __pyx_t_1 = (__pyx_v_self->dom_document != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/parse/html.pyx":1572
+    /* "resiliparse/parse/html.pyx":1618
  *     def __dealloc__(self):
  *         if self.dom_document:
  *             lxb_html_document_destroy(self.dom_document)             # <<<<<<<<<<<<<<
  *             self.dom_document = NULL
  * 
  */
     (void)(lxb_html_document_destroy(__pyx_v_self->dom_document));
 
-    /* "resiliparse/parse/html.pyx":1573
+    /* "resiliparse/parse/html.pyx":1619
  *         if self.dom_document:
  *             lxb_html_document_destroy(self.dom_document)
  *             self.dom_document = NULL             # <<<<<<<<<<<<<<
  * 
- *         if self.selectors:
+ *         if self.css_parser or self.css_parser or self.css_selectors:
  */
     __pyx_v_self->dom_document = NULL;
 
-    /* "resiliparse/parse/html.pyx":1571
+    /* "resiliparse/parse/html.pyx":1617
  * 
  *     def __dealloc__(self):
  *         if self.dom_document:             # <<<<<<<<<<<<<<
  *             lxb_html_document_destroy(self.dom_document)
  *             self.dom_document = NULL
  */
   }
 
-  /* "resiliparse/parse/html.pyx":1575
+  /* "resiliparse/parse/html.pyx":1621
  *             self.dom_document = NULL
  * 
- *         if self.selectors:             # <<<<<<<<<<<<<<
- *             lxb_selectors_destroy(self.selectors, True)
- *         if self.css_parser:
+ *         if self.css_parser or self.css_parser or self.css_selectors:             # <<<<<<<<<<<<<<
+ *             destroy_css_selectors(self.css_selectors, self.selectors)
+ *             destroy_css_parser(self.css_parser)
  */
-  __pyx_t_1 = (__pyx_v_self->selectors != 0);
+  __pyx_t_2 = (__pyx_v_self->css_parser != 0);
+  if (!__pyx_t_2) {
+  } else {
+    __pyx_t_1 = __pyx_t_2;
+    goto __pyx_L5_bool_binop_done;
+  }
+  __pyx_t_2 = (__pyx_v_self->css_parser != 0);
+  if (!__pyx_t_2) {
+  } else {
+    __pyx_t_1 = __pyx_t_2;
+    goto __pyx_L5_bool_binop_done;
+  }
+  __pyx_t_2 = (__pyx_v_self->css_selectors != 0);
+  __pyx_t_1 = __pyx_t_2;
+  __pyx_L5_bool_binop_done:;
   if (__pyx_t_1) {
 
-    /* "resiliparse/parse/html.pyx":1576
- * 
- *         if self.selectors:
- *             lxb_selectors_destroy(self.selectors, True)             # <<<<<<<<<<<<<<
- *         if self.css_parser:
- *             lxb_css_parser_destroy(self.css_parser, True)
- */
-    (void)(lxb_selectors_destroy(__pyx_v_self->selectors, 1));
-
-    /* "resiliparse/parse/html.pyx":1575
- *             self.dom_document = NULL
+    /* "resiliparse/parse/html.pyx":1622
  * 
- *         if self.selectors:             # <<<<<<<<<<<<<<
- *             lxb_selectors_destroy(self.selectors, True)
- *         if self.css_parser:
- */
-  }
-
-  /* "resiliparse/parse/html.pyx":1577
- *         if self.selectors:
- *             lxb_selectors_destroy(self.selectors, True)
- *         if self.css_parser:             # <<<<<<<<<<<<<<
- *             lxb_css_parser_destroy(self.css_parser, True)
+ *         if self.css_parser or self.css_parser or self.css_selectors:
+ *             destroy_css_selectors(self.css_selectors, self.selectors)             # <<<<<<<<<<<<<<
+ *             destroy_css_parser(self.css_parser)
  *             self.css_parser = NULL
  */
-  __pyx_t_1 = (__pyx_v_self->css_parser != 0);
-  if (__pyx_t_1) {
+    __pyx_f_11resiliparse_5parse_4html_destroy_css_selectors(__pyx_v_self->css_selectors, __pyx_v_self->selectors);
 
-    /* "resiliparse/parse/html.pyx":1578
- *             lxb_selectors_destroy(self.selectors, True)
- *         if self.css_parser:
- *             lxb_css_parser_destroy(self.css_parser, True)             # <<<<<<<<<<<<<<
+    /* "resiliparse/parse/html.pyx":1623
+ *         if self.css_parser or self.css_parser or self.css_selectors:
+ *             destroy_css_selectors(self.css_selectors, self.selectors)
+ *             destroy_css_parser(self.css_parser)             # <<<<<<<<<<<<<<
  *             self.css_parser = NULL
- *         if self.css_selectors:
- */
-    (void)(lxb_css_parser_destroy(__pyx_v_self->css_parser, 1));
-
-    /* "resiliparse/parse/html.pyx":1579
- *         if self.css_parser:
- *             lxb_css_parser_destroy(self.css_parser, True)
- *             self.css_parser = NULL             # <<<<<<<<<<<<<<
- *         if self.css_selectors:
- *             lxb_css_selectors_destroy(self.css_selectors, True, True)
- */
-    __pyx_v_self->css_parser = NULL;
-
-    /* "resiliparse/parse/html.pyx":1577
- *         if self.selectors:
- *             lxb_selectors_destroy(self.selectors, True)
- *         if self.css_parser:             # <<<<<<<<<<<<<<
- *             lxb_css_parser_destroy(self.css_parser, True)
  *             self.css_parser = NULL
  */
-  }
+    __pyx_f_11resiliparse_5parse_4html_destroy_css_parser(__pyx_v_self->css_parser);
 
-  /* "resiliparse/parse/html.pyx":1580
- *             lxb_css_parser_destroy(self.css_parser, True)
+    /* "resiliparse/parse/html.pyx":1624
+ *             destroy_css_selectors(self.css_selectors, self.selectors)
+ *             destroy_css_parser(self.css_parser)
+ *             self.css_parser = NULL             # <<<<<<<<<<<<<<
  *             self.css_parser = NULL
- *         if self.css_selectors:             # <<<<<<<<<<<<<<
- *             lxb_css_selectors_destroy(self.css_selectors, True, True)
  *             self.css_selectors = NULL
  */
-  __pyx_t_1 = (__pyx_v_self->css_selectors != 0);
-  if (__pyx_t_1) {
+    __pyx_v_self->css_parser = NULL;
 
-    /* "resiliparse/parse/html.pyx":1581
+    /* "resiliparse/parse/html.pyx":1625
+ *             destroy_css_parser(self.css_parser)
  *             self.css_parser = NULL
- *         if self.css_selectors:
- *             lxb_css_selectors_destroy(self.css_selectors, True, True)             # <<<<<<<<<<<<<<
+ *             self.css_parser = NULL             # <<<<<<<<<<<<<<
  *             self.css_selectors = NULL
  * 
  */
-    (void)(lxb_css_selectors_destroy(__pyx_v_self->css_selectors, 1, 1));
+    __pyx_v_self->css_parser = NULL;
 
-    /* "resiliparse/parse/html.pyx":1582
- *         if self.css_selectors:
- *             lxb_css_selectors_destroy(self.css_selectors, True, True)
+    /* "resiliparse/parse/html.pyx":1626
+ *             self.css_parser = NULL
+ *             self.css_parser = NULL
  *             self.css_selectors = NULL             # <<<<<<<<<<<<<<
  * 
  *     # noinspection PyAttributeOutsideInit
  */
     __pyx_v_self->css_selectors = NULL;
 
-    /* "resiliparse/parse/html.pyx":1580
- *             lxb_css_parser_destroy(self.css_parser, True)
- *             self.css_parser = NULL
- *         if self.css_selectors:             # <<<<<<<<<<<<<<
- *             lxb_css_selectors_destroy(self.css_selectors, True, True)
- *             self.css_selectors = NULL
+    /* "resiliparse/parse/html.pyx":1621
+ *             self.dom_document = NULL
+ * 
+ *         if self.css_parser or self.css_parser or self.css_selectors:             # <<<<<<<<<<<<<<
+ *             destroy_css_selectors(self.css_selectors, self.selectors)
+ *             destroy_css_parser(self.css_parser)
  */
   }
 
-  /* "resiliparse/parse/html.pyx":1570
+  /* "resiliparse/parse/html.pyx":1616
  *         self.selectors = NULL
  * 
  *     def __dealloc__(self):             # <<<<<<<<<<<<<<
  *         if self.dom_document:
  *             lxb_html_document_destroy(self.dom_document)
  */
 
   /* function exit code */
   __Pyx_RefNannyFinishContext();
 }
 
-/* "resiliparse/parse/html.pyx":1585
+/* "resiliparse/parse/html.pyx":1629
  * 
  *     # noinspection PyAttributeOutsideInit
- *     cdef void init_css_parser(self):             # <<<<<<<<<<<<<<
+ *     cdef inline void init_css_parser(self):             # <<<<<<<<<<<<<<
  *         """
  *         Initialize CSS selector if not already initialized.
  */
 
 static void __pyx_f_11resiliparse_5parse_4html_8HTMLTree_init_css_parser(struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *__pyx_v_self) {
   __Pyx_RefNannyDeclarations
   int __pyx_t_1;
+  int __pyx_lineno = 0;
+  const char *__pyx_filename = NULL;
+  int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("init_css_parser", 0);
 
-  /* "resiliparse/parse/html.pyx":1589
+  /* "resiliparse/parse/html.pyx":1633
  *         Initialize CSS selector if not already initialized.
  *         """
  *         if not self.css_parser:             # <<<<<<<<<<<<<<
- *             self.css_parser = lxb_css_parser_create()
- *             lxb_css_parser_init(self.css_parser, NULL, NULL)
+ *             init_css_parser(&self.css_parser)
+ *             init_css_selectors(self.css_parser, &self.css_selectors, &self.selectors)
  */
   __pyx_t_1 = ((!(__pyx_v_self->css_parser != 0)) != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/parse/html.pyx":1590
+    /* "resiliparse/parse/html.pyx":1634
  *         """
  *         if not self.css_parser:
- *             self.css_parser = lxb_css_parser_create()             # <<<<<<<<<<<<<<
- *             lxb_css_parser_init(self.css_parser, NULL, NULL)
+ *             init_css_parser(&self.css_parser)             # <<<<<<<<<<<<<<
+ *             init_css_selectors(self.css_parser, &self.css_selectors, &self.selectors)
  * 
  */
-    __pyx_v_self->css_parser = lxb_css_parser_create();
+    __pyx_t_1 = __pyx_f_11resiliparse_5parse_4html_init_css_parser((&__pyx_v_self->css_parser)); if (unlikely(__pyx_t_1 == ((int)0))) __PYX_ERR(0, 1634, __pyx_L1_error)
 
-    /* "resiliparse/parse/html.pyx":1591
+    /* "resiliparse/parse/html.pyx":1635
  *         if not self.css_parser:
- *             self.css_parser = lxb_css_parser_create()
- *             lxb_css_parser_init(self.css_parser, NULL, NULL)             # <<<<<<<<<<<<<<
- * 
- *             self.css_selectors = lxb_css_selectors_create()
- */
-    (void)(lxb_css_parser_init(__pyx_v_self->css_parser, NULL, NULL));
-
-    /* "resiliparse/parse/html.pyx":1593
- *             lxb_css_parser_init(self.css_parser, NULL, NULL)
- * 
- *             self.css_selectors = lxb_css_selectors_create()             # <<<<<<<<<<<<<<
- *             lxb_css_selectors_init(self.css_selectors, 32)
- *             lxb_css_parser_selectors_set(self.css_parser, self.css_selectors)
- */
-    __pyx_v_self->css_selectors = lxb_css_selectors_create();
-
-    /* "resiliparse/parse/html.pyx":1594
- * 
- *             self.css_selectors = lxb_css_selectors_create()
- *             lxb_css_selectors_init(self.css_selectors, 32)             # <<<<<<<<<<<<<<
- *             lxb_css_parser_selectors_set(self.css_parser, self.css_selectors)
- * 
- */
-    (void)(lxb_css_selectors_init(__pyx_v_self->css_selectors, 32));
-
-    /* "resiliparse/parse/html.pyx":1595
- *             self.css_selectors = lxb_css_selectors_create()
- *             lxb_css_selectors_init(self.css_selectors, 32)
- *             lxb_css_parser_selectors_set(self.css_parser, self.css_selectors)             # <<<<<<<<<<<<<<
- * 
- *             self.selectors = lxb_selectors_create()
- */
-    lxb_css_parser_selectors_set(__pyx_v_self->css_parser, __pyx_v_self->css_selectors);
-
-    /* "resiliparse/parse/html.pyx":1597
- *             lxb_css_parser_selectors_set(self.css_parser, self.css_selectors)
+ *             init_css_parser(&self.css_parser)
+ *             init_css_selectors(self.css_parser, &self.css_selectors, &self.selectors)             # <<<<<<<<<<<<<<
  * 
- *             self.selectors = lxb_selectors_create()             # <<<<<<<<<<<<<<
- *             lxb_selectors_init(self.selectors)
  * 
  */
-    __pyx_v_self->selectors = lxb_selectors_create();
+    __pyx_t_1 = __pyx_f_11resiliparse_5parse_4html_init_css_selectors(__pyx_v_self->css_parser, (&__pyx_v_self->css_selectors), (&__pyx_v_self->selectors)); if (unlikely(__pyx_t_1 == ((int)0))) __PYX_ERR(0, 1635, __pyx_L1_error)
 
-    /* "resiliparse/parse/html.pyx":1598
- * 
- *             self.selectors = lxb_selectors_create()
- *             lxb_selectors_init(self.selectors)             # <<<<<<<<<<<<<<
- * 
- * 
- */
-    (void)(lxb_selectors_init(__pyx_v_self->selectors));
-
-    /* "resiliparse/parse/html.pyx":1589
+    /* "resiliparse/parse/html.pyx":1633
  *         Initialize CSS selector if not already initialized.
  *         """
  *         if not self.css_parser:             # <<<<<<<<<<<<<<
- *             self.css_parser = lxb_css_parser_create()
- *             lxb_css_parser_init(self.css_parser, NULL, NULL)
+ *             init_css_parser(&self.css_parser)
+ *             init_css_selectors(self.css_parser, &self.css_selectors, &self.selectors)
  */
   }
 
-  /* "resiliparse/parse/html.pyx":1585
+  /* "resiliparse/parse/html.pyx":1629
  * 
  *     # noinspection PyAttributeOutsideInit
- *     cdef void init_css_parser(self):             # <<<<<<<<<<<<<<
+ *     cdef inline void init_css_parser(self):             # <<<<<<<<<<<<<<
  *         """
  *         Initialize CSS selector if not already initialized.
  */
 
   /* function exit code */
+  goto __pyx_L0;
+  __pyx_L1_error:;
+  __Pyx_WriteUnraisable("resiliparse.parse.html.HTMLTree.init_css_parser", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
+  __pyx_L0:;
   __Pyx_RefNannyFinishContext();
 }
 
-/* "resiliparse/parse/html.pyx":1602
+/* "resiliparse/parse/html.pyx":1639
  * 
  *     @classmethod
  *     def parse(cls, str document):             # <<<<<<<<<<<<<<
  *         """
  *         parse(self, document)
  */
 
@@ -20857,15 +21399,15 @@
 static PyObject *__pyx_pw_11resiliparse_5parse_4html_8HTMLTree_7parse(PyObject *__pyx_v_cls, PyObject *__pyx_v_document) {
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("parse (wrapper)", 0);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_document), (&PyUnicode_Type), 1, "document", 1))) __PYX_ERR(0, 1602, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_document), (&PyUnicode_Type), 1, "document", 1))) __PYX_ERR(0, 1639, __pyx_L1_error)
   __pyx_r = __pyx_pf_11resiliparse_5parse_4html_8HTMLTree_6parse(((PyTypeObject*)__pyx_v_cls), ((PyObject*)__pyx_v_document));
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -20880,38 +21422,38 @@
   PyObject *__pyx_t_2 = NULL;
   struct __pyx_opt_args_11resiliparse_5parse_4html_create_html_tree __pyx_t_3;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("parse", 0);
 
-  /* "resiliparse/parse/html.pyx":1613
+  /* "resiliparse/parse/html.pyx":1650
  *         :raises ValueError: if HTML parsing fails for unknown reasons
  *         """
  *         return create_html_tree(document.encode(), reencode=False)             # <<<<<<<<<<<<<<
  * 
  *     @classmethod
  */
   __Pyx_XDECREF(__pyx_r);
   if (unlikely(__pyx_v_document == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "encode");
-    __PYX_ERR(0, 1613, __pyx_L1_error)
+    __PYX_ERR(0, 1650, __pyx_L1_error)
   }
-  __pyx_t_1 = PyUnicode_AsEncodedString(__pyx_v_document, NULL, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1613, __pyx_L1_error)
+  __pyx_t_1 = PyUnicode_AsEncodedString(__pyx_v_document, NULL, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1650, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_t_3.__pyx_n = 1;
   __pyx_t_3.reencode = 0;
-  __pyx_t_2 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html_create_html_tree(((PyObject*)__pyx_t_1), &__pyx_t_3)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1613, __pyx_L1_error)
+  __pyx_t_2 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html_create_html_tree(((PyObject*)__pyx_t_1), &__pyx_t_3)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1650, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __pyx_r = __pyx_t_2;
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":1602
+  /* "resiliparse/parse/html.pyx":1639
  * 
  *     @classmethod
  *     def parse(cls, str document):             # <<<<<<<<<<<<<<
  *         """
  *         parse(self, document)
  */
 
@@ -20923,15 +21465,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":1616
+/* "resiliparse/parse/html.pyx":1653
  * 
  *     @classmethod
  *     def parse_from_bytes(cls, bytes document, str encoding='utf-8', str errors='ignore'):             # <<<<<<<<<<<<<<
  *         """
  *         parse_from_bytes(self, document, encoding='utf-8', errors='ignore')
  */
 
@@ -20981,15 +21523,15 @@
         case  2:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_errors);
           if (value) { values[2] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "parse_from_bytes") < 0)) __PYX_ERR(0, 1616, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "parse_from_bytes") < 0)) __PYX_ERR(0, 1653, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  3: values[2] = PyTuple_GET_ITEM(__pyx_args, 2);
         CYTHON_FALLTHROUGH;
         case  2: values[1] = PyTuple_GET_ITEM(__pyx_args, 1);
         CYTHON_FALLTHROUGH;
@@ -21000,23 +21542,23 @@
     }
     __pyx_v_document = ((PyObject*)values[0]);
     __pyx_v_encoding = ((PyObject*)values[1]);
     __pyx_v_errors = ((PyObject*)values[2]);
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("parse_from_bytes", 0, 1, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1616, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("parse_from_bytes", 0, 1, 3, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1653, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("resiliparse.parse.html.HTMLTree.parse_from_bytes", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_document), (&PyBytes_Type), 1, "document", 1))) __PYX_ERR(0, 1616, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_encoding), (&PyUnicode_Type), 1, "encoding", 1))) __PYX_ERR(0, 1616, __pyx_L1_error)
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_errors), (&PyUnicode_Type), 1, "errors", 1))) __PYX_ERR(0, 1616, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_document), (&PyBytes_Type), 1, "document", 1))) __PYX_ERR(0, 1653, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_encoding), (&PyUnicode_Type), 1, "encoding", 1))) __PYX_ERR(0, 1653, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_errors), (&PyUnicode_Type), 1, "errors", 1))) __PYX_ERR(0, 1653, __pyx_L1_error)
   __pyx_r = __pyx_pf_11resiliparse_5parse_4html_8HTMLTree_8parse_from_bytes(((PyTypeObject*)__pyx_v_cls), __pyx_v_document, __pyx_v_encoding, __pyx_v_errors);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -21030,33 +21572,33 @@
   PyObject *__pyx_t_1 = NULL;
   struct __pyx_opt_args_11resiliparse_5parse_4html_create_html_tree __pyx_t_2;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("parse_from_bytes", 0);
 
-  /* "resiliparse/parse/html.pyx":1634
+  /* "resiliparse/parse/html.pyx":1671
  *         :raises ValueError: if HTML parsing fails for unknown reasons
  *         """
  *         return create_html_tree(document, True, encoding, errors)             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
   __Pyx_XDECREF(__pyx_r);
   __pyx_t_2.__pyx_n = 3;
   __pyx_t_2.reencode = 1;
   __pyx_t_2.encoding = __pyx_v_encoding;
   __pyx_t_2.errors = __pyx_v_errors;
-  __pyx_t_1 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html_create_html_tree(__pyx_v_document, &__pyx_t_2)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1634, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html_create_html_tree(__pyx_v_document, &__pyx_t_2)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1671, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":1616
+  /* "resiliparse/parse/html.pyx":1653
  * 
  *     @classmethod
  *     def parse_from_bytes(cls, bytes document, str encoding='utf-8', str errors='ignore'):             # <<<<<<<<<<<<<<
  *         """
  *         parse_from_bytes(self, document, encoding='utf-8', errors='ignore')
  */
 
@@ -21067,15 +21609,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":1637
+/* "resiliparse/parse/html.pyx":1674
  * 
  *     @property
  *     def document(self):             # <<<<<<<<<<<<<<
  *         """
  *         Document root node.
  */
 
@@ -21098,59 +21640,59 @@
   int __pyx_t_1;
   PyObject *__pyx_t_2 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
 
-  /* "resiliparse/parse/html.pyx":1643
+  /* "resiliparse/parse/html.pyx":1680
  *         :type: DOMNode or None
  *         """
  *         if not self.dom_document:             # <<<<<<<<<<<<<<
  *             return None
  * 
  */
   __pyx_t_1 = ((!(__pyx_v_self->dom_document != 0)) != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/parse/html.pyx":1644
+    /* "resiliparse/parse/html.pyx":1681
  *         """
  *         if not self.dom_document:
  *             return None             # <<<<<<<<<<<<<<
  * 
  *         return _create_dom_node(self, <lxb_dom_node_t*>&self.dom_document.dom_document)
  */
     __Pyx_XDECREF(__pyx_r);
     __pyx_r = Py_None; __Pyx_INCREF(Py_None);
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":1643
+    /* "resiliparse/parse/html.pyx":1680
  *         :type: DOMNode or None
  *         """
  *         if not self.dom_document:             # <<<<<<<<<<<<<<
  *             return None
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":1646
+  /* "resiliparse/parse/html.pyx":1683
  *             return None
  * 
  *         return _create_dom_node(self, <lxb_dom_node_t*>&self.dom_document.dom_document)             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_2 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html__create_dom_node(__pyx_v_self, ((lxb_dom_node_t *)(&__pyx_v_self->dom_document->dom_document)))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1646, __pyx_L1_error)
+  __pyx_t_2 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html__create_dom_node(__pyx_v_self, ((lxb_dom_node_t *)(&__pyx_v_self->dom_document->dom_document)))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1683, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_r = __pyx_t_2;
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":1637
+  /* "resiliparse/parse/html.pyx":1674
  * 
  *     @property
  *     def document(self):             # <<<<<<<<<<<<<<
  *         """
  *         Document root node.
  */
 
@@ -21161,15 +21703,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":1649
+/* "resiliparse/parse/html.pyx":1686
  * 
  *     @property
  *     def head(self):             # <<<<<<<<<<<<<<
  *         """
  *         HTML head element or ``None`` if document has no head.
  */
 
@@ -21192,59 +21734,59 @@
   int __pyx_t_1;
   PyObject *__pyx_t_2 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
 
-  /* "resiliparse/parse/html.pyx":1655
+  /* "resiliparse/parse/html.pyx":1692
  *         :type: DOMNode or None
  *         """
  *         if not self.dom_document:             # <<<<<<<<<<<<<<
  *             return None
  * 
  */
   __pyx_t_1 = ((!(__pyx_v_self->dom_document != 0)) != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/parse/html.pyx":1656
+    /* "resiliparse/parse/html.pyx":1693
  *         """
  *         if not self.dom_document:
  *             return None             # <<<<<<<<<<<<<<
  * 
  *         return _create_dom_node(self, <lxb_dom_node_t*>lxb_html_document_head_element(self.dom_document))
  */
     __Pyx_XDECREF(__pyx_r);
     __pyx_r = Py_None; __Pyx_INCREF(Py_None);
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":1655
+    /* "resiliparse/parse/html.pyx":1692
  *         :type: DOMNode or None
  *         """
  *         if not self.dom_document:             # <<<<<<<<<<<<<<
  *             return None
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":1658
+  /* "resiliparse/parse/html.pyx":1695
  *             return None
  * 
  *         return _create_dom_node(self, <lxb_dom_node_t*>lxb_html_document_head_element(self.dom_document))             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_2 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html__create_dom_node(__pyx_v_self, ((lxb_dom_node_t *)lxb_html_document_head_element(__pyx_v_self->dom_document)))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1658, __pyx_L1_error)
+  __pyx_t_2 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html__create_dom_node(__pyx_v_self, ((lxb_dom_node_t *)lxb_html_document_head_element(__pyx_v_self->dom_document)))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1695, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_r = __pyx_t_2;
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":1649
+  /* "resiliparse/parse/html.pyx":1686
  * 
  *     @property
  *     def head(self):             # <<<<<<<<<<<<<<
  *         """
  *         HTML head element or ``None`` if document has no head.
  */
 
@@ -21255,15 +21797,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":1661
+/* "resiliparse/parse/html.pyx":1698
  * 
  *     @property
  *     def body(self):             # <<<<<<<<<<<<<<
  *         """
  *         HTML body element or ``None`` if document has no body.
  */
 
@@ -21286,59 +21828,59 @@
   int __pyx_t_1;
   PyObject *__pyx_t_2 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
 
-  /* "resiliparse/parse/html.pyx":1667
+  /* "resiliparse/parse/html.pyx":1704
  *         :type: DOMNode or None
  *         """
  *         if not self.dom_document:             # <<<<<<<<<<<<<<
  *             return None
  * 
  */
   __pyx_t_1 = ((!(__pyx_v_self->dom_document != 0)) != 0);
   if (__pyx_t_1) {
 
-    /* "resiliparse/parse/html.pyx":1668
+    /* "resiliparse/parse/html.pyx":1705
  *         """
  *         if not self.dom_document:
  *             return None             # <<<<<<<<<<<<<<
  * 
  *         return _create_dom_node(self, <lxb_dom_node_t*>lxb_html_document_body_element(self.dom_document))
  */
     __Pyx_XDECREF(__pyx_r);
     __pyx_r = Py_None; __Pyx_INCREF(Py_None);
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":1667
+    /* "resiliparse/parse/html.pyx":1704
  *         :type: DOMNode or None
  *         """
  *         if not self.dom_document:             # <<<<<<<<<<<<<<
  *             return None
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":1670
+  /* "resiliparse/parse/html.pyx":1707
  *             return None
  * 
  *         return _create_dom_node(self, <lxb_dom_node_t*>lxb_html_document_body_element(self.dom_document))             # <<<<<<<<<<<<<<
  * 
  *     @property
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_2 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html__create_dom_node(__pyx_v_self, ((lxb_dom_node_t *)lxb_html_document_body_element(__pyx_v_self->dom_document)))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1670, __pyx_L1_error)
+  __pyx_t_2 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html__create_dom_node(__pyx_v_self, ((lxb_dom_node_t *)lxb_html_document_body_element(__pyx_v_self->dom_document)))); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1707, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __pyx_r = __pyx_t_2;
   __pyx_t_2 = 0;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":1661
+  /* "resiliparse/parse/html.pyx":1698
  * 
  *     @property
  *     def body(self):             # <<<<<<<<<<<<<<
  *         """
  *         HTML body element or ``None`` if document has no body.
  */
 
@@ -21349,15 +21891,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":1673
+/* "resiliparse/parse/html.pyx":1710
  * 
  *     @property
  *     def title(self):             # <<<<<<<<<<<<<<
  *         """
  *         The HTML document title.
  */
 
@@ -21385,133 +21927,133 @@
   PyObject *__pyx_t_5 = NULL;
   PyObject *__pyx_t_6 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__get__", 0);
 
-  /* "resiliparse/parse/html.pyx":1679
+  /* "resiliparse/parse/html.pyx":1716
  *         :type: str or None
  *         """
  *         if not self.dom_document or not self.head:             # <<<<<<<<<<<<<<
  *             return None
  * 
  */
   __pyx_t_2 = ((!(__pyx_v_self->dom_document != 0)) != 0);
   if (!__pyx_t_2) {
   } else {
     __pyx_t_1 = __pyx_t_2;
     goto __pyx_L4_bool_binop_done;
   }
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_head); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1679, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_head); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1716, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
-  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 1679, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_PyObject_IsTrue(__pyx_t_3); if (unlikely(__pyx_t_2 < 0)) __PYX_ERR(0, 1716, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
   __pyx_t_4 = ((!__pyx_t_2) != 0);
   __pyx_t_1 = __pyx_t_4;
   __pyx_L4_bool_binop_done:;
   if (__pyx_t_1) {
 
-    /* "resiliparse/parse/html.pyx":1680
+    /* "resiliparse/parse/html.pyx":1717
  *         """
  *         if not self.dom_document or not self.head:
  *             return None             # <<<<<<<<<<<<<<
  * 
  *         # Temporary workaround for lxb_html_document_title can crash.
  */
     __Pyx_XDECREF(__pyx_r);
     __pyx_r = Py_None; __Pyx_INCREF(Py_None);
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":1679
+    /* "resiliparse/parse/html.pyx":1716
  *         :type: str or None
  *         """
  *         if not self.dom_document or not self.head:             # <<<<<<<<<<<<<<
  *             return None
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":1684
+  /* "resiliparse/parse/html.pyx":1721
  *         # Temporary workaround for lxb_html_document_title can crash.
  *         # See: https://github.com/lexbor/lexbor/issues/134
  *         title = self.head.query_selector('title')             # <<<<<<<<<<<<<<
  *         if title is None:
  *             return ''
  */
-  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_head); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1684, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_head); if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 1721, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_query_selector); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1684, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyObject_GetAttrStr(__pyx_t_5, __pyx_n_s_query_selector); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1721, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
   __pyx_t_5 = NULL;
   if (CYTHON_UNPACK_METHODS && likely(PyMethod_Check(__pyx_t_6))) {
     __pyx_t_5 = PyMethod_GET_SELF(__pyx_t_6);
     if (likely(__pyx_t_5)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_6);
       __Pyx_INCREF(__pyx_t_5);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_6, function);
     }
   }
   __pyx_t_3 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_6, __pyx_t_5, __pyx_n_u_title) : __Pyx_PyObject_CallOneArg(__pyx_t_6, __pyx_n_u_title);
   __Pyx_XDECREF(__pyx_t_5); __pyx_t_5 = 0;
-  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1684, __pyx_L1_error)
+  if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1721, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_v_title = __pyx_t_3;
   __pyx_t_3 = 0;
 
-  /* "resiliparse/parse/html.pyx":1685
+  /* "resiliparse/parse/html.pyx":1722
  *         # See: https://github.com/lexbor/lexbor/issues/134
  *         title = self.head.query_selector('title')
  *         if title is None:             # <<<<<<<<<<<<<<
  *             return ''
  *         return title.text
  */
   __pyx_t_1 = (__pyx_v_title == Py_None);
   __pyx_t_4 = (__pyx_t_1 != 0);
   if (__pyx_t_4) {
 
-    /* "resiliparse/parse/html.pyx":1686
+    /* "resiliparse/parse/html.pyx":1723
  *         title = self.head.query_selector('title')
  *         if title is None:
  *             return ''             # <<<<<<<<<<<<<<
  *         return title.text
  * 
  */
     __Pyx_XDECREF(__pyx_r);
-    __Pyx_INCREF(__pyx_kp_u__2);
-    __pyx_r = __pyx_kp_u__2;
+    __Pyx_INCREF(__pyx_kp_u__5);
+    __pyx_r = __pyx_kp_u__5;
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":1685
+    /* "resiliparse/parse/html.pyx":1722
  *         # See: https://github.com/lexbor/lexbor/issues/134
  *         title = self.head.query_selector('title')
  *         if title is None:             # <<<<<<<<<<<<<<
  *             return ''
  *         return title.text
  */
   }
 
-  /* "resiliparse/parse/html.pyx":1687
+  /* "resiliparse/parse/html.pyx":1724
  *         if title is None:
  *             return ''
  *         return title.text             # <<<<<<<<<<<<<<
  * 
  *         # Proper implementation once bug is fixed
  */
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_title, __pyx_n_s_text); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1687, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_GetAttrStr(__pyx_v_title, __pyx_n_s_text); if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 1724, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_3);
   __pyx_r = __pyx_t_3;
   __pyx_t_3 = 0;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":1673
+  /* "resiliparse/parse/html.pyx":1710
  * 
  *     @property
  *     def title(self):             # <<<<<<<<<<<<<<
  *         """
  *         The HTML document title.
  */
 
@@ -21525,15 +22067,15 @@
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_v_title);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":1696
+/* "resiliparse/parse/html.pyx":1733
  *         # return title[:title_len].decode()
  * 
  *     cpdef DOMNode create_element(self, str tag_name):             # <<<<<<<<<<<<<<
  *         """
  *         create_element(self, tag_name)
  */
 
@@ -21559,15 +22101,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_create_element); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1696, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_create_element); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1733, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_11resiliparse_5parse_4html_8HTMLTree_11create_element)) {
         __Pyx_XDECREF(((PyObject *)__pyx_r));
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
@@ -21576,18 +22118,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_v_tag_name) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_tag_name);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1696, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1733, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_11resiliparse_5parse_4html_DOMNode))))) __PYX_ERR(0, 1696, __pyx_L1_error)
+        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_11resiliparse_5parse_4html_DOMNode))))) __PYX_ERR(0, 1733, __pyx_L1_error)
         __pyx_r = ((struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *)__pyx_t_2);
         __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -21598,104 +22140,104 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "resiliparse/parse/html.pyx":1707
+  /* "resiliparse/parse/html.pyx":1744
  *         :rtype: DOMNode
  *         """
  *         if not self.dom_document:             # <<<<<<<<<<<<<<
  *             raise RuntimeError('Trying to create element in uninitialized document.')
  * 
  */
   __pyx_t_5 = ((!(__pyx_v_self->dom_document != 0)) != 0);
   if (unlikely(__pyx_t_5)) {
 
-    /* "resiliparse/parse/html.pyx":1708
+    /* "resiliparse/parse/html.pyx":1745
  *         """
  *         if not self.dom_document:
  *             raise RuntimeError('Trying to create element in uninitialized document.')             # <<<<<<<<<<<<<<
  * 
  *         cdef bytes tag_name_bytes = tag_name.encode()
  */
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_RuntimeError, __pyx_tuple__36, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1708, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_RuntimeError, __pyx_tuple__39, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1745, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 1708, __pyx_L1_error)
+    __PYX_ERR(0, 1745, __pyx_L1_error)
 
-    /* "resiliparse/parse/html.pyx":1707
+    /* "resiliparse/parse/html.pyx":1744
  *         :rtype: DOMNode
  *         """
  *         if not self.dom_document:             # <<<<<<<<<<<<<<
  *             raise RuntimeError('Trying to create element in uninitialized document.')
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":1710
+  /* "resiliparse/parse/html.pyx":1747
  *             raise RuntimeError('Trying to create element in uninitialized document.')
  * 
  *         cdef bytes tag_name_bytes = tag_name.encode()             # <<<<<<<<<<<<<<
  *         cdef lxb_dom_element_t* element = lxb_dom_document_create_element(
  *             <lxb_dom_document_t*>self.dom_document, <lxb_char_t*>tag_name_bytes, len(tag_name_bytes), NULL)
  */
   if (unlikely(__pyx_v_tag_name == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "encode");
-    __PYX_ERR(0, 1710, __pyx_L1_error)
+    __PYX_ERR(0, 1747, __pyx_L1_error)
   }
-  __pyx_t_1 = PyUnicode_AsEncodedString(__pyx_v_tag_name, NULL, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1710, __pyx_L1_error)
+  __pyx_t_1 = PyUnicode_AsEncodedString(__pyx_v_tag_name, NULL, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1747, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_tag_name_bytes = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "resiliparse/parse/html.pyx":1712
+  /* "resiliparse/parse/html.pyx":1749
  *         cdef bytes tag_name_bytes = tag_name.encode()
  *         cdef lxb_dom_element_t* element = lxb_dom_document_create_element(
  *             <lxb_dom_document_t*>self.dom_document, <lxb_char_t*>tag_name_bytes, len(tag_name_bytes), NULL)             # <<<<<<<<<<<<<<
  *         return _create_dom_node(self, <lxb_dom_node_t*>element)
  * 
  */
   if (unlikely(__pyx_v_tag_name_bytes == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "expected bytes, NoneType found");
-    __PYX_ERR(0, 1712, __pyx_L1_error)
+    __PYX_ERR(0, 1749, __pyx_L1_error)
   }
-  __pyx_t_6 = __Pyx_PyBytes_AsWritableUString(__pyx_v_tag_name_bytes); if (unlikely((!__pyx_t_6) && PyErr_Occurred())) __PYX_ERR(0, 1712, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyBytes_AsWritableUString(__pyx_v_tag_name_bytes); if (unlikely((!__pyx_t_6) && PyErr_Occurred())) __PYX_ERR(0, 1749, __pyx_L1_error)
   if (unlikely(__pyx_v_tag_name_bytes == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-    __PYX_ERR(0, 1712, __pyx_L1_error)
+    __PYX_ERR(0, 1749, __pyx_L1_error)
   }
-  __pyx_t_7 = PyBytes_GET_SIZE(__pyx_v_tag_name_bytes); if (unlikely(__pyx_t_7 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1712, __pyx_L1_error)
+  __pyx_t_7 = PyBytes_GET_SIZE(__pyx_v_tag_name_bytes); if (unlikely(__pyx_t_7 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1749, __pyx_L1_error)
 
-  /* "resiliparse/parse/html.pyx":1711
+  /* "resiliparse/parse/html.pyx":1748
  * 
  *         cdef bytes tag_name_bytes = tag_name.encode()
  *         cdef lxb_dom_element_t* element = lxb_dom_document_create_element(             # <<<<<<<<<<<<<<
  *             <lxb_dom_document_t*>self.dom_document, <lxb_char_t*>tag_name_bytes, len(tag_name_bytes), NULL)
  *         return _create_dom_node(self, <lxb_dom_node_t*>element)
  */
   __pyx_v_element = lxb_dom_document_create_element(((lxb_dom_document_t *)__pyx_v_self->dom_document), ((lxb_char_t *)__pyx_t_6), __pyx_t_7, NULL);
 
-  /* "resiliparse/parse/html.pyx":1713
+  /* "resiliparse/parse/html.pyx":1750
  *         cdef lxb_dom_element_t* element = lxb_dom_document_create_element(
  *             <lxb_dom_document_t*>self.dom_document, <lxb_char_t*>tag_name_bytes, len(tag_name_bytes), NULL)
  *         return _create_dom_node(self, <lxb_dom_node_t*>element)             # <<<<<<<<<<<<<<
  * 
  *     cpdef DOMNode create_text_node(self, str text):
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
-  __pyx_t_1 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html__create_dom_node(__pyx_v_self, ((lxb_dom_node_t *)__pyx_v_element))); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1713, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html__create_dom_node(__pyx_v_self, ((lxb_dom_node_t *)__pyx_v_element))); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1750, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = ((struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *)__pyx_t_1);
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":1696
+  /* "resiliparse/parse/html.pyx":1733
  *         # return title[:title_len].decode()
  * 
  *     cpdef DOMNode create_element(self, str tag_name):             # <<<<<<<<<<<<<<
  *         """
  *         create_element(self, tag_name)
  */
 
@@ -21720,15 +22262,15 @@
 static PyObject *__pyx_pw_11resiliparse_5parse_4html_8HTMLTree_11create_element(PyObject *__pyx_v_self, PyObject *__pyx_v_tag_name) {
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("create_element (wrapper)", 0);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_tag_name), (&PyUnicode_Type), 1, "tag_name", 1))) __PYX_ERR(0, 1696, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_tag_name), (&PyUnicode_Type), 1, "tag_name", 1))) __PYX_ERR(0, 1733, __pyx_L1_error)
   __pyx_r = __pyx_pf_11resiliparse_5parse_4html_8HTMLTree_10create_element(((struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *)__pyx_v_self), ((PyObject*)__pyx_v_tag_name));
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -21741,15 +22283,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("create_element", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html_8HTMLTree_create_element(__pyx_v_self, __pyx_v_tag_name, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1696, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html_8HTMLTree_create_element(__pyx_v_self, __pyx_v_tag_name, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1733, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -21758,15 +22300,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":1715
+/* "resiliparse/parse/html.pyx":1752
  *         return _create_dom_node(self, <lxb_dom_node_t*>element)
  * 
  *     cpdef DOMNode create_text_node(self, str text):             # <<<<<<<<<<<<<<
  *         """
  *         create_text_node(self, text)
  */
 
@@ -21792,15 +22334,15 @@
   /* Check if overridden in Python */
   else if (unlikely((Py_TYPE(((PyObject *)__pyx_v_self))->tp_dictoffset != 0) || (Py_TYPE(((PyObject *)__pyx_v_self))->tp_flags & (Py_TPFLAGS_IS_ABSTRACT | Py_TPFLAGS_HEAPTYPE)))) {
     #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     static PY_UINT64_T __pyx_tp_dict_version = __PYX_DICT_VERSION_INIT, __pyx_obj_dict_version = __PYX_DICT_VERSION_INIT;
     if (unlikely(!__Pyx_object_dict_version_matches(((PyObject *)__pyx_v_self), __pyx_tp_dict_version, __pyx_obj_dict_version))) {
       PY_UINT64_T __pyx_type_dict_guard = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
       #endif
-      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_create_text_node); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1715, __pyx_L1_error)
+      __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_create_text_node); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1752, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_1);
       if (!PyCFunction_Check(__pyx_t_1) || (PyCFunction_GET_FUNCTION(__pyx_t_1) != (PyCFunction)(void*)__pyx_pw_11resiliparse_5parse_4html_8HTMLTree_13create_text_node)) {
         __Pyx_XDECREF(((PyObject *)__pyx_r));
         __Pyx_INCREF(__pyx_t_1);
         __pyx_t_3 = __pyx_t_1; __pyx_t_4 = NULL;
         if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_3))) {
           __pyx_t_4 = PyMethod_GET_SELF(__pyx_t_3);
@@ -21809,18 +22351,18 @@
             __Pyx_INCREF(__pyx_t_4);
             __Pyx_INCREF(function);
             __Pyx_DECREF_SET(__pyx_t_3, function);
           }
         }
         __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_v_text) : __Pyx_PyObject_CallOneArg(__pyx_t_3, __pyx_v_text);
         __Pyx_XDECREF(__pyx_t_4); __pyx_t_4 = 0;
-        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1715, __pyx_L1_error)
+        if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1752, __pyx_L1_error)
         __Pyx_GOTREF(__pyx_t_2);
         __Pyx_DECREF(__pyx_t_3); __pyx_t_3 = 0;
-        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_11resiliparse_5parse_4html_DOMNode))))) __PYX_ERR(0, 1715, __pyx_L1_error)
+        if (!(likely(((__pyx_t_2) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_2, __pyx_ptype_11resiliparse_5parse_4html_DOMNode))))) __PYX_ERR(0, 1752, __pyx_L1_error)
         __pyx_r = ((struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *)__pyx_t_2);
         __pyx_t_2 = 0;
         __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
         goto __pyx_L0;
       }
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
       __pyx_tp_dict_version = __Pyx_get_tp_dict_version(((PyObject *)__pyx_v_self));
@@ -21831,104 +22373,104 @@
       #endif
       __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
       #if CYTHON_USE_DICT_VERSIONS && CYTHON_USE_PYTYPE_LOOKUP && CYTHON_USE_TYPE_SLOTS
     }
     #endif
   }
 
-  /* "resiliparse/parse/html.pyx":1726
+  /* "resiliparse/parse/html.pyx":1763
  *         :rtype: DOMNode
  *         """
  *         if not self.dom_document:             # <<<<<<<<<<<<<<
  *             raise RuntimeError('Trying to create text node in uninitialized document.')
  * 
  */
   __pyx_t_5 = ((!(__pyx_v_self->dom_document != 0)) != 0);
   if (unlikely(__pyx_t_5)) {
 
-    /* "resiliparse/parse/html.pyx":1727
+    /* "resiliparse/parse/html.pyx":1764
  *         """
  *         if not self.dom_document:
  *             raise RuntimeError('Trying to create text node in uninitialized document.')             # <<<<<<<<<<<<<<
  * 
  *         cdef bytes text_bytes = text.encode()
  */
-    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_RuntimeError, __pyx_tuple__37, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1727, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_RuntimeError, __pyx_tuple__40, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1764, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __Pyx_Raise(__pyx_t_1, 0, 0, 0);
     __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-    __PYX_ERR(0, 1727, __pyx_L1_error)
+    __PYX_ERR(0, 1764, __pyx_L1_error)
 
-    /* "resiliparse/parse/html.pyx":1726
+    /* "resiliparse/parse/html.pyx":1763
  *         :rtype: DOMNode
  *         """
  *         if not self.dom_document:             # <<<<<<<<<<<<<<
  *             raise RuntimeError('Trying to create text node in uninitialized document.')
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":1729
+  /* "resiliparse/parse/html.pyx":1766
  *             raise RuntimeError('Trying to create text node in uninitialized document.')
  * 
  *         cdef bytes text_bytes = text.encode()             # <<<<<<<<<<<<<<
  *         cdef lxb_dom_text_t* node = lxb_dom_document_create_text_node(
  *             <lxb_dom_document_t*>self.dom_document, <lxb_char_t*>text_bytes, len(text_bytes))
  */
   if (unlikely(__pyx_v_text == Py_None)) {
     PyErr_Format(PyExc_AttributeError, "'NoneType' object has no attribute '%.30s'", "encode");
-    __PYX_ERR(0, 1729, __pyx_L1_error)
+    __PYX_ERR(0, 1766, __pyx_L1_error)
   }
-  __pyx_t_1 = PyUnicode_AsEncodedString(__pyx_v_text, NULL, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1729, __pyx_L1_error)
+  __pyx_t_1 = PyUnicode_AsEncodedString(__pyx_v_text, NULL, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1766, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_v_text_bytes = ((PyObject*)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "resiliparse/parse/html.pyx":1731
+  /* "resiliparse/parse/html.pyx":1768
  *         cdef bytes text_bytes = text.encode()
  *         cdef lxb_dom_text_t* node = lxb_dom_document_create_text_node(
  *             <lxb_dom_document_t*>self.dom_document, <lxb_char_t*>text_bytes, len(text_bytes))             # <<<<<<<<<<<<<<
  *         return _create_dom_node(self, <lxb_dom_node_t*>node)
  * 
  */
   if (unlikely(__pyx_v_text_bytes == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "expected bytes, NoneType found");
-    __PYX_ERR(0, 1731, __pyx_L1_error)
+    __PYX_ERR(0, 1768, __pyx_L1_error)
   }
-  __pyx_t_6 = __Pyx_PyBytes_AsWritableUString(__pyx_v_text_bytes); if (unlikely((!__pyx_t_6) && PyErr_Occurred())) __PYX_ERR(0, 1731, __pyx_L1_error)
+  __pyx_t_6 = __Pyx_PyBytes_AsWritableUString(__pyx_v_text_bytes); if (unlikely((!__pyx_t_6) && PyErr_Occurred())) __PYX_ERR(0, 1768, __pyx_L1_error)
   if (unlikely(__pyx_v_text_bytes == Py_None)) {
     PyErr_SetString(PyExc_TypeError, "object of type 'NoneType' has no len()");
-    __PYX_ERR(0, 1731, __pyx_L1_error)
+    __PYX_ERR(0, 1768, __pyx_L1_error)
   }
-  __pyx_t_7 = PyBytes_GET_SIZE(__pyx_v_text_bytes); if (unlikely(__pyx_t_7 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1731, __pyx_L1_error)
+  __pyx_t_7 = PyBytes_GET_SIZE(__pyx_v_text_bytes); if (unlikely(__pyx_t_7 == ((Py_ssize_t)-1))) __PYX_ERR(0, 1768, __pyx_L1_error)
 
-  /* "resiliparse/parse/html.pyx":1730
+  /* "resiliparse/parse/html.pyx":1767
  * 
  *         cdef bytes text_bytes = text.encode()
  *         cdef lxb_dom_text_t* node = lxb_dom_document_create_text_node(             # <<<<<<<<<<<<<<
  *             <lxb_dom_document_t*>self.dom_document, <lxb_char_t*>text_bytes, len(text_bytes))
  *         return _create_dom_node(self, <lxb_dom_node_t*>node)
  */
   __pyx_v_node = lxb_dom_document_create_text_node(((lxb_dom_document_t *)__pyx_v_self->dom_document), ((lxb_char_t *)__pyx_t_6), __pyx_t_7);
 
-  /* "resiliparse/parse/html.pyx":1732
+  /* "resiliparse/parse/html.pyx":1769
  *         cdef lxb_dom_text_t* node = lxb_dom_document_create_text_node(
  *             <lxb_dom_document_t*>self.dom_document, <lxb_char_t*>text_bytes, len(text_bytes))
  *         return _create_dom_node(self, <lxb_dom_node_t*>node)             # <<<<<<<<<<<<<<
  * 
  *     def __str__(self):
  */
   __Pyx_XDECREF(((PyObject *)__pyx_r));
-  __pyx_t_1 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html__create_dom_node(__pyx_v_self, ((lxb_dom_node_t *)__pyx_v_node))); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1732, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html__create_dom_node(__pyx_v_self, ((lxb_dom_node_t *)__pyx_v_node))); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1769, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = ((struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *)__pyx_t_1);
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":1715
+  /* "resiliparse/parse/html.pyx":1752
  *         return _create_dom_node(self, <lxb_dom_node_t*>element)
  * 
  *     cpdef DOMNode create_text_node(self, str text):             # <<<<<<<<<<<<<<
  *         """
  *         create_text_node(self, text)
  */
 
@@ -21953,15 +22495,15 @@
 static PyObject *__pyx_pw_11resiliparse_5parse_4html_8HTMLTree_13create_text_node(PyObject *__pyx_v_self, PyObject *__pyx_v_text) {
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   PyObject *__pyx_r = 0;
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("create_text_node (wrapper)", 0);
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_text), (&PyUnicode_Type), 1, "text", 1))) __PYX_ERR(0, 1715, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_text), (&PyUnicode_Type), 1, "text", 1))) __PYX_ERR(0, 1752, __pyx_L1_error)
   __pyx_r = __pyx_pf_11resiliparse_5parse_4html_8HTMLTree_12create_text_node(((struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *)__pyx_v_self), ((PyObject*)__pyx_v_text));
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -21974,15 +22516,15 @@
   __Pyx_RefNannyDeclarations
   PyObject *__pyx_t_1 = NULL;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("create_text_node", 0);
   __Pyx_XDECREF(__pyx_r);
-  __pyx_t_1 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html_8HTMLTree_create_text_node(__pyx_v_self, __pyx_v_text, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1715, __pyx_L1_error)
+  __pyx_t_1 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html_8HTMLTree_create_text_node(__pyx_v_self, __pyx_v_text, 1)); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1752, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __pyx_r = __pyx_t_1;
   __pyx_t_1 = 0;
   goto __pyx_L0;
 
   /* function exit code */
   __pyx_L1_error:;
@@ -21991,15 +22533,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":1734
+/* "resiliparse/parse/html.pyx":1771
  *         return _create_dom_node(self, <lxb_dom_node_t*>node)
  * 
  *     def __str__(self):             # <<<<<<<<<<<<<<
  *         cdef DOMNode doc = self.document
  *         if doc is not None:
  */
 
@@ -22024,74 +22566,74 @@
   int __pyx_t_2;
   int __pyx_t_3;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__str__", 0);
 
-  /* "resiliparse/parse/html.pyx":1735
+  /* "resiliparse/parse/html.pyx":1772
  * 
  *     def __str__(self):
  *         cdef DOMNode doc = self.document             # <<<<<<<<<<<<<<
  *         if doc is not None:
  *             return doc.html
  */
-  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_document); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1735, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_self), __pyx_n_s_document); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1772, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_11resiliparse_5parse_4html_DOMNode))))) __PYX_ERR(0, 1735, __pyx_L1_error)
+  if (!(likely(((__pyx_t_1) == Py_None) || likely(__Pyx_TypeTest(__pyx_t_1, __pyx_ptype_11resiliparse_5parse_4html_DOMNode))))) __PYX_ERR(0, 1772, __pyx_L1_error)
   __pyx_v_doc = ((struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *)__pyx_t_1);
   __pyx_t_1 = 0;
 
-  /* "resiliparse/parse/html.pyx":1736
+  /* "resiliparse/parse/html.pyx":1773
  *     def __str__(self):
  *         cdef DOMNode doc = self.document
  *         if doc is not None:             # <<<<<<<<<<<<<<
  *             return doc.html
  *         return ''
  */
   __pyx_t_2 = (((PyObject *)__pyx_v_doc) != Py_None);
   __pyx_t_3 = (__pyx_t_2 != 0);
   if (__pyx_t_3) {
 
-    /* "resiliparse/parse/html.pyx":1737
+    /* "resiliparse/parse/html.pyx":1774
  *         cdef DOMNode doc = self.document
  *         if doc is not None:
  *             return doc.html             # <<<<<<<<<<<<<<
  *         return ''
  * 
  */
     __Pyx_XDECREF(__pyx_r);
-    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_doc), __pyx_n_s_html); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1737, __pyx_L1_error)
+    __pyx_t_1 = __Pyx_PyObject_GetAttrStr(((PyObject *)__pyx_v_doc), __pyx_n_s_html); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1774, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_1);
     __pyx_r = __pyx_t_1;
     __pyx_t_1 = 0;
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":1736
+    /* "resiliparse/parse/html.pyx":1773
  *     def __str__(self):
  *         cdef DOMNode doc = self.document
  *         if doc is not None:             # <<<<<<<<<<<<<<
  *             return doc.html
  *         return ''
  */
   }
 
-  /* "resiliparse/parse/html.pyx":1738
+  /* "resiliparse/parse/html.pyx":1775
  *         if doc is not None:
  *             return doc.html
  *         return ''             # <<<<<<<<<<<<<<
  * 
  * 
  */
   __Pyx_XDECREF(__pyx_r);
-  __Pyx_INCREF(__pyx_kp_u__2);
-  __pyx_r = __pyx_kp_u__2;
+  __Pyx_INCREF(__pyx_kp_u__5);
+  __pyx_r = __pyx_kp_u__5;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":1734
+  /* "resiliparse/parse/html.pyx":1771
  *         return _create_dom_node(self, <lxb_dom_node_t*>node)
  * 
  *     def __str__(self):             # <<<<<<<<<<<<<<
  *         cdef DOMNode doc = self.document
  *         if doc is not None:
  */
 
@@ -22137,15 +22679,15 @@
 
   /* "(tree fragment)":2
  * def __reduce_cython__(self):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")             # <<<<<<<<<<<<<<
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  */
-  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__38, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 2, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__41, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 2, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_Raise(__pyx_t_1, 0, 0, 0);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __PYX_ERR(1, 2, __pyx_L1_error)
 
   /* "(tree fragment)":1
  * def __reduce_cython__(self):             # <<<<<<<<<<<<<<
@@ -22193,15 +22735,15 @@
   __Pyx_RefNannySetupContext("__setstate_cython__", 0);
 
   /* "(tree fragment)":4
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")             # <<<<<<<<<<<<<<
  */
-  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__39, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 4, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_PyObject_Call(__pyx_builtin_TypeError, __pyx_tuple__42, NULL); if (unlikely(!__pyx_t_1)) __PYX_ERR(1, 4, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_Raise(__pyx_t_1, 0, 0, 0);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   __PYX_ERR(1, 4, __pyx_L1_error)
 
   /* "(tree fragment)":3
  * def __reduce_cython__(self):
@@ -22216,15 +22758,15 @@
   __Pyx_AddTraceback("resiliparse.parse.html.HTMLTree.__setstate_cython__", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __pyx_r = NULL;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":1755
+/* "resiliparse/parse/html.pyx":1792
  *     :ivar int depth: the current traversal depth
  *     """
  *     def __init__(self):             # <<<<<<<<<<<<<<
  *         self.node = None
  *         self.depth = 0
  */
 
@@ -22246,33 +22788,33 @@
   PyObject *__pyx_r = NULL;
   __Pyx_RefNannyDeclarations
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__init__", 0);
 
-  /* "resiliparse/parse/html.pyx":1756
+  /* "resiliparse/parse/html.pyx":1793
  *     """
  *     def __init__(self):
  *         self.node = None             # <<<<<<<<<<<<<<
  *         self.depth = 0
  * 
  */
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_node, Py_None) < 0) __PYX_ERR(0, 1756, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_node, Py_None) < 0) __PYX_ERR(0, 1793, __pyx_L1_error)
 
-  /* "resiliparse/parse/html.pyx":1757
+  /* "resiliparse/parse/html.pyx":1794
  *     def __init__(self):
  *         self.node = None
  *         self.depth = 0             # <<<<<<<<<<<<<<
  * 
  * 
  */
-  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_depth, __pyx_int_0) < 0) __PYX_ERR(0, 1757, __pyx_L1_error)
+  if (__Pyx_PyObject_SetAttrStr(__pyx_v_self, __pyx_n_s_depth, __pyx_int_0) < 0) __PYX_ERR(0, 1794, __pyx_L1_error)
 
-  /* "resiliparse/parse/html.pyx":1755
+  /* "resiliparse/parse/html.pyx":1792
  *     :ivar int depth: the current traversal depth
  *     """
  *     def __init__(self):             # <<<<<<<<<<<<<<
  *         self.node = None
  *         self.depth = 0
  */
 
@@ -22284,15 +22826,15 @@
   __pyx_r = NULL;
   __pyx_L0:;
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":1760
+/* "resiliparse/parse/html.pyx":1797
  * 
  * 
  * def traverse_dom(DOMNode base_node, start_callback, end_callback=None, context=None, bint elements_only=False):             # <<<<<<<<<<<<<<
  *     """
  *     traverse_dom(base_node, start_callback, end_callback=None, context=None, elements_only=False)
  */
 
@@ -22339,15 +22881,15 @@
         case  0:
         if (likely((values[0] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_base_node)) != 0)) kw_args--;
         else goto __pyx_L5_argtuple_error;
         CYTHON_FALLTHROUGH;
         case  1:
         if (likely((values[1] = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_start_callback)) != 0)) kw_args--;
         else {
-          __Pyx_RaiseArgtupleInvalid("traverse_dom", 0, 2, 5, 1); __PYX_ERR(0, 1760, __pyx_L3_error)
+          __Pyx_RaiseArgtupleInvalid("traverse_dom", 0, 2, 5, 1); __PYX_ERR(0, 1797, __pyx_L3_error)
         }
         CYTHON_FALLTHROUGH;
         case  2:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_end_callback);
           if (value) { values[2] = value; kw_args--; }
         }
@@ -22361,15 +22903,15 @@
         case  4:
         if (kw_args > 0) {
           PyObject* value = __Pyx_PyDict_GetItemStr(__pyx_kwds, __pyx_n_s_elements_only);
           if (value) { values[4] = value; kw_args--; }
         }
       }
       if (unlikely(kw_args > 0)) {
-        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "traverse_dom") < 0)) __PYX_ERR(0, 1760, __pyx_L3_error)
+        if (unlikely(__Pyx_ParseOptionalKeywords(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "traverse_dom") < 0)) __PYX_ERR(0, 1797, __pyx_L3_error)
       }
     } else {
       switch (PyTuple_GET_SIZE(__pyx_args)) {
         case  5: values[4] = PyTuple_GET_ITEM(__pyx_args, 4);
         CYTHON_FALLTHROUGH;
         case  4: values[3] = PyTuple_GET_ITEM(__pyx_args, 3);
         CYTHON_FALLTHROUGH;
@@ -22382,28 +22924,28 @@
       }
     }
     __pyx_v_base_node = ((struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *)values[0]);
     __pyx_v_start_callback = values[1];
     __pyx_v_end_callback = values[2];
     __pyx_v_context = values[3];
     if (values[4]) {
-      __pyx_v_elements_only = __Pyx_PyObject_IsTrue(values[4]); if (unlikely((__pyx_v_elements_only == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 1760, __pyx_L3_error)
+      __pyx_v_elements_only = __Pyx_PyObject_IsTrue(values[4]); if (unlikely((__pyx_v_elements_only == (int)-1) && PyErr_Occurred())) __PYX_ERR(0, 1797, __pyx_L3_error)
     } else {
       __pyx_v_elements_only = ((int)0);
     }
   }
   goto __pyx_L4_argument_unpacking_done;
   __pyx_L5_argtuple_error:;
-  __Pyx_RaiseArgtupleInvalid("traverse_dom", 0, 2, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1760, __pyx_L3_error)
+  __Pyx_RaiseArgtupleInvalid("traverse_dom", 0, 2, 5, PyTuple_GET_SIZE(__pyx_args)); __PYX_ERR(0, 1797, __pyx_L3_error)
   __pyx_L3_error:;
   __Pyx_AddTraceback("resiliparse.parse.html.traverse_dom", __pyx_clineno, __pyx_lineno, __pyx_filename);
   __Pyx_RefNannyFinishContext();
   return NULL;
   __pyx_L4_argument_unpacking_done:;
-  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_base_node), __pyx_ptype_11resiliparse_5parse_4html_DOMNode, 1, "base_node", 0))) __PYX_ERR(0, 1760, __pyx_L1_error)
+  if (unlikely(!__Pyx_ArgTypeTest(((PyObject *)__pyx_v_base_node), __pyx_ptype_11resiliparse_5parse_4html_DOMNode, 1, "base_node", 0))) __PYX_ERR(0, 1797, __pyx_L1_error)
   __pyx_r = __pyx_pf_11resiliparse_5parse_4html_traverse_dom(__pyx_self, __pyx_v_base_node, __pyx_v_start_callback, __pyx_v_end_callback, __pyx_v_context, __pyx_v_elements_only);
 
   /* function exit code */
   goto __pyx_L0;
   __pyx_L1_error:;
   __pyx_r = NULL;
   __pyx_L0:;
@@ -22430,58 +22972,58 @@
   struct __pyx_opt_args_11resiliparse_5parse_4html_next_node __pyx_t_10;
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("traverse_dom", 0);
   __Pyx_INCREF(__pyx_v_context);
 
-  /* "resiliparse/parse/html.pyx":1788
+  /* "resiliparse/parse/html.pyx":1825
  *     """
  * 
  *     cdef lxb_dom_node_t* node = base_node.node             # <<<<<<<<<<<<<<
  *     cdef size_t depth = 0
  *     cdef bint is_end_tag = False
  */
   __pyx_t_1 = __pyx_v_base_node->node;
   __pyx_v_node = __pyx_t_1;
 
-  /* "resiliparse/parse/html.pyx":1789
+  /* "resiliparse/parse/html.pyx":1826
  * 
  *     cdef lxb_dom_node_t* node = base_node.node
  *     cdef size_t depth = 0             # <<<<<<<<<<<<<<
  *     cdef bint is_end_tag = False
  *     cdef bint* is_end_tag_ptr = &is_end_tag if end_callback is not None else NULL
  */
   __pyx_v_depth = 0;
 
-  /* "resiliparse/parse/html.pyx":1790
+  /* "resiliparse/parse/html.pyx":1827
  *     cdef lxb_dom_node_t* node = base_node.node
  *     cdef size_t depth = 0
  *     cdef bint is_end_tag = False             # <<<<<<<<<<<<<<
  *     cdef bint* is_end_tag_ptr = &is_end_tag if end_callback is not None else NULL
  * 
  */
   __pyx_v_is_end_tag = 0;
 
-  /* "resiliparse/parse/html.pyx":1791
+  /* "resiliparse/parse/html.pyx":1828
  *     cdef size_t depth = 0
  *     cdef bint is_end_tag = False
  *     cdef bint* is_end_tag_ptr = &is_end_tag if end_callback is not None else NULL             # <<<<<<<<<<<<<<
  * 
  *     if elements_only and base_node.node.type != LXB_DOM_NODE_TYPE_ELEMENT:
  */
   __pyx_t_3 = (__pyx_v_end_callback != Py_None);
   if ((__pyx_t_3 != 0)) {
     __pyx_t_2 = (&__pyx_v_is_end_tag);
   } else {
     __pyx_t_2 = NULL;
   }
   __pyx_v_is_end_tag_ptr = __pyx_t_2;
 
-  /* "resiliparse/parse/html.pyx":1793
+  /* "resiliparse/parse/html.pyx":1830
  *     cdef bint* is_end_tag_ptr = &is_end_tag if end_callback is not None else NULL
  * 
  *     if elements_only and base_node.node.type != LXB_DOM_NODE_TYPE_ELEMENT:             # <<<<<<<<<<<<<<
  *         return
  * 
  */
   __pyx_t_4 = (__pyx_v_elements_only != 0);
@@ -22491,121 +23033,121 @@
     goto __pyx_L4_bool_binop_done;
   }
   __pyx_t_4 = ((__pyx_v_base_node->node->type != LXB_DOM_NODE_TYPE_ELEMENT) != 0);
   __pyx_t_3 = __pyx_t_4;
   __pyx_L4_bool_binop_done:;
   if (__pyx_t_3) {
 
-    /* "resiliparse/parse/html.pyx":1794
+    /* "resiliparse/parse/html.pyx":1831
  * 
  *     if elements_only and base_node.node.type != LXB_DOM_NODE_TYPE_ELEMENT:
  *         return             # <<<<<<<<<<<<<<
  * 
  *     context = context or DOMContext()
  */
     __Pyx_XDECREF(__pyx_r);
     __pyx_r = Py_None; __Pyx_INCREF(Py_None);
     goto __pyx_L0;
 
-    /* "resiliparse/parse/html.pyx":1793
+    /* "resiliparse/parse/html.pyx":1830
  *     cdef bint* is_end_tag_ptr = &is_end_tag if end_callback is not None else NULL
  * 
  *     if elements_only and base_node.node.type != LXB_DOM_NODE_TYPE_ELEMENT:             # <<<<<<<<<<<<<<
  *         return
  * 
  */
   }
 
-  /* "resiliparse/parse/html.pyx":1796
+  /* "resiliparse/parse/html.pyx":1833
  *         return
  * 
  *     context = context or DOMContext()             # <<<<<<<<<<<<<<
  * 
  *     while node:
  */
-  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_v_context); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 1796, __pyx_L1_error)
+  __pyx_t_3 = __Pyx_PyObject_IsTrue(__pyx_v_context); if (unlikely(__pyx_t_3 < 0)) __PYX_ERR(0, 1833, __pyx_L1_error)
   if (!__pyx_t_3) {
   } else {
     __Pyx_INCREF(__pyx_v_context);
     __pyx_t_5 = __pyx_v_context;
     goto __pyx_L6_bool_binop_done;
   }
-  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_DOMContext); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1796, __pyx_L1_error)
+  __Pyx_GetModuleGlobalName(__pyx_t_7, __pyx_n_s_DOMContext); if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 1833, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_7);
   __pyx_t_8 = NULL;
   if (CYTHON_UNPACK_METHODS && unlikely(PyMethod_Check(__pyx_t_7))) {
     __pyx_t_8 = PyMethod_GET_SELF(__pyx_t_7);
     if (likely(__pyx_t_8)) {
       PyObject* function = PyMethod_GET_FUNCTION(__pyx_t_7);
       __Pyx_INCREF(__pyx_t_8);
       __Pyx_INCREF(function);
       __Pyx_DECREF_SET(__pyx_t_7, function);
     }
   }
   __pyx_t_6 = (__pyx_t_8) ? __Pyx_PyObject_CallOneArg(__pyx_t_7, __pyx_t_8) : __Pyx_PyObject_CallNoArg(__pyx_t_7);
   __Pyx_XDECREF(__pyx_t_8); __pyx_t_8 = 0;
-  if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1796, __pyx_L1_error)
+  if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1833, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_6);
   __Pyx_DECREF(__pyx_t_7); __pyx_t_7 = 0;
   __Pyx_INCREF(__pyx_t_6);
   __pyx_t_5 = __pyx_t_6;
   __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
   __pyx_L6_bool_binop_done:;
   __Pyx_DECREF_SET(__pyx_v_context, __pyx_t_5);
   __pyx_t_5 = 0;
 
-  /* "resiliparse/parse/html.pyx":1798
+  /* "resiliparse/parse/html.pyx":1835
  *     context = context or DOMContext()
  * 
  *     while node:             # <<<<<<<<<<<<<<
  *         context.node = _create_dom_node(base_node.tree, node)
  *         context.depth = depth
  */
   while (1) {
     __pyx_t_3 = (__pyx_v_node != 0);
     if (!__pyx_t_3) break;
 
-    /* "resiliparse/parse/html.pyx":1799
+    /* "resiliparse/parse/html.pyx":1836
  * 
  *     while node:
  *         context.node = _create_dom_node(base_node.tree, node)             # <<<<<<<<<<<<<<
  *         context.depth = depth
  * 
  */
     __pyx_t_5 = ((PyObject *)__pyx_v_base_node->tree);
     __Pyx_INCREF(__pyx_t_5);
-    __pyx_t_6 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html__create_dom_node(((struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *)__pyx_t_5), __pyx_v_node)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1799, __pyx_L1_error)
+    __pyx_t_6 = ((PyObject *)__pyx_f_11resiliparse_5parse_4html__create_dom_node(((struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *)__pyx_t_5), __pyx_v_node)); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1836, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
     __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
-    if (__Pyx_PyObject_SetAttrStr(__pyx_v_context, __pyx_n_s_node, __pyx_t_6) < 0) __PYX_ERR(0, 1799, __pyx_L1_error)
+    if (__Pyx_PyObject_SetAttrStr(__pyx_v_context, __pyx_n_s_node, __pyx_t_6) < 0) __PYX_ERR(0, 1836, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
 
-    /* "resiliparse/parse/html.pyx":1800
+    /* "resiliparse/parse/html.pyx":1837
  *     while node:
  *         context.node = _create_dom_node(base_node.tree, node)
  *         context.depth = depth             # <<<<<<<<<<<<<<
  * 
  *         if not is_end_tag:
  */
-    __pyx_t_6 = __Pyx_PyInt_FromSize_t(__pyx_v_depth); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1800, __pyx_L1_error)
+    __pyx_t_6 = __Pyx_PyInt_FromSize_t(__pyx_v_depth); if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1837, __pyx_L1_error)
     __Pyx_GOTREF(__pyx_t_6);
-    if (__Pyx_PyObject_SetAttrStr(__pyx_v_context, __pyx_n_s_depth, __pyx_t_6) < 0) __PYX_ERR(0, 1800, __pyx_L1_error)
+    if (__Pyx_PyObject_SetAttrStr(__pyx_v_context, __pyx_n_s_depth, __pyx_t_6) < 0) __PYX_ERR(0, 1837, __pyx_L1_error)
     __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
 
-    /* "resiliparse/parse/html.pyx":1802
+    /* "resiliparse/parse/html.pyx":1839
  *         context.depth = depth
  * 
  *         if not is_end_tag:             # <<<<<<<<<<<<<<
  *             start_callback(context)
  *         else:
  */
     __pyx_t_3 = ((!(__pyx_v_is_end_tag != 0)) != 0);
     if (__pyx_t_3) {
 
-      /* "resiliparse/parse/html.pyx":1803
+      /* "resiliparse/parse/html.pyx":1840
  * 
  *         if not is_end_tag:
  *             start_callback(context)             # <<<<<<<<<<<<<<
  *         else:
  *             end_callback(context)
  */
       __Pyx_INCREF(__pyx_v_start_callback);
@@ -22617,30 +23159,30 @@
           __Pyx_INCREF(__pyx_t_7);
           __Pyx_INCREF(function);
           __Pyx_DECREF_SET(__pyx_t_5, function);
         }
       }
       __pyx_t_6 = (__pyx_t_7) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_7, __pyx_v_context) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_v_context);
       __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
-      if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1803, __pyx_L1_error)
+      if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1840, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_6);
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
 
-      /* "resiliparse/parse/html.pyx":1802
+      /* "resiliparse/parse/html.pyx":1839
  *         context.depth = depth
  * 
  *         if not is_end_tag:             # <<<<<<<<<<<<<<
  *             start_callback(context)
  *         else:
  */
       goto __pyx_L10;
     }
 
-    /* "resiliparse/parse/html.pyx":1805
+    /* "resiliparse/parse/html.pyx":1842
  *             start_callback(context)
  *         else:
  *             end_callback(context)             # <<<<<<<<<<<<<<
  * 
  *         if elements_only:
  */
     /*else*/ {
@@ -22653,55 +23195,55 @@
           __Pyx_INCREF(__pyx_t_7);
           __Pyx_INCREF(function);
           __Pyx_DECREF_SET(__pyx_t_5, function);
         }
       }
       __pyx_t_6 = (__pyx_t_7) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_7, __pyx_v_context) : __Pyx_PyObject_CallOneArg(__pyx_t_5, __pyx_v_context);
       __Pyx_XDECREF(__pyx_t_7); __pyx_t_7 = 0;
-      if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1805, __pyx_L1_error)
+      if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 1842, __pyx_L1_error)
       __Pyx_GOTREF(__pyx_t_6);
       __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
       __Pyx_DECREF(__pyx_t_6); __pyx_t_6 = 0;
     }
     __pyx_L10:;
 
-    /* "resiliparse/parse/html.pyx":1807
+    /* "resiliparse/parse/html.pyx":1844
  *             end_callback(context)
  * 
  *         if elements_only:             # <<<<<<<<<<<<<<
  *             node = next_element_node(base_node.node, node, &depth, is_end_tag_ptr)
  *         else:
  */
     __pyx_t_3 = (__pyx_v_elements_only != 0);
     if (__pyx_t_3) {
 
-      /* "resiliparse/parse/html.pyx":1808
+      /* "resiliparse/parse/html.pyx":1845
  * 
  *         if elements_only:
  *             node = next_element_node(base_node.node, node, &depth, is_end_tag_ptr)             # <<<<<<<<<<<<<<
  *         else:
  *             node = next_node(base_node.node, node, &depth, is_end_tag_ptr)
  */
       __pyx_t_9.__pyx_n = 2;
       __pyx_t_9.depth = (&__pyx_v_depth);
       __pyx_t_9.end_tag = __pyx_v_is_end_tag_ptr;
       __pyx_t_1 = __pyx_f_11resiliparse_5parse_4html_next_element_node(__pyx_v_base_node->node, __pyx_v_node, &__pyx_t_9); 
       __pyx_v_node = __pyx_t_1;
 
-      /* "resiliparse/parse/html.pyx":1807
+      /* "resiliparse/parse/html.pyx":1844
  *             end_callback(context)
  * 
  *         if elements_only:             # <<<<<<<<<<<<<<
  *             node = next_element_node(base_node.node, node, &depth, is_end_tag_ptr)
  *         else:
  */
       goto __pyx_L11;
     }
 
-    /* "resiliparse/parse/html.pyx":1810
+    /* "resiliparse/parse/html.pyx":1847
  *             node = next_element_node(base_node.node, node, &depth, is_end_tag_ptr)
  *         else:
  *             node = next_node(base_node.node, node, &depth, is_end_tag_ptr)             # <<<<<<<<<<<<<<
  * 
  * 
  */
     /*else*/ {
@@ -22710,15 +23252,15 @@
       __pyx_t_10.end_tag = __pyx_v_is_end_tag_ptr;
       __pyx_t_1 = __pyx_f_11resiliparse_5parse_4html_next_node(__pyx_v_base_node->node, __pyx_v_node, &__pyx_t_10); 
       __pyx_v_node = __pyx_t_1;
     }
     __pyx_L11:;
   }
 
-  /* "resiliparse/parse/html.pyx":1760
+  /* "resiliparse/parse/html.pyx":1797
  * 
  * 
  * def traverse_dom(DOMNode base_node, start_callback, end_callback=None, context=None, bint elements_only=False):             # <<<<<<<<<<<<<<
  *     """
  *     traverse_dom(base_node, start_callback, end_callback=None, context=None, elements_only=False)
  */
 
@@ -22735,15 +23277,15 @@
   __pyx_L0:;
   __Pyx_XDECREF(__pyx_v_context);
   __Pyx_XGIVEREF(__pyx_r);
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pyx":1813
+/* "resiliparse/parse/html.pyx":1850
  * 
  * 
  * cdef bint is_block_element(lxb_tag_id_t tag_id) nogil:             # <<<<<<<<<<<<<<
  *     """
  *     Check whether an element is a block-level element.
  */
 
@@ -22751,64 +23293,64 @@
   size_t __pyx_v_i;
   int __pyx_r;
   size_t __pyx_t_1;
   size_t __pyx_t_2;
   size_t __pyx_t_3;
   int __pyx_t_4;
 
-  /* "resiliparse/parse/html.pyx":1818
+  /* "resiliparse/parse/html.pyx":1855
  *     """
  *     cdef size_t i
  *     for i in range(NUM_BLOCK_ELEMENTS):             # <<<<<<<<<<<<<<
  *         if BLOCK_ELEMENTS[i] == tag_id:
  *             return True
  */
   __pyx_t_1 = NUM_BLOCK_ELEMENTS;
   __pyx_t_2 = __pyx_t_1;
   for (__pyx_t_3 = 0; __pyx_t_3 < __pyx_t_2; __pyx_t_3+=1) {
     __pyx_v_i = __pyx_t_3;
 
-    /* "resiliparse/parse/html.pyx":1819
+    /* "resiliparse/parse/html.pyx":1856
  *     cdef size_t i
  *     for i in range(NUM_BLOCK_ELEMENTS):
  *         if BLOCK_ELEMENTS[i] == tag_id:             # <<<<<<<<<<<<<<
  *             return True
  *     return False
  */
     __pyx_t_4 = (((BLOCK_ELEMENTS[__pyx_v_i]) == __pyx_v_tag_id) != 0);
     if (__pyx_t_4) {
 
-      /* "resiliparse/parse/html.pyx":1820
+      /* "resiliparse/parse/html.pyx":1857
  *     for i in range(NUM_BLOCK_ELEMENTS):
  *         if BLOCK_ELEMENTS[i] == tag_id:
  *             return True             # <<<<<<<<<<<<<<
  *     return False
  */
       __pyx_r = 1;
       goto __pyx_L0;
 
-      /* "resiliparse/parse/html.pyx":1819
+      /* "resiliparse/parse/html.pyx":1856
  *     cdef size_t i
  *     for i in range(NUM_BLOCK_ELEMENTS):
  *         if BLOCK_ELEMENTS[i] == tag_id:             # <<<<<<<<<<<<<<
  *             return True
  *     return False
  */
     }
   }
 
-  /* "resiliparse/parse/html.pyx":1821
+  /* "resiliparse/parse/html.pyx":1858
  *         if BLOCK_ELEMENTS[i] == tag_id:
  *             return True
  *     return False             # <<<<<<<<<<<<<<
  */
   __pyx_r = 0;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pyx":1813
+  /* "resiliparse/parse/html.pyx":1850
  * 
  * 
  * cdef bint is_block_element(lxb_tag_id_t tag_id) nogil:             # <<<<<<<<<<<<<<
  *     """
  *     Check whether an element is a block-level element.
  */
 
@@ -22834,15 +23376,15 @@
   __Pyx_RefNannySetupContext("check_node", 0);
 
   /* "resiliparse/parse/html.pxd":23
  * cdef inline bint check_node(DOMNode node):
  *     """Check whether node is initialized and valid."""
  *     return node is not None and node.tree is not None and node.node != NULL             # <<<<<<<<<<<<<<
  * 
- * 
+ * cdef bint init_css_parser(lxb_css_parser_t** parser) except 0
  */
   __pyx_t_2 = (((PyObject *)__pyx_v_node) != Py_None);
   __pyx_t_3 = (__pyx_t_2 != 0);
   if (__pyx_t_3) {
   } else {
     __pyx_t_1 = __pyx_t_3;
     goto __pyx_L3_bool_binop_done;
@@ -22870,25 +23412,25 @@
 
   /* function exit code */
   __pyx_L0:;
   __Pyx_RefNannyFinishContext();
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pxd":29
+/* "resiliparse/parse/html.pxd":36
  *                                size_t* depth=*, bint* end_tag=*) nogil
  * 
  * cdef inline lxb_dom_node_t* next_element_node(const lxb_dom_node_t* root_node, lxb_dom_node_t* node,             # <<<<<<<<<<<<<<
  *                                               size_t* depth=NULL, bint* end_tag=NULL) nogil:
  *     node = next_node(root_node, node, depth, end_tag)
  */
 
 static CYTHON_INLINE lxb_dom_node_t *__pyx_f_11resiliparse_5parse_4html_next_element_node(lxb_dom_node_t const *__pyx_v_root_node, lxb_dom_node_t *__pyx_v_node, struct __pyx_opt_args_11resiliparse_5parse_4html_next_element_node *__pyx_optional_args) {
 
-  /* "resiliparse/parse/html.pxd":30
+  /* "resiliparse/parse/html.pxd":37
  * 
  * cdef inline lxb_dom_node_t* next_element_node(const lxb_dom_node_t* root_node, lxb_dom_node_t* node,
  *                                               size_t* depth=NULL, bint* end_tag=NULL) nogil:             # <<<<<<<<<<<<<<
  *     node = next_node(root_node, node, depth, end_tag)
  *     while node and node.type != LXB_DOM_NODE_TYPE_ELEMENT:
  */
   size_t *__pyx_v_depth = ((size_t *)NULL);
@@ -22903,28 +23445,28 @@
       __pyx_v_depth = __pyx_optional_args->depth;
       if (__pyx_optional_args->__pyx_n > 1) {
         __pyx_v_end_tag = __pyx_optional_args->end_tag;
       }
     }
   }
 
-  /* "resiliparse/parse/html.pxd":31
+  /* "resiliparse/parse/html.pxd":38
  * cdef inline lxb_dom_node_t* next_element_node(const lxb_dom_node_t* root_node, lxb_dom_node_t* node,
  *                                               size_t* depth=NULL, bint* end_tag=NULL) nogil:
  *     node = next_node(root_node, node, depth, end_tag)             # <<<<<<<<<<<<<<
  *     while node and node.type != LXB_DOM_NODE_TYPE_ELEMENT:
  *         node = next_node(root_node, node, depth, end_tag)
  */
   __pyx_t_2.__pyx_n = 2;
   __pyx_t_2.depth = __pyx_v_depth;
   __pyx_t_2.end_tag = __pyx_v_end_tag;
   __pyx_t_1 = __pyx_f_11resiliparse_5parse_4html_next_node(__pyx_v_root_node, __pyx_v_node, &__pyx_t_2); 
   __pyx_v_node = __pyx_t_1;
 
-  /* "resiliparse/parse/html.pxd":32
+  /* "resiliparse/parse/html.pxd":39
  *                                               size_t* depth=NULL, bint* end_tag=NULL) nogil:
  *     node = next_node(root_node, node, depth, end_tag)
  *     while node and node.type != LXB_DOM_NODE_TYPE_ELEMENT:             # <<<<<<<<<<<<<<
  *         node = next_node(root_node, node, depth, end_tag)
  *     return node
  */
   while (1) {
@@ -22935,129 +23477,129 @@
       goto __pyx_L5_bool_binop_done;
     }
     __pyx_t_4 = ((__pyx_v_node->type != LXB_DOM_NODE_TYPE_ELEMENT) != 0);
     __pyx_t_3 = __pyx_t_4;
     __pyx_L5_bool_binop_done:;
     if (!__pyx_t_3) break;
 
-    /* "resiliparse/parse/html.pxd":33
+    /* "resiliparse/parse/html.pxd":40
  *     node = next_node(root_node, node, depth, end_tag)
  *     while node and node.type != LXB_DOM_NODE_TYPE_ELEMENT:
  *         node = next_node(root_node, node, depth, end_tag)             # <<<<<<<<<<<<<<
  *     return node
  * 
  */
     __pyx_t_2.__pyx_n = 2;
     __pyx_t_2.depth = __pyx_v_depth;
     __pyx_t_2.end_tag = __pyx_v_end_tag;
     __pyx_t_1 = __pyx_f_11resiliparse_5parse_4html_next_node(__pyx_v_root_node, __pyx_v_node, &__pyx_t_2); 
     __pyx_v_node = __pyx_t_1;
   }
 
-  /* "resiliparse/parse/html.pxd":34
+  /* "resiliparse/parse/html.pxd":41
  *     while node and node.type != LXB_DOM_NODE_TYPE_ELEMENT:
  *         node = next_node(root_node, node, depth, end_tag)
  *     return node             # <<<<<<<<<<<<<<
  * 
  * cdef inline string_view get_node_attr_sv(lxb_dom_node_t* node, const string& attr) nogil:
  */
   __pyx_r = __pyx_v_node;
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pxd":29
+  /* "resiliparse/parse/html.pxd":36
  *                                size_t* depth=*, bint* end_tag=*) nogil
  * 
  * cdef inline lxb_dom_node_t* next_element_node(const lxb_dom_node_t* root_node, lxb_dom_node_t* node,             # <<<<<<<<<<<<<<
  *                                               size_t* depth=NULL, bint* end_tag=NULL) nogil:
  *     node = next_node(root_node, node, depth, end_tag)
  */
 
   /* function exit code */
   __pyx_L0:;
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pxd":36
+/* "resiliparse/parse/html.pxd":43
  *     return node
  * 
  * cdef inline string_view get_node_attr_sv(lxb_dom_node_t* node, const string& attr) nogil:             # <<<<<<<<<<<<<<
  *     """Get node attribute value as string_view."""
  *     cdef size_t node_attr_len
  */
 
 static CYTHON_INLINE std::string_view __pyx_f_11resiliparse_5parse_4html_get_node_attr_sv(lxb_dom_node_t *__pyx_v_node, std::string const &__pyx_v_attr) {
   size_t __pyx_v_node_attr_len;
   lxb_char_t const *__pyx_v_node_attr_data;
   std::string_view __pyx_r;
 
-  /* "resiliparse/parse/html.pxd":39
+  /* "resiliparse/parse/html.pxd":46
  *     """Get node attribute value as string_view."""
  *     cdef size_t node_attr_len
  *     cdef const lxb_char_t* node_attr_data = lxb_dom_element_get_attribute(             # <<<<<<<<<<<<<<
  *         <lxb_dom_element_t*>node, <lxb_char_t*>attr.data(), attr.size(), &node_attr_len)
  *     return string_view(<const char*>node_attr_data, node_attr_len)
  */
   __pyx_v_node_attr_data = lxb_dom_element_get_attribute(((lxb_dom_element_t *)__pyx_v_node), ((lxb_char_t *)__pyx_v_attr.data()), __pyx_v_attr.size(), (&__pyx_v_node_attr_len));
 
-  /* "resiliparse/parse/html.pxd":41
+  /* "resiliparse/parse/html.pxd":48
  *     cdef const lxb_char_t* node_attr_data = lxb_dom_element_get_attribute(
  *         <lxb_dom_element_t*>node, <lxb_char_t*>attr.data(), attr.size(), &node_attr_len)
  *     return string_view(<const char*>node_attr_data, node_attr_len)             # <<<<<<<<<<<<<<
  * 
  * cdef inline StringPiece get_node_attr_sp(lxb_dom_node_t* node, const string& attr) nogil:
  */
   __pyx_r = std::string_view(((char const *)__pyx_v_node_attr_data), __pyx_v_node_attr_len);
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pxd":36
+  /* "resiliparse/parse/html.pxd":43
  *     return node
  * 
  * cdef inline string_view get_node_attr_sv(lxb_dom_node_t* node, const string& attr) nogil:             # <<<<<<<<<<<<<<
  *     """Get node attribute value as string_view."""
  *     cdef size_t node_attr_len
  */
 
   /* function exit code */
   __pyx_L0:;
   return __pyx_r;
 }
 
-/* "resiliparse/parse/html.pxd":43
+/* "resiliparse/parse/html.pxd":50
  *     return string_view(<const char*>node_attr_data, node_attr_len)
  * 
  * cdef inline StringPiece get_node_attr_sp(lxb_dom_node_t* node, const string& attr) nogil:             # <<<<<<<<<<<<<<
  *     """Get node attribute value as RE2 StringPiece."""
  *     cdef size_t node_attr_len
  */
 
 static CYTHON_INLINE re2::StringPiece __pyx_f_11resiliparse_5parse_4html_get_node_attr_sp(lxb_dom_node_t *__pyx_v_node, std::string const &__pyx_v_attr) {
   size_t __pyx_v_node_attr_len;
   lxb_char_t const *__pyx_v_node_attr_data;
   re2::StringPiece __pyx_r;
 
-  /* "resiliparse/parse/html.pxd":46
+  /* "resiliparse/parse/html.pxd":53
  *     """Get node attribute value as RE2 StringPiece."""
  *     cdef size_t node_attr_len
  *     cdef const lxb_char_t* node_attr_data = lxb_dom_element_get_attribute(             # <<<<<<<<<<<<<<
  *         <lxb_dom_element_t*>node, <lxb_char_t*>attr.data(), attr.size(), &node_attr_len)
  *     return StringPiece(<const char*>node_attr_data, node_attr_len)
  */
   __pyx_v_node_attr_data = lxb_dom_element_get_attribute(((lxb_dom_element_t *)__pyx_v_node), ((lxb_char_t *)__pyx_v_attr.data()), __pyx_v_attr.size(), (&__pyx_v_node_attr_len));
 
-  /* "resiliparse/parse/html.pxd":48
+  /* "resiliparse/parse/html.pxd":55
  *     cdef const lxb_char_t* node_attr_data = lxb_dom_element_get_attribute(
  *         <lxb_dom_element_t*>node, <lxb_char_t*>attr.data(), attr.size(), &node_attr_len)
  *     return StringPiece(<const char*>node_attr_data, node_attr_len)             # <<<<<<<<<<<<<<
  * 
  * cdef string get_node_text(lxb_dom_node_t* node) nogil
  */
   __pyx_r = re2::StringPiece(((char const *)__pyx_v_node_attr_data), __pyx_v_node_attr_len);
   goto __pyx_L0;
 
-  /* "resiliparse/parse/html.pxd":43
+  /* "resiliparse/parse/html.pxd":50
  *     return string_view(<const char*>node_attr_data, node_attr_len)
  * 
  * cdef inline StringPiece get_node_attr_sp(lxb_dom_node_t* node, const string& attr) nogil:             # <<<<<<<<<<<<<<
  *     """Get node attribute value as RE2 StringPiece."""
  *     cdef size_t node_attr_len
  */
 
@@ -25108,14 +25650,17 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
+  #if PY_VERSION_HEX >= 0x030B00A2
+  0, /*tp_inline_values_offset*/
+  #endif
 };
 static struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMNode __pyx_vtable_11resiliparse_5parse_4html_DOMNode;
 
 static PyObject *__pyx_tp_new_11resiliparse_5parse_4html_DOMNode(PyTypeObject *t, PyObject *a, PyObject *k) {
   struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *p;
   PyObject *o;
   if (likely((t->tp_flags & Py_TPFLAGS_IS_ABSTRACT) == 0)) {
@@ -25461,14 +26006,17 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
+  #if PY_VERSION_HEX >= 0x030B00A2
+  0, /*tp_inline_values_offset*/
+  #endif
 };
 static struct __pyx_vtabstruct_11resiliparse_5parse_4html_DOMCollection __pyx_vtable_11resiliparse_5parse_4html_DOMCollection;
 
 static PyObject *__pyx_tp_new_11resiliparse_5parse_4html_DOMCollection(PyTypeObject *t, PyObject *a, PyObject *k) {
   struct __pyx_obj_11resiliparse_5parse_4html_DOMCollection *p;
   PyObject *o;
   if (likely((t->tp_flags & Py_TPFLAGS_IS_ABSTRACT) == 0)) {
@@ -25627,14 +26175,17 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
+  #if PY_VERSION_HEX >= 0x030B00A2
+  0, /*tp_inline_values_offset*/
+  #endif
 };
 static struct __pyx_vtabstruct_11resiliparse_5parse_4html_HTMLTree __pyx_vtable_11resiliparse_5parse_4html_HTMLTree;
 
 static PyObject *__pyx_tp_new_11resiliparse_5parse_4html_HTMLTree(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
   struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *p;
   PyObject *o;
   if (likely((t->tp_flags & Py_TPFLAGS_IS_ABSTRACT) == 0)) {
@@ -25769,14 +26320,17 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
+  #if PY_VERSION_HEX >= 0x030B00A2
+  0, /*tp_inline_values_offset*/
+  #endif
 };
 
 static struct __pyx_obj_11resiliparse_5parse_4html___pyx_scope_struct____iter__ *__pyx_freelist_11resiliparse_5parse_4html___pyx_scope_struct____iter__[8];
 static int __pyx_freecount_11resiliparse_5parse_4html___pyx_scope_struct____iter__ = 0;
 
 static PyObject *__pyx_tp_new_11resiliparse_5parse_4html___pyx_scope_struct____iter__(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
   PyObject *o;
@@ -25875,14 +26429,17 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
+  #if PY_VERSION_HEX >= 0x030B00A2
+  0, /*tp_inline_values_offset*/
+  #endif
 };
 
 static struct __pyx_obj_11resiliparse_5parse_4html___pyx_scope_struct_1___repr__ *__pyx_freelist_11resiliparse_5parse_4html___pyx_scope_struct_1___repr__[8];
 static int __pyx_freecount_11resiliparse_5parse_4html___pyx_scope_struct_1___repr__ = 0;
 
 static PyObject *__pyx_tp_new_11resiliparse_5parse_4html___pyx_scope_struct_1___repr__(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
   PyObject *o;
@@ -25990,14 +26547,17 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
+  #if PY_VERSION_HEX >= 0x030B00A2
+  0, /*tp_inline_values_offset*/
+  #endif
 };
 
 static struct __pyx_obj_11resiliparse_5parse_4html___pyx_scope_struct_2_genexpr *__pyx_freelist_11resiliparse_5parse_4html___pyx_scope_struct_2_genexpr[8];
 static int __pyx_freecount_11resiliparse_5parse_4html___pyx_scope_struct_2_genexpr = 0;
 
 static PyObject *__pyx_tp_new_11resiliparse_5parse_4html___pyx_scope_struct_2_genexpr(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
   PyObject *o;
@@ -26100,14 +26660,17 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
+  #if PY_VERSION_HEX >= 0x030B00A2
+  0, /*tp_inline_values_offset*/
+  #endif
 };
 
 static struct __pyx_obj_11resiliparse_5parse_4html___pyx_scope_struct_3___iter__ *__pyx_freelist_11resiliparse_5parse_4html___pyx_scope_struct_3___iter__[8];
 static int __pyx_freecount_11resiliparse_5parse_4html___pyx_scope_struct_3___iter__ = 0;
 
 static PyObject *__pyx_tp_new_11resiliparse_5parse_4html___pyx_scope_struct_3___iter__(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
   PyObject *o;
@@ -26206,14 +26769,17 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
+  #if PY_VERSION_HEX >= 0x030B00A2
+  0, /*tp_inline_values_offset*/
+  #endif
 };
 
 static struct __pyx_obj_11resiliparse_5parse_4html___pyx_scope_struct_4___repr__ *__pyx_freelist_11resiliparse_5parse_4html___pyx_scope_struct_4___repr__[8];
 static int __pyx_freecount_11resiliparse_5parse_4html___pyx_scope_struct_4___repr__ = 0;
 
 static PyObject *__pyx_tp_new_11resiliparse_5parse_4html___pyx_scope_struct_4___repr__(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
   PyObject *o;
@@ -26321,14 +26887,17 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
+  #if PY_VERSION_HEX >= 0x030B00A2
+  0, /*tp_inline_values_offset*/
+  #endif
 };
 
 static struct __pyx_obj_11resiliparse_5parse_4html___pyx_scope_struct_5_genexpr *__pyx_freelist_11resiliparse_5parse_4html___pyx_scope_struct_5_genexpr[8];
 static int __pyx_freecount_11resiliparse_5parse_4html___pyx_scope_struct_5_genexpr = 0;
 
 static PyObject *__pyx_tp_new_11resiliparse_5parse_4html___pyx_scope_struct_5_genexpr(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
   PyObject *o;
@@ -26431,14 +27000,17 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
+  #if PY_VERSION_HEX >= 0x030B00A2
+  0, /*tp_inline_values_offset*/
+  #endif
 };
 
 static PyObject *__pyx_tp_new___Pyx_EnumMeta(PyTypeObject *t, PyObject *a, PyObject *k) {
   PyObject *o = (&PyType_Type)->tp_new(t, a, k);
   if (unlikely(!o)) return 0;
   return o;
 }
@@ -26560,14 +27132,17 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
+  #if PY_VERSION_HEX >= 0x030B00A2
+  0, /*tp_inline_values_offset*/
+  #endif
 };
 
 static PyMethodDef __pyx_methods[] = {
   {0, 0, 0, 0}
 };
 
 #if PY_MAJOR_VERSION >= 3
@@ -26612,14 +27187,15 @@
 #endif
 
 static __Pyx_StringTabEntry __pyx_string_tab[] = {
   {&__pyx_n_s_ATTRIBUTE, __pyx_k_ATTRIBUTE, sizeof(__pyx_k_ATTRIBUTE), 0, 0, 1, 1},
   {&__pyx_kp_u_Append_operation_on_uninitialize, __pyx_k_Append_operation_on_uninitialize, sizeof(__pyx_k_Append_operation_on_uninitialize), 0, 1, 0, 0},
   {&__pyx_n_s_CDATA_SECTION, __pyx_k_CDATA_SECTION, sizeof(__pyx_k_CDATA_SECTION), 0, 0, 1, 1},
   {&__pyx_n_s_COMMENT, __pyx_k_COMMENT, sizeof(__pyx_k_COMMENT), 0, 0, 1, 1},
+  {&__pyx_kp_u_CSS_parser_error, __pyx_k_CSS_parser_error, sizeof(__pyx_k_CSS_parser_error), 0, 1, 0, 0},
   {&__pyx_kp_u_Cannot_create_instance_directly, __pyx_k_Cannot_create_instance_directly, sizeof(__pyx_k_Cannot_create_instance_directly), 0, 1, 0, 0},
   {&__pyx_kp_u_DOCTYPE_html, __pyx_k_DOCTYPE_html, sizeof(__pyx_k_DOCTYPE_html), 0, 1, 0, 0},
   {&__pyx_n_s_DOCUMENT, __pyx_k_DOCUMENT, sizeof(__pyx_k_DOCUMENT), 0, 0, 1, 1},
   {&__pyx_n_s_DOCUMENT_FRAGMENT, __pyx_k_DOCUMENT_FRAGMENT, sizeof(__pyx_k_DOCUMENT_FRAGMENT), 0, 0, 1, 1},
   {&__pyx_n_s_DOCUMENT_TYPE, __pyx_k_DOCUMENT_TYPE, sizeof(__pyx_k_DOCUMENT_TYPE), 0, 0, 1, 1},
   {&__pyx_n_s_DOMCollection, __pyx_k_DOMCollection, sizeof(__pyx_k_DOMCollection), 0, 0, 1, 1},
   {&__pyx_n_s_DOMCollection___iter, __pyx_k_DOMCollection___iter, sizeof(__pyx_k_DOMCollection___iter), 0, 0, 1, 1},
@@ -26633,14 +27209,17 @@
   {&__pyx_n_s_ENTITY, __pyx_k_ENTITY, sizeof(__pyx_k_ENTITY), 0, 0, 1, 1},
   {&__pyx_n_s_ENTITY_REFERENCE, __pyx_k_ENTITY_REFERENCE, sizeof(__pyx_k_ENTITY_REFERENCE), 0, 0, 1, 1},
   {&__pyx_kp_u_Element, __pyx_k_Element, sizeof(__pyx_k_Element), 0, 1, 0, 0},
   {&__pyx_n_s_EnumBase, __pyx_k_EnumBase, sizeof(__pyx_k_EnumBase), 0, 0, 1, 1},
   {&__pyx_n_s_EnumType, __pyx_k_EnumType, sizeof(__pyx_k_EnumType), 0, 0, 1, 1},
   {&__pyx_kp_u_Failed_to_allocate_HTML_document, __pyx_k_Failed_to_allocate_HTML_document, sizeof(__pyx_k_Failed_to_allocate_HTML_document), 0, 1, 0, 0},
   {&__pyx_kp_u_Failed_to_create_DOM_collection, __pyx_k_Failed_to_create_DOM_collection, sizeof(__pyx_k_Failed_to_create_DOM_collection), 0, 1, 0, 0},
+  {&__pyx_kp_u_Failed_to_initialize_CSS_parser, __pyx_k_Failed_to_initialize_CSS_parser, sizeof(__pyx_k_Failed_to_initialize_CSS_parser), 0, 1, 0, 0},
+  {&__pyx_kp_u_Failed_to_initialize_CSS_selecto, __pyx_k_Failed_to_initialize_CSS_selecto, sizeof(__pyx_k_Failed_to_initialize_CSS_selecto), 0, 1, 0, 0},
+  {&__pyx_kp_u_Failed_to_initialize_elemetn_sel, __pyx_k_Failed_to_initialize_elemetn_sel, sizeof(__pyx_k_Failed_to_initialize_elemetn_sel), 0, 1, 0, 0},
   {&__pyx_kp_u_Failed_to_match_elements_by_CSS, __pyx_k_Failed_to_match_elements_by_CSS, sizeof(__pyx_k_Failed_to_match_elements_by_CSS), 0, 1, 0, 0},
   {&__pyx_kp_u_Failed_to_parse_HTML_document, __pyx_k_Failed_to_parse_HTML_document, sizeof(__pyx_k_Failed_to_parse_HTML_document), 0, 1, 0, 0},
   {&__pyx_n_s_HTMLTree, __pyx_k_HTMLTree, sizeof(__pyx_k_HTMLTree), 0, 0, 1, 1},
   {&__pyx_kp_u_HTML_Document, __pyx_k_HTML_Document, sizeof(__pyx_k_HTML_Document), 0, 1, 0, 0},
   {&__pyx_kp_u_INVALID_ELEMENT, __pyx_k_INVALID_ELEMENT, sizeof(__pyx_k_INVALID_ELEMENT), 0, 1, 0, 0},
   {&__pyx_kp_s_Incompatible_checksums_s_vs_0xd4, __pyx_k_Incompatible_checksums_s_vs_0xd4, sizeof(__pyx_k_Incompatible_checksums_s_vs_0xd4), 0, 0, 1, 0},
   {&__pyx_n_s_IndexError, __pyx_k_IndexError, sizeof(__pyx_k_IndexError), 0, 0, 1, 1},
@@ -26676,25 +27255,25 @@
   {&__pyx_kp_u_Trying_to_insert_node_as_its_own, __pyx_k_Trying_to_insert_node_as_its_own, sizeof(__pyx_k_Trying_to_insert_node_as_its_own), 0, 1, 0, 0},
   {&__pyx_kp_u_Trying_to_select_items_from_unin, __pyx_k_Trying_to_select_items_from_unin, sizeof(__pyx_k_Trying_to_select_items_from_unin), 0, 1, 0, 0},
   {&__pyx_kp_u_Trying_to_set_HTML_contents_of_u, __pyx_k_Trying_to_set_HTML_contents_of_u, sizeof(__pyx_k_Trying_to_set_HTML_contents_of_u), 0, 1, 0, 0},
   {&__pyx_kp_u_Trying_to_set_text_contents_of_u, __pyx_k_Trying_to_set_text_contents_of_u, sizeof(__pyx_k_Trying_to_set_text_contents_of_u), 0, 1, 0, 0},
   {&__pyx_n_s_TypeError, __pyx_k_TypeError, sizeof(__pyx_k_TypeError), 0, 0, 1, 1},
   {&__pyx_kp_s_Unknown_enum_value_s, __pyx_k_Unknown_enum_value_s, sizeof(__pyx_k_Unknown_enum_value_s), 0, 0, 1, 0},
   {&__pyx_n_s_ValueError, __pyx_k_ValueError, sizeof(__pyx_k_ValueError), 0, 0, 1, 1},
-  {&__pyx_kp_u__19, __pyx_k__19, sizeof(__pyx_k__19), 0, 1, 0, 0},
-  {&__pyx_kp_b__2, __pyx_k__2, sizeof(__pyx_k__2), 0, 0, 0, 0},
-  {&__pyx_kp_u__2, __pyx_k__2, sizeof(__pyx_k__2), 0, 1, 0, 0},
-  {&__pyx_kp_u__20, __pyx_k__20, sizeof(__pyx_k__20), 0, 1, 0, 0},
-  {&__pyx_kp_u__21, __pyx_k__21, sizeof(__pyx_k__21), 0, 1, 0, 0},
   {&__pyx_kp_u__22, __pyx_k__22, sizeof(__pyx_k__22), 0, 1, 0, 0},
-  {&__pyx_kp_u__28, __pyx_k__28, sizeof(__pyx_k__28), 0, 1, 0, 0},
-  {&__pyx_kp_u__29, __pyx_k__29, sizeof(__pyx_k__29), 0, 1, 0, 0},
-  {&__pyx_kp_b__3, __pyx_k__3, sizeof(__pyx_k__3), 0, 0, 0, 0},
-  {&__pyx_kp_u__3, __pyx_k__3, sizeof(__pyx_k__3), 0, 1, 0, 0},
-  {&__pyx_kp_u__30, __pyx_k__30, sizeof(__pyx_k__30), 0, 1, 0, 0},
+  {&__pyx_kp_u__23, __pyx_k__23, sizeof(__pyx_k__23), 0, 1, 0, 0},
+  {&__pyx_kp_u__24, __pyx_k__24, sizeof(__pyx_k__24), 0, 1, 0, 0},
+  {&__pyx_kp_u__25, __pyx_k__25, sizeof(__pyx_k__25), 0, 1, 0, 0},
+  {&__pyx_kp_u__31, __pyx_k__31, sizeof(__pyx_k__31), 0, 1, 0, 0},
+  {&__pyx_kp_u__32, __pyx_k__32, sizeof(__pyx_k__32), 0, 1, 0, 0},
+  {&__pyx_kp_u__33, __pyx_k__33, sizeof(__pyx_k__33), 0, 1, 0, 0},
+  {&__pyx_kp_b__5, __pyx_k__5, sizeof(__pyx_k__5), 0, 0, 0, 0},
+  {&__pyx_kp_u__5, __pyx_k__5, sizeof(__pyx_k__5), 0, 1, 0, 0},
+  {&__pyx_kp_b__6, __pyx_k__6, sizeof(__pyx_k__6), 0, 0, 0, 0},
+  {&__pyx_kp_u__6, __pyx_k__6, sizeof(__pyx_k__6), 0, 1, 0, 0},
   {&__pyx_n_s_add, __pyx_k_add, sizeof(__pyx_k_add), 0, 0, 1, 1},
   {&__pyx_n_s_append_child, __pyx_k_append_child, sizeof(__pyx_k_append_child), 0, 0, 1, 1},
   {&__pyx_n_s_args, __pyx_k_args, sizeof(__pyx_k_args), 0, 0, 1, 1},
   {&__pyx_n_s_attr_name, __pyx_k_attr_name, sizeof(__pyx_k_attr_name), 0, 0, 1, 1},
   {&__pyx_n_s_attr_value, __pyx_k_attr_value, sizeof(__pyx_k_attr_value), 0, 0, 1, 1},
   {&__pyx_n_s_attrs, __pyx_k_attrs, sizeof(__pyx_k_attrs), 0, 0, 1, 1},
   {&__pyx_n_s_base_node, __pyx_k_base_node, sizeof(__pyx_k_base_node), 0, 0, 1, 1},
@@ -26798,14 +27377,15 @@
   {&__pyx_n_s_setstate_cython, __pyx_k_setstate_cython, sizeof(__pyx_k_setstate_cython), 0, 0, 1, 1},
   {&__pyx_n_s_start, __pyx_k_start, sizeof(__pyx_k_start), 0, 0, 1, 1},
   {&__pyx_n_s_start_callback, __pyx_k_start_callback, sizeof(__pyx_k_start_callback), 0, 0, 1, 1},
   {&__pyx_n_s_step, __pyx_k_step, sizeof(__pyx_k_step), 0, 0, 1, 1},
   {&__pyx_n_s_stop, __pyx_k_stop, sizeof(__pyx_k_stop), 0, 0, 1, 1},
   {&__pyx_n_s_str, __pyx_k_str, sizeof(__pyx_k_str), 0, 0, 1, 1},
   {&__pyx_kp_s_stringsource, __pyx_k_stringsource, sizeof(__pyx_k_stringsource), 0, 0, 1, 0},
+  {&__pyx_n_s_strip, __pyx_k_strip, sizeof(__pyx_k_strip), 0, 0, 1, 1},
   {&__pyx_n_s_t, __pyx_k_t, sizeof(__pyx_k_t), 0, 0, 1, 1},
   {&__pyx_n_s_tag, __pyx_k_tag, sizeof(__pyx_k_tag), 0, 0, 1, 1},
   {&__pyx_n_s_test, __pyx_k_test, sizeof(__pyx_k_test), 0, 0, 1, 1},
   {&__pyx_n_s_text, __pyx_k_text, sizeof(__pyx_k_text), 0, 0, 1, 1},
   {&__pyx_n_s_throw, __pyx_k_throw, sizeof(__pyx_k_throw), 0, 0, 1, 1},
   {&__pyx_n_u_title, __pyx_k_title, sizeof(__pyx_k_title), 0, 1, 0, 1},
   {&__pyx_n_s_traverse_dom, __pyx_k_traverse_dom, sizeof(__pyx_k_traverse_dom), 0, 0, 1, 1},
@@ -26815,420 +27395,453 @@
   {&__pyx_kp_u_utf_8, __pyx_k_utf_8, sizeof(__pyx_k_utf_8), 0, 1, 0, 0},
   {&__pyx_n_s_v, __pyx_k_v, sizeof(__pyx_k_v), 0, 0, 1, 1},
   {&__pyx_n_s_value, __pyx_k_value, sizeof(__pyx_k_value), 0, 0, 1, 1},
   {&__pyx_n_s_values, __pyx_k_values, sizeof(__pyx_k_values), 0, 0, 1, 1},
   {0, 0, 0, 0, 0, 0, 0}
 };
 static CYTHON_SMALL_CODE int __Pyx_InitCachedBuiltins(void) {
-  __pyx_builtin_RuntimeError = __Pyx_GetBuiltinName(__pyx_n_s_RuntimeError); if (!__pyx_builtin_RuntimeError) __PYX_ERR(0, 200, __pyx_L1_error)
-  __pyx_builtin_range = __Pyx_GetBuiltinName(__pyx_n_s_range); if (!__pyx_builtin_range) __PYX_ERR(0, 314, __pyx_L1_error)
+  __pyx_builtin_RuntimeError = __Pyx_GetBuiltinName(__pyx_n_s_RuntimeError); if (!__pyx_builtin_RuntimeError) __PYX_ERR(0, 47, __pyx_L1_error)
+  __pyx_builtin_ValueError = __Pyx_GetBuiltinName(__pyx_n_s_ValueError); if (!__pyx_builtin_ValueError) __PYX_ERR(0, 88, __pyx_L1_error)
+  __pyx_builtin_range = __Pyx_GetBuiltinName(__pyx_n_s_range); if (!__pyx_builtin_range) __PYX_ERR(0, 360, __pyx_L1_error)
   __pyx_builtin_TypeError = __Pyx_GetBuiltinName(__pyx_n_s_TypeError); if (!__pyx_builtin_TypeError) __PYX_ERR(1, 2, __pyx_L1_error)
-  __pyx_builtin_ValueError = __Pyx_GetBuiltinName(__pyx_n_s_ValueError); if (!__pyx_builtin_ValueError) __PYX_ERR(0, 781, __pyx_L1_error)
-  __pyx_builtin_KeyError = __Pyx_GetBuiltinName(__pyx_n_s_KeyError); if (!__pyx_builtin_KeyError) __PYX_ERR(0, 800, __pyx_L1_error)
-  __pyx_builtin_IndexError = __Pyx_GetBuiltinName(__pyx_n_s_IndexError); if (!__pyx_builtin_IndexError) __PYX_ERR(0, 1483, __pyx_L1_error)
-  __pyx_builtin_SyntaxError = __Pyx_GetBuiltinName(__pyx_n_s_SyntaxError); if (!__pyx_builtin_SyntaxError) __PYX_ERR(0, 1560, __pyx_L1_error)
+  __pyx_builtin_KeyError = __Pyx_GetBuiltinName(__pyx_n_s_KeyError); if (!__pyx_builtin_KeyError) __PYX_ERR(0, 846, __pyx_L1_error)
+  __pyx_builtin_IndexError = __Pyx_GetBuiltinName(__pyx_n_s_IndexError); if (!__pyx_builtin_IndexError) __PYX_ERR(0, 1529, __pyx_L1_error)
+  __pyx_builtin_SyntaxError = __Pyx_GetBuiltinName(__pyx_n_s_SyntaxError); if (!__pyx_builtin_SyntaxError) __PYX_ERR(0, 1606, __pyx_L1_error)
   return 0;
   __pyx_L1_error:;
   return -1;
 }
 
 static CYTHON_SMALL_CODE int __Pyx_InitCachedConstants(void) {
   __Pyx_RefNannyDeclarations
   __Pyx_RefNannySetupContext("__Pyx_InitCachedConstants", 0);
 
-  /* "resiliparse/parse/html.pyx":200
+  /* "resiliparse/parse/html.pyx":47
+ *     parser[0] = lxb_css_parser_create()
+ *     if lxb_css_parser_init(parser[0], NULL, NULL) != LXB_STATUS_OK:
+ *         raise RuntimeError('Failed to initialize CSS parser.')             # <<<<<<<<<<<<<<
+ *     return True
+ * 
+ */
+  __pyx_tuple_ = PyTuple_Pack(1, __pyx_kp_u_Failed_to_initialize_CSS_parser); if (unlikely(!__pyx_tuple_)) __PYX_ERR(0, 47, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple_);
+  __Pyx_GIVEREF(__pyx_tuple_);
+
+  /* "resiliparse/parse/html.pyx":60
+ *     css_selectors[0] = lxb_css_selectors_create()
+ *     if lxb_css_selectors_init(css_selectors[0], 32) != LXB_STATUS_OK:
+ *         raise RuntimeError('Failed to initialize CSS selectors.')             # <<<<<<<<<<<<<<
+ * 
+ *     lxb_css_parser_selectors_set(parser, css_selectors[0])
+ */
+  __pyx_tuple__2 = PyTuple_Pack(1, __pyx_kp_u_Failed_to_initialize_CSS_selecto); if (unlikely(!__pyx_tuple__2)) __PYX_ERR(0, 60, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__2);
+  __Pyx_GIVEREF(__pyx_tuple__2);
+
+  /* "resiliparse/parse/html.pyx":66
+ *     selectors[0] = lxb_selectors_create()
+ *     if lxb_selectors_init(selectors[0]) != LXB_STATUS_OK:
+ *         raise RuntimeError('Failed to initialize elemetn selectors.')             # <<<<<<<<<<<<<<
+ * 
+ *     return True
+ */
+  __pyx_tuple__3 = PyTuple_Pack(1, __pyx_kp_u_Failed_to_initialize_elemetn_sel); if (unlikely(!__pyx_tuple__3)) __PYX_ERR(0, 66, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__3);
+  __Pyx_GIVEREF(__pyx_tuple__3);
+
+  /* "resiliparse/parse/html.pyx":248
  *     cdef lxb_dom_collection_t* coll = lxb_dom_collection_make(node.owner_document, 20)
  *     if not coll:
  *         raise RuntimeError('Failed to create DOM collection')             # <<<<<<<<<<<<<<
  * 
  *     cdef lxb_status_t status = lxb_dom_elements_by_tag_name(<lxb_dom_element_t*>node,
  */
-  __pyx_tuple_ = PyTuple_Pack(1, __pyx_kp_u_Failed_to_create_DOM_collection); if (unlikely(!__pyx_tuple_)) __PYX_ERR(0, 200, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple_);
-  __Pyx_GIVEREF(__pyx_tuple_);
+  __pyx_tuple__4 = PyTuple_Pack(1, __pyx_kp_u_Failed_to_create_DOM_collection); if (unlikely(!__pyx_tuple__4)) __PYX_ERR(0, 248, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__4);
+  __Pyx_GIVEREF(__pyx_tuple__4);
 
   /* "(tree fragment)":2
  * def __reduce_cython__(self):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")             # <<<<<<<<<<<<<<
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  */
-  __pyx_tuple__4 = PyTuple_Pack(1, __pyx_kp_s_no_default___reduce___due_to_non); if (unlikely(!__pyx_tuple__4)) __PYX_ERR(1, 2, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__4);
-  __Pyx_GIVEREF(__pyx_tuple__4);
+  __pyx_tuple__7 = PyTuple_Pack(1, __pyx_kp_s_no_default___reduce___due_to_non); if (unlikely(!__pyx_tuple__7)) __PYX_ERR(1, 2, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__7);
+  __Pyx_GIVEREF(__pyx_tuple__7);
 
   /* "(tree fragment)":4
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")             # <<<<<<<<<<<<<<
  */
-  __pyx_tuple__5 = PyTuple_Pack(1, __pyx_kp_s_no_default___reduce___due_to_non); if (unlikely(!__pyx_tuple__5)) __PYX_ERR(1, 4, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__5);
-  __Pyx_GIVEREF(__pyx_tuple__5);
+  __pyx_tuple__8 = PyTuple_Pack(1, __pyx_kp_s_no_default___reduce___due_to_non); if (unlikely(!__pyx_tuple__8)) __PYX_ERR(1, 4, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__8);
+  __Pyx_GIVEREF(__pyx_tuple__8);
 
-  /* "resiliparse/parse/html.pyx":661
+  /* "resiliparse/parse/html.pyx":707
  *     def text(self, str text):
  *         if not check_node(self):
  *             raise RuntimeError('Trying to set text contents of uninitialized DOM node')             # <<<<<<<<<<<<<<
  * 
  *         cdef bytes text_bytes = text.encode()
  */
-  __pyx_tuple__6 = PyTuple_Pack(1, __pyx_kp_u_Trying_to_set_text_contents_of_u); if (unlikely(!__pyx_tuple__6)) __PYX_ERR(0, 661, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__6);
-  __Pyx_GIVEREF(__pyx_tuple__6);
+  __pyx_tuple__9 = PyTuple_Pack(1, __pyx_kp_u_Trying_to_set_text_contents_of_u); if (unlikely(!__pyx_tuple__9)) __PYX_ERR(0, 707, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__9);
+  __Pyx_GIVEREF(__pyx_tuple__9);
 
-  /* "resiliparse/parse/html.pyx":687
+  /* "resiliparse/parse/html.pyx":733
  *     def html(self, str html):
  *         if not check_node(self):
  *             raise RuntimeError('Trying to set HTML contents of uninitialized DOM node')             # <<<<<<<<<<<<<<
  * 
  *         cdef bytes html_bytes = html.encode()
  */
-  __pyx_tuple__7 = PyTuple_Pack(1, __pyx_kp_u_Trying_to_set_HTML_contents_of_u); if (unlikely(!__pyx_tuple__7)) __PYX_ERR(0, 687, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__7);
-  __Pyx_GIVEREF(__pyx_tuple__7);
+  __pyx_tuple__10 = PyTuple_Pack(1, __pyx_kp_u_Trying_to_set_HTML_contents_of_u); if (unlikely(!__pyx_tuple__10)) __PYX_ERR(0, 733, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__10);
+  __Pyx_GIVEREF(__pyx_tuple__10);
 
-  /* "resiliparse/parse/html.pyx":781
+  /* "resiliparse/parse/html.pyx":827
  *         """
  *         if not check_node(self) or self.node.type != LXB_DOM_NODE_TYPE_ELEMENT:
  *             raise ValueError('Node ist not an Element node.')             # <<<<<<<<<<<<<<
  * 
  *         cdef bytes attr_name_bytes = attr_name.encode()
  */
-  __pyx_tuple__8 = PyTuple_Pack(1, __pyx_kp_u_Node_ist_not_an_Element_node); if (unlikely(!__pyx_tuple__8)) __PYX_ERR(0, 781, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__8);
-  __Pyx_GIVEREF(__pyx_tuple__8);
+  __pyx_tuple__11 = PyTuple_Pack(1, __pyx_kp_u_Node_ist_not_an_Element_node); if (unlikely(!__pyx_tuple__11)) __PYX_ERR(0, 827, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__11);
+  __Pyx_GIVEREF(__pyx_tuple__11);
 
-  /* "resiliparse/parse/html.pyx":979
+  /* "resiliparse/parse/html.pyx":1025
  *         cdef lxb_dom_collection_t* coll = query_selector_all_impl(self.node, self.tree, selector.encode())
  *         if not coll:
  *             raise RuntimeError('Failed to match elements by CSS selector')             # <<<<<<<<<<<<<<
  * 
  *         return _create_dom_collection(self.tree, coll)
  */
-  __pyx_tuple__9 = PyTuple_Pack(1, __pyx_kp_u_Failed_to_match_elements_by_CSS); if (unlikely(!__pyx_tuple__9)) __PYX_ERR(0, 979, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__9);
-  __Pyx_GIVEREF(__pyx_tuple__9);
+  __pyx_tuple__12 = PyTuple_Pack(1, __pyx_kp_u_Failed_to_match_elements_by_CSS); if (unlikely(!__pyx_tuple__12)) __PYX_ERR(0, 1025, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__12);
+  __Pyx_GIVEREF(__pyx_tuple__12);
 
-  /* "resiliparse/parse/html.pyx":1089
+  /* "resiliparse/parse/html.pyx":1135
  *         """
  *         if not check_node(self) or not check_node(node):
  *             raise RuntimeError('Append operation on uninitialized node')             # <<<<<<<<<<<<<<
  * 
  *         if node.node == self.node:
  */
-  __pyx_tuple__10 = PyTuple_Pack(1, __pyx_kp_u_Append_operation_on_uninitialize); if (unlikely(!__pyx_tuple__10)) __PYX_ERR(0, 1089, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__10);
-  __Pyx_GIVEREF(__pyx_tuple__10);
+  __pyx_tuple__13 = PyTuple_Pack(1, __pyx_kp_u_Append_operation_on_uninitialize); if (unlikely(!__pyx_tuple__13)) __PYX_ERR(0, 1135, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__13);
+  __Pyx_GIVEREF(__pyx_tuple__13);
 
-  /* "resiliparse/parse/html.pyx":1092
+  /* "resiliparse/parse/html.pyx":1138
  * 
  *         if node.node == self.node:
  *             raise ValueError('Trying to append child to itself')             # <<<<<<<<<<<<<<
  * 
  *         if node.node.parent:
  */
-  __pyx_tuple__11 = PyTuple_Pack(1, __pyx_kp_u_Trying_to_append_child_to_itself); if (unlikely(!__pyx_tuple__11)) __PYX_ERR(0, 1092, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__11);
-  __Pyx_GIVEREF(__pyx_tuple__11);
+  __pyx_tuple__14 = PyTuple_Pack(1, __pyx_kp_u_Trying_to_append_child_to_itself); if (unlikely(!__pyx_tuple__14)) __PYX_ERR(0, 1138, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__14);
+  __Pyx_GIVEREF(__pyx_tuple__14);
 
-  /* "resiliparse/parse/html.pyx":1116
+  /* "resiliparse/parse/html.pyx":1162
  *         """
  *         if not check_node(self) or not check_node(node) or not check_node(reference):
  *             raise RuntimeError('Insert operation on uninitialized node')             # <<<<<<<<<<<<<<
  * 
  *         if node.node == self.node:
  */
-  __pyx_tuple__12 = PyTuple_Pack(1, __pyx_kp_u_Insert_operation_on_uninitialize); if (unlikely(!__pyx_tuple__12)) __PYX_ERR(0, 1116, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__12);
-  __Pyx_GIVEREF(__pyx_tuple__12);
+  __pyx_tuple__15 = PyTuple_Pack(1, __pyx_kp_u_Insert_operation_on_uninitialize); if (unlikely(!__pyx_tuple__15)) __PYX_ERR(0, 1162, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__15);
+  __Pyx_GIVEREF(__pyx_tuple__15);
 
-  /* "resiliparse/parse/html.pyx":1119
+  /* "resiliparse/parse/html.pyx":1165
  * 
  *         if node.node == self.node:
  *             raise ValueError('Trying to insert node as its own child')             # <<<<<<<<<<<<<<
  * 
  *         if reference.node.parent != self.node:
  */
-  __pyx_tuple__13 = PyTuple_Pack(1, __pyx_kp_u_Trying_to_insert_node_as_its_own); if (unlikely(!__pyx_tuple__13)) __PYX_ERR(0, 1119, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__13);
-  __Pyx_GIVEREF(__pyx_tuple__13);
+  __pyx_tuple__16 = PyTuple_Pack(1, __pyx_kp_u_Trying_to_insert_node_as_its_own); if (unlikely(!__pyx_tuple__16)) __PYX_ERR(0, 1165, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__16);
+  __Pyx_GIVEREF(__pyx_tuple__16);
 
-  /* "resiliparse/parse/html.pyx":1122
+  /* "resiliparse/parse/html.pyx":1168
  * 
  *         if reference.node.parent != self.node:
  *             raise ValueError('Reference node must be a child node')             # <<<<<<<<<<<<<<
  * 
  *         if node.node.parent:
  */
-  __pyx_tuple__14 = PyTuple_Pack(1, __pyx_kp_u_Reference_node_must_be_a_child_n); if (unlikely(!__pyx_tuple__14)) __PYX_ERR(0, 1122, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__14);
-  __Pyx_GIVEREF(__pyx_tuple__14);
+  __pyx_tuple__17 = PyTuple_Pack(1, __pyx_kp_u_Reference_node_must_be_a_child_n); if (unlikely(!__pyx_tuple__17)) __PYX_ERR(0, 1168, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__17);
+  __Pyx_GIVEREF(__pyx_tuple__17);
 
-  /* "resiliparse/parse/html.pyx":1144
+  /* "resiliparse/parse/html.pyx":1190
  *         """
  *         if not check_node(self) or not check_node(new_child) or not check_node(old_child):
  *             raise RuntimeError('Replace operation on uninitialized node')             # <<<<<<<<<<<<<<
  * 
  *         if old_child.node.parent != self.node:
  */
-  __pyx_tuple__15 = PyTuple_Pack(1, __pyx_kp_u_Replace_operation_on_uninitializ); if (unlikely(!__pyx_tuple__15)) __PYX_ERR(0, 1144, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__15);
-  __Pyx_GIVEREF(__pyx_tuple__15);
+  __pyx_tuple__18 = PyTuple_Pack(1, __pyx_kp_u_Replace_operation_on_uninitializ); if (unlikely(!__pyx_tuple__18)) __PYX_ERR(0, 1190, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__18);
+  __Pyx_GIVEREF(__pyx_tuple__18);
 
-  /* "resiliparse/parse/html.pyx":1147
+  /* "resiliparse/parse/html.pyx":1193
  * 
  *         if old_child.node.parent != self.node:
  *             raise ValueError('Node is not a child of the current node')             # <<<<<<<<<<<<<<
  * 
  *         if new_child.node == old_child.node:
  */
-  __pyx_tuple__16 = PyTuple_Pack(1, __pyx_kp_u_Node_is_not_a_child_of_the_curre); if (unlikely(!__pyx_tuple__16)) __PYX_ERR(0, 1147, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__16);
-  __Pyx_GIVEREF(__pyx_tuple__16);
+  __pyx_tuple__19 = PyTuple_Pack(1, __pyx_kp_u_Node_is_not_a_child_of_the_curre); if (unlikely(!__pyx_tuple__19)) __PYX_ERR(0, 1193, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__19);
+  __Pyx_GIVEREF(__pyx_tuple__19);
 
-  /* "resiliparse/parse/html.pyx":1172
+  /* "resiliparse/parse/html.pyx":1218
  *         """
  *         if not check_node(self) or not check_node(node):
  *             raise RuntimeError('Remove operation on uninitialized node')             # <<<<<<<<<<<<<<
  * 
  *         if node.node.parent != self.node:
  */
-  __pyx_tuple__17 = PyTuple_Pack(1, __pyx_kp_u_Remove_operation_on_uninitialize); if (unlikely(!__pyx_tuple__17)) __PYX_ERR(0, 1172, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__17);
-  __Pyx_GIVEREF(__pyx_tuple__17);
+  __pyx_tuple__20 = PyTuple_Pack(1, __pyx_kp_u_Remove_operation_on_uninitialize); if (unlikely(!__pyx_tuple__20)) __PYX_ERR(0, 1218, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__20);
+  __Pyx_GIVEREF(__pyx_tuple__20);
 
-  /* "resiliparse/parse/html.pyx":1188
+  /* "resiliparse/parse/html.pyx":1234
  *         """
  *         if not check_node(self):
  *             raise RuntimeError('Decompose operation on uninitialized node')             # <<<<<<<<<<<<<<
  * 
  *         lxb_dom_node_destroy_deep(self.node)
  */
-  __pyx_tuple__18 = PyTuple_Pack(1, __pyx_kp_u_Decompose_operation_on_uninitial); if (unlikely(!__pyx_tuple__18)) __PYX_ERR(0, 1188, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__18);
-  __Pyx_GIVEREF(__pyx_tuple__18);
+  __pyx_tuple__21 = PyTuple_Pack(1, __pyx_kp_u_Decompose_operation_on_uninitial); if (unlikely(!__pyx_tuple__21)) __PYX_ERR(0, 1234, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__21);
+  __Pyx_GIVEREF(__pyx_tuple__21);
 
   /* "(tree fragment)":2
  * def __reduce_cython__(self):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")             # <<<<<<<<<<<<<<
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  */
-  __pyx_tuple__23 = PyTuple_Pack(1, __pyx_kp_s_no_default___reduce___due_to_non); if (unlikely(!__pyx_tuple__23)) __PYX_ERR(1, 2, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__23);
-  __Pyx_GIVEREF(__pyx_tuple__23);
+  __pyx_tuple__26 = PyTuple_Pack(1, __pyx_kp_s_no_default___reduce___due_to_non); if (unlikely(!__pyx_tuple__26)) __PYX_ERR(1, 2, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__26);
+  __Pyx_GIVEREF(__pyx_tuple__26);
 
   /* "(tree fragment)":4
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")             # <<<<<<<<<<<<<<
  */
-  __pyx_tuple__24 = PyTuple_Pack(1, __pyx_kp_s_no_default___reduce___due_to_non); if (unlikely(!__pyx_tuple__24)) __PYX_ERR(1, 4, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__24);
-  __Pyx_GIVEREF(__pyx_tuple__24);
+  __pyx_tuple__27 = PyTuple_Pack(1, __pyx_kp_s_no_default___reduce___due_to_non); if (unlikely(!__pyx_tuple__27)) __PYX_ERR(1, 4, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__27);
+  __Pyx_GIVEREF(__pyx_tuple__27);
 
-  /* "resiliparse/parse/html.pyx":1275
+  /* "resiliparse/parse/html.pyx":1321
  *         """
  *         if self.tree is None or not self.coll:
  *             raise RuntimeError('Trying to select items from uninitialized collection')             # <<<<<<<<<<<<<<
  * 
  *         if not lxb_dom_collection_length(self.coll):
  */
-  __pyx_tuple__25 = PyTuple_Pack(1, __pyx_kp_u_Trying_to_select_items_from_unin); if (unlikely(!__pyx_tuple__25)) __PYX_ERR(0, 1275, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__25);
-  __Pyx_GIVEREF(__pyx_tuple__25);
+  __pyx_tuple__28 = PyTuple_Pack(1, __pyx_kp_u_Trying_to_select_items_from_unin); if (unlikely(!__pyx_tuple__28)) __PYX_ERR(0, 1321, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__28);
+  __Pyx_GIVEREF(__pyx_tuple__28);
 
-  /* "resiliparse/parse/html.pyx":1452
+  /* "resiliparse/parse/html.pyx":1498
  *         """
  *         if self.tree is None or not self.coll:
  *             raise RuntimeError('Trying to get item of uninitialized collection')             # <<<<<<<<<<<<<<
  * 
  *         cdef size_t i = 0
  */
-  __pyx_tuple__26 = PyTuple_Pack(1, __pyx_kp_u_Trying_to_get_item_of_uninitiali); if (unlikely(!__pyx_tuple__26)) __PYX_ERR(0, 1452, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__26);
-  __Pyx_GIVEREF(__pyx_tuple__26);
+  __pyx_tuple__29 = PyTuple_Pack(1, __pyx_kp_u_Trying_to_get_item_of_uninitiali); if (unlikely(!__pyx_tuple__29)) __PYX_ERR(0, 1498, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__29);
+  __Pyx_GIVEREF(__pyx_tuple__29);
 
-  /* "resiliparse/parse/html.pyx":1517
+  /* "resiliparse/parse/html.pyx":1563
  * 
  *         if key >= coll_len:
  *             raise IndexError('Index out of range')             # <<<<<<<<<<<<<<
  * 
  *         return _create_dom_node(self.tree, lxb_dom_collection_node(self.coll, self._wrap_idx(key)))
  */
-  __pyx_tuple__27 = PyTuple_Pack(1, __pyx_kp_u_Index_out_of_range); if (unlikely(!__pyx_tuple__27)) __PYX_ERR(0, 1517, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__27);
-  __Pyx_GIVEREF(__pyx_tuple__27);
+  __pyx_tuple__30 = PyTuple_Pack(1, __pyx_kp_u_Index_out_of_range); if (unlikely(!__pyx_tuple__30)) __PYX_ERR(0, 1563, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__30);
+  __Pyx_GIVEREF(__pyx_tuple__30);
 
   /* "(tree fragment)":2
  * def __reduce_cython__(self):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")             # <<<<<<<<<<<<<<
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  */
-  __pyx_tuple__31 = PyTuple_Pack(1, __pyx_kp_s_no_default___reduce___due_to_non); if (unlikely(!__pyx_tuple__31)) __PYX_ERR(1, 2, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__31);
-  __Pyx_GIVEREF(__pyx_tuple__31);
+  __pyx_tuple__34 = PyTuple_Pack(1, __pyx_kp_s_no_default___reduce___due_to_non); if (unlikely(!__pyx_tuple__34)) __PYX_ERR(1, 2, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__34);
+  __Pyx_GIVEREF(__pyx_tuple__34);
 
   /* "(tree fragment)":4
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")             # <<<<<<<<<<<<<<
  */
-  __pyx_tuple__32 = PyTuple_Pack(1, __pyx_kp_s_no_default___reduce___due_to_non); if (unlikely(!__pyx_tuple__32)) __PYX_ERR(1, 4, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__32);
-  __Pyx_GIVEREF(__pyx_tuple__32);
+  __pyx_tuple__35 = PyTuple_Pack(1, __pyx_kp_s_no_default___reduce___due_to_non); if (unlikely(!__pyx_tuple__35)) __PYX_ERR(1, 4, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__35);
+  __Pyx_GIVEREF(__pyx_tuple__35);
 
-  /* "resiliparse/parse/html.pyx":1548
+  /* "resiliparse/parse/html.pyx":1594
  *         status = lxb_html_document_parse(tree.dom_document, html, html_len)
  *     if status != LXB_STATUS_OK:
  *         raise ValueError('Failed to parse HTML document')             # <<<<<<<<<<<<<<
  *     return tree
  * 
  */
-  __pyx_tuple__33 = PyTuple_Pack(1, __pyx_kp_u_Failed_to_parse_HTML_document); if (unlikely(!__pyx_tuple__33)) __PYX_ERR(0, 1548, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__33);
-  __Pyx_GIVEREF(__pyx_tuple__33);
+  __pyx_tuple__36 = PyTuple_Pack(1, __pyx_kp_u_Failed_to_parse_HTML_document); if (unlikely(!__pyx_tuple__36)) __PYX_ERR(0, 1594, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__36);
+  __Pyx_GIVEREF(__pyx_tuple__36);
 
-  /* "resiliparse/parse/html.pyx":1560
+  /* "resiliparse/parse/html.pyx":1606
  * 
  *     def __init__(self, *args, **kwargs):
  *         raise SyntaxError('Cannot create instance directly. Use HTMLParser.parse() or HTMLParser.parse_from_bytes()')             # <<<<<<<<<<<<<<
  * 
  *     def __cinit__(self):
  */
-  __pyx_tuple__34 = PyTuple_Pack(1, __pyx_kp_u_Cannot_create_instance_directly); if (unlikely(!__pyx_tuple__34)) __PYX_ERR(0, 1560, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__34);
-  __Pyx_GIVEREF(__pyx_tuple__34);
+  __pyx_tuple__37 = PyTuple_Pack(1, __pyx_kp_u_Cannot_create_instance_directly); if (unlikely(!__pyx_tuple__37)) __PYX_ERR(0, 1606, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__37);
+  __Pyx_GIVEREF(__pyx_tuple__37);
 
-  /* "resiliparse/parse/html.pyx":1565
+  /* "resiliparse/parse/html.pyx":1611
  *         self.dom_document = lxb_html_document_create()
  *         if not self.dom_document:
  *             raise RuntimeError('Failed to allocate HTML document')             # <<<<<<<<<<<<<<
  *         self.css_parser = NULL
  *         self.css_selectors = NULL
  */
-  __pyx_tuple__35 = PyTuple_Pack(1, __pyx_kp_u_Failed_to_allocate_HTML_document); if (unlikely(!__pyx_tuple__35)) __PYX_ERR(0, 1565, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__35);
-  __Pyx_GIVEREF(__pyx_tuple__35);
+  __pyx_tuple__38 = PyTuple_Pack(1, __pyx_kp_u_Failed_to_allocate_HTML_document); if (unlikely(!__pyx_tuple__38)) __PYX_ERR(0, 1611, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__38);
+  __Pyx_GIVEREF(__pyx_tuple__38);
 
-  /* "resiliparse/parse/html.pyx":1708
+  /* "resiliparse/parse/html.pyx":1745
  *         """
  *         if not self.dom_document:
  *             raise RuntimeError('Trying to create element in uninitialized document.')             # <<<<<<<<<<<<<<
  * 
  *         cdef bytes tag_name_bytes = tag_name.encode()
  */
-  __pyx_tuple__36 = PyTuple_Pack(1, __pyx_kp_u_Trying_to_create_element_in_unin); if (unlikely(!__pyx_tuple__36)) __PYX_ERR(0, 1708, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__36);
-  __Pyx_GIVEREF(__pyx_tuple__36);
+  __pyx_tuple__39 = PyTuple_Pack(1, __pyx_kp_u_Trying_to_create_element_in_unin); if (unlikely(!__pyx_tuple__39)) __PYX_ERR(0, 1745, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__39);
+  __Pyx_GIVEREF(__pyx_tuple__39);
 
-  /* "resiliparse/parse/html.pyx":1727
+  /* "resiliparse/parse/html.pyx":1764
  *         """
  *         if not self.dom_document:
  *             raise RuntimeError('Trying to create text node in uninitialized document.')             # <<<<<<<<<<<<<<
  * 
  *         cdef bytes text_bytes = text.encode()
  */
-  __pyx_tuple__37 = PyTuple_Pack(1, __pyx_kp_u_Trying_to_create_text_node_in_un); if (unlikely(!__pyx_tuple__37)) __PYX_ERR(0, 1727, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__37);
-  __Pyx_GIVEREF(__pyx_tuple__37);
+  __pyx_tuple__40 = PyTuple_Pack(1, __pyx_kp_u_Trying_to_create_text_node_in_un); if (unlikely(!__pyx_tuple__40)) __PYX_ERR(0, 1764, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__40);
+  __Pyx_GIVEREF(__pyx_tuple__40);
 
   /* "(tree fragment)":2
  * def __reduce_cython__(self):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")             # <<<<<<<<<<<<<<
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  */
-  __pyx_tuple__38 = PyTuple_Pack(1, __pyx_kp_s_no_default___reduce___due_to_non); if (unlikely(!__pyx_tuple__38)) __PYX_ERR(1, 2, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__38);
-  __Pyx_GIVEREF(__pyx_tuple__38);
+  __pyx_tuple__41 = PyTuple_Pack(1, __pyx_kp_s_no_default___reduce___due_to_non); if (unlikely(!__pyx_tuple__41)) __PYX_ERR(1, 2, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__41);
+  __Pyx_GIVEREF(__pyx_tuple__41);
 
   /* "(tree fragment)":4
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")
  * def __setstate_cython__(self, __pyx_state):
  *     raise TypeError("no default __reduce__ due to non-trivial __cinit__")             # <<<<<<<<<<<<<<
  */
-  __pyx_tuple__39 = PyTuple_Pack(1, __pyx_kp_s_no_default___reduce___due_to_non); if (unlikely(!__pyx_tuple__39)) __PYX_ERR(1, 4, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__39);
-  __Pyx_GIVEREF(__pyx_tuple__39);
+  __pyx_tuple__42 = PyTuple_Pack(1, __pyx_kp_s_no_default___reduce___due_to_non); if (unlikely(!__pyx_tuple__42)) __PYX_ERR(1, 4, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__42);
+  __Pyx_GIVEREF(__pyx_tuple__42);
 
-  /* "resiliparse/parse/html.pyx":1755
+  /* "resiliparse/parse/html.pyx":1792
  *     :ivar int depth: the current traversal depth
  *     """
  *     def __init__(self):             # <<<<<<<<<<<<<<
  *         self.node = None
  *         self.depth = 0
  */
-  __pyx_tuple__40 = PyTuple_Pack(1, __pyx_n_s_self); if (unlikely(!__pyx_tuple__40)) __PYX_ERR(0, 1755, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__40);
-  __Pyx_GIVEREF(__pyx_tuple__40);
-  __pyx_codeobj__41 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__40, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_resiliparse_parse_html_pyx, __pyx_n_s_init, 1755, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__41)) __PYX_ERR(0, 1755, __pyx_L1_error)
+  __pyx_tuple__43 = PyTuple_Pack(1, __pyx_n_s_self); if (unlikely(!__pyx_tuple__43)) __PYX_ERR(0, 1792, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__43);
+  __Pyx_GIVEREF(__pyx_tuple__43);
+  __pyx_codeobj__44 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__43, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_resiliparse_parse_html_pyx, __pyx_n_s_init, 1792, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__44)) __PYX_ERR(0, 1792, __pyx_L1_error)
 
-  /* "resiliparse/parse/html.pyx":1760
+  /* "resiliparse/parse/html.pyx":1797
  * 
  * 
  * def traverse_dom(DOMNode base_node, start_callback, end_callback=None, context=None, bint elements_only=False):             # <<<<<<<<<<<<<<
  *     """
  *     traverse_dom(base_node, start_callback, end_callback=None, context=None, elements_only=False)
  */
-  __pyx_tuple__42 = PyTuple_Pack(9, __pyx_n_s_base_node, __pyx_n_s_start_callback, __pyx_n_s_end_callback, __pyx_n_s_context, __pyx_n_s_elements_only, __pyx_n_s_node, __pyx_n_s_depth, __pyx_n_s_is_end_tag, __pyx_n_s_is_end_tag_ptr); if (unlikely(!__pyx_tuple__42)) __PYX_ERR(0, 1760, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__42);
-  __Pyx_GIVEREF(__pyx_tuple__42);
-  __pyx_codeobj__43 = (PyObject*)__Pyx_PyCode_New(5, 0, 9, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__42, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_resiliparse_parse_html_pyx, __pyx_n_s_traverse_dom, 1760, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__43)) __PYX_ERR(0, 1760, __pyx_L1_error)
+  __pyx_tuple__45 = PyTuple_Pack(9, __pyx_n_s_base_node, __pyx_n_s_start_callback, __pyx_n_s_end_callback, __pyx_n_s_context, __pyx_n_s_elements_only, __pyx_n_s_node, __pyx_n_s_depth, __pyx_n_s_is_end_tag, __pyx_n_s_is_end_tag_ptr); if (unlikely(!__pyx_tuple__45)) __PYX_ERR(0, 1797, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__45);
+  __Pyx_GIVEREF(__pyx_tuple__45);
+  __pyx_codeobj__46 = (PyObject*)__Pyx_PyCode_New(5, 0, 9, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__45, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_resiliparse_parse_html_pyx, __pyx_n_s_traverse_dom, 1797, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__46)) __PYX_ERR(0, 1797, __pyx_L1_error)
 
   /* "EnumBase":28
  * class __Pyx_EnumBase(int):
  *     __metaclass__ = __Pyx_EnumMeta
  *     def __new__(cls, value, name=None):             # <<<<<<<<<<<<<<
  *         for v in cls:
  *             if v == value:
  */
-  __pyx_tuple__44 = PyTuple_Pack(5, __pyx_n_s_cls, __pyx_n_s_value, __pyx_n_s_name_2, __pyx_n_s_v, __pyx_n_s_res); if (unlikely(!__pyx_tuple__44)) __PYX_ERR(1, 28, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__44);
-  __Pyx_GIVEREF(__pyx_tuple__44);
-  __pyx_codeobj__45 = (PyObject*)__Pyx_PyCode_New(3, 0, 5, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__44, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_stringsource, __pyx_n_s_new, 28, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__45)) __PYX_ERR(1, 28, __pyx_L1_error)
-  __pyx_tuple__46 = PyTuple_Pack(1, ((PyObject *)Py_None)); if (unlikely(!__pyx_tuple__46)) __PYX_ERR(1, 28, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__46);
-  __Pyx_GIVEREF(__pyx_tuple__46);
+  __pyx_tuple__47 = PyTuple_Pack(5, __pyx_n_s_cls, __pyx_n_s_value, __pyx_n_s_name_2, __pyx_n_s_v, __pyx_n_s_res); if (unlikely(!__pyx_tuple__47)) __PYX_ERR(1, 28, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__47);
+  __Pyx_GIVEREF(__pyx_tuple__47);
+  __pyx_codeobj__48 = (PyObject*)__Pyx_PyCode_New(3, 0, 5, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__47, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_stringsource, __pyx_n_s_new, 28, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__48)) __PYX_ERR(1, 28, __pyx_L1_error)
+  __pyx_tuple__49 = PyTuple_Pack(1, ((PyObject *)Py_None)); if (unlikely(!__pyx_tuple__49)) __PYX_ERR(1, 28, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__49);
+  __Pyx_GIVEREF(__pyx_tuple__49);
 
   /* "EnumBase":39
  *         cls.__members__[name] = res
  *         return res
  *     def __repr__(self):             # <<<<<<<<<<<<<<
  *         return "<%s.%s: %d>" % (self.__class__.__name__, self.name, self)
  *     def __str__(self):
  */
-  __pyx_tuple__47 = PyTuple_Pack(1, __pyx_n_s_self); if (unlikely(!__pyx_tuple__47)) __PYX_ERR(1, 39, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__47);
-  __Pyx_GIVEREF(__pyx_tuple__47);
-  __pyx_codeobj__48 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__47, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_stringsource, __pyx_n_s_repr, 39, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__48)) __PYX_ERR(1, 39, __pyx_L1_error)
+  __pyx_tuple__50 = PyTuple_Pack(1, __pyx_n_s_self); if (unlikely(!__pyx_tuple__50)) __PYX_ERR(1, 39, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__50);
+  __Pyx_GIVEREF(__pyx_tuple__50);
+  __pyx_codeobj__51 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__50, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_stringsource, __pyx_n_s_repr, 39, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__51)) __PYX_ERR(1, 39, __pyx_L1_error)
 
   /* "EnumBase":41
  *     def __repr__(self):
  *         return "<%s.%s: %d>" % (self.__class__.__name__, self.name, self)
  *     def __str__(self):             # <<<<<<<<<<<<<<
  *         return "%s.%s" % (self.__class__.__name__, self.name)
  * 
  */
-  __pyx_tuple__49 = PyTuple_Pack(1, __pyx_n_s_self); if (unlikely(!__pyx_tuple__49)) __PYX_ERR(1, 41, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__49);
-  __Pyx_GIVEREF(__pyx_tuple__49);
-  __pyx_codeobj__50 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__49, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_stringsource, __pyx_n_s_str, 41, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__50)) __PYX_ERR(1, 41, __pyx_L1_error)
+  __pyx_tuple__52 = PyTuple_Pack(1, __pyx_n_s_self); if (unlikely(!__pyx_tuple__52)) __PYX_ERR(1, 41, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__52);
+  __Pyx_GIVEREF(__pyx_tuple__52);
+  __pyx_codeobj__53 = (PyObject*)__Pyx_PyCode_New(1, 0, 1, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__52, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_stringsource, __pyx_n_s_str, 41, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__53)) __PYX_ERR(1, 41, __pyx_L1_error)
 
   /* "(tree fragment)":1
  * def __pyx_unpickle___Pyx_EnumMeta(__pyx_type, long __pyx_checksum, __pyx_state):             # <<<<<<<<<<<<<<
  *     cdef object __pyx_PickleError
  *     cdef object __pyx_result
  */
-  __pyx_tuple__51 = PyTuple_Pack(5, __pyx_n_s_pyx_type, __pyx_n_s_pyx_checksum, __pyx_n_s_pyx_state, __pyx_n_s_pyx_PickleError, __pyx_n_s_pyx_result); if (unlikely(!__pyx_tuple__51)) __PYX_ERR(1, 1, __pyx_L1_error)
-  __Pyx_GOTREF(__pyx_tuple__51);
-  __Pyx_GIVEREF(__pyx_tuple__51);
-  __pyx_codeobj__52 = (PyObject*)__Pyx_PyCode_New(3, 0, 5, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__51, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_stringsource, __pyx_n_s_pyx_unpickle___Pyx_EnumMeta, 1, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__52)) __PYX_ERR(1, 1, __pyx_L1_error)
+  __pyx_tuple__54 = PyTuple_Pack(5, __pyx_n_s_pyx_type, __pyx_n_s_pyx_checksum, __pyx_n_s_pyx_state, __pyx_n_s_pyx_PickleError, __pyx_n_s_pyx_result); if (unlikely(!__pyx_tuple__54)) __PYX_ERR(1, 1, __pyx_L1_error)
+  __Pyx_GOTREF(__pyx_tuple__54);
+  __Pyx_GIVEREF(__pyx_tuple__54);
+  __pyx_codeobj__55 = (PyObject*)__Pyx_PyCode_New(3, 0, 5, 0, CO_OPTIMIZED|CO_NEWLOCALS, __pyx_empty_bytes, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_tuple__54, __pyx_empty_tuple, __pyx_empty_tuple, __pyx_kp_s_stringsource, __pyx_n_s_pyx_unpickle___Pyx_EnumMeta, 1, __pyx_empty_bytes); if (unlikely(!__pyx_codeobj__55)) __PYX_ERR(1, 1, __pyx_L1_error)
   __Pyx_RefNannyFinishContext();
   return 0;
   __pyx_L1_error:;
   __Pyx_RefNannyFinishContext();
   return -1;
 }
 
@@ -27274,14 +27887,19 @@
 static int __Pyx_modinit_function_export_code(void) {
   __Pyx_RefNannyDeclarations
   int __pyx_lineno = 0;
   const char *__pyx_filename = NULL;
   int __pyx_clineno = 0;
   __Pyx_RefNannySetupContext("__Pyx_modinit_function_export_code", 0);
   /*--- Function export code ---*/
+  if (__Pyx_ExportFunction("init_css_parser", (void (*)(void))__pyx_f_11resiliparse_5parse_4html_init_css_parser, "int (lxb_css_parser_t **)") < 0) __PYX_ERR(0, 1, __pyx_L1_error)
+  if (__Pyx_ExportFunction("destroy_css_parser", (void (*)(void))__pyx_f_11resiliparse_5parse_4html_destroy_css_parser, "void (lxb_css_parser_t *)") < 0) __PYX_ERR(0, 1, __pyx_L1_error)
+  if (__Pyx_ExportFunction("init_css_selectors", (void (*)(void))__pyx_f_11resiliparse_5parse_4html_init_css_selectors, "int (lxb_css_parser_t *, lxb_css_selectors_t **, lxb_selectors_t **)") < 0) __PYX_ERR(0, 1, __pyx_L1_error)
+  if (__Pyx_ExportFunction("destroy_css_selectors", (void (*)(void))__pyx_f_11resiliparse_5parse_4html_destroy_css_selectors, "void (lxb_css_selectors_t *, lxb_selectors_t *)") < 0) __PYX_ERR(0, 1, __pyx_L1_error)
+  if (__Pyx_ExportFunction("parse_css_selectors", (void (*)(void))__pyx_f_11resiliparse_5parse_4html_parse_css_selectors, "lxb_css_selector_list_t *(lxb_css_parser_t *, lxb_char_t const *, size_t)") < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   if (__Pyx_ExportFunction("next_node", (void (*)(void))__pyx_f_11resiliparse_5parse_4html_next_node, "lxb_dom_node_t *(lxb_dom_node_t const *, lxb_dom_node_t *, struct __pyx_opt_args_11resiliparse_5parse_4html_next_node *__pyx_optional_args)") < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   if (__Pyx_ExportFunction("get_node_text", (void (*)(void))__pyx_f_11resiliparse_5parse_4html_get_node_text, "std::string (lxb_dom_node_t *)") < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   if (__Pyx_ExportFunction("get_element_by_id_impl", (void (*)(void))__pyx_f_11resiliparse_5parse_4html_get_element_by_id_impl, "lxb_dom_node_t *(lxb_dom_node_t *, PyObject *, struct __pyx_opt_args_11resiliparse_5parse_4html_get_element_by_id_impl *__pyx_optional_args)") < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   if (__Pyx_ExportFunction("get_elements_by_attr_impl", (void (*)(void))__pyx_f_11resiliparse_5parse_4html_get_elements_by_attr_impl, "lxb_dom_collection_t *(lxb_dom_node_t *, PyObject *, PyObject *, struct __pyx_opt_args_11resiliparse_5parse_4html_get_elements_by_attr_impl *__pyx_optional_args)") < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   if (__Pyx_ExportFunction("get_elements_by_class_name_impl", (void (*)(void))__pyx_f_11resiliparse_5parse_4html_get_elements_by_class_name_impl, "lxb_dom_collection_t *(lxb_dom_node_t *, PyObject *, struct __pyx_opt_args_11resiliparse_5parse_4html_get_elements_by_class_name_impl *__pyx_optional_args)") < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   if (__Pyx_ExportFunction("get_elements_by_tag_name_impl", (void (*)(void))__pyx_f_11resiliparse_5parse_4html_get_elements_by_tag_name_impl, "lxb_dom_collection_t *(lxb_dom_node_t *, PyObject *)") < 0) __PYX_ERR(0, 1, __pyx_L1_error)
   if (__Pyx_ExportFunction("query_selector_impl", (void (*)(void))__pyx_f_11resiliparse_5parse_4html_query_selector_impl, "lxb_dom_node_t *(lxb_dom_node_t *, struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *, PyObject *)") < 0) __PYX_ERR(0, 1, __pyx_L1_error)
@@ -27304,94 +27922,94 @@
   __Pyx_RefNannySetupContext("__Pyx_modinit_type_init_code", 0);
   /*--- Type init code ---*/
   __pyx_vtabptr_11resiliparse_5parse_4html_DOMElementClassList = &__pyx_vtable_11resiliparse_5parse_4html_DOMElementClassList;
   __pyx_vtable_11resiliparse_5parse_4html_DOMElementClassList._create_list = (PyObject *(*)(struct __pyx_obj_11resiliparse_5parse_4html_DOMElementClassList *))__pyx_f_11resiliparse_5parse_4html_19DOMElementClassList__create_list;
   __pyx_vtable_11resiliparse_5parse_4html_DOMElementClassList._class_name_bytes = (PyObject *(*)(struct __pyx_obj_11resiliparse_5parse_4html_DOMElementClassList *))__pyx_f_11resiliparse_5parse_4html_19DOMElementClassList__class_name_bytes;
   __pyx_vtable_11resiliparse_5parse_4html_DOMElementClassList.add = (void (*)(struct __pyx_obj_11resiliparse_5parse_4html_DOMElementClassList *, PyObject *, int __pyx_skip_dispatch))__pyx_f_11resiliparse_5parse_4html_19DOMElementClassList_add;
   __pyx_vtable_11resiliparse_5parse_4html_DOMElementClassList.remove = (void (*)(struct __pyx_obj_11resiliparse_5parse_4html_DOMElementClassList *, PyObject *, int __pyx_skip_dispatch))__pyx_f_11resiliparse_5parse_4html_19DOMElementClassList_remove;
-  if (PyType_Ready(&__pyx_type_11resiliparse_5parse_4html_DOMElementClassList) < 0) __PYX_ERR(0, 296, __pyx_L1_error)
+  if (PyType_Ready(&__pyx_type_11resiliparse_5parse_4html_DOMElementClassList) < 0) __PYX_ERR(0, 342, __pyx_L1_error)
   #if PY_VERSION_HEX < 0x030800B1
   __pyx_type_11resiliparse_5parse_4html_DOMElementClassList.tp_print = 0;
   #endif
   if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_11resiliparse_5parse_4html_DOMElementClassList.tp_dictoffset && __pyx_type_11resiliparse_5parse_4html_DOMElementClassList.tp_getattro == PyObject_GenericGetAttr)) {
     __pyx_type_11resiliparse_5parse_4html_DOMElementClassList.tp_getattro = __Pyx_PyObject_GenericGetAttr;
   }
   #if CYTHON_COMPILING_IN_CPYTHON
   {
-    PyObject *wrapper = PyObject_GetAttrString((PyObject *)&__pyx_type_11resiliparse_5parse_4html_DOMElementClassList, "__contains__"); if (unlikely(!wrapper)) __PYX_ERR(0, 296, __pyx_L1_error)
+    PyObject *wrapper = PyObject_GetAttrString((PyObject *)&__pyx_type_11resiliparse_5parse_4html_DOMElementClassList, "__contains__"); if (unlikely(!wrapper)) __PYX_ERR(0, 342, __pyx_L1_error)
     if (Py_TYPE(wrapper) == &PyWrapperDescr_Type) {
       __pyx_wrapperbase_11resiliparse_5parse_4html_19DOMElementClassList_6__contains__ = *((PyWrapperDescrObject *)wrapper)->d_base;
       __pyx_wrapperbase_11resiliparse_5parse_4html_19DOMElementClassList_6__contains__.doc = __pyx_doc_11resiliparse_5parse_4html_19DOMElementClassList_6__contains__;
       ((PyWrapperDescrObject *)wrapper)->d_base = &__pyx_wrapperbase_11resiliparse_5parse_4html_19DOMElementClassList_6__contains__;
     }
   }
   #endif
   #if CYTHON_COMPILING_IN_CPYTHON
   {
-    PyObject *wrapper = PyObject_GetAttrString((PyObject *)&__pyx_type_11resiliparse_5parse_4html_DOMElementClassList, "__getitem__"); if (unlikely(!wrapper)) __PYX_ERR(0, 296, __pyx_L1_error)
+    PyObject *wrapper = PyObject_GetAttrString((PyObject *)&__pyx_type_11resiliparse_5parse_4html_DOMElementClassList, "__getitem__"); if (unlikely(!wrapper)) __PYX_ERR(0, 342, __pyx_L1_error)
     if (Py_TYPE(wrapper) == &PyWrapperDescr_Type) {
       __pyx_wrapperbase_11resiliparse_5parse_4html_19DOMElementClassList_8__getitem__ = *((PyWrapperDescrObject *)wrapper)->d_base;
       __pyx_wrapperbase_11resiliparse_5parse_4html_19DOMElementClassList_8__getitem__.doc = __pyx_doc_11resiliparse_5parse_4html_19DOMElementClassList_8__getitem__;
       ((PyWrapperDescrObject *)wrapper)->d_base = &__pyx_wrapperbase_11resiliparse_5parse_4html_19DOMElementClassList_8__getitem__;
     }
   }
   #endif
   #if CYTHON_COMPILING_IN_CPYTHON
   {
-    PyObject *wrapper = PyObject_GetAttrString((PyObject *)&__pyx_type_11resiliparse_5parse_4html_DOMElementClassList, "__eq__"); if (unlikely(!wrapper)) __PYX_ERR(0, 296, __pyx_L1_error)
+    PyObject *wrapper = PyObject_GetAttrString((PyObject *)&__pyx_type_11resiliparse_5parse_4html_DOMElementClassList, "__eq__"); if (unlikely(!wrapper)) __PYX_ERR(0, 342, __pyx_L1_error)
     if (Py_TYPE(wrapper) == &PyWrapperDescr_Type) {
       __pyx_wrapperbase_11resiliparse_5parse_4html_19DOMElementClassList_10__eq__ = *((PyWrapperDescrObject *)wrapper)->d_base;
       __pyx_wrapperbase_11resiliparse_5parse_4html_19DOMElementClassList_10__eq__.doc = __pyx_doc_11resiliparse_5parse_4html_19DOMElementClassList_10__eq__;
       ((PyWrapperDescrObject *)wrapper)->d_base = &__pyx_wrapperbase_11resiliparse_5parse_4html_19DOMElementClassList_10__eq__;
     }
   }
   #endif
   #if CYTHON_COMPILING_IN_CPYTHON
   {
-    PyObject *wrapper = PyObject_GetAttrString((PyObject *)&__pyx_type_11resiliparse_5parse_4html_DOMElementClassList, "__len__"); if (unlikely(!wrapper)) __PYX_ERR(0, 296, __pyx_L1_error)
+    PyObject *wrapper = PyObject_GetAttrString((PyObject *)&__pyx_type_11resiliparse_5parse_4html_DOMElementClassList, "__len__"); if (unlikely(!wrapper)) __PYX_ERR(0, 342, __pyx_L1_error)
     if (Py_TYPE(wrapper) == &PyWrapperDescr_Type) {
       __pyx_wrapperbase_11resiliparse_5parse_4html_19DOMElementClassList_12__len__ = *((PyWrapperDescrObject *)wrapper)->d_base;
       __pyx_wrapperbase_11resiliparse_5parse_4html_19DOMElementClassList_12__len__.doc = __pyx_doc_11resiliparse_5parse_4html_19DOMElementClassList_12__len__;
       ((PyWrapperDescrObject *)wrapper)->d_base = &__pyx_wrapperbase_11resiliparse_5parse_4html_19DOMElementClassList_12__len__;
     }
   }
   #endif
   #if CYTHON_COMPILING_IN_CPYTHON
   {
-    PyObject *wrapper = PyObject_GetAttrString((PyObject *)&__pyx_type_11resiliparse_5parse_4html_DOMElementClassList, "__iter__"); if (unlikely(!wrapper)) __PYX_ERR(0, 296, __pyx_L1_error)
+    PyObject *wrapper = PyObject_GetAttrString((PyObject *)&__pyx_type_11resiliparse_5parse_4html_DOMElementClassList, "__iter__"); if (unlikely(!wrapper)) __PYX_ERR(0, 342, __pyx_L1_error)
     if (Py_TYPE(wrapper) == &PyWrapperDescr_Type) {
       __pyx_wrapperbase_11resiliparse_5parse_4html_19DOMElementClassList_14__iter__ = *((PyWrapperDescrObject *)wrapper)->d_base;
       __pyx_wrapperbase_11resiliparse_5parse_4html_19DOMElementClassList_14__iter__.doc = __pyx_doc_11resiliparse_5parse_4html_19DOMElementClassList_14__iter__;
       ((PyWrapperDescrObject *)wrapper)->d_base = &__pyx_wrapperbase_11resiliparse_5parse_4html_19DOMElementClassList_14__iter__;
     }
   }
   #endif
   #if CYTHON_COMPILING_IN_CPYTHON
   {
-    PyObject *wrapper = PyObject_GetAttrString((PyObject *)&__pyx_type_11resiliparse_5parse_4html_DOMElementClassList, "__repr__"); if (unlikely(!wrapper)) __PYX_ERR(0, 296, __pyx_L1_error)
+    PyObject *wrapper = PyObject_GetAttrString((PyObject *)&__pyx_type_11resiliparse_5parse_4html_DOMElementClassList, "__repr__"); if (unlikely(!wrapper)) __PYX_ERR(0, 342, __pyx_L1_error)
     if (Py_TYPE(wrapper) == &PyWrapperDescr_Type) {
       __pyx_wrapperbase_11resiliparse_5parse_4html_19DOMElementClassList_16__repr__ = *((PyWrapperDescrObject *)wrapper)->d_base;
       __pyx_wrapperbase_11resiliparse_5parse_4html_19DOMElementClassList_16__repr__.doc = __pyx_doc_11resiliparse_5parse_4html_19DOMElementClassList_16__repr__;
       ((PyWrapperDescrObject *)wrapper)->d_base = &__pyx_wrapperbase_11resiliparse_5parse_4html_19DOMElementClassList_16__repr__;
     }
   }
   #endif
   #if CYTHON_COMPILING_IN_CPYTHON
   {
-    PyObject *wrapper = PyObject_GetAttrString((PyObject *)&__pyx_type_11resiliparse_5parse_4html_DOMElementClassList, "__str__"); if (unlikely(!wrapper)) __PYX_ERR(0, 296, __pyx_L1_error)
+    PyObject *wrapper = PyObject_GetAttrString((PyObject *)&__pyx_type_11resiliparse_5parse_4html_DOMElementClassList, "__str__"); if (unlikely(!wrapper)) __PYX_ERR(0, 342, __pyx_L1_error)
     if (Py_TYPE(wrapper) == &PyWrapperDescr_Type) {
       __pyx_wrapperbase_11resiliparse_5parse_4html_19DOMElementClassList_18__str__ = *((PyWrapperDescrObject *)wrapper)->d_base;
       __pyx_wrapperbase_11resiliparse_5parse_4html_19DOMElementClassList_18__str__.doc = __pyx_doc_11resiliparse_5parse_4html_19DOMElementClassList_18__str__;
       ((PyWrapperDescrObject *)wrapper)->d_base = &__pyx_wrapperbase_11resiliparse_5parse_4html_19DOMElementClassList_18__str__;
     }
   }
   #endif
-  if (__Pyx_SetVtable(__pyx_type_11resiliparse_5parse_4html_DOMElementClassList.tp_dict, __pyx_vtabptr_11resiliparse_5parse_4html_DOMElementClassList) < 0) __PYX_ERR(0, 296, __pyx_L1_error)
-  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_DOMElementClassList, (PyObject *)&__pyx_type_11resiliparse_5parse_4html_DOMElementClassList) < 0) __PYX_ERR(0, 296, __pyx_L1_error)
-  if (__Pyx_setup_reduce((PyObject*)&__pyx_type_11resiliparse_5parse_4html_DOMElementClassList) < 0) __PYX_ERR(0, 296, __pyx_L1_error)
+  if (__Pyx_SetVtable(__pyx_type_11resiliparse_5parse_4html_DOMElementClassList.tp_dict, __pyx_vtabptr_11resiliparse_5parse_4html_DOMElementClassList) < 0) __PYX_ERR(0, 342, __pyx_L1_error)
+  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_DOMElementClassList, (PyObject *)&__pyx_type_11resiliparse_5parse_4html_DOMElementClassList) < 0) __PYX_ERR(0, 342, __pyx_L1_error)
+  if (__Pyx_setup_reduce((PyObject*)&__pyx_type_11resiliparse_5parse_4html_DOMElementClassList) < 0) __PYX_ERR(0, 342, __pyx_L1_error)
   __pyx_ptype_11resiliparse_5parse_4html_DOMElementClassList = &__pyx_type_11resiliparse_5parse_4html_DOMElementClassList;
   __pyx_vtabptr_11resiliparse_5parse_4html_DOMNode = &__pyx_vtable_11resiliparse_5parse_4html_DOMNode;
   __pyx_vtable_11resiliparse_5parse_4html_DOMNode.hasattr = (int (*)(struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *, PyObject *, int __pyx_skip_dispatch))__pyx_f_11resiliparse_5parse_4html_7DOMNode_hasattr;
   __pyx_vtable_11resiliparse_5parse_4html_DOMNode._getattr_impl = (PyObject *(*)(struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *, std::string const &, struct __pyx_opt_args_11resiliparse_5parse_4html_7DOMNode__getattr_impl *__pyx_optional_args))__pyx_f_11resiliparse_5parse_4html_7DOMNode__getattr_impl;
   __pyx_vtable_11resiliparse_5parse_4html_DOMNode.getattr = (PyObject *(*)(struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *, PyObject *, int __pyx_skip_dispatch, struct __pyx_opt_args_11resiliparse_5parse_4html_7DOMNode_getattr *__pyx_optional_args))__pyx_f_11resiliparse_5parse_4html_7DOMNode_getattr;
   __pyx_vtable_11resiliparse_5parse_4html_DOMNode._setattr_impl = (int (*)(struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *, PyObject *, PyObject *))__pyx_f_11resiliparse_5parse_4html_7DOMNode__setattr_impl;
   __pyx_vtable_11resiliparse_5parse_4html_DOMNode.setattr = (PyObject *(*)(struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *, PyObject *, PyObject *, int __pyx_skip_dispatch))__pyx_f_11resiliparse_5parse_4html_7DOMNode_setattr;
@@ -27405,172 +28023,172 @@
   __pyx_vtable_11resiliparse_5parse_4html_DOMNode.query_selector_all = (struct __pyx_obj_11resiliparse_5parse_4html_DOMCollection *(*)(struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *, PyObject *, int __pyx_skip_dispatch))__pyx_f_11resiliparse_5parse_4html_7DOMNode_query_selector_all;
   __pyx_vtable_11resiliparse_5parse_4html_DOMNode.matches = (int (*)(struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *, PyObject *, int __pyx_skip_dispatch))__pyx_f_11resiliparse_5parse_4html_7DOMNode_matches;
   __pyx_vtable_11resiliparse_5parse_4html_DOMNode.append_child = (struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *(*)(struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *, struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *, int __pyx_skip_dispatch))__pyx_f_11resiliparse_5parse_4html_7DOMNode_append_child;
   __pyx_vtable_11resiliparse_5parse_4html_DOMNode.insert_before = (struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *(*)(struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *, struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *, struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *, int __pyx_skip_dispatch))__pyx_f_11resiliparse_5parse_4html_7DOMNode_insert_before;
   __pyx_vtable_11resiliparse_5parse_4html_DOMNode.replace_child = (struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *(*)(struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *, struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *, struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *, int __pyx_skip_dispatch))__pyx_f_11resiliparse_5parse_4html_7DOMNode_replace_child;
   __pyx_vtable_11resiliparse_5parse_4html_DOMNode.remove_child = (struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *(*)(struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *, struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *, int __pyx_skip_dispatch))__pyx_f_11resiliparse_5parse_4html_7DOMNode_remove_child;
   __pyx_vtable_11resiliparse_5parse_4html_DOMNode.decompose = (PyObject *(*)(struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *, int __pyx_skip_dispatch))__pyx_f_11resiliparse_5parse_4html_7DOMNode_decompose;
-  if (PyType_Ready(&__pyx_type_11resiliparse_5parse_4html_DOMNode) < 0) __PYX_ERR(0, 417, __pyx_L1_error)
+  if (PyType_Ready(&__pyx_type_11resiliparse_5parse_4html_DOMNode) < 0) __PYX_ERR(0, 463, __pyx_L1_error)
   #if PY_VERSION_HEX < 0x030800B1
   __pyx_type_11resiliparse_5parse_4html_DOMNode.tp_print = 0;
   #endif
   if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_11resiliparse_5parse_4html_DOMNode.tp_dictoffset && __pyx_type_11resiliparse_5parse_4html_DOMNode.tp_getattro == PyObject_GenericGetAttr)) {
     __pyx_type_11resiliparse_5parse_4html_DOMNode.tp_getattro = __Pyx_PyObject_GenericGetAttr;
   }
   #if CYTHON_COMPILING_IN_CPYTHON
   {
-    PyObject *wrapper = PyObject_GetAttrString((PyObject *)&__pyx_type_11resiliparse_5parse_4html_DOMNode, "__iter__"); if (unlikely(!wrapper)) __PYX_ERR(0, 417, __pyx_L1_error)
+    PyObject *wrapper = PyObject_GetAttrString((PyObject *)&__pyx_type_11resiliparse_5parse_4html_DOMNode, "__iter__"); if (unlikely(!wrapper)) __PYX_ERR(0, 463, __pyx_L1_error)
     if (Py_TYPE(wrapper) == &PyWrapperDescr_Type) {
       __pyx_wrapperbase_11resiliparse_5parse_4html_7DOMNode_4__iter__ = *((PyWrapperDescrObject *)wrapper)->d_base;
       __pyx_wrapperbase_11resiliparse_5parse_4html_7DOMNode_4__iter__.doc = __pyx_doc_11resiliparse_5parse_4html_7DOMNode_4__iter__;
       ((PyWrapperDescrObject *)wrapper)->d_base = &__pyx_wrapperbase_11resiliparse_5parse_4html_7DOMNode_4__iter__;
     }
   }
   #endif
   #if CYTHON_COMPILING_IN_CPYTHON
   {
-    PyObject *wrapper = PyObject_GetAttrString((PyObject *)&__pyx_type_11resiliparse_5parse_4html_DOMNode, "__getitem__"); if (unlikely(!wrapper)) __PYX_ERR(0, 417, __pyx_L1_error)
+    PyObject *wrapper = PyObject_GetAttrString((PyObject *)&__pyx_type_11resiliparse_5parse_4html_DOMNode, "__getitem__"); if (unlikely(!wrapper)) __PYX_ERR(0, 463, __pyx_L1_error)
     if (Py_TYPE(wrapper) == &PyWrapperDescr_Type) {
       __pyx_wrapperbase_11resiliparse_5parse_4html_7DOMNode_11__getitem__ = *((PyWrapperDescrObject *)wrapper)->d_base;
       __pyx_wrapperbase_11resiliparse_5parse_4html_7DOMNode_11__getitem__.doc = __pyx_doc_11resiliparse_5parse_4html_7DOMNode_11__getitem__;
       ((PyWrapperDescrObject *)wrapper)->d_base = &__pyx_wrapperbase_11resiliparse_5parse_4html_7DOMNode_11__getitem__;
     }
   }
   #endif
   #if CYTHON_COMPILING_IN_CPYTHON
   {
-    PyObject *wrapper = PyObject_GetAttrString((PyObject *)&__pyx_type_11resiliparse_5parse_4html_DOMNode, "__setitem__"); if (unlikely(!wrapper)) __PYX_ERR(0, 417, __pyx_L1_error)
+    PyObject *wrapper = PyObject_GetAttrString((PyObject *)&__pyx_type_11resiliparse_5parse_4html_DOMNode, "__setitem__"); if (unlikely(!wrapper)) __PYX_ERR(0, 463, __pyx_L1_error)
     if (Py_TYPE(wrapper) == &PyWrapperDescr_Type) {
       __pyx_wrapperbase_11resiliparse_5parse_4html_7DOMNode_15__setitem__ = *((PyWrapperDescrObject *)wrapper)->d_base;
       __pyx_wrapperbase_11resiliparse_5parse_4html_7DOMNode_15__setitem__.doc = __pyx_doc_11resiliparse_5parse_4html_7DOMNode_15__setitem__;
       ((PyWrapperDescrObject *)wrapper)->d_base = &__pyx_wrapperbase_11resiliparse_5parse_4html_7DOMNode_15__setitem__;
     }
   }
   #endif
   #if CYTHON_COMPILING_IN_CPYTHON
   {
-    PyObject *wrapper = PyObject_GetAttrString((PyObject *)&__pyx_type_11resiliparse_5parse_4html_DOMNode, "__delitem__"); if (unlikely(!wrapper)) __PYX_ERR(0, 417, __pyx_L1_error)
+    PyObject *wrapper = PyObject_GetAttrString((PyObject *)&__pyx_type_11resiliparse_5parse_4html_DOMNode, "__delitem__"); if (unlikely(!wrapper)) __PYX_ERR(0, 463, __pyx_L1_error)
     if (Py_TYPE(wrapper) == &PyWrapperDescr_Type) {
       __pyx_wrapperbase_11resiliparse_5parse_4html_7DOMNode_19__delitem__ = *((PyWrapperDescrObject *)wrapper)->d_base;
       __pyx_wrapperbase_11resiliparse_5parse_4html_7DOMNode_19__delitem__.doc = __pyx_doc_11resiliparse_5parse_4html_7DOMNode_19__delitem__;
       ((PyWrapperDescrObject *)wrapper)->d_base = &__pyx_wrapperbase_11resiliparse_5parse_4html_7DOMNode_19__delitem__;
     }
   }
   #endif
-  if (__Pyx_SetVtable(__pyx_type_11resiliparse_5parse_4html_DOMNode.tp_dict, __pyx_vtabptr_11resiliparse_5parse_4html_DOMNode) < 0) __PYX_ERR(0, 417, __pyx_L1_error)
-  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_DOMNode, (PyObject *)&__pyx_type_11resiliparse_5parse_4html_DOMNode) < 0) __PYX_ERR(0, 417, __pyx_L1_error)
-  if (__Pyx_setup_reduce((PyObject*)&__pyx_type_11resiliparse_5parse_4html_DOMNode) < 0) __PYX_ERR(0, 417, __pyx_L1_error)
+  if (__Pyx_SetVtable(__pyx_type_11resiliparse_5parse_4html_DOMNode.tp_dict, __pyx_vtabptr_11resiliparse_5parse_4html_DOMNode) < 0) __PYX_ERR(0, 463, __pyx_L1_error)
+  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_DOMNode, (PyObject *)&__pyx_type_11resiliparse_5parse_4html_DOMNode) < 0) __PYX_ERR(0, 463, __pyx_L1_error)
+  if (__Pyx_setup_reduce((PyObject*)&__pyx_type_11resiliparse_5parse_4html_DOMNode) < 0) __PYX_ERR(0, 463, __pyx_L1_error)
   __pyx_ptype_11resiliparse_5parse_4html_DOMNode = &__pyx_type_11resiliparse_5parse_4html_DOMNode;
   __pyx_vtabptr_11resiliparse_5parse_4html_DOMCollection = &__pyx_vtable_11resiliparse_5parse_4html_DOMCollection;
   __pyx_vtable_11resiliparse_5parse_4html_DOMCollection._wrap_idx = (size_t (*)(struct __pyx_obj_11resiliparse_5parse_4html_DOMCollection *, Py_ssize_t))__pyx_f_11resiliparse_5parse_4html_13DOMCollection__wrap_idx;
   __pyx_vtable_11resiliparse_5parse_4html_DOMCollection._forward_collection_match = (struct __pyx_obj_11resiliparse_5parse_4html_DOMCollection *(*)(struct __pyx_obj_11resiliparse_5parse_4html_DOMCollection *, PyObject *, PyObject *))__pyx_f_11resiliparse_5parse_4html_13DOMCollection__forward_collection_match;
   __pyx_vtable_11resiliparse_5parse_4html_DOMCollection.get_element_by_id = (struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *(*)(struct __pyx_obj_11resiliparse_5parse_4html_DOMCollection *, PyObject *, int __pyx_skip_dispatch, struct __pyx_opt_args_11resiliparse_5parse_4html_13DOMCollection_get_element_by_id *__pyx_optional_args))__pyx_f_11resiliparse_5parse_4html_13DOMCollection_get_element_by_id;
   __pyx_vtable_11resiliparse_5parse_4html_DOMCollection.get_elements_by_attr = (struct __pyx_obj_11resiliparse_5parse_4html_DOMCollection *(*)(struct __pyx_obj_11resiliparse_5parse_4html_DOMCollection *, PyObject *, PyObject *, int __pyx_skip_dispatch, struct __pyx_opt_args_11resiliparse_5parse_4html_13DOMCollection_get_elements_by_attr *__pyx_optional_args))__pyx_f_11resiliparse_5parse_4html_13DOMCollection_get_elements_by_attr;
   __pyx_vtable_11resiliparse_5parse_4html_DOMCollection.get_elements_by_class_name = (struct __pyx_obj_11resiliparse_5parse_4html_DOMCollection *(*)(struct __pyx_obj_11resiliparse_5parse_4html_DOMCollection *, PyObject *, int __pyx_skip_dispatch, struct __pyx_opt_args_11resiliparse_5parse_4html_13DOMCollection_get_elements_by_class_name *__pyx_optional_args))__pyx_f_11resiliparse_5parse_4html_13DOMCollection_get_elements_by_class_name;
   __pyx_vtable_11resiliparse_5parse_4html_DOMCollection.get_elements_by_tag_name = (struct __pyx_obj_11resiliparse_5parse_4html_DOMCollection *(*)(struct __pyx_obj_11resiliparse_5parse_4html_DOMCollection *, PyObject *, int __pyx_skip_dispatch))__pyx_f_11resiliparse_5parse_4html_13DOMCollection_get_elements_by_tag_name;
   __pyx_vtable_11resiliparse_5parse_4html_DOMCollection.query_selector = (struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *(*)(struct __pyx_obj_11resiliparse_5parse_4html_DOMCollection *, PyObject *, int __pyx_skip_dispatch))__pyx_f_11resiliparse_5parse_4html_13DOMCollection_query_selector;
   __pyx_vtable_11resiliparse_5parse_4html_DOMCollection.query_selector_all = (struct __pyx_obj_11resiliparse_5parse_4html_DOMCollection *(*)(struct __pyx_obj_11resiliparse_5parse_4html_DOMCollection *, PyObject *, int __pyx_skip_dispatch))__pyx_f_11resiliparse_5parse_4html_13DOMCollection_query_selector_all;
   __pyx_vtable_11resiliparse_5parse_4html_DOMCollection.matches = (int (*)(struct __pyx_obj_11resiliparse_5parse_4html_DOMCollection *, PyObject *, int __pyx_skip_dispatch))__pyx_f_11resiliparse_5parse_4html_13DOMCollection_matches;
-  if (PyType_Ready(&__pyx_type_11resiliparse_5parse_4html_DOMCollection) < 0) __PYX_ERR(0, 1240, __pyx_L1_error)
+  if (PyType_Ready(&__pyx_type_11resiliparse_5parse_4html_DOMCollection) < 0) __PYX_ERR(0, 1286, __pyx_L1_error)
   #if PY_VERSION_HEX < 0x030800B1
   __pyx_type_11resiliparse_5parse_4html_DOMCollection.tp_print = 0;
   #endif
   if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_11resiliparse_5parse_4html_DOMCollection.tp_dictoffset && __pyx_type_11resiliparse_5parse_4html_DOMCollection.tp_getattro == PyObject_GenericGetAttr)) {
     __pyx_type_11resiliparse_5parse_4html_DOMCollection.tp_getattro = __Pyx_PyObject_GenericGetAttr;
   }
   #if CYTHON_COMPILING_IN_CPYTHON
   {
-    PyObject *wrapper = PyObject_GetAttrString((PyObject *)&__pyx_type_11resiliparse_5parse_4html_DOMCollection, "__iter__"); if (unlikely(!wrapper)) __PYX_ERR(0, 1240, __pyx_L1_error)
+    PyObject *wrapper = PyObject_GetAttrString((PyObject *)&__pyx_type_11resiliparse_5parse_4html_DOMCollection, "__iter__"); if (unlikely(!wrapper)) __PYX_ERR(0, 1286, __pyx_L1_error)
     if (Py_TYPE(wrapper) == &PyWrapperDescr_Type) {
       __pyx_wrapperbase_11resiliparse_5parse_4html_13DOMCollection_18__iter__ = *((PyWrapperDescrObject *)wrapper)->d_base;
       __pyx_wrapperbase_11resiliparse_5parse_4html_13DOMCollection_18__iter__.doc = __pyx_doc_11resiliparse_5parse_4html_13DOMCollection_18__iter__;
       ((PyWrapperDescrObject *)wrapper)->d_base = &__pyx_wrapperbase_11resiliparse_5parse_4html_13DOMCollection_18__iter__;
     }
   }
   #endif
   #if CYTHON_COMPILING_IN_CPYTHON
   {
-    PyObject *wrapper = PyObject_GetAttrString((PyObject *)&__pyx_type_11resiliparse_5parse_4html_DOMCollection, "__len__"); if (unlikely(!wrapper)) __PYX_ERR(0, 1240, __pyx_L1_error)
+    PyObject *wrapper = PyObject_GetAttrString((PyObject *)&__pyx_type_11resiliparse_5parse_4html_DOMCollection, "__len__"); if (unlikely(!wrapper)) __PYX_ERR(0, 1286, __pyx_L1_error)
     if (Py_TYPE(wrapper) == &PyWrapperDescr_Type) {
       __pyx_wrapperbase_11resiliparse_5parse_4html_13DOMCollection_21__len__ = *((PyWrapperDescrObject *)wrapper)->d_base;
       __pyx_wrapperbase_11resiliparse_5parse_4html_13DOMCollection_21__len__.doc = __pyx_doc_11resiliparse_5parse_4html_13DOMCollection_21__len__;
       ((PyWrapperDescrObject *)wrapper)->d_base = &__pyx_wrapperbase_11resiliparse_5parse_4html_13DOMCollection_21__len__;
     }
   }
   #endif
   #if CYTHON_COMPILING_IN_CPYTHON
   {
-    PyObject *wrapper = PyObject_GetAttrString((PyObject *)&__pyx_type_11resiliparse_5parse_4html_DOMCollection, "__getitem__"); if (unlikely(!wrapper)) __PYX_ERR(0, 1240, __pyx_L1_error)
+    PyObject *wrapper = PyObject_GetAttrString((PyObject *)&__pyx_type_11resiliparse_5parse_4html_DOMCollection, "__getitem__"); if (unlikely(!wrapper)) __PYX_ERR(0, 1286, __pyx_L1_error)
     if (Py_TYPE(wrapper) == &PyWrapperDescr_Type) {
       __pyx_wrapperbase_11resiliparse_5parse_4html_13DOMCollection_23__getitem__ = *((PyWrapperDescrObject *)wrapper)->d_base;
       __pyx_wrapperbase_11resiliparse_5parse_4html_13DOMCollection_23__getitem__.doc = __pyx_doc_11resiliparse_5parse_4html_13DOMCollection_23__getitem__;
       ((PyWrapperDescrObject *)wrapper)->d_base = &__pyx_wrapperbase_11resiliparse_5parse_4html_13DOMCollection_23__getitem__;
     }
   }
   #endif
-  if (__Pyx_SetVtable(__pyx_type_11resiliparse_5parse_4html_DOMCollection.tp_dict, __pyx_vtabptr_11resiliparse_5parse_4html_DOMCollection) < 0) __PYX_ERR(0, 1240, __pyx_L1_error)
-  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_DOMCollection, (PyObject *)&__pyx_type_11resiliparse_5parse_4html_DOMCollection) < 0) __PYX_ERR(0, 1240, __pyx_L1_error)
-  if (__Pyx_setup_reduce((PyObject*)&__pyx_type_11resiliparse_5parse_4html_DOMCollection) < 0) __PYX_ERR(0, 1240, __pyx_L1_error)
+  if (__Pyx_SetVtable(__pyx_type_11resiliparse_5parse_4html_DOMCollection.tp_dict, __pyx_vtabptr_11resiliparse_5parse_4html_DOMCollection) < 0) __PYX_ERR(0, 1286, __pyx_L1_error)
+  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_DOMCollection, (PyObject *)&__pyx_type_11resiliparse_5parse_4html_DOMCollection) < 0) __PYX_ERR(0, 1286, __pyx_L1_error)
+  if (__Pyx_setup_reduce((PyObject*)&__pyx_type_11resiliparse_5parse_4html_DOMCollection) < 0) __PYX_ERR(0, 1286, __pyx_L1_error)
   __pyx_ptype_11resiliparse_5parse_4html_DOMCollection = &__pyx_type_11resiliparse_5parse_4html_DOMCollection;
   __pyx_vtabptr_11resiliparse_5parse_4html_HTMLTree = &__pyx_vtable_11resiliparse_5parse_4html_HTMLTree;
   __pyx_vtable_11resiliparse_5parse_4html_HTMLTree.create_element = (struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *(*)(struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *, PyObject *, int __pyx_skip_dispatch))__pyx_f_11resiliparse_5parse_4html_8HTMLTree_create_element;
   __pyx_vtable_11resiliparse_5parse_4html_HTMLTree.create_text_node = (struct __pyx_obj_11resiliparse_5parse_4html_DOMNode *(*)(struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *, PyObject *, int __pyx_skip_dispatch))__pyx_f_11resiliparse_5parse_4html_8HTMLTree_create_text_node;
   __pyx_vtable_11resiliparse_5parse_4html_HTMLTree.init_css_parser = (void (*)(struct __pyx_obj_11resiliparse_5parse_4html_HTMLTree *))__pyx_f_11resiliparse_5parse_4html_8HTMLTree_init_css_parser;
-  if (PyType_Ready(&__pyx_type_11resiliparse_5parse_4html_HTMLTree) < 0) __PYX_ERR(0, 1552, __pyx_L1_error)
+  if (PyType_Ready(&__pyx_type_11resiliparse_5parse_4html_HTMLTree) < 0) __PYX_ERR(0, 1598, __pyx_L1_error)
   #if PY_VERSION_HEX < 0x030800B1
   __pyx_type_11resiliparse_5parse_4html_HTMLTree.tp_print = 0;
   #endif
   if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_11resiliparse_5parse_4html_HTMLTree.tp_dictoffset && __pyx_type_11resiliparse_5parse_4html_HTMLTree.tp_getattro == PyObject_GenericGetAttr)) {
     __pyx_type_11resiliparse_5parse_4html_HTMLTree.tp_getattro = __Pyx_PyObject_GenericGetAttr;
   }
-  if (__Pyx_SetVtable(__pyx_type_11resiliparse_5parse_4html_HTMLTree.tp_dict, __pyx_vtabptr_11resiliparse_5parse_4html_HTMLTree) < 0) __PYX_ERR(0, 1552, __pyx_L1_error)
-  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_HTMLTree, (PyObject *)&__pyx_type_11resiliparse_5parse_4html_HTMLTree) < 0) __PYX_ERR(0, 1552, __pyx_L1_error)
-  if (__Pyx_setup_reduce((PyObject*)&__pyx_type_11resiliparse_5parse_4html_HTMLTree) < 0) __PYX_ERR(0, 1552, __pyx_L1_error)
+  if (__Pyx_SetVtable(__pyx_type_11resiliparse_5parse_4html_HTMLTree.tp_dict, __pyx_vtabptr_11resiliparse_5parse_4html_HTMLTree) < 0) __PYX_ERR(0, 1598, __pyx_L1_error)
+  if (PyObject_SetAttr(__pyx_m, __pyx_n_s_HTMLTree, (PyObject *)&__pyx_type_11resiliparse_5parse_4html_HTMLTree) < 0) __PYX_ERR(0, 1598, __pyx_L1_error)
+  if (__Pyx_setup_reduce((PyObject*)&__pyx_type_11resiliparse_5parse_4html_HTMLTree) < 0) __PYX_ERR(0, 1598, __pyx_L1_error)
   __pyx_ptype_11resiliparse_5parse_4html_HTMLTree = &__pyx_type_11resiliparse_5parse_4html_HTMLTree;
-  if (PyType_Ready(&__pyx_type_11resiliparse_5parse_4html___pyx_scope_struct____iter__) < 0) __PYX_ERR(0, 445, __pyx_L1_error)
+  if (PyType_Ready(&__pyx_type_11resiliparse_5parse_4html___pyx_scope_struct____iter__) < 0) __PYX_ERR(0, 491, __pyx_L1_error)
   #if PY_VERSION_HEX < 0x030800B1
   __pyx_type_11resiliparse_5parse_4html___pyx_scope_struct____iter__.tp_print = 0;
   #endif
   if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_11resiliparse_5parse_4html___pyx_scope_struct____iter__.tp_dictoffset && __pyx_type_11resiliparse_5parse_4html___pyx_scope_struct____iter__.tp_getattro == PyObject_GenericGetAttr)) {
     __pyx_type_11resiliparse_5parse_4html___pyx_scope_struct____iter__.tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
   }
   __pyx_ptype_11resiliparse_5parse_4html___pyx_scope_struct____iter__ = &__pyx_type_11resiliparse_5parse_4html___pyx_scope_struct____iter__;
-  if (PyType_Ready(&__pyx_type_11resiliparse_5parse_4html___pyx_scope_struct_1___repr__) < 0) __PYX_ERR(0, 1194, __pyx_L1_error)
+  if (PyType_Ready(&__pyx_type_11resiliparse_5parse_4html___pyx_scope_struct_1___repr__) < 0) __PYX_ERR(0, 1240, __pyx_L1_error)
   #if PY_VERSION_HEX < 0x030800B1
   __pyx_type_11resiliparse_5parse_4html___pyx_scope_struct_1___repr__.tp_print = 0;
   #endif
   if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_11resiliparse_5parse_4html___pyx_scope_struct_1___repr__.tp_dictoffset && __pyx_type_11resiliparse_5parse_4html___pyx_scope_struct_1___repr__.tp_getattro == PyObject_GenericGetAttr)) {
     __pyx_type_11resiliparse_5parse_4html___pyx_scope_struct_1___repr__.tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
   }
   __pyx_ptype_11resiliparse_5parse_4html___pyx_scope_struct_1___repr__ = &__pyx_type_11resiliparse_5parse_4html___pyx_scope_struct_1___repr__;
-  if (PyType_Ready(&__pyx_type_11resiliparse_5parse_4html___pyx_scope_struct_2_genexpr) < 0) __PYX_ERR(0, 1199, __pyx_L1_error)
+  if (PyType_Ready(&__pyx_type_11resiliparse_5parse_4html___pyx_scope_struct_2_genexpr) < 0) __PYX_ERR(0, 1245, __pyx_L1_error)
   #if PY_VERSION_HEX < 0x030800B1
   __pyx_type_11resiliparse_5parse_4html___pyx_scope_struct_2_genexpr.tp_print = 0;
   #endif
   if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_11resiliparse_5parse_4html___pyx_scope_struct_2_genexpr.tp_dictoffset && __pyx_type_11resiliparse_5parse_4html___pyx_scope_struct_2_genexpr.tp_getattro == PyObject_GenericGetAttr)) {
     __pyx_type_11resiliparse_5parse_4html___pyx_scope_struct_2_genexpr.tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
   }
   __pyx_ptype_11resiliparse_5parse_4html___pyx_scope_struct_2_genexpr = &__pyx_type_11resiliparse_5parse_4html___pyx_scope_struct_2_genexpr;
-  if (PyType_Ready(&__pyx_type_11resiliparse_5parse_4html___pyx_scope_struct_3___iter__) < 0) __PYX_ERR(0, 1443, __pyx_L1_error)
+  if (PyType_Ready(&__pyx_type_11resiliparse_5parse_4html___pyx_scope_struct_3___iter__) < 0) __PYX_ERR(0, 1489, __pyx_L1_error)
   #if PY_VERSION_HEX < 0x030800B1
   __pyx_type_11resiliparse_5parse_4html___pyx_scope_struct_3___iter__.tp_print = 0;
   #endif
   if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_11resiliparse_5parse_4html___pyx_scope_struct_3___iter__.tp_dictoffset && __pyx_type_11resiliparse_5parse_4html___pyx_scope_struct_3___iter__.tp_getattro == PyObject_GenericGetAttr)) {
     __pyx_type_11resiliparse_5parse_4html___pyx_scope_struct_3___iter__.tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
   }
   __pyx_ptype_11resiliparse_5parse_4html___pyx_scope_struct_3___iter__ = &__pyx_type_11resiliparse_5parse_4html___pyx_scope_struct_3___iter__;
-  if (PyType_Ready(&__pyx_type_11resiliparse_5parse_4html___pyx_scope_struct_4___repr__) < 0) __PYX_ERR(0, 1521, __pyx_L1_error)
+  if (PyType_Ready(&__pyx_type_11resiliparse_5parse_4html___pyx_scope_struct_4___repr__) < 0) __PYX_ERR(0, 1567, __pyx_L1_error)
   #if PY_VERSION_HEX < 0x030800B1
   __pyx_type_11resiliparse_5parse_4html___pyx_scope_struct_4___repr__.tp_print = 0;
   #endif
   if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_11resiliparse_5parse_4html___pyx_scope_struct_4___repr__.tp_dictoffset && __pyx_type_11resiliparse_5parse_4html___pyx_scope_struct_4___repr__.tp_getattro == PyObject_GenericGetAttr)) {
     __pyx_type_11resiliparse_5parse_4html___pyx_scope_struct_4___repr__.tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
   }
   __pyx_ptype_11resiliparse_5parse_4html___pyx_scope_struct_4___repr__ = &__pyx_type_11resiliparse_5parse_4html___pyx_scope_struct_4___repr__;
-  if (PyType_Ready(&__pyx_type_11resiliparse_5parse_4html___pyx_scope_struct_5_genexpr) < 0) __PYX_ERR(0, 1522, __pyx_L1_error)
+  if (PyType_Ready(&__pyx_type_11resiliparse_5parse_4html___pyx_scope_struct_5_genexpr) < 0) __PYX_ERR(0, 1568, __pyx_L1_error)
   #if PY_VERSION_HEX < 0x030800B1
   __pyx_type_11resiliparse_5parse_4html___pyx_scope_struct_5_genexpr.tp_print = 0;
   #endif
   if ((CYTHON_USE_TYPE_SLOTS && CYTHON_USE_PYTYPE_LOOKUP) && likely(!__pyx_type_11resiliparse_5parse_4html___pyx_scope_struct_5_genexpr.tp_dictoffset && __pyx_type_11resiliparse_5parse_4html___pyx_scope_struct_5_genexpr.tp_getattro == PyObject_GenericGetAttr)) {
     __pyx_type_11resiliparse_5parse_4html___pyx_scope_struct_5_genexpr.tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
   }
   __pyx_ptype_11resiliparse_5parse_4html___pyx_scope_struct_5_genexpr = &__pyx_type_11resiliparse_5parse_4html___pyx_scope_struct_5_genexpr;
@@ -27875,107 +28493,107 @@
  * cimport cython
  */
   __pyx_t_1 = __Pyx_Import(__pyx_n_s_typing, 0, 0); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 17, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   if (PyDict_SetItem(__pyx_d, __pyx_n_s_t, __pyx_t_1) < 0) __PYX_ERR(0, 17, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "resiliparse/parse/html.pyx":1602
+  /* "resiliparse/parse/html.pyx":1639
  * 
  *     @classmethod
  *     def parse(cls, str document):             # <<<<<<<<<<<<<<
  *         """
  *         parse(self, document)
  */
-  __Pyx_GetNameInClass(__pyx_t_1, (PyObject *)__pyx_ptype_11resiliparse_5parse_4html_HTMLTree, __pyx_n_s_parse); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1602, __pyx_L1_error)
+  __Pyx_GetNameInClass(__pyx_t_1, (PyObject *)__pyx_ptype_11resiliparse_5parse_4html_HTMLTree, __pyx_n_s_parse); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1639, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
 
-  /* "resiliparse/parse/html.pyx":1601
+  /* "resiliparse/parse/html.pyx":1638
  * 
  * 
  *     @classmethod             # <<<<<<<<<<<<<<
  *     def parse(cls, str document):
  *         """
  */
-  __pyx_t_2 = __Pyx_Method_ClassMethod(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1601, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_Method_ClassMethod(__pyx_t_1); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1638, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
-  if (PyDict_SetItem((PyObject *)__pyx_ptype_11resiliparse_5parse_4html_HTMLTree->tp_dict, __pyx_n_s_parse, __pyx_t_2) < 0) __PYX_ERR(0, 1602, __pyx_L1_error)
+  if (PyDict_SetItem((PyObject *)__pyx_ptype_11resiliparse_5parse_4html_HTMLTree->tp_dict, __pyx_n_s_parse, __pyx_t_2) < 0) __PYX_ERR(0, 1639, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   PyType_Modified(__pyx_ptype_11resiliparse_5parse_4html_HTMLTree);
 
-  /* "resiliparse/parse/html.pyx":1616
+  /* "resiliparse/parse/html.pyx":1653
  * 
  *     @classmethod
  *     def parse_from_bytes(cls, bytes document, str encoding='utf-8', str errors='ignore'):             # <<<<<<<<<<<<<<
  *         """
  *         parse_from_bytes(self, document, encoding='utf-8', errors='ignore')
  */
-  __Pyx_GetNameInClass(__pyx_t_2, (PyObject *)__pyx_ptype_11resiliparse_5parse_4html_HTMLTree, __pyx_n_s_parse_from_bytes); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1616, __pyx_L1_error)
+  __Pyx_GetNameInClass(__pyx_t_2, (PyObject *)__pyx_ptype_11resiliparse_5parse_4html_HTMLTree, __pyx_n_s_parse_from_bytes); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1653, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
 
-  /* "resiliparse/parse/html.pyx":1615
+  /* "resiliparse/parse/html.pyx":1652
  *         return create_html_tree(document.encode(), reencode=False)
  * 
  *     @classmethod             # <<<<<<<<<<<<<<
  *     def parse_from_bytes(cls, bytes document, str encoding='utf-8', str errors='ignore'):
  *         """
  */
-  __pyx_t_1 = __Pyx_Method_ClassMethod(__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1615, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_Method_ClassMethod(__pyx_t_2); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1652, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
-  if (PyDict_SetItem((PyObject *)__pyx_ptype_11resiliparse_5parse_4html_HTMLTree->tp_dict, __pyx_n_s_parse_from_bytes, __pyx_t_1) < 0) __PYX_ERR(0, 1616, __pyx_L1_error)
+  if (PyDict_SetItem((PyObject *)__pyx_ptype_11resiliparse_5parse_4html_HTMLTree->tp_dict, __pyx_n_s_parse_from_bytes, __pyx_t_1) < 0) __PYX_ERR(0, 1653, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
   PyType_Modified(__pyx_ptype_11resiliparse_5parse_4html_HTMLTree);
 
-  /* "resiliparse/parse/html.pyx":1741
+  /* "resiliparse/parse/html.pyx":1778
  * 
  * 
  * class DOMContext:             # <<<<<<<<<<<<<<
  *     """
  *     __init__()
  */
-  __pyx_t_1 = __Pyx_Py3MetaclassPrepare((PyObject *) NULL, __pyx_empty_tuple, __pyx_n_s_DOMContext, __pyx_n_s_DOMContext, (PyObject *) NULL, __pyx_n_s_resiliparse_parse_html, __pyx_kp_s_init___DOM_node_traversal_con); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1741, __pyx_L1_error)
+  __pyx_t_1 = __Pyx_Py3MetaclassPrepare((PyObject *) NULL, __pyx_empty_tuple, __pyx_n_s_DOMContext, __pyx_n_s_DOMContext, (PyObject *) NULL, __pyx_n_s_resiliparse_parse_html, __pyx_kp_s_init___DOM_node_traversal_con); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1778, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
 
-  /* "resiliparse/parse/html.pyx":1755
+  /* "resiliparse/parse/html.pyx":1792
  *     :ivar int depth: the current traversal depth
  *     """
  *     def __init__(self):             # <<<<<<<<<<<<<<
  *         self.node = None
  *         self.depth = 0
  */
-  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_11resiliparse_5parse_4html_10DOMContext_1__init__, 0, __pyx_n_s_DOMContext___init, NULL, __pyx_n_s_resiliparse_parse_html, __pyx_d, ((PyObject *)__pyx_codeobj__41)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1755, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_CyFunction_New(&__pyx_mdef_11resiliparse_5parse_4html_10DOMContext_1__init__, 0, __pyx_n_s_DOMContext___init, NULL, __pyx_n_s_resiliparse_parse_html, __pyx_d, ((PyObject *)__pyx_codeobj__44)); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1792, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  if (__Pyx_SetNameInClass(__pyx_t_1, __pyx_n_s_init, __pyx_t_2) < 0) __PYX_ERR(0, 1755, __pyx_L1_error)
+  if (__Pyx_SetNameInClass(__pyx_t_1, __pyx_n_s_init, __pyx_t_2) < 0) __PYX_ERR(0, 1792, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
 
-  /* "resiliparse/parse/html.pyx":1741
+  /* "resiliparse/parse/html.pyx":1778
  * 
  * 
  * class DOMContext:             # <<<<<<<<<<<<<<
  *     """
  *     __init__()
  */
-  __pyx_t_2 = __Pyx_Py3ClassCreate(((PyObject*)&__Pyx_DefaultClassType), __pyx_n_s_DOMContext, __pyx_empty_tuple, __pyx_t_1, NULL, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1741, __pyx_L1_error)
+  __pyx_t_2 = __Pyx_Py3ClassCreate(((PyObject*)&__Pyx_DefaultClassType), __pyx_n_s_DOMContext, __pyx_empty_tuple, __pyx_t_1, NULL, 0, 0); if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1778, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_2);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_DOMContext, __pyx_t_2) < 0) __PYX_ERR(0, 1741, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_DOMContext, __pyx_t_2) < 0) __PYX_ERR(0, 1778, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_2); __pyx_t_2 = 0;
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
-  /* "resiliparse/parse/html.pyx":1760
+  /* "resiliparse/parse/html.pyx":1797
  * 
  * 
  * def traverse_dom(DOMNode base_node, start_callback, end_callback=None, context=None, bint elements_only=False):             # <<<<<<<<<<<<<<
  *     """
  *     traverse_dom(base_node, start_callback, end_callback=None, context=None, elements_only=False)
  */
-  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_11resiliparse_5parse_4html_1traverse_dom, NULL, __pyx_n_s_resiliparse_parse_html); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1760, __pyx_L1_error)
+  __pyx_t_1 = PyCFunction_NewEx(&__pyx_mdef_11resiliparse_5parse_4html_1traverse_dom, NULL, __pyx_n_s_resiliparse_parse_html); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1797, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_1);
-  if (PyDict_SetItem(__pyx_d, __pyx_n_s_traverse_dom, __pyx_t_1) < 0) __PYX_ERR(0, 1760, __pyx_L1_error)
+  if (PyDict_SetItem(__pyx_d, __pyx_n_s_traverse_dom, __pyx_t_1) < 0) __PYX_ERR(0, 1797, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_1); __pyx_t_1 = 0;
 
   /* "resiliparse/parse/html.pyx":1
  * # Copyright 2021 Janek Bevendorff             # <<<<<<<<<<<<<<
  * #
  * # Licensed under the Apache License, Version 2.0 (the "License");
  */
@@ -28072,40 +28690,40 @@
   /* "EnumBase":28
  * class __Pyx_EnumBase(int):
  *     __metaclass__ = __Pyx_EnumMeta
  *     def __new__(cls, value, name=None):             # <<<<<<<<<<<<<<
  *         for v in cls:
  *             if v == value:
  */
-  __pyx_t_5 = __Pyx_CyFunction_New(&__pyx_mdef_8EnumBase_14__Pyx_EnumBase_1__new__, __Pyx_CYFUNCTION_STATICMETHOD, __pyx_n_s_Pyx_EnumBase___new, NULL, __pyx_n_s_EnumBase, __pyx_d, ((PyObject *)__pyx_codeobj__45)); if (unlikely(!__pyx_t_5)) __PYX_ERR(1, 28, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_CyFunction_New(&__pyx_mdef_8EnumBase_14__Pyx_EnumBase_1__new__, __Pyx_CYFUNCTION_STATICMETHOD, __pyx_n_s_Pyx_EnumBase___new, NULL, __pyx_n_s_EnumBase, __pyx_d, ((PyObject *)__pyx_codeobj__48)); if (unlikely(!__pyx_t_5)) __PYX_ERR(1, 28, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
-  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_5, __pyx_tuple__46);
+  __Pyx_CyFunction_SetDefaultsTuple(__pyx_t_5, __pyx_tuple__49);
   if (__Pyx_SetNameInClass(__pyx_t_4, __pyx_n_s_new, __pyx_t_5) < 0) __PYX_ERR(1, 28, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
   /* "EnumBase":39
  *         cls.__members__[name] = res
  *         return res
  *     def __repr__(self):             # <<<<<<<<<<<<<<
  *         return "<%s.%s: %d>" % (self.__class__.__name__, self.name, self)
  *     def __str__(self):
  */
-  __pyx_t_5 = __Pyx_CyFunction_New(&__pyx_mdef_8EnumBase_14__Pyx_EnumBase_3__repr__, 0, __pyx_n_s_Pyx_EnumBase___repr, NULL, __pyx_n_s_EnumBase, __pyx_d, ((PyObject *)__pyx_codeobj__48)); if (unlikely(!__pyx_t_5)) __PYX_ERR(1, 39, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_CyFunction_New(&__pyx_mdef_8EnumBase_14__Pyx_EnumBase_3__repr__, 0, __pyx_n_s_Pyx_EnumBase___repr, NULL, __pyx_n_s_EnumBase, __pyx_d, ((PyObject *)__pyx_codeobj__51)); if (unlikely(!__pyx_t_5)) __PYX_ERR(1, 39, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   if (__Pyx_SetNameInClass(__pyx_t_4, __pyx_n_s_repr, __pyx_t_5) < 0) __PYX_ERR(1, 39, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
   /* "EnumBase":41
  *     def __repr__(self):
  *         return "<%s.%s: %d>" % (self.__class__.__name__, self.name, self)
  *     def __str__(self):             # <<<<<<<<<<<<<<
  *         return "%s.%s" % (self.__class__.__name__, self.name)
  * 
  */
-  __pyx_t_5 = __Pyx_CyFunction_New(&__pyx_mdef_8EnumBase_14__Pyx_EnumBase_5__str__, 0, __pyx_n_s_Pyx_EnumBase___str, NULL, __pyx_n_s_EnumBase, __pyx_d, ((PyObject *)__pyx_codeobj__50)); if (unlikely(!__pyx_t_5)) __PYX_ERR(1, 41, __pyx_L1_error)
+  __pyx_t_5 = __Pyx_CyFunction_New(&__pyx_mdef_8EnumBase_14__Pyx_EnumBase_5__str__, 0, __pyx_n_s_Pyx_EnumBase___str, NULL, __pyx_n_s_EnumBase, __pyx_d, ((PyObject *)__pyx_codeobj__53)); if (unlikely(!__pyx_t_5)) __PYX_ERR(1, 41, __pyx_L1_error)
   __Pyx_GOTREF(__pyx_t_5);
   if (__Pyx_SetNameInClass(__pyx_t_4, __pyx_n_s_str, __pyx_t_5) < 0) __PYX_ERR(1, 41, __pyx_L1_error)
   __Pyx_DECREF(__pyx_t_5); __pyx_t_5 = 0;
 
   /* "EnumBase":26
  * 
  * cdef object __Pyx_EnumBase
@@ -29251,14 +29869,34 @@
 #else
             "name '%.200s' is not defined", PyString_AS_STRING(name));
 #endif
     }
     return result;
 }
 
+/* PyObjectCall */
+#if CYTHON_COMPILING_IN_CPYTHON
+static CYTHON_INLINE PyObject* __Pyx_PyObject_Call(PyObject *func, PyObject *arg, PyObject *kw) {
+    PyObject *result;
+    ternaryfunc call = Py_TYPE(func)->tp_call;
+    if (unlikely(!call))
+        return PyObject_Call(func, arg, kw);
+    if (unlikely(Py_EnterRecursiveCall((char*)" while calling a Python object")))
+        return NULL;
+    result = (*call)(func, arg, kw);
+    Py_LeaveRecursiveCall();
+    if (unlikely(!result) && unlikely(!PyErr_Occurred())) {
+        PyErr_SetString(
+            PyExc_SystemError,
+            "NULL result without error in PyObject_Call");
+    }
+    return result;
+}
+#endif
+
 /* PyErrFetchRestore */
 #if CYTHON_FAST_THREAD_STATE
 static CYTHON_INLINE void __Pyx_ErrRestoreInState(PyThreadState *tstate, PyObject *type, PyObject *value, PyObject *tb) {
     PyObject *tmp_type, *tmp_value, *tmp_tb;
     tmp_type = tstate->curexc_type;
     tmp_value = tstate->curexc_value;
     tmp_tb = tstate->curexc_traceback;
@@ -29275,76 +29913,14 @@
     *tb = tstate->curexc_traceback;
     tstate->curexc_type = 0;
     tstate->curexc_value = 0;
     tstate->curexc_traceback = 0;
 }
 #endif
 
-/* WriteUnraisableException */
-static void __Pyx_WriteUnraisable(const char *name, CYTHON_UNUSED int clineno,
-                                  CYTHON_UNUSED int lineno, CYTHON_UNUSED const char *filename,
-                                  int full_traceback, CYTHON_UNUSED int nogil) {
-    PyObject *old_exc, *old_val, *old_tb;
-    PyObject *ctx;
-    __Pyx_PyThreadState_declare
-#ifdef WITH_THREAD
-    PyGILState_STATE state;
-    if (nogil)
-        state = PyGILState_Ensure();
-#ifdef _MSC_VER
-    else state = (PyGILState_STATE)-1;
-#endif
-#endif
-    __Pyx_PyThreadState_assign
-    __Pyx_ErrFetch(&old_exc, &old_val, &old_tb);
-    if (full_traceback) {
-        Py_XINCREF(old_exc);
-        Py_XINCREF(old_val);
-        Py_XINCREF(old_tb);
-        __Pyx_ErrRestore(old_exc, old_val, old_tb);
-        PyErr_PrintEx(1);
-    }
-    #if PY_MAJOR_VERSION < 3
-    ctx = PyString_FromString(name);
-    #else
-    ctx = PyUnicode_FromString(name);
-    #endif
-    __Pyx_ErrRestore(old_exc, old_val, old_tb);
-    if (!ctx) {
-        PyErr_WriteUnraisable(Py_None);
-    } else {
-        PyErr_WriteUnraisable(ctx);
-        Py_DECREF(ctx);
-    }
-#ifdef WITH_THREAD
-    if (nogil)
-        PyGILState_Release(state);
-#endif
-}
-
-/* PyObjectCall */
-#if CYTHON_COMPILING_IN_CPYTHON
-static CYTHON_INLINE PyObject* __Pyx_PyObject_Call(PyObject *func, PyObject *arg, PyObject *kw) {
-    PyObject *result;
-    ternaryfunc call = Py_TYPE(func)->tp_call;
-    if (unlikely(!call))
-        return PyObject_Call(func, arg, kw);
-    if (unlikely(Py_EnterRecursiveCall((char*)" while calling a Python object")))
-        return NULL;
-    result = (*call)(func, arg, kw);
-    Py_LeaveRecursiveCall();
-    if (unlikely(!result) && unlikely(!PyErr_Occurred())) {
-        PyErr_SetString(
-            PyExc_SystemError,
-            "NULL result without error in PyObject_Call");
-    }
-    return result;
-}
-#endif
-
 /* RaiseException */
 #if PY_MAJOR_VERSION < 3
 static void __Pyx_Raise(PyObject *type, PyObject *value, PyObject *tb,
                         CYTHON_UNUSED PyObject *cause) {
     __Pyx_PyThreadState_declare
     Py_XINCREF(type);
     if (!value || value == Py_None)
@@ -29496,14 +30072,307 @@
     }
 bad:
     Py_XDECREF(owned_instance);
     return;
 }
 #endif
 
+/* WriteUnraisableException */
+static void __Pyx_WriteUnraisable(const char *name, CYTHON_UNUSED int clineno,
+                                  CYTHON_UNUSED int lineno, CYTHON_UNUSED const char *filename,
+                                  int full_traceback, CYTHON_UNUSED int nogil) {
+    PyObject *old_exc, *old_val, *old_tb;
+    PyObject *ctx;
+    __Pyx_PyThreadState_declare
+#ifdef WITH_THREAD
+    PyGILState_STATE state;
+    if (nogil)
+        state = PyGILState_Ensure();
+#ifdef _MSC_VER
+    else state = (PyGILState_STATE)-1;
+#endif
+#endif
+    __Pyx_PyThreadState_assign
+    __Pyx_ErrFetch(&old_exc, &old_val, &old_tb);
+    if (full_traceback) {
+        Py_XINCREF(old_exc);
+        Py_XINCREF(old_val);
+        Py_XINCREF(old_tb);
+        __Pyx_ErrRestore(old_exc, old_val, old_tb);
+        PyErr_PrintEx(1);
+    }
+    #if PY_MAJOR_VERSION < 3
+    ctx = PyString_FromString(name);
+    #else
+    ctx = PyUnicode_FromString(name);
+    #endif
+    __Pyx_ErrRestore(old_exc, old_val, old_tb);
+    if (!ctx) {
+        PyErr_WriteUnraisable(Py_None);
+    } else {
+        PyErr_WriteUnraisable(ctx);
+        Py_DECREF(ctx);
+    }
+#ifdef WITH_THREAD
+    if (nogil)
+        PyGILState_Release(state);
+#endif
+}
+
+/* decode_c_bytes */
+static CYTHON_INLINE PyObject* __Pyx_decode_c_bytes(
+         const char* cstring, Py_ssize_t length, Py_ssize_t start, Py_ssize_t stop,
+         const char* encoding, const char* errors,
+         PyObject* (*decode_func)(const char *s, Py_ssize_t size, const char *errors)) {
+    if (unlikely((start < 0) | (stop < 0))) {
+        if (start < 0) {
+            start += length;
+            if (start < 0)
+                start = 0;
+        }
+        if (stop < 0)
+            stop += length;
+    }
+    if (stop > length)
+        stop = length;
+    if (unlikely(stop <= start))
+        return __Pyx_NewRef(__pyx_empty_unicode);
+    length = stop - start;
+    cstring += start;
+    if (decode_func) {
+        return decode_func(cstring, length, errors);
+    } else {
+        return PyUnicode_Decode(cstring, length, encoding, errors);
+    }
+}
+
+/* PyFunctionFastCall */
+#if CYTHON_FAST_PYCALL
+static PyObject* __Pyx_PyFunction_FastCallNoKw(PyCodeObject *co, PyObject **args, Py_ssize_t na,
+                                               PyObject *globals) {
+    PyFrameObject *f;
+    PyThreadState *tstate = __Pyx_PyThreadState_Current;
+    PyObject **fastlocals;
+    Py_ssize_t i;
+    PyObject *result;
+    assert(globals != NULL);
+    /* XXX Perhaps we should create a specialized
+       PyFrame_New() that doesn't take locals, but does
+       take builtins without sanity checking them.
+       */
+    assert(tstate != NULL);
+    f = PyFrame_New(tstate, co, globals, NULL);
+    if (f == NULL) {
+        return NULL;
+    }
+    fastlocals = __Pyx_PyFrame_GetLocalsplus(f);
+    for (i = 0; i < na; i++) {
+        Py_INCREF(*args);
+        fastlocals[i] = *args++;
+    }
+    result = PyEval_EvalFrameEx(f,0);
+    ++tstate->recursion_depth;
+    Py_DECREF(f);
+    --tstate->recursion_depth;
+    return result;
+}
+#if 1 || PY_VERSION_HEX < 0x030600B1
+static PyObject *__Pyx_PyFunction_FastCallDict(PyObject *func, PyObject **args, Py_ssize_t nargs, PyObject *kwargs) {
+    PyCodeObject *co = (PyCodeObject *)PyFunction_GET_CODE(func);
+    PyObject *globals = PyFunction_GET_GLOBALS(func);
+    PyObject *argdefs = PyFunction_GET_DEFAULTS(func);
+    PyObject *closure;
+#if PY_MAJOR_VERSION >= 3
+    PyObject *kwdefs;
+#endif
+    PyObject *kwtuple, **k;
+    PyObject **d;
+    Py_ssize_t nd;
+    Py_ssize_t nk;
+    PyObject *result;
+    assert(kwargs == NULL || PyDict_Check(kwargs));
+    nk = kwargs ? PyDict_Size(kwargs) : 0;
+    if (Py_EnterRecursiveCall((char*)" while calling a Python object")) {
+        return NULL;
+    }
+    if (
+#if PY_MAJOR_VERSION >= 3
+            co->co_kwonlyargcount == 0 &&
+#endif
+            likely(kwargs == NULL || nk == 0) &&
+            co->co_flags == (CO_OPTIMIZED | CO_NEWLOCALS | CO_NOFREE)) {
+        if (argdefs == NULL && co->co_argcount == nargs) {
+            result = __Pyx_PyFunction_FastCallNoKw(co, args, nargs, globals);
+            goto done;
+        }
+        else if (nargs == 0 && argdefs != NULL
+                 && co->co_argcount == Py_SIZE(argdefs)) {
+            /* function called with no arguments, but all parameters have
+               a default value: use default values as arguments .*/
+            args = &PyTuple_GET_ITEM(argdefs, 0);
+            result =__Pyx_PyFunction_FastCallNoKw(co, args, Py_SIZE(argdefs), globals);
+            goto done;
+        }
+    }
+    if (kwargs != NULL) {
+        Py_ssize_t pos, i;
+        kwtuple = PyTuple_New(2 * nk);
+        if (kwtuple == NULL) {
+            result = NULL;
+            goto done;
+        }
+        k = &PyTuple_GET_ITEM(kwtuple, 0);
+        pos = i = 0;
+        while (PyDict_Next(kwargs, &pos, &k[i], &k[i+1])) {
+            Py_INCREF(k[i]);
+            Py_INCREF(k[i+1]);
+            i += 2;
+        }
+        nk = i / 2;
+    }
+    else {
+        kwtuple = NULL;
+        k = NULL;
+    }
+    closure = PyFunction_GET_CLOSURE(func);
+#if PY_MAJOR_VERSION >= 3
+    kwdefs = PyFunction_GET_KW_DEFAULTS(func);
+#endif
+    if (argdefs != NULL) {
+        d = &PyTuple_GET_ITEM(argdefs, 0);
+        nd = Py_SIZE(argdefs);
+    }
+    else {
+        d = NULL;
+        nd = 0;
+    }
+#if PY_MAJOR_VERSION >= 3
+    result = PyEval_EvalCodeEx((PyObject*)co, globals, (PyObject *)NULL,
+                               args, (int)nargs,
+                               k, (int)nk,
+                               d, (int)nd, kwdefs, closure);
+#else
+    result = PyEval_EvalCodeEx(co, globals, (PyObject *)NULL,
+                               args, (int)nargs,
+                               k, (int)nk,
+                               d, (int)nd, closure);
+#endif
+    Py_XDECREF(kwtuple);
+done:
+    Py_LeaveRecursiveCall();
+    return result;
+}
+#endif
+#endif
+
+/* PyObjectCallMethO */
+#if CYTHON_COMPILING_IN_CPYTHON
+static CYTHON_INLINE PyObject* __Pyx_PyObject_CallMethO(PyObject *func, PyObject *arg) {
+    PyObject *self, *result;
+    PyCFunction cfunc;
+    cfunc = PyCFunction_GET_FUNCTION(func);
+    self = PyCFunction_GET_SELF(func);
+    if (unlikely(Py_EnterRecursiveCall((char*)" while calling a Python object")))
+        return NULL;
+    result = cfunc(self, arg);
+    Py_LeaveRecursiveCall();
+    if (unlikely(!result) && unlikely(!PyErr_Occurred())) {
+        PyErr_SetString(
+            PyExc_SystemError,
+            "NULL result without error in PyObject_Call");
+    }
+    return result;
+}
+#endif
+
+/* PyObjectCallNoArg */
+#if CYTHON_COMPILING_IN_CPYTHON
+static CYTHON_INLINE PyObject* __Pyx_PyObject_CallNoArg(PyObject *func) {
+#if CYTHON_FAST_PYCALL
+    if (PyFunction_Check(func)) {
+        return __Pyx_PyFunction_FastCall(func, NULL, 0);
+    }
+#endif
+#ifdef __Pyx_CyFunction_USED
+    if (likely(PyCFunction_Check(func) || __Pyx_CyFunction_Check(func)))
+#else
+    if (likely(PyCFunction_Check(func)))
+#endif
+    {
+        if (likely(PyCFunction_GET_FLAGS(func) & METH_NOARGS)) {
+            return __Pyx_PyObject_CallMethO(func, NULL);
+        }
+    }
+    return __Pyx_PyObject_Call(func, __pyx_empty_tuple, NULL);
+}
+#endif
+
+/* PyCFunctionFastCall */
+#if CYTHON_FAST_PYCCALL
+static CYTHON_INLINE PyObject * __Pyx_PyCFunction_FastCall(PyObject *func_obj, PyObject **args, Py_ssize_t nargs) {
+    PyCFunctionObject *func = (PyCFunctionObject*)func_obj;
+    PyCFunction meth = PyCFunction_GET_FUNCTION(func);
+    PyObject *self = PyCFunction_GET_SELF(func);
+    int flags = PyCFunction_GET_FLAGS(func);
+    assert(PyCFunction_Check(func));
+    assert(METH_FASTCALL == (flags & ~(METH_CLASS | METH_STATIC | METH_COEXIST | METH_KEYWORDS | METH_STACKLESS)));
+    assert(nargs >= 0);
+    assert(nargs == 0 || args != NULL);
+    /* _PyCFunction_FastCallDict() must not be called with an exception set,
+       because it may clear it (directly or indirectly) and so the
+       caller loses its exception */
+    assert(!PyErr_Occurred());
+    if ((PY_VERSION_HEX < 0x030700A0) || unlikely(flags & METH_KEYWORDS)) {
+        return (*((__Pyx_PyCFunctionFastWithKeywords)(void*)meth)) (self, args, nargs, NULL);
+    } else {
+        return (*((__Pyx_PyCFunctionFast)(void*)meth)) (self, args, nargs);
+    }
+}
+#endif
+
+/* PyObjectCallOneArg */
+#if CYTHON_COMPILING_IN_CPYTHON
+static PyObject* __Pyx__PyObject_CallOneArg(PyObject *func, PyObject *arg) {
+    PyObject *result;
+    PyObject *args = PyTuple_New(1);
+    if (unlikely(!args)) return NULL;
+    Py_INCREF(arg);
+    PyTuple_SET_ITEM(args, 0, arg);
+    result = __Pyx_PyObject_Call(func, args, NULL);
+    Py_DECREF(args);
+    return result;
+}
+static CYTHON_INLINE PyObject* __Pyx_PyObject_CallOneArg(PyObject *func, PyObject *arg) {
+#if CYTHON_FAST_PYCALL
+    if (PyFunction_Check(func)) {
+        return __Pyx_PyFunction_FastCall(func, &arg, 1);
+    }
+#endif
+    if (likely(PyCFunction_Check(func))) {
+        if (likely(PyCFunction_GET_FLAGS(func) & METH_O)) {
+            return __Pyx_PyObject_CallMethO(func, arg);
+#if CYTHON_FAST_PYCCALL
+        } else if (__Pyx_PyFastCFunction_Check(func)) {
+            return __Pyx_PyCFunction_FastCall(func, &arg, 1);
+#endif
+        }
+    }
+    return __Pyx__PyObject_CallOneArg(func, arg);
+}
+#else
+static CYTHON_INLINE PyObject* __Pyx_PyObject_CallOneArg(PyObject *func, PyObject *arg) {
+    PyObject *result;
+    PyObject *args = PyTuple_Pack(1, arg);
+    if (unlikely(!args)) return NULL;
+    result = __Pyx_PyObject_Call(func, args, NULL);
+    Py_DECREF(args);
+    return result;
+}
+#endif
+
 /* RaiseDoubleKeywords */
 static void __Pyx_RaiseDoubleKeywordsError(
     const char* func_name,
     PyObject* kw_name)
 {
     PyErr_Format(PyExc_TypeError,
         #if PY_MAJOR_VERSION >= 3
@@ -29718,156 +30587,14 @@
     PyObject *dict = Py_TYPE(obj)->tp_dict;
     if (unlikely(!dict) || unlikely(tp_dict_version != __PYX_GET_DICT_VERSION(dict)))
         return 0;
     return obj_dict_version == __Pyx_get_object_dict_version(obj);
 }
 #endif
 
-/* PyCFunctionFastCall */
-#if CYTHON_FAST_PYCCALL
-static CYTHON_INLINE PyObject * __Pyx_PyCFunction_FastCall(PyObject *func_obj, PyObject **args, Py_ssize_t nargs) {
-    PyCFunctionObject *func = (PyCFunctionObject*)func_obj;
-    PyCFunction meth = PyCFunction_GET_FUNCTION(func);
-    PyObject *self = PyCFunction_GET_SELF(func);
-    int flags = PyCFunction_GET_FLAGS(func);
-    assert(PyCFunction_Check(func));
-    assert(METH_FASTCALL == (flags & ~(METH_CLASS | METH_STATIC | METH_COEXIST | METH_KEYWORDS | METH_STACKLESS)));
-    assert(nargs >= 0);
-    assert(nargs == 0 || args != NULL);
-    /* _PyCFunction_FastCallDict() must not be called with an exception set,
-       because it may clear it (directly or indirectly) and so the
-       caller loses its exception */
-    assert(!PyErr_Occurred());
-    if ((PY_VERSION_HEX < 0x030700A0) || unlikely(flags & METH_KEYWORDS)) {
-        return (*((__Pyx_PyCFunctionFastWithKeywords)(void*)meth)) (self, args, nargs, NULL);
-    } else {
-        return (*((__Pyx_PyCFunctionFast)(void*)meth)) (self, args, nargs);
-    }
-}
-#endif
-
-/* PyFunctionFastCall */
-#if CYTHON_FAST_PYCALL
-static PyObject* __Pyx_PyFunction_FastCallNoKw(PyCodeObject *co, PyObject **args, Py_ssize_t na,
-                                               PyObject *globals) {
-    PyFrameObject *f;
-    PyThreadState *tstate = __Pyx_PyThreadState_Current;
-    PyObject **fastlocals;
-    Py_ssize_t i;
-    PyObject *result;
-    assert(globals != NULL);
-    /* XXX Perhaps we should create a specialized
-       PyFrame_New() that doesn't take locals, but does
-       take builtins without sanity checking them.
-       */
-    assert(tstate != NULL);
-    f = PyFrame_New(tstate, co, globals, NULL);
-    if (f == NULL) {
-        return NULL;
-    }
-    fastlocals = __Pyx_PyFrame_GetLocalsplus(f);
-    for (i = 0; i < na; i++) {
-        Py_INCREF(*args);
-        fastlocals[i] = *args++;
-    }
-    result = PyEval_EvalFrameEx(f,0);
-    ++tstate->recursion_depth;
-    Py_DECREF(f);
-    --tstate->recursion_depth;
-    return result;
-}
-#if 1 || PY_VERSION_HEX < 0x030600B1
-static PyObject *__Pyx_PyFunction_FastCallDict(PyObject *func, PyObject **args, Py_ssize_t nargs, PyObject *kwargs) {
-    PyCodeObject *co = (PyCodeObject *)PyFunction_GET_CODE(func);
-    PyObject *globals = PyFunction_GET_GLOBALS(func);
-    PyObject *argdefs = PyFunction_GET_DEFAULTS(func);
-    PyObject *closure;
-#if PY_MAJOR_VERSION >= 3
-    PyObject *kwdefs;
-#endif
-    PyObject *kwtuple, **k;
-    PyObject **d;
-    Py_ssize_t nd;
-    Py_ssize_t nk;
-    PyObject *result;
-    assert(kwargs == NULL || PyDict_Check(kwargs));
-    nk = kwargs ? PyDict_Size(kwargs) : 0;
-    if (Py_EnterRecursiveCall((char*)" while calling a Python object")) {
-        return NULL;
-    }
-    if (
-#if PY_MAJOR_VERSION >= 3
-            co->co_kwonlyargcount == 0 &&
-#endif
-            likely(kwargs == NULL || nk == 0) &&
-            co->co_flags == (CO_OPTIMIZED | CO_NEWLOCALS | CO_NOFREE)) {
-        if (argdefs == NULL && co->co_argcount == nargs) {
-            result = __Pyx_PyFunction_FastCallNoKw(co, args, nargs, globals);
-            goto done;
-        }
-        else if (nargs == 0 && argdefs != NULL
-                 && co->co_argcount == Py_SIZE(argdefs)) {
-            /* function called with no arguments, but all parameters have
-               a default value: use default values as arguments .*/
-            args = &PyTuple_GET_ITEM(argdefs, 0);
-            result =__Pyx_PyFunction_FastCallNoKw(co, args, Py_SIZE(argdefs), globals);
-            goto done;
-        }
-    }
-    if (kwargs != NULL) {
-        Py_ssize_t pos, i;
-        kwtuple = PyTuple_New(2 * nk);
-        if (kwtuple == NULL) {
-            result = NULL;
-            goto done;
-        }
-        k = &PyTuple_GET_ITEM(kwtuple, 0);
-        pos = i = 0;
-        while (PyDict_Next(kwargs, &pos, &k[i], &k[i+1])) {
-            Py_INCREF(k[i]);
-            Py_INCREF(k[i+1]);
-            i += 2;
-        }
-        nk = i / 2;
-    }
-    else {
-        kwtuple = NULL;
-        k = NULL;
-    }
-    closure = PyFunction_GET_CLOSURE(func);
-#if PY_MAJOR_VERSION >= 3
-    kwdefs = PyFunction_GET_KW_DEFAULTS(func);
-#endif
-    if (argdefs != NULL) {
-        d = &PyTuple_GET_ITEM(argdefs, 0);
-        nd = Py_SIZE(argdefs);
-    }
-    else {
-        d = NULL;
-        nd = 0;
-    }
-#if PY_MAJOR_VERSION >= 3
-    result = PyEval_EvalCodeEx((PyObject*)co, globals, (PyObject *)NULL,
-                               args, (int)nargs,
-                               k, (int)nk,
-                               d, (int)nd, kwdefs, closure);
-#else
-    result = PyEval_EvalCodeEx(co, globals, (PyObject *)NULL,
-                               args, (int)nargs,
-                               k, (int)nk,
-                               d, (int)nd, closure);
-#endif
-    Py_XDECREF(kwtuple);
-done:
-    Py_LeaveRecursiveCall();
-    return result;
-}
-#endif
-#endif
-
 /* PyObjectCall2Args */
 static CYTHON_UNUSED PyObject* __Pyx_PyObject_Call2Args(PyObject* function, PyObject* arg1, PyObject* arg2) {
     PyObject *args, *result = NULL;
     #if CYTHON_FAST_PYCALL
     if (PyFunction_Check(function)) {
         PyObject *args[2] = {arg1, arg2};
         return __Pyx_PyFunction_FastCall(function, args, 2);
@@ -29889,74 +30616,14 @@
     result = __Pyx_PyObject_Call(function, args, NULL);
     Py_DECREF(args);
     Py_DECREF(function);
 done:
     return result;
 }
 
-/* PyObjectCallMethO */
-#if CYTHON_COMPILING_IN_CPYTHON
-static CYTHON_INLINE PyObject* __Pyx_PyObject_CallMethO(PyObject *func, PyObject *arg) {
-    PyObject *self, *result;
-    PyCFunction cfunc;
-    cfunc = PyCFunction_GET_FUNCTION(func);
-    self = PyCFunction_GET_SELF(func);
-    if (unlikely(Py_EnterRecursiveCall((char*)" while calling a Python object")))
-        return NULL;
-    result = cfunc(self, arg);
-    Py_LeaveRecursiveCall();
-    if (unlikely(!result) && unlikely(!PyErr_Occurred())) {
-        PyErr_SetString(
-            PyExc_SystemError,
-            "NULL result without error in PyObject_Call");
-    }
-    return result;
-}
-#endif
-
-/* PyObjectCallOneArg */
-#if CYTHON_COMPILING_IN_CPYTHON
-static PyObject* __Pyx__PyObject_CallOneArg(PyObject *func, PyObject *arg) {
-    PyObject *result;
-    PyObject *args = PyTuple_New(1);
-    if (unlikely(!args)) return NULL;
-    Py_INCREF(arg);
-    PyTuple_SET_ITEM(args, 0, arg);
-    result = __Pyx_PyObject_Call(func, args, NULL);
-    Py_DECREF(args);
-    return result;
-}
-static CYTHON_INLINE PyObject* __Pyx_PyObject_CallOneArg(PyObject *func, PyObject *arg) {
-#if CYTHON_FAST_PYCALL
-    if (PyFunction_Check(func)) {
-        return __Pyx_PyFunction_FastCall(func, &arg, 1);
-    }
-#endif
-    if (likely(PyCFunction_Check(func))) {
-        if (likely(PyCFunction_GET_FLAGS(func) & METH_O)) {
-            return __Pyx_PyObject_CallMethO(func, arg);
-#if CYTHON_FAST_PYCCALL
-        } else if (__Pyx_PyFastCFunction_Check(func)) {
-            return __Pyx_PyCFunction_FastCall(func, &arg, 1);
-#endif
-        }
-    }
-    return __Pyx__PyObject_CallOneArg(func, arg);
-}
-#else
-static CYTHON_INLINE PyObject* __Pyx_PyObject_CallOneArg(PyObject *func, PyObject *arg) {
-    PyObject *result;
-    PyObject *args = PyTuple_Pack(1, arg);
-    if (unlikely(!args)) return NULL;
-    result = __Pyx_PyObject_Call(func, args, NULL);
-    Py_DECREF(args);
-    return result;
-}
-#endif
-
 /* GetItemInt */
 static PyObject *__Pyx_GetItemInt_Generic(PyObject *o, PyObject* j) {
     PyObject *r;
     if (!j) return NULL;
     r = PyObject_GetItem(o, j);
     Py_DECREF(j);
     return r;
@@ -30192,36 +30859,14 @@
 /* StringJoin */
 #if !CYTHON_COMPILING_IN_CPYTHON
 static CYTHON_INLINE PyObject* __Pyx_PyBytes_Join(PyObject* sep, PyObject* values) {
     return PyObject_CallMethodObjArgs(sep, __pyx_n_s_join, values, NULL);
 }
 #endif
 
-/* PyObjectCallNoArg */
-#if CYTHON_COMPILING_IN_CPYTHON
-static CYTHON_INLINE PyObject* __Pyx_PyObject_CallNoArg(PyObject *func) {
-#if CYTHON_FAST_PYCALL
-    if (PyFunction_Check(func)) {
-        return __Pyx_PyFunction_FastCall(func, NULL, 0);
-    }
-#endif
-#ifdef __Pyx_CyFunction_USED
-    if (likely(PyCFunction_Check(func) || __Pyx_CyFunction_Check(func)))
-#else
-    if (likely(PyCFunction_Check(func)))
-#endif
-    {
-        if (likely(PyCFunction_GET_FLAGS(func) & METH_NOARGS)) {
-            return __Pyx_PyObject_CallMethO(func, NULL);
-        }
-    }
-    return __Pyx_PyObject_Call(func, __pyx_empty_tuple, NULL);
-}
-#endif
-
 /* ObjectGetItem */
 #if CYTHON_USE_TYPE_SLOTS
 static PyObject *__Pyx_PyObject_GetIndex(PyObject *obj, PyObject* index) {
     PyObject *runerr;
     Py_ssize_t key_value;
     PySequenceMethods *m = Py_TYPE(obj)->tp_as_sequence;
     if (unlikely(!(m && m->sq_item))) {
@@ -30243,41 +30888,14 @@
     if (likely(m && m->mp_subscript)) {
         return m->mp_subscript(obj, key);
     }
     return __Pyx_PyObject_GetIndex(obj, key);
 }
 #endif
 
-/* decode_c_bytes */
-static CYTHON_INLINE PyObject* __Pyx_decode_c_bytes(
-         const char* cstring, Py_ssize_t length, Py_ssize_t start, Py_ssize_t stop,
-         const char* encoding, const char* errors,
-         PyObject* (*decode_func)(const char *s, Py_ssize_t size, const char *errors)) {
-    if (unlikely((start < 0) | (stop < 0))) {
-        if (start < 0) {
-            start += length;
-            if (start < 0)
-                start = 0;
-        }
-        if (stop < 0)
-            stop += length;
-    }
-    if (stop > length)
-        stop = length;
-    if (unlikely(stop <= start))
-        return __Pyx_NewRef(__pyx_empty_unicode);
-    length = stop - start;
-    cstring += start;
-    if (decode_func) {
-        return decode_func(cstring, length, errors);
-    } else {
-        return PyUnicode_Decode(cstring, length, encoding, errors);
-    }
-}
-
 /* GetTopmostException */
 #if CYTHON_USE_EXC_INFO_STACK
 static _PyErr_StackItem *
 __Pyx_PyErr_GetTopmostException(PyThreadState *tstate)
 {
     _PyErr_StackItem *exc_info = tstate->exc_info;
     while ((exc_info->exc_type == NULL || exc_info->exc_type == Py_None) &&
@@ -31803,14 +32421,17 @@
 #endif
 #if PY_VERSION_HEX >= 0x030800b1
     0,
 #endif
 #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
     0,
 #endif
+#if PY_VERSION_HEX >= 0x030B00A2
+    0,
+#endif
 };
 static int __pyx_CyFunction_init(void) {
     __pyx_CyFunctionType = __Pyx_FetchCommonType(&__pyx_CyFunctionType_type);
     if (unlikely(__pyx_CyFunctionType == NULL)) {
         return -1;
     }
     return 0;
@@ -32033,15 +32654,15 @@
       } else {
         PyErr_Clear();
         use_cline = NULL;
       }
     }
     if (!use_cline) {
         c_line = 0;
-        PyObject_SetAttr(__pyx_cython_runtime, __pyx_n_s_cline_in_traceback, Py_False);
+        (void) PyObject_SetAttr(__pyx_cython_runtime, __pyx_n_s_cline_in_traceback, Py_False);
     }
     else if (use_cline == Py_False || (use_cline != Py_True && PyObject_Not(use_cline) != 0)) {
         c_line = 0;
     }
     __Pyx_ErrRestoreInState(tstate, ptype, pvalue, ptraceback);
     return c_line;
 }
@@ -32130,38 +32751,39 @@
 /* AddTraceback */
 #include "compile.h"
 #include "frameobject.h"
 #include "traceback.h"
 static PyCodeObject* __Pyx_CreateCodeObjectForTraceback(
             const char *funcname, int c_line,
             int py_line, const char *filename) {
-    PyCodeObject *py_code = 0;
-    PyObject *py_srcfile = 0;
-    PyObject *py_funcname = 0;
+    PyCodeObject *py_code = NULL;
+    PyObject *py_funcname = NULL;
     #if PY_MAJOR_VERSION < 3
+    PyObject *py_srcfile = NULL;
     py_srcfile = PyString_FromString(filename);
-    #else
-    py_srcfile = PyUnicode_FromString(filename);
-    #endif
     if (!py_srcfile) goto bad;
+    #endif
     if (c_line) {
         #if PY_MAJOR_VERSION < 3
         py_funcname = PyString_FromFormat( "%s (%s:%d)", funcname, __pyx_cfilenm, c_line);
+        if (!py_funcname) goto bad;
         #else
         py_funcname = PyUnicode_FromFormat( "%s (%s:%d)", funcname, __pyx_cfilenm, c_line);
+        if (!py_funcname) goto bad;
+        funcname = PyUnicode_AsUTF8(py_funcname);
+        if (!funcname) goto bad;
         #endif
     }
     else {
         #if PY_MAJOR_VERSION < 3
         py_funcname = PyString_FromString(funcname);
-        #else
-        py_funcname = PyUnicode_FromString(funcname);
+        if (!py_funcname) goto bad;
         #endif
     }
-    if (!py_funcname) goto bad;
+    #if PY_MAJOR_VERSION < 3
     py_code = __Pyx_PyCode_New(
         0,
         0,
         0,
         0,
         0,
         __pyx_empty_bytes, /*PyObject *code,*/
@@ -32172,19 +32794,24 @@
         __pyx_empty_tuple, /*PyObject *cellvars,*/
         py_srcfile,   /*PyObject *filename,*/
         py_funcname,  /*PyObject *name,*/
         py_line,
         __pyx_empty_bytes  /*PyObject *lnotab*/
     );
     Py_DECREF(py_srcfile);
-    Py_DECREF(py_funcname);
+    #else
+    py_code = PyCode_NewEmpty(filename, funcname, py_line);
+    #endif
+    Py_XDECREF(py_funcname);  // XDECREF since it's only set on Py3 if cline
     return py_code;
 bad:
-    Py_XDECREF(py_srcfile);
     Py_XDECREF(py_funcname);
+    #if PY_MAJOR_VERSION < 3
+    Py_XDECREF(py_srcfile);
+    #endif
     return NULL;
 }
 static void __Pyx_AddTraceback(const char *funcname, int c_line,
                                int py_line, const char *filename) {
     PyCodeObject *py_code = 0;
     PyFrameObject *py_frame = 0;
     PyThreadState *tstate = __Pyx_PyThreadState_Current;
@@ -32426,52 +33053,14 @@
     return (size_t) -1;
 raise_neg_overflow:
     PyErr_SetString(PyExc_OverflowError,
         "can't convert negative value to size_t");
     return (size_t) -1;
 }
 
-/* CIntToPy */
-static CYTHON_INLINE PyObject* __Pyx_PyInt_From_long(long value) {
-#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
-#pragma GCC diagnostic push
-#pragma GCC diagnostic ignored "-Wconversion"
-#endif
-    const long neg_one = (long) -1, const_zero = (long) 0;
-#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
-#pragma GCC diagnostic pop
-#endif
-    const int is_unsigned = neg_one > const_zero;
-    if (is_unsigned) {
-        if (sizeof(long) < sizeof(long)) {
-            return PyInt_FromLong((long) value);
-        } else if (sizeof(long) <= sizeof(unsigned long)) {
-            return PyLong_FromUnsignedLong((unsigned long) value);
-#ifdef HAVE_LONG_LONG
-        } else if (sizeof(long) <= sizeof(unsigned PY_LONG_LONG)) {
-            return PyLong_FromUnsignedLongLong((unsigned PY_LONG_LONG) value);
-#endif
-        }
-    } else {
-        if (sizeof(long) <= sizeof(long)) {
-            return PyInt_FromLong((long) value);
-#ifdef HAVE_LONG_LONG
-        } else if (sizeof(long) <= sizeof(PY_LONG_LONG)) {
-            return PyLong_FromLongLong((PY_LONG_LONG) value);
-#endif
-        }
-    }
-    {
-        int one = 1; int little = (int)*(unsigned char *)&one;
-        unsigned char *bytes = (unsigned char *)&value;
-        return _PyLong_FromByteArray(bytes, sizeof(long),
-                                     little, !is_unsigned);
-    }
-}
-
 /* CIntFromPy */
 static CYTHON_INLINE char __Pyx_PyInt_As_char(PyObject *x) {
 #ifdef __Pyx_HAS_GCC_DIAGNOSTIC
 #pragma GCC diagnostic push
 #pragma GCC diagnostic ignored "-Wconversion"
 #endif
     const char neg_one = (char) -1, const_zero = (char) 0;
@@ -32661,14 +33250,52 @@
 raise_neg_overflow:
     PyErr_SetString(PyExc_OverflowError,
         "can't convert negative value to char");
     return (char) -1;
 }
 
 /* CIntToPy */
+static CYTHON_INLINE PyObject* __Pyx_PyInt_From_long(long value) {
+#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
+#pragma GCC diagnostic push
+#pragma GCC diagnostic ignored "-Wconversion"
+#endif
+    const long neg_one = (long) -1, const_zero = (long) 0;
+#ifdef __Pyx_HAS_GCC_DIAGNOSTIC
+#pragma GCC diagnostic pop
+#endif
+    const int is_unsigned = neg_one > const_zero;
+    if (is_unsigned) {
+        if (sizeof(long) < sizeof(long)) {
+            return PyInt_FromLong((long) value);
+        } else if (sizeof(long) <= sizeof(unsigned long)) {
+            return PyLong_FromUnsignedLong((unsigned long) value);
+#ifdef HAVE_LONG_LONG
+        } else if (sizeof(long) <= sizeof(unsigned PY_LONG_LONG)) {
+            return PyLong_FromUnsignedLongLong((unsigned PY_LONG_LONG) value);
+#endif
+        }
+    } else {
+        if (sizeof(long) <= sizeof(long)) {
+            return PyInt_FromLong((long) value);
+#ifdef HAVE_LONG_LONG
+        } else if (sizeof(long) <= sizeof(PY_LONG_LONG)) {
+            return PyLong_FromLongLong((PY_LONG_LONG) value);
+#endif
+        }
+    }
+    {
+        int one = 1; int little = (int)*(unsigned char *)&one;
+        unsigned char *bytes = (unsigned char *)&value;
+        return _PyLong_FromByteArray(bytes, sizeof(long),
+                                     little, !is_unsigned);
+    }
+}
+
+/* CIntToPy */
 static CYTHON_INLINE PyObject* __Pyx_PyInt_From_enum____pyx_t_11resiliparse_5parse_4html_NodeType(enum __pyx_t_11resiliparse_5parse_4html_NodeType value) {
 #ifdef __Pyx_HAS_GCC_DIAGNOSTIC
 #pragma GCC diagnostic push
 #pragma GCC diagnostic ignored "-Wconversion"
 #endif
     const enum __pyx_t_11resiliparse_5parse_4html_NodeType neg_one = (enum __pyx_t_11resiliparse_5parse_4html_NodeType) -1, const_zero = (enum __pyx_t_11resiliparse_5parse_4html_NodeType) 0;
 #ifdef __Pyx_HAS_GCC_DIAGNOSTIC
@@ -33513,17 +34140,21 @@
     exc_state = &self->gi_exc_state;
     if (exc_state->exc_type) {
         #if CYTHON_COMPILING_IN_PYPY || CYTHON_COMPILING_IN_PYSTON
         #else
         if (exc_state->exc_traceback) {
             PyTracebackObject *tb = (PyTracebackObject *) exc_state->exc_traceback;
             PyFrameObject *f = tb->tb_frame;
-            Py_XINCREF(tstate->frame);
             assert(f->f_back == NULL);
+            #if PY_VERSION_HEX >= 0x030B00A1
+            f->f_back = PyThreadState_GetFrame(tstate);
+            #else
+            Py_XINCREF(tstate->frame);
             f->f_back = tstate->frame;
+            #endif
         }
         #endif
     }
 #if CYTHON_USE_EXC_INFO_STACK
     exc_state->previous_item = tstate->exc_info;
     tstate->exc_info = exc_state;
 #else
@@ -34309,14 +34940,17 @@
 #endif
 #if PY_VERSION_HEX >= 0x030800b1
     0,
 #endif
 #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
     0,
 #endif
+#if PY_VERSION_HEX >= 0x030B00A2
+    0,
+#endif
 };
 static int __pyx_Generator_init(void) {
     __pyx_GeneratorType_type.tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
     __pyx_GeneratorType_type.tp_iter = PyObject_SelfIter;
     __pyx_GeneratorType = __Pyx_FetchCommonType(&__pyx_GeneratorType_type);
     if (unlikely(!__pyx_GeneratorType)) {
         return -1;
@@ -34675,14 +35309,31 @@
   }
   x = PyNumber_Index(b);
   if (!x) return -1;
   ival = PyInt_AsSsize_t(x);
   Py_DECREF(x);
   return ival;
 }
+static CYTHON_INLINE Py_hash_t __Pyx_PyIndex_AsHash_t(PyObject* o) {
+  if (sizeof(Py_hash_t) == sizeof(Py_ssize_t)) {
+    return (Py_hash_t) __Pyx_PyIndex_AsSsize_t(o);
+#if PY_MAJOR_VERSION < 3
+  } else if (likely(PyInt_CheckExact(o))) {
+    return PyInt_AS_LONG(o);
+#endif
+  } else {
+    Py_ssize_t ival;
+    PyObject *x;
+    x = PyNumber_Index(o);
+    if (!x) return -1;
+    ival = PyInt_AsLong(x);
+    Py_DECREF(x);
+    return ival;
+  }
+}
 static CYTHON_INLINE PyObject * __Pyx_PyBool_FromLong(long b) {
   return b ? __Pyx_NewRef(Py_True) : __Pyx_NewRef(Py_False);
 }
 static CYTHON_INLINE PyObject * __Pyx_PyInt_FromSize_t(size_t ival) {
     return PyInt_FromSize_t(ival);
 }
```

### Comparing `Resiliparse-0.8.1/resiliparse/parse/html.h` & `Resiliparse-0.9.0/resiliparse/parse/html.h`

 * *Files identical despite different names*

### Comparing `Resiliparse-0.8.1/resiliparse/parse/html.pxd` & `Resiliparse-0.9.0/resiliparse/parse/html.pxd`

 * *Files 8% similar despite different names*

```diff
@@ -18,14 +18,21 @@
 from resiliparse_inc.lexbor cimport *
 
 
 cdef inline bint check_node(DOMNode node):
     """Check whether node is initialized and valid."""
     return node is not None and node.tree is not None and node.node != NULL
 
+cdef bint init_css_parser(lxb_css_parser_t** parser) except 0
+cdef void destroy_css_parser(lxb_css_parser_t* parser) nogil
+cdef bint init_css_selectors(lxb_css_parser_t* parser, lxb_css_selectors_t** css_selectors,
+                             lxb_selectors_t** selectors) except 0
+cdef void destroy_css_selectors(lxb_css_selectors_t* css_selectors, lxb_selectors_t* selectors) nogil
+cdef lxb_css_selector_list_t* parse_css_selectors(lxb_css_parser_t* css_parser, const lxb_char_t* selector,
+                                                  size_t selector_len) except NULL
 
 cdef lxb_dom_node_t* next_node(const lxb_dom_node_t* root_node, lxb_dom_node_t* node,
                                size_t* depth=*, bint* end_tag=*) nogil
 
 cdef inline lxb_dom_node_t* next_element_node(const lxb_dom_node_t* root_node, lxb_dom_node_t* node,
                                               size_t* depth=NULL, bint* end_tag=NULL) nogil:
     node = next_node(root_node, node, depth, end_tag)
@@ -50,17 +57,18 @@
 cdef string get_node_text(lxb_dom_node_t* node) nogil
 
 cdef lxb_dom_node_t* get_element_by_id_impl(lxb_dom_node_t* node, bytes id_value, bint case_insensitive=*)
 cdef lxb_dom_collection_t* get_elements_by_attr_impl(lxb_dom_node_t* node, bytes attr_name, bytes attr_value,
                                                      size_t init_size=*, bint case_insensitive=*)
 cdef lxb_dom_collection_t* get_elements_by_class_name_impl(lxb_dom_node_t* node, bytes class_name, size_t init_size=*)
 cdef lxb_dom_collection_t* get_elements_by_tag_name_impl(lxb_dom_node_t* node, bytes tag_name)
-cdef lxb_dom_node_t* query_selector_impl(lxb_dom_node_t* node, HTMLTree tree, bytes selector)
+cdef lxb_dom_node_t* query_selector_impl(lxb_dom_node_t* node, HTMLTree tree,
+                                         bytes selector) except <lxb_dom_node_t*>-1
 cdef lxb_dom_collection_t* query_selector_all_impl(lxb_dom_node_t* node, HTMLTree tree, bytes selector,
-                                                   size_t init_size=*)
+                                                   size_t init_size=*) except <lxb_dom_collection_t*>-1
 cdef bint matches_impl(lxb_dom_node_t* node, HTMLTree tree, bytes selector)
 
 cdef extern from "html.h" nogil:
     cdef lxb_tag_id_t BLOCK_ELEMENTS[]
     cdef size_t NUM_BLOCK_ELEMENTS
```

### Comparing `Resiliparse-0.8.1/resiliparse/parse/html.pyx` & `Resiliparse-0.9.0/resiliparse/parse/html.pyx`

 * *Files 2% similar despite different names*

```diff
@@ -37,14 +37,62 @@
 
 cdef inline DOMCollection _create_dom_collection(HTMLTree tree, lxb_dom_collection_t* coll):
     cdef DOMCollection return_coll = DOMCollection.__new__(DOMCollection, tree)
     return_coll.coll = coll
     return return_coll
 
 
+cdef bint init_css_parser(lxb_css_parser_t** parser) except 0:
+    parser[0] = lxb_css_parser_create()
+    if lxb_css_parser_init(parser[0], NULL, NULL) != LXB_STATUS_OK:
+        raise RuntimeError('Failed to initialize CSS parser.')
+    return True
+
+
+cdef void destroy_css_parser(lxb_css_parser_t* parser) nogil:
+    if parser:
+        lxb_css_parser_destroy(parser, True)
+
+
+cdef bint init_css_selectors(lxb_css_parser_t* parser, lxb_css_selectors_t** css_selectors,
+                             lxb_selectors_t** selectors) except 0:
+    css_selectors[0] = lxb_css_selectors_create()
+    if lxb_css_selectors_init(css_selectors[0], 32) != LXB_STATUS_OK:
+        raise RuntimeError('Failed to initialize CSS selectors.')
+
+    lxb_css_parser_selectors_set(parser, css_selectors[0])
+
+    selectors[0] = lxb_selectors_create()
+    if lxb_selectors_init(selectors[0]) != LXB_STATUS_OK:
+        raise RuntimeError('Failed to initialize elemetn selectors.')
+
+    return True
+
+
+cdef void destroy_css_selectors(lxb_css_selectors_t* css_selectors, lxb_selectors_t* selectors) nogil:
+    if selectors:
+        lxb_selectors_destroy(selectors, True)
+    if css_selectors:
+        lxb_css_selectors_destroy(css_selectors, True, True)
+
+
+cdef inline void _log_serialize_cb(const lxb_char_t *data, size_t len, void *ctx) nogil:
+    (<string*>ctx).append(<const char*>data, len)
+
+
+cdef lxb_css_selector_list_t* parse_css_selectors(lxb_css_parser_t* css_parser, const lxb_char_t* selector,
+                                                  size_t selector_len) except NULL:
+    cdef lxb_css_selector_list_t* sel_list = lxb_css_selectors_parse(css_parser, selector, selector_len)
+    cdef string err
+    if css_parser.status != LXB_STATUS_OK:
+        lxb_css_log_serialize(css_parser.log, <lexbor_serialize_cb_f>_log_serialize_cb, &err, <lxb_char_t*>b'', 0)
+        raise ValueError(f'CSS parser error: {err.decode().strip()}')
+    return sel_list
+
+
 cdef inline lxb_dom_node_t* next_node(const lxb_dom_node_t* root_node, lxb_dom_node_t* node,
                                       size_t* depth=NULL, bint* end_tag=NULL) nogil:
     """
     DOM tree pre-order traversal primitive.
     
     This is a more flexible, step-wise implementation of ``lxb_dom_node_simple_walk()``, which
     allows a client to react on closing tags.
@@ -212,52 +260,51 @@
 
 cdef inline lxb_status_t css_select_callback_single(lxb_dom_node_t* node, lxb_css_selector_specificity_t* spec,
                                                     void* ctx) nogil:
     (<lxb_dom_node_t**>ctx)[0] = node
     return LXB_STATUS_STOP
 
 
-cdef lxb_dom_node_t* query_selector_impl(lxb_dom_node_t* node, HTMLTree tree, bytes selector):
+cdef lxb_dom_node_t* query_selector_impl(lxb_dom_node_t* node, HTMLTree tree,
+                                         bytes selector) except <lxb_dom_node_t*>-1:
     """
     Return a pointer to the first element matching the given CSS selector.
 
     :param node: anchor node
     :param tree: owning HTML tree
     :param selector: CSS selector as UTF-8 bytes
     :return: pointer to created DOM collection or ``NULL`` if error occurred
     """
     tree.init_css_parser()
 
-    cdef lxb_css_selector_list_t* sel_list = lxb_css_selectors_parse(tree.css_parser,
-                                                                     <lxb_char_t*>selector, len(selector))
+    cdef lxb_css_selector_list_t* sel_list = parse_css_selectors(tree.css_parser, <lxb_char_t*>selector, len(selector))
     cdef lxb_dom_node_t* result_node = NULL
     if lxb_selectors_find(tree.selectors, node, sel_list,
                           <lxb_selectors_cb_f>css_select_callback_single, &result_node) != LXB_STATUS_OK:
         return NULL
 
     return result_node
 
 
 cdef lxb_dom_collection_t* query_selector_all_impl(lxb_dom_node_t* node, HTMLTree tree, bytes selector,
-                                                   size_t init_size=32):
+                                                   size_t init_size=32) except <lxb_dom_collection_t*>-1:
     """
     Return a collection of elements matching the given CSS selector.
 
     The caller must take ownership of the returned collection.
 
     :param node: anchor node
     :param tree: owning HTML tree
     :param selector: CSS selector as UTF-8 bytes
     :param init_size: initial collection size
     :return: pointer to created DOM collection or ``NULL`` if error occurred
     """
     tree.init_css_parser()
 
-    cdef lxb_css_selector_list_t* sel_list = lxb_css_selectors_parse(tree.css_parser,
-                                                                     <lxb_char_t*>selector, len(selector))
+    cdef lxb_css_selector_list_t* sel_list = parse_css_selectors(tree.css_parser, <lxb_char_t*>selector, len(selector))
     cdef lxb_dom_collection_t* coll = lxb_dom_collection_make(node.owner_document, init_size)
     if lxb_selectors_find(tree.selectors, node, sel_list,
                           <lxb_selectors_cb_f>css_select_callback, coll) != LXB_STATUS_OK:
         return NULL
 
     return coll
 
@@ -275,16 +322,15 @@
     :param node: anchor node
     :param tree: owning HTML tree
     :param selector: CSS selector as bytes
     :return: boolean value indicating whether a matching element exists
     """
     tree.init_css_parser()
 
-    cdef lxb_css_selector_list_t* sel_list = lxb_css_selectors_parse(tree.css_parser,
-                                                                     <lxb_char_t*>selector, len(selector))
+    cdef lxb_css_selector_list_t* sel_list = parse_css_selectors(tree.css_parser, <lxb_char_t*>selector, len(selector))
     cdef bint matches = False
     if lxb_selectors_find(tree.selectors, node, sel_list,
                           <lxb_selectors_cb_f>css_match_callback, <void*>&matches) != LXB_STATUS_OK:
         return False
 
     return matches
 
@@ -1568,38 +1614,29 @@
         self.selectors = NULL
 
     def __dealloc__(self):
         if self.dom_document:
             lxb_html_document_destroy(self.dom_document)
             self.dom_document = NULL
 
-        if self.selectors:
-            lxb_selectors_destroy(self.selectors, True)
-        if self.css_parser:
-            lxb_css_parser_destroy(self.css_parser, True)
+        if self.css_parser or self.css_parser or self.css_selectors:
+            destroy_css_selectors(self.css_selectors, self.selectors)
+            destroy_css_parser(self.css_parser)
+            self.css_parser = NULL
             self.css_parser = NULL
-        if self.css_selectors:
-            lxb_css_selectors_destroy(self.css_selectors, True, True)
             self.css_selectors = NULL
 
     # noinspection PyAttributeOutsideInit
-    cdef void init_css_parser(self):
+    cdef inline void init_css_parser(self):
         """
         Initialize CSS selector if not already initialized.
         """
         if not self.css_parser:
-            self.css_parser = lxb_css_parser_create()
-            lxb_css_parser_init(self.css_parser, NULL, NULL)
-
-            self.css_selectors = lxb_css_selectors_create()
-            lxb_css_selectors_init(self.css_selectors, 32)
-            lxb_css_parser_selectors_set(self.css_parser, self.css_selectors)
-
-            self.selectors = lxb_selectors_create()
-            lxb_selectors_init(self.selectors)
+            init_css_parser(&self.css_parser)
+            init_css_selectors(self.css_parser, &self.css_selectors, &self.selectors)
 
 
     @classmethod
     def parse(cls, str document):
         """
         parse(self, document)
```

### Comparing `Resiliparse-0.8.1/resiliparse/parse/http.cpp` & `Resiliparse-0.9.0/resiliparse/parse/http.cpp`

 * *Files 1% similar despite different names*

```diff
@@ -1,8 +1,8 @@
-/* Generated by Cython 0.29.24 */
+/* Generated by Cython 0.29.25 */
 
 /* BEGIN: Cython Metadata
 {
     "distutils": {
         "depends": [],
         "extra_compile_args": [
             "-std=c++17",
@@ -31,16 +31,16 @@
 #endif /* PY_SSIZE_T_CLEAN */
 #include "Python.h"
 #ifndef Py_PYTHON_H
     #error Python headers needed to compile C extensions, please install development version of Python.
 #elif PY_VERSION_HEX < 0x02060000 || (0x03000000 <= PY_VERSION_HEX && PY_VERSION_HEX < 0x03030000)
     #error Cython requires Python 2.6+ or Python 3.3+.
 #else
-#define CYTHON_ABI "0_29_24"
-#define CYTHON_HEX_VERSION 0x001D18F0
+#define CYTHON_ABI "0_29_25"
+#define CYTHON_HEX_VERSION 0x001D19F0
 #define CYTHON_FUTURE_DIVISION 1
 #include <stddef.h>
 #ifndef offsetof
   #define offsetof(type, member) ( (size_t) & ((type*)0) -> member )
 #endif
 #if !defined(WIN32) && !defined(MS_WINDOWS)
   #ifndef __stdcall
@@ -179,15 +179,15 @@
   #endif
   #ifndef CYTHON_USE_PYLIST_INTERNALS
     #define CYTHON_USE_PYLIST_INTERNALS 1
   #endif
   #ifndef CYTHON_USE_UNICODE_INTERNALS
     #define CYTHON_USE_UNICODE_INTERNALS 1
   #endif
-  #if PY_VERSION_HEX < 0x030300F0
+  #if PY_VERSION_HEX < 0x030300F0 || PY_VERSION_HEX >= 0x030B00A2
     #undef CYTHON_USE_UNICODE_WRITER
     #define CYTHON_USE_UNICODE_WRITER 0
   #elif !defined(CYTHON_USE_UNICODE_WRITER)
     #define CYTHON_USE_UNICODE_WRITER 1
   #endif
   #ifndef CYTHON_AVOID_BORROWED_REFS
     #define CYTHON_AVOID_BORROWED_REFS 0
@@ -198,15 +198,15 @@
   #ifndef CYTHON_UNPACK_METHODS
     #define CYTHON_UNPACK_METHODS 1
   #endif
   #ifndef CYTHON_FAST_THREAD_STATE
     #define CYTHON_FAST_THREAD_STATE 1
   #endif
   #ifndef CYTHON_FAST_PYCALL
-    #define CYTHON_FAST_PYCALL 1
+    #define CYTHON_FAST_PYCALL (PY_VERSION_HEX < 0x030B00A1)
   #endif
   #ifndef CYTHON_PEP489_MULTI_PHASE_INIT
     #define CYTHON_PEP489_MULTI_PHASE_INIT (PY_VERSION_HEX >= 0x03050000)
   #endif
   #ifndef CYTHON_USE_TP_FINALIZE
     #define CYTHON_USE_TP_FINALIZE (PY_VERSION_HEX >= 0x030400a1)
   #endif
@@ -217,15 +217,17 @@
     #define CYTHON_USE_EXC_INFO_STACK (PY_VERSION_HEX >= 0x030700A3)
   #endif
 #endif
 #if !defined(CYTHON_FAST_PYCCALL)
 #define CYTHON_FAST_PYCCALL  (CYTHON_FAST_PYCALL && PY_VERSION_HEX >= 0x030600B1)
 #endif
 #if CYTHON_USE_PYLONG_INTERNALS
-  #include "longintrepr.h"
+  #if PY_MAJOR_VERSION < 3
+    #include "longintrepr.h"
+  #endif
   #undef SHIFT
   #undef BASE
   #undef MASK
   #ifdef SIZEOF_VOID_P
     enum { __pyx_check_sizeof_voidp = 1 / (int)(SIZEOF_VOID_P == sizeof(void*)) };
   #endif
 #endif
@@ -348,17 +350,76 @@
 #if PY_MAJOR_VERSION < 3
   #define __Pyx_BUILTIN_MODULE_NAME "__builtin__"
   #define __Pyx_PyCode_New(a, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)\
           PyCode_New(a+k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)
   #define __Pyx_DefaultClassType PyClass_Type
 #else
   #define __Pyx_BUILTIN_MODULE_NAME "builtins"
-#if PY_VERSION_HEX >= 0x030800A4 && PY_VERSION_HEX < 0x030800B2
-  #define __Pyx_PyCode_New(a, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)\
-          PyCode_New(a, 0, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)
+  #define __Pyx_DefaultClassType PyType_Type
+#if PY_VERSION_HEX >= 0x030B00A1
+    static CYTHON_INLINE PyCodeObject* __Pyx_PyCode_New(int a, int k, int l, int s, int f,
+                                                    PyObject *code, PyObject *c, PyObject* n, PyObject *v,
+                                                    PyObject *fv, PyObject *cell, PyObject* fn,
+                                                    PyObject *name, int fline, PyObject *lnos) {
+        PyObject *kwds=NULL, *argcount=NULL, *posonlyargcount=NULL, *kwonlyargcount=NULL;
+        PyObject *nlocals=NULL, *stacksize=NULL, *flags=NULL, *replace=NULL, *call_result=NULL, *empty=NULL;
+        const char *fn_cstr=NULL;
+        const char *name_cstr=NULL;
+        PyCodeObject* co=NULL;
+        PyObject *type, *value, *traceback;
+        PyErr_Fetch(&type, &value, &traceback);
+        if (!(kwds=PyDict_New())) goto end;
+        if (!(argcount=PyLong_FromLong(a))) goto end;
+        if (PyDict_SetItemString(kwds, "co_argcount", argcount) != 0) goto end;
+        if (!(posonlyargcount=PyLong_FromLong(0))) goto end;
+        if (PyDict_SetItemString(kwds, "co_posonlyargcount", posonlyargcount) != 0) goto end;
+        if (!(kwonlyargcount=PyLong_FromLong(k))) goto end;
+        if (PyDict_SetItemString(kwds, "co_kwonlyargcount", kwonlyargcount) != 0) goto end;
+        if (!(nlocals=PyLong_FromLong(l))) goto end;
+        if (PyDict_SetItemString(kwds, "co_nlocals", nlocals) != 0) goto end;
+        if (!(stacksize=PyLong_FromLong(s))) goto end;
+        if (PyDict_SetItemString(kwds, "co_stacksize", stacksize) != 0) goto end;
+        if (!(flags=PyLong_FromLong(f))) goto end;
+        if (PyDict_SetItemString(kwds, "co_flags", flags) != 0) goto end;
+        if (PyDict_SetItemString(kwds, "co_code", code) != 0) goto end;
+        if (PyDict_SetItemString(kwds, "co_consts", c) != 0) goto end;
+        if (PyDict_SetItemString(kwds, "co_names", n) != 0) goto end;
+        if (PyDict_SetItemString(kwds, "co_varnames", v) != 0) goto end;
+        if (PyDict_SetItemString(kwds, "co_freevars", fv) != 0) goto end;
+        if (PyDict_SetItemString(kwds, "co_cellvars", cell) != 0) goto end;
+        if (PyDict_SetItemString(kwds, "co_linetable", lnos) != 0) goto end;
+        if (!(fn_cstr=PyUnicode_AsUTF8AndSize(fn, NULL))) goto end;
+        if (!(name_cstr=PyUnicode_AsUTF8AndSize(name, NULL))) goto end;
+        if (!(co = PyCode_NewEmpty(fn_cstr, name_cstr, fline))) goto end;
+        if (!(replace = PyObject_GetAttrString((PyObject*)co, "replace"))) goto cleanup_code_too;
+        if (!(empty = PyTuple_New(0))) goto cleanup_code_too; // unfortunately __pyx_empty_tuple isn't available here
+        if (!(call_result = PyObject_Call(replace, empty, kwds))) goto cleanup_code_too;
+        Py_XDECREF((PyObject*)co);
+        co = (PyCodeObject*)call_result;
+        call_result = NULL;
+        if (0) {
+            cleanup_code_too:
+            Py_XDECREF((PyObject*)co);
+            co = NULL;
+        }
+        end:
+        Py_XDECREF(kwds);
+        Py_XDECREF(argcount);
+        Py_XDECREF(posonlyargcount);
+        Py_XDECREF(kwonlyargcount);
+        Py_XDECREF(nlocals);
+        Py_XDECREF(stacksize);
+        Py_XDECREF(replace);
+        Py_XDECREF(call_result);
+        Py_XDECREF(empty);
+        if (type) {
+            PyErr_Restore(type, value, traceback);
+        }
+        return co;
+    }
 #else
   #define __Pyx_PyCode_New(a, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)\
           PyCode_New(a, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)
 #endif
   #define __Pyx_DefaultClassType PyType_Type
 #endif
 #ifndef Py_TPFLAGS_CHECKTYPES
@@ -588,18 +649,18 @@
   #ifndef PyUnicode_InternFromString
     #define PyUnicode_InternFromString(s) PyUnicode_FromString(s)
   #endif
 #endif
 #if PY_VERSION_HEX < 0x030200A4
   typedef long Py_hash_t;
   #define __Pyx_PyInt_FromHash_t PyInt_FromLong
-  #define __Pyx_PyInt_AsHash_t   PyInt_AsLong
+  #define __Pyx_PyInt_AsHash_t   __Pyx_PyIndex_AsHash_t
 #else
   #define __Pyx_PyInt_FromHash_t PyInt_FromSsize_t
-  #define __Pyx_PyInt_AsHash_t   PyInt_AsSsize_t
+  #define __Pyx_PyInt_AsHash_t   __Pyx_PyIndex_AsSsize_t
 #endif
 #if PY_MAJOR_VERSION >= 3
   #define __Pyx_PyMethod_New(func, self, klass) ((self) ? ((void)(klass), PyMethod_New(func, self)) : __Pyx_NewRef(func))
 #else
   #define __Pyx_PyMethod_New(func, self, klass) PyMethod_New(func, self, klass)
 #endif
 #if CYTHON_USE_ASYNC_SLOTS
@@ -754,14 +815,15 @@
 static CYTHON_INLINE int __Pyx_PyObject_IsTrue(PyObject*);
 static CYTHON_INLINE int __Pyx_PyObject_IsTrueAndDecref(PyObject*);
 static CYTHON_INLINE PyObject* __Pyx_PyNumber_IntOrLong(PyObject* x);
 #define __Pyx_PySequence_Tuple(obj)\
     (likely(PyTuple_CheckExact(obj)) ? __Pyx_NewRef(obj) : PySequence_Tuple(obj))
 static CYTHON_INLINE Py_ssize_t __Pyx_PyIndex_AsSsize_t(PyObject*);
 static CYTHON_INLINE PyObject * __Pyx_PyInt_FromSize_t(size_t);
+static CYTHON_INLINE Py_hash_t __Pyx_PyIndex_AsHash_t(PyObject*);
 #if CYTHON_ASSUME_SAFE_MACROS
 #define __pyx_PyFloat_AsDouble(x) (PyFloat_CheckExact(x) ? PyFloat_AS_DOUBLE(x) : PyFloat_AsDouble(x))
 #else
 #define __pyx_PyFloat_AsDouble(x) PyFloat_AsDouble(x)
 #endif
 #define __pyx_PyFloat_AsFloat(x) ((float) __pyx_PyFloat_AsDouble(x))
 #if PY_MAJOR_VERSION >= 3
@@ -972,21 +1034,23 @@
 #define __Pyx_PyFunction_FastCallDict(func, args, nargs, kwargs) _PyFunction_FastCallDict(func, args, nargs, kwargs)
 #endif
 #define __Pyx_BUILD_ASSERT_EXPR(cond)\
     (sizeof(char [1 - 2*!(cond)]) - 1)
 #ifndef Py_MEMBER_SIZE
 #define Py_MEMBER_SIZE(type, member) sizeof(((type *)0)->member)
 #endif
+#if CYTHON_FAST_PYCALL
   static size_t __pyx_pyframe_localsplus_offset = 0;
   #include "frameobject.h"
   #define __Pxy_PyFrame_Initialize_Offsets()\
     ((void)__Pyx_BUILD_ASSERT_EXPR(sizeof(PyFrameObject) == offsetof(PyFrameObject, f_localsplus) + Py_MEMBER_SIZE(PyFrameObject, f_localsplus)),\
      (void)(__pyx_pyframe_localsplus_offset = ((size_t)PyFrame_Type.tp_basicsize) - Py_MEMBER_SIZE(PyFrameObject, f_localsplus)))
   #define __Pyx_PyFrame_GetLocalsplus(frame)\
     (assert(__pyx_pyframe_localsplus_offset), (PyObject **)(((char *)(frame)) + __pyx_pyframe_localsplus_offset))
+#endif // CYTHON_FAST_PYCALL
 #endif
 
 /* PyObjectCall.proto */
 #if CYTHON_COMPILING_IN_CPYTHON
 static CYTHON_INLINE PyObject* __Pyx_PyObject_Call(PyObject *func, PyObject *arg, PyObject *kw);
 #else
 #define __Pyx_PyObject_Call(func, arg, kw) PyObject_Call(func, arg, kw)
@@ -1886,14 +1950,17 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
+  #if PY_VERSION_HEX >= 0x030B00A2
+  0, /*tp_inline_values_offset*/
+  #endif
 };
 
 static PyMethodDef __pyx_methods[] = {
   {"read_http_chunk", (PyCFunction)__pyx_pw_11resiliparse_5parse_4http_1read_http_chunk, METH_O, __pyx_doc_11resiliparse_5parse_4http_read_http_chunk},
   {0, 0, 0, 0}
 };
 
@@ -2928,15 +2995,15 @@
       } else {
         PyErr_Clear();
         use_cline = NULL;
       }
     }
     if (!use_cline) {
         c_line = 0;
-        PyObject_SetAttr(__pyx_cython_runtime, __pyx_n_s_cline_in_traceback, Py_False);
+        (void) PyObject_SetAttr(__pyx_cython_runtime, __pyx_n_s_cline_in_traceback, Py_False);
     }
     else if (use_cline == Py_False || (use_cline != Py_True && PyObject_Not(use_cline) != 0)) {
         c_line = 0;
     }
     __Pyx_ErrRestoreInState(tstate, ptype, pvalue, ptraceback);
     return c_line;
 }
@@ -3025,38 +3092,39 @@
 /* AddTraceback */
 #include "compile.h"
 #include "frameobject.h"
 #include "traceback.h"
 static PyCodeObject* __Pyx_CreateCodeObjectForTraceback(
             const char *funcname, int c_line,
             int py_line, const char *filename) {
-    PyCodeObject *py_code = 0;
-    PyObject *py_srcfile = 0;
-    PyObject *py_funcname = 0;
+    PyCodeObject *py_code = NULL;
+    PyObject *py_funcname = NULL;
     #if PY_MAJOR_VERSION < 3
+    PyObject *py_srcfile = NULL;
     py_srcfile = PyString_FromString(filename);
-    #else
-    py_srcfile = PyUnicode_FromString(filename);
-    #endif
     if (!py_srcfile) goto bad;
+    #endif
     if (c_line) {
         #if PY_MAJOR_VERSION < 3
         py_funcname = PyString_FromFormat( "%s (%s:%d)", funcname, __pyx_cfilenm, c_line);
+        if (!py_funcname) goto bad;
         #else
         py_funcname = PyUnicode_FromFormat( "%s (%s:%d)", funcname, __pyx_cfilenm, c_line);
+        if (!py_funcname) goto bad;
+        funcname = PyUnicode_AsUTF8(py_funcname);
+        if (!funcname) goto bad;
         #endif
     }
     else {
         #if PY_MAJOR_VERSION < 3
         py_funcname = PyString_FromString(funcname);
-        #else
-        py_funcname = PyUnicode_FromString(funcname);
+        if (!py_funcname) goto bad;
         #endif
     }
-    if (!py_funcname) goto bad;
+    #if PY_MAJOR_VERSION < 3
     py_code = __Pyx_PyCode_New(
         0,
         0,
         0,
         0,
         0,
         __pyx_empty_bytes, /*PyObject *code,*/
@@ -3067,19 +3135,24 @@
         __pyx_empty_tuple, /*PyObject *cellvars,*/
         py_srcfile,   /*PyObject *filename,*/
         py_funcname,  /*PyObject *name,*/
         py_line,
         __pyx_empty_bytes  /*PyObject *lnotab*/
     );
     Py_DECREF(py_srcfile);
-    Py_DECREF(py_funcname);
+    #else
+    py_code = PyCode_NewEmpty(filename, funcname, py_line);
+    #endif
+    Py_XDECREF(py_funcname);  // XDECREF since it's only set on Py3 if cline
     return py_code;
 bad:
-    Py_XDECREF(py_srcfile);
     Py_XDECREF(py_funcname);
+    #if PY_MAJOR_VERSION < 3
+    Py_XDECREF(py_srcfile);
+    #endif
     return NULL;
 }
 static void __Pyx_AddTraceback(const char *funcname, int c_line,
                                int py_line, const char *filename) {
     PyCodeObject *py_code = 0;
     PyFrameObject *py_frame = 0;
     PyThreadState *tstate = __Pyx_PyThreadState_Current;
@@ -4232,17 +4305,21 @@
     exc_state = &self->gi_exc_state;
     if (exc_state->exc_type) {
         #if CYTHON_COMPILING_IN_PYPY || CYTHON_COMPILING_IN_PYSTON
         #else
         if (exc_state->exc_traceback) {
             PyTracebackObject *tb = (PyTracebackObject *) exc_state->exc_traceback;
             PyFrameObject *f = tb->tb_frame;
-            Py_XINCREF(tstate->frame);
             assert(f->f_back == NULL);
+            #if PY_VERSION_HEX >= 0x030B00A1
+            f->f_back = PyThreadState_GetFrame(tstate);
+            #else
+            Py_XINCREF(tstate->frame);
             f->f_back = tstate->frame;
+            #endif
         }
         #endif
     }
 #if CYTHON_USE_EXC_INFO_STACK
     exc_state->previous_item = tstate->exc_info;
     tstate->exc_info = exc_state;
 #else
@@ -5028,14 +5105,17 @@
 #endif
 #if PY_VERSION_HEX >= 0x030800b1
     0,
 #endif
 #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
     0,
 #endif
+#if PY_VERSION_HEX >= 0x030B00A2
+    0,
+#endif
 };
 static int __pyx_Generator_init(void) {
     __pyx_GeneratorType_type.tp_getattro = __Pyx_PyObject_GenericGetAttrNoDict;
     __pyx_GeneratorType_type.tp_iter = PyObject_SelfIter;
     __pyx_GeneratorType = __Pyx_FetchCommonType(&__pyx_GeneratorType_type);
     if (unlikely(!__pyx_GeneratorType)) {
         return -1;
@@ -5340,14 +5420,31 @@
   }
   x = PyNumber_Index(b);
   if (!x) return -1;
   ival = PyInt_AsSsize_t(x);
   Py_DECREF(x);
   return ival;
 }
+static CYTHON_INLINE Py_hash_t __Pyx_PyIndex_AsHash_t(PyObject* o) {
+  if (sizeof(Py_hash_t) == sizeof(Py_ssize_t)) {
+    return (Py_hash_t) __Pyx_PyIndex_AsSsize_t(o);
+#if PY_MAJOR_VERSION < 3
+  } else if (likely(PyInt_CheckExact(o))) {
+    return PyInt_AS_LONG(o);
+#endif
+  } else {
+    Py_ssize_t ival;
+    PyObject *x;
+    x = PyNumber_Index(o);
+    if (!x) return -1;
+    ival = PyInt_AsLong(x);
+    Py_DECREF(x);
+    return ival;
+  }
+}
 static CYTHON_INLINE PyObject * __Pyx_PyBool_FromLong(long b) {
   return b ? __Pyx_NewRef(Py_True) : __Pyx_NewRef(Py_False);
 }
 static CYTHON_INLINE PyObject * __Pyx_PyInt_FromSize_t(size_t ival) {
     return PyInt_FromSize_t(ival);
 }
```

### Comparing `Resiliparse-0.8.1/resiliparse/parse/http.pxd` & `Resiliparse-0.9.0/resiliparse/parse/http.pxd`

 * *Files identical despite different names*

### Comparing `Resiliparse-0.8.1/resiliparse/parse/http.pyx` & `Resiliparse-0.9.0/resiliparse/parse/http.pyx`

 * *Files identical despite different names*

### Comparing `Resiliparse-0.8.1/resiliparse/parse/lang.cpp` & `Resiliparse-0.9.0/resiliparse/parse/lang.cpp`

 * *Files 1% similar despite different names*

```diff
@@ -1,8 +1,8 @@
-/* Generated by Cython 0.29.24 */
+/* Generated by Cython 0.29.25 */
 
 /* BEGIN: Cython Metadata
 {
     "distutils": {
         "depends": [
             "resiliparse/parse/lang_profiles.h"
         ],
@@ -36,16 +36,16 @@
 #endif /* PY_SSIZE_T_CLEAN */
 #include "Python.h"
 #ifndef Py_PYTHON_H
     #error Python headers needed to compile C extensions, please install development version of Python.
 #elif PY_VERSION_HEX < 0x02060000 || (0x03000000 <= PY_VERSION_HEX && PY_VERSION_HEX < 0x03030000)
     #error Cython requires Python 2.6+ or Python 3.3+.
 #else
-#define CYTHON_ABI "0_29_24"
-#define CYTHON_HEX_VERSION 0x001D18F0
+#define CYTHON_ABI "0_29_25"
+#define CYTHON_HEX_VERSION 0x001D19F0
 #define CYTHON_FUTURE_DIVISION 1
 #include <stddef.h>
 #ifndef offsetof
   #define offsetof(type, member) ( (size_t) & ((type*)0) -> member )
 #endif
 #if !defined(WIN32) && !defined(MS_WINDOWS)
   #ifndef __stdcall
@@ -184,15 +184,15 @@
   #endif
   #ifndef CYTHON_USE_PYLIST_INTERNALS
     #define CYTHON_USE_PYLIST_INTERNALS 1
   #endif
   #ifndef CYTHON_USE_UNICODE_INTERNALS
     #define CYTHON_USE_UNICODE_INTERNALS 1
   #endif
-  #if PY_VERSION_HEX < 0x030300F0
+  #if PY_VERSION_HEX < 0x030300F0 || PY_VERSION_HEX >= 0x030B00A2
     #undef CYTHON_USE_UNICODE_WRITER
     #define CYTHON_USE_UNICODE_WRITER 0
   #elif !defined(CYTHON_USE_UNICODE_WRITER)
     #define CYTHON_USE_UNICODE_WRITER 1
   #endif
   #ifndef CYTHON_AVOID_BORROWED_REFS
     #define CYTHON_AVOID_BORROWED_REFS 0
@@ -203,15 +203,15 @@
   #ifndef CYTHON_UNPACK_METHODS
     #define CYTHON_UNPACK_METHODS 1
   #endif
   #ifndef CYTHON_FAST_THREAD_STATE
     #define CYTHON_FAST_THREAD_STATE 1
   #endif
   #ifndef CYTHON_FAST_PYCALL
-    #define CYTHON_FAST_PYCALL 1
+    #define CYTHON_FAST_PYCALL (PY_VERSION_HEX < 0x030B00A1)
   #endif
   #ifndef CYTHON_PEP489_MULTI_PHASE_INIT
     #define CYTHON_PEP489_MULTI_PHASE_INIT (PY_VERSION_HEX >= 0x03050000)
   #endif
   #ifndef CYTHON_USE_TP_FINALIZE
     #define CYTHON_USE_TP_FINALIZE (PY_VERSION_HEX >= 0x030400a1)
   #endif
@@ -222,15 +222,17 @@
     #define CYTHON_USE_EXC_INFO_STACK (PY_VERSION_HEX >= 0x030700A3)
   #endif
 #endif
 #if !defined(CYTHON_FAST_PYCCALL)
 #define CYTHON_FAST_PYCCALL  (CYTHON_FAST_PYCALL && PY_VERSION_HEX >= 0x030600B1)
 #endif
 #if CYTHON_USE_PYLONG_INTERNALS
-  #include "longintrepr.h"
+  #if PY_MAJOR_VERSION < 3
+    #include "longintrepr.h"
+  #endif
   #undef SHIFT
   #undef BASE
   #undef MASK
   #ifdef SIZEOF_VOID_P
     enum { __pyx_check_sizeof_voidp = 1 / (int)(SIZEOF_VOID_P == sizeof(void*)) };
   #endif
 #endif
@@ -353,17 +355,76 @@
 #if PY_MAJOR_VERSION < 3
   #define __Pyx_BUILTIN_MODULE_NAME "__builtin__"
   #define __Pyx_PyCode_New(a, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)\
           PyCode_New(a+k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)
   #define __Pyx_DefaultClassType PyClass_Type
 #else
   #define __Pyx_BUILTIN_MODULE_NAME "builtins"
-#if PY_VERSION_HEX >= 0x030800A4 && PY_VERSION_HEX < 0x030800B2
-  #define __Pyx_PyCode_New(a, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)\
-          PyCode_New(a, 0, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)
+  #define __Pyx_DefaultClassType PyType_Type
+#if PY_VERSION_HEX >= 0x030B00A1
+    static CYTHON_INLINE PyCodeObject* __Pyx_PyCode_New(int a, int k, int l, int s, int f,
+                                                    PyObject *code, PyObject *c, PyObject* n, PyObject *v,
+                                                    PyObject *fv, PyObject *cell, PyObject* fn,
+                                                    PyObject *name, int fline, PyObject *lnos) {
+        PyObject *kwds=NULL, *argcount=NULL, *posonlyargcount=NULL, *kwonlyargcount=NULL;
+        PyObject *nlocals=NULL, *stacksize=NULL, *flags=NULL, *replace=NULL, *call_result=NULL, *empty=NULL;
+        const char *fn_cstr=NULL;
+        const char *name_cstr=NULL;
+        PyCodeObject* co=NULL;
+        PyObject *type, *value, *traceback;
+        PyErr_Fetch(&type, &value, &traceback);
+        if (!(kwds=PyDict_New())) goto end;
+        if (!(argcount=PyLong_FromLong(a))) goto end;
+        if (PyDict_SetItemString(kwds, "co_argcount", argcount) != 0) goto end;
+        if (!(posonlyargcount=PyLong_FromLong(0))) goto end;
+        if (PyDict_SetItemString(kwds, "co_posonlyargcount", posonlyargcount) != 0) goto end;
+        if (!(kwonlyargcount=PyLong_FromLong(k))) goto end;
+        if (PyDict_SetItemString(kwds, "co_kwonlyargcount", kwonlyargcount) != 0) goto end;
+        if (!(nlocals=PyLong_FromLong(l))) goto end;
+        if (PyDict_SetItemString(kwds, "co_nlocals", nlocals) != 0) goto end;
+        if (!(stacksize=PyLong_FromLong(s))) goto end;
+        if (PyDict_SetItemString(kwds, "co_stacksize", stacksize) != 0) goto end;
+        if (!(flags=PyLong_FromLong(f))) goto end;
+        if (PyDict_SetItemString(kwds, "co_flags", flags) != 0) goto end;
+        if (PyDict_SetItemString(kwds, "co_code", code) != 0) goto end;
+        if (PyDict_SetItemString(kwds, "co_consts", c) != 0) goto end;
+        if (PyDict_SetItemString(kwds, "co_names", n) != 0) goto end;
+        if (PyDict_SetItemString(kwds, "co_varnames", v) != 0) goto end;
+        if (PyDict_SetItemString(kwds, "co_freevars", fv) != 0) goto end;
+        if (PyDict_SetItemString(kwds, "co_cellvars", cell) != 0) goto end;
+        if (PyDict_SetItemString(kwds, "co_linetable", lnos) != 0) goto end;
+        if (!(fn_cstr=PyUnicode_AsUTF8AndSize(fn, NULL))) goto end;
+        if (!(name_cstr=PyUnicode_AsUTF8AndSize(name, NULL))) goto end;
+        if (!(co = PyCode_NewEmpty(fn_cstr, name_cstr, fline))) goto end;
+        if (!(replace = PyObject_GetAttrString((PyObject*)co, "replace"))) goto cleanup_code_too;
+        if (!(empty = PyTuple_New(0))) goto cleanup_code_too; // unfortunately __pyx_empty_tuple isn't available here
+        if (!(call_result = PyObject_Call(replace, empty, kwds))) goto cleanup_code_too;
+        Py_XDECREF((PyObject*)co);
+        co = (PyCodeObject*)call_result;
+        call_result = NULL;
+        if (0) {
+            cleanup_code_too:
+            Py_XDECREF((PyObject*)co);
+            co = NULL;
+        }
+        end:
+        Py_XDECREF(kwds);
+        Py_XDECREF(argcount);
+        Py_XDECREF(posonlyargcount);
+        Py_XDECREF(kwonlyargcount);
+        Py_XDECREF(nlocals);
+        Py_XDECREF(stacksize);
+        Py_XDECREF(replace);
+        Py_XDECREF(call_result);
+        Py_XDECREF(empty);
+        if (type) {
+            PyErr_Restore(type, value, traceback);
+        }
+        return co;
+    }
 #else
   #define __Pyx_PyCode_New(a, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)\
           PyCode_New(a, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)
 #endif
   #define __Pyx_DefaultClassType PyType_Type
 #endif
 #ifndef Py_TPFLAGS_CHECKTYPES
@@ -593,18 +654,18 @@
   #ifndef PyUnicode_InternFromString
     #define PyUnicode_InternFromString(s) PyUnicode_FromString(s)
   #endif
 #endif
 #if PY_VERSION_HEX < 0x030200A4
   typedef long Py_hash_t;
   #define __Pyx_PyInt_FromHash_t PyInt_FromLong
-  #define __Pyx_PyInt_AsHash_t   PyInt_AsLong
+  #define __Pyx_PyInt_AsHash_t   __Pyx_PyIndex_AsHash_t
 #else
   #define __Pyx_PyInt_FromHash_t PyInt_FromSsize_t
-  #define __Pyx_PyInt_AsHash_t   PyInt_AsSsize_t
+  #define __Pyx_PyInt_AsHash_t   __Pyx_PyIndex_AsSsize_t
 #endif
 #if PY_MAJOR_VERSION >= 3
   #define __Pyx_PyMethod_New(func, self, klass) ((self) ? ((void)(klass), PyMethod_New(func, self)) : __Pyx_NewRef(func))
 #else
   #define __Pyx_PyMethod_New(func, self, klass) PyMethod_New(func, self, klass)
 #endif
 #if CYTHON_USE_ASYNC_SLOTS
@@ -760,14 +821,15 @@
 static CYTHON_INLINE int __Pyx_PyObject_IsTrue(PyObject*);
 static CYTHON_INLINE int __Pyx_PyObject_IsTrueAndDecref(PyObject*);
 static CYTHON_INLINE PyObject* __Pyx_PyNumber_IntOrLong(PyObject* x);
 #define __Pyx_PySequence_Tuple(obj)\
     (likely(PyTuple_CheckExact(obj)) ? __Pyx_NewRef(obj) : PySequence_Tuple(obj))
 static CYTHON_INLINE Py_ssize_t __Pyx_PyIndex_AsSsize_t(PyObject*);
 static CYTHON_INLINE PyObject * __Pyx_PyInt_FromSize_t(size_t);
+static CYTHON_INLINE Py_hash_t __Pyx_PyIndex_AsHash_t(PyObject*);
 #if CYTHON_ASSUME_SAFE_MACROS
 #define __pyx_PyFloat_AsDouble(x) (PyFloat_CheckExact(x) ? PyFloat_AS_DOUBLE(x) : PyFloat_AsDouble(x))
 #else
 #define __pyx_PyFloat_AsDouble(x) PyFloat_AsDouble(x)
 #endif
 #define __pyx_PyFloat_AsFloat(x) ((float) __pyx_PyFloat_AsDouble(x))
 #if PY_MAJOR_VERSION >= 3
@@ -4569,15 +4631,15 @@
       } else {
         PyErr_Clear();
         use_cline = NULL;
       }
     }
     if (!use_cline) {
         c_line = 0;
-        PyObject_SetAttr(__pyx_cython_runtime, __pyx_n_s_cline_in_traceback, Py_False);
+        (void) PyObject_SetAttr(__pyx_cython_runtime, __pyx_n_s_cline_in_traceback, Py_False);
     }
     else if (use_cline == Py_False || (use_cline != Py_True && PyObject_Not(use_cline) != 0)) {
         c_line = 0;
     }
     __Pyx_ErrRestoreInState(tstate, ptype, pvalue, ptraceback);
     return c_line;
 }
@@ -4666,38 +4728,39 @@
 /* AddTraceback */
 #include "compile.h"
 #include "frameobject.h"
 #include "traceback.h"
 static PyCodeObject* __Pyx_CreateCodeObjectForTraceback(
             const char *funcname, int c_line,
             int py_line, const char *filename) {
-    PyCodeObject *py_code = 0;
-    PyObject *py_srcfile = 0;
-    PyObject *py_funcname = 0;
+    PyCodeObject *py_code = NULL;
+    PyObject *py_funcname = NULL;
     #if PY_MAJOR_VERSION < 3
+    PyObject *py_srcfile = NULL;
     py_srcfile = PyString_FromString(filename);
-    #else
-    py_srcfile = PyUnicode_FromString(filename);
-    #endif
     if (!py_srcfile) goto bad;
+    #endif
     if (c_line) {
         #if PY_MAJOR_VERSION < 3
         py_funcname = PyString_FromFormat( "%s (%s:%d)", funcname, __pyx_cfilenm, c_line);
+        if (!py_funcname) goto bad;
         #else
         py_funcname = PyUnicode_FromFormat( "%s (%s:%d)", funcname, __pyx_cfilenm, c_line);
+        if (!py_funcname) goto bad;
+        funcname = PyUnicode_AsUTF8(py_funcname);
+        if (!funcname) goto bad;
         #endif
     }
     else {
         #if PY_MAJOR_VERSION < 3
         py_funcname = PyString_FromString(funcname);
-        #else
-        py_funcname = PyUnicode_FromString(funcname);
+        if (!py_funcname) goto bad;
         #endif
     }
-    if (!py_funcname) goto bad;
+    #if PY_MAJOR_VERSION < 3
     py_code = __Pyx_PyCode_New(
         0,
         0,
         0,
         0,
         0,
         __pyx_empty_bytes, /*PyObject *code,*/
@@ -4708,19 +4771,24 @@
         __pyx_empty_tuple, /*PyObject *cellvars,*/
         py_srcfile,   /*PyObject *filename,*/
         py_funcname,  /*PyObject *name,*/
         py_line,
         __pyx_empty_bytes  /*PyObject *lnotab*/
     );
     Py_DECREF(py_srcfile);
-    Py_DECREF(py_funcname);
+    #else
+    py_code = PyCode_NewEmpty(filename, funcname, py_line);
+    #endif
+    Py_XDECREF(py_funcname);  // XDECREF since it's only set on Py3 if cline
     return py_code;
 bad:
-    Py_XDECREF(py_srcfile);
     Py_XDECREF(py_funcname);
+    #if PY_MAJOR_VERSION < 3
+    Py_XDECREF(py_srcfile);
+    #endif
     return NULL;
 }
 static void __Pyx_AddTraceback(const char *funcname, int c_line,
                                int py_line, const char *filename) {
     PyCodeObject *py_code = 0;
     PyFrameObject *py_frame = 0;
     PyThreadState *tstate = __Pyx_PyThreadState_Current;
@@ -5907,14 +5975,31 @@
   }
   x = PyNumber_Index(b);
   if (!x) return -1;
   ival = PyInt_AsSsize_t(x);
   Py_DECREF(x);
   return ival;
 }
+static CYTHON_INLINE Py_hash_t __Pyx_PyIndex_AsHash_t(PyObject* o) {
+  if (sizeof(Py_hash_t) == sizeof(Py_ssize_t)) {
+    return (Py_hash_t) __Pyx_PyIndex_AsSsize_t(o);
+#if PY_MAJOR_VERSION < 3
+  } else if (likely(PyInt_CheckExact(o))) {
+    return PyInt_AS_LONG(o);
+#endif
+  } else {
+    Py_ssize_t ival;
+    PyObject *x;
+    x = PyNumber_Index(o);
+    if (!x) return -1;
+    ival = PyInt_AsLong(x);
+    Py_DECREF(x);
+    return ival;
+  }
+}
 static CYTHON_INLINE PyObject * __Pyx_PyBool_FromLong(long b) {
   return b ? __Pyx_NewRef(Py_True) : __Pyx_NewRef(Py_False);
 }
 static CYTHON_INLINE PyObject * __Pyx_PyInt_FromSize_t(size_t ival) {
     return PyInt_FromSize_t(ival);
 }
```

### Comparing `Resiliparse-0.8.1/resiliparse/parse/lang.pxd` & `Resiliparse-0.9.0/resiliparse/parse/lang.pxd`

 * *Files identical despite different names*

### Comparing `Resiliparse-0.8.1/resiliparse/parse/lang.pyx` & `Resiliparse-0.9.0/resiliparse/parse/lang.pyx`

 * *Files identical despite different names*

### Comparing `Resiliparse-0.8.1/resiliparse/parse/lang_profiles.h` & `Resiliparse-0.9.0/resiliparse/parse/lang_profiles.h`

 * *Files identical despite different names*

### Comparing `Resiliparse-0.8.1/resiliparse/process_guard.cpp` & `Resiliparse-0.9.0/resiliparse/process_guard.cpp`

 * *Files 1% similar despite different names*

```diff
@@ -1,8 +1,8 @@
-/* Generated by Cython 0.29.24 */
+/* Generated by Cython 0.29.25 */
 
 /* BEGIN: Cython Metadata
 {
     "distutils": {
         "depends": [],
         "extra_compile_args": [
             "-std=c++17",
@@ -34,16 +34,16 @@
 #endif /* PY_SSIZE_T_CLEAN */
 #include "Python.h"
 #ifndef Py_PYTHON_H
     #error Python headers needed to compile C extensions, please install development version of Python.
 #elif PY_VERSION_HEX < 0x02060000 || (0x03000000 <= PY_VERSION_HEX && PY_VERSION_HEX < 0x03030000)
     #error Cython requires Python 2.6+ or Python 3.3+.
 #else
-#define CYTHON_ABI "0_29_24"
-#define CYTHON_HEX_VERSION 0x001D18F0
+#define CYTHON_ABI "0_29_25"
+#define CYTHON_HEX_VERSION 0x001D19F0
 #define CYTHON_FUTURE_DIVISION 1
 #include <stddef.h>
 #ifndef offsetof
   #define offsetof(type, member) ( (size_t) & ((type*)0) -> member )
 #endif
 #if !defined(WIN32) && !defined(MS_WINDOWS)
   #ifndef __stdcall
@@ -182,15 +182,15 @@
   #endif
   #ifndef CYTHON_USE_PYLIST_INTERNALS
     #define CYTHON_USE_PYLIST_INTERNALS 1
   #endif
   #ifndef CYTHON_USE_UNICODE_INTERNALS
     #define CYTHON_USE_UNICODE_INTERNALS 1
   #endif
-  #if PY_VERSION_HEX < 0x030300F0
+  #if PY_VERSION_HEX < 0x030300F0 || PY_VERSION_HEX >= 0x030B00A2
     #undef CYTHON_USE_UNICODE_WRITER
     #define CYTHON_USE_UNICODE_WRITER 0
   #elif !defined(CYTHON_USE_UNICODE_WRITER)
     #define CYTHON_USE_UNICODE_WRITER 1
   #endif
   #ifndef CYTHON_AVOID_BORROWED_REFS
     #define CYTHON_AVOID_BORROWED_REFS 0
@@ -201,15 +201,15 @@
   #ifndef CYTHON_UNPACK_METHODS
     #define CYTHON_UNPACK_METHODS 1
   #endif
   #ifndef CYTHON_FAST_THREAD_STATE
     #define CYTHON_FAST_THREAD_STATE 1
   #endif
   #ifndef CYTHON_FAST_PYCALL
-    #define CYTHON_FAST_PYCALL 1
+    #define CYTHON_FAST_PYCALL (PY_VERSION_HEX < 0x030B00A1)
   #endif
   #ifndef CYTHON_PEP489_MULTI_PHASE_INIT
     #define CYTHON_PEP489_MULTI_PHASE_INIT (PY_VERSION_HEX >= 0x03050000)
   #endif
   #ifndef CYTHON_USE_TP_FINALIZE
     #define CYTHON_USE_TP_FINALIZE (PY_VERSION_HEX >= 0x030400a1)
   #endif
@@ -220,15 +220,17 @@
     #define CYTHON_USE_EXC_INFO_STACK (PY_VERSION_HEX >= 0x030700A3)
   #endif
 #endif
 #if !defined(CYTHON_FAST_PYCCALL)
 #define CYTHON_FAST_PYCCALL  (CYTHON_FAST_PYCALL && PY_VERSION_HEX >= 0x030600B1)
 #endif
 #if CYTHON_USE_PYLONG_INTERNALS
-  #include "longintrepr.h"
+  #if PY_MAJOR_VERSION < 3
+    #include "longintrepr.h"
+  #endif
   #undef SHIFT
   #undef BASE
   #undef MASK
   #ifdef SIZEOF_VOID_P
     enum { __pyx_check_sizeof_voidp = 1 / (int)(SIZEOF_VOID_P == sizeof(void*)) };
   #endif
 #endif
@@ -351,17 +353,76 @@
 #if PY_MAJOR_VERSION < 3
   #define __Pyx_BUILTIN_MODULE_NAME "__builtin__"
   #define __Pyx_PyCode_New(a, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)\
           PyCode_New(a+k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)
   #define __Pyx_DefaultClassType PyClass_Type
 #else
   #define __Pyx_BUILTIN_MODULE_NAME "builtins"
-#if PY_VERSION_HEX >= 0x030800A4 && PY_VERSION_HEX < 0x030800B2
-  #define __Pyx_PyCode_New(a, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)\
-          PyCode_New(a, 0, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)
+  #define __Pyx_DefaultClassType PyType_Type
+#if PY_VERSION_HEX >= 0x030B00A1
+    static CYTHON_INLINE PyCodeObject* __Pyx_PyCode_New(int a, int k, int l, int s, int f,
+                                                    PyObject *code, PyObject *c, PyObject* n, PyObject *v,
+                                                    PyObject *fv, PyObject *cell, PyObject* fn,
+                                                    PyObject *name, int fline, PyObject *lnos) {
+        PyObject *kwds=NULL, *argcount=NULL, *posonlyargcount=NULL, *kwonlyargcount=NULL;
+        PyObject *nlocals=NULL, *stacksize=NULL, *flags=NULL, *replace=NULL, *call_result=NULL, *empty=NULL;
+        const char *fn_cstr=NULL;
+        const char *name_cstr=NULL;
+        PyCodeObject* co=NULL;
+        PyObject *type, *value, *traceback;
+        PyErr_Fetch(&type, &value, &traceback);
+        if (!(kwds=PyDict_New())) goto end;
+        if (!(argcount=PyLong_FromLong(a))) goto end;
+        if (PyDict_SetItemString(kwds, "co_argcount", argcount) != 0) goto end;
+        if (!(posonlyargcount=PyLong_FromLong(0))) goto end;
+        if (PyDict_SetItemString(kwds, "co_posonlyargcount", posonlyargcount) != 0) goto end;
+        if (!(kwonlyargcount=PyLong_FromLong(k))) goto end;
+        if (PyDict_SetItemString(kwds, "co_kwonlyargcount", kwonlyargcount) != 0) goto end;
+        if (!(nlocals=PyLong_FromLong(l))) goto end;
+        if (PyDict_SetItemString(kwds, "co_nlocals", nlocals) != 0) goto end;
+        if (!(stacksize=PyLong_FromLong(s))) goto end;
+        if (PyDict_SetItemString(kwds, "co_stacksize", stacksize) != 0) goto end;
+        if (!(flags=PyLong_FromLong(f))) goto end;
+        if (PyDict_SetItemString(kwds, "co_flags", flags) != 0) goto end;
+        if (PyDict_SetItemString(kwds, "co_code", code) != 0) goto end;
+        if (PyDict_SetItemString(kwds, "co_consts", c) != 0) goto end;
+        if (PyDict_SetItemString(kwds, "co_names", n) != 0) goto end;
+        if (PyDict_SetItemString(kwds, "co_varnames", v) != 0) goto end;
+        if (PyDict_SetItemString(kwds, "co_freevars", fv) != 0) goto end;
+        if (PyDict_SetItemString(kwds, "co_cellvars", cell) != 0) goto end;
+        if (PyDict_SetItemString(kwds, "co_linetable", lnos) != 0) goto end;
+        if (!(fn_cstr=PyUnicode_AsUTF8AndSize(fn, NULL))) goto end;
+        if (!(name_cstr=PyUnicode_AsUTF8AndSize(name, NULL))) goto end;
+        if (!(co = PyCode_NewEmpty(fn_cstr, name_cstr, fline))) goto end;
+        if (!(replace = PyObject_GetAttrString((PyObject*)co, "replace"))) goto cleanup_code_too;
+        if (!(empty = PyTuple_New(0))) goto cleanup_code_too; // unfortunately __pyx_empty_tuple isn't available here
+        if (!(call_result = PyObject_Call(replace, empty, kwds))) goto cleanup_code_too;
+        Py_XDECREF((PyObject*)co);
+        co = (PyCodeObject*)call_result;
+        call_result = NULL;
+        if (0) {
+            cleanup_code_too:
+            Py_XDECREF((PyObject*)co);
+            co = NULL;
+        }
+        end:
+        Py_XDECREF(kwds);
+        Py_XDECREF(argcount);
+        Py_XDECREF(posonlyargcount);
+        Py_XDECREF(kwonlyargcount);
+        Py_XDECREF(nlocals);
+        Py_XDECREF(stacksize);
+        Py_XDECREF(replace);
+        Py_XDECREF(call_result);
+        Py_XDECREF(empty);
+        if (type) {
+            PyErr_Restore(type, value, traceback);
+        }
+        return co;
+    }
 #else
   #define __Pyx_PyCode_New(a, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)\
           PyCode_New(a, k, l, s, f, code, c, n, v, fv, cell, fn, name, fline, lnos)
 #endif
   #define __Pyx_DefaultClassType PyType_Type
 #endif
 #ifndef Py_TPFLAGS_CHECKTYPES
@@ -591,18 +652,18 @@
   #ifndef PyUnicode_InternFromString
     #define PyUnicode_InternFromString(s) PyUnicode_FromString(s)
   #endif
 #endif
 #if PY_VERSION_HEX < 0x030200A4
   typedef long Py_hash_t;
   #define __Pyx_PyInt_FromHash_t PyInt_FromLong
-  #define __Pyx_PyInt_AsHash_t   PyInt_AsLong
+  #define __Pyx_PyInt_AsHash_t   __Pyx_PyIndex_AsHash_t
 #else
   #define __Pyx_PyInt_FromHash_t PyInt_FromSsize_t
-  #define __Pyx_PyInt_AsHash_t   PyInt_AsSsize_t
+  #define __Pyx_PyInt_AsHash_t   __Pyx_PyIndex_AsSsize_t
 #endif
 #if PY_MAJOR_VERSION >= 3
   #define __Pyx_PyMethod_New(func, self, klass) ((self) ? ((void)(klass), PyMethod_New(func, self)) : __Pyx_NewRef(func))
 #else
   #define __Pyx_PyMethod_New(func, self, klass) PyMethod_New(func, self, klass)
 #endif
 #if CYTHON_USE_ASYNC_SLOTS
@@ -765,14 +826,15 @@
 static CYTHON_INLINE int __Pyx_PyObject_IsTrue(PyObject*);
 static CYTHON_INLINE int __Pyx_PyObject_IsTrueAndDecref(PyObject*);
 static CYTHON_INLINE PyObject* __Pyx_PyNumber_IntOrLong(PyObject* x);
 #define __Pyx_PySequence_Tuple(obj)\
     (likely(PyTuple_CheckExact(obj)) ? __Pyx_NewRef(obj) : PySequence_Tuple(obj))
 static CYTHON_INLINE Py_ssize_t __Pyx_PyIndex_AsSsize_t(PyObject*);
 static CYTHON_INLINE PyObject * __Pyx_PyInt_FromSize_t(size_t);
+static CYTHON_INLINE Py_hash_t __Pyx_PyIndex_AsHash_t(PyObject*);
 #if CYTHON_ASSUME_SAFE_MACROS
 #define __pyx_PyFloat_AsDouble(x) (PyFloat_CheckExact(x) ? PyFloat_AS_DOUBLE(x) : PyFloat_AsDouble(x))
 #else
 #define __pyx_PyFloat_AsDouble(x) PyFloat_AsDouble(x)
 #endif
 #define __pyx_PyFloat_AsFloat(x) ((float) __pyx_PyFloat_AsDouble(x))
 #if PY_MAJOR_VERSION >= 3
@@ -1326,21 +1388,23 @@
 #define __Pyx_PyFunction_FastCallDict(func, args, nargs, kwargs) _PyFunction_FastCallDict(func, args, nargs, kwargs)
 #endif
 #define __Pyx_BUILD_ASSERT_EXPR(cond)\
     (sizeof(char [1 - 2*!(cond)]) - 1)
 #ifndef Py_MEMBER_SIZE
 #define Py_MEMBER_SIZE(type, member) sizeof(((type *)0)->member)
 #endif
+#if CYTHON_FAST_PYCALL
   static size_t __pyx_pyframe_localsplus_offset = 0;
   #include "frameobject.h"
   #define __Pxy_PyFrame_Initialize_Offsets()\
     ((void)__Pyx_BUILD_ASSERT_EXPR(sizeof(PyFrameObject) == offsetof(PyFrameObject, f_localsplus) + Py_MEMBER_SIZE(PyFrameObject, f_localsplus)),\
      (void)(__pyx_pyframe_localsplus_offset = ((size_t)PyFrame_Type.tp_basicsize) - Py_MEMBER_SIZE(PyFrameObject, f_localsplus)))
   #define __Pyx_PyFrame_GetLocalsplus(frame)\
     (assert(__pyx_pyframe_localsplus_offset), (PyObject **)(((char *)(frame)) + __pyx_pyframe_localsplus_offset))
+#endif // CYTHON_FAST_PYCALL
 #endif
 
 /* PyObjectCall2Args.proto */
 static CYTHON_UNUSED PyObject* __Pyx_PyObject_Call2Args(PyObject* function, PyObject* arg1, PyObject* arg2);
 
 /* PyObjectCallMethO.proto */
 #if CYTHON_COMPILING_IN_CPYTHON
@@ -9053,14 +9117,17 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
+  #if PY_VERSION_HEX >= 0x030B00A2
+  0, /*tp_inline_values_offset*/
+  #endif
 };
 static struct __pyx_vtabstruct_11resiliparse_13process_guard_TimeGuard __pyx_vtable_11resiliparse_13process_guard_TimeGuard;
 
 static PyObject *__pyx_tp_new_11resiliparse_13process_guard_TimeGuard(PyTypeObject *t, PyObject *a, PyObject *k) {
   struct __pyx_obj_11resiliparse_13process_guard_TimeGuard *p;
   PyObject *o = __pyx_tp_new_11resiliparse_13process_guard__ResiliparseGuard(t, a, k);
   if (unlikely(!o)) return 0;
@@ -9145,14 +9212,17 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
+  #if PY_VERSION_HEX >= 0x030B00A2
+  0, /*tp_inline_values_offset*/
+  #endif
 };
 static struct __pyx_vtabstruct_11resiliparse_13process_guard_MemGuard __pyx_vtable_11resiliparse_13process_guard_MemGuard;
 
 static PyObject *__pyx_tp_new_11resiliparse_13process_guard_MemGuard(PyTypeObject *t, PyObject *a, PyObject *k) {
   struct __pyx_obj_11resiliparse_13process_guard_MemGuard *p;
   PyObject *o = __pyx_tp_new_11resiliparse_13process_guard__ResiliparseGuard(t, a, k);
   if (unlikely(!o)) return 0;
@@ -9236,14 +9306,17 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
+  #if PY_VERSION_HEX >= 0x030B00A2
+  0, /*tp_inline_values_offset*/
+  #endif
 };
 
 static struct __pyx_obj_11resiliparse_13process_guard___pyx_scope_struct____call__ *__pyx_freelist_11resiliparse_13process_guard___pyx_scope_struct____call__[8];
 static int __pyx_freecount_11resiliparse_13process_guard___pyx_scope_struct____call__ = 0;
 
 static PyObject *__pyx_tp_new_11resiliparse_13process_guard___pyx_scope_struct____call__(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
   PyObject *o;
@@ -9358,14 +9431,17 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
+  #if PY_VERSION_HEX >= 0x030B00A2
+  0, /*tp_inline_values_offset*/
+  #endif
 };
 
 static struct __pyx_obj_11resiliparse_13process_guard___pyx_scope_struct_1___pyx_base__exec_before *__pyx_freelist_11resiliparse_13process_guard___pyx_scope_struct_1___pyx_base__exec_before[8];
 static int __pyx_freecount_11resiliparse_13process_guard___pyx_scope_struct_1___pyx_base__exec_before = 0;
 
 static PyObject *__pyx_tp_new_11resiliparse_13process_guard___pyx_scope_struct_1___pyx_base__exec_before(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
   PyObject *o;
@@ -9473,14 +9549,17 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
+  #if PY_VERSION_HEX >= 0x030B00A2
+  0, /*tp_inline_values_offset*/
+  #endif
 };
 
 static struct __pyx_obj_11resiliparse_13process_guard___pyx_scope_struct_2___pyx_base__exec_before *__pyx_freelist_11resiliparse_13process_guard___pyx_scope_struct_2___pyx_base__exec_before[8];
 static int __pyx_freecount_11resiliparse_13process_guard___pyx_scope_struct_2___pyx_base__exec_before = 0;
 
 static PyObject *__pyx_tp_new_11resiliparse_13process_guard___pyx_scope_struct_2___pyx_base__exec_before(PyTypeObject *t, CYTHON_UNUSED PyObject *a, CYTHON_UNUSED PyObject *k) {
   PyObject *o;
@@ -9588,14 +9667,17 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
+  #if PY_VERSION_HEX >= 0x030B00A2
+  0, /*tp_inline_values_offset*/
+  #endif
 };
 
 static PyObject *__pyx_tp_new___Pyx_EnumMeta(PyTypeObject *t, PyObject *a, PyObject *k) {
   PyObject *o = (&PyType_Type)->tp_new(t, a, k);
   if (unlikely(!o)) return 0;
   return o;
 }
@@ -9717,14 +9799,17 @@
   #endif
   #if PY_VERSION_HEX >= 0x030800b1
   0, /*tp_vectorcall*/
   #endif
   #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
   0, /*tp_print*/
   #endif
+  #if PY_VERSION_HEX >= 0x030B00A2
+  0, /*tp_inline_values_offset*/
+  #endif
 };
 
 static PyMethodDef __pyx_methods[] = {
   {"progress", (PyCFunction)(void*)(PyCFunctionWithKeywords)__pyx_pw_11resiliparse_13process_guard_3progress, METH_VARARGS|METH_KEYWORDS, __pyx_doc_11resiliparse_13process_guard_2progress},
   {0, 0, 0, 0}
 };
 
@@ -12771,14 +12856,17 @@
 #endif
 #if PY_VERSION_HEX >= 0x030800b1
     0,
 #endif
 #if PY_VERSION_HEX >= 0x030800b4 && PY_VERSION_HEX < 0x03090000
     0,
 #endif
+#if PY_VERSION_HEX >= 0x030B00A2
+    0,
+#endif
 };
 static int __pyx_CyFunction_init(void) {
     __pyx_CyFunctionType = __Pyx_FetchCommonType(&__pyx_CyFunctionType_type);
     if (unlikely(__pyx_CyFunctionType == NULL)) {
         return -1;
     }
     return 0;
@@ -13730,15 +13818,15 @@
       } else {
         PyErr_Clear();
         use_cline = NULL;
       }
     }
     if (!use_cline) {
         c_line = 0;
-        PyObject_SetAttr(__pyx_cython_runtime, __pyx_n_s_cline_in_traceback, Py_False);
+        (void) PyObject_SetAttr(__pyx_cython_runtime, __pyx_n_s_cline_in_traceback, Py_False);
     }
     else if (use_cline == Py_False || (use_cline != Py_True && PyObject_Not(use_cline) != 0)) {
         c_line = 0;
     }
     __Pyx_ErrRestoreInState(tstate, ptype, pvalue, ptraceback);
     return c_line;
 }
@@ -13827,38 +13915,39 @@
 /* AddTraceback */
 #include "compile.h"
 #include "frameobject.h"
 #include "traceback.h"
 static PyCodeObject* __Pyx_CreateCodeObjectForTraceback(
             const char *funcname, int c_line,
             int py_line, const char *filename) {
-    PyCodeObject *py_code = 0;
-    PyObject *py_srcfile = 0;
-    PyObject *py_funcname = 0;
+    PyCodeObject *py_code = NULL;
+    PyObject *py_funcname = NULL;
     #if PY_MAJOR_VERSION < 3
+    PyObject *py_srcfile = NULL;
     py_srcfile = PyString_FromString(filename);
-    #else
-    py_srcfile = PyUnicode_FromString(filename);
-    #endif
     if (!py_srcfile) goto bad;
+    #endif
     if (c_line) {
         #if PY_MAJOR_VERSION < 3
         py_funcname = PyString_FromFormat( "%s (%s:%d)", funcname, __pyx_cfilenm, c_line);
+        if (!py_funcname) goto bad;
         #else
         py_funcname = PyUnicode_FromFormat( "%s (%s:%d)", funcname, __pyx_cfilenm, c_line);
+        if (!py_funcname) goto bad;
+        funcname = PyUnicode_AsUTF8(py_funcname);
+        if (!funcname) goto bad;
         #endif
     }
     else {
         #if PY_MAJOR_VERSION < 3
         py_funcname = PyString_FromString(funcname);
-        #else
-        py_funcname = PyUnicode_FromString(funcname);
+        if (!py_funcname) goto bad;
         #endif
     }
-    if (!py_funcname) goto bad;
+    #if PY_MAJOR_VERSION < 3
     py_code = __Pyx_PyCode_New(
         0,
         0,
         0,
         0,
         0,
         __pyx_empty_bytes, /*PyObject *code,*/
@@ -13869,19 +13958,24 @@
         __pyx_empty_tuple, /*PyObject *cellvars,*/
         py_srcfile,   /*PyObject *filename,*/
         py_funcname,  /*PyObject *name,*/
         py_line,
         __pyx_empty_bytes  /*PyObject *lnotab*/
     );
     Py_DECREF(py_srcfile);
-    Py_DECREF(py_funcname);
+    #else
+    py_code = PyCode_NewEmpty(filename, funcname, py_line);
+    #endif
+    Py_XDECREF(py_funcname);  // XDECREF since it's only set on Py3 if cline
     return py_code;
 bad:
-    Py_XDECREF(py_srcfile);
     Py_XDECREF(py_funcname);
+    #if PY_MAJOR_VERSION < 3
+    Py_XDECREF(py_srcfile);
+    #endif
     return NULL;
 }
 static void __Pyx_AddTraceback(const char *funcname, int c_line,
                                int py_line, const char *filename) {
     PyCodeObject *py_code = 0;
     PyFrameObject *py_frame = 0;
     PyThreadState *tstate = __Pyx_PyThreadState_Current;
@@ -15188,14 +15282,31 @@
   }
   x = PyNumber_Index(b);
   if (!x) return -1;
   ival = PyInt_AsSsize_t(x);
   Py_DECREF(x);
   return ival;
 }
+static CYTHON_INLINE Py_hash_t __Pyx_PyIndex_AsHash_t(PyObject* o) {
+  if (sizeof(Py_hash_t) == sizeof(Py_ssize_t)) {
+    return (Py_hash_t) __Pyx_PyIndex_AsSsize_t(o);
+#if PY_MAJOR_VERSION < 3
+  } else if (likely(PyInt_CheckExact(o))) {
+    return PyInt_AS_LONG(o);
+#endif
+  } else {
+    Py_ssize_t ival;
+    PyObject *x;
+    x = PyNumber_Index(o);
+    if (!x) return -1;
+    ival = PyInt_AsLong(x);
+    Py_DECREF(x);
+    return ival;
+  }
+}
 static CYTHON_INLINE PyObject * __Pyx_PyBool_FromLong(long b) {
   return b ? __Pyx_NewRef(Py_True) : __Pyx_NewRef(Py_False);
 }
 static CYTHON_INLINE PyObject * __Pyx_PyInt_FromSize_t(size_t ival) {
     return PyInt_FromSize_t(ival);
 }
```

### Comparing `Resiliparse-0.8.1/resiliparse/process_guard.pxd` & `Resiliparse-0.9.0/resiliparse/process_guard.pxd`

 * *Files identical despite different names*

### Comparing `Resiliparse-0.8.1/resiliparse/process_guard.pyx` & `Resiliparse-0.9.0/resiliparse/process_guard.pyx`

 * *Files identical despite different names*

### Comparing `Resiliparse-0.8.1/resiliparse_common/__init__.pxd` & `Resiliparse-0.9.0/resiliparse_common/__init__.pxd`

 * *Files identical despite different names*

### Comparing `Resiliparse-0.8.1/resiliparse_common/string_util.pxd` & `Resiliparse-0.9.0/resiliparse_common/string_util.pxd`

 * *Files 5% similar despite different names*

```diff
@@ -36,21 +36,21 @@
 
 
 cdef inline size_t strip_c_str(const char** s_ptr, size_t l) nogil:
     """Strip leading and trailing white space from a C string."""
     return rstrip_c_str(s_ptr, lstrip_c_str(s_ptr, l))
 
 
-cdef inline string lstrip_str(const string& s) nogil:
-    """Strip leading white space from a C++ string."""
-    cdef const char* start = s.data()
-    cdef size_t l = lstrip_c_str(&start, s.size())
-    if start == s.data():
-        return s
-    return string(start, l)
+# cdef inline string lstrip_str(const string& s) nogil:
+#     """Strip leading white space from a C++ string."""
+#     cdef const char* start = s.data()
+#     cdef size_t l = lstrip_c_str(&start, s.size())
+#     if start == s.data():
+#         return s
+#     return string(start, l)
 
 
 cdef inline string rstrip_str(const string& s) nogil:
     """Strip leading white space from a C++ string."""
     cdef const char* start = s.data()
     cdef size_t l = rstrip_c_str(&start, s.size())
     if l == s.size():
```

### Comparing `Resiliparse-0.8.1/resiliparse_inc/boost_regex.pxd` & `Resiliparse-0.9.0/resiliparse_inc/boost_regex.pxd`

 * *Files identical despite different names*

### Comparing `Resiliparse-0.8.1/resiliparse_inc/lexbor.pxd` & `Resiliparse-0.9.0/resiliparse_inc/lexbor.pxd`

 * *Files 1% similar despite different names*

```diff
@@ -397,20 +397,26 @@
     size_t lxb_dom_collection_length_noi(lxb_dom_collection_t *col)
 
     lxb_dom_element_t * lxb_dom_collection_element_noi(lxb_dom_collection_t *col, size_t idx)
     lxb_dom_collection_t * lxb_dom_collection_destroy(lxb_dom_collection_t *col, bint self_destroy)
 
 
 cdef extern from "<lexbor/css/css.h>" nogil:
-    ctypedef struct lxb_css_parser_t
+    ctypedef struct lxb_css_log_t
     ctypedef struct lxb_css_syntax_tokenizer_t
+    ctypedef struct lxb_css_parser_t:
+        lxb_css_log_t *log
+        lxb_status_t status
+    ctypedef lxb_status_t (*lexbor_serialize_cb_f)(const lxb_char_t *data, size_t len, void *ctx)
 
     lxb_css_parser_t * lxb_css_parser_create()
     lxb_status_t lxb_css_parser_init(lxb_css_parser_t *parser, lxb_css_syntax_tokenizer_t *tkz, lexbor_mraw_t *mraw)
     lxb_css_parser_t * lxb_css_parser_destroy(lxb_css_parser_t *parser, bint self_destroy)
+    lxb_status_t lxb_css_log_serialize(lxb_css_log_t *log, lexbor_serialize_cb_f cb, void *ctx,
+                                       const lxb_char_t *indent, size_t indent_length)
 
 
 cdef extern from "<lexbor/tag/tag.h>" nogil:
     ctypedef enum lxb_tag_id_enum_t:
         LXB_TAG__UNDEF = 0x0000
         LXB_TAG__END_OF_FILE = 0x0001
         LXB_TAG__TEXT = 0x0002
```

### Comparing `Resiliparse-0.8.1/resiliparse_inc/lz4frame.pxd` & `Resiliparse-0.9.0/resiliparse_inc/lz4frame.pxd`

 * *Files identical despite different names*

### Comparing `Resiliparse-0.8.1/resiliparse_inc/re2.pxd` & `Resiliparse-0.9.0/resiliparse_inc/re2.pxd`

 * *Files identical despite different names*

### Comparing `Resiliparse-0.8.1/resiliparse_inc/string_view.pxd` & `Resiliparse-0.9.0/resiliparse_inc/string_view.pxd`

 * *Files identical despite different names*

### Comparing `Resiliparse-0.8.1/resiliparse_inc/utility.pxd` & `Resiliparse-0.9.0/resiliparse_inc/utility.pxd`

 * *Files identical despite different names*

### Comparing `Resiliparse-0.8.1/resiliparse_inc/zlib.pxd` & `Resiliparse-0.9.0/resiliparse_inc/zlib.pxd`

 * *Files identical despite different names*

### Comparing `Resiliparse-0.8.1/setup.py` & `Resiliparse-0.9.0/setup.py`

 * *Files 0% similar despite different names*

```diff
@@ -20,15 +20,15 @@
 import distutils.ccompiler
 from distutils.dir_util import copy_tree
 from setuptools import find_packages, setup, Extension
 
 
 # 1. BOILERPLATE -------------------------------------------------------
 
-VERSION = '0.8.1'
+VERSION = '0.9.0'
 ROOT_DIRECTORY = os.path.abspath(os.path.dirname(__file__))
 CXX = distutils.ccompiler.get_default_compiler()
 
 TRACE = bool(int(os.getenv('TRACE', 0)))
 DEBUG = bool(int(os.getenv('DEBUG', 0))) or TRACE
 ASAN = bool(int(os.getenv('ASAN', 0)))
```

